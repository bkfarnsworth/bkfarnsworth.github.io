window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(20),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,c){try{h?h-=1:o(c||new UncaughtException(t,e,n),!0)}catch(f){try{i("ierr",[f,s.now(),!0])}catch(d){}}return"function"==typeof u&&u.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t,e){var n=e?null:s.now();i("err",[t,n])}var i=t("handle"),a=t(21),c=t("ee"),s=t("loader"),f=t("gos"),u=window.onerror,d=!1,p="nr@seenError",h=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(13),t(12),"addEventListener"in window&&t(6),s.xhrWrappable&&t(14),d=!0)}c.on("fn-start",function(t,e,n){d&&(h+=1)}),c.on("fn-err",function(t,e,n){d&&!n[p]&&(f(n,p,function(){return!0}),this.thrown=!0,o(n))}),c.on("fn-end",function(){d&&!this.thrown&&h>0&&(h-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){M++,S=y.hash,this[u]=b.now()}function o(){M--,y.hash!==S&&i(0,!0);var t=b.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){E.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=b.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location,b=t("loader");if(w[v]&&b.xhrWrappable){var g=t(10),x=t(11),E=t(8),P=t(6),O=t(13),R=t(7),T=t(14),L=t(9),j=t("ee"),N=j.get("tracer");t(15),b.features.spa=!0;var S,M=0;j.on(u,r),j.on(p,r),j.on(d,o),j.on(h,o),j.buffer([u,d,"xhr-done","xhr-resolved"]),P.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),T.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),E.buffer(["newURL"]),g.buffer([u]),x.buffer(["propagate",p,h,"executor-err","resolve"+c]),N.buffer([u,"no-"+u]),L.buffer(["new-jsonp","cb-start","jsonp-error","jsonp-end"]),a(T,"send-xhr"+c),a(j,"xhr-resolved"),a(j,"xhr-done"),a(R,m+c),a(R,m+"-done"),a(L,"new-jsonp"),a(L,"jsonp-end"),a(L,"cb-start"),E.on("pushState-end",i),E.on("replaceState-end",i),w[v]("hashchange",i,!0),w[v]("load",i,!0),w[v]("popstate",function(){i(0,M>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(13),c=t(12),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(23)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,function:n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(20);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(23)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){function r(t){function e(){s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}function n(){s.emit("jsonp-error",[],p),s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}var r=t&&"string"==typeof t.nodeName&&"script"===t.nodeName.toLowerCase();if(r){var o="function"==typeof t.addEventListener;if(o){var a=i(t.src);if(a){var u=c(a),d="function"==typeof u.parent[u.key];if(d){var p={};f.inPlace(u.parent,[u.key],"cb-",p),t.addEventListener("load",e,!1),t.addEventListener("error",n,!1),s.emit("new-jsonp",[t.src],p)}}}}}function o(){return"addEventListener"in window}function i(t){var e=t.match(u);return e?e[1]:null}function a(t,e){var n=t.match(p),r=n[1],o=n[3];return o?a(o,e[r]):e[r]}function c(t){var e=t.match(d);return e&&e.length>=3?{key:e[2],parent:a(e[1],window)}:{key:t,parent:window}}var s=t("ee").get("jsonp"),f=t(23)(s);if(e.exports=s,o()){var u=/[?&](?:callback|cb)=([^&#]+)/,d=/(.*)\.([^.]+)/,p=/^(\w+)(\.|$)(.*)$/,h=["appendChild","insertBefore","replaceChild"];f.inPlace(HTMLElement.prototype,h,"dom-"),f.inPlace(HTMLHeadElement.prototype,h,"dom-"),f.inPlace(HTMLBodyElement.prototype,h,"dom-"),s.on("dom-start",function(t){r(t[0])})}},{}],10:[function(t,e,n){var r=t("ee").get("mutation"),o=t(23)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],11:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(23),a=t("ee").get("promise"),c=i(a),s=t(20),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],12:[function(t,e,n){var r=t("ee").get("raf"),o=t(23)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],13:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration=isNaN(t[1])?0:+t[1],t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(23)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],14:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,y,"fn-",c)}function i(t){b.push(t),l&&(x?x.then(a):v?v(a):(E=-E,P.data=E))}function a(){for(var t=0;t<b.length;t++)r([],b[t]);b.length&&(b=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(23)(u),p=NREUM.o,h=p.XHR,l=p.MO,m=p.PR,v=p.SI,w="readystatechange",y=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],b=[];e.exports=u;var g=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(w,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,g),g.prototype=h.prototype,d.inPlace(g.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var x=m&&m.resolve();if(!v&&!m){var E=1,P=document.createTextNode(E);new l(a).observe(P,{characterData:!0})}}else f.on("fn-end",function(t){t[0]&&t[0].type===w||a()})},{}],15:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(16),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(19),l=t(18),m=window.XMLHttpRequest;a.features.xhr=!0,t(14),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],16:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],17:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(20),c=t(21),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}catch(t){throw s.emit("fn-err",[arguments,this,t],n),t}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],18:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],19:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],20:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],21:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],22:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],23:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(21),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(20),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(20),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1071.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(17),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(22)},{}]},{},["loader",2,15,5,3,4]);NREUM.info={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",licenseKey:"668091877a",applicationID:"171916854",sa:1};(function(){window.digitalData={page:{autoTrack:false}};window.aauiLoadFile("//assets.adobedtm.com/98fab992275ef6366cc65f57f86b1e895a66c912/satelliteLib-1be49a4f81ac772ee656d1381455096eb3d9d3a6.js")})();!function(SETTINGS){!function(){function e(e){var i;t[e]!==i&&(SETTINGS[e]=t[e])}var t=window.targetGlobalSettings||{};e("clientCode"),e("serverDomain"),e("crossDomain"),e("timeout"),e("globalMboxAutoCreate"),e("sessionLifetime"),e("visitorApiTimeout"),e("enabled"),e("defaultContentHiddenStyle"),e("defaultContentVisibleStyle"),e("bodyHiddenStyle"),e("pollingAfterDomReadyTimeout")}();if(SETTINGS.enabled===false)return;!function(){"use strict";function e(e){e.fn.isHead=function(){return e(this).is("head")},e.fn.isBody=function(){return e(this).is("body")},e.fn.isHeadOrBody=function(){var t=e(this);return t.isHead()||t.isBody()}}function t(e){e.fn.showElement=function(){var t=e(this),n=t.attr("style"),r=[SETTINGS.defaultContentVisibleStyle];return n&&r.unshift(e.trim(n)),t.addClass(qi),t.attr("style",r.join(" "))},e.fn.exists=function(){return e(this).length>0},e.isElement=function(t){return!!t&&1===t.nodeType&&"object"===e.type(t)&&!e.isPlainObject(t)}}function n(e){e=e.replace(/\+/g," ");try{return decodeURIComponent(e)}catch(t){return e}}function r(e){for(var t=nr.exec(e),r={},o=14;o--;)r[or[o]]=t[o]||"";return r.queryParams={},r.query.replace(rr,function(e,t,o){var i=n(t),a=n(o);E(i)&&E(a)&&(r.queryParams[i]=a)}),r}function o(e){var t=r(e);return t.queryParams}function i(e,t){var n=o(e);return A(n[t])?null:n[t]}function a(e){var t,n,o,i,a,u=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return D(u)?e:(t={},n=[],o=r(e),i=e.split("?")[0],y(o.queryParams,function(e,n){return t[n]=e}),p(t,u),y(t,function(e,t){return n.push(lr(t)+"="+lr(e))}),a=n.join("&"),E(o.anchor)&&(a=a+"#"+o.anchor),i+"?"+a)}function u(e){var t={},n=r("?"+e);return y(n.queryParams,function(e,n){return t[n]=e}),t}function s(e){return e.split("=")}function c(e){return!L(e)&&2===e.length&&E(e[0])&&E(e[1])}function l(e){var t={},r=T(e,function(e){return E(e)}),o=v(r,function(e){return[s(e)]}),i=T(o,function(e){return c(e)});return y(i,function(e){return t[n(e[0])]=n(e[1])}),t}function f(e,t,n){y(e,function(e,r){w(e)?(t.push(r),f(e,t,n),t.pop()):L(t)?n[r]=e:n[t.concat(r).join(".")]=e})}function d(e){var t,n;if(!I(e))return{};t=null,n={};try{t=e()}catch(r){}return R(t)?{}:O(t)?l(t):E(t)?u(t):w(t)?(f(t,[],n),n):{}}function p(e,t){return y(t,function(t,n){return e[n]=t}),e}function h(){var e=(new Date).getTime(),t=Math.floor(999999*Math.random());return e+"-"+t}function m(e,t,n,o,i){var a=r(e),u={},s=[];return y(a.queryParams,function(e,t){return s.push(lr(t)+"="+lr(e))}),y(t,function(e,t){return E(o[t])?void(u[t]=o[t]):void(E(e)&&(u[t]=e))}),y(n,function(e,n){return E(i[n])?void(u[n]=i[n]):void((C(o[n])||A(t[n]))&&E(e)&&(u[n]=e))}),y(u,function(e,t){return s.push(lr(t)+"="+lr(e))}),a.path+"?"+s.join("&")}function g(e){var t,n=ar.exec(e)[1];return ir.test(n)?"":(t=ur.exec(n),R(t)||L(t)?"":(n=t[0],0===n.indexOf(sr)?n.substr(4):n))}function v(e,t){return Bi.map(e,t)}function y(e,t){Bi.each(e,function(e,n){return t(n,e)})}function T(e,t){return Bi.grep(e,t)}function b(e,t){return e.length>t}function x(e){return"string"===Bi.type(e)}function E(e){return x(e)&&Bi.trim(e).length>0}function C(e){return!x(e)||0===e.length}function N(e){return"boolean"===Bi.type(e)}function S(e){return"number"===Bi.type(e)}function A(e){return"undefined"===Bi.type(e)}function O(e){return Bi.isArray(e)}function I(e){return Bi.isFunction(e)}function R(e){return"null"===Bi.type(e)}function D(e){return Bi.isEmptyObject(e)}function w(e){return"object"===Bi.type(e)}function P(e){return Bi.isElement(e)}function k(e){return!P(e)}function L(e){return O(e)&&0===e.length}function _(e,t){var n=e.is("div."+Gn);return A(t)?n:n&&e.hasClass(Un+t)}function M(e){var t,n=["protocol","host"];return E(e)&&(t=function(){var t=r(e),o=T(n,function(e){return C(t[e])});return{v:L(o)}}(),"object"==typeof t)?t.v:!1}function j(e){var t=Bi("."+e);return t.last()}function H(e){var t=j(Un+e);return t.exists()?t:j(Gn)}function F(){SETTINGS.bodyHidingEnabled===!0&&Bi("#"+cr).remove()}function q(){SETTINGS.bodyHidingEnabled===!0&&Bi("head").append('<style id="'+cr+'">'+SETTINGS.bodyHiddenStyle+"</style>").one("show:body",F)}function B(){Bi("head").trigger("show:body")}function U(e){Bi("head").one("ready:dom",e)}function G(){Bi("head").trigger("ready:dom")}function W(e,t){return{parseUri:r,getPageParameters:o,getPageParameter:i,generateId:h,buildDynamicContentUrl:m,getParametersFromArray:l,mergeParameters:p,encode:lr,decode:n,getTargetPageParameters:function(n){var r=t.globalMboxName;return r!==n?{}:d(e.targetPageParams)},getTargetPageParametersAll:function(){return d(e.targetPageParamsAll)},getCookieDomain:function(){return g(e.location.hostname)},delayCallback:function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];e.setTimeout(function(){return t.apply(t,r)},0)},findLastMboxNode:H,isNull:R,isMboxDiv:_,redirect:function(t){e.location.replace(t)}}}function $(e,t){return A(e.documentElement)?e.body[t]:e.documentElement[t]}function V(e,t,n,r){return A(e[n])?$(t,r):e[n]}function X(e,t){return function(){var n={};return n.width=V(e,t,"innerWidth","clientWidth"),n.height=V(e,t,"innerHeight","clientHeight"),n.screenWidth=e.screen.width,n.screenHeight=e.screen.height,n.colorDepth=e.screen.colorDepth,n.timeOffset=-(new Date).getTimezoneOffset(),n}}function Y(e,t,n,r){return function(){var o=r.crossDomain!==tr,i=e(),a={};return a[vr]=i.screenHeight,a[yr]=i.screenWidth,a[gr]=i.colorDepth,a[xr]=i.width,a[Tr]=i.height,a[br]=i.timeOffset,a[Rr]=n,a[_r]=r.version,a[Or]=t.location.hostname,a[Lr]=t.location.href,a[wr]=t.referrer,o&&(a[Sr]=r.crossDomain),a}}function z(e,t){return S(e)?e:t}function K(e,t){var n={status:e};return E(t)&&(n.message=t),n}function J(e){return K(Fr,e)}function Q(e){return K(jr,e)}function Z(e){return I(e)?e:Mr}function ee(e){for(;!R(e)&&!Bi(e).isBody();){if(_(Bi(e)))return e;e=e.parentNode}return null}function te(e){if(-1===e.indexOf(Un))return"";var t=T(e.split(/\s+/),function(e){return-1!==e.indexOf(Un)});return L(t)?"":t[0].replace(Un,"")}function ne(e,t){for(var n,r=Un+t,o=null,i=[t],a=e,u=1,s=void 0;;){if(a=ee(a),R(a))break;if(s=te(a.className),E(s)&&i.push(s),Bi(a).hasClass(r)){o=Wn;break}if(u>Vn){o=$n;break}a=a.parentNode,u+=1}return R(o)?Q():(n=i.reverse().join(" -> "),J(o+" Calls: "+n))}function re(e){return w(e.console)&&I(e.console.log)&&I(e.console.error)}function oe(e,t){var n=e.location.search;return E(t.getPageParameter(n,qr))}function ie(e,t,n){var r={log:Mr,error:Mr};return re(e)&&(r.error=function(){e.console.error.apply(e.console,[].concat.apply([Gr],arguments))},oe(t,n)&&(r.log=function(){e.console.log.apply(e.console,[].concat.apply([Gr],arguments))})),r}function ae(e,t,n){return{name:e,value:t,expiresOn:n}}function ue(e){return lr(e.name)+"#"+lr(e.value)+"#"+e.expiresOn}function se(e){var t=e.split("#");return L(t)||t.length<3?null:isNaN(parseInt(t[2],10))?null:ae(n(t[0]),n(t[1]),+t[2])}function ce(e,t){var n=RegExp("(^|; )"+t+"=([^;]*)").exec(e.cookie);return R(n)?null:n[2]}function le(e){return C(e)?[]:e.split("|")}function fe(e,t){return!t||e.name===$r}function de(e){return e.expiresOn}function pe(e){Math.max.apply(null,v(e,de))}function he(e){return""===e||-1===e.indexOf(".")?"":"; domain="+e}function me(e,t,n){function r(t){var n=ce(e,lr(t)),r=v(le(n),function(e){return se(e)}),o=Math.ceil((new Date).getTime()/1e3),i={},a=T(r,function(e){return w(e)&&o<=e.expiresOn});return y(a,function(e){return i[e.name]=e}),i}function o(t,r){var o=n.crossDomain===er,i=v(r,function(e){return e}),a=T(i,function(e){return fe(e,o)}),u=pe(a),s=v(a,function(e){return ue(e)}),c=[],l=new Date(1e3*u);c.push(Vr,"=",s.join("|")),c.push("; expires=",l.toGMTString()),c.push("; path=/",t),e.cookie=c.join("")}var i=he(t.getCookieDomain()),a={isEnabled:function(){var e=Math.ceil(60+(new Date).getTime()/1e3),t=r(Vr);return t[Wr]=ae(Wr,"true",e),o(i,t),t=r(Vr),w(t[Wr])&&"true"===t[Wr].value},setCookie:function(e,t,n){if(!C(e)&&!C(t)&&S(n)){var a=r(Vr),u=Math.ceil(n+(new Date).getTime()/1e3);a[e]=ae(e,t,u),o(i,a)}},getCookie:function(e){var t=r(Vr),n=t[e];return w(n)?n:null}};return a}function ge(e){var t=e.getCookie(Xr);return w(t)&&E(t.value)?t.value:""}function ve(e,t,n){e.setCookie(Xr,t,n)}function ye(e,t){var n=t.profileLifetime/1e3,r=ge(e);return E(r)&&ve(e,r,n),{getId:function(){return r},setId:function(t){r=t,ve(e,t,n)}}}function Te(e){var t=e.getCookie(Yr);return w(t)&&E(t.value)?t.value:""}function be(e,t){return t.getPageParameter(e.location.search,Dr)}function xe(e,t,n){e.setCookie(Yr,t,n)}function Ee(e,t,n,r){var o=r.sessionLifetime/1e3,i=be(e,n);return i=i||Te(t)||n.generateId(),xe(t,i,o),{getId:function(){return i},setId:function(e){return i=e,xe(t,i,o)}}}function Ce(e){return e.replace(/"/g,"&quot;").replace(/>/g,"&gt;")}function Ne(e){return"file:"===e.location.protocol?"http://":e.location.protocol+"//"}function Se(e){return Xn.replace("{clientCode}",e)}function Ae(e,t,n){return Ne(e)+t+Se(n)+"?"}function Oe(e){if(zr.exec(e))throw Error('Parameter "'+e+'" contains invalid characters.')}function Ie(){var e=new Date;return e.getTime()-e.getTimezoneOffset()*Bn}function Re(e,t,n){var r=E(e)&&(N(t)||S(t)||E(t));r&&(e+="",t+="",Oe(e),n[e]=t)}function De(e,t,n,r,o,i){function a(e,t){y(e,function(e,n){return Re(n,e,t)})}function u(e){var i,u={},l=t();return a(l,c),a(o.getTargetPageParametersAll(),c),Re(Dr,n.getId(),c),Re(kr,r.getId(),c),Re(Pr,Ie(),c),y(c,function(e,t){return u[t]=e}),w(e)&&y(e,function(e,t){return Re(t,e,u)}),i=v(u,function(e,t){return o.encode(t)+"="+o.encode(e)}),Ce(s+i.join("&"))}var s=Ae(e,i.serverDomain,i.clientCode),c={},l={buildUrl:u};return l}function we(e){var t={};return y(e.params,function(e){A(t[e.type])&&(t[e.type]={}),t[e.type][e.name]=e.defaultValue}),t}function Pe(e){var t=[];return A(e.request)||(t=e.request),t}function ke(e){return-1!==e.indexOf("mbox")}function Le(e){var t={};return A(e.mbox)||y(e.mbox,function(e,n){ke(n)||(t[n]=e)}),t}function _e(e,t,n,r){return{extract:function(o,i){var a=o.offer.content.url,u=we(o.offer.content),s=Pe(u),c=Le(u),l=e.location.search,f=n.getPageParameters(l),d=o.params,p=n.buildDynamicContentUrl(a,s,c,f,d),h=function(){i(Kr)};t.ajax({url:p,timeout:r.timeout,success:i,error:h})}}}function Me(e,t,n,r,o){function i(){var e=R(r.getPageParameter(t.location.search,Br));return c||(e=e&&n.isEnabled()),e&&R(n.getCookie($r))}function a(e){return!R(r.getPageParameter(e,Ur))}function u(){return a(t.location.search)||a(t.referrer)}function s(e){return"XMLHttpRequest"in e&&"withCredentials"in new e.XMLHttpRequest}var c=o.crossDomain===er,l=0;return{isEnabled:function(){return i()},isMboxEdit:function(){return u()},isCorsSupported:function(){return s(e)},requests:{incrementAndGet:function(){return++l}}}}function je(){function e(e){return n[e]}function t(e){return O(n[e])}var n={};return{add:function(e,r){return t(e)?void n[e].push(r):void(n[e]=[r])},getKeys:function(){return v(n,function(e,t){return t})},findAll:function(){var e={};return y(n,function(t,n){return e[n]=t}),e},remove:function(e,t){if(I(t)){var r=T(this.findByKey(e),function(e){return!t(e)});n[e]=r}else delete n[e]},clear:function(){n={}},findByKey:function(t){var n=e(t);return O(n)?n:[]}}}function He(e,t,n,r){function o(){var e=void 0;return A(t.Visitor)?null:R(t.Visitor)?null:(I(t.Visitor.getInstance)&&(e=t.Visitor.getInstance(l)),w(e)&&I(e.isAllowed)&&e.isAllowed()?e:null)}function i(t,n,r){var o=e.Deferred();return I(t[n])?(t[n](function(e){o.resolve({key:r,value:e})},!0),o.promise()):(o.resolve(void 0),o.promise())}function a(t){var n=[i(t,"getMarketingCloudVisitorID",hr),i(t,"getAudienceManagerBlob",dr),i(t,"getAnalyticsVisitorID",fr),i(t,"getAudienceManagerLocationHint",pr)];return e.when.apply(e,n)}function u(e){var t={},n=T(e,function(e){return!A(e)});return y(n,function(e){return t[e.key]=e.value}),t}function s(e,r){return w(e)?(A(e.loadTimeout)||(e.loadTimeout=d),n.log(Jr,"requests sent"),void a(e).done(function(){var e,t,o,i;for(e=arguments.length,t=Array(e),o=0;e>o;o++)t[o]=arguments[o];i=u(t),n.log(Jr,"success",i),r(i)})):void t.setTimeout(function(){return r({})},0)}function c(e,t){return R(e)?"":I(e.getSupplementalDataID)?e.getSupplementalDataID("mbox:"+f+":"+t):""}var l=r.imsOrgId,f=r.clientCode,d=r.visitorApiTimeout;return{getParameters:function(e){s(o(),e)},generateSupplementalDataId:function(e){return c(o(),e)}}}function Fe(e,t,n){var r={name:e,valid:function(n){return t(n[e])}};return E(n)&&(r.message=n),r}function qe(e,t){return{message:t,valid:function(t){return e(t)}}}function Be(e){return'missing mandatory parameter: "'+e+'"'}function Ue(e,t){var n,r,o="";for(n=0;n<t.length;n+=1)if(r=t[n],!r.valid(e)){o=r.message;break}return C(o)?Q():J(o)}function Ge(e){return E(e)&&!b(e,Yn)}function We(e,t,n,r){function o(e){var t=Q();return y(xo,function(n){var r=n.valid(e);r.status===Fr&&t.status===jr&&(t=r)}),t}return function(i){var a,u,s={},c=t(i,po);return c.status===Fr?void n.error(eo,c.message):(i.type=i.type||ho.JSON,c=o(i),c.status===Fr?void n.error(c.message):(a=i.type.toLowerCase(),u=z(i.timeout,r.timeout),a===ho.JSON&&(s.xhrFields={withCredentials:!0}),a===ho.JSONP&&E(i.jsonp)&&(s.jsonp=i.jsonp),E(i.method)&&(s.method=i.method),w(i.params)&&(s.data=i.params),s.timeout=u,s.dataType=a,s.url=i.url,s.success=function(e,t){n.log(eo,"success:",t),i.success(e)},s.error=function(e,t,r){n.error(eo,"error:",t,r),i.error(t)},n.log(eo,"params:",i),void e.ajax(s)))}}function $e(e,t,n){function r(r){var o={url:t.buildUrl(r.params),timeout:r.timeout,error:r.error,success:r.success};e.isCorsSupported()||(o.type=ho.JSONP,o.jsonp=Er),n(o)}return{fetch:r}}function Ve(e,t){return e.generateSupplementalDataId(t)}function Xe(e,t){return{fetch:function(n){t.getParameters(function(r){n.params[mr]=Ve(t,n.params[Ir]),y(r,function(e,t){return n.params[t]=e}),e.fetch(n)})}}}function Ye(e,t,n,r){return{fetch:function(o){var i=z(o.timeout,r.timeout),a=Z(o.error),u=Z(o.success),s=w(o.params)?o.params:{};s[Rr]=t.generateId(),n.log(Eo,"request params:",s),e.fetch({params:s,timeout:i,success:function(e){try{n.log(Eo,"success:",e),u()}catch(t){n.error(Eo,"error:",t),a(Fr,t.message)}},error:function(e,t){n.error(Eo,"error:",e,t),a(e,t)}})}}}function ze(e){return{eventType:"click",tagName:"a",valid:function(t){return!P(t)||C(t.href)?J(Co):w(e)&&w(e.location)?Q():J(No)},getAction:function(t){return function(){e.location.href=t.href}}}}function Ke(){return{eventType:"submit",tagName:"form",valid:function(){return Q()},getAction:function(e){return function(t){e.submit()}}}}function Je(e,t){var n,r,o=E(e)&&E(t);return o?(n=Do[e],A(n)?J(Io.replace("{0}",e)):(r=T(n,function(e){return e===t}),L(r)?J(Ao.replace("{0}",t).replace("{1}",e)):Q())):J(Oo)}function Qe(e){Do[e.tagName]=[e.eventType],Ro[e.tagName]=e}function Ze(e){return Ro[e]}function et(e,t){Qe(Ke()),Qe(ze(e));var n={build:function(e,n){var r,o,i,a;return k(e)?(t.log(So,Hr+": no element."),Mr):(r=e.tagName.toLowerCase(),o=Je(r,n),o.status===Fr?(t.log(So,Hr+": "+o.message),Mr):(i=Ze(r),a=i.valid(e),a.status===Fr?(t.log(So,Hr+": "+a.message),Mr):i.getAction(e)))}};return n}function tt(e){var t,n,r;return e.is("script")?(t=e.html().replace(/[\t\r\n\f]/g,""),n=/mboxCreate\s*\(["|'](\w*)["|']/.exec(t),r=!R(n)&&!L(n)&&E(n[1]),r?n[1]:null):null}function nt(e){var t,n=tt(e);return R(n)?Q():(t=e.prev(),t.is(wo)?(t.addClass(Un+n),Q()):J(Po))}function rt(e,t){var n=Bi(t),r=function(t,n){return e.after(n)};n.filter("script").each(r),n.find("script").each(r),ot(e,n.not("script"))}function ot(e,t){e.append(t)}function it(e,t){var n=Bi("<div></div>").append(t),r=n.find(jo);n.remove(),e.append(r)}function at(e){return e.isHeadOrBody()?e.isHead()?it:e.isBody()?ot:void 0:rt}function ut(e,t,n){function r(e,t){e.append(t[Lo.CONTENT])}function o(e,t){return e.isBody()?void e.prepend(t[Lo.CONTENT]):void e.append(t[Lo.CONTENT])}function i(e,t){e.prepend(t[Lo.CONTENT])}function a(e,t){e.before(t[Lo.CONTENT])}function u(e,t){e.after(t[Lo.CONTENT])}function s(e,t){e.before(t[Lo.CONTENT]),e.remove()}function c(e,t){e.css(t[Lo.CONTENT])}function l(e,t){var n=t[Lo.CONTENT];t[Lo.CONTENT_TYPE]===Mo.TEXT?e.text(n):e.html(n)}function f(e,t){Bi.each(t.content,function(t,n){e.attr(t,n)})}function d(e,t){t[Lo.PRIORITY]&&Bi.isFunction(e[0].style.setProperty)?e.each(function(e,n){n.style.setProperty(t[Lo.PROPERTY],t[Lo.VALUE],t[Lo.PRIORITY])}):e.css(t[Lo.PROPERTY],t[Lo.VALUE])}function p(e){e.remove()}function h(e,n){t({element:e,clickToken:n[Lo.CLICK_TRACK_ID]})}function m(e,t){var n=t[Lo.FROM],r=t[Lo.TO],o=e.children(),i=o.eq(n),a=o.eq(r);return i.exists()&&a.exists()?void(r>n?a.after(i):a.before(i)):!1}function g(t){e.redirect(t[Lo.URL])}return{getStrategyByAction:function(e){switch(e){case ko.APPEND_CONTENT:return r;case ko.CUSTOM_CODE:return o;case ko.INSERT_AFTER:return u;case ko.INSERT_BEFORE:return a;case ko.MOVE:return c;case ko.SET_CONTENT:return l;case ko.SET_ATTRIBUTE:return f;case ko.SET_STYLE:return d;case ko.PREPEND_CONTENT:return i;case ko.RESIZE:return c;case ko.REMOVE:return p;case ko.REARRANGE:return m;case ko.REDIRECT:return g;case ko.REPLACE_CONTENT:return s;case ko.TRACK_CLICK:return h;default:return n.error("Unknown action:",e),function(){}}}}}function st(e){var t=tt(e),n=!R(t);return n&&e.data("mbox-name",t),n}function ct(e){_(e)&&e.showElement()}function lt(e,t){function n(n,r){var o,i,a,u=e("<div></div>");return u.append(r),o=u.find("script"),i=o.filter(function(t,n){return st(e(n))}),a=i.filter(function(t,r){var o=ne(n,e(r).data("mbox-name"));return e(r).data("mbox-error",o.message),o.status===Fr}),a.addClass("disposable").each(function(n,r){ct(e(r).prev()),t.error(e(r).data("mbox-error"))}).remove(),o.not(".disposable").each(function(t,n){return nt(e(n))}),u.html()}return function(t,r){var o=e(t);o.isHead()?at(o)(o,r):o.html(n(t,r))}}function ft(e){return function(t,n){if(O(n)){var r=at(e(t));e.each(n,function(n,o){return r(e(t),o)})}}}function dt(){return{build:function(e){var t={};return t[Ir]=e.name+Zn,t[Cr]=e.clickToken,t}}}function pt(e,t,n){return function(r){var o,i=n.build(r);e.isEmptyObject(i)||(o=r.element,e(o).on("click",function(){return t.fetch({params:i})}))}}function ht(e){return E(e.clickToken)}function mt(e,t,n,r){return{handle:function(o){var i,a,u=o.name,s=o.element,c=o.content,l=o.plugins;t(s,c),n(s,l),i=e(s),i.isHeadOrBody()||(ht(o)&&(a=o.clickToken,r({name:u,element:s,clickToken:a})),i.showElement())}}}function gt(e,t,n){function r(e){var t=void 0;return O(e)&&(t=T(e,function(e){return w(e)&&"default"===e.type})[0]),t}function o(o){var i,a,u,s=o.element;return k(s)?!1:(i=r(o.offers),w(i)?(t(s,i.plugins),ht(i)&&(a=o.name,u=i.clickToken,n({name:a,element:s,clickToken:u})),e(s).showElement(),!1):(e(s).showElement(),!1))}return{handle:o}}function vt(e){return T(e,function(e){return"html"===e.type})[0]}function yt(e){return{handle:function(t){var n,r,o,i,a,u=t.element;return k(u)||!O(t.offers)?!0:(n=vt(t.offers),w(n)?(r=t.name,o=n.plugins,i=n.content,a=n.clickToken,e.handle({name:r,element:u,content:i,plugins:o,clickToken:a}),!1):!0)}}}function Tt(e){return T(e,function(e){return"redirect"===e.type})[0]}function bt(e,t){return{handle:function(n){if(R(n.element)||!O(n.offers))return!0;var r=Tt(n.offers);return w(r)?(t(n.element,r.plugins),e.redirect(r.content),!1):!0}}}function xt(e,t){var n=void 0;return{end:t,start:function(){n=new Date},isUp:function(){var t,r;return A(n)?!1:(t=new Date,r=t-n,r>e)}}}function Et(e,t){function n(){return I(t.requestAnimationFrame)?function(e){t.requestAnimationFrame(e)}:function(e){t.setTimeout(e,Ho)}}function r(){d=!0}function o(t,n){var r=!0;return y(t,function(t){var o=e(t),i=n[t].state();i===Fo.PENDING&&(r=!1),o.exists()&&n[t].resolve(o)}),r}function i(t){var n=!1,r=e(t.selector);return r.exists()&&(t.applyTo(r),n=!0),n}function a(e,t){var n=T(e,function(e){return!i(e)});t(n)}function u(e,t){function n(e){var t,o;return L(e)||r.isUp()?void r.end(e):(t=e[0],o=e.slice(1),void function a(t){var u=i(t);return u?void n(o):r.isUp()?void r.end(e):void p(function(){a(t)})}(t))}var r=xt(SETTINGS.pollingAfterDomReadyTimeout,function(e){a(e,t)});d?r.start():U(function(){r.start()}),n(e)}function s(t){var n={};return y(t,function(t){return n[t]=e.Deferred()}),n}function c(e){var t={};return y(e,function(e,n){return t[n]=e.promise()}),t}function l(e,t){y(e,function(e){var n=t[e].state();n===Fo.PENDING&&t[e].reject(e)})}function f(e){var t=s(e),n=c(t);return function r(){var n=o(e,t);if(!n)return d?void l(e,t):void p(r)}(),n}var d=!1,p=n(),h={resolve:f,sequentialResolve:u};return U(r),e(G),h}function Ct(e){return{build:function(t){if(!ht(t))return{};var n={};return n[Ir]=e.globalMboxName+Zn,n[Nr]=t.clickToken,n}}}function Nt(e,t,n){if(!w(e)||L(t))return!1;var r=T(t,function(t){return n(e[t])});return L(r)}function St(e,t){return Nt(e,t,function(e){return C(e)})}function At(e,t){return Nt(e,t,function(e){return!S(e)})}function Ot(e){return St(e,[Lo.SELECTOR,Lo.ACTION])}function It(e){return St(e,[Lo.ACTION])}function Rt(e){return St(e,[Lo.CONTENT])}function Dt(e){return St(e,[Lo.ASSET,Lo.VALUE])}function wt(e){var t={};return t[Lo.ACTION]=e[Lo.ACTION],t}function Pt(e){var t=wt(e);return t[Lo.SELECTOR]=e[Lo.SELECTOR],E(e[Lo.CSS_SELECTOR])&&(t[Lo.CSS_SELECTOR]=e[Lo.CSS_SELECTOR]),t}function kt(e,t){var n=Pt(e),r=T(t,function(t){return!A(e[t])});return y(r,function(t){return n[t]=e[t]}),n}function Lt(e,t){return{build:function(n){var r,o,i=wt(n),s=n[Lo.URL];return N(n[Lo.INCLUDE_ALL_URL_PARAMETERS])&&n[Lo.INCLUDE_ALL_URL_PARAMETERS]&&(r=u(e.location.search.substring(1)),s=a(s,r)),N(n[Lo.PASS_MBOX_SESSION])&&n[Lo.PASS_MBOX_SESSION]&&(o=t.getId(),s=a(s,{mboxSession:o})),i[Lo.URL]=s,i},valid:function(e){return St(e,[Lo.ACTION,Lo.URL])&&M(e[Lo.URL])}}}function _t(){return{build:function(e){return kt(e,[Lo.CLICK_TRACK_ID])},valid:function(e){return Ot(e)&&St(e,[Lo.CLICK_TRACK_ID])}}}function Mt(){return{build:function(e){return kt(e,[Lo.FROM,Lo.TO])},valid:function(e){return Ot(e)&&At(e,[Lo.FROM,Lo.TO])}}}function jt(){return{build:function(e){return Pt(e)},valid:function(e){return Ot(e)}}}function Ht(){return{build:function(e){var t=Pt(e);return t[Lo.CONTENT]={height:e[Lo.FINAL_HEIGHT],width:e[Lo.FINAL_WIDTH]},t},valid:function(e){return Ot(e)&&St(e,[Lo.FINAL_HEIGHT,Lo.FINAL_WIDTH])}}}function Ft(){return{build:function(e){var t=Pt(e),n=[Lo.PROPERTY,Lo.VALUE,Lo.SELECTOR];return y(n.concat(),function(n){return t[n]=e[n]}),e[Lo.PRIORITY]===_o.IMPORTANT&&(t[Lo.PRIORITY]=e[Lo.PRIORITY]),t},valid:function(e){return Ot(e)&&St(e,[Lo.PROPERTY,Lo.VALUE])}}}function qt(){return{build:function(e){var t=Pt(e),n=Mo.HTML;return e[Lo.CONTENT_TYPE]===Mo.TEXT&&(n=Mo.TEXT),t[Lo.CONTENT_TYPE]=n,t[Lo.CONTENT]=e[Lo.CONTENT],t},valid:function(e){return Ot(e)&&Rt(e)}}}function Bt(){return{build:function(e){var t,n={},r=e[Lo.ATTRIBUTE],o=e[Lo.VALUE];return n[r]=o,t=Pt(e),t[Lo.CONTENT]=n,t},valid:function(e){return Ot(e)&&St(e,[Lo.ATTRIBUTE,Lo.VALUE])}}}function Ut(){return{build:function(e){var t=Pt(e),n={left:e[Lo.FINAL_LEFT_POSITION],top:e[Lo.FINAL_TOP_POSITION]};return E(e[Lo.POSITION])&&(n.position=e[Lo.POSITION]),t[Lo.CONTENT]=n,t},valid:function(e){return Ot(e)&&At(e,[Lo.FINAL_LEFT_POSITION,Lo.FINAL_TOP_POSITION])}}}function Gt(){return{build:function(e){var t={};return t[Lo.ACTION]=e[Lo.ACTION],t[Lo.CONTENT]=e[Lo.CONTENT],E(e[Lo.SELECTOR])?t[Lo.SELECTOR]=e[Lo.SELECTOR]:t[Lo.SELECTOR]="head",t},valid:function(e){return It(e)&&Rt(e)}}}function Wt(){return{build:function(e){var t=kt(e,[Lo.CONTENT]);return t},valid:function(e){return Ot(e)&&Rt(e)}}}function $t(){return{build:function(e){var t=kt(e,[Lo.CONTENT]);return Dt(e)&&(t[Lo.CONTENT]='<img src="'+e[Lo.VALUE]+'" />'),t},valid:function(e){return Ot(e)&&(Dt(e)||Rt(e))}}}function Vt(e,t){var n={},r=$t(),o=Wt();return n[ko.APPEND_CONTENT]=o,n[ko.CUSTOM_CODE]=Gt(),n[ko.INSERT_AFTER]=r,n[ko.INSERT_BEFORE]=r,n[ko.MOVE]=Ut(),n[ko.SET_ATTRIBUTE]=Bt(),n[ko.SET_CONTENT]=qt(),n[ko.SET_STYLE]=Ft(),n[ko.RESIZE]=Ht(),n[ko.PREPEND_CONTENT]=o,n[ko.REMOVE]=jt(),n[ko.REARRANGE]=Mt(),n[ko.REPLACE_CONTENT]=o,n[ko.TRACK_CLICK]=_t(),n[ko.REDIRECT]=Lt(e,t),n}function Xt(e,t){function n(e){var n=[],r=T(e,function(e){return It(e)});return y(r,function(e){var r=e[Lo.ACTION],o=t[r];o.valid(e)&&n.push(o.build(e))}),n}return{transform:n,isSupported:function(e){return w(t[e[Lo.ACTION]])}}}function Yt(e){return T(e,function(e){return"actions"===e.type})}function zt(e){var t=[];return y(e,function(e){return t.push.apply(t,e.content)}),t}function Kt(e){var t=[];return y(e,function(e){t.push.apply(t,e.plugins)}),t}function Jt(e,t,n,r,o,i,a){function u(e){var t=v(e,function(e){return e.selector});i.error(qo,t.join(","))}function s(e){return{selector:e[Lo.SELECTOR],applyTo:function(t){r.getStrategyByAction(e.action)(t,e),(e.action!==ko.SET_STYLE||"visibility"!==e[Lo.PROPERTY])&&t.showElement(),i.log(Bo,JSON.stringify(e))}}}function c(e,t){return T(e,function(e){return t(e)})}function l(e){return c(e,function(e){return!n.isSupported(e)})}function f(e){return c(e,n.isSupported)}function d(e,t){var n,r=[];return y(t,function(e){A(m[e])&&(m[e]=!0,r.push(e))}),L(r)?"":(n=r.join(","),'<style id="'+e+'">'+n+" {"+a.defaultContentHiddenStyle+"}</style>")}function p(e){var t=f(e);return n.transform(t)}var m={},g={handle:function(n){var a,c,f,m,g,b,x,C,N,S,A,O,I,R=Yt(n.offers);return L(R)?!0:(a="atjs-"+h(),c=zt(R),f=T(c,function(e){return e[Lo.ACTION]===ko.REDIRECT}),m=p(f),w(m[0])?(g=m[0],b=r.getStrategyByAction(ko.REDIRECT),b(g),!0):(x=Kt(R),C=[],N=e("head"),S=at(N),A=p(c),y(A,function(e){e.action!==ko.TRACK_CLICK&&E(e[Lo.CSS_SELECTOR])&&C.push(e[Lo.CSS_SELECTOR])}),S(N,d(a,C)),B(),O=v(A,s),o.sequentialResolve(O,function(n){e("#"+a).remove(),L(n)||u(n),t(N[0],x)}),I=l(c),y(I,function(e){return i.log("unsupported offer",e)}),!0))}};return g}function Qt(e){return"dynamic"===e.type}function Zt(e){return T(e,function(e){return Qt(e)})[0]}function en(e,t){return{handle:function(n){var r,o,i,a,u,s=n.element;return k(s)||!O(n.offers)?!0:(r=Zt(n.offers),w(r)?(o=n.name,i=n.params,a=r.plugins,u=r.clickToken,e.extract({offer:r,params:i},function(e){C(e)||t.handle({name:o,element:s,content:e,plugins:a,clickToken:u})}),!1):!0)}}}function tn(e){return O(e.plugins)}function nn(e){return A(e.actions)&&A(e.dynamic)&&A(e.html)&&A(e.redirect)}function rn(e){return O(e.actions)&&!L(e.actions)}function on(e){return w(e.dynamic)&&E(e.dynamic.url)}function an(e){return E(e.html)}function un(e){return E(e.redirect)}function sn(e){var t={type:"redirect",content:e.redirect};return hn(t,e),t}function cn(e){var t={type:"html",content:e.html};return pn(t,e),hn(t,e),t}function ln(e){var t={type:"dynamic",content:e.dynamic};return pn(t,e),hn(t,e),t}function fn(e){var t={type:"default"};return pn(t,e),hn(t,e),t}function dn(e){var t={type:"actions",content:e.actions};return hn(t,e),t}function pn(e,t){ht(t)&&(e.clickToken=t.clickToken)}function hn(e,t){tn(t)&&(e.plugins=t.plugins)}function mn(e,t,n){var r=T(e,function(e){return t(e)});return v(r,function(e){return n(e)})}function gn(e){var t=mn(e,un,sn),n=mn(e,an,cn),r=mn(e,on,ln),o=mn(e,rn,dn),i=mn(e,nn,fn);return[].concat(t,n,r,i,o)}function vn(){return{extract:function(e){var t=e.offers;return O(t)?gn(t):[]}}}function yn(e,t){return{process:function(n,r,o,i){var a,u,s,c=e.extract(i),l=t.length;for(a=0;l>a&&(u=t[a],s=u.handle({name:n,params:r,element:o,offers:c}),s);a++);}}}function Tn(){return{handle:function(e){var t=e.content;return E(t)?J(t):Q()}}}function bn(e){var t=e.duration;return S(t)?t:Qn}function xn(e){var t=e.message;return E(t)?t:Jn}function En(e){return{handle:function(t){var n,r,o=t.content;return w(o)?(n=xn(o),r=bn(o),e.setCookie($r,n,r),J(n)):Q()}}}function Cn(e){return{handle:function(t){var n=t.content;return E(n)&&e.setId(n),Q()}}}function Nn(e){return{handle:function(t){var n=t.content;return E(n)&&e.setId(n),Q()}}}function Sn(e){function t(t,n,r){var o=e[n],i=r[n];return w(o)?o.handle({name:t,content:i}):Q()}return{process:function(e,n){var r,o,i;return A(n.offers)?B():(r=T(n.offers,function(e){return rn(e)}),L(r)&&B()),o=v(n,function(r,o){return t(e,o,n)}),i=T(o,function(e){return Fr===e.status}),L(i)?Q():i[0]}}}function An(e){return!(P(e.element)&&E(e.selector))}function On(e,t,n,r){return function(o){var i,a,u=n(o,$o);return u.status===Fr?void r.error(Uo,u.message):(i=e(o.element||o.selector||"head"),a=o.offer,void i.each(function(e,n){var r,o,i;for(r=0;r<t.length&&(o=t[r],i=o.handle({element:n,offers:a}),i);r++);}))}}function In(e){return!Qt(e)}function Rn(e,t,n,r,o,i,a,u,s,c){function l(e){return T(e,function(e){return Qt(e)})[0]}function f(e){return T(e,function(e){return In(e)})}function d(e,t,n,a,u){var c,d,p,h=r.process(e,t);return Fr===h.status?(s.error(Xo,"error:",t),void u(Fr,h.message)):(c=o.extract(t),d=l(c),p=f(c),w(d)?(s.log(Xo,"offer on your site",d),void i.extract({offer:d,params:n},function(e){return C(e)?(s.error(Xo,"offer on your site content could not be retrieved"),void a(p)):(d.type="html",d.content=e,p.push(d),void a(p))})):void a(c))}function p(e){var t=e.error;s.log(Xo,Hr+":",Kn),u.delayCallback(t,Hr,Kn)}return function(e){var r,o,i,l,f,h=a(e,Vo);return h.status===Fr?void s.error(Xo,h.message):t.isEnabled()?(r=e.mbox,o=z(e.timeout,c.timeout),i=e.error,l=e.success,f=w(e.params)?e.params:{},f[Ir]=r,f[Ar]=t.requests.incrementAndGet(),s.log(Xo,"params:",f),void n.fetch({params:u.mergeParameters(u.getTargetPageParameters(r),f),timeout:o,success:function(e){try{s.log(Xo,"success:",e),d(r,e,f,l,i)}catch(t){s.error(Xo,"error:",t),i(Fr,t.message)}},error:function(e,t){s.error(Xo,"error:",e,t),i(e,t)}})):void p(e)}}function Dn(e,t,n){t.log(zo,"warning:",Kn),I(n.error)&&e.delayCallback(n.error,Hr,Kn)}function wn(e,t,n,r){return r?e.build(t,n):Mr}function Pn(e,t,n,r){var o=t.mbox,i=Z(t.error),a=Z(t.success),u=w(t.params)?t.params:{};u[Ir]=o,e.fetch({timeout:r,params:u,success:function(){a(),n()},error:function(){i(),n()}})}function kn(e,t){w(e)&&I(e.preventDefault)&&t&&e.preventDefault()}function Ln(e,t,n,r,o){var i=r.type,a=r.selector,u=!!r.preventDefault;e(a).each(function(a,s){var c=wn(n,s,i,u);e(s).on(i,function(e){kn(e,u),Pn(t,r,c,o)})})}function _n(e,t,n,r,o){var i=!!n.preventDefault,a=r.currentTarget,u=r.type,s=wn(t,a,u,i);kn(r,i),Pn(e,n,s,o)}function Mn(e,t,n,r,o,i,a,u,s){return function(c){var l,f,d,p,h,m,g=i(c,Yo);return g.status===Fr?void u.error(zo,g.message):e.isEnabled()?(l=c.type,f=E(l),d=c.selector,p=E(d),h=z(c.timeout,s.timeout),f&&p?void Ln(n,r,o,c,h):(m=t.event,w(m)?void _n(r,o,c,m,h):void Pn(r,c,Mr,h))):void Dn(a,u,c)}}function jn(e,t,n){return e[Ir]=t,e[Ar]=n,e}function Hn(e,t,n,r,o,i,a,u,s,c){function l(){return"<style>."+Gn+" {"+c.defaultContentHiddenStyle+"}</style>"}function f(e,t,r){n.fetch({params:t,timeout:c.timeout,success:function(n){try{var a=o.process(e,n);if(a.status===Fr)return s.error(Jo,"request error:",n),void r.showElement();i.process(e,t,r[0],n),s.log(Jo,"request success:",n)}catch(u){s.error(Jo,"request error:",u),r.showElement()}},error:function(e,t){s.error(Jo,"request error:",e,t),r.showElement()}})}function d(){e.isEnabled()&&r("head").append(l())}function p(n,o){var i,c,l,f,d,p;if(e.isEnabled()||e.isMboxEdit()){if(C(n))return void s.error(Jo,"DOM node ID not provided for mbox: ",o);if(i=r("#"+n),!i.exists())return void s.error(Jo,"DOM node not found for mbox: ",o);for(i.addClass(Un+o),c=arguments.length,l=Array(c>2?c-2:0),f=2;c>f;f++)l[f-2]=arguments[f];if(d=u.getParametersFromArray(l),p=a(o,Ko),p.status===Fr)return void s.error(Jo,p.message);jn(d,o,e.requests.incrementAndGet()),t.add(o,{name:o,params:d,node:i}),s.log(Jo,"create mbox, params: ",d)}}function h(n){var o,i,c,l,d;for(o=arguments.length,i=Array(o>1?o-1:0),c=1;o>c;c++)i[c-1]=arguments[c];if(e.isEnabled()){if(l=a(n,Ko),l.status===Fr)return void s.error(Jo,l.message);d=t.findByKey(n),r(d).each(function(e,t){var r=u.mergeParameters(u.getTargetPageParameters(n),u.getParametersFromArray(i));r=u.mergeParameters(t.params,r),s.log(Jo,"execute mbox request, params: ",r),f(n,r,t.node)})}}function m(n){var r,o,i,c,l,d;if(e.isEnabled()||e.isMboxEdit()){if(r=a(n,Ko),r.status===Fr)return void s.error(Jo,r.value);if(o=u.findLastMboxNode(n),!o.exists())return void s.error(Jo,"DOM node not found for mbox: ",n);for(o.addClass(Un+n),i=arguments.length,c=Array(i>1?i-1:0),l=1;i>l;l++)c[l-1]=arguments[l];d=u.mergeParameters(u.getTargetPageParameters(n),u.getParametersFromArray(c)),jn(d,n,e.requests.incrementAndGet()),t.add(n,{name:n,params:d,node:o}),s.log(Jo,"create mbox and execute mbox request, params: ",d),e.isEnabled()&&f(n,d,o)}}return{hideDefaultContent:d,createMbox:p,fetchAndDisplayMbox:h,createFetchAndDisplayMbox:m}}function Fn(e){e.document.addEventListener("click",function(t){I(e._AT.clickHandlerForExperienceEditor)&&e._AT.clickHandlerForExperienceEditor(t)},!0)}function qn(e,t,n,r,o){e.isMboxEdit()&&(t._AT=t._AT||{},t._AT.querySelectorAll=n.find,r({url:Qo.experienceEditorUrl,type:ho.SCRIPT,success:function(){return Fn(t)},error:function(){return o.error("Unable to load target-vec.js for experience creation.")}}))}var Bn,Un,Gn,Wn,$n,Vn,Xn,Yn,zn,Kn,Jn,Qn,Zn,er,tr,nr,rr,or,ir,ar,ur,sr,cr,lr,fr,dr,pr,hr,mr,gr,vr,yr,Tr,br,xr,Er,Cr,Nr,Sr,Ar,Or,Ir,Rr,Dr,wr,Pr,kr,Lr,_r,Mr,jr,Hr,Fr,qr,Br,Ur,Gr,Wr,$r,Vr,Xr,Yr,zr,Kr,Jr,Qr,Zr,eo,to,no,ro,oo,io,ao,uo,so,co,lo,fo,po,ho,mo,go,vo,yo,To,bo,xo,Eo,Co,No,So,Ao,Oo,Io,Ro,Do,wo,Po,ko,Lo,_o,Mo,jo,Ho,Fo,qo,Bo,Uo,Go,Wo,$o,Vo,Xo,Yo,zo,Ko,Jo,Qo,Zo,ei,ti,ni,ri,oi,ii,ai,ui,si,ci,li,fi,di,pi,hi,mi,gi,vi,yi,Ti,bi,xi,Ei,Ci,Ni,Si,Ai,Oi,Ii,Ri,Di,wi,Pi,ki,Li,_i,Mi,ji,Hi,Fi,qi="at-element-marker",Bi=function(e,t){return t(e)}("undefined"!=typeof window?window:void 0,function(e){function t(e){var t=!!e&&"length"in e&&e.length,n=Tt.type(e);return"function"===n||Tt.isWindow(e)?!1:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function n(e,t,n){if(Tt.isFunction(t))return Tt.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return Tt.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(U.test(t))return Tt.filter(t,e,n);t=Tt.filter(t,e)}return Tt.grep(e,function(e){return pt.call(t,e)>-1!==n})}function r(){this.expando=Tt.expando+r.uid++}function o(){return!0}function i(){return!1}function a(){try{return ct.activeElement}catch(e){}}function u(e,t,n,r,o,a){var s,c;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(c in t)u(e,c,n,r,t[c],a);return e}if(null==r&&null==o?(o=n,r=n=void 0):null==o&&("string"==typeof n?(o=r,r=void 0):(o=r,r=n,n=void 0)),o===!1)o=i;else if(!o)return e;return 1===a&&(s=o,o=function(e){return Tt().off(e),s.apply(this,arguments)},o.guid=s.guid||(s.guid=Tt.guid++)),e.each(function(){Tt.event.add(this,t,o,r,n)})}function s(e){var t={};return Tt.each(e.match(V)||[],function(e,n){t[n]=!0}),t}function c(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,o=0,i=t.toLowerCase().match(V)||[];if(Tt.isFunction(n))for(;r=i[o++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function l(e,t,n,r){function o(u){var s;return i[u]=!0,Tt.each(e[u]||[],function(e,u){var c=u(t,n,r);return"string"!=typeof c||a||i[c]?a?!(s=c):void 0:(t.dataTypes.unshift(c),o(c),!1)}),s}var i={},a=e===ce;return o(t.dataTypes[0])||!i["*"]&&o("*")}function f(e,t){var n,r,o=Tt.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((o[n]?e:r||(r={}))[n]=t[n]);return r&&Tt.extend(!0,e,r),e}function d(e,t,n){for(var r,o,i,a,u=e.contents,s=e.dataTypes;"*"===s[0];)s.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(o in u)if(u[o]&&u[o].test(r)){s.unshift(o);break}if(s[0]in n)i=s[0];else{for(o in n){if(!s[0]||e.converters[o+" "+s[0]]){i=o;break}a||(a=o)}i=i||a}return i?(i!==s[0]&&s.unshift(i),n[i]):void 0}function p(e,t,n,r){var o,i,a,u,s,c={},l=e.dataTypes.slice();if(l[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(i=l.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!s&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),s=i,i=l.shift())if("*"===i)i=s;else if("*"!==s&&s!==i){if(a=c[s+" "+i]||c["* "+i],!a)for(o in c)if(u=o.split(" "),u[1]===i&&(a=c[s+" "+u[0]]||c["* "+u[0]])){a===!0?a=c[o]:c[o]!==!0&&(i=u[0],l.unshift(u[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(f){return{state:"parsererror",error:a?f:"No conversion from "+s+" to "+i}}}return{state:"success",data:t}}function h(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&Tt.nodeName(e,t)?Tt.merge([e],n):n}function m(e,t){for(var n=0,r=e.length;r>n;n++)J.set(e[n],"globalEval",!t||J.get(t[n],"globalEval"))}function g(e,t,n,r,o){for(var i,a,u,s,c,l,f=t.createDocumentFragment(),d=[],p=0,g=e.length;g>p;p++)if(i=e[p],i||0===i)if("object"===Tt.type(i))Tt.merge(d,i.nodeType?[i]:i);else if(xe.test(i)){for(a=a||f.appendChild(t.createElement("div")),u=(ye.exec(i)||["",""])[1].toLowerCase(),s=be[u]||be._default,a.innerHTML=s[1]+Tt.htmlPrefilter(i)+s[2],l=s[0];l--;)a=a.lastChild;Tt.merge(d,a.childNodes),a=f.firstChild,a.textContent=""}else d.push(t.createTextNode(i));for(f.textContent="",p=0;i=d[p++];)if(r&&Tt.inArray(i,r)>-1)o&&o.push(i);else if(c=Tt.contains(i.ownerDocument,i),a=h(f.appendChild(i),"script"),c&&m(a),n)for(l=0;i=a[l++];)Te.test(i.type||"")&&n.push(i);return f}function v(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function y(e,t){return Tt.nodeName(e,"table")&&Tt.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function T(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function b(e){var t=De.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function x(e,t){var n,r,o,i,a,u,s,c;if(1===t.nodeType){if(J.hasData(e)&&(i=J.access(e),a=J.set(t,i),c=i.events)){delete a.handle,a.events={};for(o in c)for(n=0,r=c[o].length;r>n;n++)Tt.event.add(t,o,c[o][n])}Ee.hasData(e)&&(u=Ee.access(e),s=Tt.extend({},u),Ee.set(t,s))}}function E(e,t){var n=t.nodeName.toLowerCase();"input"===n&&ve.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function C(e,t,n,r){t=ft.apply([],t);var o,i,a,u,s,c,l=0,f=e.length,d=f-1,p=t[0],m=Tt.isFunction(p);if(m||f>1&&"string"==typeof p&&!vt.checkClone&&Re.test(p))return e.each(function(o){var i=e.eq(o);m&&(t[0]=p.call(this,o,i.html())),C(i,t,n,r)});if(f&&(o=g(t,e[0].ownerDocument,!1,e,r),i=o.firstChild,1===o.childNodes.length&&(o=i),i||r)){for(a=Tt.map(h(o,"script"),T),u=a.length;f>l;l++)s=o,l!==d&&(s=Tt.clone(s,!0,!0),u&&Tt.merge(a,h(s,"script"))),n.call(e[l],s,l);if(u)for(c=a[a.length-1].ownerDocument,Tt.map(a,b),l=0;u>l;l++)s=a[l],Te.test(s.type||"")&&!J.access(s,"globalEval")&&Tt.contains(c,s)&&(s.src?Tt._evalUrl&&Tt._evalUrl(s.src):Tt.globalEval(s.textContent.replace(we,"")))}return e}function N(e,t,n){for(var r,o=t?Tt.filter(t,e):e,i=0;null!=(r=o[i]);i++)n||1!==r.nodeType||Tt.cleanData(h(r)),r.parentNode&&(n&&Tt.contains(r.ownerDocument,r)&&m(h(r,"script")),r.parentNode.removeChild(r));return e}function S(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ke,"-$&").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:Pe.test(n)?Tt.parseJSON(n):n}catch(o){}Ee.set(e,t,n)}else n=void 0;return n}function A(e,t,n){var r,o,i,a,u=e.style;return n=n||qe(e),a=n?n.getPropertyValue(t)||n[t]:void 0,""!==a&&void 0!==a||Tt.contains(e.ownerDocument,e)||(a=Tt.style(e,t)),n&&!vt.pixelMarginRight()&&je.test(a)&&_e.test(t)&&(r=u.width,o=u.minWidth,i=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=o,u.maxWidth=i),void 0!==a?a+"":a}function O(e,t,n,r){var o,i=1,a=20,u=r?function(){return r.cur()}:function(){return Tt.css(e,t,"")},s=u(),c=n&&n[3]||(Tt.cssNumber[t]?"":"px"),l=(Tt.cssNumber[t]||"px"!==c&&+s)&&Me.exec(Tt.css(e,t));if(l&&l[3]!==c){c=c||l[3],n=n||[],l=+s||1;do{i=i||".5",l/=i,Tt.style(e,t,l+c)}while(i!==(i=u()/s)&&1!==i&&--a)}return n&&(l=+l||+s||0,o=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=l,r.end=o)),o}function I(e,t){var n=Tt(t.createElement(e)).appendTo(t.body),r=Tt.css(n[0],"display");return n.detach(),r}function R(e){var t=ct,n=We[e];return n||(n=I(e,t),"none"!==n&&n||(Ge=(Ge||Tt("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Ge[0].contentDocument,t.write(),t.close(),n=I(e,t),Ge.detach()),We[e]=n),n}function D(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function w(){ct.removeEventListener("DOMContentLoaded",w),e.removeEventListener("load",w),Tt.ready()}function P(e){if(e in Ke)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=ze.length;n--;)if(e=ze[n]+t,e in Ke)return e}function k(e,t,n){var r=Me.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function L(e,t,n,r,o){for(var i=n===(r?"border":"content")?4:"width"===t?1:0,a=0;4>i;i+=2)"margin"===n&&(a+=Tt.css(e,n+He[i],!0,o)),r?("content"===n&&(a-=Tt.css(e,"padding"+He[i],!0,o)),"margin"!==n&&(a-=Tt.css(e,"border"+He[i]+"Width",!0,o))):(a+=Tt.css(e,"padding"+He[i],!0,o),"padding"!==n&&(a+=Tt.css(e,"border"+He[i]+"Width",!0,o)));return a}function _(t,n,r){var o=!0,i="width"===n?t.offsetWidth:t.offsetHeight,a=qe(t),u="border-box"===Tt.css(t,"boxSizing",!1,a);if(ct.msFullscreenElement&&e.top!==e&&t.getClientRects().length&&(i=Math.round(100*t.getBoundingClientRect()[n])),0>=i||null==i){if(i=A(t,n,a),(0>i||null==i)&&(i=t.style[n]),je.test(i))return i;o=u&&(vt.boxSizingReliable()||i===t.style[n]),i=parseFloat(i)||0}return i+L(t,n,r||(u?"border":"content"),o,a)+"px"}function M(e,t){for(var n,r,o,i=[],a=0,u=e.length;u>a;a++)r=e[a],r.style&&(i[a]=J.get(r,"olddisplay"),n=r.style.display,t?(i[a]||"none"!==n||(r.style.display=""),""===r.style.display&&Fe(r)&&(i[a]=J.access(r,"olddisplay",R(r.nodeName)))):(o=Fe(r),"none"===n&&o||J.set(r,"olddisplay",o?n:Tt.css(r,"display"))));for(a=0;u>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?i[a]||"":"none"));return e}function j(e){return e.getAttribute&&e.getAttribute("class")||""}function H(e,t,n,r){var o;if(Tt.isArray(t))Tt.each(t,function(t,o){n||ot.test(e)?r(e,o):H(e+"["+("object"==typeof o&&null!=o?t:"")+"]",o,n,r)});else if(n||"object"!==Tt.type(t))r(e,t);else for(o in t)H(e+"["+o+"]",t[o],n,r)}var F,q,B,U,G,W,$,V,X,Y,z,K,J,Q,Z,ee,te,ne,re,oe,ie,ae,ue,se,ce,le,fe,de,pe,he,me,ge,ve,ye,Te,be,xe,Ee,Ce,Ne,Se,Ae,Oe,Ie,Re,De,we,Pe,ke,Le,_e,Me,je,He,Fe,qe,Be,Ue,Ge,We,$e,Ve,Xe,Ye,ze,Ke,Je,Qe,Ze,et,tt,nt,rt,ot,it,at,ut,st=[],ct=e.document,lt=st.slice,ft=st.concat,dt=st.push,pt=st.indexOf,ht={},mt=ht.toString,gt=ht.hasOwnProperty,vt={},yt="2.2.2-pre",Tt=function(e,t){return new Tt.fn.init(e,t)},bt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,xt=/^-ms-/,Et=/-([\da-z])/gi,Ct=function(e,t){return t.toUpperCase()};return Tt.fn=Tt.prototype={jquery:yt,constructor:Tt,selector:"",length:0,toArray:function(){return lt.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:lt.call(this)},pushStack:function(e){var t=Tt.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e){return Tt.each(this,e)},map:function(e){return this.pushStack(Tt.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(lt.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:dt,sort:st.sort,splice:st.splice},Tt.extend=Tt.fn.extend=function(){var e,t,n,r,o,i,a=arguments[0]||{},u=1,s=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[u]||{},u++),"object"==typeof a||Tt.isFunction(a)||(a={}),u===s&&(a=this,u--);s>u;u++)if(null!=(e=arguments[u]))for(t in e)n=a[t],r=e[t],a!==r&&(c&&r&&(Tt.isPlainObject(r)||(o=Tt.isArray(r)))?(o?(o=!1,i=n&&Tt.isArray(n)?n:[]):i=n&&Tt.isPlainObject(n)?n:{},a[t]=Tt.extend(c,i,r)):void 0!==r&&(a[t]=r));return a},Tt.extend({expando:"ATJS"+(yt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw Error(e)},noop:function(){},isFunction:function(e){return"function"===Tt.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=e&&""+e;return!Tt.isArray(e)&&t-parseFloat(t)+1>=0},isPlainObject:function(e){var t;if("object"!==Tt.type(e)||e.nodeType||Tt.isWindow(e))return!1;if(e.constructor&&!gt.call(e.constructor.prototype,"isPrototypeOf"))return!1;for(t in e);return void 0===t||gt.call(e,t)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?ht[mt.call(e)]||"object":typeof e},globalEval:function(e){var t,n=eval;e=Tt.trim(e),e&&(1===e.indexOf("use strict")?(t=ct.createElement("script"),t.text=e,ct.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(xt,"ms-").replace(Et,Ct)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n){var r,o=0;if(t(e))for(r=e.length;r>o&&n.call(e[o],o,e[o])!==!1;o++);else for(o in e)if(n.call(e[o],o,e[o])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(bt,"")},makeArray:function(e,n){var r=n||[];return null!=e&&(t(Object(e))?Tt.merge(r,"string"==typeof e?[e]:e):dt.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:pt.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,o=e.length;n>r;r++)e[o++]=t[r];return e.length=o,e},grep:function(e,t,n){for(var r,o=[],i=0,a=e.length,u=!n;a>i;i++)r=!t(e[i],i),r!==u&&o.push(e[i]);return o},map:function(e,n,r){var o,i,a=0,u=[];if(t(e))for(o=e.length;o>a;a++)i=n(e[a],a,r),null!=i&&u.push(i);else for(a in e)i=n(e[a],a,r),null!=i&&u.push(i);return ft.apply([],u)},guid:1,proxy:function Nt(e,t){var n,r,Nt;return"string"==typeof t&&(n=e[t],t=e,e=n),Tt.isFunction(e)?(r=lt.call(arguments,2),Nt=function(){return e.apply(t||this,r.concat(lt.call(arguments)))},Nt.guid=e.guid=e.guid||Tt.guid++,Nt):void 0},now:Date.now,support:vt}),"function"==typeof Symbol&&(Tt.fn[Symbol.iterator]=st[Symbol.iterator]),Tt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){ht["[object "+t+"]"]=t.toLowerCase()}),F=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,q=function(e){function t(e,t,n,r){var o,i,a,u,s,c,f,p,h=t&&t.ownerDocument,m=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==m&&9!==m&&11!==m)return n;if(!r&&((t?t.ownerDocument||t:q)!==P&&w(t),t=t||P,L)){if(11!==m&&(c=ve.exec(e)))if(o=c[1]){if(9===m){if(!(a=t.getElementById(o)))return n;if(a.id===o)return n.push(a),n}else if(h&&(a=h.getElementById(o))&&H(t,a)&&a.id===o)return n.push(a),n}else{if(c[2])return Q.apply(n,t.getElementsByTagName(e)),n;if((o=c[3])&&x.getElementsByClassName&&t.getElementsByClassName)return Q.apply(n,t.getElementsByClassName(o)),n}if(x.qsa&&!$[e+" "]&&(!_||!_.test(e))){if(1!==m)h=t,p=e;else if("object"!==t.nodeName.toLowerCase()){for((u=t.getAttribute("id"))?u=u.replace(Te,"\\$&"):t.setAttribute("id",u=F),f=S(e),i=f.length,s=de.test(u)?"#"+u:"[id='"+u+"']";i--;)f[i]=s+" "+d(f[i]);p=f.join(","),h=ye.test(e)&&l(t.parentNode)||t}if(p)try{return Q.apply(n,h.querySelectorAll(p)),n}catch(g){}finally{u===F&&t.removeAttribute("id")}}}return O(e.replace(ue,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>E.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[F]=!0,e}function o(e){var t=P.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function i(e,t){for(var n=e.split("|"),r=n.length;r--;)E.attrHandle[n[r]]=t}function a(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||X)-(~e.sourceIndex||X);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function u(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function s(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return r(function(t){return t=+t,r(function(n,r){for(var o,i=e([],n.length,t),a=i.length;a--;)n[o=i[a]]&&(n[o]=!(r[o]=n[o]))})})}function l(e){return e&&void 0!==e.getElementsByTagName&&e}function f(){}function d(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function p(e,t,n){var r=t.dir,o=n&&"parentNode"===r,i=U++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i)}:function(t,n,a){var u,s,c,l=[B,i];if(a){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,a))return!0}else for(;t=t[r];)if(1===t.nodeType||o){if(c=t[F]||(t[F]={}),s=c[t.uniqueID]||(c[t.uniqueID]={}),(u=s[r])&&u[0]===B&&u[1]===i)return l[2]=u[2];if(s[r]=l,l[2]=e(t,n,a))return!0}}}function h(e){return e.length>1?function(t,n,r){for(var o=e.length;o--;)if(!e[o](t,n,r))return!1;return!0}:e[0]}function m(e,n,r){for(var o=0,i=n.length;i>o;o++)t(e,n[o],r);return r}function g(e,t,n,r,o){for(var i,a=[],u=0,s=e.length,c=null!=t;s>u;u++)(i=e[u])&&(!n||n(i,r,o))&&(a.push(i),c&&t.push(u));return a}function v(e,t,n,o,i,a){return o&&!o[F]&&(o=v(o)),i&&!i[F]&&(i=v(i,a)),r(function(r,a,u,s){var c,l,f,d=[],p=[],h=a.length,v=r||m(t||"*",u.nodeType?[u]:u,[]),y=!e||!r&&t?v:g(v,d,e,u,s),T=n?i||(r?e:h||o)?[]:a:y;if(n&&n(y,T,u,s),o)for(c=g(T,p),o(c,[],u,s),l=c.length;l--;)(f=c[l])&&(T[p[l]]=!(y[p[l]]=f));if(r){if(i||e){if(i){for(c=[],l=T.length;l--;)(f=T[l])&&c.push(y[l]=f);i(null,T=[],c,s)}for(l=T.length;l--;)(f=T[l])&&(c=i?ee(r,f):d[l])>-1&&(r[c]=!(a[c]=f))}}else T=g(T===a?T.splice(h,T.length):T),i?i(null,a,T,s):Q.apply(a,T)})}function y(e){for(var t,n,r,o=e.length,i=E.relative[e[0].type],a=i||E.relative[" "],u=i?1:0,s=p(function(e){return e===t},a,!0),c=p(function(e){return ee(t,e)>-1},a,!0),l=[function(e,n,r){var o=!i&&(r||n!==I)||((t=n).nodeType?s(e,n,r):c(e,n,r));return t=null,o}];o>u;u++)if(n=E.relative[e[u].type])l=[p(h(l),n)];else{if(n=E.filter[e[u].type].apply(null,e[u].matches),n[F]){for(r=++u;o>r&&!E.relative[e[r].type];r++);return v(u>1&&h(l),u>1&&d(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(ue,"$1"),n,r>u&&y(e.slice(u,r)),o>r&&y(e=e.slice(r)),o>r&&d(e))}l.push(n)}return h(l)}function T(e,n){var o=n.length>0,i=e.length>0,a=function(r,a,u,s,c){var l,f,d,p=0,h="0",m=r&&[],v=[],y=I,T=r||i&&E.find.TAG("*",c),b=B+=null==y?1:Math.random()||.1,x=T.length;for(c&&(I=a===P||a||c);h!==x&&null!=(l=T[h]);h++){if(i&&l){for(f=0,a||l.ownerDocument===P||(w(l),u=!L);d=e[f++];)if(d(l,a||P,u)){s.push(l);break}c&&(B=b)}o&&((l=!d&&l)&&p--,r&&m.push(l))}if(p+=h,o&&h!==p){for(f=0;d=n[f++];)d(m,v,a,u);if(r){if(p>0)for(;h--;)m[h]||v[h]||(v[h]=K.call(s));v=g(v)}Q.apply(s,v),c&&!r&&v.length>0&&p+n.length>1&&t.uniqueSort(s)}return c&&(B=b,I=y),m};return o?r(a):a}var b,x,E,C,N,S,A,O,I,R,D,w,P,k,L,_,M,j,H,F="sizzle"+1*new Date,q=e.document,B=0,U=0,G=n(),W=n(),$=n(),V=function(e,t){return e===t&&(D=!0),0},X=1<<31,Y={}.hasOwnProperty,z=[],K=z.pop,J=z.push,Q=z.push,Z=z.slice,ee=function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",oe="\\["+ne+"*("+re+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ne+"*\\]",ie=":("+re+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+oe+")*)|.*)\\)|)",ae=RegExp(ne+"+","g"),ue=RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),se=RegExp("^"+ne+"*,"+ne+"*"),ce=RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),le=RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),fe=RegExp(ie),de=RegExp("^"+re+"$"),pe={ID:RegExp("^#("+re+")"),CLASS:RegExp("^\\.("+re+")"),TAG:RegExp("^("+re+"|[*])"),ATTR:RegExp("^"+oe),PSEUDO:RegExp("^"+ie),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:RegExp("^(?:"+te+")$","i"),needsContext:RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},he=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ge=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,Te=/'|\\/g,be=RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),xe=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},Ee=function(){w()};try{Q.apply(z=Z.call(q.childNodes),q.childNodes),z[q.childNodes.length].nodeType}catch(Ce){Q={apply:z.length?function(e,t){J.apply(e,Z.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}x=t.support={},N=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},w=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:q;return r!==P&&9===r.nodeType&&r.documentElement?(P=r,k=P.documentElement,L=!N(P),(n=P.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",Ee,!1):n.attachEvent&&n.attachEvent("onunload",Ee)),x.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),x.getElementsByTagName=o(function(e){return e.appendChild(P.createComment("")),!e.getElementsByTagName("*").length}),x.getElementsByClassName=ge.test(P.getElementsByClassName),x.getById=o(function(e){return k.appendChild(e).id=F,!P.getElementsByName||!P.getElementsByName(F).length}),x.getById?(E.find.ID=function(e,t){if(void 0!==t.getElementById&&L){var n=t.getElementById(e);return n?[n]:[]}},E.filter.ID=function(e){var t=e.replace(be,xe);return function(e){return e.getAttribute("id")===t}}):(delete E.find.ID,E.filter.ID=function(e){var t=e.replace(be,xe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),E.find.TAG=x.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):x.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],o=0,i=t.getElementsByTagName(e);if("*"===e){for(;n=i[o++];)1===n.nodeType&&r.push(n);return r}return i},E.find.CLASS=x.getElementsByClassName&&function(e,t){return void 0!==t.getElementsByClassName&&L?t.getElementsByClassName(e):void 0},M=[],_=[],(x.qsa=ge.test(P.querySelectorAll))&&(o(function(e){k.appendChild(e).innerHTML="<a id='"+F+"'></a><select id='"+F+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&_.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||_.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+F+"-]").length||_.push("~="),e.querySelectorAll(":checked").length||_.push(":checked"),e.querySelectorAll("a#"+F+"+*").length||_.push(".#.+[+~]")}),o(function(e){var t=P.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&_.push("name"+ne+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||_.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),_.push(",.*:")})),(x.matchesSelector=ge.test(j=k.matches||k.webkitMatchesSelector||k.mozMatchesSelector||k.oMatchesSelector||k.msMatchesSelector))&&o(function(e){x.disconnectedMatch=j.call(e,"div"),j.call(e,"[s!='']:x"),M.push("!=",ie)}),_=_.length&&RegExp(_.join("|")),M=M.length&&RegExp(M.join("|")),t=ge.test(k.compareDocumentPosition),H=t||ge.test(k.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},V=t?function(e,t){if(e===t)return D=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!x.sortDetached&&t.compareDocumentPosition(e)===n?e===P||e.ownerDocument===q&&H(q,e)?-1:t===P||t.ownerDocument===q&&H(q,t)?1:R?ee(R,e)-ee(R,t):0:4&n?-1:1)}:function(e,t){if(e===t)return D=!0,0;var n,r=0,o=e.parentNode,i=t.parentNode,u=[e],s=[t];if(!o||!i)return e===P?-1:t===P?1:o?-1:i?1:R?ee(R,e)-ee(R,t):0;if(o===i)return a(e,t);for(n=e;n=n.parentNode;)u.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;u[r]===s[r];)r++;return r?a(u[r],s[r]):u[r]===q?-1:s[r]===q?1:0},P):P},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==P&&w(e),n=n.replace(le,"='$1']"),x.matchesSelector&&L&&!$[n+" "]&&(!M||!M.test(n))&&(!_||!_.test(n)))try{var r=j.call(e,n);if(r||x.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(o){}return t(n,P,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==P&&w(e),H(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==P&&w(e);var n=E.attrHandle[t.toLowerCase()],r=n&&Y.call(E.attrHandle,t.toLowerCase())?n(e,t,!L):void 0;return void 0!==r?r:x.attributes||!L?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,o=0;if(D=!x.detectDuplicates,R=!x.sortStable&&e.slice(0),e.sort(V),D){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)e.splice(n[r],1)}return R=null,e},C=t.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=C(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=C(t);return n},E=t.selectors={cacheLength:50,createPseudo:r,match:pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,xe),e[3]=(e[3]||e[4]||e[5]||"").replace(be,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return pe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&fe.test(n)&&(t=S(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,xe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=G[e+" "];return t||(t=RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&G(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(o){var i=t.attr(o,e);return null==i?"!="===n:n?(i+="","="===n?i===r:"!="===n?i!==r:"^="===n?r&&0===i.indexOf(r):"*="===n?r&&i.indexOf(r)>-1:"$="===n?r&&i.slice(-r.length)===r:"~="===n?(" "+i.replace(ae," ")+" ").indexOf(r)>-1:"|="===n?i===r||i.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(e,t,n,r,o){var i="nth"!==e.slice(0,3),a="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===o?function(e){return!!e.parentNode}:function(t,n,s){var c,l,f,d,p,h,m=i!==a?"nextSibling":"previousSibling",g=t.parentNode,v=u&&t.nodeName.toLowerCase(),y=!s&&!u,T=!1;if(g){if(i){for(;m;){for(d=t;d=d[m];)if(u?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;h=m="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?g.firstChild:g.lastChild],a&&y){for(d=g,f=d[F]||(d[F]={}),l=f[d.uniqueID]||(f[d.uniqueID]={}),c=l[e]||[],p=c[0]===B&&c[1],T=p&&c[2],d=p&&g.childNodes[p];d=++p&&d&&d[m]||(T=p=0)||h.pop();)if(1===d.nodeType&&++T&&d===t){l[e]=[B,p,T];break}}else if(y&&(d=t,f=d[F]||(d[F]={}),l=f[d.uniqueID]||(f[d.uniqueID]={}),c=l[e]||[],p=c[0]===B&&c[1],T=p),T===!1)for(;(d=++p&&d&&d[m]||(T=p=0)||h.pop())&&((u?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++T||(y&&(f=d[F]||(d[F]={}),l=f[d.uniqueID]||(f[d.uniqueID]={}),l[e]=[B,T]),d!==t)););return T-=o,T===r||T%r===0&&T/r>=0}}},PSEUDO:function(e,n){var o,i=E.pseudos[e]||E.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return i[F]?i(n):i.length>1?(o=[e,e,"",n],E.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,o=i(e,n),a=o.length;a--;)r=ee(e,o[a]),e[r]=!(t[r]=o[a])}):function(e){return i(e,0,o)}):i}},pseudos:{not:r(function(e){var t=[],n=[],o=A(e.replace(ue,"$1"));return o[F]?r(function(e,t,n,r){for(var i,a=o(e,null,r,[]),u=e.length;u--;)(i=a[u])&&(e[u]=!(t[u]=i))}):function(e,r,i){return t[0]=e,o(t,null,i,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(be,xe),function(t){return(t.textContent||t.innerText||C(t)).indexOf(e)>-1}}),lang:r(function(e){return de.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,xe).toLowerCase(),function(t){var n;do{if(n=L?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===k},focus:function(e){return e===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!E.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return he.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[0>n?n+t:n]}),even:c(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:c(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},E.pseudos.nth=E.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})E.pseudos[b]=u(b);for(b in{submit:!0,reset:!0})E.pseudos[b]=s(b);return f.prototype=E.filters=E.pseudos,E.setFilters=new f,S=t.tokenize=function(e,n){var r,o,i,a,u,s,c,l=W[e+" "];if(l)return n?0:l.slice(0);for(u=e,s=[],c=E.preFilter;u;){(!r||(o=se.exec(u)))&&(o&&(u=u.slice(o[0].length)||u),s.push(i=[])),r=!1,(o=ce.exec(u))&&(r=o.shift(),i.push({value:r,type:o[0].replace(ue," ")}),u=u.slice(r.length));for(a in E.filter)!(o=pe[a].exec(u))||c[a]&&!(o=c[a](o))||(r=o.shift(),i.push({value:r,type:a,matches:o}),u=u.slice(r.length));if(!r)break}return n?u.length:u?t.error(e):W(e,s).slice(0)},A=t.compile=function(e,t){var n,r=[],o=[],i=$[e+" "];if(!i){for(t||(t=S(e)),n=t.length;n--;)i=y(t[n]),i[F]?r.push(i):o.push(i);i=$(e,T(o,r)),i.selector=e}return i},O=t.select=function(e,t,n,r){var o,i,a,u,s,c="function"==typeof e&&e,f=!r&&S(e=c.selector||e);if(n=n||[],1===f.length){if(i=f[0]=f[0].slice(0),i.length>2&&"ID"===(a=i[0]).type&&x.getById&&9===t.nodeType&&L&&E.relative[i[1].type]){if(t=(E.find.ID(a.matches[0].replace(be,xe),t)||[])[0],!t)return n;c&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(o=pe.needsContext.test(e)?0:i.length;o--&&(a=i[o],!E.relative[u=a.type]);)if((s=E.find[u])&&(r=s(a.matches[0].replace(be,xe),ye.test(i[0].type)&&l(t.parentNode)||t))){if(i.splice(o,1),e=r.length&&d(i),!e)return Q.apply(n,r),n;break}}return(c||A(e,f))(r,t,!L,n,!t||ye.test(e)&&l(t.parentNode)||t),n},x.sortStable=F.split("").sort(V).join("")===F,x.detectDuplicates=!!D,w(),x.sortDetached=o(function(e){return 1&e.compareDocumentPosition(P.createElement("div"))}),o(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||i("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),x.attributes&&o(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||i("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),o(function(e){return null==e.getAttribute("disabled")})||i(te,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e),Tt.find=q,Tt.expr=q.selectors,Tt.expr[":"]=Tt.expr.pseudos,Tt.uniqueSort=Tt.unique=q.uniqueSort,Tt.text=q.getText,Tt.isXMLDoc=q.isXML,Tt.contains=q.contains,B=Tt.expr.match.needsContext,U=/^.[^:#\[\.,]*$/,Tt.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?Tt.find.matchesSelector(r,e)?[r]:[]:Tt.find.matches(e,Tt.grep(t,function(e){return 1===e.nodeType}))},Tt.fn.extend({find:function(e){var t,n=this.length,r=[],o=this;if("string"!=typeof e)return this.pushStack(Tt(e).filter(function(){for(t=0;n>t;t++)if(Tt.contains(o[t],this))return!0}));for(t=0;n>t;t++)Tt.find(e,o[t],r);return r=this.pushStack(n>1?Tt.unique(r):r),r.selector=this.selector?this.selector+" "+e:e,r},filter:function(e){return this.pushStack(n(this,e||[],!1))},not:function(e){return this.pushStack(n(this,e||[],!0))},is:function(e){return!!n(this,"string"==typeof e&&B.test(e)?Tt(e):e||[],!1).length}}),W=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,$=Tt.fn.init=function(e,t,n){var r,o;if(!e)return this;if(n=n||G,"string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:W.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof Tt?t[0]:t,Tt.merge(this,Tt.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:ct,!0)),F.test(r[1])&&Tt.isPlainObject(t))for(r in t)Tt.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return o=ct.getElementById(r[2]),o&&o.parentNode&&(this.length=1,this[0]=o),this.context=ct,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):Tt.isFunction(e)?void 0!==n.ready?n.ready(e):e(Tt):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),Tt.makeArray(e,this))},$.prototype=Tt.fn,G=Tt(ct),V=/\S+/g,X=e.location,Y=Tt.now(),z=/\?/,Tt.parseJSON=function(e){return JSON.parse(e+"")},Tt.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(r){n=void 0}return(!n||n.getElementsByTagName("parsererror").length)&&Tt.error("Invalid XML: "+t),n},K=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},r.uid=1,r.prototype={register:function(e,t){var n=t||{};return e.nodeType?e[this.expando]=n:Object.defineProperty(e,this.expando,{value:n,writable:!0,configurable:!0}),e[this.expando]},cache:function(e){if(!K(e))return{};var t=e[this.expando];return t||(t={},K(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,o=this.cache(e);if("string"==typeof t)o[t]=n;else for(r in t)o[r]=t[r];return o},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][t]},access:function(e,t,n){var r;return void 0===t||t&&"string"==typeof t&&void 0===n?(r=this.get(e,t),void 0!==r?r:this.get(e,Tt.camelCase(t))):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r,o,i=e[this.expando];if(void 0!==i){if(void 0===t)this.register(e);else{Tt.isArray(t)?r=t.concat(t.map(Tt.camelCase)):(o=Tt.camelCase(t),t in i?r=[t,o]:(r=o,r=r in i?[r]:r.match(V)||[])),n=r.length;for(;n--;)delete i[r[n]]}(void 0===t||Tt.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!Tt.isEmptyObject(t)}},J=new r,Q=/^key/,Z=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ee=/^([^.]*)(?:\.(.+)|)/,Tt.event={global:{},add:function(e,t,n,r,o){var i,a,u,s,c,l,f,d,p,h,m,g=J.get(e);if(g)for(n.handler&&(i=n,n=i.handler,o=i.selector),n.guid||(n.guid=Tt.guid++),(s=g.events)||(s=g.events={}),(a=g.handle)||(a=g.handle=function(t){return void 0!==Tt&&Tt.event.triggered!==t.type?Tt.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(V)||[""],c=t.length;c--;)u=ee.exec(t[c])||[],p=m=u[1],h=(u[2]||"").split(".").sort(),p&&(f=Tt.event.special[p]||{},p=(o?f.delegateType:f.bindType)||p,f=Tt.event.special[p]||{},l=Tt.extend({type:p,origType:m,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&Tt.expr.match.needsContext.test(o),namespace:h.join(".")},i),(d=s[p])||(d=s[p]=[],d.delegateCount=0,f.setup&&f.setup.call(e,r,h,a)!==!1||e.addEventListener&&e.addEventListener(p,a)),f.add&&(f.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),o?d.splice(d.delegateCount++,0,l):d.push(l),Tt.event.global[p]=!0)},remove:function(e,t,n,r,o){var i,a,u,s,c,l,f,d,p,h,m,g=J.hasData(e)&&J.get(e);if(g&&(s=g.events)){for(t=(t||"").match(V)||[""],c=t.length;c--;)if(u=ee.exec(t[c])||[],p=m=u[1],h=(u[2]||"").split(".").sort(),p){for(f=Tt.event.special[p]||{},p=(r?f.delegateType:f.bindType)||p,d=s[p]||[],u=u[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=i=d.length;i--;)l=d[i],!o&&m!==l.origType||n&&n.guid!==l.guid||u&&!u.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(d.splice(i,1),l.selector&&d.delegateCount--,f.remove&&f.remove.call(e,l));a&&!d.length&&(f.teardown&&f.teardown.call(e,h,g.handle)!==!1||Tt.removeEvent(e,p,g.handle),delete s[p])}else for(p in s)Tt.event.remove(e,p+t[c],n,r,!0);Tt.isEmptyObject(s)&&J.remove(e,"handle events")}},dispatch:function(e){e=Tt.event.fix(e);var t,n,r,o,i,a=[],u=lt.call(arguments),s=(J.get(this,"events")||{})[e.type]||[],c=Tt.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(a=Tt.event.handlers.call(this,e,s),t=0;(o=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,n=0;(i=o.handlers[n++])&&!e.isImmediatePropagationStopped();)(!e.rnamespace||e.rnamespace.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((Tt.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),void 0!==r&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,o,i,a=[],u=t.delegateCount,s=e.target;if(u&&s.nodeType&&("click"!==e.type||isNaN(e.button)||e.button<1))for(;s!==this;s=s.parentNode||this)if(1===s.nodeType&&(s.disabled!==!0||"click"!==e.type)){for(r=[],n=0;u>n;n++)i=t[n],o=i.selector+" ",void 0===r[o]&&(r[o]=i.needsContext?Tt(o,this).index(s)>-1:Tt.find(o,this,null,[s]).length),r[o]&&r.push(i);r.length&&a.push({elem:s,handlers:r})}return u<t.length&&a.push({elem:this,handlers:t.slice(u)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,o,i=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||ct,r=n.documentElement,o=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),e.which||void 0===i||(e.which=1&i?1:2&i?3:4&i?2:0),e}},fix:function(e){if(e[Tt.expando])return e;var t,n,r,o=e.type,i=e,a=this.fixHooks[o];for(a||(this.fixHooks[o]=a=Z.test(o)?this.mouseHooks:Q.test(o)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,e=new Tt.Event(i),t=r.length;t--;)n=r[t],e[n]=i[n];return e.target||(e.target=ct),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,i):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==a()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===a()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Tt.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return Tt.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},Tt.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},Tt.Event=function(e,t){return this instanceof Tt.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?o:i):this.type=e,t&&Tt.extend(this,t),this.timeStamp=e&&e.timeStamp||Tt.now(),void(this[Tt.expando]=!0)):new Tt.Event(e,t)},Tt.Event.prototype={constructor:Tt.Event,isDefaultPrevented:i,isPropagationStopped:i,isImmediatePropagationStopped:i,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=o,e&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=o,e&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=o,e&&e.stopImmediatePropagation(),this.stopPropagation()}},Tt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){Tt.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,o=e.relatedTarget,i=e.handleObj;return(!o||o!==r&&!Tt.contains(r,o))&&(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),Tt.fn.extend({on:function(e,t,n,r){return u(this,e,t,n,r)},one:function(e,t,n,r){return u(this,e,t,n,r,1)},off:function(e,t,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,Tt(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(o in e)this.off(o,t,e[o]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=i),this.each(function(){Tt.event.remove(this,e,n,t)})}}),te=/^(?:focusinfocus|focusoutblur)$/,Tt.extend(Tt.event,{trigger:function(t,n,r,o){var i,a,u,s,c,l,f,d=[r||ct],p=gt.call(t,"type")?t.type:t,h=gt.call(t,"namespace")?t.namespace.split("."):[];if(a=u=r=r||ct,3!==r.nodeType&&8!==r.nodeType&&!te.test(p+Tt.event.triggered)&&(p.indexOf(".")>-1&&(h=p.split("."),p=h.shift(),h.sort()),c=p.indexOf(":")<0&&"on"+p,t=t[Tt.expando]?t:new Tt.Event(p,"object"==typeof t&&t),t.isTrigger=o?2:3,t.namespace=h.join("."),t.rnamespace=t.namespace?RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:Tt.makeArray(n,[t]),f=Tt.event.special[p]||{},o||!f.trigger||f.trigger.apply(r,n)!==!1)){if(!o&&!f.noBubble&&!Tt.isWindow(r)){for(s=f.delegateType||p,te.test(s+p)||(a=a.parentNode);a;a=a.parentNode)d.push(a),u=a;u===(r.ownerDocument||ct)&&d.push(u.defaultView||u.parentWindow||e)}for(i=0;(a=d[i++])&&!t.isPropagationStopped();)t.type=i>1?s:f.bindType||p,l=(J.get(a,"events")||{})[t.type]&&J.get(a,"handle"),l&&l.apply(a,n),l=c&&a[c],l&&l.apply&&K(a)&&(t.result=l.apply(a,n),t.result===!1&&t.preventDefault());return t.type=p,o||t.isDefaultPrevented()||f._default&&f._default.apply(d.pop(),n)!==!1||!K(r)||c&&Tt.isFunction(r[p])&&!Tt.isWindow(r)&&(u=r[c],u&&(r[c]=null),Tt.event.triggered=p,r[p](),Tt.event.triggered=void 0,u&&(r[c]=u)),t.result}},simulate:function(e,t,n){var r=Tt.extend(new Tt.Event,n,{type:e,isSimulated:!0});Tt.event.trigger(r,null,t),r.isDefaultPrevented()&&n.preventDefault()}}),Tt.fn.extend({trigger:function(e,t){return this.each(function(){Tt.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?Tt.event.trigger(e,t,n,!0):void 0}}),Tt.Callbacks=function(e){e="string"==typeof e?s(e):Tt.extend({},e);var t,n,r,o,i=[],a=[],u=-1,c=function(){for(o=e.once,r=t=!0;a.length;u=-1)for(n=a.shift();++u<i.length;)i[u].apply(n[0],n[1])===!1&&e.stopOnFalse&&(u=i.length,n=!1);e.memory||(n=!1),t=!1,o&&(i=n?[]:"")},l={add:function(){return i&&(n&&!t&&(u=i.length-1,a.push(n)),function r(t){Tt.each(t,function(t,n){Tt.isFunction(n)?e.unique&&l.has(n)||i.push(n):n&&n.length&&"string"!==Tt.type(n)&&r(n)})}(arguments),n&&!t&&c()),this},remove:function(){return Tt.each(arguments,function(e,t){for(var n;(n=Tt.inArray(t,i,n))>-1;)i.splice(n,1),u>=n&&u--}),this},has:function(e){return e?Tt.inArray(e,i)>-1:i.length>0},empty:function(){return i&&(i=[]),this},disable:function(){return o=a=[],i=n="",this},disabled:function(){return!i},lock:function(){return o=a=[],n||(i=n=""),this},locked:function(){return!!o},fireWith:function(e,n){return o||(n=n||[],n=[e,n.slice?n.slice():n],a.push(n),t||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},Tt.extend({Deferred:function(e){var t=[["resolve","done",Tt.Callbacks("once memory"),"resolved"],["reject","fail",Tt.Callbacks("once memory"),"rejected"],["notify","progress",Tt.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return Tt.Deferred(function(n){Tt.each(t,function(t,i){var a=Tt.isFunction(e[t])&&e[t];o[i[1]](function(){var e=a&&a.apply(this,arguments);e&&Tt.isFunction(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[i[0]+"With"](this===r?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?Tt.extend(e,r):r}},o={};return r.pipe=r.then,Tt.each(t,function(e,i){var a=i[2],u=i[3];r[i[1]]=a.add,u&&a.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),o[i[0]]=function(){return o[i[0]+"With"](this===o?r:this,arguments),this},o[i[0]+"With"]=a.fireWith}),r.promise(o),e&&e.call(o,o),o},when:function(e){var t,n,r,o=0,i=lt.call(arguments),a=i.length,u=1!==a||e&&Tt.isFunction(e.promise)?a:0,s=1===u?e:Tt.Deferred(),c=function(e,n,r){return function(o){n[e]=this,r[e]=arguments.length>1?lt.call(arguments):o,r===t?s.notifyWith(n,r):--u||s.resolveWith(n,r)}};if(a>1)for(t=Array(a),n=Array(a),r=Array(a);a>o;o++)i[o]&&Tt.isFunction(i[o].promise)?i[o].promise().progress(c(o,n,t)).done(c(o,r,i)).fail(s.reject):--u;return u||s.resolveWith(r,i),s.promise()}}),ne=/#.*$/,re=/([?&])_=[^&]*/,oe=/^(.*?):[ \t]*([^\r\n]*)$/gm,ie=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ae=/^(?:GET|HEAD)$/,ue=/^\/\//,se={},ce={},le="*/".concat("*"),fe=ct.createElement("a"),fe.href=X.href,Tt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:X.href,type:"GET",isLocal:ie.test(X.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":le,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Tt.parseJSON,"text xml":Tt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?f(f(e,Tt.ajaxSettings),t):f(Tt.ajaxSettings,e)},ajaxPrefilter:c(se),ajaxTransport:c(ce),ajax:function(t,n){function r(t,n,r,u){var c,l,h,x,E,N=n;2!==C&&(C=2,s&&e.clearTimeout(s),o=void 0,a=u||"",S.readyState=t>0?4:0,c=t>=200&&300>t||304===t,r&&(x=d(m,S,r)),x=p(m,x,S,c),c?(m.ifModified&&(E=S.getResponseHeader("Last-Modified"),E&&(Tt.lastModified[i]=E),E=S.getResponseHeader("etag"),E&&(Tt.etag[i]=E)),204===t||"HEAD"===m.type?N="nocontent":304===t?N="notmodified":(N=x.state,l=x.data,h=x.error,c=!h)):(h=N,(t||!N)&&(N="error",0>t&&(t=0))),S.status=t,S.statusText=(n||N)+"",c?y.resolveWith(g,[l,N,S]):y.rejectWith(g,[S,N,h]),S.statusCode(b),b=void 0,f&&v.trigger(c?"ajaxSuccess":"ajaxError",[S,m,c?l:h]),T.fireWith(g,[S,N]),f&&(v.trigger("ajaxComplete",[S,m]),--Tt.active||Tt.event.trigger("ajaxStop")))}"object"==typeof t&&(n=t,t=void 0),n=n||{};var o,i,a,u,s,c,f,h,m=Tt.ajaxSetup({},n),g=m.context||m,v=m.context&&(g.nodeType||g.jquery)?Tt(g):Tt.event,y=Tt.Deferred(),T=Tt.Callbacks("once memory"),b=m.statusCode||{},x={},E={},C=0,N="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(2===C){if(!u)for(u={};t=oe.exec(a);)u[t[1].toLowerCase()]=t[2];t=u[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===C?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return C||(e=E[n]=E[n]||e,x[e]=t),this},overrideMimeType:function(e){return C||(m.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>C)for(t in e)b[t]=[b[t],e[t]];else S.always(e[S.status]);return this},abort:function(e){var t=e||N;return o&&o.abort(t),r(0,t),this}};if(y.promise(S).complete=T.add,S.success=S.done,S.error=S.fail,m.url=((t||m.url||X.href)+"").replace(ne,"").replace(ue,X.protocol+"//"),m.type=n.method||n.type||m.method||m.type,m.dataTypes=Tt.trim(m.dataType||"*").toLowerCase().match(V)||[""],null==m.crossDomain){c=ct.createElement("a");try{c.href=m.url,c.href=c.href,m.crossDomain=fe.protocol+"//"+fe.host!=c.protocol+"//"+c.host}catch(A){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=Tt.param(m.data,m.traditional)),l(se,m,n,S),2===C)return S;f=Tt.event&&m.global,f&&0===Tt.active++&&Tt.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!ae.test(m.type),i=m.url,m.hasContent||(m.data&&(i=m.url+=(z.test(i)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=re.test(i)?i.replace(re,"$1_="+Y++):i+(z.test(i)?"&":"?")+"_="+Y++)),m.ifModified&&(Tt.lastModified[i]&&S.setRequestHeader("If-Modified-Since",Tt.lastModified[i]),Tt.etag[i]&&S.setRequestHeader("If-None-Match",Tt.etag[i])),(m.data&&m.hasContent&&m.contentType!==!1||n.contentType)&&S.setRequestHeader("Content-Type",m.contentType),S.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+le+"; q=0.01":""):m.accepts["*"]);for(h in m.headers)S.setRequestHeader(h,m.headers[h]);if(m.beforeSend&&(m.beforeSend.call(g,S,m)===!1||2===C))return S.abort();N="abort";for(h in{success:1,error:1,complete:1})S[h](m[h]);if(o=l(ce,m,n,S)){if(S.readyState=1,f&&v.trigger("ajaxSend",[S,m]),2===C)return S;m.async&&m.timeout>0&&(s=e.setTimeout(function(){S.abort("timeout")},m.timeout));try{C=1,o.send(x,r)}catch(A){if(!(2>C))throw A;r(-1,A)}}else r(-1,"No Transport");return S},getJSON:function(e,t,n){return Tt.get(e,t,n,"json")},getScript:function(e,t){return Tt.get(e,void 0,t,"script")}}),Tt.each(["get","post"],function(e,t){Tt[t]=function(e,n,r,o){return Tt.isFunction(n)&&(o=o||r,r=n,n=void 0),Tt.ajax(Tt.extend({url:e,type:t,dataType:o,data:n,success:r},Tt.isPlainObject(e)&&e))}}),de=[],pe=/(=)\?(?=&|$)|\?\?/,Tt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=de.pop()||Tt.expando+"_"+Y++;return this[e]=!0,e}}),Tt.ajaxPrefilter("json jsonp",function(t,n,r){var o,i,a,u=t.jsonp!==!1&&(pe.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&pe.test(t.data)&&"data");return u||"jsonp"===t.dataTypes[0]?(o=t.jsonpCallback=Tt.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(pe,"$1"+o):t.jsonp!==!1&&(t.url+=(z.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return a||Tt.error(o+" was not called"),a[0]},t.dataTypes[0]="json",i=e[o],e[o]=function(){a=arguments},r.always(function(){void 0===i?Tt(e).removeProp(o):e[o]=i,t[o]&&(t.jsonpCallback=n.jsonpCallback,de.push(o)),a&&Tt.isFunction(i)&&i(a[0]),a=i=void 0}),"script"):void 0}),Tt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return Tt.globalEval(e),e}}}),Tt.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),Tt.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,o){t=Tt("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),ct.head.appendChild(t[0])},abort:function(){n&&n()}}}}),Tt.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}},he={0:200,1223:204},me=Tt.ajaxSettings.xhr(),vt.cors=!!me&&"withCredentials"in me,vt.ajax=me=!!me,Tt.ajaxTransport(function(t){var n,r;return vt.cors||me&&!t.crossDomain?{send:function(o,i){var a,u=t.xhr();if(u.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)u[a]=t.xhrFields[a];t.mimeType&&u.overrideMimeType&&u.overrideMimeType(t.mimeType),t.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(a in o)u.setRequestHeader(a,o[a]);n=function(e){return function(){n&&(n=r=u.onload=u.onerror=u.onabort=u.onreadystatechange=null,"abort"===e?u.abort():"error"===e?"number"!=typeof u.status?i(0,"error"):i(u.status,u.statusText):i(he[u.status]||u.status,u.statusText,"text"!==(u.responseType||"text")||"string"!=typeof u.responseText?{binary:u.response}:{text:u.responseText},u.getAllResponseHeaders()))}},u.onload=n(),r=u.onerror=n("error"),void 0!==u.onabort?u.onabort=r:u.onreadystatechange=function(){4===u.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{u.send(t.hasContent&&t.data||null)}catch(s){if(n)throw s}},abort:function(){n&&n()}}:void 0}),ge=function St(e,t,n,r,o,i,a){var u=0,s=e.length,c=null==n;if("object"===Tt.type(n)){o=!0;for(u in n)St(e,t,u,n[u],!0,i,a)}else if(void 0!==r&&(o=!0,Tt.isFunction(r)||(a=!0),c&&(a?(t.call(e,r),t=null):(c=t,t=function(e,t,n){return c.call(Tt(e),n)})),t))for(;s>u;u++)t(e[u],n,a?r:r.call(e[u],u,t(e[u],n)));return o?e:c?t.call(e):s?t(e[0],n):i},ve=/^(?:checkbox|radio)$/i,ye=/<([\w:-]+)/,Te=/^$|\/(?:java|ecma)script/i,be={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]},be.optgroup=be.option,be.tbody=be.tfoot=be.colgroup=be.caption=be.thead,be.th=be.td,xe=/<|&#?\w+;/,function(){var e=ct.createDocumentFragment(),t=e.appendChild(ct.createElement("div")),n=ct.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),vt.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",vt.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}(),Ee=new r,Ce=function(e,t,n){for(var r=[],o=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&Tt(e).is(n))break;r.push(e)}return r},Ne=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},Se=/^(?:parents|prev(?:Until|All))/,Ae={children:!0,contents:!0,next:!0,prev:!0},Tt.fn.extend({has:function(e){var t=Tt(e,this),n=t.length;return this.filter(function(){for(var e=0;n>e;e++)if(Tt.contains(this,t[e]))return!0})},closest:function(e,t){for(var n,r=0,o=this.length,i=[],a=B.test(e)||"string"!=typeof e?Tt(e,t||this.context):0;o>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&Tt.find.matchesSelector(n,e))){i.push(n);break}return this.pushStack(i.length>1?Tt.uniqueSort(i):i)},index:function(e){return e?"string"==typeof e?pt.call(Tt(e),this[0]):pt.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(Tt.uniqueSort(Tt.merge(this.get(),Tt(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),Tt.each({parent:function At(e){var At=e.parentNode;return At&&11!==At.nodeType?At:null},parents:function(e){return Ce(e,"parentNode")},parentsUntil:function(e,t,n){return Ce(e,"parentNode",n)},next:function(e){return v(e,"nextSibling")},prev:function(e){return v(e,"previousSibling")},nextAll:function(e){return Ce(e,"nextSibling")},prevAll:function(e){return Ce(e,"previousSibling")},nextUntil:function(e,t,n){return Ce(e,"nextSibling",n)},prevUntil:function(e,t,n){return Ce(e,"previousSibling",n)},siblings:function(e){return Ne((e.parentNode||{}).firstChild,e)},children:function(e){return Ne(e.firstChild)},contents:function(e){return e.contentDocument||Tt.merge([],e.childNodes)}},function(e,t){Tt.fn[e]=function(n,r){var o=Tt.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(o=Tt.filter(r,o)),this.length>1&&(Ae[e]||Tt.uniqueSort(o),Se.test(e)&&o.reverse()),this.pushStack(o)}}),Oe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,Ie=/<script|<style|<link/i,Re=/checked\s*(?:[^=]|=\s*.checked.)/i,De=/^true\/(.*)/,we=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Tt.extend({htmlPrefilter:function(e){return e.replace(Oe,"<$1></$2>")},clone:function Ot(e,t,n){var r,o,i,a,Ot=e.cloneNode(!0),u=Tt.contains(e.ownerDocument,e);if(!(vt.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||Tt.isXMLDoc(e)))for(a=h(Ot),i=h(e),r=0,o=i.length;o>r;r++)E(i[r],a[r]);if(t)if(n)for(i=i||h(e),a=a||h(Ot),r=0,o=i.length;o>r;r++)x(i[r],a[r]);else x(e,Ot);return a=h(Ot,"script"),a.length>0&&m(a,!u&&h(e,"script")),Ot},cleanData:function(e){for(var t,n,r,o=Tt.event.special,i=0;void 0!==(n=e[i]);i++)if(K(n)){if(t=n[J.expando]){if(t.events)for(r in t.events)o[r]?Tt.event.remove(n,r):Tt.removeEvent(n,r,t.handle);n[J.expando]=void 0}n[Ee.expando]&&(n[Ee.expando]=void 0)}}}),Tt.fn.extend({domManip:C,detach:function(e){return N(this,e,!0)},remove:function(e){return N(this,e)},text:function(e){return ge(this,function(e){return void 0===e?Tt.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return C(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=y(this,e);t.appendChild(e)}})},prepend:function(){return C(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=y(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return C(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return C(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(Tt.cleanData(h(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return Tt.clone(this,e,t)})},html:function(e){return ge(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ie.test(e)&&!be[(ye.exec(e)||["",""])[1].toLowerCase()]){e=Tt.htmlPrefilter(e);try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(Tt.cleanData(h(t,!1)),t.innerHTML=e);t=0}catch(o){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return C(this,arguments,function(t){var n=this.parentNode;Tt.inArray(this,e)<0&&(Tt.cleanData(h(this)),n&&n.replaceChild(t,this))},e)}}),Tt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){Tt.fn[e]=function(e){for(var n,r=[],o=Tt(e),i=o.length-1,a=0;i>=a;a++)n=a===i?this:this.clone(!0),Tt(o[a])[t](n),dt.apply(r,n.get());return this.pushStack(r)}}),Tt.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||ct;var r=F.exec(e),o=!n&&[];return r?[t.createElement(r[1])]:(r=g([e],t,o),o&&o.length&&Tt(o).remove(),Tt.merge([],r.childNodes))},Pe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ke=/[A-Z]/g,Tt.extend({hasData:function(e){return Ee.hasData(e)||J.hasData(e)},data:function(e,t,n){return Ee.access(e,t,n)},removeData:function(e,t){Ee.remove(e,t)},_data:function(e,t,n){return J.access(e,t,n)},_removeData:function(e,t){J.remove(e,t)}}),Tt.fn.extend({data:function It(e,t){var n,r,It,o=this[0],i=o&&o.attributes;if(void 0===e){if(this.length&&(It=Ee.get(o),1===o.nodeType&&!J.get(o,"hasDataAttrs"))){for(n=i.length;n--;)i[n]&&(r=i[n].name,0===r.indexOf("data-")&&(r=Tt.camelCase(r.slice(5)),S(o,r,It[r])));J.set(o,"hasDataAttrs",!0)}return It}return"object"==typeof e?this.each(function(){Ee.set(this,e)}):ge(this,function(t){var n,r;if(o&&void 0===t){if(n=Ee.get(o,e)||Ee.get(o,e.replace(ke,"-$&").toLowerCase()),void 0!==n)return n;if(r=Tt.camelCase(e),n=Ee.get(o,r),void 0!==n)return n;if(n=S(o,r,void 0),void 0!==n)return n}else r=Tt.camelCase(e),this.each(function(){var n=Ee.get(this,r);Ee.set(this,r,t),e.indexOf("-")>-1&&void 0!==n&&Ee.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Ee.remove(this,e)})}}),Le=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_e=/^margin/,Me=RegExp("^(?:([+-])=|)("+Le+")([a-z%]*)$","i"),je=RegExp("^("+Le+")(?!px)[a-z%]+$","i"),He=["Top","Right","Bottom","Left"],Fe=function(e,t){return e=t||e,"none"===Tt.css(e,"display")||!Tt.contains(e.ownerDocument,e)},qe=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Be=function(e,t,n,r){var o,i,a={};for(i in t)a[i]=e.style[i],e.style[i]=t[i];o=n.apply(e,r||[]);for(i in t)e.style[i]=a[i];return o},Ue=ct.documentElement,function(){function t(){u.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",u.innerHTML="",Ue.appendChild(a);var t=e.getComputedStyle(u);n="1%"!==t.top,i="2px"===t.marginLeft,r="4px"===t.width,u.style.marginRight="50%",o="4px"===t.marginRight,Ue.removeChild(a)}var n,r,o,i,a=ct.createElement("div"),u=ct.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",vt.clearCloneStyle="content-box"===u.style.backgroundClip,a.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",a.appendChild(u),Tt.extend(vt,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return null==r&&t(),r},pixelMarginRight:function(){return null==r&&t(),o},reliableMarginLeft:function(){return null==r&&t(),i},reliableMarginRight:function(){var t,n=u.appendChild(ct.createElement("div"));return n.style.cssText=u.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",u.style.width="1px",Ue.appendChild(a),t=!parseFloat(e.getComputedStyle(n).marginRight),Ue.removeChild(a),u.removeChild(n),t}}))}(),We={HTML:"block",BODY:"block"},Tt.fn.ready=function(e){return Tt.ready.promise().done(e),this},Tt.extend({isReady:!1,readyWait:1,holdReady:function(e){e?Tt.readyWait++:Tt.ready(!0)},ready:function(e){(e===!0?--Tt.readyWait:Tt.isReady)||(Tt.isReady=!0,e!==!0&&--Tt.readyWait>0||($e.resolveWith(ct,[Tt]),Tt.fn.triggerHandler&&(Tt(ct).triggerHandler("ready"),Tt(ct).off("ready"))))}}),Tt.ready.promise=function(t){return $e||($e=Tt.Deferred(),"complete"===ct.readyState||"loading"!==ct.readyState&&!ct.documentElement.doScroll?e.setTimeout(Tt.ready):(ct.addEventListener("DOMContentLoaded",w),e.addEventListener("load",w))),$e.promise(t)},Tt.ready.promise(),Ve=/^(none|table(?!-c[ea]).+)/,Xe={position:"absolute",visibility:"hidden",display:"block"},Ye={letterSpacing:"0",fontWeight:"400"},ze=["Webkit","O","Moz","ms"],Ke=ct.createElement("div").style,Tt.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=A(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function Rt(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,i,a,u=Tt.camelCase(t),Rt=e.style;return t=Tt.cssProps[u]||(Tt.cssProps[u]=P(u)||u),a=Tt.cssHooks[t]||Tt.cssHooks[u],void 0===n?a&&"get"in a&&void 0!==(o=a.get(e,!1,r))?o:Rt[t]:(i=typeof n,"string"===i&&(o=Me.exec(n))&&o[1]&&(n=O(e,t,o),i="number"),null!=n&&n===n&&("number"===i&&(n+=o&&o[3]||(Tt.cssNumber[u]?"":"px")),vt.clearCloneStyle||""!==n||0!==t.indexOf("background")||(Rt[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(Rt[t]=n)),void 0)}},css:function(e,t,n,r){var o,i,a,u=Tt.camelCase(t);return t=Tt.cssProps[u]||(Tt.cssProps[u]=P(u)||u),a=Tt.cssHooks[t]||Tt.cssHooks[u],a&&"get"in a&&(o=a.get(e,!0,n)),void 0===o&&(o=A(e,t,r)),"normal"===o&&t in Ye&&(o=Ye[t]),""===n||n?(i=parseFloat(o),n===!0||isFinite(i)?i||0:o):o}}),Tt.each(["height","width"],function(e,t){Tt.cssHooks[t]={get:function(e,n,r){return n?Ve.test(Tt.css(e,"display"))&&0===e.offsetWidth?Be(e,Xe,function(){return _(e,t,r)}):_(e,t,r):void 0},set:function(e,n,r){var o,i=r&&qe(e),a=r&&L(e,t,r,"border-box"===Tt.css(e,"boxSizing",!1,i),i);return a&&(o=Me.exec(n))&&"px"!==(o[3]||"px")&&(e.style[t]=n,n=Tt.css(e,t)),k(e,n,a)}}}),Tt.cssHooks.marginLeft=D(vt.reliableMarginLeft,function(e,t){return t?(parseFloat(A(e,"marginLeft"))||e.getBoundingClientRect().left-Be(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px":void 0}),Tt.cssHooks.marginRight=D(vt.reliableMarginRight,function(e,t){return t?Be(e,{display:"inline-block"},A,[e,"marginRight"]):void 0}),Tt.each({margin:"",padding:"",border:"Width"},function(e,t){Tt.cssHooks[e+t]={expand:function(n){for(var r=0,o={},i="string"==typeof n?n.split(" "):[n];4>r;r++)o[e+He[r]+t]=i[r]||i[r-2]||i[0];return o}},_e.test(e)||(Tt.cssHooks[e+t].set=k)}),Tt.fn.extend({css:function(e,t){return ge(this,function(e,t,n){var r,o,i={},a=0;if(Tt.isArray(t)){for(r=qe(e),o=t.length;o>a;a++)i[t[a]]=Tt.css(e,t[a],!1,r);return i}return void 0!==n?Tt.style(e,t,n):Tt.css(e,t)},e,t,arguments.length>1)},show:function(){return M(this,!0)},hide:function(){return M(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Fe(this)?Tt(this).show():Tt(this).hide()})}}),function(){var e=ct.createElement("input"),t=ct.createElement("select"),n=t.appendChild(ct.createElement("option"));e.type="checkbox",vt.checkOn=""!==e.value,vt.optSelected=n.selected,t.disabled=!0,vt.optDisabled=!n.disabled,e=ct.createElement("input"),e.value="t",e.type="radio",vt.radioValue="t"===e.value}(),Qe=Tt.expr.attrHandle,Tt.fn.extend({attr:function(e,t){return ge(this,Tt.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){Tt.removeAttr(this,e)})}}),Tt.extend({attr:function(e,t,n){var r,o,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return void 0===e.getAttribute?Tt.prop(e,t,n):(1===i&&Tt.isXMLDoc(e)||(t=t.toLowerCase(),o=Tt.attrHooks[t]||(Tt.expr.match.bool.test(t)?Je:void 0)),void 0!==n?null===n?void Tt.removeAttr(e,t):o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:(e.setAttribute(t,n+""),n):o&&"get"in o&&null!==(r=o.get(e,t))?r:(r=Tt.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set:function(e,t){if(!vt.radioValue&&"radio"===t&&Tt.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r,o=0,i=t&&t.match(V);if(i&&1===e.nodeType)for(;n=i[o++];)r=Tt.propFix[n]||n,Tt.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)}}),Je={set:function(e,t,n){return t===!1?Tt.removeAttr(e,n):e.setAttribute(n,n),n}},Tt.each(Tt.expr.match.bool.source.match(/\w+/g),function(e,t){var n=Qe[t]||Tt.find.attr;Qe[t]=function(e,t,r){var o,i;return r||(i=Qe[t],Qe[t]=o,o=null!=n(e,t,r)?t.toLowerCase():null,Qe[t]=i),o}}),Ze=/^(?:input|select|textarea|button)$/i,et=/^(?:a|area)$/i,Tt.fn.extend({prop:function(e,t){return ge(this,Tt.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[Tt.propFix[e]||e]})}}),Tt.extend({prop:function(e,t,n){var r,o,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&Tt.isXMLDoc(e)||(t=Tt.propFix[t]||t,o=Tt.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:e[t]=n:o&&"get"in o&&null!==(r=o.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=Tt.find.attr(e,"tabindex");return t?parseInt(t,10):Ze.test(e.nodeName)||et.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),vt.optSelected||(Tt.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t&&t.parentNode&&t.parentNode.selectedIndex)}}),Tt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Tt.propFix[this.toLowerCase()]=this}),tt=/[\t\r\n\f]/g,Tt.fn.extend({addClass:function(e){var t,n,r,o,i,a,u,s=0;if(Tt.isFunction(e))return this.each(function(t){Tt(this).addClass(e.call(this,t,j(this)))});if("string"==typeof e&&e)for(t=e.match(V)||[];n=this[s++];)if(o=j(n),r=1===n.nodeType&&(" "+o+" ").replace(tt," ")){for(a=0;i=t[a++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");u=Tt.trim(r),o!==u&&n.setAttribute("class",u)}return this},removeClass:function(e){var t,n,r,o,i,a,u,s=0;if(Tt.isFunction(e))return this.each(function(t){Tt(this).removeClass(e.call(this,t,j(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(V)||[];n=this[s++];)if(o=j(n),r=1===n.nodeType&&(" "+o+" ").replace(tt," ")){for(a=0;i=t[a++];)for(;r.indexOf(" "+i+" ")>-1;)r=r.replace(" "+i+" "," ");u=Tt.trim(r),o!==u&&n.setAttribute("class",u)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):Tt.isFunction(e)?this.each(function(n){Tt(this).toggleClass(e.call(this,n,j(this),t),t)}):this.each(function(){var t,r,o,i;if("string"===n)for(r=0,o=Tt(this),i=e.match(V)||[];t=i[r++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else(void 0===e||"boolean"===n)&&(t=j(this),t&&J.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":J.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+j(n)+" ").replace(tt," ").indexOf(t)>-1)return!0;return!1}}),nt=/\r/g,Tt.fn.extend({val:function(e){var t,n,r,o=this[0];{if(arguments.length)return r=Tt.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=r?e.call(this,n,Tt(this).val()):e,null==o?o="":"number"==typeof o?o+="":Tt.isArray(o)&&(o=Tt.map(o,function(e){return null==e?"":e+""})),t=Tt.valHooks[this.type]||Tt.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))});if(o)return t=Tt.valHooks[o.type]||Tt.valHooks[o.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:(n=o.value,"string"==typeof n?n.replace(nt,""):null==n?"":n)}}}),Tt.extend({valHooks:{option:{get:function(e){return Tt.trim(e.value)}},select:{get:function(e){for(var t,n,r=e.options,o=e.selectedIndex,i="select-one"===e.type||0>o,a=i?null:[],u=i?o+1:r.length,s=0>o?u:i?o:0;u>s;s++)if(n=r[s],(n.selected||s===o)&&(vt.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!Tt.nodeName(n.parentNode,"optgroup"))){if(t=Tt(n).val(),i)return t;a.push(t)}return a},set:function(e,t){for(var n,r,o=e.options,i=Tt.makeArray(t),a=o.length;a--;)r=o[a],(r.selected=Tt.inArray(Tt.valHooks.option.get(r),i)>-1)&&(n=!0);return n||(e.selectedIndex=-1),i}}}}),Tt.each(["radio","checkbox"],function(){Tt.valHooks[this]={set:function(e,t){return Tt.isArray(t)?e.checked=Tt.inArray(Tt(e).val(),t)>-1:void 0}},vt.checkOn||(Tt.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),rt=/%20/g,ot=/\[\]$/,it=/\r?\n/g,at=/^(?:submit|button|image|reset|file)$/i,ut=/^(?:input|select|textarea|keygen)/i,Tt.param=function(e,t){var n,r=[],o=function(e,t){t=Tt.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=Tt.ajaxSettings&&Tt.ajaxSettings.traditional),Tt.isArray(e)||e.jquery&&!Tt.isPlainObject(e))Tt.each(e,function(){o(this.name,this.value)});else for(n in e)H(n,e[n],t,o);return r.join("&").replace(rt,"+")},Tt.fn.extend({serialize:function(){return Tt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=Tt.prop(this,"elements");return e?Tt.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!Tt(this).is(":disabled")&&ut.test(this.nodeName)&&!at.test(e)&&(this.checked||!ve.test(e))}).map(function(e,t){var n=Tt(this).val();return null==n?null:Tt.isArray(n)?Tt.map(n,function(e){return{name:t.name,value:e.replace(it,"\r\n")}}):{name:t.name,value:n.replace(it,"\r\n")}}).get()}}),Tt});e(Bi),t(Bi),Bn=6e4,Un="mbox-name-",Gn="mboxDefault",Wn="nested mbox loop detected.",$n="nested mbox max level exceeded.",Vn=5,Xn="/m2/{clientCode}/mbox/json",Yn=250,zn="Mbox name is not present or is too long.",Kn="the mbox environment is disabled.",Jn="unspecified",Qn=3600,Zn="-clicked",er="x-only",tr="disabled",nr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,rr=/(?:^|&)([^&=]*)=?([^&]*)/gi,or=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ir=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,ar=/([^:]*)(:[0-9]{0,5})?/,ur=/([^\.]+\.[^\.]{3}|[^\.]+\.[^\.]+\.[^\.]{2})$/,sr="www.",cr="at-id-body-style",lr=encodeURIComponent,fr="mboxMCAVID",dr="mboxAAMB",pr="mboxMCGLH",hr="mboxMCGVID",mr="mboxMCSDID",gr="colorDepth",vr="screenHeight",yr="screenWidth",Tr="browserHeight",br="browserTimeOffset",xr="browserWidth",Er="mboxCallback",Cr="mboxTarget",Nr="clickTrackId",Sr="mboxXDomain",Ar="mboxCount",Or="mboxHost",Ir="mbox",Rr="mboxPage",Dr="mboxSession",wr="mboxReferrer",Pr="mboxTime",kr="mboxPC",Lr="mboxURL",_r="mboxVersion",Mr=function(){},jr="success",Hr="warning",Fr="error",qr="mboxDebug",Br="mboxDisable",Ur="mboxEdit",Gr="[Target]",Wr="check",$r="disable",Vr="mbox",Xr="PC",Yr="session",zr=RegExp("('|\")"),Kr="",Jr="Visitor Api:",Qr="Options argument is required",Zr={MBOX_PARAM_VALIDATOR:qe(Ge,Ge,zn),OPTIONS_IS_REQUIRED:qe(w,Qr),URL_PARAM_IS_MANDATORY:Fe("url",E,Be("url")),SUCCESS_PARAM_IS_MANDATORY:Fe("success",I,Be("success")),ERROR_PARAM_IS_MANDATORY:Fe("error",I,Be("error")),MBOX_OPTION_PARAM_VALIDATOR:Fe("mbox",Ge,zn)},eo="executeAjax():",to=eo+" jsonp param requires type param to be jsonp",no=eo+' unknown method "{0}"',ro=eo+' unknown type "{0}"',oo=eo+" timeout param is not a number",io=eo+' invalid method "{0}" for request type "{1}"',ao=eo+" invalid params, should be object",uo="type",so="method",co="jsonp",lo="params",fo="timeout",po=[Zr.OPTIONS_IS_REQUIRED,Zr.URL_PARAM_IS_MANDATORY,Zr.SUCCESS_PARAM_IS_MANDATORY,Zr.ERROR_PARAM_IS_MANDATORY],ho={JSON:"json",JSONP:"jsonp",SCRIPT:"script"},mo={GET:"get",POST:"post"},go={valid:function(e){var t=e[uo];return A(ho[t.toUpperCase()])?J(ro.replace("{0}",t)):Q()}},vo={valid:function(e){var t=e[so],n=e[uo];return E(t)?A(mo[t.toUpperCase()])?J(no.replace("{0}",t)):t.toUpperCase()!==mo.GET&&n!==ho.JSON?J(io.replace("{0}",t).replace("{1}",n)):Q():Q()}},yo={valid:function(e){return E(e[co])&&e[uo]!==ho.JSONP?J(to):Q()}},To={valid:function(e){var t=e[fo];return A(t)||S(t)?Q():J(oo)}},bo={valid:function(e){var t=e[lo];return w(t)||A(t)?Q():w(t)?void 0:J(ao)}},xo=[go,vo,yo,To,bo],Eo="Track Event:",Co="Invalid element: expect object with href attribute.",No="Invalid initialization. Cannot access document.location.",So="DEFINED-BEHAVIOR-BUILDER:",Ao='cannot preventDefault. Unsupported event: "{0}" for "{1}" element.',Oo="undefined element type or event type.",Io='cannot preventDefault. Unsupported tag: "{0}".',Ro={},Do={},wo="div."+Gn,Po=Gn+" container not found. Should be previous element.",ko={APPEND_CONTENT:"appendContent",REDIRECT:"redirect",SET_CONTENT:"setContent",SET_ATTRIBUTE:"setAttribute",SET_STYLE:"setStyle",TRACK_CLICK:"trackClick",REARRANGE:"rearrange",RESIZE:"resize",MOVE:"move",REMOVE:"remove",INSERT_BEFORE:"insertBefore",INSERT_AFTER:"insertAfter",CUSTOM_CODE:"customCode",PREPEND_CONTENT:"prependContent",REPLACE_CONTENT:"replaceContent"},Lo={$EL:"$el",ACTION:"action",ATTRIBUTE:"attribute",ASSET:"asset",CLICK_TRACK_ID:"clickTrackId",CONTENT:"content",CONTENT_TYPE:"contentType",INCLUDE_ALL_URL_PARAMETERS:"includeAllUrlParameters",FINAL_HEIGHT:"finalHeight",FINAL_LEFT_POSITION:"finalLeftPosition",FINAL_TOP_POSITION:"finalTopPosition",FINAL_WIDTH:"finalWidth",FROM:"from",PASS_MBOX_SESSION:"passMboxSession",POSITION:"position",PRIORITY:"priority",PROPERTY:"property",SELECTOR:"selector",CSS_SELECTOR:"cssSelector",TO:"to",URL:"url",VALUE:"value"},_o={IMPORTANT:"important"},Mo={HTML:"html",TEXT:"text"},jo="script,style,link",Ho=50,Fo={PENDING:"pending"},qo="ActionOfferStrategies() no element(s):",Bo="applied:",Uo="applyOffer():",Go="Either element or selector is redundant",Wo="offer parameter is mandatory",$o=[Zr.OPTIONS_IS_REQUIRED,Fe("offer",O,Wo),qe(An,Go)],Vo=[Zr.OPTIONS_IS_REQUIRED,Zr.MBOX_OPTION_PARAM_VALIDATOR,Zr.SUCCESS_PARAM_IS_MANDATORY,Zr.ERROR_PARAM_IS_MANDATORY],Xo="getOffer():",Yo=[Zr.OPTIONS_IS_REQUIRED,Zr.MBOX_OPTION_PARAM_VALIDATOR],zo="Track Event:",Ko=[Zr.MBOX_PARAM_VALIDATOR],Jo="Classic:",Qo={experienceEditorUrl:"//cdn.tt.omtrdc.net/cdn/target-vec.js"},Zo=window,ei=Zo.document,ti=W(Zo,SETTINGS),ni=ti.generateId(),ri=Y(X(Zo,ei),ei,ni,SETTINGS),oi=ie(Zo,ei,ti),ii=me(ei,ti,SETTINGS),ai=ye(ii,SETTINGS),ui=Ee(ei,ii,ti,SETTINGS),si=De(ei,ri,ui,ai,ti,SETTINGS),ci=_e(ei,Bi,ti,SETTINGS),li=Me(Zo,ei,ii,ti,SETTINGS),fi=je(),di=He(Bi,Zo,oi,SETTINGS),pi=We(Bi,Ue,oi,SETTINGS),hi=Xe($e(li,si,pi),di),mi=Ye(hi,ti,oi,SETTINGS),gi=et(ei,oi),vi=lt(Bi,oi),yi=ft(Bi),Ti=pt(Bi,mi,dt()),bi=mt(Bi,vi,yi,Ti),xi=[],Ei=[],Ci=gt(Bi,yi,Ti),Ni=yt(bi),Si=bt(ti,yi),Ai=Et(Bi,Zo),Oi=pt(Bi,mi,Ct(SETTINGS)),Ii=ut(ti,Oi,oi),Ri=Vt(Zo,ui),Di=Xt(Bi,Ri),wi=Jt(Bi,yi,Di,Ii,Ai,oi,SETTINGS),xi.push(wi),xi.push(Si),xi.push(Ni),xi.push(Ci),Ei.push(wi),Ei.push(Si),Ei.push(Ni),Ei.push(en(ci,bi)),Ei.push(Ci),Pi=vn(),ki=yn(Pi,Ei),Zo.adobe=Zo.adobe||{},Zo.adobe.target={},Zo.adobe.target.VERSION=SETTINGS.version,Li={tntId:Nn(ai),sessionId:Cn(ui),disabled:En(ii),error:Tn()},_i=Sn(Li),Mi=On(Bi,xi,Ue,oi),ji=Rn(Bi,li,hi,_i,Pi,ci,Ue,ti,oi,SETTINGS),Hi=Mn(li,Zo,Bi,mi,gi,Ue,ti,oi,SETTINGS),Zo.adobe.target.getOffer=ji,Zo.adobe.target.applyOffer=Mi,Zo.adobe.target.trackEvent=Hi,Zo.adobe.target.executeAjax=pi,Zo.adobe.target.getTracking=function(){return{sessionId:ui.getId(),deviceId:ai.getId()}},Zo.adobe.target.getSettings=function(){return{clientCode:SETTINGS.clientCode,serverDomain:SETTINGS.serverDomain,timeout:SETTINGS.timeout,globalMboxAutoCreate:SETTINGS.globalMboxAutoCreate,globalMboxName:SETTINGS.globalMboxName}},Fi=Hn(li,fi,hi,Bi,_i,ki,Ue,ti,oi,SETTINGS),Fi.hideDefaultContent(),Zo.mboxDefine=Fi.createMbox,Zo.mboxUpdate=Fi.fetchAndDisplayMbox,Zo.mboxCreate=Fi.createFetchAndDisplayMbox,qn(li,Zo,Bi,pi,oi),SETTINGS.globalMboxAutoCreate===!0&&E(SETTINGS.globalMboxName)&&li.isEnabled()&&(q(),ji({mbox:SETTINGS.globalMboxName,params:ti.getTargetPageParameters(),success:function(e){Mi({offer:e})},error:function(){F()}}))}(this.adobe=this.adobe||{})}({clientCode:"omniture",imsOrgId:"2A5D3BC75244638C0A490D4D@AdobeOrg",profileLifetime:12096e5,serverDomain:"omniture.tt.omtrdc.net",crossDomain:"disabled",timeout:15e3,globalMboxName:"target-global-mbox",globalMboxAutoCreate:true,version:"0.6.4",defaultContentHiddenStyle:"visibility:hidden;",defaultContentVisibleStyle:"visibility:visible;",bodyHiddenStyle:"body{opacity:0}",sessionLifetime:186e4,pollingAfterDomReadyTimeout:18e4,bodyHidingEnabled:true,visitorApiTimeout:2e3});!function(){var d3={version:"3.5.16"};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)};var d3_document=this.document;function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement}function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView)}if(d3_document){try{d3_array(d3_document.documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array}}}if(!Date.now)Date.now=function(){return+new Date};if(d3_document){try{d3_document.createElement("DIV").style.setProperty("opacity",0,"")}catch(error){var d3_element_prototype=this.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"")};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"")};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority)}}}d3.ascending=d3_ascending;function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&a>b)a=b}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break}while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b}return a};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&b>a)a=b}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break}while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b}return a};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=c=b;break}while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b}}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=c=b;break}while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b}}return[a,c]};function d3_number(x){return x===null?NaN:+x}function d3_numeric(x){return!isNaN(x)}d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=+array[i]))s+=a}else{while(++i<n)if(d3_numeric(a=+f.call(array,array[i],i)))s+=a}return s};d3.mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))s+=a;else--j}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))s+=a;else--j}if(j)return s/j};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v};d3.median=function(array,f){var numbers=[],n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))numbers.push(a)}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))numbers.push(a)}if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5)};d3.variance=function(array,f){var n=array.length,m=0,a,d,s=0,i=-1,j=0;if(arguments.length===1){while(++i<n){if(d3_numeric(a=d3_number(array[i]))){d=a-m;m+=d/++j;s+=d*(a-m)}}}else{while(++i<n){if(d3_numeric(a=d3_number(f.call(array,array[i],i)))){d=a-m;m+=d/++j;s+=d*(a-m)}}}if(j>1)return s/(j-1)};d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v?Math.sqrt(v):v};function d3_bisector(compare){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}}var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left;d3.bisect=d3.bisectRight=d3_bisect.right;d3.bisector=function(f){return d3_bisector(f.length===1?function(d,x){return d3_ascending(f(d),x)}:f)};d3.shuffle=function(array,i0,i1){if((m=arguments.length)<3){i1=array.length;if(m<2)i0=0}var m=i1-i0,t,i;while(m){i=Math.random()*m--|0;t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t}return array};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs};d3.transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=d3.min(matrix,d3_transposeLength),transpose=new Array(m);++i<m;){for(var j=-1,n,row=transpose[i]=new Array(n);++j<n;){row[j]=matrix[j][i]}}return transpose};function d3_transposeLength(d){return d.length}d3.zip=function(){return d3.transpose(arguments)};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0}}if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k}function d3_class(ctor,properties){for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false})}}d3.map=function(object,f){var map=new d3_Map;if(object instanceof d3_Map){object.forEach(function(key,value){map.set(key,value)})}else if(Array.isArray(object)){var i=-1,n=object.length,o;if(arguments.length===1)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f.call(object,o=object[i],i),o)}else{for(var key in object)map.set(key,object[key])}return map};function d3_Map(){this._=Object.create(null)}var d3_map_proto="__proto__",d3_map_zero="\0";d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)]},set:function(key,value){return this._[d3_map_escape(key)]=value},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];for(var key in this._)values.push(this._[key]);return values},entries:function(){var entries=[];for(var key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key])}});function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key}function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key}function d3_map_has(key){return d3_map_escape(key)in this._}function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key]}function d3_map_keys(){var keys=[];for(var key in this._)keys.push(d3_map_unescape(key));return keys}function d3_map_size(){var size=0;for(var key in this._)++size;return size}function d3_map_empty(){for(var key in this._)return false;return true}d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map,values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object)}else{valuesByKey.set(keyValue,[object])}}if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth)}}valuesByKey.forEach(setter);return object}function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}nest.map=function(array,mapType){return map(mapType,array,0)};nest.entries=function(array){return entries(map(d3.map,array,0),0)};nest.key=function(d){keys.push(d);return nest};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest};nest.sortValues=function(order){sortValues=order;return nest};nest.rollup=function(f){rollup=f;return nest};return nest};d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set};function d3_Set(){this._=Object.create(null)}d3_class(d3_Set,{has:d3_map_has,add:function(key){this._[d3_map_escape(key+="")]=true;return key},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key))}});d3.behavior={};function d3_identity(d){return d}d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}d3.dispatch=function(){var dispatch=new d3_dispatch,i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch};function d3_dispatch(){}d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.slice(i+1);type=type.slice(0,i)}if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null)}return this}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map;function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch}event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name)}if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch};return event}d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e}function d3_eventDispatch(target){var dispatch=new d3_dispatch,i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};return dispatch}d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups}var d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)};return d3_selectMatches(n,s)};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null};d3_selectAll=Sizzle;d3_selectMatches=Sizzle.matchesSelector}d3.selection=function(){return d3.select(d3_document.documentElement)};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};function d3_selection_selector(selector){return typeof selector==="function"?selector:function(){return d3_select(selector,this)}}d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node}}}return d3_selection(subgroups)};function d3_selection_selectorAll(selector){return typeof selector==="function"?selector:function(){return d3_selectAll(selector,this)}}var d3_nsXhtml="http://www.w3.org/1999/xhtml";var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:d3_nsXhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0&&(prefix=name.slice(0,i))!=="xmlns")name=name.slice(i+1);return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrConstant(){this.setAttribute(name,value)}function attrConstantNS(){this.setAttributeNS(name.space,name.local,value)}function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x)}function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x)}return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false}return true}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/)}function d3_selection_classed(name,value){name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value)}function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x)}return typeof value==="function"?classedFunction:classedConstant}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name))}else{node.setAttribute("class",d3_collapse(c.replace(re," ")))}}}d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this}if(n<2){var node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name)}priority=""}return this.each(d3_selection_style(name,value,priority))};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleConstant(){this.style.setProperty(name,value,priority)}function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority)}return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant}d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))};function d3_selection_property(name,value){function propertyNull(){delete this[name]}function propertyConstant(){this[name]=value}function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x}return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant}d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v}:value==null?function(){this.textContent=""}:function(){this.textContent=value}):this.node().textContent};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v}:value==null?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments))})};function d3_selection_creator(name){function create(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace===d3_nsXhtml&&document.documentElement.namespaceURI===d3_nsXhtml?document.createElement(name):document.createElementNS(namespace,name)}function createNS(){return this.ownerDocument.createElementNS(name.space,name.local)}return typeof name==="function"?name:(name=d3.ns.qualify(name)).local?createNS:create}d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null)})};d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove)};function d3_selectionRemove(){var parent=this.parentNode;if(parent)parent.removeChild(this)}d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__}}return value}function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map,keyValues=new Array(n),keyValue;for(i=-1;++i<n;){if(node=group[i]){if(nodeByKeyValue.has(keyValue=key.call(node,node.__data__,i))){exitNodes[i]=node}else{nodeByKeyValue.set(keyValue,node)}keyValues[i]=keyValue}}for(i=-1;++i<m;){if(!(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))){enterNodes[i]=d3_selection_dataNode(nodeData)}else if(node!==true){updateNodes[i]=node;node.__data__=nodeData}nodeByKeyValue.set(keyValue,true)}for(i=-1;++i<n;){if(i in keyValues&&nodeByKeyValue.get(keyValues[i])!==true){exitNodes[i]=group[i]}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node}else{enterNodes[i]=d3_selection_dataNode(nodeData)}}for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i])}for(;i<n;++i){exitNodes[i]=group[i]}}enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes)}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i))}}else{while(++i<n){bind(group=this[i],value)}}update.enter=function(){return enter};update.exit=function(){return exit};return update};function d3_selection_dataNode(data){return{__data__:data}}d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_selection(subgroups)};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node}}}return this};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3_ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j)}}return groups}d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this};d3_selectionPrototype.empty=function(){return!this.node()};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node}}return null};d3_selectionPrototype.size=function(){var n=0;d3_selection_each(this,function(){++n});return n};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection}var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};d3_selection_enterPrototype.insert=function(name,before){if(arguments.length<2)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before)};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node}}d3.select=function(node){var group;if(typeof node==="string"){group=[d3_select(node,d3_document)];group.parentNode=d3_document.documentElement}else{group=[node];group.parentNode=d3_documentElement(node)}return d3_selection([group])};d3.selectAll=function(nodes){var group;if(typeof nodes==="string"){group=d3_array(d3_selectAll(nodes,d3_document));group.parentNode=d3_document.documentElement}else{group=d3_array(nodes);group.parentNode=null}return d3_selection([group])};d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false}return this.each(d3_selection_on(type,listener,capture))};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.slice(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name]}}function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener}function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name]}}}return i?listener?onAdd:onRemove:listener?d3_noop:removeAll}var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});if(d3_document){d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k)})}function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e)}}}var d3_event_dragSelect,d3_event_dragId=0;function d3_event_dragSuppress(node){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect==null){d3_event_dragSelect="onselectstart"in node?false:d3_vendorSymbol(node.style,"userSelect")}if(d3_event_dragSelect){var style=d3_documentElement(node).style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none"}return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){var off=function(){w.on(click,null)};w.on(click,function(){d3_eventPreventDefault();off()},true);setTimeout(off,0)}}}d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0){var window=d3_window(container);if(window.scrollX||window.scrollY){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove()}}if(d3_mouse_bug44083)point.x=e.pageX,point.y=e.pageY;else point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y]}var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]}d3.touch=function(container,touches,identifier){if(arguments.length<3)identifier=touches,touches=d3_eventSource().changedTouches;if(touches)for(var i=0,n=touches.length,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return d3_mousePoint(container,touch)}}};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart)}function dragstart(id,position,subject,move,end){return function(){var that=this,target=d3.event.target.correspondingElement||d3.event.target,parent=that.parentNode,dispatch=event.of(that,arguments),dragged=0,dragId=id(),dragName=".drag"+(dragId==null?"":"-"+dragId),dragOffset,dragSubject=d3.select(subject(target)).on(move+dragName,moved).on(end+dragName,ended),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);if(origin){dragOffset=origin.apply(that,arguments);dragOffset=[dragOffset.x-position0[0],dragOffset.y-position0[1]]}else{dragOffset=[0,0]}dispatch({type:"dragstart"});function moved(){var position1=position(parent,dragId),dx,dy;if(!position1)return;dx=position1[0]-position0[0];dy=position1[1]-position0[1];dragged|=dx|dy;position0=position1;dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy})}function ended(){if(!position(parent,dragId))return;dragSubject.on(move+dragName,null).on(end+dragName,null);dragRestore(dragged);dispatch({type:"dragend"})}}}drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag};return d3.rebind(drag,event,"on")};function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier}d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point}):[]};var =1e-6,2=*,=Math.PI,=2*,=-,half=/2,d3_radians=/180,d3_degrees=180/;function d3_sgn(x){return x>0?1:x<0?-1:0}function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function d3_acos(x){return x>1?0:x<-1?:Math.acos(x)}function d3_asin(x){return x>1?half:x<-1?-half:Math.asin(x)}function d3_sinh(x){return((x=Math.exp(x))-1/x)/2}function d3_cosh(x){return((x=Math.exp(x))+1/x)/2}function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}function d3_haversin(x){return(x=Math.sin(x/2))*x}var =Math.SQRT2,2=2,4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,i,S;if(d2<2){S=Math.log(w1/w0)/;i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(*t*S)]}}else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),b1=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/;i=function(t){var s=t*S,coshr0=d3_cosh(r0),u=w0/(2*d1)*(coshr0*d3_tanh(*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(*s+r0)]}}i.duration=S*1e3;return i};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;if(!d3_behavior_zoomWheel){d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll")}function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(dispatch)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(dispatch)}}).each("interrupt.zoom",function(){zoomended(dispatch)}).each("end.zoom",function(){zoomended(dispatch)})}else{this.__chart__=view;zoomstarted(dispatch);zoomed(dispatch);zoomended(dispatch)}})};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:null};scaleTo(+_);rescale();return zoom};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_==null?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom};zoom.duration=function(_){if(!arguments.length)return duration;duration=+_;return zoom};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1]}function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k};scaleTo(Math.pow(2,k));translateTo(center0=p,l);that=d3.select(that);if(duration>0)that=that.transition().duration(duration);that.call(zoom.event)}function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(dispatch){if(!zooming++)dispatch({type:"zoomstart"})}function zoomed(dispatch){rescale();dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(dispatch){if(!--zooming)dispatch({type:"zoomend"}),center0=null}function mousedowned(){var that=this,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that);zoomstarted(dispatch);function moved(){dragged=1;translateTo(d3.mouse(that),location0);zoomed(dispatch)}function ended(){subject.on(mousemove,null).on(mouseup,null);dragRestore(dragged);zoomended(dispatch)}}function touchstarted(){var that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,scale0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);started();zoomstarted(dispatch);subject.on(mousedown,null).on(touchstart,started);function relocate(){var touches=d3.touches(that);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t)});return touches}function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended);targets.push(target);var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null}var touches=relocate(),now=Date.now();if(touches.length===1){if(now-touchtime<500){var p=touches[0];zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1);d3_eventPreventDefault()}touchtime=now}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy}}function moved(){var touches=d3.touches(that),p0,l0,p1,l1;d3_selection_interrupt.call(that);for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1}}if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0)}touchtime=null;translateTo(p0,l0);zoomed(dispatch)}function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier]}for(var identifier in locations0){return void relocate()}}d3.selectAll(targets).on(zoomName,null);subject.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(dispatch)}}function mousewheeled(){var dispatch=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(dispatch)},50);d3_eventPreventDefault();scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*view.k);translateTo(center0,translate0);zoomed(dispatch)}function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1)}return d3.rebind(zoom,event,"on")};var d3_behavior_zoomInfinity=[0,Infinity],d3_behavior_zoomDelta,d3_behavior_zoomWheel;d3.color=d3_color;function d3_color(){}d3_color.prototype.toString=function(){return this.rgb()+""};d3.hsl=d3_hsl;function d3_hsl(h,s,l){return this instanceof d3_hsl?void(this.h=+h,this.s=+s,this.l=+l):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l)}var d3_hslPrototype=d3_hsl.prototype=new d3_color;d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,this.l/k)};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,k*this.l)};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1}function vv(h){return Math.round(v(h)*255)}return new d3_rgb(vv(h+120),vv(h),vv(h-120))}d3.hcl=d3_hcl;function d3_hcl(h,c,l){return this instanceof d3_hcl?void(this.h=+h,this.c=+c,this.l=+l):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):h instanceof d3_lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l)}var d3_hclPrototype=d3_hcl.prototype=new d3_color;d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}d3.lab=d3_lab;function d3_lab(l,a,b){return this instanceof d3_lab?void(this.l=+l,this.a=+a,this.b=+b):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b)}var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_lab.prototype=new d3_color;d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return new d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l)}function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}d3.rgb=d3_rgb;function d3_rgb(r,g,b){return this instanceof d3_rgb?void(this.r=~~r,this.g=~~g,this.b=~~b):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b)}function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,value&255)}function d3_rgbString(value){return d3_rgbNumber(value)+""}var d3_rgbPrototype=d3_rgb.prototype=new d3_color;d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return new d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k))};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_rgb(k*this.r,k*this.g,k*this.b)};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,color;m1=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase());if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100)}case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}}}if(color=d3_rgb_names.get(format)){return rgb(color.r,color.g,color.b)}if(format!=null&&format.charAt(0)==="#"&&!isNaN(color=parseInt(format.slice(1),16))){if(format.length===4){r=(color&3840)>>4;r=r>>4|r;g=color&240;g=g>>4|g;b=color&15;b=b<<4|b}else if(format.length===7){r=(color&16711680)>>16;g=(color&65280)>>8;b=color&255}}return rgb(r,g,b)}function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60}else{h=NaN;s=l>0&&l<1?0:h}return new d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z))}function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f}var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))});function d3_functor(v){return typeof v==="function"?v:function(){return v}}d3.functor=d3_functor;d3.xhr=d3_xhrType(d3_identity);function d3_xhrType(response){return function(url,mimeType,callback){if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;if(this.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest;"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond()};function respond(){var status=request.status,result;if(!status&&d3_xhrHasResponse(request)||status>=200&&status<300||status===304){try{result=response.call(xhr,request)}catch(e){dispatch.error.call(xhr,e);return}dispatch.load.call(xhr,result)}else{dispatch.error.call(xhr,request)}}request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr};xhr.response=function(value){response=value;return xhr};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(responseType!=null)request.responseType=responseType;if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request)});dispatch.beforesend.call(xhr,request);request.send(data==null?null:data);return xhr};xhr.abort=function(){request.abort();return xhr};d3.rebind(xhr,dispatch,"on");return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback))}function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null)}:callback}function d3_xhrHasResponse(request){var type=request.responseType;return type&&type!=="text"?request.response:request.responseText}d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3_xhr(url,mimeType,row==null?response:typedResponse(row),callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row};return xhr}function response(request){return dsv.parse(request.responseText)}function typedResponse(f){return function(request){return dsv.parse(request.responseText,f)}}dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}");o=f?function(row,i){return f(a(row),i)}:a})};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i}}I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I}else if(c===10){eol=true}return text.slice(j+1,i).replace(/""/g,'"')}while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k}else if(c!==delimiterCode)continue;return text.slice(j,I-k)}return text.slice(j)}while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token()}if(f&&(a=f(a,n++))==null)continue;rows.push(a)}return rows};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set,fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field))}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field])}).join(delimiter)})).join("\n")};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n")};function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text}return dsv};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("\t","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};d3.timer=function(){d3_timer.apply(this,arguments)};function d3_timer(callback,delay,then){var n=arguments.length;if(n<2)delay=0;if(n<3)then=Date.now();var time=then+delay,timer={c:callback,t:time,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step)}return timer}function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay)}d3_timer_interval=0}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step)}}d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep()};function d3_timer_mark(){var now=Date.now(),timer=d3_timer_queueHead;while(timer){if(now>=timer.t&&timer.c(now-timer.t))timer.c=null;timer=timer.n}return now}function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.c){if(t1.t<time)time=t1.t;t1=(t0=t1).n}else{t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n}}d3_timer_queueTail=t0;return time}function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x)};var d3_formatPrefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value=+value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i-1)/3)*3))}return d3_formatPrefixes[8+i/3]};function d3_formatPrefix(d,i){var k=Math.pow(10,abs(8-i)*3);return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}}function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=locale_grouping[j=(j+1)%locale_grouping.length]}return t.reverse().join(locale_thousands)}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=false,exponent=true;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="="}switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#")prefix="0"+type.toLowerCase();case"c":exponent=false;case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break}if(symbol==="$")prefix=locale_currency[0],suffix=locale_currency[1];if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision))}type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign==="-"?"":sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value);fullSuffix=unit.symbol+suffix}else{value*=scale}value=type(value,precision);var i=value.lastIndexOf("."),before,after;if(i<0){var j=exponent?value.lastIndexOf("e"):-1;if(j<0)before=value,after="";else before=value.substring(0,j),after=value.substring(j)}else{before=value.substring(0,i);after=locale_decimal+value.substring(i+1)}if(!zfill&&comma)before=formatGroup(before,Infinity);var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)before=formatGroup(padding+before,padding.length?width-after.length:Infinity);negative+=prefix;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix}}}var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2)},c:function(x){return String.fromCharCode(x)},o:function(x){return x.toString(8)},x:function(x){return x.toString(16)},X:function(x){return x.toString(16).toUpperCase()},g:function(x,p){return x.toPrecision(p)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))))}});function d3_format_typeDefault(x){return x+""}var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}d3_date_utc.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments)},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments)},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments)},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments)},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments)},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments)},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments)}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1}function ceil(date){step(date=local(new d3_date(date-1)),1);return date}function offset(date,k){step(date=new d3_date(+date),k);return date}function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1)}}else{while(time<t1)times.push(new Date(+time)),step(time,1)}return times}function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=t0;return range(utc,t1,dt)}finally{d3_date=Date}}local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local}function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=date;return method(utc,k)._}finally{d3_date=Date}}}d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date},function(date,offset){date.setFullYear(date.getFullYear()+offset)},function(date){return date.getFullYear()});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day},function(date,offset){date.setDate(date.getDate()+offset)},function(date){return date.getDate()-1});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5)};["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7)},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i)});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)}});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.slice(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1}}string.push(template.slice(j,i));return string.join("")}format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var localZ=d.Z!=null&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date);if("j"in d)date.setFullYear(d.y,0,d.j);else if("W"in d||"U"in d){if(!("w"in d))d.w="W"in d?1:0;date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+d.W*7-(date.getDay()+5)%7:d.w+d.U*7-(date.getDay()+6)%7)}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L);return localZ?date._:date};format.toString=function(){return template};return format}function d3_time_parse(date,template,string,j){var c,p,t,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{d3_date=d3_date_utc;var utc=new d3_date;utc._=date;return local(utc)}finally{d3_date=Date}}format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._}finally{d3_date=Date}};format.toString=local.toString;return format};d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i)});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()]},A:function(d){return locale_days[d.getDay()]},b:function(d){return locale_shortMonths[d.getMonth()]},B:function(d){return locale_months[d.getMonth()]},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2)},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2)},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3)},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3)},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2)},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2)},p:function(d){return locale_periods[+(d.getHours()>=12)]},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2)},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2)},w:function(d){return d.getDay()},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2)},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2)},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4)},Z:d3_time_zone,"%":function(){return"%"}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i)}function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i)}function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i)}function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i)}return d3_time_format}var d3_time_formatPads={"-":"",_:" ",0:"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i")}function d3_time_formatLookup(names){var map=new d3_Map,i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map}function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1}function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1}function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1}function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1}function d3_time_expandYear(d){return d+(d>68?1900:2e3)}function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1}function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1}function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1}function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1}function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1}function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1}function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1}function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2)}function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function d3_time_formatMulti(formats){var n=formats.length,i=-1;while(++i<n)formats[i][0]=this(formats[i][0]);return function(date){var i=0,f=formats[i];while(!f[1](date))f=formats[++i];return f[0](date)}}d3.locale=function(locale){return{numberFormat:d3_locale_numberFormat(locale),timeFormat:d3_locale_timeFormat(locale)}};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});d3.format=d3_locale_enUS.numberFormat;d3.geo={};function d3_adder(){}d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv)}d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener)}else{d3_geo_streamGeometry(object,listener)}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener)}}var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener)}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener)}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder;var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};function d3_geo_areaRingStart(){var 00,00,0,cos0,sin0;d3_geo_area.point=function(,){d3_geo_area.point=nextPoint;0=(00=)*d3_radians,cos0=Math.cos(=(00=)*d3_radians/2+/4),sin0=Math.sin()};function nextPoint(,){*=d3_radians;=*d3_radians/2+/4;var d=-0,sd=d>=0?1:-1,ad=sd*d,cos=Math.cos(),sin=Math.sin(),k=sin0*sin,u=cos0*cos+k*Math.cos(ad),v=k*sd*Math.sin(ad);d3_geo_areaRingSum.add(Math.atan2(v,u));0=,cos0=cos,sin0=sin}d3_geo_area.lineEnd=function(){nextPoint(00,00)}}function d3_geo_cartesian(spherical){var =spherical[0],=spherical[1],cos=Math.cos();return[cos*Math.cos(),cos*Math.sin(),Math.sin()]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<&&abs(a[1]-b[1])<}d3.geo.bounds=function(){var 0,0,1,1,_,__,__,p0,dSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dSum=0;d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(d3_geo_areaRingSum<0)0=-(1=180),0=-(1=90);else if(dSum>)1=90;else if(dSum<-)0=-90;range[0]=0,range[1]=1}};function point(,){ranges.push(range=[0=,1=]);if(<0)0=;if(>1)1=}function linePoint(,){var p=d3_geo_cartesian([*d3_radians,*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var d=-_,s=d>0?1:-1,i=inflection[0]*d3_degrees*s,antimeridian=abs(d)>180;if(antimeridian^(s*_<i&&i<s*)){var i=inflection[1]*d3_degrees;if(i>1)1=i}else if(i=(i+360)%360-180,antimeridian^(s*_<i&&i<s*)){var i=-inflection[1]*d3_degrees;if(i<0)0=i}else{if(<0)0=;if(>1)1=}if(antimeridian){if(<_){if(angle(0,)>angle(0,1))1=}else{if(angle(,1)>angle(0,1))0=}}else{if(1>=0){if(<0)0=;if(>1)1=}else{if(>_){if(angle(0,)>angle(0,1))1=}else{if(angle(,1)>angle(0,1))0=}}}}else{point(,)}p0=p,_=}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=0,range[1]=1;bound.point=point;p0=null}function ringPoint(,){if(p0){var d=-_;dSum+=abs(d)>180?d+(d>0?360:-360):d}else __=,__=;d3_geo_area.point(,);linePoint(,)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(__,__);d3_geo_area.lineEnd();if(abs(dSum)>)0=-(1=180);range[0]=0,range[1]=1;p0=null}function angle(0,1){return(1-=0)<0?1+360:1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}return function(feature){1=1=-(0=0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0]}else{merged.push(a=b)}}var best=-Infinity,d;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((d=angle(a[1],b[0]))>best)best=d,0=b[0],1=a[1]}}ranges=range=null;return 0===Infinity||0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[0,0],[1,1]]}}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<2)return[NaN,NaN]}return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}};function d3_geo_centroidPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians);d3_geo_centroidPointXYZ(cos*Math.cos(),cos*Math.sin(),Math.sin())}function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(,){*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos();y0=cos*Math.sin();z0=Math.sin();d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0)};function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){var 00,00,x0,y0,z0;d3_geo_centroid.point=function(,){00=,00=;d3_geo_centroid.point=nextPoint;*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos();y0=cos*Math.sin();z0=Math.sin();d3_geo_centroidPointXYZ(x0,y0,z0)};d3_geo_centroid.lineEnd=function(){nextPoint(00,00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint};function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1])};return compose}function d3_true(){return true}function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return}var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b)});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry}var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.n.x,1,listener)}current=current.n}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.p.x,-1,listener)}current=current.p}current=current.o;points=current.z;isSubject=!isSubject}while(!current.v);listener.lineEnd()}}function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b}a.n=b=array[0];b.p=a}function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null}function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[]},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener)}else if(clipStartInside){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}if(polygonStarted)listener.polygonEnd(),polygonStarted=false;segments=polygon=null},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd()}};function point(,){var point=rotate(,);if(pointVisible(=point[0],=point[1]))listener.point(,)}function pointLine(,){var point=rotate(,);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine;line.lineStart()}function lineEnd(){clip.point=point;line.lineEnd()}var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=false,polygon,ring;function pointRing(,){ring.push([,]);var point=rotate(,);ringListener.point(point[0],point[1])}function ringStart(){ringListener.lineStart();ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];var n=segment.length-1,i=-1,point;if(n>0){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd()}return}if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}return clip}}function d3_geo_clipSegmentLength1(segment){return segment.length>1}function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[])},point:function(,){line.push([,])},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-half-:half-a[1])-((b=b.x)[0]<0?b[1]-half-:half-b[1])}var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-,-/2]);function d3_geo_clipAntimeridianLine(listener){var 0=NaN,0=NaN,s0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1},point:function(1,1){var s1=1>0?:-,d=abs(1-0);if(abs(d-)<){listener.point(0,0=(0+1)/2>0?half:-half);listener.point(s0,0);listener.lineEnd();listener.lineStart();listener.point(s1,0);listener.point(1,0);clean=0}else if(s0!==s1&&d>=){if(abs(0-s0)<)0-=s0*;if(abs(1-s1)<)1-=s1*;0=d3_geo_clipAntimeridianIntersect(0,0,1,1);listener.point(s0,0);listener.lineEnd();listener.lineStart();listener.point(s1,0);clean=0}listener.point(0=1,0=1);s0=s1},lineEnd:function(){listener.lineEnd();0=0=NaN},clean:function(){return 2-clean}}}function d3_geo_clipAntimeridianIntersect(0,0,1,1){var cos0,cos1,sin0_1=Math.sin(0-1);return abs(sin0_1)>?Math.atan((Math.sin(0)*(cos1=Math.cos(1))*Math.sin(1)-Math.sin(1)*(cos0=Math.cos(0))*Math.sin(0))/(cos0*cos1*sin0_1)):(0+1)/2}function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var ;if(from==null){=direction*half;listener.point(-,);listener.point(0,);listener.point(,);listener.point(,0);listener.point(,-);listener.point(0,-);listener.point(-,-);listener.point(-,0);listener.point(-,)}else if(abs(from[0]-to[0])>){var s=from[0]<to[0]?:-;=direction*s/2;listener.point(-s,);listener.point(0,);listener.point(s,)}else{listener.point(to[0],to[1])}}function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],0=point0[0],0=point0[1]/2+/4,sin0=Math.sin(0),cos0=Math.cos(0),j=1;while(true){if(j===m)j=0;point=ring[j];var =point[0],=point[1]/2+/4,sin=Math.sin(),cos=Math.cos(),d=-0,sd=d>=0?1:-1,ad=sd*d,antimeridian=ad>,k=sin0*sin;d3_geo_areaRingSum.add(Math.atan2(k*sd*Math.sin(ad),cos0*cos+k*Math.cos(ad)));polarAngle+=antimeridian?d+sd*:d;if(antimeridian^0>=meridian^>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var arc=(antimeridian^d>=0?-1:1)*d3_asin(intersection[2]);if(parallel>arc||parallel===arc&&(arc[0]||arc[1])){winding+=antimeridian^d>=0?1:-1}}if(!j++)break;0=,sin0=sin,cos0=cos,point0=point}}return(polarAngle<-||polarAngle<&&d3_geo_areaRingSum<0)^winding&1}function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-,radius-]);function visible(,){return Math.cos()*Math.cos()>cr}function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1},point:function(,){var point1=[,],point2,v=visible(,),c=smallRadius?v?0:code(,):v?code(+(<0?:-),):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=;point1[1]+=;v=visible(point1[0],point1[1])}}if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1])}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd()}point0=point2}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd()}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1])}}}if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1])}point0=point1,v0=v,c0=c},lineEnd:function(){if(v0)listener.lineEnd();point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var 0=a[0],1=b[0],0=a[1],1=b[1],z;if(1<0)z=0,0=1,1=z;var =1-0,polar=abs(-)<,meridian=polar||<;if(!polar&&1<0)z=0,0=1,1=z;if(meridian?polar?0+1>0^q[1]<(abs(q[0]-0)<?0:1):0<=q[1]&&q[1]<=1:>^(0<=q[0]&&q[0]<=1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)]}}function code(,){var r=smallRadius?radius:-radius,code=0;if(<-r)code|=1;else if(>r)code|=2;if(<-r)code|=4;else if(>r)code|=8;return code}}function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(t0>0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(t1<1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line}}var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent}};return clipExtent.extent([[0,0],[960,500]])};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener)}listener.polygonEnd()}segments=polygon=ring=null}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&d3_cross2d(a,b,p)>0)++wn}else{if(b[1]<=y&&d3_cross2d(a,b,p)<0)--wn}a=b}}return wn!==0}function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0)}while((a=(a+direction+4)%4)!==a1)}else{listener.point(to[0],to[1])}}function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function point(x,y){if(pointVisible(x,y))listener.point(x,y)}var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN}function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer())}clip.point=point;if(v_)listener.lineEnd()}function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y)}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y)}listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false}else if(v){listener.lineStart();listener.point(x,y);clean=false}}}x_=x,y_=y,v_=v}return clip};function corner(p,direction){return abs(p[0]-x0)<?direction>0?0:3:abs(p[0]-x1)<?direction>0?2:1:abs(p[1]-y0)<?direction>0?1:0:direction>0?3:2}function compare(a,b){return comparePoints(a.x,b.x)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0]}}function d3_geo_conic(projectAt){var 0=0,1=/3,m=d3_geo_projectionMutator(projectAt),p=m(0,1);p.parallels=function(_){if(!arguments.length)return[0/*180,1/*180];return m(0=_[0]*/180,1=_[1]*/180)};return p}function d3_geo_conicEqualArea(0,1){var sin0=Math.sin(0),n=(sin0+Math.sin(1))/2,C=1+sin0*(2*n-sin0),0=Math.sqrt(C)/n;function forward(,){var =Math.sqrt(C-2*n*Math.sin())/n;return[*Math.sin(*=n),0-*Math.cos()]}forward.invert=function(x,y){var 0_y=0-y;return[Math.atan2(x,0_y)/n,d3_asin((C-(x*x+0_y*0_y)*n*n)/(2*n))]};return forward}(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y]}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point}albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd()}}};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(_*.35);hawaii.scale(_);return albersUsa.translate(lower48.translate())};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+,y+.12*k+],[x-.214*k-,y+.234*k-]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+,y+.166*k+],[x-.115*k-,y+.234*k-]]).stream(pointStream).point;return albersUsa};return albersUsa.scale(1070)};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2)}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y}d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y}function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result}}};function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}return stream}function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=z*3;d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointRadius=_;return stream},result:d3_noop};function point(x,y){context.moveTo(x+pointRadius,y);context.arc(x,y,pointRadius,0,)}function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}return stream}function d3_geo_resample(project){var 2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream)}function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1])})}function resampleRecursive(stream){var 00,00,x00,y00,a00,b00,c00,0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart}};function point(x,y){x=project(x,y);stream.point(x[0],x[1])}function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart()}function linePoint(,){var c=d3_geo_cartesian([,]),p=project(,);resampleLineTo(x0,y0,0,a0,b0,c0,x0=p[0],y0=p[1],0=,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0)}function lineEnd(){resample.point=point;stream.lineEnd()}function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd}function ringPoint(,){linePoint(00=,00=),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,0,a0,b0,c0,x00,y00,00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd()}return resample}function resampleLineTo(x0,y0,0,a0,b0,c0,x1,y1,1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),2=Math.asin(c/=m),2=abs(abs(c)-1)<||abs(0-1)<?(0+1)/2:Math.atan2(b,a),p=project(2,2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,0,a0,b0,c0,x2,y2,2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,2,a,b,c,x1,y1,1,a1,b1,c1,depth,stream)}}}resample.precision=function(_){if(!arguments.length)return Math.sqrt(2);maxDepth=(2=_*_)>0&&16;return resample};return resample}d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream)}return contextStream.result()}path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN]};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset()};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer:new d3_geo_pathContext(_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return reset()};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path};function reset(){cacheStream=null;return path}return path.projection(d3.geo.albersUsa()).context(null)};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])});return function(stream){return d3_geo_projectionRadians(resample(stream))}}d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform}}};function d3_geo_transform(stream){this.stream=stream}d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere()},lineStart:function(){stream.lineStart()},lineEnd:function(){stream.lineEnd()},polygonStart:function(){stream.polygonStart()},polygonEnd:function(){stream.polygonEnd()}}}d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+x,y-x[1]*k]}),k=150,x=480,y=250,=0,=0,=0,=0,=0,x,y,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+x,y-point[1]*k]}function invert(point){point=projectRotate.invert((point[0]-x)/k,(y-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees]}projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate()};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate()};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset()};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset()};projection.center=function(_){if(!arguments.length)return[*d3_degrees,*d3_degrees];=_[0]%360*d3_radians;=_[1]%360*d3_radians;return reset()};projection.rotate=function(_){if(!arguments.length)return[*d3_degrees,*d3_degrees,*d3_degrees];=_[0]%360*d3_radians;=_[1]%360*d3_radians;=_.length>2?_[2]%360*d3_radians:0;return reset()};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(,,),project);var center=project(,);x=x-center[0]*k;y=y+center[1]*k;return invalidate()}function invalidate(){if(stream)stream.valid=false,stream=null;return projection}return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset()}}function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians)})}function d3_geo_equirectangular(,){return[,]}(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates};return forward};function d3_geo_identityRotation(,){return[>?-:<-?+:,]}d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(,,){return ?||?d3_geo_compose(d3_geo_rotation(),d3_geo_rotation(,)):d3_geo_rotation():||?d3_geo_rotation(,):d3_geo_identityRotation}function d3_geo_forwardRotation(){return function(,){return +=,[>?-:<-?+:,]}}function d3_geo_rotation(){var rotation=d3_geo_forwardRotation();rotation.invert=d3_geo_forwardRotation(-);return rotation}function d3_geo_rotation(,){var cos=Math.cos(),sin=Math.sin(),cos=Math.cos(),sin=Math.sin();function rotation(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos+x*sin;return[Math.atan2(y*cos-k*sin,x*cos-z*sin),d3_asin(k*cos+y*sin)]}rotation.invert=function(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos-y*sin;return[Math.atan2(y*cos+z*sin,x*cos+k*sin),d3_asin(k*cos-x*sin)]};return rotation}d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees}});return{type:"Polygon",coordinates:[ring]}}circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle};return circle.angle(90)};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*}else{from=radius+direction*;to=radius-.5*step}for(var point,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}}function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-)%(2*Math.PI)}d3.geo.distance=function(a,b){var =(b[0]-a[0])*d3_radians,0=a[1]*d3_radians,1=b[1]*d3_radians,sin=Math.sin(),cos=Math.cos(),sin0=Math.sin(0),cos0=Math.cos(0),sin1=Math.sin(1),cos1=Math.cos(1),t;return Math.atan2(Math.sqrt((t=cos1*sin)*t+(t=cos0*sin1-sin0*cos1*cos)*t),sin0*sin1+cos0*cos1*cos)};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>}).map(y))}graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_)};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision)};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision)};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_)};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule};return graticule.majorExtent([[-180,-90+],[180,90-]]).minorExtent([[-180,-80-],[180,80+]])};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function d3_source(d){return d.source}function d3_target(d){return d.target}d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]}}greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments))};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc};greatArc.precision=function(){return arguments.length?greatArc:0};return greatArc};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians)};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees]}:function(){return[x0*d3_degrees,y0*d3_degrees]};interpolate.distance=d;return interpolate}d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var 0,sin0,cos0;d3_geo_length.point=function(,){0=*d3_radians,sin0=Math.sin(*=d3_radians),cos0=Math.cos();d3_geo_length.point=nextPoint};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop};function nextPoint(,){var sin=Math.sin(*=d3_radians),cos=Math.cos(),t=abs((*=d3_radians)-0),cos=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cos*Math.sin(t))*t+(t=cos0*sin-sin0*cos*cos)*t),sin0*sin+cos0*cos*cos);0=,sin0=sin,cos0=cos}}function d3_geo_azimuthal(scale,angle){function azimuthal(,){var cos=Math.cos(),cos=Math.cos(),k=scale(cos*cos);return[k*cos*Math.sin(),k*Math.sin()]}azimuthal.invert=function(x,y){var =Math.sqrt(x*x+y*y),c=angle(),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,*cosc),Math.asin(&&y*sinc/)]};return azimuthal}var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(coscos){return Math.sqrt(2/(1+coscos))},function(){return 2*Math.asin(/2)});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea)}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(coscos){var c=Math.acos(coscos);return c&&c/Math.sin(c)},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant)}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(0,1){var cos0=Math.cos(0),t=function(){return Math.tan(/4+/2)},n=0===1?Math.sin(0):Math.log(cos0/Math.cos(1))/Math.log(t(1)/t(0)),F=cos0*Math.pow(t(0),n)/n;if(!n)return d3_geo_mercator;function forward(,){if(F>0){if(<-half+)=-half+}else{if(>half-)=half-}var =F/Math.pow(t(),n);return[*Math.sin(n*),F-*Math.cos(n*)]}forward.invert=function(x,y){var 0_y=F-y,=d3_sgn(n)*Math.sqrt(x*x+0_y*0_y);return[Math.atan2(x,0_y)/n,2*Math.atan(Math.pow(F/,1/n))-half]};return forward}(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal)}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(0,1){var cos0=Math.cos(0),n=0===1?Math.sin(0):(cos0-Math.cos(1))/(1-0),G=cos0/n+0;if(abs(n)<)return d3_geo_equirectangular;function forward(,){var =G-;return[*Math.sin(n*),G-*Math.cos(n*)]}forward.invert=function(x,y){var 0_y=G-y;return[Math.atan2(x,0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+0_y*0_y)]};return forward}(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant)}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(coscos){return 1/coscos},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic)}).raw=d3_geo_gnomonic;function d3_geo_mercator(,){return[,Math.log(Math.tan(/4+/2))]}d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-half]};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])}}else if(clipAuto){v=null}return v};return m.clipExtent(null)}(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic)}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(coscos){return 1/(1+coscos)},function(){return 2*Math.atan()});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic)}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(,){return[Math.log(Math.tan(/4+/2)),-]}d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-half]};(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;projection.center=function(_){return _?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]])};projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90])};return rotate([0,0,90])}).raw=d3_geo_transverseMercator;d3.geom={};function d3_geom_pointX(d){return d[0]}function d3_geom_pointY(d){return d[1]}d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),i,n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++){points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i])}points.sort(d3_geom_hullOrder);for(i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints);var skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon}hull.x=function(_){return arguments.length?(x=_,hull):x};hull.y=function(_){return arguments.length?(y=_,hull):y};return hull};function d3_geom_hullUpper(points){var n=points.length,hull=[0,1],hs=2;for(var i=2;i<n;i++){while(hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0)--hs;hull[hs++]=i}return hull.slice(0,hs)}function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1]}d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1]}return area*.5};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c}return[x*k,y*k]};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}subject.push(d)}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}c=d}if(closed)subject.push(subject[0]);a=b}return subject};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1])}var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiBeachPool=[],d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this);this.edge=this.site=this.circle=null}function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach;beach.site=site;return beach}function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach);d3_geom_voronoiBeaches.remove(beach);d3_geom_voronoiBeachPool.push(beach);d3_geom_voronoiRedBlackNode(beach)}function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);var lArc=previous;while(lArc.circle&&abs(x-lArc.circle.x)<&&abs(y-lArc.circle.cy)<){previous=lArc.P;disappearing.unshift(lArc);d3_geom_voronoiDetachBeach(lArc);lArc=previous}disappearing.unshift(lArc);d3_geom_voronoiDetachCircle(lArc);var rArc=next;while(rArc.circle&&abs(x-rArc.circle.x)<&&abs(y-rArc.circle.cy)<){next=rArc.N;disappearing.push(rArc);d3_geom_voronoiDetachBeach(rArc);rArc=next}disappearing.push(rArc);d3_geom_voronoiDetachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex)}lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiAddBeach(site){var x=site.x,directrix=site.y,lArc,rArc,dxl,dxr,node=d3_geom_voronoiBeaches._;while(node){dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x;if(dxl>)node=node.L;else{dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix);if(dxr>){if(!node.R){lArc=node;break}node=node.R}else{if(dxl>-){lArc=node.P;rArc=node}else if(dxr>-){lArc=node;rArc=node.N}else{lArc=rArc=node}break}}}var newArc=d3_geom_voronoiCreateBeach(site);d3_geom_voronoiBeaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){d3_geom_voronoiDetachCircle(lArc);rArc=d3_geom_voronoiCreateBeach(lArc.site);d3_geom_voronoiBeaches.insert(newArc,rArc);newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);return}if(!rArc){newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);return}d3_geom_voronoiDetachCircle(lArc);d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex);rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2}function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:Infinity}function d3_geom_voronoiCell(site){this.site=site;this.edges=[]}d3_geom_voronoiCell.prototype.prepare=function(){var halfEdges=this.edges,iHalfEdge=halfEdges.length,edge;while(iHalfEdge--){edge=halfEdges[iHalfEdge].edge;if(!edge.b||!edge.a)halfEdges.splice(iHalfEdge,1)}halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);return halfEdges.length};function d3_geom_voronoiCloseCells(extent){var x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],x2,y2,x3,y3,cells=d3_geom_voronoiCells,iCell=cells.length,cell,iHalfEdge,halfEdges,nHalfEdges,start,end;while(iCell--){cell=cells[iCell];if(!cell||!cell.prepare())continue;halfEdges=cell.edges;nHalfEdges=halfEdges.length;iHalfEdge=0;while(iHalfEdge<nHalfEdges){end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y;start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y;if(abs(x3-x2)>||abs(y3-y2)>){halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<&&y1-y3>?{x:x0,y:abs(x2-x0)<?y2:y1}:abs(y3-y1)<&&x1-x3>?{x:abs(y2-y1)<?x2:x1,y:y1}:abs(x3-x1)<&&y3-y0>?{x:x1,y:abs(x2-x1)<?y2:y0}:abs(y3-y0)<&&x3-x0>?{x:abs(y2-y0)<?x2:x0,y:y0}:null),cell.site,null));++nHalfEdges}}}}function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle}function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null}function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by;var d=2*(ax*cy-ay*cx);if(d>=-2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by;var circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle;circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=cy+Math.sqrt(x*x+y*y);circle.cy=cy;arc.circle=circle;var before=null,node=d3_geom_voronoiCircles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break}}else{if(node.R)node=node.R;else{before=node;break}}}d3_geom_voronoiCircles.insert(before,circle);if(!before)d3_geom_voronoiFirstCircle=circle}function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)d3_geom_voronoiFirstCircle=circle.N;d3_geom_voronoiCircles.remove(circle);d3_geom_voronoiCirclePool.push(circle);d3_geom_voronoiRedBlackNode(circle);arc.circle=null}}function d3_geom_voronoiClipEdges(extent){var edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length,e;while(i--){e=edges[i];if(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<&&abs(e.a.y-e.b.y)<){e.a=e.b=null;edges.splice(i,1)}}}function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return true;var va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!va)va={x:fx,y:y0};else if(va.y>=y1)return;vb={x:fx,y:y1}}else{if(!va)va={x:fx,y:y1};else if(va.y<y0)return;vb={x:fx,y:y0}}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!va)va={x:(y0-fb)/fm,y:y0};else if(va.y>=y1)return;vb={x:(y1-fb)/fm,y:y1}}else{if(!va)va={x:(y1-fb)/fm,y:y1};else if(va.y<y0)return;vb={x:(y0-fb)/fm,y:y0}}}else{if(ly<ry){if(!va)va={x:x0,y:fm*x0+fb};else if(va.x>=x1)return;vb={x:x1,y:fm*x1+fb}}else{if(!va)va={x:x1,y:fm*x1+fb};else if(va.x<x0)return;vb={x:x0,y:fm*x0+fb}}}}edge.a=va;edge.b=vb;return true}function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite;this.r=rSite;this.a=this.b=null}function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);d3_geom_voronoiEdges.push(edge);if(va)d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va);if(vb)d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb);d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite));d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite));return edge}function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);edge.a=va;edge.b=vb;d3_geom_voronoiEdges.push(edge);return edge}function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){if(!edge.a&&!edge.b){edge.a=vertex;edge.l=lSite;edge.r=rSite}else if(edge.l===rSite){edge.b=vertex}else{edge.a=vertex}}function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge;this.site=lSite;this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y)}d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};function d3_geom_voronoiRedBlackTree(){this._=null}function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node}else{after.R=node}parent=after}else if(this._){after=d3_geom_voronoiRedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after}else{node.P=node.N=null;this._=node;parent=null}node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.R){d3_geom_voronoiRedBlackRotateLeft(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateRight(this,grandpa)}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.L){d3_geom_voronoiRedBlackRotateRight(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateLeft(this,grandpa)}}parent=after.U}this._.C=false},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=d3_geom_voronoiRedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next}else{this._=next}if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next}else{next.U=parent;parent=next;node=next.R}}else{red=node.C;node=next}if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return}do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateLeft(this,parent);sibling=parent.R}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateRight(this,sibling);sibling=parent.R}sibling.C=parent.C;parent.C=sibling.R.C=false;d3_geom_voronoiRedBlackRotateLeft(this,parent);node=this._;break}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateRight(this,parent);sibling=parent.L}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateLeft(this,sibling);sibling=parent.L}sibling.C=parent.C;parent.C=sibling.L.C=false;d3_geom_voronoiRedBlackRotateRight(this,parent);node=this._;break}}sibling.C=true;node=parent;parent=parent.U}while(!node.C);if(node)node.C=false}};function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p}function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p}function d3_geom_voronoiRedBlackFirst(node){while(node.L)node=node.L;return node}function d3_geom_voronoi(sites,bbox){var site=sites.sort(d3_geom_voronoiVertexOrder).pop(),x0,y0,circle;d3_geom_voronoiEdges=[];d3_geom_voronoiCells=new Array(sites.length);d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree;d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree;while(true){circle=d3_geom_voronoiFirstCircle;if(site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x)){if(site.x!==x0||site.y!==y0){d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site);d3_geom_voronoiAddBeach(site);x0=site.x,y0=site.y}site=sites.pop()}else if(circle){d3_geom_voronoiRemoveBeach(circle.arc)}else{break}}if(bbox)d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox);var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null;return diagram}function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x}d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site,polygon=polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y]}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[];polygon.point=data[i]});return polygons}function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/)*,y:Math.round(fy(d,i)/)*,i:i}})}voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]}})};voronoi.triangles=function(data){var triangles=[];d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){var site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e0,s0,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;while(++j<m){e0=e1;s0=s1;e1=edges[j].edge;s1=e1.l===site?e1.r:e1.l;if(i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0){triangles.push([data[i],data[s0.i],data[s1.i]])}}});return triangles};voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x};voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y};voronoi.clipExtent=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent;clipExtent=_==null?d3_geom_voronoiClipExtent:_;return voronoi};voronoi.size=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1];return voronoi.clipExtent(_&&[[0,0],_])};return voronoi};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)}d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices)};d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_geom_pointX,y=d3_geom_pointY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0}return quadtree(points)}function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y)}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_)}}var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(abs(nx-x)+abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2)}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2)}}else{n.x=x,n.y=y,n.point=d}}else{insertChild(n,d,x,y,x1,y1,x2,y2)}}function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym,i=below<<1|right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=xm;else x2=xm;if(below)y1=ym;else y2=ym;insert(n,d,x,y,x1,y1,x2,y2)}var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_)};root.find=function(point){return d3_geom_quadtreeFind(root,point[0],point[1],x1_,y1_,x2_,y2_)};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_)}--i}else data.forEach(root.add);xs=ys=data=d=null;return root}quadtree.x=function(_){return arguments.length?(x=_,quadtree):x};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y};quadtree.extent=function(_){if(!arguments.length)return x1==null?null:[[x1,y1],[x2,y2]];if(_==null)x1=y1=x2=y2=null;else x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];return quadtree};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2-x1,y2-y1];if(_==null)x1=y1=x2=y2=null;else x1=y1=0,x2=+_[0],y2=+_[1];return quadtree};return quadtree};function d3_geom_quadtreeCompatX(d){return d.x}function d3_geom_quadtreeCompatY(d){return d.y}function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null}}function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2)}}function d3_geom_quadtreeFind(root,x,y,x0,y0,x3,y3){var minDistance2=Infinity,closestPoint;(function find(node,x1,y1,x2,y2){if(x1>x3||y1>y3||x2<x0||y2<y0)return;if(point=node.point){var point,dx=x-node.x,dy=y-node.y,distance2=dx*dx+dy*dy;if(distance2<minDistance2){var distance=Math.sqrt(minDistance2=distance2);x0=x-distance,y0=y-distance;x3=x+distance,y3=y+distance;closestPoint=point}}var children=node.nodes,xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym;for(var i=below<<1|right,j=i+4;i<j;++i){if(node=children[i&3])switch(i&3){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2);break}}})(root,x0,y0,x3,y3);return closestPoint}d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k])}else{c[k]=a[k]}}for(k in b){if(!(k in a)){c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}}d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){a=+a,b=+b;return function(t){return a*(1-t)+b*t}}d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:d3_interpolateNumber(am,bm)})}bi=d3_interpolate_numberB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+""}):function(){return b}:(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f}d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:t==="object"&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b)}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}var d3_ease_default=function(){return d3_identity};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce}});var d3_ease_mode=d3.map({in:d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))))};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t)}}function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)}function d3_ease_poly(e){return function(t){return Math.pow(t,e)}}function d3_ease_sin(t){return 1-Math.cos(t*half)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*/p)}}function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s)}}function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(isNaN(bc))bc=0,ac=isNaN(ac)?b.c:ac;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+""}}d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;if(isNaN(bs))bs=0,as=isNaN(as)?b.s:as;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+""}}d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+""}}d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t)}}d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(string!=null){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate()}return new d3_transform(t?t.matrix:d3_transformIdentity)})(string)};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1}this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0}d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k}return k}function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a}var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransformPop(s){return s.length?s.pop()+",":""}function d3_interpolateTranslate(ta,tb,s,q){if(ta[0]!==tb[0]||ta[1]!==tb[1]){var i=s.push("translate(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ta[0],tb[0])},{i:i-2,x:d3_interpolateNumber(ta[1],tb[1])})}else if(tb[0]||tb[1]){s.push("translate("+tb+")")}}function d3_interpolateRotate(ra,rb,s,q){if(ra!==rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(d3_interpolateTransformPop(s)+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})}else if(rb){s.push(d3_interpolateTransformPop(s)+"rotate("+rb+")")}}function d3_interpolateSkew(wa,wb,s,q){if(wa!==wb){q.push({i:s.push(d3_interpolateTransformPop(s)+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)})}else if(wb){s.push(d3_interpolateTransformPop(s)+"skewX("+wb+")")}}function d3_interpolateScale(ka,kb,s,q){if(ka[0]!==kb[0]||ka[1]!==kb[1]){var i=s.push(d3_interpolateTransformPop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:i-2,x:d3_interpolateNumber(ka[1],kb[1])})}else if(kb[0]!==1||kb[1]!==1){s.push(d3_interpolateTransformPop(s)+"scale("+kb+")")}}function d3_interpolateTransform(a,b){var s=[],q=[];a=d3.transform(a),b=d3.transform(b);d3_interpolateTranslate(a.translate,b.translate,s,q);d3_interpolateRotate(a.rotate,b.rotate,s,q);d3_interpolateSkew(a.skew,b.skew,s,q);d3_interpolateScale(a.scale,b.scale,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_uninterpolateNumber(a,b){b=(b-=a=+a)||1/b;return function(x){return(x-a)/b}}function d3_uninterpolateClamp(a,b){b=(b-=a=+a)||1/b;return function(x){return Math.max(0,Math.min(1,(x-a)/b))}}d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths}};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start)}var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent}return points}function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent}ancestors.push(node);return ancestors}function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop()}return sharedNode}d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j]}groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x}if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])})}if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})})}k=(-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:groupSums[di]};x+=padding}i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}}}if(sortChords)resort()}function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord};chord.chords=function(){if(!chords)relayout();return chords};chord.groups=function(){if(!groups)relayout();return groups};return chord};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),timer,size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k;node.py-=dy*k}return true}if(quad.point&&dn&&dn<chargeDistance2){var k=quad.pointCharge/dn;node.px-=dx*k;node.py-=dy*k}}return!quad.charge}}force.tick=function(){if((alpha*=.99)<.005){timer=null;event.end({type:"end",alpha:alpha=0});return true}var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight+t.weight?s.weight/(s.weight+t.weight):.5);t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k}}if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k}}if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o))}}}i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction}}event.tick({type:"tick",alpha:alpha})};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force};force.links=function(x){if(!arguments.length)return links;links=x;return force};force.size=function(x){if(!arguments.length)return size;size=x;return force};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force};force.chargeDistance=function(x){if(!arguments.length)return Math.sqrt(chargeDistance2);chargeDistance2=x*x;return force};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force};force.theta=function(x){if(!arguments.length)return Math.sqrt(theta2);theta2=x*x;return force};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0){alpha=x}else{timer.c=null,timer.t=NaN,timer=null;event.end({type:"end",alpha:alpha=0})}}else if(x>0){event.start({type:"start",alpha:alpha=x});timer=d3_timer(force.tick)}return force};force.start=function(){var i,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0}for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight}for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y}distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){neighbors=new Array(n);for(j=0;j<n;++j){neighbors[j]=[]}for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source)}}var candidates=neighbors[i],j=-1,l=candidates.length,x;while(++j<l)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size}return force.resume()};force.resume=function(){return force.alpha(.1)};force.stop=function(){return force.alpha(0)};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag)};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume()}return d3.rebind(force,event,"on")};function d3_layout_forceDragstart(d){d.fixed|=2}function d3_layout_forceDragend(d){d.fixed&=~6}function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y}function d3_layout_forceMouseout(d){d.fixed&=~4}function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy}}if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5}var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y}quad.cx=cx/quad.charge;quad.cy=cy/quad.charge}var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=Infinity;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var stack=[root],nodes=[],node;root.depth=0;while((node=stack.pop())!=null){nodes.push(node);if((childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){var n,childs,child;while(--n>=0){stack.push(child=childs[n]);child.parent=node;child.depth=node.depth+1}if(value)node.value=0;node.children=childs}else{if(value)node.value=+value.call(hierarchy,node,node.depth)||0;delete node.children}}d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;if(sort&&(childs=node.children))childs.sort(sort);if(value&&(parent=node.parent))parent.value+=node.value});return nodes}hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy};hierarchy.revalue=function(root){if(value){d3_layout_hierarchyVisitBefore(root,function(node){if(node.children)node.value=0});d3_layout_hierarchyVisitAfter(root,function(node){var parent;if(!node.children)node.value=+value.call(hierarchy,node,node.depth)||0;if(parent=node.parent)parent.value+=node.value})}return root};return hierarchy};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object}function d3_layout_hierarchyVisitBefore(node,callback){var nodes=[node];while((node=nodes.pop())!=null){callback(node);if((children=node.children)&&(n=children.length)){var n,children;while(--n>=0)nodes.push(children[n])}}}function d3_layout_hierarchyVisitAfter(node,callback){var nodes=[node],nodes2=[];while((node=nodes.pop())!=null){nodes2.push(node);if((children=node.children)&&(n=children.length)){var i=-1,n,children;while(++i<n)nodes.push(children[i])}}while((node=nodes2.pop())!=null){callback(node)}}function d3_layout_hierarchyChildren(d){return d.children}function d3_layout_hierarchyValue(d){return d.value}function d3_layout_hierarchySort(a,b){return b.value-a.value}function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child}})}))}d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d}}}function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]))}return 1+d}function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes}partition.size=function(x){if(!arguments.length)return size;size=x;return partition};return d3_layout_hierarchyRebind(partition,hierarchy)};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=,padAngle=0;function pie(data){var n=data.length,values=data.map(function(d,i){return+value.call(pie,d,i)}),a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle),da=(typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/n,+(typeof padAngle==="function"?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),sum=d3.sum(values),k=sum?(da-n*pa)/sum:0,index=d3.range(n),arcs=[],v;if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i]}:function(i,j){return sort(data[i],data[j])});index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p}});return arcs}pie.value=function(_){if(!arguments.length)return value;value=_;return pie};pie.sort=function(_){if(!arguments.length)return sort;sort=_;return pie};pie.startAngle=function(_){if(!arguments.length)return startAngle;startAngle=_;return pie};pie.endAngle=function(_){if(!arguments.length)return endAngle;endAngle=_;return pie};pie.padAngle=function(_){if(!arguments.length)return padAngle;padAngle=_;return pie};return pie};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){if(!(n=data.length))return data;var series=data.map(function(d,i){return values.call(stack,d,i)});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)]})});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var m=series[0].length,n,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1])}}return data}stack.values=function(x){if(!arguments.length)return values;values=x;return stack};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack};stack.x=function(z){if(!arguments.length)return x;x=z;return stack};stack.y=function(z){if(!arguments.length)return y;y=z;return stack};stack.out=function(z){if(!arguments.length)return out;out=z;return stack};return stack};function d3_layout_stackX(d){return d.x}function d3_layout_stackY(d){return d.y}function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y}var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j)}else{bottom+=sums[j];bottoms.push(j)}}return bottoms.reverse().concat(tops)},reverse:function(data){return d3.range(data.length).reverse()},default:d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o)}for(j=0;j<m;++j){y0[j]=(max-sums[j])/2}return y0},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx}s2+=s3*data[i][j][1]}y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o}for(j=0;j<m;++j)y0[j]-=o0;return y0},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k}for(j=0;j<m;++j)y0[j]=0;return y0},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length)}function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0}function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k}}return j}function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0)}function d3_layout_stackSum(p,d){return p+d[1]}d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0}if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i])}}}return bins}histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x)}:d3_functor(x);return histogram};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram};return histogram};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1))}function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f}function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)]}d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1],radius;function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=radius==null?Math.sqrt:typeof radius==="function"?radius:function(){return radius};root.x=root.y=0;d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value)});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr})}d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes}pack.size=function(_){if(!arguments.length)return size;size=_;return pack};pack.radius=function(_){if(!arguments.length)return radius;radius=_==null||typeof _==="function"?_:+_;return pack};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack};return d3_layout_hierarchyRebind(pack,hierarchy)};function d3_layout_packSort(a,b){return a.value-b.value}function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b}function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a}function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy}function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax)}nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break}}if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break}}}if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--}else{d3_layout_packInsert(a,c);b=c;bound(c)}}}}var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y))}node.r=cr;nodes.forEach(d3_layout_packUnlink)}function d3_layout_packLink(node){node._pack_next=node._pack_prev=node}function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev}function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k)}}function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx}else{c.x=a.x+db;c.y=a.y}}d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=wrapTree(root0);d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z;d3_layout_hierarchyVisitBefore(root1,secondWalk);if(nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky})}return nodes}function wrapTree(root0){var root1={A:null,children:[root0]},queue=[root1],node1;while((node1=queue.pop())!=null){for(var children=node1.children,child,i=0,n=children.length;i<n;++i){queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child)}}return root1.children[0]}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){d3_layout_treeShift(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint}else{v.z=midpoint}}else if(w){v.z=w.z+separation(v._,w._)}v.parent.A=apportion(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m}function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift}sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m}if(vim&&!d3_layout_treeRight(vop)){vop.t=vim;vop.m+=sim-sop}if(vip&&!d3_layout_treeLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v}}return ancestor}function sizeNode(node){node.x*=size[0];node.y=node.depth*size[1]}tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null?sizeNode:null;return tree};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)==null?null:sizeNode;return tree};return d3_layout_hierarchyRebind(tree,hierarchy)};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t}function d3_layout_treeRight(v){var children=v.children,n;return(n=children.length)?children[n-1]:v.t}function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift}function d3_layout_treeShift(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c)}}function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children)}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1]}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1]});return nodes}cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return cluster};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return cluster};return d3_layout_hierarchyRebind(cluster,hierarchy)};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y})}function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x},0)/children.length}function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node}function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node}d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area}}function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity}}if(row.length){position(row,u,rect,true);row.length=row.area=0}children.forEach(squarify)}}function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0}}children.forEach(stickify)}}function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r}s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity}function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0)}o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0)}o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v}}function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=root.y=0;if(root.value)root.dx=size[0],root.dy=size[1];else root.dx=root.dy=0;if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes}treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p)}function padConstant(node){return d3_layout_treemapPad(node,x)}var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap};return d3_layout_hierarchyRebind(treemap,hierarchy)};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0}if(dy<0){y+=dy/2;dy=0}return{x:x,y:y,dx:dx,dy:dy}}d3.random={normal:function(,){var n=arguments.length;if(n<2)=1;if(n<1)=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y}while(!r||r>1);return +*x*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random())}},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m}},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s}}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]}function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range())}function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x))}}function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx}domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain}function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step},ceil:function(x){return Math.ceil(x/step)*step}}:d3_scale_niceIdentity}var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse()}while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]))}return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x))}}d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false)};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale}function scale(x){return output(x)}scale.invert=function(y){return input(y)};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound)};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale()};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale()};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale()};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp)};return rescale()}function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp")}function d3_scale_linearNice(domain,m){d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));return domain}function d3_scale_linearTickRange(domain,m){if(m==null)m=10;var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent}function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m))}function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);match.shift();if(match[8]==="s"){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));if(!match[7])match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]));match[8]="f";format=d3.format(match.join(""));return function(d){return format(prefix.scale(d))+prefix.symbol}}if(!match[7])match[7]="."+d3_scale_linearFormatPrecision(match[8],range);format=match.join("")}else{format=",."+d3_scale_linearPrecision(range[2])+"f"}return d3.format(format)}var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01)}function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +(type!=="e"):p-(type==="%")*2}d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,true,[1,10])};function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base)}function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x)}function scale(x){return linear(log(x))}scale.invert=function(x){return pow(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i))}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k)}for(i=0;ticks[i]<u;i++){}for(j=ticks.length;ticks[j-1]>v;j--){}ticks=ticks.slice(i,j)}return ticks};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;if(arguments.length<2)format=d3_scale_logFormat;else if(typeof format!=="function")format=d3.format(format);var k=Math.max(1,base*n/scale.ticks().length);return function(d){var i=d/pow(Math.round(log(d)));if(i*base<base-.5)i*=base;return i<=k?format(d):""}};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain)};return d3_scale_linearRebind(scale,linear)}var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x)},ceil:function(x){return-Math.floor(-x)}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1])};function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x))}scale.invert=function(x){return powb(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m))};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain)};return d3_scale_linearRebind(scale,linear)}function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e)}}d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]})};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||(ranger.t==="range"?index.set(x,domain.push(x)):NaN))-1)%range.length]}function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i})}scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map;var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a)};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=(start+stop)/2,0):(stop-start)/(domain.length-1+padding);range=steps(start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale};scale.rangeRoundPoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step);rangeBand=0;ranger={t:"rangeRoundPoints",a:arguments};return scale};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale};scale.rangeBand=function(){return rangeBand};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0])};scale.copy=function(){return d3_scale_ordinal(domain,ranger)};return scale.domain(domain)}d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10)};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20)};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b)};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c)};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString);var d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString);var d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString);var d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[])};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale}function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)]}scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.quantiles=function(){return thresholds};scale.invertExtent=function(y){y=range.indexOf(y);return y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]]};scale.copy=function(){return d3_scale_quantile(domain,range)};return rescale()}d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1])};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))]}function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale}scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.invertExtent=function(y){y=range.indexOf(y);y=y<0?NaN:y/kx+x0;return[y,y+1/kx]};scale.copy=function(){return d3_scale_quantize(x0,x1,range)};return rescale()}d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1])};function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)]}scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale};scale.range=function(_){if(!arguments.length)return range;range=_;return scale};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]]};scale.copy=function(){return d3_scale_threshold(domain,range)};return scale}d3.scale.identity=function(){return d3_scale_identity([0,1])};function d3_scale_identity(domain){function identity(x){return+x}identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity};identity.ticks=function(m){return d3_scale_linearTicks(domain,m)};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};identity.copy=function(){return d3_scale_identity(domain)};return identity}d3.svg={};function d3_zero(){return 0}d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),a0=startAngle.apply(this,arguments)-half,a1=endAngle.apply(this,arguments)-half,da=Math.abs(a1-a0),cw=a0>a1?0:1;if(r1<r0)rc=r1,r1=r0,r0=rc;if(da>=)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,cr,rp,ap,p0=0,p1=0,x0,y0,x1,y1,x2,y2,x3,y3,path=[];if(ap=(+padAngle.apply(this,arguments)||0)/2){rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments);if(!cw)p1*=-1;if(r1)p1=d3_asin(rp/r1*Math.sin(ap));if(r0)p0=d3_asin(rp/r0*Math.sin(ap))}if(r1){x0=r1*Math.cos(a0+p1);y0=r1*Math.sin(a0+p1);x1=r1*Math.cos(a1-p1);y1=r1*Math.sin(a1-p1);var l1=Math.abs(a1-a0-2*p1)<=?0:1;if(p1&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1){var h1=(a0+a1)/2;x0=r1*Math.cos(h1);y0=r1*Math.sin(h1);x1=y1=null}}else{x0=y0=0}if(r0){x2=r0*Math.cos(a1-p0);y2=r0*Math.sin(a1-p0);x3=r0*Math.cos(a0+p0);y3=r0*Math.sin(a0+p0);var l0=Math.abs(a0-a1+2*p0)<=?0:1;if(p0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0){var h0=(a0+a1)/2;x2=r0*Math.cos(h0);y2=r0*Math.sin(h0);x3=y3=null}}else{x2=y2=0}if(da>&&(rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))>.001){cr=r0<r1^cw?0:1;var rc1=rc,rc0=rc;if(da<){var oc=x3==null?[x2,y2]:x1==null?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]),ax=x0-oc[0],ay=y0-oc[1],bx=x1-oc[0],by=y1-oc[1],kc=1/Math.sin(Math.acos((ax*bx+ay*by)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+by*by)))/2),lc=Math.sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=Math.min(rc,(r0-lc)/(kc-1));rc1=Math.min(rc,(r1-lc)/(kc+1))}if(x1!=null){var t30=d3_svg_arcCornerTangents(x3==null?[x2,y2]:[x3,y3],[x0,y0],r1,rc1,cw),t12=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,rc1,cw);if(rc===rc1){path.push("M",t30[0],"A",rc1,",",rc1," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t12[1][0],t12[1][1]),",",cw," ",t12[1],"A",rc1,",",rc1," 0 0,",cr," ",t12[0])}else{path.push("M",t30[0],"A",rc1,",",rc1," 0 1,",cr," ",t12[0])}}else{path.push("M",x0,",",y0)}if(x3!=null){var t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],x1==null?[x0,y0]:[x1,y1],r0,-rc0,cw);if(rc===rc0){path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0])}else{path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0])}}else{path.push("L",x2,",",y2)}}else{path.push("M",x0,",",y0);if(x1!=null)path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1);path.push("L",x2,",",y2);if(x3!=null)path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3)}path.push("Z");return path.join("")}function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1}arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc};arc.cornerRadius=function(v){if(!arguments.length)return cornerRadius;cornerRadius=d3_functor(v);return arc};arc.padRadius=function(v){if(!arguments.length)return padRadius;padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v);return arc};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc};arc.padAngle=function(v){if(!arguments.length)return padAngle;padAngle=d3_functor(v);return arc};arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-half;return[Math.cos(a)*r,Math.sin(a)*r]};return arc};var d3_svg_arcAuto="auto";function d3_svg_arcInnerRadius(d){return d.innerRadius}function d3_svg_arcOuterRadius(d){return d.outerRadius}function d3_svg_arcStartAngle(d){return d.startAngle}function d3_svg_arcEndAngle(d){return d.endAngle}function d3_svg_arcPadAngle(d){return d&&d.padAngle}function d3_svg_arcSweep(x0,y0,x1,y1){return(x0-x1)*y0-(y0-y1)*x0>0?0:1}function d3_svg_arcCornerTangents(p0,p1,r1,rc,cw){var x01=p0[0]-p1[0],y01=p0[1]-p1[1],lo=(cw?rc:-rc)/Math.sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x1=p0[0]+ox,y1=p0[1]+oy,x2=p1[0]+ox,y2=p1[1]+oy,x3=(x1+x2)/2,y3=(y1+y2)/2,dx=x2-x1,dy=y2-y1,d2=dx*dx+dy*dy,r=r1-rc,D=x1*y2-x2*y1,d=(dy<0?-1:1)*Math.sqrt(Math.max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x3,dy0=cy0-y3,dx1=cx1-x3,dy1=cy1-y3;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]]}function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension))}while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)])}else if(points.length){segment();points=[]}}if(points.length)segment();return segments.length?segments.join(""):null}line.x=function(_){if(!arguments.length)return x;x=_;return line};line.y=function(_){if(!arguments.length)return y;y=_;return line};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line};return line}d3.svg.line=function(){return d3_svg_line(d3_identity)};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key)});function d3_svg_lineLinear(points){return points.length>1?points.join("L"):points+"Z"}function d3_svg_lineLinearClosed(points){return points.join("L")+"Z"}function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);if(n>1)path.push("H",p[0]);return path.join("")}function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("")}function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("")}function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinearClosed(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension))}function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points)}var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2}if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1]}}if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1]}return path}function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])])}return tangents}function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);while(++i<=n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}points.pop();path.push("L",pi);return path.join("")}function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1])}path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1])}path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy)}}return d3_svg_lineBasis(points)}function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y))}function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0])}function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2}m[i]=d;return m}function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(abs(d)<){m[i]=m[i+1]=0}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b}}}i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0])}return tangents}function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points))}d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]-half;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a)}return points}function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x}:d3_functor(x1),fy1=y0===y1?function(){return y}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z")}while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)])}else if(points0.length){segment();points0=[];points1=[]}}if(points0.length)segment();return segments.length?segments.join(""):null}area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area};return area}d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity)};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z"}function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)-half,a1=endAngle.call(self,subgroup,i)-half;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]}}function equals(a,b){return a.a0==b.a0&&a.a1==b.a1}function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>)+",1 "+p}function curve(r0,p0,r1,p1){return"Q 0,0 "+p1}chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord};return chord};function d3_svg_chordRadius(d){return d.radius}d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3]}diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal};return diagonal};function d3_svg_diagonalProjection(d){return[d.x,d.y]}d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection};return diagonal};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]-half;return[r*Math.cos(a),r*Math.sin(a)]}}d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i))}symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol};return symbol};function d3_svg_symbolSize(){return 64}function d3_svg_symbolType(){return"circle"}function d3_svg_symbolCircle(size){var r=Math.sqrt(size/);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z"}var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z"},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z"},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z"},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z"},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z"}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){var id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,ns,id,transition);subgroup.push(node)}}return d3_transition(subgroups,ns,id)};d3_selectionPrototype.interrupt=function(name){return this.each(name==null?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)))};var d3_selection_interrupt=d3_selection_interruptNS(d3_transitionNamespace());function d3_selection_interruptNS(ns){return function(){var lock,activeId,active;if((lock=this[ns])&&(active=lock[activeId=lock.active])){active.timer.c=null;active.timer.t=NaN;if(--lock.count)delete lock[activeId];else delete this[ns];lock.active+=.5;active.event&&active.event.interrupt.call(this,this.__data__,active.index)}}}function d3_transition(groups,ns,id){d3_subclass(groups,d3_transitionPrototype);groups.namespace=ns;groups.id=id;return groups}var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection)};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,ns,id,node[ns][id]);subgroup.push(subnode)}else{subgroup.push(null)}}}return d3_transition(subgroups,ns,id)};d3_transitionPrototype.selectAll=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node[ns][id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,ns,id,transition);subgroup.push(subnode)}}}}return d3_transition(subgroups,ns,id)};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_transition(subgroups,this.namespace,this.id)};d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;if(arguments.length<2)return this.node()[ns][id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node[ns][id].tween.remove(name)}:function(node){node[ns][id].tween.set(name,tween)})};function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node[ns][id].tween.set(name,value)}))}d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate=nameNS=="transform"?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrTween(b){return b==null?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})}function attrTweenNS(b){return b==null?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}}function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this}priority=""}function styleNull(){this.style.removeProperty(name)}function styleString(b){return b==null?styleNull:(b+="",function(){var a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})}return d3_transition_tween(this,"style."+name,value,styleString)};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}}return this.tween("style."+name,styleTween)};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b}}d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;if(this[ns].count<2&&(p=this.parentNode))p.removeChild(this)})};d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node[ns][id].ease=value})};d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].delay;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node[ns][id].delay=value}))};d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].duration;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node[ns][id].duration=value}))};d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id];type.call(node,node.__data__,i,j)})}finally{d3_transitionInherit=inherit;d3_transitionInheritId=inheritId}}else{d3_selection_each(this,function(node){var transition=node[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener)})}return this};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=node[ns][id0];d3_transitionNode(node,i,ns,id1,{time:transition.time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration})}subgroup.push(node)}}return d3_transition(subgroups,ns,id1)};function d3_transitionNamespace(name){return name==null?"__transition__":"__transition_"+name+"__"}function d3_transitionNode(node,i,ns,id,inherit){var lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id],time,timer,duration,ease,tweens;function schedule(elapsed){var delay=transition.delay;timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start}function start(elapsed){var activeId=lock.active,active=lock[activeId];if(active){active.timer.c=null;active.timer.t=NaN;--lock.count;delete lock[activeId];active.event&&active.event.interrupt.call(node,node.__data__,active.index)}for(var cancelId in lock){if(+cancelId<id){var cancel=lock[cancelId];cancel.timer.c=null;cancel.timer.t=NaN;--lock.count;delete lock[cancelId]}}timer.c=tick;d3_timer(function(){if(timer.c&&tick(elapsed||1)){timer.c=null;timer.t=NaN}return 1},0,time);lock.active=id;transition.event&&transition.event.start.call(node,node.__data__,i);tweens=[];transition.tween.forEach(function(key,value){if(value=value.call(node,node.__data__,i)){tweens.push(value)}});ease=transition.ease;duration=transition.duration}function tick(elapsed){var t=elapsed/duration,e=ease(t),n=tweens.length;while(n>0){tweens[--n].call(node,e)}if(t>=1){transition.event&&transition.event.end.call(node,node.__data__,i);if(--lock.count)delete lock[id];else delete node[ns];return 1}}if(!transition){time=inherit.time;timer=d3_timer(schedule,0,time);transition=lock[id]={tween:new d3_Map,time:time,timer:timer,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i};inherit=null;++lock.count}}d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_;function axis(g){g.each(function(){var g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy();var ticks=tickValues==null?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=tickFormat_==null?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",),tickExit=d3.transition(tick.exit()).style("opacity",).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,tickTransform;var range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign=orient==="top"||orient==="left"?-1:1,x1,x2,y1,y2;if(orient==="bottom"||orient==="top"){tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2";text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize)}else{tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2";text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start");pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize)}lineEnter.attr(y2,sign*innerTickSize);textEnter.attr(y1,sign*tickSpacing);lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize);textUpdate.attr(x1,0).attr(y1,sign*tickSpacing);if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx}}else if(scale0.rangeBand){scale0=scale1}else{tickExit.call(tickTransform,scale1,scale0)}tickEnter.call(tickTransform,scale0,scale1);tickUpdate.call(tickTransform,scale1,scale1)})}axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=d3_array(arguments);return axis};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis};axis.tickSubdivide=function(){return arguments.length&&axis};return axis};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)"})}function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")"})}d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xExtentDomain,yExtentDomain,xClamp=true,yClamp=true,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);var background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden");resize.style("display",brush.empty()?"none":null);var gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background),range;if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate)}if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate)}redraw(gUpdate)})}brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId){d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"})}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"})}}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"})})}else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"})}})};function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")"})}function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0])}function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0])}function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),center,origin=d3.mouse(target),offset;var w=d3.select(d3_window(target)).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches){w.on("touchmove.brush",brushmove).on("touchend.brush",brushend)}else{w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend)}g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1]}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey]}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2}d3_eventPreventDefault()}}function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault()}}function brushmove(){var point=d3.mouse(target),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1]}if(!dragging){if(d3.event.altKey){if(!center)center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2];origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])]}else center=null}if(resizingX&&move1(point,x,0)){redrawX(g);moved=true}if(resizingY&&move1(point,y,1)){redrawY(g);moved=true}if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"})}}function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0],min,max;if(dragging){r0-=position;r1-=size+position}min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging){max=(min+=position)+size}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position}else{max=position}}if(extent[0]!=min||extent[1]!=max){if(i)yExtentDomain=null;else xExtentDomain=null;extent[0]=min;extent[1]=max;return true}}function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"})}}brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;if(x&&y)xClamp=!!z[0],yClamp=!!z[1];else if(x)xClamp=!!z;else if(y)yClamp=!!z;return brush};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x){if(xExtentDomain){x0=xExtentDomain[0],x1=xExtentDomain[1]}else{x0=xExtent[0],x1=xExtent[1];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t}}if(y){if(yExtentDomain){y0=yExtentDomain[0],y1=yExtentDomain[1]}else{y0=yExtent[0],y1=yExtent[1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t}}return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1]}if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];xExtentDomain=[x0,x1];if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;if(x0!=xExtent[0]||x1!=xExtent[1])xExtent=[x0,x1]}if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];yExtentDomain=[y0,y1];if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;if(y0!=yExtent[0]||y1!=yExtent[1])yExtent=[y0,y1]}return brush};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null}return brush};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1]};return d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];var d3_time_format=d3_time.format=d3_locale_enUS.timeFormat;var d3_time_formatUtc=d3_time_format.utc;var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString()}d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(Math.floor(date/1e3)*1e3)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3)},function(date){return date.getSeconds()});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(Math.floor(date/6e4)*6e4)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4)},function(date){return date.getMinutes()});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date((Math.floor(date/36e5-timezone)+timezone)*36e5)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5)},function(date){return date.getHours()});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date},function(date,offset){date.setMonth(date.getMonth()+offset)},function(date){return date.getMonth()});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x)}scale.invert=function(x){return d3_time_scaleDate(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale};function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6}),count)[2]]:!i?[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]:methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i]}scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=interval==null?tickMethod(extent,10):typeof interval==="number"&&tickMethod(extent,interval);if(method)interval=method[0],skip=method[1];function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length}return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){while(skipped(date=interval.floor(date)))date=d3_time_scaleDate(date-1);return date},ceil:function(date){while(skipped(date=interval.ceil(date)))date=d3_time_scaleDate(+date+1);return date}}:interval))};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=interval==null?tickMethod(extent,10):typeof interval==="number"?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];if(method)interval=method[0],skip=method[1];return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip)};scale.tickFormat=function(){return format};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format)};return d3_scale_linearRebind(scale,linear)}function d3_time_scaleDate(t){return new Date(t)}var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]];var d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds()}],[":%S",function(d){return d.getSeconds()}],["%I:%M",function(d){return d.getMinutes()}],["%I %p",function(d){return d.getHours()}],["%a %d",function(d){return d.getDay()&&d.getDate()!=1}],["%b %d",function(d){return d.getDate()!=1}],["%B",function(d){return d.getMonth()}],["%Y",d3_true]]);var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate)},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat)};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]]});var d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds()}],[":%S",function(d){return d.getUTCSeconds()}],["%I:%M",function(d){return d.getUTCMinutes()}],["%I %p",function(d){return d.getUTCHours()}],["%a %d",function(d){return d.getUTCDay()&&d.getUTCDate()!=1}],["%b %d",function(d){return d.getUTCDate()!=1}],["%B",function(d){return d.getUTCMonth()}],["%Y",d3_true]]);d3_time_scaleUtcMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat)};d3.text=d3_xhrType(function(request){return request.responseText});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)};function d3_json(request){return JSON.parse(request.responseText)}d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText)}d3.xml=d3_xhrType(function(request){return request.responseXML});if(typeof define==="function"&&define.amd)this.d3=d3,define(d3);else if(typeof module==="object"&&module.exports)module.exports=d3;else this.d3=d3}();(function(){var d3_selectionPrototype=d3.selection.prototype,d3_selection_on=d3_selectionPrototype.on;var shims={tap:[["touchstart","touchend","touchmove"],tap]};var pointer=null,touchStarted=false,curX=0,curY=0,cachedX=0,cachedY=0;d3_selectionPrototype.on=function(type,listener,capture){var bits=type.split("."),eventType=bits.shift(),shim=shims[eventType];if(shim){var types=shim[0],self=this;listener=shim[1].call(null,listener);types.forEach(function(d,i){var eType=[d,bits].join(".");d3_selection_on.call(self,eType,listener,capture)});return d3_selection_on}else{return d3_selection_on.apply(this,arguments)}};function tap(callback){return function(){if(d3.event.type==="touchstart"){pointer=getPointerEvent(d3.event);cachedX=curX=pointer.pageX;cachedY=curY=pointer.pageY;touchStarted=true;var ev=d3.event;setTimeout(function(){if(cachedX===curX&&!touchStarted&&cachedY===curY){d3.event=ev;callback.apply(this,arguments)}},200)}if(d3.event.type==="touchend"&&touchStarted){touchStarted=false}if(d3.event.type==="touchmove"&&touchStarted){pointer=getPointerEvent(d3.event);curX=pointer.pageX;curY=pointer.pageY}}}function getPointerEvent(event){return event.touches?event.touches[0]:event}dv=function(){};dv.version="3.2.0";dv.ANIMATION=true;dv.FADE_IN_LABELS=true;dv.setVisibilityForeground=function(d3Selection){return d3Selection.classed({visibilityForeground:true,visibilityWaning:false,visibilityHidden:false})};dv.setVisibilityWaning=function(d3Selection){return d3Selection.classed({visibilityForeground:false,visibilityWaning:true,visibilityHidden:false})};dv.setVisibilityHidden=function(d3Selection){return d3Selection.classed({visibilityForeground:false,visibilityWaning:false,visibilityHidden:true})};var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;dv.extend=function(subClass){var _super=this.prototype;initializing=true;var prototype=new this;subClass=subClass();subClass.init=subClass;initializing=false;for(var prop in subClass){prototype[prop]=typeof subClass[prop]=="function"&&typeof _super[prop]=="function"&&fnTest.test(subClass[prop])?function(prop,fn){return function(){var tmp=this._super;this._super=_super[prop];var ret=fn.apply(this,arguments);this._super=tmp;return ret}}(prop,subClass[prop]):subClass[prop]}function Class(){if(!initializing){initializing=true;var clazz=new arguments.callee;initializing=false;clazz.init.apply(clazz,arguments);return clazz}}Class.prototype=prototype;Class.mixin=function(name,value){if(dv.util.isObject(name)){dv.util.each(name,function(mixin,name){prototype[name]=value})}else{prototype[name]=value}};Class.extend=arguments.callee;return Class};dv.DEFAULT_COLORS=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];dv.DEFAULT_CATEGORICAL_AES=["color","fill","stroke","shape","size","linetype"];dv.absoluteCoordinates=function(chart,posWithinPlot,panel){if(chart.coord()instanceof dv.coord.polar){var xScale=chart.coord().flip()?panel.yOuterScale():panel.xOuterScale(),yScale=chart.coord().flip()?panel.xOuterScale():panel.yOuterScale(),xRange=dv.util.scaleRangeNoReverse(xScale),yRange=dv.util.scaleRangeNoReverse(yScale);posWithinPlot[0]+=(xRange[0]+xRange[1])/2;posWithinPlot[1]+=(yRange[0]+yRange[1])/2}return posWithinPlot};dv.showTooltip=function(targetRect,boundaryRect,content,orientation,padding,parent){var tipDiv=parent.selectAll(".dv-tooltip").data([targetRect]);targetRect.cx=targetRect.cx||targetRect.x+targetRect.width/2;targetRect.cy=targetRect.cy||targetRect.y+targetRect.height/2;targetRect.dx=targetRect.dx||targetRect.x+targetRect.width;targetRect.dy=targetRect.dy||targetRect.y+targetRect.height;boundaryRect.dx=boundaryRect.dx||boundaryRect.x+boundaryRect.width;boundaryRect.dy=boundaryRect.dy||boundaryRect.y+boundaryRect.height;var tipDivEnter=tipDiv.enter().append("div").classed("dv-tooltip",true).style("top",0).style("left",0);tipDivEnter.append("div").classed("content",true);tipDivEnter.append("b").classed("notch",true);tipDiv.select(".content").html("");if(typeof content!=="string"){tipDiv.select(".content").node().appendChild(content)}else{tipDiv.select(".content").html(content)}var tipDivNotch=tipDiv.select(".notch");var tipNode=tipDiv.node(),width=Math.min(tipNode.offsetWidth,boundaryRect.width),height=Math.min(tipNode.offsetHeight,boundaryRect.height),top=0,left=0,clamp=function(val,min,max){return Math.min(Math.max(min,val),max)};var setTopAndLeft=function(orientation){var tempLeft,tempTop;switch(orientation){case"left":tempLeft=targetRect.x-width-padding;tempTop=targetRect.cy-height/2;break;case"right":tempLeft=targetRect.x+targetRect.width+padding;tempTop=targetRect.cy-height/2;break;case"top":tempLeft=targetRect.cx-width/2;tempTop=targetRect.y-height-padding;break;case"bottom":tempLeft=targetRect.cx-width/2;tempTop=targetRect.dy+padding;break}return{left:tempLeft,top:tempTop}};var snapVertical=function(){if(top<boundaryRect.y)top=boundaryRect.y;if(top+height>boundaryRect.dy)top=boundaryRect.dy-height;tipDivNotch.style("top",clamp(targetRect.cy-top-5,3,height-13)+"px");tipDivNotch.style("left",null)};var snapHorizontal=function(){if(left<boundaryRect.x)left=boundaryRect.x;if(left+width>boundaryRect.dx)left=boundaryRect.dx-width;tipDivNotch.style("left",clamp(targetRect.cx-left-5,3,width-13)+"px");tipDivNotch.style("top",null)};var determineNextViableOrientation=function(){var dimensions;var invalidOrientations=[],orientationPreference;switch(orientation){case"left":orientationPreference=["left","right","top","bottom"];break;case"right":orientationPreference=["right","left","top","bottom"];break;case"top":orientationPreference=["top","bottom","left","right"];break;case"bottom":orientationPreference=["bottom","top","left","right"];break}dimensions=setTopAndLeft("left");if(dimensions.left<boundaryRect.x){invalidOrientations.push("left")}dimensions=setTopAndLeft("right");if(dimensions.left+width>boundaryRect.dx){invalidOrientations.push("right")}dimensions=setTopAndLeft("top");if(dimensions.top<boundaryRect.y){invalidOrientations.push("top")}dimensions=setTopAndLeft("bottom");if(dimensions.top+height>boundaryRect.dy){invalidOrientations.push("bottom")}return orientationPreference.filter(function(el){return invalidOrientations.indexOf(el)<0})[0]};var nextViableOrientation=determineNextViableOrientation();if(nextViableOrientation){orientation=nextViableOrientation}var dimensions=setTopAndLeft(orientation);left=dimensions.left;top=dimensions.top;if(orientation==="left"||orientation==="right"){snapVertical()}else{snapHorizontal()}tipDiv.classed("top right left bottom hide",false).classed(orientation,true);tipDivEnter.style("top",top+"px").style("left",left+"px");tipDiv.style("top",top+"px").style("left",left+"px")};dv.removeTooltip=function(parent){parent.selectAll(".dv-tooltip").classed("hide",true)};dv.cancelEvent=function(e){e.stopPropagation();e.preventDefault()};dv.windowDimensions=function(){var size={width:640,height:480};if(document.body&&document.body.offsetWidth){size.width=document.body.offsetWidth;size.height=document.body.offsetHeight}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){size.width=document.documentElement.offsetWidth;size.height=document.documentElement.offsetHeight}if(window.innerWidth&&window.innerHeight){size.width=window.innerWidth;size.height=window.innerHeight}return size};dv.addWindowResizeHandler=function(func){window.addEventListener("resize",func)};dv.removeWindowResizeHandler=function(func){window.removeEventListener("resize",func)};dv.passiveListenerOption=function(){try{var option={passive:true};document.addEventListener("null",null,option);return option}catch(e){return false}}();dv.scale=dv.extend(function(){function scale(d3Scale){this._d3Scale=d3Scale;this._reverse=false;this._parse=dv.util.identity;this._includeInDomain=function(){return true}}scale._mapToD3Scale=function(val){return this._d3Scale(val)};scale.trainingProperties=function(val){if(!arguments.length){if(this._trainingProperties)return this._trainingProperties;if(this._property)return[this._property];return undefined}if(!dv.util.isValidValue(val,["isUndefined","isArray"]))dv.log.error({msg:"The supplied properties is not an array",data:{range:val}});this._trainingProperties=val;return this};scale.trainDomain=function(data,options){var domain=this.calculateDomain(data,options);this.domain(domain);return domain};scale.parse=function(val){if(!arguments.length)return this._parse;this._parse=val;return this};scale.applyRangePadding=function(){};scale.validateDomain=function(){};scale.mapToProp=function(obj){var val=obj[this.property()],self=this;if(dv.util.isArray(val)){return dv.util.map(val,function(d){return self._mapToD3Scale.call(self,d)})}return this._mapToD3Scale.call(this,val)};scale.mapPropToPercent=function(obj){return this.mapValueToPercent(this.mapToProp(obj))};scale.mapValueToPercent=function(val){var range=dv.util.scaleRange(this),denom=range[1]-range[0];if(dv.util.isArray(val)){return dv.util.map(val,function(d){return denom?(d-range[0])/denom:0})}return denom?(val-range[0])/denom:0};scale.mapValue=function(val){if(dv.util.isArray(val)){var self=this;return dv.util.map(val,function(d){return self._mapToD3Scale.call(self,d)})}return this._mapToD3Scale.call(this,val)};scale.invertValue=function(val){return this._d3Scale.invert(val)};scale.rangeBand=function(val){return 0};scale.reverse=function(val){if(!arguments.length)return this._reverse;this._reverse=val;return this};scale.property=function(val){if(!arguments.length)return this._property;this._property=val;return this};scale.mapping=function(val){if(!arguments.length)return this._mapping;this._mapping=val;return this};scale.domain=function(val){if(!arguments.length)return this._d3Scale.domain();if(!this._d3Scale)return this;this._d3Scale.domain(val);return this};scale.hasSameDomain=function(d){var retVal=true,domain=this.domain();if(domain.length!=d.length){retVal=false}else{for(var i=0;i<d.length;i++){if(d[i]!=domain[i]){retVal=false;break}}}return retVal};scale.range=function(val){if(!arguments.length)return this._d3Scale.range();if(!this._d3Scale)return this;if(!dv.util.isValidValue(val,["isArray"]))dv.log.error({msg:"The supplied range is not an array",data:{range:val}});this._d3Scale.range(val);return this};scale.expand=function(val){if(!arguments.length)return this._expand;this._expand=val;return this};scale.limits=function(val){if(!arguments.length)return this._limits;this._limits=val;return this};scale.breaks=function(val){if(!arguments.length)return this._breaks;this._breaks=val;return this};scale.orientation=function(val){if(!arguments.length)return this._orientation;this._orientation=val;return this};scale.includeInDomain=function(val){if(!arguments.length)return this._includeInDomain;this._includeInDomain=val;return this};scale.scaleIndex=function(val){if(!arguments.length)return this._scaleIndex;this._scaleIndex=val;return this};scale._copy=function(){dv.log.error({msg:"A copy function was not specified for the scale subclass."})};scale.copy=scale._copy;scale.isDefault=function(val){if(!arguments.length)return this._isDefault;this._isDefault=val;return this};return scale});dv.scale.constant=dv.scale.extend(function(){function constant(){this._super(null)}constant.trainDomain=function(data){return};constant.map=function(val){return this._value};constant.mapToProp=function(val){return this._value};constant.value=function(val){if(!arguments.length)return this._value;this._value=val;return this};constant._copy=function(val){var trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);return dv.scale.constant().isDefault(this.isDefault()).value(this.value()).property(this.property()).trainingProperties(trainProps).scaleIndex(this._scaleIndex)};constant.copy=constant._copy;return constant});dv.scale.continuous=dv.scale.extend(function(){function continuous(scale){this._super(scale?scale:d3.scale.linear());this.to=this.range;this._parse=function(d){if(d==null){return undefined}return parseFloat(d)}}continuous.calculateDomain=function(data,options){var domain=[],self=this,_min,_max;if(!this.trainingProperties())this.trainingProperties([this.property()]);var trainingProps=this.trainingProperties();if(!options)options={};if(!data)data=[];for(var p=0;p<trainingProps.length;p++){var prop=trainingProps[p];for(var j=0;j<data.length;j++){if(!options.filter||!options.filter.call(this,data[j].key)){var series=data[j].values;for(var i=0;i<series.length;i++){var dataObj=series[i];if(!this._includeInDomain(dataObj,i,j))continue;if(this.scaleIndex()!==0)dataObj[this.property()+"-index"]=this.scaleIndex();var val=options.stack?dataObj.y0:dataObj[prop];if(!dv.util.isArray(val)){val=this._parse.call(this,val)}var minVal=dv.util.isArray(val)?d3.min(val):val;_min=dv.util.isUndefined(_min)||isNaN(_min)||minVal<_min?minVal:_min;if(options.stack){var addVal=dataObj[prop];val+=dv.util.isArray(addVal)?d3.max(addVal):self._parse.call(this,addVal)}var maxVal=dv.util.isArray(val)?d3.max(val):val;_max=dv.util.isUndefined(_max)||isNaN(_max)||maxVal>_max?maxVal:_max}}}}if(isNaN(_min)&&isNaN(_max)){domain=[];this._naturalDomain=[]}else{domain=[_min,_max];this._naturalDomain=[_min,_max]}if(options.fill){domain=[0,100]}if(!dv.util.isUndefined(this._upperLimit)&&!dv.util.isFunction(this._upperLimit)&&!dv.util.isUndefined(this._lowerLimit)&&!dv.util.isFunction(this._lowerLimit)){domain=this.limits()}else{this._reconcileLimits(domain)}return domain};continuous.unionDomain=function(scale,isReversed){if(!scale||!(scale instanceof dv.scale.continuous)){dv.log.error({msg:"The supplied scale is not continuous.",data:{scale:scale,isReversed:isReversed}})}var domain=scale.domain(),naturalDomain=scale.naturalDomain(),unionedDomain=this.domain()?d3.extent(this.domain().concat(domain)):d3.extent(domain),unionedNatDomain=this._naturalDomain?d3.extent(this._naturalDomain.concat(naturalDomain)):d3.extent(naturalDomain);if(isNaN(unionedDomain[0])&&isNaN(unionedDomain[1])){unionedDomain=[]}if(isNaN(unionedNatDomain[0]&&isNaN(unionedNatDomain[1]))){unionedNatDomain=[]}this.reverse(isReversed||this._reverse);this.domain(unionedDomain);this._naturalDomain=unionedNatDomain;return this};continuous.validateDomain=function(){var domain=this.domain();if(!domain||!domain.length){this.domain([0,1])}};continuous.unionRange=function(range){if(!dv.util.isValidValue(range,["isArray"]))dv.log.error({msg:"The supplied range is not an array",data:{range:range}});this.range(this.range()?d3.extent(this.range().concat(range)):range);return this};continuous.applyRangePadding=function(){var domain=this.domain(),range=this.range();if(this._lowerRangePadding){var lExtent=range[0]-range[1],lrp=Math.min(Math.abs(lExtent)-1,this._lowerRangePadding);domain[0]=this.invertValue(lExtent/(Math.abs(lExtent)-lrp)*lrp+range[0])}if(this._upperRangePadding){var uExtent=range[1]-range[0],urp=Math.min(Math.abs(uExtent)-1,this._upperRangePadding);domain[1]=this.invertValue(uExtent/(Math.abs(uExtent)-urp)*urp+range[1])}this.domain(domain);return this};continuous.upperLimit=function(val){if(!arguments.length)return this._upperLimit;if(dv.util.isValidValue(val,["isUndefined","isFinite","isDate","isFunction"]))this._upperLimit=val;else dv.log.error({msg:"Invalid value, cannot set upperLimit with: "+val});return this};continuous.lowerLimit=function(val){if(!arguments.length)return this._lowerLimit;if(dv.util.isValidValue(val,["isUndefined","isFinite","isDate","isFunction"]))this._lowerLimit=val;else dv.log.error({msg:"Invalid value, cannot set lowerLimit with: "+val});return this};continuous.limits=function(val){if(!arguments.length)return[this._lowerLimit,this._upperLimit];if(!val||val.length!=2)dv.log.error({msg:"Incorrect number of arguments, the limits function must supply an array containing both a lower and upper limit"});this.lowerLimit(val[0]);this.upperLimit(val[1]);return this};continuous.naturalDomain=function(){return this._naturalDomain};continuous.upperRangePadding=function(val){if(!arguments.length)return this._upperRangePadding;if(dv.util.isValidValue(val,["isUndefined","isFinite","isDate","isFunction"]))this._upperRangePadding=val;else dv.log.error({msg:"Invalid value, cannot set upperRangePadding with: "+val});return this};continuous.lowerRangePadding=function(val){if(!arguments.length)return this._lowerRangePadding;if(dv.util.isValidValue(val,["isUndefined","isFinite","isDate","isFunction"]))this._lowerRangePadding=val;else dv.log.error({msg:"Invalid value, cannot set lowerRangePadding with: "+val});return this};continuous.rangePadding=function(val){if(!arguments.length)return[this._lowerRangePadding,this._upperRangePadding];if(!val||val.length!=2)dv.log.error({msg:"Incorrect number of arguments, the limits function must supply an array containing both a lower and upper limit"});this.lowerRangePadding(val[0]);this.upperRangePadding(val[1]);return this};continuous.softLowerLimit=function(val){if(!arguments.length)return this._softLowerLimit;this._softLowerLimit=val;return this};continuous._reconcileLimits=function(domain){if(!domain.length)return;if(!dv.util.isUndefined(this._softLowerLimit)){domain[0]=Math.min(domain[0],this._softLowerLimit);domain[1]=Math.max(domain[1],this._softLowerLimit)}if(!dv.util.isUndefined(this._lowerLimit))domain[0]=dv.util.isFunction(this._lowerLimit)?this._lowerLimit(domain[0],domain[1]):this._lowerLimit;if(!dv.util.isUndefined(this._upperLimit))domain[1]=dv.util.isFunction(this._upperLimit)?this._upperLimit(domain[0],domain[1]):this._upperLimit};continuous.labels=function(val){if(!arguments.length)return this._labels;this._labels=val;return this};continuous._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.continuous().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).reverse(this.reverse()).domain(domain).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).trainingProperties(trainProps).scaleIndex(this._scaleIndex);scale._naturalDomain=this._naturalDomain;return scale};continuous.invert=function(obj){return this._d3Scale.invert(obj[this.mapping()])};continuous.invertFromProp=function(obj){return this._d3Scale.invert(obj[this.property()])};continuous.copy=continuous._copy;return continuous});dv.scale.linear=dv.scale.continuous.extend(function(){function linear(){this._super(d3.scale.linear())}linear._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.linear().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(trainProps).scaleIndex(this._scaleIndex);scale._naturalDomain=this._naturalDomain;return scale};linear.copy=linear._copy;return linear});dv.scale.gradient=dv.scale.continuous.extend(function(){function gradient(){this._super(d3.scale.linear());this._innerScale=d3.scale.linear().range([0,1]);this.colors=this.range;this._controlPoints=["0%","50%","100%"];this.colors(["#FA5A50","#E1E1E1","#5FAF69"])}gradient._adjustOuterDomain=function(){var self=this;this._d3Scale.domain(dv.util.map(this._controlPoints,function(d,i){return dv.util.isPercentString(d)?self._innerScale.invert(parseInt(d,10)/100):d}))};gradient.controlPoints=function(val){if(!arguments.length)return this._controlPoints;this._controlPoints=val;this._adjustOuterDomain();return this};gradient.domain=function(val){if(!arguments.length)return this._innerScale.domain();if(!this._innerScale)return this;this._innerScale.domain(val);this._adjustOuterDomain();return this};gradient._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.gradient().property(this.property()).mapping(this.mapping()).domain(domain).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).includeInDomain(this.includeInDomain()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).controlPoints(this.controlPoints()).reverse(this.reverse()).trainingProperties(trainProps).scaleIndex(this._scaleIndex);scale._naturalDomain=this._naturalDomain;return scale};gradient.copy=gradient._copy;return gradient});dv.scale.time=dv.scale.continuous.extend(function(){function time(){this._super(d3.time.scale());this._parse=function(d){return d instanceof Date?d:new Date(Date.parse(d))}}time._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.time().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(trainProps).scaleIndex(this._scaleIndex);scale._naturalDomain=this._naturalDomain;return scale};time.copy=time._copy;time._reconcileLimits=function(domain,min,max){if(!dv.util.isUndefined(this._softLowerLimit)){domain[0]=Math.min(domain[0],this._softLowerLimit);domain[1]=Math.max(domain[1],this._softLowerLimit)}if(!dv.util.isUndefined(this._lowerLimit))domain[0]=dv.util.isFunction(this._lowerLimit)?this._parse(this._lowerLimit(new Date(min),new Date(max))):this._lowerLimit;if(!dv.util.isUndefined(this._upperLimit))domain[1]=dv.util.isFunction(this._upperLimit)?this._parse(this._upperLimit(new Date(min),new Date(max))):this._upperLimit};return time});dv.scale.time.utc=dv.scale.continuous.extend(function(){function utc(){this._super(d3.time.scale.utc());this._parse=function(d){return d instanceof Date?d:new Date(Date.parse(d))}}utc._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.time.utc().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(trainProps).scaleIndex(this._scaleIndex);scale._naturalDomain=this._naturalDomain;return scale};utc.copy=utc._copy;utc._reconcileLimits=function(domain,min,max){if(!dv.util.isUndefined(this._softLowerLimit)){domain[0]=Math.min(domain[0],this._softLowerLimit);domain[1]=Math.max(domain[1],this._softLowerLimit)}if(!dv.util.isUndefined(this._lowerLimit))domain[0]=dv.util.isFunction(this._lowerLimit)?this._parse(this._lowerLimit(new Date(min),new Date(max))):this._lowerLimit;if(!dv.util.isUndefined(this._upperLimit))domain[1]=dv.util.isFunction(this._upperLimit)?this._parse(this._upperLimit(new Date(min),new Date(max))):this._upperLimit};return utc});dv.scale.ordinal=dv.scale.extend(function(){function ordinal(){this._super(d3.scale.ordinal());this._defaultPadding=.1;this._defaultOuterPadding=0;this._rangeExtent=[];this._rangeBandsSet=false}ordinal._mapToD3Scale=function(val){var domain=this.domain(),i=-1,n=domain.length,index=-1;while(++i<n){var d=domain[i];if(d===val||dv.util.isDate(d)&&dv.util.isDate(val)&&d.getTime()===val.getTime()){index=i;break}}return index<0?undefined:this._d3Scale(val)};ordinal.calculateDomain=function(data,options){var uniqValues={};var tuple=[],trainingProps=this.trainingProperties();options=options||{};for(var p=0;p<trainingProps.length;p++){var prop=trainingProps[p];for(var j=0;j<data.length;j++){var values=data[j].values;if(!options.filter||!options.filter.call(this,data[j].key)){for(var i=0;i<values.length;i++){var dataObj=values[i];if(!this._includeInDomain(dataObj,i))continue;if(this.scaleIndex()!==0)dataObj[this.property()+"-index"]=this.scaleIndex();var val=this._parse.call(this,dataObj[prop]);if(!dv.util.isUndefined(val)&&!uniqValues.hasOwnProperty(val)){uniqValues[val]=val;tuple.push(val)}}}}}return tuple.length?tuple:[]};ordinal.unionDomain=function(scale,isReversed){if(!scale||!(scale instanceof dv.scale.ordinal)){dv.log.error({msg:"The supplied scale is not ordinal.",data:{scale:scale,isReversed:isReversed}})}var domain=scale.domain();if(domain&&!dv.util.isArray(domain))throw new Error("The supplied domain is not an array");if(domain){this.reverse(isReversed||this._reverse);this.domain(this.domain()?dv.util.union(this.domain(),domain):domain)}return this};ordinal.unionRange=function(range){if(range&&!dv.util.isArray(range))throw new Error("The supplied range is not an array");if(range){this.range(this.range()?dv.util.union(this.range(),range):range)}return this};ordinal.invertValue=function(val){var index=this.range().indexOf(val),domain=this.domain();if(index<0)throw new Error("The supplied value does not exist in the specified range.");return domain[index%domain.length]};ordinal.padding=function(val){if(!arguments.length)return dv.util.isUndefined(this._padding)?this._defaultPadding:this._padding;this._padding=val;if(this._rangeBandsSet){this._d3Scale.rangeBands(this.rangeExtent(),this._padding,this.outerPadding())}return this};ordinal.outerPadding=function(val){if(!arguments.length){return dv.util.isUndefined(this._outerPadding)?dv.util.isUndefined(this._padding)?this._defaultOuterPadding:this.padding():this._outerPadding}this._outerPadding=val;if(this._rangeBandsSet){this._d3Scale.rangeBands(this.rangeExtent(),this.padding(),this._outerPadding)}return this};ordinal.rangeBands=function(val){if(!arguments.length)return this._d3Scale.range();this._rangeBandsSet=true;this._d3Scale.rangeBands(val,this.padding(),this.outerPadding());this.rangeExtent(val);return this};ordinal.rangeBand=function(){return this._d3Scale.rangeBand()};ordinal.range=function(val){if(!arguments.length)return this._d3Scale.range();if(!this._d3Scale)return this;if(!dv.util.isValidValue(val,["isArray"]))dv.log.error({msg:"The supplied range is not an array",data:{range:val}});this._d3Scale.range(val);this.rangeExtent([val[0],val[val.length-1]]);return this};ordinal.rangeExtent=function(val){if(!arguments.length)return this._rangeExtent;if(!dv.util.isValidValue(val,["isArray"]))dv.log.error({msg:"The supplied range extent is not an array",data:{range:val}});this._rangeExtent=val;return this};ordinal.values=function(val){if(!arguments.length)return this._d3Scale.range();if(!dv.util.isValidValue(val,["isArray"]))dv.log.error({msg:"The supplied values is not an array",data:{range:val}});return this.range(val)};ordinal.drop=function(val){if(!arguments.length)return this._drop;this._drop=val;return this};ordinal._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).rangeExtent(this.rangeExtent().slice(0)).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(trainProps).scaleIndex(this._scaleIndex);if(this._rangeBandsSet){scale.rangeBands(this.rangeExtent().slice(0))}return scale};ordinal.copy=ordinal._copy;return ordinal});dv.scale.color=dv.scale.ordinal.extend(function(){var dv_qualitative16=["#8CC350","#5A6EAA","#D755A5","#1EBED7","#F0A01E","#9B8CE6","#3CB5A0","#3287D2","#F0557D","#C3D250","#EB782D","#78B4F5","#5FAF69","#AA5FA5","#FA5A50","#F5C841"];function color(){this._super();this.range(dv_qualitative16)}color._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).range(this.range()).rangeExtent(this.rangeExtent()).includeInDomain(this.includeInDomain()).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(trainProps).scaleIndex(this._scaleIndex);if(this._rangeBandsSet){scale.rangeBands(this.rangeExtent().slice(0)).padding(this._padding).outerPadding(this._outerPadding)}return scale};color.copy=color._copy;return color});dv.scale.shape=dv.scale.ordinal.extend(function(){var dv_shape=["circle","cross","diamond","square","triangle-down","triangle-up"];function shape(){this._super();this.range(dv_shape)}shape._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).rangeExtent(this.rangeExtent().slice(0)).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(trainProps).scaleIndex(this._scaleIndex);if(this._rangeBandsSet){scale.rangeBands(this.rangeExtent().slice(0)).padding(this._padding).outerPadding(this._outerPadding)}return scale};shape.copy=shape._copy;return shape});dv.scale.linetype=dv.scale.ordinal.extend(function(){var dv_linetype=["solid","dashed","dotted","dotdash","longdash","twodash"];function linetype(){this._super();this.range(dv_linetype)}linetype._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.ordinal().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).rangeExtent(this.rangeExtent().slice(0)).reverse(this.reverse()).padding(this._padding).outerPadding(this._outerPadding).trainingProperties(trainProps).scaleIndex(this._scaleIndex);if(this._rangeBandsSet){scale.rangeBands(this.rangeExtent().slice(0)).padding(this._padding).outerPadding(this._outerPadding)}return scale};linetype.copy=linetype._copy;return linetype});dv.scale.size=dv.scale.continuous.extend(function(){function size(){this._super();this.to([2,10])}size._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.size().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(trainProps).scaleIndex(this._scaleIndex);scale._naturalDomain=this._naturalDomain;return scale};size.copy=size._copy;return size});dv.scale.identity=dv.scale.ordinal.extend(function(){function identity(scale){this._super(d3.scale.ordinal())}identity.mapToProp=function(obj){return obj[this.property()]};identity.domain=function(val){if(!arguments.length)return this._d3Scale.domain();if(!this._d3Scale)return this;this._d3Scale.domain(val);this._d3Scale.range(val);return this};identity.range=function(){if(!arguments.length)return this._d3Scale.range();return this};identity.labels=function(val){if(!arguments.length)return this._labels;this._labels=val;return this};identity._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);return dv.scale.identity().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(trainProps).scaleIndex(this._scaleIndex)};identity.copy=identity._copy;return identity});dv.scale.log=dv.scale.continuous.extend(function(){function log(){this._super(d3.scale.log())}log._copy=function(){var domain=this.domain().slice(0),trainProps=this.trainingProperties();if(!dv.util.isUndefined(trainProps))trainProps=trainProps.slice(0);var scale=dv.scale.log().isDefault(this.isDefault()).property(this.property()).mapping(this.mapping()).domain(domain).includeInDomain(this.includeInDomain()).upperLimit(this.upperLimit()).lowerLimit(this.lowerLimit()).upperRangePadding(this.upperRangePadding()).lowerRangePadding(this.lowerRangePadding()).softLowerLimit(this.softLowerLimit()).range(this.range().slice(0)).reverse(this.reverse()).trainingProperties(trainProps).scaleIndex(this._scaleIndex);scale._naturalDomain=this._naturalDomain;return scale};log.domain=function(val){if(val){var extent=d3.extent(val);if(extent[0]<=0&&extent[1]>=0){throw new Error('Data mapped to the logarithmic "'+this.property()+'" property must be entirely positive or entirely negative. The data values cannot cross zero.')}}return this._super.apply(this,arguments)};log.copy=log._copy;return log});dv.svg=dv.svg||{};dv.svg.text=function(){var x=dv_svg_textX,y=dv_svg_textY,label=dv_svg_textLabel,defined=dv_svg_textDefined,duration=dv_svg_textDuration;function text(selection){return selection.select(function(d,i){return defined.call(this,d,i)?this:null}).attr("x",function(d,i){return x.call(this,d,i)}).attr("y",function(d,i){return y.call(this,d,i)}).text(function(d,i){return label.call(this,d,i)})}text.x=function(val){if(!arguments.length)return x;x=val;return text};text.y=function(val){if(!arguments.length)return y;y=val;return text};text.label=function(val){if(!arguments.length)return label;label=val;return text};text.defined=function(val){if(!arguments.length)return defined;defined=val;return text};text.duration=function(val){if(!arguments.length)return duration;duration=val;return text};return text};dv.svg.text.radial=function(){var angle=dv_svg_textX,radius=dv_svg_textY,label=dv_svg_textLabel,defined=dv_svg_textDefined,duration=dv_svg_textDuration;function text(selection){var a=function(d,i){return angle.call(this,d,i)+dv_svg_arcOffset},r=function(d,i){return radius.call(this,d,i)};return selection.select(function(d,i){return defined.call(this,d,i)?this:null}).attr("x",function(d,i){return r(d,i)*Math.cos(a(d,i))}).attr("y",function(d,i){return r(d,i)*Math.sin(a(d,i))}).text(function(d,i){return label.call(this,d,i)})}text.angle=function(val){if(!arguments.length)return angle;angle=val;return text};text.radius=function(val){if(!arguments.length)return radius;radius=val;return text};text.label=function(val){if(!arguments.length)return label;label=val;return text};text.defined=function(val){if(!arguments.length)return defined;defined=val;return text};text.duration=function(val){if(!arguments.length)return duration;duration=val;return text};return text};function dv_svg_textX(d){return d[0]}function dv_svg_textY(d){return d[1]}function dv_svg_textLabel(d){return d[2]}function dv_svg_textDefined(){return true}function dv_svg_textDuration(){return 0}dv.svg.rect=function(){var x0=dv_svg_rectX0,x1=dv_svg_rectX1,y0=dv_svg_rectY0,y1=dv_svg_rectY1,defined=dv_svg_rectDefined;function rect(d,i){if(defined.call(this,d,i)){return dv_svg_rect(x0.call(this,d,i),x1.call(this,d,i),y0.call(this,d,i),y1.call(this,d,i))}return null}rect.x0=function(val){if(!arguments.length)return x0;x0=val;return rect};rect.x1=function(val){if(!arguments.length)return x1;x1=val;return rect};rect.y0=function(val){if(!arguments.length)return y0;y0=val;return rect};rect.y1=function(val){if(!arguments.length)return y1;y1=val;return rect};rect.defined=function(x){if(!arguments.length)return defined;defined=x;return rect};return rect};function dv_svg_rectX0(d){return d[0]}function dv_svg_rectX1(d){return d[1]}function dv_svg_rectY0(d){return d[2]}function dv_svg_rectY1(d){return d[3]}function dv_svg_rectDefined(){return true}function dv_svg_rect(x0,x1,y0,y1){return"M"+x0+","+y0+"L"+x1+","+y0+"L"+x1+","+y1+"L"+x0+","+y1+"Z"}dv.svg.symbol=function(){var type=dv_svg_symbolType,size=dv_svg_symbolSize,x=dv_svg_symbolX,y=dv_svg_symbolY,defined=dv_svg_symbolDefined;function symbol(d,i){if(defined.call(this,d,i)){return(dv_svg_symbols[type.call(this,d,i)]||dv_svg_symbols.circle)(size.call(this,d,i),x.call(this,d,i),y.call(this,d,i))}return null}symbol.x=function(val){if(!arguments.length)return x;x=val;return symbol};symbol.y=function(val){if(!arguments.length)return y;y=val;return symbol};symbol.type=function(x){if(!arguments.length)return type;type=d3.functor(x);return symbol};symbol.size=function(x){if(!arguments.length)return size;size=d3.functor(x);return symbol};symbol.defined=function(x){if(!arguments.length)return defined;defined=x;return symbol};return symbol};dv.svg.symbol.radial=function(){var type=dv_svg_symbolType,size=dv_svg_symbolSize,angle=dv_svg_symbolX,radius=dv_svg_symbolY,defined=dv_svg_symbolDefined;function symbol(d,i){if(defined.call(this,d,i)){var a=angle.call(this,d,i)+dv_svg_arcOffset,r=radius.call(this,d,i),x=r*Math.cos(a),y=r*Math.sin(a);return(dv_svg_symbols[type.call(this,d,i)]||dv_svg_symbols.circle)(size.call(this,d,i),x,y)}return null}symbol.angle=function(val){if(!arguments.length)return angle;angle=val;return symbol};symbol.radius=function(val){if(!arguments.length)return radius;radius=val;return symbol};symbol.type=function(x){if(!arguments.length)return type;type=d3.functor(x);return symbol};symbol.size=function(x){if(!arguments.length)return size;size=d3.functor(x);return symbol};symbol.defined=function(x){if(!arguments.length)return defined;defined=x;return symbol};return symbol};d3.svg.symbolTypes=d3.keys(dv_svg_symbols);var dv_svg_symbols={circle:function(size,x,y){var r=Math.sqrt(size/Math.PI);return"M"+x+","+(y+r)+"A"+r+","+r+" 0 1,1 "+x+","+(y-r)+"A"+r+","+r+" 0 1,1 "+x+","+(y+r)+"Z"},cross:function(size,x,y){var r=Math.sqrt(size/5)/2;return"M"+(x+-3*r)+","+(y-r)+"H"+(x-r)+"V"+(y+-3*r)+"H"+(x+r)+"V"+(y-r)+"H"+(x+3*r)+"V"+(y+r)+"H"+(x+r)+"V"+(y+3*r)+"H"+(x-r)+"V"+(y+r)+"H"+(x-3*r)+"Z"},diamond:function(size,x,y){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M"+x+","+(y-ry)+"L"+(x+rx)+","+y+" "+x+","+(y+ry)+" "+(x-rx)+","+y+"Z"},square:function(size,x,y){var r=Math.sqrt(size)/2;return"M"+(x-r)+","+(y-r)+"L"+(x+r)+","+(y-r)+" "+(x+r)+","+(y+r)+" "+(x-r)+","+(y+r)+"Z"},"triangle-down":function(size,x,y){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M"+x+","+(y+ry)+"L"+(x+rx)+","+(y-ry)+" "+(x-rx)+","+(y-ry)+"Z"},"triangle-up":function(size,x,y){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M"+x+","+(y-ry)+"L"+(x+rx)+","+(y+ry)+" "+(x-rx)+","+(y+ry)+"Z"}};function dv_svg_symbolSize(){return 64}function dv_svg_symbolType(){return"circle"}function dv_svg_symbolX(d){return d[0]}function dv_svg_symbolY(d){return d[1]}function dv_svg_symbolDefined(d){return true}dv.svg.errorBar=function(){var x0=dv_svg_errorBarX0,x1=dv_svg_errorBarX1,y0=dv_svg_errorBarY0,y1=dv_svg_errorBarY1,flip=dv_svg_errorBarFlip,defined=dv_svg_errorBarDefined;function errorBar(d,i){if(defined.call(this,d,i)){return dv_svg_errorBar(x0.call(this,d,i),x1.call(this,d,i),y0.call(this,d,i),y1.call(this,d,i),flip.call(this,d,i))}return null}errorBar.x0=function(val){if(!arguments.length)return x0;x0=val;return errorBar};errorBar.x1=function(val){if(!arguments.length)return x1;x1=val;return errorBar};errorBar.y0=function(val){if(!arguments.length)return y0;y0=val;return errorBar};errorBar.y1=function(val){if(!arguments.length)return y1;y1=val;return errorBar};errorBar.flip=function(val){if(!arguments.length)return flip;flip=val;return errorBar};errorBar.defined=function(x){if(!arguments.length)return defined;defined=x;return errorBar};return errorBar};function dv_svg_errorBarX0(d){return d[0]}function dv_svg_errorBarX1(d){return d[1]}function dv_svg_errorBarY0(d){return d[2]}function dv_svg_errorBarY1(d){return d[3]}function dv_svg_errorBarFlip(){return false}function dv_svg_errorBarDefined(){return true}function dv_svg_errorBar(x0,x1,y0,y1,flip){var mid;if(flip){mid=y0+(y1-y0)/2;return"M"+x0+","+y0+"L"+x0+","+y1+"M"+x0+","+mid+"L"+x1+","+mid+"M"+x1+","+y0+"L"+x1+","+y1}else{mid=x0+(x1-x0)/2;return"M"+x0+","+y0+"L"+x1+","+y0+"M"+mid+","+y0+"L"+mid+","+y1+"M"+x0+","+y1+"L"+x1+","+y1}}var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*Math.PI/180);var dv_svg_arcOffset=-Math.PI/2;dv.svg.poly=function(){var defined=dv_svg_polyDefined,xs=dv_svg_poly_Xs,ys=dv_svg_poly_Ys;function poly(d,i){if(defined.call(this,d,i)){return dv_svg_poly(xs.call(this,d,i),ys.call(this,d,i))}return null}poly.xs=function(val){if(!arguments.length)return xs;xs=val;return poly};poly.ys=function(val){if(!arguments.length)return ys;ys=val;return poly};poly.defined=function(val){if(!arguments.length)return defined;defined=val;return defined};return poly};dv.svg.poly.radial=function(){var defined=dv_svg_polyDefined,angles=dv_svg_poly_Xs,radii=dv_svg_poly_Ys;function poly(d,i){if(defined.call(this,d,i)){var angs=angles.call(this,d,i);var rads=radii.call(this,d,i);var max_i=d3.max([angs.length,rads.length]);var rval="M";for(var j=0;j<max_i;j++){if(j>0){rval+="L"}var a=angs[j]+dv_svg_arcOffset,r=rads[j],x=r*Math.cos(a),y=r*Math.sin(a);rval+=j<angs.length?x:"0";rval+=",";rval+=j<rads.length?y:"0"}rval+="Z";return rval}return null}poly.angles=function(val){if(!arguments.length)return angles;angles=val;return poly};poly.radii=function(val){if(!arguments.length)return radii;radii=val;return poly};poly.defined=function(val){if(!arguments.length)return defined;defined=val;return defined};return poly};function dv_svg_polyDefined(d){return true}function dv_svg_poly_Xs(d){return d[0]}function dv_svg_poly_Ys(d){return d[1]}function dv_svg_poly(xs,ys){var max_i=d3.max([xs.length,ys.length]);var rval="M";for(var i=0;i<max_i;i++){if(i>0){rval+="L"}rval+=i<xs.length?xs[i]:"0";rval+=",";rval+=i<ys.length?ys[i]:"0"}rval+="Z";return rval}dv.util={};dv.util.filterAndZip=function(data,filterKey,filterValue){var sampleArray=[],result=[];if(!filterKey){for(var k in data){sampleArray=data[k];break}}else{sampleArray=data[filterKey]}var i=-1,len=sampleArray.length;while(++i<len){var cursor=sampleArray[i];if(!filterValue||cursor==filterValue){var sliceObj={};for(var k2 in data){if(k2==="data"){sliceObj[k2]={};for(var k3 in data[k2]){sliceObj[k2][k3]=data[k2][k3][i]}}else{sliceObj[k2]=data[k2][i]}}result.push(sliceObj)}}return result};dv.util.binaryCompare=function(a,x,f,lo,hi){var tempLo=lo;if(arguments.length<4)tempLo=0;if(arguments.length<5)hi=a.length;while(tempLo<hi){var mid=tempLo+hi>>1;if(x<f(a[mid]))hi=mid;else tempLo=mid+1}if(tempLo==lo||Math.abs(f(a[tempLo])-x)<Math.abs(f(a[tempLo-1])-x))return tempLo;else return tempLo-1};dv.util.uniqueValues=function(array,comparator){var results=[];dv.util.each(array,function(value,index){var i=-1,n=results.length,found=false;while(++i<n){var seenVal=results[i];if(comparator(value,seenVal)){found=true;break}}if(!found){results.push(array[i])}});return results};dv.util.scaleRange=function(scale,range){if(arguments.length===1)return scale.rangeExtent?scale.rangeExtent():scale.range();if(scale.rangeExtent)scale.rangeBands(range);else scale.range(range);return scale};dv.util.minRangeDistance=function(prop,nestData){var minDistanceBetweenPoints=Number.MAX_VALUE,value,previousValue;dv.util.each(nestData,function(seriesData){dv.util.each(seriesData.values,function(pointData){value=pointData.panel.xScale(pointData).mapValue(pointData[prop]);if(!dv.util.isUndefined(previousValue)){minDistanceBetweenPoints=Math.min(minDistanceBetweenPoints,Math.abs(value-previousValue))}previousValue=value})});return minDistanceBetweenPoints};dv.util.scaleRangeNoReverse=function(scale){return scale.rangeExtent?scale.rangeExtent():dv.util.scaleExtent(scale.range())};dv.util.scaleExtent=function(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]};dv.util.merge=function(obj1,obj2){var retVal={};var prop;for(prop in obj1){retVal[prop]=obj1[prop]}for(prop in obj2){retVal[prop]=obj2[prop]}return retVal};dv.util.getPercentValue=function(value,relativeValue){return dv.util.isPercentString(value)?relativeValue*parseInt(value,10)/100:value};dv.util.isPercentString=function(value){return typeof value==="string"&&/^(-?[0-9]+)%$/.test(value)};dv.util.isValidValue=function(val,tests){for(var i=0;i<tests.length;i++){if(dv.util[tests[i]](val))return true}return false};dv.util.identity=function(value){return value};dv.util.clamp=function(val,min,max){return Math.min(Math.max(val,min),max)};dv.util.clone=function(obj){if(!dv.util.isObject(obj))return obj;return dv.util.isArray(obj)?obj.slice():dv.util.extend({},obj)};dv.util.isArray=function(obj){if(Array.isArray)return Array.isArray(obj);return Object.prototype.toString.call(obj)=="[object Array]"};dv.util.isObject=function(obj){return obj===Object(obj)};dv.util.isFunction=function(obj){return Object.prototype.toString.call(obj)=="[object Function]"};dv.util.isUndefined=function(obj){return obj===void 0};dv.util.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};dv.util.isDate=function(obj){return obj instanceof Date};dv.util.isEmpty=function(obj){return Object.keys(obj).length===0};dv.util.extend=function(obj){dv.util.each(Array.prototype.slice.call(arguments,1),function(source){for(var prop in source){obj[prop]=source[prop]}});return obj};dv.util.each=function(obj,iterator,context){if(obj==null)return;if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)==={})return}}else{for(var key in obj){if(dv.util.has(obj,key)){if(iterator.call(context,obj[key],key,obj)==={})return}}}};dv.util.has=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)};dv.util.uniq=function(array,isSorted,iterator,context){if(dv.util.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?dv.util.map(array,iterator,context):array;var results=[];var seen=[];dv.util.each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!dv.util.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};dv.util.union=function(){return dv.util.uniq(Array.prototype.concat.apply(Array.prototype,arguments))};dv.util.contains=function(obj,target){if(obj==null)return false;if(Array.prototype.indexOf&&obj.indexOf===Array.prototype.indexOf)return obj.indexOf(target)!=-1;return dv.util.any(obj,function(value){return value===target})};dv.util.any=function(obj,iterator,context){if(!iterator)iterator=dv.util.identity;var result=false;if(obj==null)return result;if(Array.prototype.some&&obj.some===Array.prototype.some)return obj.some(iterator,context);dv.util.each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return{}})};dv.util.sortBy=function(obj,value,context){var lookupIterator=function(value){return dv.util.isFunction(value)?value:function(obj){return obj[value]}};var iterator=lookupIterator(value);return dv.util.pluck(dv.util.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index<right.index?-1:1}),"value")};dv.util.pluck=function(obj,key){return dv.util.map(obj,function(value){return value[key]})};dv.util.map=function(obj,iterator,context){var results=[];if(obj===null)return results;if(Array.prototype.map&&obj.map===Array.prototype.map)return obj.map(iterator,context);dv.util.each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)});return results};dv.util.reduce=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj===null)obj=[];if(Array.prototype.reduce&&obj.reduce===Array.prototype.reduce){if(context)iterator=dv.util.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}dv.util.each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo};dv.util.bind=function(func,context){if(func.bind===Function.prototype.bind&&Function.prototype.bind)return Function.prototype.bind.apply(func,Array.prototype.slice.call(arguments,1));var args=Array.prototype.slice.call(arguments,2);return function(){return func.apply(context,args.concat(Array.prototype.slice.call(arguments)))}};dv.util.noop=function(){};dv.util.each(["Arguments","String","Number","RegExp"],function(name){dv.util["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});dv.util.validateParam=function(param,type,range,defaultVal){if(type==="isString"){if(dv.util.isString(param)){if(dv.util.isArray(range)&&range.indexOf(param.toLowerCase())!==-1)return param.toLowerCase()}return defaultVal}else if(type==="isNumber"){if(dv.util.isNumber(param)){if(dv.util.isArray(range)&&(param<=range[1]&&param>=range[0]))return param}return defaultVal}else if(type==="isFunction"){if(dv.util.isFunction(param))return param;return defaultVal}else if(type==="isDimension"){if(param==="x"||param==="X")return"x";if(param==="y"||param==="Y")return"y";if(param===["x","y"]||param===["X","y"]||param===["x","Y"]||param===["X","Y"])return["x","y"];return defaultVal}else if(type==="isRange"){var minVal=range[0],maxVal=range[1];if(dv.util.isArray(param)&&param.length===2){if(dv.util.isNumber(param[0])&&dv.util.isNumber(param[1])){minVal=Math.max(Math.min(param[0],param[1]),range[0]);maxVal=Math.min(Math.max(param[0],param[1]),range[1])}return[minVal,maxVal]}return defaultVal}};dv.util.selectModifiers={toggle:1,set:2,range:4};dv.util.defaultSelectionKeymap=function(event){var chord=0;chord=chord|(event.metaKey?dv.util.selectModifiers.toggle:0);chord=chord|(event.ctrlKey?dv.util.selectModifiers.toggle:0);chord=chord|(event.shiftKey?dv.util.selectModifiers.range:0);chord=chord|(event.altKey?dv.util.selectModifiers.set:0);return chord};dv.util.determineKeyModifiers=function(event,keymap){var evt=event;while(evt.sourceEvent)evt=evt.sourceEvent;if(keymap){return keymap(evt)}return dv.util.defaultSelectionKeymap(evt)};dv.util.arraysEqual=function(array1,array2){if(array1.length!=array2.length){return false}for(var i=0,ii=array1.length;i<ii;i++){if(array2.indexOf(array1[i])===-1){return false}}return true};dv.util.selectJoin=function(selectionA,selectionB){selectionA.classed("joinme",true);selectionB.classed("joinme",true);var output=d3.selectAll(".joinme");selectionA.classed("joinme",false);selectionB.classed("joinme",false);return output};dv.util.selectXOR=function(selectionA,selectionB){var aExclusive=selectANotB(selectionA,selectionB);var bExclusive=selectANotB(selectionB,selectionA);return join(aExclusive,bExclusive)};dv.util.selectIntersection=function(selectionA,selectionB){return selectionA.filter(function(){var that=this;var output=0;selectionB.each(function(){if(this===that){output=1}});return output})};dv.util.selectANotB=function(selectionA,selectionB){return selectionA.filter(function(){var that=this;var output=1;selectionB.each(function(){if(this===that){output=0}});return output})};dv.util.SelectionCache=function(){this._lastSelected=null;this._dispatch=d3.dispatch("selectionChanged");this._selectionScope=d3;this._keymap=dv.util.defaultSelectionKeymap};dv.util.SelectionCache.prototype.selectionKeymap=function(keymap){if(keymap)this._keymap=keymap;return this._keymap};dv.util.SelectionCache.prototype.selectionScope=function(sel){if(!sel){return this._selectionScope}if(!sel.selectAll){throw new TypeError("sel argument does not appear to support d3 selection.")}this._selectionScope=sel};dv.util.SelectionCache.prototype.currentSelection=function(){return this._selectionScope.selectAll("."+this.selectedClass)};dv.util.SelectionCache.prototype.selectedClass="selected";dv.util.SelectionCache.prototype.selectableClass="selectable";dv.util.SelectionCache.prototype.markSelectable=function(selection){selection.classed(this.selectableClass,true)};dv.util.SelectionCache.prototype.selectSelectableCandidates=function(){this._selectionScope.selectAll("."+this.selectableClass)};dv.util.SelectionCache.prototype._onSelectionChanged=function(source,added,removed){removed.classed(this.selectedClass,false);added.classed(this.selectedClass,true);var lastSelected=null;var self=this;added.each(function(d){lastSelected=this});this._lastSelected=lastSelected;this._dispatch.selectionChanged.call(this,lastSelected,this.currentSelection(),added,removed)};dv.util.SelectionCache.prototype.on=function(eventName,handler){this._dispatch.on(eventName,handler);return this};dv.util.SelectionCache.prototype.selectionToggle=function(items){if(!items||items.empty()){return this}var currentSelection=this.currentSelection();if(currentSelection.empty()){return this.selectionSet(items)}var deselectedNodes=[];var selectedNodes=[];items.each(function(d){if(d.selected){d.selected=false;deselectedNodes.push(this)}else{d.selected=true;selectedNodes.push(this)}});var selected=d3.selectAll(selectedNodes);var deselected=d3.selectAll(deselectedNodes);this._onSelectionChanged(this,selected,deselected);return this};dv.util.SelectionCache.prototype.selectionSet=function(items){var self=this;var currentSelection=this.currentSelection();var deselected=null;if(!currentSelection.empty()){deselected=currentSelection}else{deselected=d3.selectAll([])}deselected.each(function(d){d.selected=false});items.each(function(d){d.selected=true});self._onSelectionChanged(self,items,deselected);return self};dv.util.SelectionCache.prototype.selectionAdd=function(items){var self=this;if(!items||items.empty()){return self}var currentSelection=this.currentSelection();if(currentSelection.empty()){return self.selectionSet(items)}var wholeSelection=[];currentSelection.each(function(d){wholeSelection.push(this)});items.each(function(d){d.selected=true;wholeSelection.push(this)});d3.selectAll(wholeSelection);self._onSelectionChanged(self,items,d3.selectAll([]));return self};dv.util.SelectionCache.prototype.selectionRemove=function(items){var self=this;if(!items||items.empty()){return self}items.each(function(d){d.selected=false});self._onSelectionChanged(self,d3.selectAll([]),items);return self};dv.util.SelectionCache.prototype.savePreviousState=function(selection){var op=function(d){d.previouslySelected=d.selected};if(selection){selection.each(op)}else{var selectables=this.selectSelectableCandidates();selectables.each(op)}return this};dv.util.SelectionCache.prototype.brush=function(items){var self=this;var deselected=[];var selected=[];var chord=dv.util.determineKeyModifiers(d3.event,self._keymap);var currentSelection=this.currentSelection();var oldSelection=dv.util.selectANotB(currentSelection,items);var previouslyBrushed=this._selectionScope.select(".brushed");var noLongerBrushed=dv.util.selectANotB(previouslyBrushed,items);function nonbrushed(d){d.selected=d.previouslySelected;return d.selected}function nonbrushedset(d){d.selected=false;return d.selected}function brushadd(d){d.selected=true;return true}function brushtoggle(d){d.selected=!d.previouslySelected;return d.selected}var includedBehavior=brushadd;var excludedBehavior=nonbrushed;if(chord&dv.util.selectModifiers.toggle){includedBehavior=brushtoggle}if(chord&dv.util.selectModifiers.set){excludedBehavior=nonbrushedset}items.each(function(d){if(d.selected!=includedBehavior(d)){if(d.selected){selected.push(this)}else{deselected.push(this)}}});oldSelection.each(function(d){if(d.selected!=excludedBehavior(d)){if(d.selected){selected.push(this)}else{deselected.push(this)}}});noLongerBrushed.each(function(d){if(d.selected!=excludedBehavior(d)){if(d.selected){selected.push(this)}else{deselected.push(this)}}});items.classed("brushed",true);noLongerBrushed.classed("brushed",false);var deselection=d3.selectAll(deselected);var selection=d3.selectAll(selected);self._onSelectionChanged(self,selection,deselection);return self};dv.util.SelectionCache.prototype.setDeselector=function(parent){var self=this;parent.on("click.selection",function(){var chord=dv.util.determineKeyModifiers(d3.event,self._keymap);if(chord){self.selectionSet(d3.selectAll([]))}});return this};dv.util=dv.util||{};dv.util.svg={};dv.util.svg.getDasharray=function(key){if(key.indexOf(",")!=-1||key.indexOf(" ")!=-1)return key;if(dv_dasharray.hasOwnProperty(key))return dv_dasharray[key];throw new Error("The dashed line format is invalid")};var dv_dasharray={solid:"",dashed:"7,4",dotted:"2,3",dotdash:"2,3,7,4",longdash:"11,4",twodash:"5,2,11,2"};dv.container=dv.extend(function(){var dv_container_defaultScales={x:dv.scale.linear,y:dv.scale.linear,yMin:dv.scale.linear,yMax:dv.scale.linear,xMin:dv.scale.linear,xMax:dv.scale.linear,color:dv.scale.color,fill:dv.scale.color,stroke:dv.scale.color,alpha:dv.scale.linear,shape:dv.scale.shape,size:dv.scale.size,radius:dv.scale.linear,group:dv.scale.ordinal,linetype:dv.scale.linetype,label:dv.scale.identity};function container(){this._aes={}}container.render=function(){throw new Error("render() must be implemented in a subclass")};container._calculateStats=function(){throw new Error("_calculateStats() must be implemented in a subclass")};container._handlePositions=function(){throw new Error("_handlePositions() must be implemented in a subclass")};container.getTrainedScale=function(prop){throw new Error("getTrainedScale() must be implemented in a subclass")};container.getExplicitScalesMap=function(){return this._aes};container._normalizeData=function(data){if(data.hasOwnProperty("data")&&!dv.util.isArray(data.data))return data;var normalizedData={},map=this.getExplicitScalesMap(),scale,self=this;dv.util.each(map,function(d,i){for(var scaleIndex in d){scale=d[scaleIndex];if(!(scale instanceof dv.scale.constant)){var arr=data[scale.mapping()];if(dv.util.isArray(arr)){var parsedArr=arr.map(function(d){if(dv.util.isArray(d)){return d.map(function(subD){return scale._parse(subD)})}else{return scale._parse(d)}});normalizedData[scale.property()]=parsedArr}}}});normalizedData.data=data;return normalizedData};container.map=function(property,mapping,scale,scaleIndex){if(!scale)scale=dv_container_defaultScales[property]().copy().isDefault(true);if(!scale)throw new Error("There is no default scale associated with this property. Either the property isn't valid or the scale default doesn't exist.");if(arguments.length<4)scaleIndex=0;if(!this._aes[property])this._aes[property]={};this._aes[property][scaleIndex]=scale.property(property).mapping(mapping).scaleIndex(scaleIndex);return this};container.set=function(property,val){if(!this._aes[property])this._aes[property]={};var scale=this._aes[property][0]=dv.scale.constant();if(dv.util.isFunction(val)){scale.map=scale.mapToProp=val}else scale.value(val);return this};container.on=function(eventType,callback,capture){if(arguments.length<3){capture=false}var adding=callback&&dv.util.isFunction(callback);if(adding){this.eventMap=this.eventMap||{};this.eventMap[eventType]={callback:callback,capture:capture}}else{if(this.eventMap)delete this.eventMap[eventType];this.unregisterEventMap=this.unregisterEventMap||{};this.unregisterEventMap[eventType]=capture}this._removeRegisteredEvents();this._addRegisteredEvents();return this};container.position=function(val){if(!arguments.length)return this._chart&&!this._position?this._chart.position():this._position;this._position=val;return this};container.delay=function(val){if(!arguments.length)return this._chart&&dv.util.isUndefined(this._delay)?this._chart.delay():this._delay;this._delay=d3.functor(val);return this};container.duration=function(val){if(!arguments.length)return this._chart&&dv.util.isUndefined(this._duration)?this._chart.duration():this._duration;this._duration=d3.functor(val);return this};container.ease=function(val){if(!arguments.length)return this._chart&&dv.util.isUndefined(this._ease)?this._chart.ease():this._ease;this._ease=val;return this};return container});dv.coord=dv.extend(function(){function coord(){this._flip=false}coord.flip=function(val){if(!arguments.length)return this._flip;this._flip=val;return this};coord.startX=function(val){if(!arguments.length)return this._startX;if(!dv.util.isValidValue(val,["isFinite","isPercentString"]))dv.log.error({msg:"Invalid value type, startX/startAngle must be a number or percent string",data:{val:val}});this._startX=val;return this};coord.endX=function(val){if(!arguments.length)return this._endX;if(!dv.util.isValidValue(val,["isFinite","isPercentString"]))dv.log.error({msg:"Invalid value type, endX/endAngle must be a number or percent string",data:{val:val}});this._endX=val;return this};coord.startY=function(val){if(!arguments.length)return this._startY;if(!dv.util.isValidValue(val,["isFinite","isPercentString"]))dv.log.error({msg:"Invalid value type, startY/innerRadius must be a number or percent string",data:{val:val}});this._startY=val;return this};coord.endY=function(val){if(!arguments.length)return this._endY;if(!dv.util.isValidValue(val,["isFinite","isPercentString"]))dv.log.error({msg:"Invalid value type, endY/outerRadius must be a number or percent string",data:{val:val}});this._endY=val;return this};return coord});dv.coord.cartesian=dv.coord.extend(function(){function cartesian(){this._super();this.startX(0);this.endX(0);this.startY(0);this.endY(0);this._type="cartesian"}cartesian._translatePercentToX=function(scale,percent){var range=dv.util.scaleRange(scale),val=this._translatePercent(percent,range,this.startX(),this.endX()),rangeDist=Math.abs(range[1]-range[0])*3;return dv.util.clamp(val,range[0]-rangeDist,range[1]+rangeDist)};cartesian._translatePercentToY=function(scale,percent){var range=dv.util.scaleRange(scale),val=this._translatePercent(percent,range,this.startY(),this.endY()),rangeDist=Math.abs(range[1]-range[0])*3;return dv.util.clamp(val,range[1]-rangeDist,range[0]+rangeDist)};cartesian._translatePercent=function(percent,range,start,end){return(range[1]-range[0]-end-start)*percent+start+range[0]};cartesian._translatePercentArrToY=function(scale,percentArr){var self=this;return dv.util.map(percentArr,function(percent){return self._translatePercentToY(scale,percent)})};cartesian._translatePercentArrToX=function(scale,percentArr){var self=this;return dv.util.map(percentArr,function(percent){return self._translatePercentToX(scale,percent)})};cartesian._text=function(){var self=this;function text(){var renderer=dv.svg.text();if(self._flip){return renderer.x(function(d,i){return self._translatePercentToY(d.panel.yOuterScale(),text.y()(d,i))}).y(function(d,i){return self._translatePercentToX(d.panel.xOuterScale(),text.x()(d,i))})}else{return renderer.x(function(d,i){return self._translatePercentToX(d.panel.xOuterScale(),text.x()(d,i))}).y(function(d,i){return self._translatePercentToY(d.panel.yOuterScale(),text.y()(d,i))})}}text.x=function(val){if(!arguments.length)return this._x;this._x=val;return this};text.y=function(val){if(!arguments.length)return this._y;this._y=val;return this};return text};cartesian._point=function(){var self=this,point={};point.renderer=dv.svg.symbol().x(function(d,i){return d.bounds.x}).y(function(d,i){return d.bounds.y});point.getBounds=function(d,i){if(!d.hasOwnProperty("y"))d.y=0;if(!d.hasOwnProperty("x"))d.x=0;if(!point._defined(d,i))return null;if(self._flip){d.bounds={x:self._translatePercentToY(d.panel.yOuterScale(),point.y()(d,i)),y:self._translatePercentToX(d.panel.xOuterScale(),point.x()(d,i))}}else{d.bounds={x:self._translatePercentToX(d.panel.xOuterScale(),point.x()(d,i)),y:self._translatePercentToY(d.panel.yOuterScale(),point.y()(d,i))}}return d};point.getPath=function(obj){return obj===null||obj.bounds===undefined?null:point.renderer(obj)};point.x=function(val){if(!arguments.length)return this._x;this._x=val;return point};point.y=function(val){if(!arguments.length)return this._y;this._y=val;return point};point.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return point};cartesian._line=function(){var self=this,line={};line.renderer=d3.svg.line().x(function(d,i){return d.bounds.x}).y(function(d,i){return d.bounds.y});line.getBounds=function(seriesD,seriesI){var retVal=[];dv.util.each(seriesD,function(d,i){if(!d.hasOwnProperty("y"))d.y=0;if(!d.hasOwnProperty("x"))d.x=0;if(line._defined(d,i)){if(self._flip){d.bounds={x:self._translatePercentToY(d.panel.yOuterScale(),line.y()(d,i)),y:self._translatePercentToX(d.panel.xOuterScale(),line.x()(d,i))}}else{d.bounds={x:self._translatePercentToX(d.panel.xOuterScale(),line.x()(d,i)),y:self._translatePercentToY(d.panel.yOuterScale(),line.y()(d,i))}}retVal.push(seriesD[i])}});return retVal};line.getPath=function(obj){return obj===null?null:line.renderer(obj)};line.x=function(val){if(!arguments.length)return this._x;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.x must be a function",data:{val:val}});this._x=val;return this};line.y=function(val){if(!arguments.length)return this._y;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.y must be a function",data:{val:val}});this._y=val;return this};line.defined=function(val){if(!arguments.length)return this._defined;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.defined must be a function",data:{val:val}});this._defined=val;return this};return line};cartesian._area=function(){var self=this,area={};area.renderer=d3.svg.area();area.getBounds=function(seriesD,seriesI){var sd=[];area.setupRenderer();dv.util.each(seriesD,function(d,i){if(!d.hasOwnProperty("y"))d.y=0;if(!d.hasOwnProperty("x"))d.x=0;if(area._defined(d,i)){var newD=dv.util.clone(d);newD.bounds={x:self._translatePercentToX(d.panel.xOuterScale(),area.x()(d,i)),y0:self._translatePercentToY(d.panel.yOuterScale(),area.y0()(d,i)),y1:self._translatePercentToY(d.panel.yOuterScale(),area.y1()(d,i))};sd.push(newD)}});return sd};area.getPath=function(obj){area.setupRenderer();return obj===null?null:area.renderer(obj)};area.setupRenderer=function(){if(self._flip){area.renderer.x(null).y0(null).y1(null).y(function(d,i){return d.bounds.x}).x0(function(d,i){return d.bounds.y0}).x1(function(d,i){return d.bounds.y1})}else{area.renderer.y(null).x0(null).x1(null).x(function(d,i){return d.bounds.x}).y0(function(d,i){return d.bounds.y0}).y1(function(d,i){return d.bounds.y1})}};area.x=function(val){if(!arguments.length)return this._x;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, area.x must be a function",data:{val:val}});this._x=val;return this};area.y0=function(val){if(!arguments.length)return this._y0;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, area.y0 must be a function",data:{val:val}});this._y0=val;return this};area.y1=function(val){if(!arguments.length)return this._y1;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, area.y1 must be a function",data:{val:val}});this._y1=val;return this};area.defined=function(val){if(!arguments.length)return this._defined;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, area.defined must be a function",data:{val:val}});this._defined=val;return this};return area};cartesian._rect=function(){var self=this,rect={};rect.renderer=dv.svg.rect().x0(function(d,i){return d.bounds.x0}).x1(function(d,i){return d.bounds.x1}).y0(function(d,i){return d.bounds.y0}).y1(function(d,i){return d.bounds.y1});rect.getBounds=function(d,i){var newD=dv.util.clone(d);var xVal=newD[d.panel.xScale(d).property()];if(dv.util.isArray(xVal)){newD.x0=xVal[0];newD.x1=xVal[1]}var yVal=newD[d.panel.yScale(d).property()];if(dv.util.isArray(yVal)){newD.y0=yVal[0];newD.y1=yVal[1]}if(!rect._defined(newD,i))return null;if(self._flip){newD.bounds={x0:self._translatePercentToY(d.panel.yOuterScale(),rect.y0()(newD,i)),x1:self._translatePercentToY(d.panel.yOuterScale(),rect.y1()(newD,i)),y0:self._translatePercentToX(d.panel.xOuterScale(),rect.x0()(newD,i)),y1:self._translatePercentToX(d.panel.xOuterScale(),rect.x1()(newD,i))}}else{newD.bounds={x0:self._translatePercentToX(d.panel.xOuterScale(),rect.x0()(newD,i)),x1:self._translatePercentToX(d.panel.xOuterScale(),rect.x1()(newD,i)),y0:self._translatePercentToY(d.panel.yOuterScale(),rect.y0()(newD,i)),y1:self._translatePercentToY(d.panel.yOuterScale(),rect.y1()(newD,i))}}return newD};rect.getPath=function(obj){return obj===null?null:rect.renderer(obj)};rect.x0=function(val){if(!arguments.length)return this._x0;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.x0 must be a function",data:{val:val}});this._x0=val;return this};rect.x1=function(val){if(!arguments.length)return this._x1;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.x1 must be a function",data:{val:val}});this._x1=val;return this};rect.y0=function(val){if(!arguments.length)return this._y0;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.y0 must be a function",data:{val:val}});this._y0=val;return this};rect.y1=function(val){if(!arguments.length)return this._y1;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.y1 must be a function",data:{val:val}});this._y1=val;return this};rect.defined=function(val){if(!arguments.length)return this._defined;if(!dv.util.isValidValue(val,["isFunction"]))dv.log.error({msg:"Invalid value, line.defined must be a function",data:{val:val}});this._defined=val;return this};return rect};cartesian._errorBar=function(){var self=this,errorBar={};errorBar.renderer=dv.svg.errorBar().x0(function(d,i){return d.bounds.x0}).x1(function(d,i){return d.bounds.x1}).y0(function(d,i){return d.bounds.y0}).y1(function(d,i){return d.bounds.y1}).flip(function(){return self._flip});errorBar.getBounds=function(d,i){var newD=dv.util.clone(d);if(!errorBar._defined(newD,i))return null;if(self._flip){newD.bounds={x0:self._translatePercentToY(d.panel.yOuterScale(),errorBar.y0()(newD,i)),x1:self._translatePercentToY(d.panel.yOuterScale(),errorBar.y1()(newD,i)),y0:self._translatePercentToX(d.panel.xOuterScale(),errorBar.x0()(newD,i)),y1:self._translatePercentToX(d.panel.xOuterScale(),errorBar.x1()(newD,i))}}else{newD.bounds={x0:self._translatePercentToX(d.panel.xOuterScale(),errorBar.x0()(newD,i)),x1:self._translatePercentToX(d.panel.xOuterScale(),errorBar.x1()(newD,i)),y0:self._translatePercentToY(d.panel.yOuterScale(),errorBar.y0()(newD,i)),y1:self._translatePercentToY(d.panel.yOuterScale(),errorBar.y1()(newD,i))}}return newD};errorBar.getPath=function(obj){return obj===null?null:errorBar.renderer(obj)};errorBar.x0=function(val){if(!arguments.length)return this._x0;this._x0=val;return this};errorBar.x1=function(val){if(!arguments.length)return this._x1;this._x1=val;return this};errorBar.y0=function(val){if(!arguments.length)return this._y0;this._y0=val;return this};errorBar.y1=function(val){if(!arguments.length)return this._y1;this._y1=val;return this};errorBar.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return errorBar};cartesian._poly=function(){var self=this,poly={};poly.renderer=dv.svg.poly().xs(function(d,i){return d.bounds.x}).ys(function(d,i){return d.bounds.y});poly.getBounds=function(d,i){var newD=dv.util.clone(d);if(poly._defined(d,i)){if(self._flip){newD.bounds={x:self._translatePercentArrToY(d.panel.yOuterScale(),poly.ys()(d,i)),y:self._translatePercentArrToX(d.panel.xOuterScale(),poly.xs()(d,i))}}else{newD.bounds={x:self._translatePercentArrToX(d.panel.xOuterScale(),poly.xs()(d,i)),y:self._translatePercentArrToY(d.panel.yOuterScale(),poly.ys()(d,i))}}}return newD};poly.getPath=function(obj){return obj===null?null:poly.renderer(obj)};poly.xs=function(val){if(!arguments.length)return this._xs;this._xs=val;return this};poly.ys=function(val){if(!arguments.length)return this._ys;this._ys=val;return this};poly.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return poly};return cartesian});dv.coord.polar=dv.coord.extend(function(){function polar(){this._super();this.innerRadius=this.startY;this.outerRadius=this.endY;this.startAngle=this.startX;this.endAngle=this.endX;this.innerRadius(0);this.outerRadius(0);this.startAngle(0);this.endAngle(360);this._type="polar"}polar._transformAngleRadiusToXY=function(angle,radius){angle+=-1.570796327;return[radius*Math.cos(angle),radius*Math.sin(angle)]};polar._translatePercentToRadius=function(range,percent){var radius=Math.abs(range[1]-range[0])/2,innerRadius=dv.util.getPercentValue(this.innerRadius(),radius),outerRadius=dv.util.getPercentValue(this.outerRadius(),radius);return(radius-outerRadius-innerRadius)*percent+innerRadius};polar._translatePercentToTheta=function(scale,percent){var maxAngle=360,sa=dv.util.getPercentValue(this.startAngle(),maxAngle),ea=dv.util.getPercentValue(this.endAngle(),maxAngle),degrees=(ea-sa)*percent+sa;return degrees*.017453293};polar._translatePercentArrToRadius=function(range,percentArr){var self=this;return dv.util.map(percentArr,function(percent){return self._translatePercentToRadius(range,percent)})};polar._translatePercentArrToTheta=function(scale,percentArr){var self=this;return dv.util.map(percentArr,function(percent){return self._translatePercentToTheta(scale,percent)})};polar._getRadiusRange=function(scale1,scale2){var range1=dv.util.scaleRange(scale1),range2=dv.util.scaleRange(scale2);return[0,Math.min(Math.abs(range1[1]-range1[0]),Math.abs(range2[1]-range2[0]))]};polar._text=function(){var self=this;function text(){var renderer=dv.svg.text.radial();if(self._flip){return renderer.angle(function(d,i){return self._translatePercentToTheta(d.panel.yOuterScale(),text.y()(d,i))}).radius(function(d,i){return self._translatePercentToRadius(self._getRadiusRange(d.panel.xOuterScale(),d.panel.yOuterScale()),text.x()(d,i))})}else{return renderer.angle(function(d,i){return self._translatePercentToTheta(d.panel.xOuterScale(),text.x()(d,i))}).radius(function(d,i){return self._translatePercentToRadius(self._getRadiusRange(d.panel.xOuterScale(),d.panel.yOuterScale()),text.y()(d,i))})}}text.x=function(val){if(!arguments.length)return this._x;this._x=val;return this};text.y=function(val){if(!arguments.length)return this._y;this._y=val;return this};return text};polar._point=function(){var self=this,point={};point.renderer=dv.svg.symbol.radial().angle(function(d,i){return d.bounds.x}).radius(function(d,i){return d.bounds.y});point.getBounds=function(d,i){if(!d.hasOwnProperty("y"))d.y=0;if(!d.hasOwnProperty("x"))d.x=0;if(point._defined(d,i)){var radiusRange=self._getRadiusRange(d.panel.xOuterScale(),d.panel.yOuterScale());if(self._flip){d.bounds={x:self._translatePercentToTheta(d.panel.xOuterScale(),point.y()(d,i)),y:self._translatePercentToRadius(radiusRange,point.x()(d,i))}}else{d.bounds={x:self._translatePercentToTheta(d.panel.xOuterScale(),point.x()(d,i)),y:self._translatePercentToRadius(radiusRange,point.y()(d,i))}}}return d};point.getPath=function(obj){return obj===null||dv.util.isUndefined(obj.bounds)?null:point.renderer(obj)};point.x=function(val){if(!arguments.length)return this._x;this._x=val;return this};point.y=function(val){if(!arguments.length)return this._y;this._y=val;return this};point.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return point};polar._line=function(){var self=this,line={};line.renderer=d3.svg.line.radial().angle(function(d,i){return d.bounds.x}).radius(function(d,i){return d.bounds.y});line.getBounds=function(seriesD,seriesI){var retVal=[];dv.util.each(seriesD,function(d,i){var radiusRange=self._getRadiusRange(d.panel.xOuterScale(),d.panel.yOuterScale());if(!d.hasOwnProperty("y"))d.y=0;if(!d.hasOwnProperty("x"))d.x=0;if(line._defined(d,i)){if(self._flip){d.bounds={x:self._translatePercentToTheta(d.panel.xOuterScale(),line.y()(d,i)),y:self._translatePercentToRadius(radiusRange,line.x()(d,i))}}else{d.bounds={x:self._translatePercentToTheta(d.panel.xOuterScale(),line.x()(d,i)),y:self._translatePercentToRadius(radiusRange,line.y()(d,i))}}retVal.push(seriesD[i])}});return retVal};line.getPath=function(obj){return obj===null?null:line.renderer(obj)};line.x=function(val){if(!arguments.length)return this._x;this._x=val;return this};line.y=function(val){if(!arguments.length)return this._y;this._y=val;return this};line.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return line};polar._area=function(){var self=this,area={};area.renderer=d3.svg.area.radial();area.getBounds=function(seriesD,seriesI){var sd=[];area.setupRenderer();dv.util.each(seriesD,function(d,i){var radiusRange=self._getRadiusRange(d.panel.xOuterScale(),d.panel.yOuterScale());if(!d.hasOwnProperty("y"))d.y=0;if(!d.hasOwnProperty("x"))d.x=0;if(area._defined(d,i)){var newD=dv.util.clone(d);if(self._flip){newD.bounds={x:self._translatePercentToRadius(radiusRange,area.x()(d,i)),y0:self._translatePercentToTheta(d.panel.xOuterScale(),area.y0()(d,i)),y1:self._translatePercentToTheta(d.panel.xOuterScale(),area.y1()(d,i))}}else{newD.bounds={x:self._translatePercentToTheta(d.panel.xOuterScale(),area.x()(d,i)),y0:self._translatePercentToRadius(radiusRange,area.y0()(d,i)),y1:self._translatePercentToRadius(radiusRange,area.y1()(d,i))}}sd.push(newD)}});return sd};area.getPath=function(obj){area.setupRenderer();return obj===null?null:area.renderer(obj)};area.setupRenderer=function(){if(self._flip){area.renderer.angle(null).innerRadius(null).outerRadius(null).radius(function(d,i){return d.bounds.x}).startAngle(function(d,i){return d.bounds.y0}).endAngle(function(d,i){return d.bounds.y1})}else{area.renderer.radius(null).startAngle(null).endAngle(null).angle(function(d,i){return d.bounds.x}).innerRadius(function(d,i){return d.bounds.y0}).outerRadius(function(d,i){return d.bounds.y1})}};area.x=function(val){if(!arguments.length)return this._x;this._x=val;return this};area.y0=function(val){if(!arguments.length)return this._y0;this._y0=val;return this};area.y1=function(val){if(!arguments.length)return this._y1;this._y1=val;return this};area.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return area};polar._rect=function(){var self=this,rect={};rect.renderer=d3.svg.arc().startAngle(function(d,i){return d.bounds.x0}).endAngle(function(d,i){return d.bounds.x1}).innerRadius(function(d,i){return d.bounds.y0}).outerRadius(function(d,i){return d.bounds.y1});rect.getBounds=function(d,i){var newD=dv.util.clone(d);if(!rect._defined(newD,i))return null;var radiusRange=self._getRadiusRange(d.panel.xOuterScale(),d.panel.yOuterScale());if(self._flip){newD.bounds={x0:self._translatePercentToTheta(d.panel.yOuterScale(),rect.y0()(newD,i)),x1:self._translatePercentToTheta(d.panel.yOuterScale(),rect.y1()(newD,i)),y0:self._translatePercentToRadius(radiusRange,rect.x0()(newD,i)),y1:self._translatePercentToRadius(radiusRange,rect.x1()(newD,i))}}else{newD.bounds={x0:self._translatePercentToTheta(d.panel.xOuterScale(),rect.x0()(newD,i)),x1:self._translatePercentToTheta(d.panel.xOuterScale(),rect.x1()(newD,i)),y0:self._translatePercentToRadius(radiusRange,rect.y0()(newD,i)),y1:self._translatePercentToRadius(radiusRange,rect.y1()(newD,i))}}return newD};rect.getPath=function(obj){return obj===null?null:rect.renderer(obj)};rect.x0=function(val){if(!arguments.length)return this._x0;this._x0=val;return this};rect.x1=function(val){if(!arguments.length)return this._x1;this._x1=val;return this};rect.y0=function(val){if(!arguments.length)return this._y0;this._y0=val;return this};rect.y1=function(val){if(!arguments.length)return this._y1;this._y1=val;return this};rect.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return rect};polar._poly=function(){var self=this,poly={};poly.renderer=dv.svg.poly.radial().angles(function(d,i){return d.bounds.x}).radii(function(d,i){return d.bounds.y});poly.getBounds=function(d,i){var newD=dv.util.clone(d);if(poly._defined(d,i)){var radiusRange=self._getRadiusRange(d.panel.xOuterScale(),d.panel.yOuterScale());if(self._flip){newD.bounds={x:self._translatePercentArrToTheta(d.panel.xOuterScale(),poly.ys()(d,i)),y:self._translatePercentArrToRadius(radiusRange,poly.xs()(d,i))}}else{newD.bounds={x:self._translatePercentArrToTheta(d.panel.xOuterScale(),poly.xs()(d,i)),y:self._translatePercentArrToRadius(radiusRange,poly.ys()(d,i))}}}return newD};poly.getPath=function(obj){return obj===null?null:poly.renderer(obj)};poly.xs=function(val){if(!arguments.length)return this._xs;this._xs=val;return this};poly.ys=function(val){if(!arguments.length)return this._ys;this._ys=val;return this};poly.defined=function(val){if(!arguments.length)return this._defined;this._defined=val;return this};return poly};return polar});dv.guide=dv.extend(function(){function guide(){this._renderer=null}guide._render=function(){dv.log.warn({msg:"dv.guide._render should not be called directly, try using dv.guide.legend.render or dv.guide.axis.render"})};guide._scale=function(val){if(!arguments.length)return this.__scale;this.__scale=val;return this};guide.orientation=function(val){if(!arguments.length)return this._orientation;this._orientation=val;return this};guide._parent=function(val){if(!arguments.length)return this.__parent;this.__parent=val;return this};guide.scaleIndex=function(val){if(!arguments.length)return this._scaleIndex;this._scaleIndex=val;return this};guide.title=function(val){if(!arguments.length)return this._title;this._title=val;return this};return guide});dv.guide.axes=dv.extend(function(){function axes(){this._axes={};this._emptyTickFormat=function(){return""}}axes._initializeAxisRenderers=function(){this._eachAxis(function(prop,scaleIndex,axis){if(!axis.hasOwnProperty("_orientation")&&prop==="x"){axis._orientation="bottom"}if(!axis.hasOwnProperty("_orientation")&&prop==="y"){axis._orientation="left"}if(this._chart._coord.flip()){switch(axis._orientation){case"top":axis._orientation="right";break;case"right":axis._orientation="top";break;case"bottom":axis._orientation="left";break;case"left":axis._orientation="bottom";break}}})};axes._measure=function(panel){var parent=this._chart._g.select(".panels"),labelContainer=this._chart._axisLabelContainer;this._eachAxis(function(prop,scaleIndex,axis){var scaleGroup=this._changeScaleRangeToLocal(panel.getOuterScale(prop));if(!(this._chart._coord instanceof dv.coord.polar)&&axis!=="none"){axis._chart(this._chart)._scale(scaleGroup[scaleIndex])._parent(parent)._labelParent(labelContainer);panel.margins(axis._measure(panel.margins(),panel.bounds(),panel))}});return this};axes._getAllOrientations=function(){var orientations={};this._eachAxis(function(prop,scaleIndex,axis){orientations[axis._orientation]=prop});return orientations};axes._render=function(parent,labelParent,panel){this._eachAxis(function(prop,scaleIndex,axis){var scaleGroup=this._changeScaleRangeToLocal(panel.getOuterScale(prop));if(this._chart._coord instanceof dv.coord.polar||axis==="none"){parent.selectAll(".axis-"+prop+".axis-index-"+scaleIndex).transition().duration(this._chart._duration).style("opacity",0).remove();this._chart._chartContainer.select(".axes-labels .axis-"+prop+".axis-index-"+scaleIndex).transition().duration(this._chart._duration).style("opacity",0).remove()}else{axis._chart(this._chart)._parent(parent)._scale(scaleGroup[scaleIndex])._labelParent(labelParent)._render(parent,panel,panel.bounds())}});return this};axes._measureTitles=function(bounds){var parent=this._chart._axisLabelContainer;this._eachAxis(function(prop,scaleIndex,axis){if(axis!=="none"){var axisTitleBounds=axis._chart(this._chart)._measureAxisTitle(parent,prop,scaleIndex,bounds);bounds.left+=axisTitleBounds.left;bounds.top+=axisTitleBounds.top;bounds.right-=axisTitleBounds.right;bounds.bottom-=axisTitleBounds.bottom}});return bounds};axes._renderTitles=function(bounds,originsByOrientation){var parent=this._chart._axisLabelContainer;this._eachAxis(function(prop,scaleIndex,axis){if(axis==="none"||!axis.title()){parent.selectAll(".axis-title-"+prop+".axis-title-index-"+scaleIndex).transition().duration(this._chart._duration).style("opacity",0).remove()}else{axis._chart(this._chart)._renderAxisTitle(parent,originsByOrientation,prop,scaleIndex,bounds)}})};axes._changeScaleRangeToLocal=function(outerScale){var outerScaleRange=outerScale.range();var scaleGroup=outerScale.innerScaleGroup();for(var scaleIndex in scaleGroup){dv.util.scaleRange(scaleGroup[scaleIndex],[outerScaleRange[0],outerScaleRange[1]])}return scaleGroup};axes._eachAxis=function(func){for(var prop in this._axes){var axisGroup=this._axes[prop];for(var scaleIndex in axisGroup){func.call(this,prop,+scaleIndex,axisGroup[scaleIndex])}}};axes._add=function(key,axis,scaleIndex){scaleIndex=scaleIndex===undefined?0:scaleIndex;var axes=this._axes[key];if(!axes){this._axes[key]=axes={}}axes[scaleIndex]=axis;return this};axes._axes=function(val){if(!arguments.length)return this._axes;this._axes=val;return this};axes._get=function(key){return this._axes[key]};axes._empty=function(){for(var prop in this._axes){delete this._axes[prop]}this._axes={};return this};axes._chart=function(val){if(!arguments.length)return this._chart;this._chart=val;return this};return axes});dv.guide.axis=dv.guide.extend(function(){function axis(){this._ticks=d3.functor(5);this._tickInterval=undefined;this._labelGroup=null;this._htmlLabels=false;this._domain=null}function dv_percent_tick_format(val,index){return val+"%"}function dv_default_tick_width(val,index){return"100%"}function dv_default_tick_display(val,index){return"inline"}function dv_default_tick_overflow(val,index){return""}function dv_default_tick_text_overflow(val,index){return""}axis._measure=function(axisPadding,bounds,panel){var axisOffset=this._getAxisOffset(bounds),scaleRange=dv.util.scaleRange(this._scale()),ticks=this._ticks.call(this,Math.abs(scaleRange[1]-scaleRange[0])),labelGroup,self=this;var tempParent=this._parent().append("g").classed("temp-axis",true);if(this._shouldDrawAxisLabels(panel)){labelGroup=this._constructLabelGroup(this.__labelParent,axisOffset,true)}var d3Axis=this._constructD3Axis(labelGroup,bounds,ticks,panel);var axisBounds=this._measureAxis(tempParent,axisOffset,d3Axis);var maxLabelBounds={left:axisBounds.x+axisOffset[0],top:axisBounds.y+axisOffset[1],right:axisBounds.x+axisBounds.width+axisOffset[0],bottom:axisBounds.y+axisBounds.height+axisOffset[1]};if(labelGroup){labelGroup.selectAll("span").each(function(){var e=this,d3Span=d3.select(this),labelContent=self._htmlLabels?d3Span.html():d3Span.text();if(labelContent){var leftOrientOffset=self._orientation==="right"?e.offsetWidth/2:0,topOrientOffset=self._orientation==="bottom"?e.offsetHeight/2:0,pos=[e.parentNode.parentNode.offsetLeft+e.parentNode.offsetLeft+leftOrientOffset,e.parentNode.parentNode.offsetTop+e.parentNode.offsetTop+topOrientOffset];maxLabelBounds.left=Math.min(pos[0],maxLabelBounds.left);maxLabelBounds.top=Math.min(pos[1],maxLabelBounds.top);maxLabelBounds.right=Math.max(pos[0]+leftOrientOffset,maxLabelBounds.right);maxLabelBounds.bottom=Math.max(pos[1]+topOrientOffset,maxLabelBounds.bottom)}})}tempParent.remove();if(labelGroup){labelGroup.remove()}var newAxisPadding={};newAxisPadding.left=Math.abs(Math.min(maxLabelBounds.left-bounds.left,0));newAxisPadding.top=Math.abs(Math.min(maxLabelBounds.top-bounds.top,0));newAxisPadding.right=Math.max(maxLabelBounds.right-bounds.right,0);newAxisPadding.bottom=Math.max(maxLabelBounds.bottom-bounds.bottom,0);return this._unionAxisPadding(newAxisPadding,axisPadding)};axis._render=function(parent,panel,bounds){if(!this._scale())throw new Error("The axis does not have a scale associated with it.");var scaleRange=dv.util.scaleRange(this._scale()),ticks=this._ticks.call(this,Math.abs(scaleRange[1]-scaleRange[0])),labelGroup;var axisOffset=this._getAxisOffset(bounds);if(this._shouldDrawAxisLabels(panel)){labelGroup=this._constructLabelGroup(this.__labelParent,axisOffset)}else{this.__labelParent.selectAll(".axis-"+this._scale().property()+".axis-index-"+this._scale().scaleIndex()).remove()}var d3Axis=this._constructD3Axis(labelGroup,bounds,ticks,panel);this._renderAxis(this._parent(),panel.bounds(),axisOffset,d3Axis,labelGroup);return this};axis._shouldDrawAxisLabels=function(panel){var facet=panel.facet(),prop=this._scale().property(),orientation=this.orientation();return facet._isFree(prop)&&facet._showAllPanelLabelsIfFree()||panel.visibleAxisLabelOrientations()[orientation]};axis._unionAxisPadding=function(newAxisPadding,axisPadding){axisPadding.left=Math.max(axisPadding.left,newAxisPadding.left);axisPadding.top=Math.max(axisPadding.top,newAxisPadding.top);axisPadding.right=Math.max(axisPadding.right,newAxisPadding.right);axisPadding.bottom=Math.max(axisPadding.bottom,newAxisPadding.bottom);return axisPadding};axis._constructLabelGroup=function(labelParent,axisOffset,isTemporary){var query=".axis-"+this._scale().property()+".axis-index-"+this._scale().scaleIndex()+(isTemporary?" .temp-axis":"");var labelGroup=labelParent.selectAll(query).data([0]);labelGroup.enter().append("div").classed("axis-"+this._scale().property()+" axis-index-"+this._scale().scaleIndex(),true).classed("temp-axis",isTemporary).style("left",axisOffset[0]+"px").style("top",axisOffset[1]+"px");if(dv.ANIMATION){labelGroup.transition().delay(this._chart().delay()).duration(this._chart().duration()).ease(this._chart().ease()).style("left",axisOffset[0]+"px").style("top",axisOffset[1]+"px")}else{labelGroup.style("left",axisOffset[0]+"px").style("top",axisOffset[1]+"px")}return labelGroup};axis._getAxisOffset=function(bounds){switch(this._orientation){case"bottom":return[0,bounds.bottom];case"left":return[bounds.left,0];case"top":return[0,bounds.top];case"right":return[bounds.right,0]}};axis._constructD3Axis=function(labelGroup,bounds,ticks,panel){var defaultTickSize=this._getDefaultTickSize(bounds),size=dv.util.isUndefined(this._tickSize)?defaultTickSize:this._tickSize,minorSize=dv.util.isUndefined(this._minorTickSize)?defaultTickSize:this._minorTickSize,orient;if(this._orientation==="left")orient="right";if(this._orientation==="right")orient="left";if(this._orientation==="top")orient="bottom";if(this._orientation==="bottom")orient="top";if(this._scale().property()==="x"){var range=dv.util.scaleRange(this._scale());range[0]+=this._chart().coord().startX();range[1]-=this._chart().coord().endX();if(this._scale()instanceof dv.scale.ordinal){this._scale().rangeBands(range)}else{this._scale().range(range)}}return dv.svg.axis()._orient(orient)._labelParent(labelGroup)._panel(panel)._ticks(dv.util.isUndefined(ticks)?5:ticks,this._tickInterval)._tickSize(size,minorSize,size)._defaultTickSize(defaultTickSize())._tickDx(dv.util.isUndefined(this._tickDx)?this._getDefaultTickDx():this._tickDx)._tickDy(dv.util.isUndefined(this._tickDy)?this._getDefaultTickDy():this._tickDy)._tickAnchor(dv.util.isUndefined(this._tickAnchor)?this._getDefaultTickAnchor():this._tickAnchor)._tickFormat(dv.util.isUndefined(this._tickFormat)&&this._chart().position()==="fill"&&this._scale().property()==="y"?dv_percent_tick_format:this._tickFormat)._tickWidth(dv.util.isUndefined(this._tickWidth)?dv_default_tick_width:this._tickWidth)._tickDisplay(dv.util.isUndefined(this._tickDisplay)?dv_default_tick_display:this._tickDisplay)._tickOverflow(dv.util.isUndefined(this._tickOverflow)?dv_default_tick_overflow:this._tickOverflow)._tickTextOverflow(dv.util.isUndefined(this._tickTextOverflow)?dv_default_tick_text_overflow:this._tickTextOverflow)._tickValues(this._tickValues)._htmlLabels(this._htmlLabels)._domain(this._domain)._tickSubdivide(this._tickSubdivide)._scale(this._scale()._d3Scale)};axis._renderAxis=function(p,bounds,axisOffset,d3Axis,labelGroup){var axis=p.selectAll(".axis-"+this._scale().property()+".axis-index-"+this._scale().scaleIndex()).data([0]);d3Axis._labelParent(labelGroup);axis.enter().append("g").classed("axis axis-"+this._scale().property()+" axis-index-"+this._scale().scaleIndex(),true).attr("transform","translate("+axisOffset[0]+","+axisOffset[1]+")");if(dv.ANIMATION){axis=axis.transition().delay(this._chart().delay()).duration(this._chart().duration()).ease(this._chart().ease())}axis.attr("transform","translate("+axisOffset[0]+","+axisOffset[1]+")").call(d3Axis)};axis._measureAxis=function(tempParent,axisOffset,d3Axis){tempParent.attr("transform","translate("+axisOffset[0]+","+axisOffset[1]+")").call(d3Axis);return tempParent.node().getBBox()};axis._measureAxisTitle=function(parent,prop,scaleIndex,bounds){var titleBounds={left:0,top:0,right:0,bottom:0};if(this._title){var tempAxisTitleContainer=parent.append("div").classed("temp-axis-title",true),orientation=this._titleOrientation||this._orientation,titleWidth=orientation==="top"||orientation==="bottom"?bounds.right-bounds.left:bounds.bottom-bounds.top,axisTitle=this._createAndSizeAxisTitle(tempAxisTitleContainer,orientation,prop,scaleIndex,titleWidth),axisTitleBBox=axisTitle.node().getBoundingClientRect();if(orientation==="top"||orientation==="bottom"){titleBounds[orientation]+=axisTitleBBox.height}else{titleBounds[orientation]+=axisTitleBBox.width}tempAxisTitleContainer.remove()}return titleBounds};axis._renderAxisTitle=function(parent,originsByOrientation,prop,scaleIndex,bounds){var titlePadding=6,labelHeight=0,orientation=this._titleOrientation||this._orientation,axisTitleAnim;if(!this._title)return;var firstRender=parent.selectAll(".axis-title-"+prop+".axis-title-index-"+scaleIndex).empty(),isVerticalTitle=orientation==="left"||orientation==="right",center=isVerticalTitle?originsByOrientation[orientation][1]-bounds.top:originsByOrientation[orientation][0]-bounds.left,width=center*2,axisTitle=this._createAndSizeAxisTitle(parent,orientation,prop,scaleIndex,width);if(dv.ANIMATION){axisTitleAnim=axisTitle.transition().duration(this._chart().duration()).delay(this._chart().delay()).ease(this._chart().ease())}this._positionAxisTitle(firstRender||!dv.ANIMATION?axisTitle:axisTitleAnim,originsByOrientation[orientation],orientation);if(axisTitleAnim){axisTitleAnim.style("opacity",1)}else{axisTitle.style("opacity",1)}};axis._createAndSizeAxisTitle=function(parent,orientation,prop,scaleIndex,width){var axisTitle=parent.selectAll(".axis-title-"+prop+".axis-title-index-"+scaleIndex).data([axis]);axisTitle.enter().append("div").classed("axis-title axis-title-"+prop+" axis-title-index-"+scaleIndex,true).style("opacity",dv.ANIMATION?0:1);return axisTitle.text(this._title).style("width",width-10+"px").classed({top:orientation==="top",bottom:orientation==="bottom",left:orientation==="left",right:orientation==="right"})};axis._positionAxisTitle=function(axisTitle,origin,orientation){axisTitle.style("left",function(){var offset=0;return origin[0]+offset+"px"}).style("top",function(){var offset=0;if(orientation==="top")offset=-this.offsetHeight;return origin[1]+offset+"px"})};axis._getDefaultTickSize=function(bounds){if(this._orientation==="bottom"){return d3.functor(bounds.bottom-bounds.top)}else if(this._orientation==="left"){return d3.functor(bounds.right-bounds.left)}else if(this._orientation==="top"){return d3.functor(bounds.bottom-bounds.top)}else{return d3.functor(bounds.right-bounds.left)}};axis._getDefaultTickDx=function(){return this._orientation==="bottom"||this._orientation==="top"?d3.functor(0):d3.functor(-12)};axis._getDefaultTickDy=function(){return this._orientation==="bottom"||this._orientation==="top"?d3.functor(-12):d3.functor(0)};axis._getDefaultTickAnchor=function(){if(this._orientation==="left")return d3.functor("end");if(this._orientation==="right")return d3.functor("start");return d3.functor("middle")};axis._labelParent=function(val){if(!arguments.length)return this.__labelParent;this.__labelParent=val;return this};axis.ticks=function(arg1,arg2){if(!arguments.length)return dv.util.isFinite(this._tickInterval)?[this._ticks,this._tickInterval]:this._ticks;if(arguments.length>1){this._ticks=function(){return arg1};this._tickInterval=arg2}else{this._ticks=d3.functor(arg1);this._tickInterval=undefined}return this};axis.tickSubdivide=function(val){if(!arguments.length)return this._tickSubdivide;this._tickSubdivide=val;return this};axis.tickSize=function(val){if(!arguments.length)return this._tickSize;this._tickSize=d3.functor(val);return this};axis.minorTickSize=function(val){if(!arguments.length)return this._minorTickSize;this._minorTickSize=d3.functor(val);return this};axis.tickDx=function(val){if(!arguments.length)return this._tickDx;this._tickDx=d3.functor(val);return this};axis.htmlLabels=function(val){if(!arguments.length)return this._htmlLabels;this._htmlLabels=val;return this};axis.tickDy=function(val){if(!arguments.length)return this._tickDy;this._tickDy=d3.functor(val);return this};axis.tickAnchor=function(val){if(!arguments.length)return this._tickAnchor;this._tickAnchor=d3.functor(val);return this};axis.tickFormat=function(val){if(!arguments.length){var d3Scale=this._scale()._d3Scale;if(this._tickFormat)return this._tickFormat;if(d3Scale.tickFormat)return d3Scale.tickFormat(d3Scale);return function(d){return d}}this._tickFormat=val;return this};axis.tickWidth=function(val){if(!arguments.length){var d3Scale=this._scale()._d3Scale;if(this._tickWidth)return this._tickWidth;if(d3Scale.tickWidth)return d3Scale.tickWidth(d3Scale);return function(d){return d}}this._tickWidth=val;return this};axis.tickDisplay=function(val){if(!arguments.length){var d3Scale=this._scale()._d3Scale;if(this._tickDisplay)return this._tickDisplay;if(d3Scale.tickDisplay)return d3Scale.tickDisplay(d3Scale);return function(d){return d}}this._tickDisplay=val;return this};axis.tickOverflow=function(val){if(!arguments.length){var d3Scale=this._scale()._d3Scale;if(this._tickOverflow)return this._tickOverflow;if(d3Scale.tickOverflow)return d3Scale.tickOverflow(d3Scale);return function(d){return d}}this._tickOverflow=val;return this};axis.tickTextOverflow=function(val){if(!arguments.length){var d3Scale=this._scale()._d3Scale;if(this._tickTextOverflow)return this._tickTextOverflow;if(d3Scale.tickTextOverflow)return d3Scale.tickTextOverflow(d3Scale);return function(d){return d}}this._tickTextOverflow=val;return this};axis.tickValues=function(val){if(!arguments.length)return this._tickValues;this._tickValues=val;return this};axis.titleOrientation=function(val){if(!arguments.length)return this._titleOrientation;this._titleOrientation=val;return this};axis.domain=function(val){if(!arguments.length)return this._domain;this._domain=val;return this};axis._chart=function(val){if(!arguments.length)return this.__chart;this.__chart=val;return this};return axis});dv.svg.axis=function(){var scale=d3.scale.linear(),orient="bottom",tickMajorSize=d3.functor(6),tickMinorSize=d3.functor(6),tickEndSize=d3.functor(6),defaultTickSize=0,tickDx=d3.functor(0),tickDy=d3.functor(0),tickAnchor=d3.functor("start"),tickArguments_=[10],tickValues=null,htmlLabels=false,domain=null,tickFormat_,tickSubdivide=0,labelParent;function d3_svg_axisX(selection,x){selection.attr("transform",function(d){var xVal=x(d);return dv.util.isFinite(xVal)?"translate("+xVal+",0)":null})}function d3_svg_axisY(selection,y){selection.attr("transform",function(d){var yVal=y(d);return dv.util.isFinite(yVal)?"translate(0,"+yVal+")":null})}function getLeftPosition(elem,tickDx,anchor){var offsetWidth=d3.select(elem).select("span").node().offsetWidth;var leftAdj=anchor==="end"?-offsetWidth:anchor==="middle"?-offsetWidth/2:0;return tickDx+leftAdj}function getTopPosition(elem,tickDy,anchor){var offsetHeight=d3.select(elem).select("span").node().offsetHeight;var topAdj=anchor==="top"?0:anchor==="middle"?-offsetHeight/2:-offsetHeight;return tickDy+topAdj}function d3_svg_axisSubdivide(scale,ticks,m){var subticks=[];if(m&&ticks.length>1){var extent=dv.util.scaleExtent(scale.domain()),i=-1,n=ticks.length,d=(ticks[1]-ticks[0])/++m,j,v;while(++i<n){for(j=m;--j>0;){if((v=+ticks[i]-j*d)>=extent[0]){subticks.push(v)}}}for(--i,j=0;++j<m&&(v=+ticks[i]+j*d)<extent[1];){subticks.push(v)}}return subticks}function axis(g){var getLabelPos=function(label,d,i,scale,orient){var pos={};switch(orient){case"top":pos.top=getTopPosition(label,-tickDy.call(label,d,i),"top");pos.left=scale(d)+getLeftPosition(label,tickDx.call(label,d,i),tickAnchor.call(label,d,i));break;case"bottom":pos.top=getTopPosition(label,tickDy.call(label,d,i),"bottom");pos.left=scale(d)+getLeftPosition(label,tickDx.call(label,d,i),tickAnchor.call(label,d,i));break;case"right":pos.top=scale(d)+getTopPosition(label,tickDy.call(label,d,i),"middle");pos.left=getLeftPosition(label,tickDx.call(label,d,i),tickAnchor.call(label,d,i));break;case"left":pos.top=scale(d)+getTopPosition(label,tickDy.call(label,d,i),"middle");pos.left=getLeftPosition(label,-tickDx.call(label,d,i),tickAnchor.call(label,d,i));break}pos.top=(isNaN(pos.top)?0:pos.top)+"px";pos.left=(isNaN(pos.left)?0:pos.left)+"px";var anchor=tickAnchor.call(label,d,i);d3.select(label).classed({start:anchor==="start",middle:anchor==="middle",end:anchor==="end"});return pos};var applyLabelPositions=function(labels,positions){["top","left"].forEach(function(side){labels.style(side,function(d,i){return positions[i][side]})})};var updateLabels=function(ticks,oldScale,newScale){if(!labelParent)return;var tickFormat=tickFormat_==null?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments_):String:tickFormat_,tickWidth=tickWidth_==null?scale.tickWidth?scale.tickWidth.apply(scale,tickArguments_):String:tickWidth_,tickDisplay=tickDisplay_==null?scale.tickDisplay?scale.tickDisplay.apply(scale,tickArguments_):String:tickDisplay_,tickOverflow=tickOverflow_==null?scale.tickOverflow?scale.tickOverflow.apply(scale,tickArguments_):String:tickOverflow_,tickTextOverflow=tickTextOverflow_==null?scale.tickTextOverflow?scale.tickTextOverflow.apply(scale,tickArguments_):String:tickTextOverflow_,label,labelEnter,labelExit,labelUpdate;labelParent.style("position","absolute");label=labelParent.selectAll(".axis-label").data(ticks,String);if(dv.FADE_IN_LABELS){labelEnter=label.enter().append("div").classed({"axis-label":true,visibilityTransition:true,visibilityHidden:true}).style({position:"absolute"})}else{labelEnter=label.enter().append("div").classed({"axis-label":true,visibilityForeground:true}).style({position:"absolute"})}labelExit=dv.setVisibilityHidden(label.exit()).remove();labelUpdate=label;if(dv.FADE_IN_LABELS){setTimeout(function(){dv.setVisibilityForeground(label)},100)}labelEnter.append("span");var labelSpans=label.selectAll("span"),tickFormatWrapper=function(d,i,j){return tickFormat.call(this,d,j,panel)},tickWidthWrapper=function(d,i,j){return tickWidth.call(this,d,j,panel,labelSpans.length)},tickDisplayWrapper=function(d,i,j){return tickDisplay.call(this,d,j,panel)},tickOverflowWrapper=function(d,i,j){return tickOverflow.call(this,d,j,panel)},tickTextOverflowWrapper=function(d,i,j){return tickTextOverflow.call(this,d,j,panel)};if(htmlLabels){labelSpans.html(tickFormatWrapper)}else{labelSpans.text(tickFormatWrapper).style("width",tickWidthWrapper).style("display",tickDisplayWrapper).style("overflow",tickOverflowWrapper).style("text-overflow",tickTextOverflowWrapper)}var labelEnterPositions=[],labelUpdateReorientPositions=[],labelUpdatePositions=[],labelExitPositions=[];var ordinalScaleWrapper;if(!scale.ticks){var rangeBandHalfWidth=scale.rangeBand()/2;ordinalScaleWrapper=function(d){return newScale(d)+rangeBandHalfWidth}}labelEnter.each(function(d,i){labelEnterPositions[i]=getLabelPos(this,d,i,ordinalScaleWrapper||oldScale,orient)});labelUpdate.each(function(d,i){labelUpdateReorientPositions[i]=getLabelPos(this,d,i,ordinalScaleWrapper||oldScale,orient);labelUpdatePositions[i]=getLabelPos(this,d,i,ordinalScaleWrapper||newScale,orient)});if(scale.ticks){labelExit.each(function(d,i){labelExitPositions[i]=getLabelPos(this,d,i,newScale,orient)})}applyLabelPositions(labelEnter,labelEnterPositions);applyLabelPositions(label,labelUpdateReorientPositions);applyLabelPositions(labelUpdate,labelUpdatePositions);if(scale.ticks){applyLabelPositions(labelExit,labelExitPositions)}};g.each(function(){var g=d3.select(this);if(domain){var scaledDomain=scale.domain();if(isNaN(domain[0])||domain[0]<scaledDomain[0]&&domain[1]>scaledDomain[1]){scale.domain(domain)}}var ticks=tickValues==null?scale.ticks?scale.ticks.apply(scale,tickArguments_):scale.domain():tickValues;var uniqueTicks=ticks.filter(function(tick,i){return ticks.indexOf(tick)===i});if(ticks.length!==1&&uniqueTicks.length===1){ticks=[]}var subticks=d3_svg_axisSubdivide(scale,ticks,tickSubdivide),subtick=g.selectAll(".minor").data(subticks,String),subtickEnter=subtick.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),subtickExit=d3.transition(subtick.exit()).style("opacity",1e-6).remove(),subtickUpdate=d3.transition(subtick).style("opacity",1);var tick=g.selectAll(".axis-tick").data(ticks,String),tickEnter=tick.enter().insert("g","path").classed("axis-tick",true).style("opacity",1e-6),tickExit=d3.transition(tick.exit()).style("opacity",1e-6).remove(),tickUpdate=d3.transition(tick).style("opacity",1),tickTransform;var range=dv.util.scaleRangeNoReverse(scale);path=g.selectAll(".domain").data([0]);pathEnter=path.enter().append("path").attr("class","domain");pathUpdate=d3.transition(path);var scale1=scale.copy(),scale0=this.__chart__||scale1;this.__chart__=scale1;tickEnter.append("line").attr("class","tick");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),tickSizeFn=function(tickSize,d,i,panel){var size=tickSize.call(this,d,i,panel);if(size==null||isNaN(size)){return defaultTickSize}return size};switch(orient){case"bottom":tickTransform=d3_svg_axisX;subtickEnter.attr("y2",function(d,i){return tickSizeFn.call(this,tickMinorSize,d,i,panel)});subtickUpdate.attr("x2",0).attr("y2",function(d,i){return tickSizeFn.call(this,tickMinorSize,d,i,panel)});lineEnter.attr("y2",function(d,i){return tickSizeFn.call(this,tickMajorSize,d,i,panel)});lineUpdate.attr("x2",0).attr("y2",function(d,i){return tickSizeFn.call(this,tickMajorSize,d,i,panel)});pathUpdate.attr("d",function(d,i){return"M"+range[0]+","+tickSizeFn.call(this,tickEndSize,d,i,panel)+"V0H"+range[1]+"V"+tickSizeFn.call(this,tickEndSize,d,i,panel)});break;case"top":tickTransform=d3_svg_axisX;subtickEnter.attr("y2",function(d,i){return-tickSizeFn.call(this,tickMinorSize,d,i,panel)});subtickUpdate.attr("x2",0).attr("y2",function(d,i){return-tickSizeFn.call(this,tickMinorSize,d,i,panel)});lineEnter.attr("y2",function(d,i){return-tickSizeFn.call(this,tickMajorSize,d,i,panel)});lineUpdate.attr("x2",0).attr("y2",function(d,i){return-tickSizeFn.call(this,tickMajorSize,d,i,panel)});pathUpdate.attr("d",function(d,i){return"M"+range[0]+","+-tickSizeFn.call(this,tickEndSize,d,i,panel)+"V0H"+range[1]+"V"+-tickSizeFn.call(this,tickEndSize,d,i,panel)});break;case"left":tickTransform=d3_svg_axisY;subtickEnter.attr("x2",function(d,i){return-tickSizeFn.call(this,tickMinorSize,d,i,panel)});subtickUpdate.attr("x2",function(d,i){return-tickSizeFn.call(this,tickMinorSize,d,i,panel)}).attr("y2",0);lineEnter.attr("x2",function(d,i){return-tickSizeFn.call(this,tickMajorSize,d,i,panel)});lineUpdate.attr("x2",function(d,i){return-tickSizeFn.call(this,tickMajorSize,d,i,panel)}).attr("y2",0);pathUpdate.attr("d",function(d,i){return"M"+-tickSizeFn.call(this,tickEndSize,d,i,panel)+","+range[0]+"H0V"+range[1]+"H"+-tickSizeFn.call(this,tickEndSize,d,i,panel)});break;case"right":tickTransform=d3_svg_axisY;subtickEnter.attr("x2",function(d,i){return tickSizeFn.call(this,tickMinorSize,d,i,panel)});subtickUpdate.attr("x2",function(d,i){return tickSizeFn.call(this,tickMinorSize,d,i,panel)}).attr("y2",0);lineEnter.attr("x2",function(d,i){return tickSizeFn.call(this,tickMajorSize,d,i,panel)});lineUpdate.attr("x2",function(d,i){return tickSizeFn.call(this,tickMajorSize,d,i,panel)}).attr("y2",0);pathUpdate.attr("d",function(d,i){return"M"+tickSizeFn.call(this,tickEndSize,d,i,panel)+","+range[0]+"H0V"+range[1]+"H"+tickSizeFn.call(this,tickEndSize,d,i,panel)});break}if(scale.ticks){if(scale0.ticks){tickEnter.call(tickTransform,scale0);subtickEnter.call(tickTransform,scale0)}tickUpdate.call(tickTransform,scale1);tickExit.call(tickTransform,scale1);subtickUpdate.call(tickTransform,scale1);subtickExit.call(tickTransform,scale1)}else{var dx=scale1.rangeBand()/2,x=function(d){return scale1(d)+dx};tickEnter.call(tickTransform,x);tickUpdate.call(tickTransform,x)}updateLabels(ticks,scale0,scale1)})}axis._scale=function(x){if(!arguments.length)return scale;scale=x;return axis};axis._orient=function(x){if(!arguments.length)return orient;orient=x;return axis};axis._ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis};axis._tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis};axis._tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis};axis._tickWidth=function(x){if(!arguments.length)return tickWidth_;tickWidth_=x;return axis};axis._tickDisplay=function(x){if(!arguments.length)return tickDisplay_;tickDisplay_=x;return axis};axis._tickOverflow=function(x){if(!arguments.length)return tickOverflow_;tickOverflow_=x;return axis};axis._tickTextOverflow=function(x){if(!arguments.length)return tickTextOverflow_;tickTextOverflow_=x;return axis};axis._htmlLabels=function(val){if(!arguments.length)return htmlLabels;htmlLabels=val;return axis};axis._tickSize=function(x,y,z){if(!arguments.length)return tickMajorSize;var n=arguments.length-1;tickMajorSize=d3.functor(x);tickMinorSize=n>1?d3.functor(y):tickMajorSize;tickEndSize=n>0?d3.functor(arguments[n]):tickMajorSize;return axis};axis._defaultTickSize=function(val){if(!arguments.length)return defaultTickSize;defaultTickSize=val;return axis};axis._tickDx=function(x){if(!arguments.length)return tickDx;tickDx=x;return axis};axis._tickDy=function(y){if(!arguments.length)return tickDy;tickDy=y;return axis};axis._tickAnchor=function(anchor){if(!arguments.length)return tickAnchor;tickAnchor=anchor;return axis};axis._tickSubdivide=function(x){if(!arguments.length)return tickSubdivide;tickSubdivide=+x;return axis};axis._panel=function(val){if(!arguments.length)return panel;panel=val;return axis};axis._labelParent=function(x){if(!arguments.length)return labelParent;labelParent=x;return axis};axis._domain=function(val){if(!arguments.length)return domain;domain=val;return this};return axis};dv.guide.legends=dv.extend(function(){function legends(){this._legArr=[];this.__hide=false;this._ad={left:0,right:0,width:0,height:0}}legends._render=function(chartOps){this._w=0;this._h=0;if(!this.__hide){var parent=chartOps.el.select(".legends"),self=this;var legends=parent.selectAll(".legend").data(this._legArr);legends.exit().transition().duration(chartOps.duration).style("opacity",0).remove();var enterG=legends.enter().append("g").classed("legend",true);if(dv.ANIMATION){enterG.style("opacity",0)}legends.each(function(d,i){var scales={},prop=d.props[0],scale=self._getScale(chartOps,d.props[0]),domain=scale.domain();for(var j=0;j<d.props.length;j++){var otherProp=d.props[j],otherScale=self._getScale(chartOps,d.props[j]);if(otherScale.hasSameDomain(domain)){scales[otherProp]=chartOps.scales[otherProp]}else{throw new Error("Can't render single legend from multiple domains")}}d.guide._render(d3.select(this),scales,{dims:self._ad,renderOpts:chartOps});self._w+=d.guide._getUsedWidth();self._h+=d.guide._getUsedHeight();self._ad=d.guide._getAdjustedDimensions(self._ad)})}return this};legends._getScale=function(chartOpts,prop){var scaleGroup=chartOpts.scales[prop],scale;if(prop===undefined||scaleGroup===undefined||scaleGroup[0]===undefined){throw new Error("A '"+prop+"'' legend has been called for, but '"+prop+" hasn't been mapped to data.")}return scaleGroup[0]};legends._add=function(legend){this._legArr.push(legend);return this};legends._remove=function(properties){for(var p in properties){var prop=properties[p];for(var i=0;i<this._legArr.length;i++){var props=this._legArr[i].props,include=true;for(var j=0;j<props.length;j++){if(props[j]===prop){props.splice(j,1);j--}if(props.length===0)include=false}if(!include){this._legArr.splice(i,1);i--}}}};legends._legends=function(val){if(!arguments.length)return this._legArr;this._legArr=val;return this};legends._allowedDimensions=function(val){if(!arguments.length)return this._ad;this._ad=val;return this};legends._getWidth=function(){return this._w};legends._getHeight=function(){return this._h};legends._hide=function(val){if(!arguments.length)return this.__hide;this.__hide=val;return this};legends._empty=function(){for(var i=0;i<this._legArr.length;i++){delete this._legArr[i]}this._legArr=[];return this};return legends});dv.guide.legend=dv.guide.extend(function(){function legend(){this._overlay=false;this._orientation="top";this._vGap=5;this._hGap=15;this._defaultPadding=this._padding={top:10,left:10,right:10,bottom:10};this._swatchWidth=15;this._swatchHeight=10;this._innerPadding=5;this._spanPercent=.75;this._lineHeight=0;this._entriesWidth=[]}legend._render=function(p,scales,options){var pTransition=p,maxDimensions=options.dims,self=this;this._renderingOptions=options.renderOpts;this._scales=scales;this._transformData=[];this._width=maxDimensions.width-this._padding.left-this._padding.right;this._height=maxDimensions.height-this._padding.top-this._padding.bottom;var entries=this._drawEntries(p);this._legendWidths=calc_legends_widths.call(this,entries);var colMeta=calc_columns.call(this,Math.min(this._legendWidths.length,Math.floor(this._width/this._swatchWidth)));var retVal=calc_offsets.call(this,colMeta);var offsets=retVal.offsets;colMeta=retVal.cols;this._width=this._width-colMeta.padding+this._hGap*(colMeta.data.length-1);this._height=this._lineHeight+offsets[offsets.length-1].y;entries.each(function(d,i){var el=d3.select(this);if(dv.ANIMATION){el=el.transition().duration(self._renderingOptions.duration).delay(self._renderingOptions.delay).ease(self._renderingOptions.ease)}el.attr("transform","translate("+offsets[i].x+", "+offsets[i].y+")")});if(!this._renderingOptions.firstRender){pTransition=p.transition().duration(this._renderingOptions.duration).style("opacity",1)}var left=this._orientation==="right"?maxDimensions.left+maxDimensions.width-this._width-this._padding.right:maxDimensions.left+this._padding.left;var top=this._orientation==="bottom"?maxDimensions.top+maxDimensions.height-this._height-this._padding.bottom:maxDimensions.top+this._padding.top;pTransition.attr("transform","translate("+left+","+top+")");if(this._renderingOptions.firstRender){pTransition.transition().duration(this._renderingOptions.duration).style("opacity",1)}};legend._drawEntries=function(p){var self=this,domain=[];this._entryWidths=[];for(var prop in this._scales){domain=this._scales[prop][0].domain();break}var entries=p.selectAll(".legend-entry").data(domain);entries.exit().transition().duration(this._renderingOptions.duration).style("opacity",0).remove();var entry=entries.enter().append("g").classed("legend-entry",true);entry.append("path");entry.append("text").classed("legend-entry-label",true);entry.append("text").classed("legend-entry-value",true);entries.select("path").attr("d",function(d,i){return get_path.call(self,d,i)}).call(function(selection){selection.attr("style","");if(self._scales.hasOwnProperty("fill"))selection.style("fill",function(d,i){return self._scales["fill"][0].mapValue(d)});if(self._scales.hasOwnProperty("stroke"))selection.style("stroke",function(d,i){return self._scales["stroke"][0].mapValue(d)}).style("stroke-width",2);if(self._scales.hasOwnProperty("linetype")){selection.style("stroke-dasharray",function(d,i){return dv.util.svg.getDasharray(self._scales["linetype"][0].mapValue(d))});if(!self._scales.hasOwnProperty("stroke"))selection.style("stroke","#000");selection.style("stroke-width",2)}if(self._scales.hasOwnProperty("size")){selection.style("stroke-width",function(d,i){return self._scales["size"][0].mapValue(d)})}}).each(function(d,i){self._entryWidths[i]=this.getBBox().width});entries.select("text.legend-entry-label").attr("x",this._swatchWidth+this._innerPadding).attr("y",10).text(function(d,i){if(dv.util.isUndefined(self._labels))return d;else return self._labels[i%self._labels.length]}).each(function(d,i){self._entryWidths[i]+=self._innerPadding+this.getBBox().width});entries.select("text.legend-entry-value").attr("y",10).attr("x",function(d,i){return self._entryWidths[i]+self._innerPadding}).text(function(d,i){if(dv.util.isUndefined(self._values))return"";else return self._values[i]}).style("fill",function(d,i){if(!dv.util.isUndefined(self._scales["stroke"]))return self._scales["stroke"][0].mapValue(d);else if(!dv.util.isUndefined(self._scales["fill"]))return self._scales["fill"][0].mapValue(d);return}).each(function(d,i){var width=this.getBBox().width;self._entryWidths[i]+=width+(width>0?self._innerPadding:0)});return entries};function calc_legends_widths(entries){var self=this;entries.each(function(d,i){self._entryWidths[i]=Math.min(self._entryWidths[i],self._width);self._lineHeight=Math.max(self._lineHeight,this.getBBox().height)});return self._entryWidths}function calc_offsets(cols){var cursor=0,colIndex=0,d,spanned=0,hasMaxCols=false,rowOffset=0,colOffset=0,offsets=[];for(var i=0;i<this._legendWidths.length;i++){cursor+=(colIndex===0?0:this._hGap)+this._legendWidths[i];if(colIndex<cols.data.length&&cursor<=this._width){if(this._legendWidths[i]<=cols.data[colIndex]+spanned){colOffset+=colIndex===0?0:this._hGap;offsets.push({x:colOffset,y:rowOffset});colOffset+=cols.data[colIndex]+spanned;spanned=0}else if((d=this._legendWidths[i]-cols.data[colIndex])<=cols.padding){cols.padding-=d;cols.data[colIndex]=this._legendWidths[i];return calc_offsets.call(this,cols)}else if(colIndex+1<cols.data.length&&this._legendWidths[i]>=cols.data[colIndex]+cols.data[colIndex+1]*this._spanPercent+spanned){if(colIndex+1<=cols.data.length){spanned+=(colIndex===0?0:this._hGap)+cols.data[colIndex];cursor-=(colIndex===0?0:this._hGap)+this._legendWidths[i];i--}else{cursor=cursor-this._legendWidths[i]+spanned+cols.data[colIndex];spanned=0;colOffset+=colIndex===0?0:this._hGap;offsets.push({x:colOffset,y:rowOffset});colOffset+=cols.data[colIndex]+spanned;colIndex++}}else{cols=calc_columns.call(this,cols.data.length-1);return calc_offsets.call(this,cols)}colIndex++}else if(colIndex+1===cols.data.length&&cols.data.length>1){cols=calc_columns.call(this,cols.data.length-1);return calc_offsets.call(this,cols)}else{if(colIndex===cols.data.length)hasMaxCols=true;rowOffset+=this._lineHeight+this._vGap;cursor=colOffset=0;colIndex=0;spanned=0;i--}}if(colIndex===cols.data.length)hasMaxCols=true;if(!hasMaxCols){cols=calc_columns.call(this,cols.data.length-1);return calc_offsets.call(this,cols)}return{offsets:offsets,cols:cols}}function calc_columns(numCols){var colMeta={data:[],padding:this._width},sum=0,i=0;if(this._isVAligned()){numCols=Math.ceil(this._legendWidths.length/Math.floor(this._height/(this._lineHeight+this._vGap)))}for(i=0;i<numCols;i++){sum+=this._legendWidths[i]+this._hGap}sum-=this._hGap;if(sum>this._width&&numCols>1)return calc_columns.call(this,numCols-1);colMeta.data=this._legendWidths.slice(0,numCols);colMeta.padding-=sum;if(colMeta.padding<0)colMeta.padding=0;return colMeta}function draw_rect(x,y,w,h){return"M"+x+","+y+"L"+(x+w)+","+y+"L"+(x+w)+","+(y+h)+"L"+x+","+(y+h)+"Z"}function draw_line(x0,y0,x1,y1){var midPoint=y0+y1>>1;return"M"+x0+","+midPoint+"L"+x1+","+midPoint}function get_path(d,i){if(this._scales.hasOwnProperty("fill"))return draw_rect.call(this,0,0,this._swatchWidth,this._swatchHeight);else return draw_line.call(this,0,0,this._swatchWidth,this._swatchHeight)}legend._getAdjustedDimensions=function(maxDims){if(this._overlay)return maxDims;var totalWidth=this._padding.left+this._width+this._padding.right,totalHeight=this._padding.top+this._height+this._padding.bottom;if(this._orientation==="left"){maxDims.left+=totalWidth;maxDims.width-=totalWidth}else if(this._orientation==="top"){maxDims.top+=totalHeight;maxDims.height-=totalHeight}else if(this._orientation==="right")maxDims.width-=totalWidth;else if(this._orientation==="bottom")maxDims.height-=totalHeight;return maxDims};legend._getUsedWidth=function(){if(this._overlay)return 0;else return this._isVAligned()?this._width+this._padding.left+this._padding.right:0};legend._getUsedHeight=function(){if(this._overlay)return 0;else return this._isVAligned()?0:this._height+this._padding.top+this._padding.bottom};legend._isVAligned=function(){return this._orientation==="left"||this._orientation==="right"};legend.vGap=function(val){if(!arguments.length)return this._vGap;this._vGap=val;return this};legend.hGap=function(val){if(!arguments.length)return this._hGap;this._hGap=val;return this};legend.padding=function(val){if(!arguments.length)return this._padding;this._padding=dv.util.merge(this._defaultPadding,val);return this};legend.align=function(val){if(!arguments.length)return this._align;this._align=val;return this};legend.labels=function(val){if(!arguments.length)return this._labels;this._labels=val;return this};legend.values=function(val){if(!arguments.length)return this._values;this._values=val;return this};legend.overlay=function(val){if(!arguments.length)return this._overlay;this._overlay=val;return this};return legend});dv.guide.custom=dv.guide.extend(function(){function custom(config){this._render=function(){dv.log.warn({msg:"empty render function on custom guide"});return this};this._getAdjustedDimensions=function(maxDims){return maxDims};this._getUsedWidth=function(){return 0};this._getUsedHeight=function(){return 0}}custom.setFunc=function(funcName,func){this[funcName]=func;return this};return custom});dv.geom=dv.container.extend(function(){function geom(){this._super();this._defaultAes={};this._behaviorsLayer=null;this._dodgePadding=0;this._allowRecalculateScale=true;this._initializeDefaultAes()}geom._initializeDefaultAes=function(){this._defaultAes["x"]=1;this._defaultAes["y"]=1;this._defaultAes["shape"]="circle";this._defaultAes["linetype"]="solid"};geom._prerender=function(chart){this._trainedScales={};this._chart=chart;this.normalizedData(this._normalizeData(this.data()));this._calculateStats();this._inheritChartAesthetics(chart)};geom._inheritChartAesthetics=function(chart){for(var prop in chart._aes){var chartAesGroup=chart._aes[prop];if(!this._aes[prop])this._aes[prop]={};for(var scaleIndex in chartAesGroup){if(!this._aes[prop][scaleIndex]){this._aes[prop][scaleIndex]=chartAesGroup[scaleIndex]}}}};geom._trainScales=function(){};geom.allowRecalculateScale=function(value){if(value===undefined){return this._allowRecalculateScale}this._allowRecalculateScale=value;return this};geom._createDefaultScales=function(){for(var prop in this._defaultAes){if(!this._aes.hasOwnProperty(prop)){this._aes[prop]={};this._aes[prop][0]=dv.scale.constant().value(this._defaultAes[prop]).property(prop)}delete this._defaultAes[prop]}};geom._render=function(geomGroup){var self=this;this._geomGroup=d3.select(geomGroup);var seriesGroups=this._geomGroup.selectAll(".series").data(this._nestData);seriesGroups.exit().call(self.exitSeriesGroup,self);seriesGroups.enter().append("g").classed("series",true);seriesGroups.call(self.updateGroups,self.enterPen,self.pen,self.enterPen,self).call(self.updateDataPoints,self.enterPen,self.pen,self.enterPen,self);self._renderBehaviors(self._geomGroup);self.unregisterEventMap=null};geom._renderBehaviors=function(geomGroup){var self=this;if(this._behaviors&&this._behaviors.length){this._behaviorsLayer=geomGroup.select(".behavior-layer");if(this._behaviorsLayer.empty()){this._behaviorsLayer=geomGroup.append("g").classed("behavior-layer",true)}else{this._behaviorsLayer.node().parentNode.appendChild(this._behaviorsLayer.node())}dv.util.each(this._behaviors,function(behavior){behavior._geom(self)._render(self._behaviorsLayer)})}};geom.updateGroups=function(seriesGroups,enterPen,pen,exitPen,self){seriesGroups.each(function(d,i){var x=0,y=0,selection=d3.select(this),previousTransform=selection.attr("transform");if(self._chart._coord instanceof dv.coord.polar){var firstDataPoint=d.values[0],xRange=dv.util.scaleRange(firstDataPoint.panel.xOuterScale()),yRange=dv.util.scaleRange(firstDataPoint.panel.yOuterScale()),xVal=(xRange[0]+xRange[1])/2,yVal=(yRange[0]+yRange[1])/2,flipped=self._chart._coord.flip();x=flipped?yVal:xVal;y=flipped?xVal:yVal}if(previousTransform&&dv.ANIMATION){selection=selection.transition().duration(function(d,i){return self.duration().call(this,d,i)})}selection.attr("transform","translate("+x+","+y+")")})};geom.updateDataPoints=function(seriesGroups,enterPen,pen,exitPen,self){var _enterPen=enterPen.call(self),_updatePen=pen.call(self),_exitPen=exitPen.call(self);var nodes=seriesGroups.selectAll("."+self._dataPointStyleClass).data(function(d){return self.getValues(d)});nodes.exit().transition().delay(function(d,i,j){return self.delay().call(this,d,i,j)}).duration(function(d,i,j){return self.duration().call(this,d,i,j)}).ease(self.ease()).each(function(){this.__exiting__=true}).attrTween("d",_exitPen.pathTween).remove();nodes.enter().append("path").each(function(d,i,j){self.setPreviousState.call(this,_enterPen,_exitPen,d,i,j)}).attr("class",function(d,i,j){return"datum-"+i+" series-"+j}).call(self.attributes,self).attr("d",_enterPen.path);var updateTransition=nodes.call(self.attributes,self).call(self._removeRegisteredEvents,self).call(self._addRegisteredEvents,self).each(function(){this.__exiting__=false});if(dv.ANIMATION){updateTransition=updateTransition.transition().delay(function(d,i,j){return self.delay().call(this,d,i,j)}).duration(function(d,i,j){return self.duration().call(this,d,i,j)}).ease(self.ease()).attrTween("d",_updatePen.pathTween)}else{updateTransition.each(function(d,i,j){var bounds=_updatePen.bounds(d,i,j);if(bounds){d.bounds=bounds.bounds}}).attr("d",_updatePen.path)}updateTransition.call(self.addEachFunction,self)};geom.addEachFunction=function(selection,self){if(self._each){if(!dv.util.isUndefined(self._each["start"])){if(dv.ANIMATION){selection.each("start",function(d,i,j){self._each["start"].call(this,d,i,j)})}else{selection.each(function(d,i,j){self._each["start"].call(this,d,i,j)})}}if(!dv.util.isUndefined(self._each["end"])){if(dv.ANIMATION){selection.each("end",function(d,i,j){self._each["end"].call(this,d,i,j)})}else{selection.each(function(d,i,j){self._each["end"].call(this,d,i,j)})}}}};geom.exitSeriesGroup=function(geomGroup,self){self.exitSeries(geomGroup,self.enterPen,self)};geom.setPreviousState=function(enterPen,exitPen,d,i){var bounds=enterPen.bounds(d,i);this.__previousBounds__=bounds;this.__exitTransition__=exitPen};geom.pathTween=function(pathRenderer,selection,d,i,j){var path,e=d3.select(selection);if(selection.__exiting__){path=selection.__exitTransition__.path(d,i);selection.__exiting__=false}else{path=pathRenderer.getPath(pathRenderer.getBounds(d,i))}if(path===null){e.remove();return null}return d3.interpolate(e.attr("d"),path)};geom._calculateStats=function(){};geom._handlePositions=function(){if(this.position()!=="stack"&&this.position()!=="fill"&&this.position()!=="dodge")return;var position=this.position(),layeredNestData=this._addGroupLayerToNestedData(),isFlipped=this._chart.coord().flip(),includeInDomain=function(prop){var scaleGroup=self.getExplicitScales(prop)[prop],include=false;return function(d,i){for(var scaleIndex in scaleGroup){include=scaleGroup[scaleIndex]._includeInDomain(d,i);if(include)break}return include?d[prop]:0}},self=this;dv.util.each(layeredNestData,function(nestedFacetData){var xIncludeInDomain=includeInDomain("x"),yIncludeInDomain=includeInDomain("y");if(position==="stack"){d3.layout.stack().x(xIncludeInDomain).y(yIncludeInDomain).values(function(d){return d.values})(nestedFacetData.values)}else if(position==="fill"){d3.layout.stack().x(xIncludeInDomain).y(yIncludeInDomain).offset(function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]=data[i][j][1]/o*100;else for(i=0;i<n;i++)data[i][j][1]=0}for(j=0;j<m;++j)y0[j]=0;return y0}).values(function(d){return d.values})(nestedFacetData.values)}else if(position==="dodge"){var numGroups=nestedFacetData.values.length;dv.util.each(nestedFacetData.values,function(nestedGroupData,i){dv.util.each(nestedGroupData.values,function(pointData){pointData.dodge={groupIndex:i,numGroups:numGroups}})})}})};geom._addGroupLayerToNestedData=function(){var nestedGroups=[],facetIdToIndex={},groupIdToIndex={};dv.util.each(this._nestData,function(d,i){var facetId=/(.*) ~ .*/g.exec(d.key)[1],groupId=/.* ~ (.*)/g.exec(d.key)[1],facet,group;if(!facetIdToIndex.hasOwnProperty(facetId)){nestedGroups.push({key:facetId,values:[]});facetIdToIndex[facetId]=nestedGroups.length-1}facet=nestedGroups[facetIdToIndex[facetId]];if(!groupIdToIndex.hasOwnProperty(d.key)){facet.values.push({key:groupId,values:[]});groupIdToIndex[d.key]=facet.values.length-1}group=facet.values[groupIdToIndex[d.key]];group.values=group.values.concat(d.values)});return nestedGroups};geom.exit=function(geomGroup){d3.select(geomGroup).selectAll(".series").call(this.exitSeriesGroup,this)};geom.exitSeries=function(seriesGroups,exitPen,self){seriesGroups.selectAll("."+self._dataPointStyleClass).transition().delay(function(d,i,j){return self.delay().call(this,d,i,j)}).duration(function(d,i,j){return self.duration().call(this,d,i,j)}).ease(self.ease()).each(function(){this.__exiting__=true}).attrTween("d",exitPen.call(self).pathTween).remove().each("end",function(d,i){var seriesGroupNode=this.parentNode;if(seriesGroupNode&&seriesGroupNode.childNodes&&!seriesGroupNode.childNodes.length){var geomNode=seriesGroupNode.parentNode;if(geomNode&&geomNode.childNodes&&geomNode.childNodes.length<=1){d3.select(geomNode).remove()}else{d3.select(seriesGroupNode).remove()}}})};geom.coord=function(){return this.chart().coord()};geom._addRegisteredEvents=function(nodes,self){if(!self)self=this;if(!self._geomGroup)return;nodes=!nodes?self._geomGroup.selectAll(".series").selectAll("."+this._dataPointStyleClass):nodes;self=self||this;dv.util.each(self.eventMap,function(e,type){nodes.on(type,function(d,i,j){self.eventMap[type].callback.call(this,d,i,j,d3.event)},e.capture)});dv.util.each(self._chart.eventMap,function(e,type){nodes.on(type+".dvchart",function(d,i){var e=d3.event,interactionGroup=self._chart._interactionGroup.select(".interaction-canvas").node();if(self._shouldDispatchChartEvent(e,interactionGroup)){self._chart.eventMap[type].callback.call(interactionGroup,e)}},e.capture)});dv.util.each(self._behaviors,function(behavior){if(behavior._addRegisteredEvents)behavior._addRegisteredEvents()})};geom._removeRegisteredEvents=function(nodes,self){if(!self)self=this;if(!self._geomGroup)return;nodes=nodes||self._geomGroup.selectAll("."+this._dataPointStyleClass);self=self||this;dv.util.each(self.unregisterEventMap,function(capture,type){nodes.on(type,null,capture)});dv.util.each(self._chart.unregisterEventMap,function(capture,type){nodes.on(type+".dvchart",null,capture)});dv.util.each(self._behaviors,function(behavior){if(behavior._removeRegisteredEvents)behavior._removeRegisteredEvents()})};geom._shouldDispatchChartEvent=function(e,interactionGroup){var result=true;if(e.type==="mouseout"||e.type==="mouseover"){var rTarg=e.relatedTarget;if(!rTarg)rTarg=e.type==="mouseout"?e.toElement:e.fromElement;var relTarget=d3.select(rTarg);if(relTarget&&!relTarget.empty()){var className=relTarget.attr("class");result=!(relTarget.node()===interactionGroup||className&&className.indexOf("-geom")>=0)}}return result};geom.getExplicitScalesMap=function(){var chartScalesMap=dv.util.clone(this._chart.getExplicitScalesMap());for(var prop in this._aes){var geomAesGroup=this._aes[prop],chartAesGroup=chartScalesMap[prop]||{},combinedAesGroup=dv.util.extend({},chartAesGroup,geomAesGroup);chartScalesMap[prop]=combinedAesGroup}return chartScalesMap};geom.getExplicitScale=function(property,scaleIndex){if(property==="group")return this._getGroup();var geomAesGroup=this._aes[property];var chartAesGroup=this.chart()._aes[property];if(scaleIndex!==undefined&&geomAesGroup&&geomAesGroup[scaleIndex])return geomAesGroup[scaleIndex];if(scaleIndex!==undefined&&chartAesGroup&&chartAesGroup[scaleIndex])return chartAesGroup[scaleIndex];if(geomAesGroup&&geomAesGroup[0]!==undefined)return geomAesGroup[0];if(chartAesGroup&&chartAesGroup[0]!==undefined)return chartAesGroup[0];return null};geom.getExplicitScales=function(property){if(!dv.util.isArray(property))property=[property];var explicitScales={},i=-1,n=property.length;while(++i<n){var prop=property[i],geomAesGroup=this._aes[prop],chartAesGroup=this.chart()._aes[prop]||{};explicitScales[prop]=dv.util.extend({},chartAesGroup,geomAesGroup)}return explicitScales};geom.getTrainedScale=function(prop,scaleIndex){return this.chart().getTrainedScale(prop,scaleIndex)};geom.getScale=function(property,scaleIndex){return this.getExplicitScale(property,scaleIndex)};geom.getScales=function(property){return this.getExplicitScales(property)};geom.hasScale=function(property,scaleIndex){if(this.getExplicitScale(property,scaleIndex)){return true}return false};geom._dodgeAdjust=function(d){var seriesIndex=d.dodge.groupIndex,numSeries=d.dodge.numGroups,rangeBand=d.panel.xScale(d).rangeBand(),slicePadding=numSeries>1?rangeBand/(numSeries-1)*this._dodgePadding:0,barWidth=(rangeBand-slicePadding*(numSeries-1))/numSeries;return(barWidth+slicePadding)*seriesIndex+barWidth/2};geom.applyAttributeValue=function(selection,self,styleAttr,prop){var scale=self.getScale(prop,0);selection.style(styleAttr,function(d,i,j){return scale?scale.mapToProp(dv.util.isArray(d)?d[0]:d,i,j):null})};geom._getGroup=function(){if(this._aes.hasOwnProperty("group"))return this._aes.group[0];var chartGroup=this.chart()._getGroup();if(chartGroup&&chartGroup.property()==="group")return chartGroup;var i=-1,len=dv.DEFAULT_CATEGORICAL_AES.length-1;while(i++<len){var catAesGroup=this._aes[dv.DEFAULT_CATEGORICAL_AES[i]];if(catAesGroup&&catAesGroup[0]&&catAesGroup[0]instanceof dv.scale.ordinal&&!dv.util.isUndefined(catAesGroup[0].mapping())){return catAesGroup[0]}}return chartGroup};geom.each=function(arg1,arg2){var timing,f;if(!arguments.length)return this._each;this._each=this._each||{};if(arguments.length<2){f=arg1;timing="end"}else{f=arg2;timing=arg1}this._each[timing]=f;return this};geom.dodgePadding=function(val){if(!arguments)return this._dodgePadding;this._dodgePadding=val;return this};geom.behaviors=function(val){if(!arguments.length)return this._behaviors;this._behaviors=val;return this};geom.stat=function(val){if(!arguments.length)return this._stat;this._stat=val;return this};geom.chart=function(val){if(!arguments.length)return this._chart;this._chart=val;return this};geom.normalizedData=function(val){if(!arguments.length)return this._normalizedData;this._normalizedData=val;return this};geom.data=function(val){if(!arguments.length)return this._data?this._data:this.chart().data();this._data=val;return this};return geom});dv.geom.point=dv.geom.extend(function(){function point(){this._super();this._rendererClass=dv.geom.point}point._dataPointStyleClass="point-geom";point._initializeDefaultAes=function(){this._super();this._defaultAes["shape"]="circle";this._defaultAes["size"]=7};point.getValues=function(seriesData){return seriesData.values};point.exitSeriesGroup=function(geomGroup,self){self.exitSeries(geomGroup,self.enterPen,self)};point.attributes=function(selection,self){selection.attr("style","").classed(self._dataPointStyleClass,true).call(self.applyAttributeValue,self,"opacity","alpha").call(self.applyAttributeValue,self,"stroke","stroke").call(self.applyAttributeValue,self,"fill","fill")};point.getHighlightColor=function(d,i){var fillScale=this.getScale("fill"),strokeScale=this.getScale("stroke");if(strokeScale&&!(strokeScale instanceof dv.scale.constant))return strokeScale.mapToProp(d,i);if(fillScale&&!(fillScale instanceof dv.scale.constant))return fillScale.mapToProp(d,i);return strokeScale?strokeScale.mapToProp(d,i):"#8CC350"};point.enterPen=function(){var self=this,x,y=function(d,i){return d.panel.yScale(d).reverse()?1:0};if(this.position()==="dodge"){x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)}}else{x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)}}return this._decoratePen(x,y)};point.pen=function(){var self=this,x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y;switch(this.position()){case"identity":y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapToProp(d,i)+y.rangeBand()/2,i)};break;case"stack":case"fill":y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.y0+d.y),i)};break;case"dodge":x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)};y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapToProp(d,i)+y.rangeBand()/2,i)};break}return this._decoratePen(x,y)};point._defined=function(d,i){return dv.util.isFinite(d.panel.xScale(d).mapToProp(d,i))&&dv.util.isFinite(d.panel.yScale(d).mapToProp(d,i))};point._decoratePen=function(x,y){var shapeScale=this.getScale("shape"),sizeScale=this.getScale("size"),self=this;var pathRenderer=this.coord()._point().x(x).y(y).defined(this._defined);pathRenderer.renderer.type(function(d,i){return shapeScale.mapToProp(d,i)}).size(function(d,i){return Math.pow(sizeScale.mapToProp(d,i),2)});return{bounds:function(d,i){return pathRenderer.getBounds(d,i)},pathTween:function(d,i){return self.pathTween(pathRenderer,this,d,i)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return point});dv.geom.text=dv.geom.extend(function(){function text(){this._super();this._rendererClass=dv.geom.text;this._dx=d3.functor(0);this._dy=d3.functor(0);this._textFormat=function(d){return d};this._textAnchor="start"}text._dataPointStyleClass="text-geom";text.dx=function(val){if(!arguments.length)return this._dx;this._dx=d3.functor(val);return this};text.dy=function(val){if(!arguments.length)return this._dy;this._dy=d3.functor(val);return this};text.textAnchor=function(val){if(!arguments.length)return this._textAnchor;this._textAnchor=val;return this};text.textFormat=function(val){if(!arguments.length)return this._textFormat;this._textFormat=d3.functor(val);return this};text.getValues=function(seriesData){return seriesData.values};text.updateDataPoints=function(seriesGroups,enterPen,pen,exitPen,self){var alphaScale=self.getScale("alpha"),_enterPen=enterPen.call(self),_updatePen=pen.call(self),_exitPen=exitPen.call(self);var nodes=seriesGroups.selectAll("."+self._dataPointStyleClass).data(function(d){return self.getValues(d)});nodes.exit().transition().delay(function(d,i,j){return self.delay().call(this,d,i,j)}).duration(function(d,i,j){return self.duration().call(this,d,i,j)}).ease(self.ease()).call(_exitPen).each("end.transition",function(d,i){var parentNode=this.parentNode;if(parentNode){parentNode.removeChild(this)}});nodes.enter().append("text").attr("class",function(d,i,j){return"datum-"+i+" series-"+j}).call(self.attributes,self).call(_enterPen);var updateTransition=nodes.call(self.attributes,self).call(self._removeRegisteredEvents,self).call(self._addRegisteredEvents,self);if(dv.ANIMATION){updateTransition=updateTransition.transition().delay(function(d,i,j){return self.delay().call(this,d,i,j)}).duration(function(d,i,j){return self.duration().call(this,d,i,j)}).ease(self.ease())}updateTransition.call(_updatePen).call(self.addEachFunction,self)};text.exitSeriesGroup=function(geomGroup,self){self.exitSeries(geomGroup,self.enterPen,self)};text.exitSeries=function(seriesGroups,exitPen,self){seriesGroups.selectAll("."+self._dataPointStyleClass).transition().delay(function(d,i,j){return self.delay().call(this,d,i,j)}).duration(function(d,i,j){return self.duration().call(this,d,i,j)}).ease(self.ease()).call(exitPen.call(self)).remove().each("end.transition",function(d,i){var seriesGroupNode=this.parentNode;if(seriesGroupNode&&seriesGroupNode.parentNode)seriesGroupNode.removeChild(this);if(seriesGroupNode&&seriesGroupNode.childNodes&&!seriesGroupNode.childNodes.length){d3.select(seriesGroupNode).remove()}})};text.attributes=function(selection,self){selection.attr("style","").classed(self._dataPointStyleClass,true).call(self.applyAttributeValue,self,"stroke","stroke").call(self.applyAttributeValue,self,"fill","fill").call(self.applyAttributeValue,self,"opacity","alpha").call(self.applyAttributeValue,self,"font-size","size").attr("text-anchor",self._textAnchor)};text.enterPen=function(){var self=this,dx=this._dx,y=function(d,i){return d.panel.yScale(d).reverse()?1:0},x;if(this.position()==="dodge"){x=function(d,i,j){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d)+dx(d,i,j),i)}}else{x=function(d,i,j){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2+dx(d,i,j),i)}}return this._decoratePen(x,y)};text.pen=function(){var self=this,dx=this._dx,dy=this._dy,x=function(d,i,j){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2+dx(d,i,j),i)},y;switch(this.position()){case"identity":y=function(d,i,j){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapToProp(d,i)+dy(d,i,j)+y.rangeBand()/2,i)};break;case"stack":case"fill":y=function(d,i,j){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.y0+d.y,i)+dy(d,i,j),i)};break;case"dodge":x=function(d,i,j){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d)+dx(d,i,j),i)};y=function(d,i,j){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapToProp(d,i)+dy(d,i,j)+y.rangeBand()/2,i)};break}return this._decoratePen(x,y)};text._defined=function(d,i){return dv.util.isFinite(d.panel.xScale(d).mapToProp(d,i))&&dv.util.isFinite(d.panel.yScale(d).mapToProp(d,i))};text._decoratePen=function(x,y){var labelScale=this.getScale("label"),self=this;var textRenderer=this.coord()._text().x(x).y(y);return textRenderer().label(function(d,i,j){return self._textFormat.call(this,labelScale.mapToProp(d,i),i,j)}).defined(this._defined)};return text});dv.geom.line=dv.geom.extend(function(){function line(){this._super();this._tension=.7;this._interpolate="linear";this._rendererClass=dv.geom.line}line._dataPointStyleClass="line-geom";line.tension=function(val){if(!arguments.length)return this._tension;this._tension=val;return this};line.interpolate=function(val){if(!arguments.length)return this._interpolate;this._interpolate=val;return this};line._render=function(geomGroup){this._super(geomGroup);var sizeScale=this.getScale("size");if(sizeScale&&sizeScale.to&&!sizeScale.to())sizeScale.to([2,8])};line.getValues=function(seriesData){return[seriesData.values]};line.exitSeriesGroup=function(geomGroup,self){self.exitSeries(geomGroup,self.enterPen,self)};line.attributes=function(selection,self){var lineTypeScale=self.getScale("linetype",0);selection.attr("style","").classed(self._dataPointStyleClass,true).call(self.applyAttributeValue,self,"stroke","stroke").call(self.applyAttributeValue,self,"opacity","alpha").call(self.applyAttributeValue,self,"stroke-width","size").style("stroke-dasharray",function(d,i,j){return lineTypeScale?dv.util.svg.getDasharray(lineTypeScale.mapToProp(d[0],i,j)):null}).style("fill","none")};line.getHighlightColor=function(d,i){var strokeScale=this.getScale("stroke",0);return strokeScale?strokeScale.mapToProp(d,i):"#8CC350"};line.enterPen=function(){var self=this,x,y=function(d,i){return d.panel.yScale(d).reverse()?1:0};if(this.position()==="dodge"){x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)}}else{x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)}}return this._decoratePen(x,y)};line.pen=function(){var self=this,x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y;switch(this.position()){case"identity":y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapToProp(d,i)+y.rangeBand()/2,i)};break;case"stack":case"fill":y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.y0+d.y),i)};break;case"dodge":x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)};y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapToProp(d,i)+y.rangeBand()/2,i)};break}return this._decoratePen(x,y)};line._defined=function(d,i){return dv.util.isFinite(d.panel.xScale(d).mapToProp(d,i))&&dv.util.isFinite(d.panel.yScale(d).mapToProp(d,i))};line._decoratePen=function(x,y){var self=this;var pathRenderer=this.coord()._line().x(x).y(y).defined(this._defined);pathRenderer.renderer.tension(this.tension()).interpolate(this.interpolate());return{bounds:function(d,i){return pathRenderer.getBounds(d,i)},pathTween:function(d,i){return self.pathTween(pathRenderer,this,d,i)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return line});dv.geom.area=dv.geom.extend(function(){function area(){this._super();this._tension=.7;this._interpolate="linear";this._rendererClass=dv.geom.area;this._baseline=0}area._dataPointStyleClass="area-geom";area._initializeDefaultAes=function(){this._super()};area._trainScales=function(){if(this._baseline!==undefined){var yScaleGroup=this.getExplicitScales("y")["y"];for(var scaleIndex in yScaleGroup){var yScale=yScaleGroup[scaleIndex];if(yScale instanceof dv.scale.continuous){yScale.softLowerLimit(this._baseline)}}}this._super()};area.tension=function(val){if(!arguments.length)return this._tension;this._tension=val;return this};area.interpolate=function(val){if(!arguments.length)return this._interpolate;this._interpolate=val;return this};area.getValues=function(seriesData){return[seriesData.values]};area.pathTween=function(pathRenderer,selection,d,i,j){var dObj=d,currentData,previousData=selection.__previousBounds__,objTweens=[],len,_enterPen=this.enterPen.call(this,j),current,previous,xDomain=this.getScale("x").domain(),pointI=-1;currentData=pathRenderer.getBounds(d,i);currentData.coord=this.coord();if(previousData&&previousData.coord&&currentData.coord._type!==previousData.coord._type||currentData.coord.flip()!=previousData.coord.flip()){previousData=this.enterPen.call(this,j).bounds(d,i)}len=Math.max(currentData.length,previousData.length);while(++pointI<len){current=pointI<currentData.length?currentData[pointI]:null;previous=pointI<previousData.length?previousData[pointI]:null;if(!previous){current.x=xDomain[xDomain.length-1];previous=_enterPen.bounds([current],i)[0]}else if(!current){current=_enterPen.bounds([previous],i)[0]}objTweens.push(d3.interpolateObject(previous.bounds,current.bounds))}selection.__previousBounds__=currentData;return function(t){if(t===1){objTweens=objTweens.splice(0,currentData.length)}var bounds=[];dv.util.each(objTweens,function(tween,tweenIndex){var obj={};obj.bounds=tween(t);bounds.push(obj)});return pathRenderer.getPath(bounds)}};area.exitSeriesGroup=function(geomGroup,self){self.exitSeries(geomGroup,self.enterPen,self)};area.attributes=function(selection,self){selection.attr("style","").classed(self._dataPointStyleClass,true).call(self.applyAttributeValue,self,"opacity","alpha").call(self.applyAttributeValue,self,"fill","fill")};area.getHighlightColor=function(d,i){var fillScale=this.getScale("fill");return fillScale?fillScale.mapToProp(d,i):"#8CC350"};area.getBaseline=function(yScale){var minDomain=d3.min(yScale.domain());if(self._baseline!==undefined){return self._baseline}return minDomain<0?0:minDomain};area.enterPen=function(){var self=this,x,y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(self.getBaseline(y)),i)};if(this.position()==="dodge"){x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)}}else{x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)}}return this._decoratePen(x,y,y)};area.pen=function(){var x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y0,y1,self=this;switch(this.position()){case"identity":y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(self.getBaseline(y)),i)};y1=function(d,i){var y=d.panel.yScale(d);return y.mapPropToPercent(d,i)};break;case"stack":case"fill":y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.y0),i)};y1=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.y0+d.y),i)};break;case"dodge":x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)};y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(self.getBaseline(y)),i)};y1=function(d,i){var y=d.panel.yScale(d);return y.mapPropToPercent(d,i)};break}return this._decoratePen(x,y0,y1)};area._defined=function(d,i){return dv.util.isFinite(d.panel.xScale(d).mapToProp(d,i))&&dv.util.isFinite(d.panel.yScale(d).mapToProp(d))};area._decoratePen=function(x,y0,y1){var self=this;var pathRenderer=this.coord()._area().x(x).y0(y0).y1(y1).defined(this._defined);pathRenderer.renderer.tension(this.tension()).interpolate(this.interpolate());return{bounds:function(d,i){var newD=pathRenderer.getBounds(d,i);if(newD){newD.coord=self.coord()}return newD},pathTween:function(d,i){return self.pathTween(pathRenderer,this,d,i)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};area.baseline=function(val){if(!arguments.length)return this._baseline;this._baseline=val;return this};return area});dv.geom.rect=dv.geom.extend(function(){function rect(){this._super();this._rendererClass=dv.geom.rect}rect._dataPointStyleClass="bar-geom";rect._initializeDefaultAes=function(){this._super();this._defaultAes["yMin"]=1;this._defaultAes["yMax"]=1;this._defaultAes["xMin"]=1;this._defaultAes["xMax"]=1;delete this._defaultAes["x"];delete this._defaultAes["y"]};rect._trainScales=function(){var explicitScales=this.getExplicitScales(["yMin","xMin"]),yMinScales=explicitScales["yMin"],xMinScales=explicitScales["xMin"],scaleIndex;for(scaleIndex in yMinScales){var yScaleGroup=this._aes["y"];if(!yScaleGroup)this._aes["y"]=yScaleGroup={};if(!yScaleGroup[scaleIndex])yScaleGroup[scaleIndex]=yMinScales[scaleIndex].copy().property("y").mapping("y");if(this.allowRecalculateScale()){yScaleGroup[scaleIndex].trainingProperties(["yMin","yMax"])}}for(scaleIndex in xMinScales){var xScaleGroup=this._aes["x"];if(!xScaleGroup)this._aes["x"]=xScaleGroup={};if(!xScaleGroup[scaleIndex])xScaleGroup[scaleIndex]=xMinScales[scaleIndex].copy().property("x").mapping("x");if(this.allowRecalculateScale()){xScaleGroup[scaleIndex].trainingProperties(["xMin","xMax"])}}};rect.getValues=function(seriesData){return seriesData.values};rect._render=function(geomGroup){var explicitScales=this.getExplicitScales(["yMin","yMax","y","xMin","xMax","x"]),scaleIndex;for(scaleIndex in explicitScales["yMin"]){var yMinScale=explicitScales["yMin"][scaleIndex],yMaxScale=explicitScales["yMax"][scaleIndex],yScale=explicitScales["y"][scaleIndex];if(yScale){yMaxScale.range(yScale.range()).domain(yScale.domain());yMinScale.range(yScale.range()).domain(yScale.domain())}}for(scaleIndex in explicitScales["xMin"]){var xMinScale=explicitScales["xMin"][scaleIndex],xMaxScale=explicitScales["xMax"][scaleIndex],xScale=explicitScales["x"][scaleIndex];if(xScale){xMaxScale.range(xScale.range()).domain(xScale.domain());xMinScale.range(xScale.range()).domain(xScale.domain())}}this._super(geomGroup)};rect.pathTween=function(pathRenderer,selection,d,i,j){var dObj=d,currentData,previousData=selection.__previousBounds__,currentCoord=this.coord()._type;if(selection.__exiting__)currentData=selection.__exitTransition__.bounds(d,i);else currentData=pathRenderer.getBounds(d,i);if(previousData&&previousData.coord&&currentCoord!==previousData.coord){previousData=selection.__exitTransition__.bounds(d,i)}if(!currentData||!previousData)return null;currentData.coord=currentCoord;var objTween=d3.interpolateObject(previousData.bounds,currentData.bounds);selection.__previousBounds__=currentData;return function(t){dObj.bounds=objTween(t);return pathRenderer.getPath(dObj)}};rect.attributes=function(selection,self){selection.attr("style","").classed(self._dataPointStyleClass,true).call(self.applyAttributeValue,self,"fill","fill").call(self.applyAttributeValue,self,"stroke","stroke").call(self.applyAttributeValue,self,"opacity","alpha")};rect.enterPen=function(){var y=function(d,i){return d.panel.yScale(d).reverse()?1:0},x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapValue(dv.util.isArray(d.x)?d.x[0]:d.xMin,i))},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapValue(dv.util.isArray(d.x)?d.x[1]:d.xMax,i))};return this._decoratePen(x0,x1,y,y)};rect.pen=function(){var x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapValue(dv.util.isArray(d.x)?d.x[0]:d.xMin,i))},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapValue(dv.util.isArray(d.x)?d.x[1]:d.xMax,i))},y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(dv.util.isArray(d.y)?d.y[0]:d.yMin,i))},y1=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(dv.util.isArray(d.y)?d.y[1]:d.yMax,i))};return this._decoratePen(x0,x1,y0,y1)};rect._defined=function(d,i){var x=d.panel.xScale(d),y=d.panel.yScale(d);return dv.util.isFinite(x.mapValue(dv.util.isArray(d.x)?d.x[0]:d.xMin,i))&&dv.util.isFinite(x.mapValue(dv.util.isArray(d.x)?d.x[1]:d.xMax,i))&&dv.util.isFinite(y.mapValue(dv.util.isArray(d.y)?d.y[0]:d.yMin,i))&&dv.util.isFinite(y.mapValue(dv.util.isArray(d.y)?d.y[1]:d.yMax,i))};rect._decoratePen=function(x0,x1,y0,y1){var self=this;var pathRenderer=this.coord()._rect().x0(x0).x1(x1).y0(y0).y1(y1).defined(this._defined);return{bounds:function(d,i){var newD=pathRenderer.getBounds(d,i);if(newD){newD.bounds.coord=self.coord()._type}return newD},pathTween:function(d,i,j){return self.pathTween(pathRenderer,this,d,i,j)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return rect});dv.geom.tile=dv.geom.rect.extend(function(){function tile(){this._super();this._rendererClass=dv.geom.tile}tile._dataPointStyleClass="tile-geom";tile._initializeDefaultAes=function(){this._super();this._defaultAes["y"]=1;this._defaultAes["x"]=1};tile.getValues=function(seriesData){return seriesData.values};tile.enterPen=function(){var y=function(d,i){return d.panel.yScale(d).reverse()?1:0},x0=function(d,i){return d.panel.xScale(d).mapPropToPercent(d,i)},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand(),i)};return this._decoratePen(x0,x1,y,y)};tile.pen=function(){var x0=function(d,i){return d.panel.xScale(d).mapPropToPercent(d,i)},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand(),i)},y0=function(d,i){var y=d.panel.yScale(d);return y.mapPropToPercent(d,i)},y1=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapToProp(d,i)+y.rangeBand(),i)};return this._decoratePen(x0,x1,y0,y1)};tile._defined=function(d,i){return dv.util.isFinite(d.panel.xScale(d).mapToProp(d,i))&&dv.util.isFinite(d.panel.yScale(d).mapToProp(d,i))};tile._decoratePen=function(x0,x1,y0,y1){var self=this;var pathRenderer=this.coord()._rect().x0(x0).x1(x1).y0(y0).y1(y1).defined(this._defined);return{bounds:function(d,i){var newD=pathRenderer.getBounds(d,i);if(newD){newD.bounds.coord=self.coord()._type}return newD},pathTween:function(d,i,j){return self.pathTween(pathRenderer,this,d,i,j)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return tile});dv.geom.bar=dv.geom.rect.extend(function(){function bar(){this._super();this._rendererClass=dv.geom.bar;this._baseline=0;this._width=1}bar._dataPointStyleClass="bar-geom";bar._initializeDefaultAes=function(){this._super();this._defaultAes["y"]=1;this._defaultAes["x"]=1};bar._trainScales=function(){if(this._baseline!==undefined){var yScaleGroup=this.getExplicitScales("y")["y"];for(var scaleIndex in yScaleGroup){var yScale=yScaleGroup[scaleIndex];if(yScale instanceof dv.scale.continuous){yScale.softLowerLimit(this._baseline)}}}};bar.getValues=function(seriesData){return seriesData.values};bar.getBaseline=function(yScale){var minDomain=d3.min(yScale.domain());if(self._baseline!==undefined){return self._baseline}return minDomain<0?0:minDomain};bar.width=function(val){if(!arguments.length)return this.width;this._width=val;return this};bar._enforceMinSize=function(scale,d,i){var baseline=this.getBaseline(scale),difference=d[scale.property()]-baseline,percentBaseline=scale.mapValueToPercent(scale.mapValue(baseline)),percentDifference=scale.mapPropToPercent(d,i)-percentBaseline,scaleExtent=dv.util.scaleExtent(scale.range()),scaleDelta=scaleExtent[1]-scaleExtent[0],minSize=1/scaleDelta;if(scaleDelta===0){return percentBaseline}else if(scale.reverse()){return percentBaseline+(difference<0?Math.max(minSize,percentDifference):Math.min(-minSize,percentDifference))}else{return percentBaseline+(difference<0?Math.min(-minSize,percentDifference):Math.max(minSize,percentDifference))}};bar.enterPen=function(){var self=this,y=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(self.getBaseline(y)),i)},x0,x1;if(this.position()==="dodge"){x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)};x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d,true),i)}}else{x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d),i)};x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d,true),i)}}return this._decoratePen(x0,x1,y,y)};bar.pen=function(){var x0,x1,y0,y1,self=this;switch(this.position()){case"identity":x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d),i)};x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d,true),i)};y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(self.getBaseline(y)),i)};y1=function(d,i){return self._enforceMinSize(d.panel.yScale(d),d,i)};break;case"stack":case"fill":x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d),i)};x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d,true),i)};y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.y0),i)};y1=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.y0+d.y),i)};break;case"dodge":x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d),i)};x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._dodgeAdjust(d,true),i)};y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(self.getBaseline(y)),i)};y1=function(d,i){return self._enforceMinSize(d.panel.yScale(d),d,i)};break}return this._decoratePen(x0,x1,y0,y1)};bar._offsetX=function(d,isEnd){var x=d.panel.xScale(d),rangeBand=x.rangeBand();return rangeBand/2+rangeBand/2*(isEnd?this._width:-this._width)};bar._defined=function(d,i){return dv.util.isFinite(d.panel.xScale(d).mapToProp(d,i))&&dv.util.isFinite(d.panel.yScale(d).mapToProp(d,i))};bar._decoratePen=function(x0,x1,y0,y1){var self=this;var pathRenderer=this.coord()._rect().x0(x0).x1(x1).y0(y0).y1(y1).defined(this._defined);return{bounds:function(d,i){var newD=pathRenderer.getBounds(d,i);if(newD){newD.bounds.coord=self.coord()._type}return newD},pathTween:function(d,i,j){return self.pathTween(pathRenderer,this,d,i,j)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};bar._dodgeAdjust=function(d,isEnd){var seriesIndex=d.dodge.groupIndex,numSeries=d.dodge.numGroups,rangeBand=d.panel.xScale(d).rangeBand(),slicePadding=numSeries>1?rangeBand/(numSeries-1)*this._dodgePadding:0,barWidth=(rangeBand-slicePadding*(numSeries-1))/numSeries;return(barWidth+slicePadding)*seriesIndex+(isEnd?barWidth:0)};bar.baseline=function(val){if(!arguments.length)return this._baseline;this._baseline=val;return this};return bar});dv.geom.barrange=dv.geom.bar.extend(function(){function barrange(){this._super();this._rendererClass=dv.geom.barrange}barrange._initializeDefaultAes=function(){this._super();this._defaultAes["yMin"]=1;this._defaultAes["yMax"]=1;delete this._defaultAes["y"]};barrange._trainScales=function(){var yMinScales=this.getExplicitScales("yMin")["yMin"],yScales,yScale;for(var scaleIndex in yMinScales){if(!this._aes["y"])this._aes["y"]={};yScales=this._aes["y"];yScale=yScales[scaleIndex];if(!yScale)yScales[scaleIndex]=yScale=yMinScales[scaleIndex].copy().property("y").mapping("y");if(this.allowRecalculateScale()){yScale.trainingProperties(["yMin","yMax"])}}};barrange._render=function(geomGroup){var explicitScales=this.getExplicitScales(["yMin","yMax","y"]),yMinScales=explicitScales["yMin"];for(var scaleIndex in yMinScales){var yMinScale=yMinScales[scaleIndex],yMaxScale=explicitScales["yMax"][scaleIndex],yScale=explicitScales["y"][scaleIndex];yMaxScale.range(yScale.range()).domain(yScale.domain());yMinScale.range(yScale.range()).domain(yScale.domain())}this._super(geomGroup)};barrange.enterPen=function(){var self=this,y=function(d,i){return d.panel.yScale(d).reverse()?1:0},x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d),i)},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d,true),i)};return this._decoratePen(x0,x1,y,y)};barrange.pen=function(){var self=this,x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d),i)},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d,true),i)},y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.yMin,i),i)},y1=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.yMax,i),i)};return this._decoratePen(x0,x1,y0,y1)};barrange._defined=function(d,i){var x=d.panel.xScale(d),y=d.panel.yScale(d);return dv.util.isFinite(x.mapToProp(d,i))&&dv.util.isFinite(y.mapValue(d.yMin,i))&&dv.util.isFinite(y.mapValue(d.yMax,i))};barrange._decoratePen=function(x0,x1,y0,y1){var self=this;var pathRenderer=this.coord()._rect().x0(x0).x1(x1).y0(y0).y1(y1).defined(this._defined);return{bounds:function(d,i){var newD=pathRenderer.getBounds(d,i);if(newD){newD.bounds.coord=self.coord()._type}return newD},pathTween:function(d,i,j){return self.pathTween(pathRenderer,this,d,i,j)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return barrange});dv.geom.segment=dv.geom.line.extend(function(){function segment(){this._super();this._rendererClass=dv.geom.segment}segment.getValues=function(seriesData){return seriesData.values};segment.enterPen=function(){var x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y=function(d,i){return d.panel.yScale(d).reverse()?1:0};return this._decoratePen(x,y)};segment.pen=function(){var x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y=function(d,i){return d.panel.yScale(d).mapPropToPercent(d,i)};return this._decoratePen(x,y)};return segment});dv.geom.vline=dv.geom.segment.extend(function(){function vline(){this._super();this._rendererClass=dv.geom.vline}vline._dataPointStyleClass="vline-geom";vline._render=function(geomGroup){var self=this;dv.util.each(this._nestData,function(d,i){var values=[];dv.util.each(d.values,function(d,i){var xScale=d.panel.xScale(d),yScale=d.panel.yScale(d),yDomain=yScale.domain(),x=d[xScale.property()];if(dv.util.isArray(d)){d[0].x=x;d[1].x=x}else{var minMax=[];d.x=x;minMax.push(d);minMax.push(dv.util.clone(d));values.push(minMax)}});self._nestData[i].values=values});this._super(geomGroup)};vline.enterPen=function(){var x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y=function(d,i){return 0};return this._decoratePen(x,y)};vline.pen=function(){var x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y=function(d,i){return i===0?0:1};return this._decoratePen(x,y)};vline._defined=function(d,i){return dv.util.isFinite(d.panel.xScale(d).mapToProp(d,i))};return vline});dv.geom.hline=dv.geom.segment.extend(function(){function hline(){this._super();this._rendererClass=dv.geom.hline}hline._dataPointStyleClass="hline-geom";hline._render=function(geomGroup){var self=this;dv.util.each(this._nestData,function(d,i){var values=[];dv.util.each(d.values,function(d,i){var xScale=d.panel.xScale(d),yScale=d.panel.yScale(d),xDomain=xScale.domain(),y=d[yScale.property()];if(dv.util.isArray(d)){d[0].y=y;d[1].y=y}else{var minMax=[];d.y=y;minMax.push(d);minMax.push(dv.util.clone(d));values.push(minMax)}});self._nestData[i].values=values});this._super(geomGroup)};hline.enterPen=function(){var x=function(d,i){return i===0?d.data&&d.data.xStart?d.data.xStart:0:d.data&&d.data.xEnd?d.data.xEnd:1},y=function(d,i){return d.panel.yScale(d).reverse()?1:0};return this._decoratePen(x,y)};hline.pen=function(){var x=function(d,i){return i===0?d.data&&d.data.xStart?d.data.xStart:0:d.data&&d.data.xEnd?d.data.xEnd:1},y=function(d,i){return d.panel.yScale(d).mapPropToPercent(d,i)};return this._decoratePen(x,y)};hline._defined=function(d,i){return dv.util.isFinite(d.panel.yScale(d).mapToProp(d,i))};return hline});dv.geom.ribbon=dv.geom.area.extend(function(){function ribbon(){this._super();this._rendererClass=dv.geom.ribbon}ribbon._initializeDefaultAes=function(){this._super();this._defaultAes["yMin"]=1;this._defaultAes["yMax"]=1;delete this._defaultAes["y"]};ribbon._trainScales=function(){var yMinScales=this.getExplicitScales("yMin")["yMin"]||{},yScales=this._aes["y"],yScale;if(!yScales){yScales=this._aes["y"]={}}for(var minScaleIndex in yMinScales){yScale=yScales[minScaleIndex];if(!yScale)yScales[minScaleIndex]=yScale=yMinScales[minScaleIndex].copy().property("y").mapping("y")}for(var yScaleIndex in yScales){yScale=yScales[yScaleIndex];if(this.allowRecalculateScale()){yScale.trainingProperties(["yMin","yMax"])}}};ribbon._render=function(geomGroup){var explicitScales=this.getExplicitScales(["yMin","yMax","y"]),yMinScales=explicitScales["yMin"];for(var scaleIndex in yMinScales){var yMinScale=yMinScales[scaleIndex],yMaxScale=explicitScales["yMax"][scaleIndex],yScale=explicitScales["y"][scaleIndex];yMaxScale.range(yScale.range()).domain(yScale.domain());yMinScale.range(yScale.range()).domain(yScale.domain())}this._super(geomGroup)};ribbon.enterPen=function(){var self=this,x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y=function(d,i){return d.panel.yScale(d).reverse()?1:0};return this._decoratePen(x,y,y)};ribbon.pen=function(){var x=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+x.rangeBand()/2,i)},y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.yMin,i))},y1=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.yMax,i))};return this._decoratePen(x,y0,y1)};ribbon._defined=function(d,i){var x=d.panel.xScale(d),y=d.panel.yScale(d);return dv.util.isFinite(x.mapToProp(d,i))&&dv.util.isFinite(y.mapValue(d.yMin,i))&&dv.util.isFinite(y.mapValue(d.yMax,i))};ribbon._decoratePen=function(x,y0,y1){var self=this;var pathRenderer=this.coord()._area().x(x).y0(y0).y1(y1).defined(this._defined);pathRenderer.renderer.tension(this.tension()).interpolate(this.interpolate());return{bounds:function(d,i){var newD=pathRenderer.getBounds(d,i);if(newD){newD.coord=self.coord()}return newD},pathTween:function(d,i){return self.pathTween(pathRenderer,this,d,i)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return ribbon});dv.geom.errorbar=dv.geom.extend(function(){function errorbar(){this._super();this._rendererClass=dv.geom.errorbar;this._width=1}errorbar._dataPointStyleClass="errorbar-geom";errorbar._initializeDefaultAes=function(){this._super();this._defaultAes["yMin"]=1;this._defaultAes["yMax"]=1;delete this._defaultAes["y"]};errorbar._trainScales=function(){var yMinScales=this.getExplicitScales("yMin")["yMin"],yScale;for(var scaleIndex in yMinScales){if(!this._aes["y"])this._aes["y"]={};yScales=this._aes["y"];yScale=yScales[scaleIndex];if(!yScale)yScales[scaleIndex]=yScale=yMinScales[scaleIndex].copy().property("y").mapping("y");if(this.allowRecalculateScale()){yScale.trainingProperties(["yMin","yMax"])}}};errorbar.getValues=function(seriesData){return seriesData.values};errorbar.width=function(val){if(!arguments.length)return this._width;this._width=val;return this};errorbar.attributes=function(selection,self){var lineTypeScale=self.getScale("linetype");selection.attr("style","").classed(self._dataPointStyleClass,true).call(self.applyAttributeValue,self,"stroke","stroke").call(self.applyAttributeValue,self,"opacity","alpha").call(self.applyAttributeValue,self,"stroke-width","size").style("stroke-dasharray",function(d,i,j){return lineTypeScale?dv.util.svg.getDasharray(lineTypeScale.mapToProp(d[0],i,j)):null}).style("fill","none")};errorbar._render=function(geomGroup){var xScale=this.getScale("x");if(!(xScale instanceof dv.scale.ordinal)){var minDistanceBetweenPoints=Number.MAX_VALUE,value,previousValue;dv.util.each(this._nestData,function(seriesData){dv.util.each(seriesData.values,function(pointData){value=pointData.panel.xScale(pointData).mapValue(pointData.x);if(!dv.util.isUndefined(previousValue)){minDistanceBetweenPoints=Math.min(minDistanceBetweenPoints,Math.abs(value-previousValue))}previousValue=value})});this._maxWidthPixels=minDistanceBetweenPoints}var explicitScales=this.getExplicitScales(["yMin","yMax","y"]),yMinScales=explicitScales["yMin"];for(var scaleIndex in yMinScales){var yMinScale=yMinScales[scaleIndex],yMaxScale=explicitScales["yMax"][scaleIndex];yScale=explicitScales["y"][scaleIndex];yMaxScale.range(yScale.range()).domain(yScale.domain());yMinScale.range(yScale.range()).domain(yScale.domain())}this._super(geomGroup)};errorbar.enterPen=function(){var self=this,x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d),i)},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d,true),i)},y=function(d,i){return d.panel.yScale(d).reverse()?1:0};return this._decoratePen(x0,x1,y,y)};errorbar.pen=function(){var self=this,x0=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d),i)},x1=function(d,i){var x=d.panel.xScale(d);return x.mapValueToPercent(x.mapToProp(d,i)+self._offsetX(d,true),i)},y0=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.yMin,i))},y1=function(d,i){var y=d.panel.yScale(d);return y.mapValueToPercent(y.mapValue(d.yMax,i))};return this._decoratePen(x0,x1,y0,y1)};errorbar._isOrdinal=function(d){return d.panel.xScale(d)instanceof dv.scale.ordinal};errorbar._offsetX=function(d,isEnd){var x=d.panel.xScale(d),result;if(x instanceof dv.scale.ordinal){result=x.rangeBand()/2+x.rangeBand()/2*(isEnd?this._width:-this._width)}else{result=this._maxWidthPixels*(isEnd?this._width/2:-this._width/2)}return result};errorbar._defined=function(d,i){var x=d.panel.xScale(d),y=d.panel.yScale(d);return dv.util.isFinite(x.mapToProp(d,i))&&dv.util.isFinite(y.mapValue(d.yMin,i))&&dv.util.isFinite(y.mapValue(d.yMax,i))};errorbar._decoratePen=function(x0,x1,y0,y1){var self=this;var pathRenderer=this.coord()._errorBar().x0(x0).x1(x1).y0(y0).y1(y1).defined(this._defined);return{bounds:function(d,i){return pathRenderer.getBounds(d,i)},pathTween:function(d,i){return self.pathTween(pathRenderer,this,d,i)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return errorbar});dv.geom.poly=dv.geom.extend(function(){function poly(){this._super();this._rendererClass=dv.geom.poly}poly._dataPointStyleClass="poly-geom";poly._initializeDefaultAes=function(){this._super();this._defaultAes["size"]=1;delete this._defaultAes["shape"];delete this._defaultAes["x"];delete this._defaultAes["y"]};poly._trainScales=function(){var explicitScales=this.getExplicitScales(["yMin","xMin"]),scaleIndex;for(scaleIndex in explicitScales["yMin"]){var yScaleGroup=this._aes["y"];if(!yScaleGroup)this._aes["y"]=yScaleGroup={};if(!yScaleGroup[scaleIndex])yScaleGroup[scaleIndex]=yMinScale.copy().property("y").mapping("y");if(this.allowRecalculateScale()){yScaleGroup[scaleIndex].trainingProperties(["yMin","yMax"])}}for(scaleIndex in explicitScales["xMin"]){var xScaleGroup=this._aes["x"];if(!xScaleGroup)this._aes["x"]=xScaleGroup={};if(!xScaleGroup[scaleIndex])xScaleGroup[scaleIndex]=xMinScale.copy().property("x").mapping("x");if(this.allowRecalculateScale()){xScaleGroup[scaleIndex].trainingProperties(["xMin","xMax"])}}};poly.getValues=function(seriesData){return seriesData.values};poly.attributes=function(selection,self){var fillScale=self.getScale("fill"),strokeScale=self.getScale("stroke"),alphaScale=self.getScale("alpha");selection.attr("style","").classed(self._dataPointStyleClass,true).call(self.applyAttributeValue,self,"stroke","stroke").call(self.applyAttributeValue,self,"fill","fill").call(self.applyAttributeValue,self,"opacity","alpha")};poly.exitSeriesGroup=function(geomGroup,self){self.exitSeries(geomGroup,self.enterPen,self)};poly.getHighlightColor=function(d,i){var fillScale=this.getScale("fill"),strokeScale=this.getScale("stroke");if(!(strokeScale instanceof dv.scale.constant))return strokeScale.mapToProp(d,i);if(!(fillScale instanceof dv.scale.constant))return fillScale.mapToProp(d,i);return strokeScale.mapToProp(d,i)};poly.enterPen=function(){var x=function(d,i){return d.panel.xScale(d).mapPropToPercent(d,i)},y=function(d,i){var y=d.panel.yScale(d);return dv.util.map(d[y.property()],function(){return y.reverse()?1:0})};return this._decoratePen(x,y)};poly.pen=function(){var x=function(d,i){return d.panel.xScale(d).mapPropToPercent(d,i)},y=function(d,i){return d.panel.yScale(d).mapPropToPercent(d,i)};return this._decoratePen(x,y)};poly._defined=function(d,i){var xs=d.panel.xScale(d).mapToProp(d,i),ys=d.panel.yScale(d).mapToProp(d,i),max_i=d3.max([xs.length,ys.length]),finite=true;for(var j=0;j<max_i&&finite;j++){finite=dv.util.isFinite(xs[j])&&dv.util.isFinite(ys[j])}return finite};poly._decoratePen=function(x,y){var self=this;var pathRenderer=this.coord()._poly().xs(x).ys(y).defined(this._defined);return{bounds:function(d,i){return pathRenderer.getBounds(d,i)},pathTween:function(d,i,j){return self.pathTween(pathRenderer,this,d,i,j)},path:function(d,i){return pathRenderer.getPath(pathRenderer.getBounds(d,i))}}};return poly});dv.behavior=dv.extend(function(){function behavior(){}var useScreenCoords;behavior._testAndroidChromeBug141840=function(){if(useScreenCoords===undefined){var ua=navigator.userAgent;useScreenCoords=/Android .* Chrome\/18+/.exec(ua)!==null||/Silk\/2./.exec(ua)!==null}return useScreenCoords};return behavior});dv.behavior.inspector=dv.behavior.extend(function(){function inspector(){this._size=undefined;this._lastX=NaN;this._visible=false;this._inspector=null;this._thickness=3;this._orientation="bottom";this._currentValue=null;this._gutterPadding=-7;this._calloutPadding={left:8,top:7,right:8,bottom:7};this._label=this._defaultLabel();this._underGeoms=false;this._dragInspect=true;this._pressTimer=null}inspector._render=function(selection){this._domain=sort_data.call(this);var maxWidth=0,bounds=this._chart.facet().getPanel(0)._bounds;if(this._size===undefined)this._size=bounds.bottom-bounds.top;this._xGuide=dv.util.clone(this._chart._axes._get("x")[0]);this._selection=selection;this._inspector=selection.selectAll(".inspector").data([0]);this._inspector.call(this._createInspector,this._orientation,bounds,this._calloutPadding,this._thickness);dv.setVisibilityHidden(this._inspector)};inspector._createInspector=function(selection,orientation,bounds,calloutPadding,thickness){var inspectorUpdate=selection,inspectorEnter=selection.enter();inspectorEnter=inspectorEnter.append("g").classed({visibilityTransition:true,inspector:true});inspectorUpdate.style("pointer-events","none").attr("transform","translate(0,"+bounds.top+")");var markerEnter=inspectorEnter.append("g").classed("inspector-marker",true);var lineContainerEnter=markerEnter.append("g").classed("inspector-line-container",true);lineContainerEnter.append("path").classed("inspector-callout",true);inspectorUpdate.select(".inspector-callout").attr("d",function(){var y0=-3,y1=y0+5;if(orientation==="bottom"){y0=bounds.bottom-bounds.top+2;y1=y0-5}return"M-5,"+y0+"L5,"+y0+"L0,"+y1+"Z"});lineContainerEnter.append("line").classed("inspector-line",true);inspectorUpdate.select(".inspector-line").attr("y1",orientation==="bottom"?0:4).attr("y2",orientation==="bottom"?bounds.bottom-bounds.top-6:bounds.bottom-bounds.top).style("stroke-width",thickness);var tip=markerEnter.append("g").classed("inspector-tip",true);inspectorUpdate.select(".inspector-tip").attr("transform","translate(0,"+(orientation==="bottom"?bounds.bottom-bounds.top+2:-30)+")");tip.append("rect").classed("inspector-tip-background",true);tip.append("text").classed("inspector-tip-label",true);inspectorUpdate.select(".inspector-tip-label").attr("x",calloutPadding.left).attr("y","1em").attr("dy",calloutPadding.top)};inspector.moveToIndex=function(index){var xScale=this._chart.getTrainedScale("x"),value=this._domain[index],label=this._label.call(this,value,index),xPos=xScale.mapValue(value);move.call(this,value,label,xPos)};inspector.hide=function(){dv.setVisibilityHidden(this._inspector);this._visible=false;return this};inspector.show=function(){dv.setVisibilityForeground(this._inspector);this._visible=true;return this};inspector._removeEvents=function(){this._chart.on("mousemove.inspector",null);this._chart.on("mouseout.inspector",null);this._chart.on("touchstart.inspector",null);this._chart.on("touchmove.inspector",null);this._chart.on("touchend.inspector",null)};inspector.inspectorMove=function(val){if(!arguments.length)return this._inspectorMove;this._inspectorMove=val;return this};inspector.inspectorOut=function(val){if(!arguments.length)return this._inspectorOut;this._inspectorOut=val;return this};inspector.label=function(val){if(!arguments.length)return this._label;this._label=d3.functor(val);return this};inspector.thickness=function(val){if(!arguments.length)return this._thickness;this._thickness=val;return this};inspector.size=function(val){if(!arguments.length)return this._size;this._size=val;return this};inspector.chart=function(val){if(!arguments.length)return this._chart;if(this._chart)this._removeEvents();this._chart=val;if(this._chart)add_events.call(this);return this};inspector.orientation=function(val){if(!arguments.length)return this._orientation;this._orientation=val;return this};function sort_data(){var allData=[],chartXScale=this._chart.getTrainedScale("x"),sortedData,containsTimeData=false,uniqCompareFunc=function(a,b){a=chartXScale._parse(a);b=chartXScale._parse(b);return containsTimeData&&a&&b?a.getTime()===b.getTime():a===b},sortCompareFunc=function(d){return chartXScale.mapValue(d)},chartData=this._chart.data(),i=-1,n=this._chart._layers.length;if(chartData.length)allData.concat(chartData[chartXScale.property()]);while(++i<n){var geom=this._chart._layers[i],geomXScale=geom.getTrainedScale("x"),geomData=geom.data()[geomXScale.property()];if(geomData&&geomData!==chartData){allData=allData.concat(geomData)}containsTimeData=containsTimeData||(geomXScale instanceof dv.scale.time||geomXScale instanceof dv.scale.time.utc)}return allData.length?dv.util.sortBy(dv.util.uniqueValues(allData,uniqCompareFunc),sortCompareFunc):allData}function add_events(){this._chart.on("mousemove.inspector",dv.util.bind(on_mouse_move,this));this._chart.on("mouseout.inspector",dv.util.bind(on_mouse_out,this));this._chart.on("touchstart.inspector",dv.util.bind(on_touch_start,this),dv.passiveListenerOption);this._chart.on("touchmove.inspector",dv.util.bind(on_mouse_move,this),dv.passiveListenerOption);this._chart.on("touchend.inspector",dv.util.bind(on_touch_end,this),dv.passiveListenerOption)}inspector._defaultLabel=function(){var self=this;return function(d){var formatter=self._xGuide.tickFormat?self._xGuide.tickFormat():function(d){return d};return formatter(d)}};inspector.label=function(lbl){if(!arguments.length)return this._label;this._label=d3.functor(lbl);return this};inspector.underGeoms=function(val){if(!arguments.length)return this._underGeoms;this._underGeoms=val;return this};inspector.gutterPadding=function(val){if(!arguments.length)return this._gutterPadding;this._gutterPadding=val;return this};function move(value,label,xPos){var calloutWidth=0,calloutHeight=0;if(this._lastX===xPos)return;dv.setVisibilityForeground(this._inspector);this._inspector.select(".inspector-tip-label").text(label).each(function(){var bbox=this.getBBox();calloutWidth=Math.max(bbox.width,calloutWidth);calloutHeight=Math.max(bbox.height,calloutHeight)});var panelBounds=this._chart.facet().getPanel(0).bounds(),inspectorCalloutXPos;calloutWidth+=this._calloutPadding.left+this._calloutPadding.right;calloutHeight+=this._calloutPadding.top+this._calloutPadding.bottom;inspectorCalloutXPos=xPos-calloutWidth/2;if(inspectorCalloutXPos<panelBounds.left+this._gutterPadding){inspectorCalloutXPos=panelBounds.left+this._gutterPadding}if(inspectorCalloutXPos+calloutWidth>panelBounds.right-this._gutterPadding){inspectorCalloutXPos=panelBounds.right-this._gutterPadding-calloutWidth}this._inspector.select(".inspector-marker").attr("transform","translate("+inspectorCalloutXPos+",0)");this._inspector.select(".inspector-tip-background").attr("width",calloutWidth).attr("height",calloutHeight);var lineXPos=xPos-inspectorCalloutXPos;this._inspector.select(".inspector-line-container").attr("transform","translate("+lineXPos+",0)")}function on_touch_start(ev){if(!ev)return;var self=this;this._dragInspect=false;clearTimeout(this._pressTimer);this._pressTimer=setTimeout(function(){self._dragInspect=true;on_mouse_move.call(self,ev)},500);return false}function on_touch_end(ev){clearTimeout(this._pressTimer);if(this._dragInspect){this._dragInspect=false}on_mouse_out.call(this,ev)}function on_mouse_move(ev){if(!ev)return;if(!this._dragInspect){clearTimeout(this._pressTimer);return}var rawEvent=ev.touches?ev.touches[0]:ev;var xScale=this._chart.getTrainedScale("x"),xCoord=this._testAndroidChromeBug141840()?rawEvent.screenX:rawEvent.clientX,eventX=xCoord-rawEvent.target.getBoundingClientRect().left+rawEvent.target.getBBox().x,index=dv.util.binaryCompare(this._domain,eventX,function(d){return xScale.mapValue(d)}),constrainedIndex=Math.min(Math.max(index||0,0),this._domain.length-1),value=this._domain[constrainedIndex],label=this._label.call(this,value,constrainedIndex),xPos=xScale.mapValue(value);if(this._currentValue!=value){if(this._inspectorMove){this._inspectorMove.call(this,label,constrainedIndex,xPos,value)}move.call(this,value,label,xPos)}this._currentValue=value;dv.cancelEvent(ev)}function on_mouse_out(ev){dv.setVisibilityHidden(this._inspector);if(this._inspectorOut){this._inspectorOut.call(this)}this._currentValue=null;dv.cancelEvent(ev)}return inspector});dv.behavior.brush=dv.behavior.extend(function(){function brush(dimensions){if(arguments.length&&!dv.util.isArray(dimensions))this._dimensions=[this._dimensions];this._fluidDimensions=dimensions||["x","y"];this._snap=false;this._resizing=false}brush.initializeBrush=function(chart){var self=this;this._brush=dv.brush(chart).on("brushstart.brush",function(){self._onBrushStart.call(self);if(self._brushStart)self._brushStart.call(this,"start",self._brush.extent(),self)}).on("brush.brush",function(brush){self._onBrushMove.call(self);if(self._brushMove)self._brushMove.call(this,"move",self._brush.extent(),self)}).on("brushend.brush",function(){self._onBrushEnd.call(self);if(self._brushEnd)self._brushEnd.call(this,"end",self._brush.extent(),self)})};brush._removeEvents=function(){this._brush.on("brushstart.brush",null).on("brush.brush",null).on("brushend.brush",null)};brush._onBrushStart=function(){if(!this.snap()||this._fluidDimensions.length>1)return;this._startPos=d3.mouse(this._brushContainer.node());this._moving=d3.select(d3.event.sourceEvent.target).classed("extent")};brush._onBrushMove=function(){if(!this.snap()||this._fluidDimensions.length>1)return;var movePos=d3.mouse(this._brushContainer.node());if(this._startPos[0]!==movePos[0]||this._startPos[1]!==movePos[1])this._snapToDataPoints()};brush._onBrushEnd=function(){if(!this.snap()||this._fluidDimensions.length>1)return;var endPos=d3.mouse(this._brushContainer.node());if(!this._moving&&this._startPos[0]===endPos[0]&&this._startPos[1]===endPos[1])this.clear();else this._brushContainer.selectAll(".resize").style("display",null)};brush._snapToDataPoints=function(){var brushExtent=this._brush.extent(),extentPixels=[],scale=this._chart.getTrainedScale(this._fluidDimensions[0]),extentValues=[this._snapToNearestPoint(scale,brushExtent[0],0),this._snapToNearestPoint(scale,brushExtent[1],1)];this._brush.extent([extentValues[0].value,extentValues[1].value]);var plotBounds=this._chart.plotBounds();if(this._fluidDimensions==="x"){extentPixels[0]=[extentValues[0].rangeValue,0];extentPixels[1]=[extentValues[1].rangeValue,plotBounds.bottom-plotBounds.top]}else{extentPixels[0]=[0,extentValues[0].rangeValue];extentPixels[1]=[plotBounds.right-plotBounds.left,extentValues[1].rangeValue]}this._adjustBounds(this._brushContainer,extentPixels)};brush._snapToNearestPoint=function(scale,point,pointIndex){var retObj={},constrainedIndex;if(scale instanceof dv.scale.ordinal||scale instanceof dv.scale.identity){var range=dv.util.scaleRangeNoReverse(scale);var totalRange=range[1]-range[0];domain=scale.domain();constrainedIndex=Math.round(scale.invertValue(point)/totalRange-1)}else{domain=dv.util.uniq(this._chart.data()[scale.mapping()]);index=dv.util.binaryCompare(domain,point,function(d){return d});constrainedIndex=Math.min(Math.max(index||0,0),domain.length-1)}var value=domain[constrainedIndex];retObj.value=value;if(pointIndex===0){if(constrainedIndex===0){retObj.rangeValue=scale.mapValue(value)}else{var previousValue=domain[constrainedIndex-1],previousValueRange=scale.mapValue(previousValue);valueRange=scale.mapValue(value);retObj.rangeValue=valueRange-(valueRange-previousValueRange)/2}}else{if(constrainedIndex===domain.length-1){retObj.rangeValue=scale.mapValue(value)}else{var nextValue=domain[constrainedIndex+1],nextValueRange=scale.mapValue(nextValue);valueRange=scale.mapValue(value);retObj.rangeValue=valueRange+(nextValueRange-valueRange)/2}}return retObj};brush._adjustBounds=function(g,extentPixels){if(this._fluidDimensions==="x")this._adjustBoundsX(g,extentPixels);if(this._fluidDimensions==="y")this._adjustBoundsY(g,extentPixels);g.selectAll(".resize").attr("transform",function(d){return"translate("+extentPixels[+/e$/.test(d)][0]+","+extentPixels[+/^s/.test(d)][1]+")"})};brush._adjustBoundsX=function(g,extentPixels){g.select(".extent").attr("x",extentPixels[0][0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",extentPixels[1][0]-extentPixels[0][0])};brush._adjustBoundsY=function(g,extentPixels){g.select(".extent").attr("y",extentPixels[0][1]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",extentPixels[1][1]-extentPixels[0][1])};brush._setScales=function(){if(this._fluidDimensions.indexOf("x")>=0){var x=this._chart.getTrainedScale("x");this._brush.x(x._d3Scale)}if(this._fluidDimensions.indexOf("y")>=0){var y=this._chart.getTrainedScale("y");this._brush.y(y._d3Scale)}};brush._render=function(){this._brushContainer=this._chart._parent.select(".interaction-group");if(this._brush.empty()){this._brushContainer.classed("brush",true).call(this._brush)}var plotBounds=this._chart.plotBounds();if(!this._brush.y()){var height=plotBounds.bottom-plotBounds.top;this._brushContainer.selectAll(".extent").attr("height",height).attr("y",0);this._brushContainer.selectAll(".resize rect").attr("height",height).attr("y",0)}if(!this._brush.x()){var width=plotBounds.right-plotBounds.left;this._brushContainer.selectAll(".extent").attr("width",width).attr("x",0);this._brushContainer.selectAll(".resize rect").attr("width",width).attr("x",0)}};brush.empty=function(){return this._brush.empty()};brush.clear=function(){this._brushContainer.call(this._brush.clear())};brush.extent=function(extent){if(!arguments.length)return this._brush?this._brush.extent():null;this._brushContainer.call(this._brush.extent(extent));return this};brush.snap=function(val){if(!arguments.length)return this._snap;this._snap=this._fluidDimensions.length>1?false:val;return this};brush.brushStart=function(val){if(!arguments.length)return this._brushStart;this._brushStart=val;return this};brush.brushMove=function(val){if(!arguments.length)return this._brushMove;this._brushMove=val;return this};brush.brushEnd=function(val){if(!arguments.length)return this._brushEnd;this._brushEnd=val;return this};brush.chart=function(val){if(!arguments.length)return this._chart;this._chart=val;this.initializeBrush(this._chart);if(this._chart)this._setScales();return this};return brush});dv.brush=function(chart){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,resizes=d3_svg_brushResizes[0],extent=[[0,0],[0,0]],extentDomain;function brush(g){g.each(function(){var g=d3.select(this),bg=g.selectAll(".background").data([0]),fg=g.selectAll(".extent").data([0]),tz=g.selectAll(".resize").data(resizes,String),e;chart.on("mousedown.brush",brushstart).on("touchstart.brush",brushstart)._g.style("cursor","crosshair");g.style("pointer-events","all");fg.enter().append("rect").attr("class","extent").style("cursor","move");tz.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[e]$/.test(d)?-10:/[w]$/.test(d)?2:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",10).attr("height",6).style("visibility","hidden");tz.style("display",brush.empty()?"none":null);tz.exit().remove();if(x){e=dv.util.scaleRangeNoReverse(x);bg.attr("x",e[0]).attr("width",e[1]-e[0]);redrawX(g)}if(y){e=dv.util.scaleRangeNoReverse(y);bg.attr("y",e[0]).attr("height",e[1]-e[0]);redrawY(g)}redraw(g)})}function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+extent[+/e$/.test(d)][0]+","+extent[+/^s/.test(d)][1]+")"})}function redrawX(g){g.select(".extent").attr("x",extent[0][0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",extent[1][0]-extent[0][0])}function redrawY(g){g.select(".extent").attr("y",extent[0][1]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",extent[1][1]-extent[0][1])}function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),center,origin=mouse(),offset;var w=d3.select(window).on("mousemove.brush",brushmove).on("mouseup.brush",brushend).on("touchmove.brush",brushmove).on("touchend.brush",brushend).on("keydown.brush",keydown).on("keyup.brush",keyup);if(dragging){origin[0]=extent[0][0]-origin[0];origin[1]=extent[0][1]-origin[1]}else if(resizing&&(resizing==="e"||resizing==="w"||resizing==="s"||resizing==="n"||resizing==="nw"||resizing==="ne"||resizing==="sw"||resizing==="se")){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[extent[1-ex][0]-origin[0],extent[1-ey][1]-origin[1]];origin[0]=extent[ex][0];origin[1]=extent[ey][1]}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();d3_eventCancel();function mouse(){var touches=d3.event.changedTouches;return touches?d3.touches(target,touches)[0]:d3.mouse(target)}function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=extent[1][0];origin[1]-=extent[1][1];dragging=2}d3_eventCancel()}}function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=extent[1][0];origin[1]+=extent[1][1];dragging=0;d3_eventCancel()}}function brushmove(){var point=mouse(),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1]}if(!dragging){if(d3.event.altKey){if(!center)center=[(extent[0][0]+extent[1][0])/2,(extent[0][1]+extent[1][1])/2];origin[0]=extent[+(point[0]<center[0])][0];origin[1]=extent[+(point[1]<center[1])][1]}else center=null}if(resizingX&&move1(point,x,0)){redrawX(g);moved=true}if(resizingY&&move1(point,y,1)){redrawY(g);moved=true}if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"})}}function move1(point,scale,i){var range=dv.util.scaleRangeNoReverse(scale),r0=range[0],r1=range[1],position=origin[i],size=extent[1][i]-extent[0][i],min,max;if(dragging){r0-=position;r1-=size+position}min=Math.max(r0,Math.min(r1,point[i]));if(dragging){max=(min+=position)+size}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position}else{max=position}}if(extent[0][i]!==min||extent[1][i]!==max){extentDomain=null;extent[0][i]=min;extent[1][i]=max;return true}}function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);event_({type:"brushend"});d3_eventCancel()}}brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){z=extentDomain||extent;if(x){x0=z[0][0],x1=z[1][0];if(!extentDomain){x0=extent[0][0],x1=extent[1][0];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t}}if(y){y0=z[0][1],y1=z[1][1];if(!extentDomain){y0=extent[0][1],y1=extent[1][1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t}}return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1]}extentDomain=[[0,0],[0,0]];if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];extentDomain[0][0]=x0,extentDomain[1][0]=x1;if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;extent[0][0]=x0|0,extent[1][0]=x1|0}if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];extentDomain[0][1]=y0,extentDomain[1][1]=y1;if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;extent[0][1]=y0|0,extent[1][1]=y1|0}return brush};brush.clear=function(){extentDomain=null;extent[0][0]=extent[0][1]=extent[1][0]=extent[1][1]=0;return brush};brush.empty=function(){return x&&extent[0][0]===extent[1][0]||y&&extent[0][1]===extent[1][1]};return d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];function d3_dispatch(){}function d3_dispatch_event(dispatch){function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch}var listeners=[],listenerByName=new d3.map;event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name)}if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch};return event}d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>0){name=type.substring(i+1);type=type.substring(0,i)}return arguments.length<2?this[type].on(name):this[type].on(name,listener)};function d3_eventDispatch(target){var dispatch=new d3_dispatch,i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){var e0;try{e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};return dispatch}function d3_eventCancel(){d3.event.stopPropagation();d3.event.preventDefault()}dv.behavior.zoom=dv.behavior.extend(function(){function zoom(dimensions){if(arguments.length&&!dv.util.isArray(dimensions))this._dimensions=[this._dimensions];this._fluidDimensions=dimensions||["x","y"];this._zoom=d3.behavior.zoom();this.scaleExtent([0,Infinity]);this._underGeoms=false}zoom.initializeZoom=function(chart){var self=this;this._cacheAxes();this._zoom.on("zoomstart.zoom",function(){if(self._zoomStart)self._zoomStart.call(this,"start",d3.event.scale,d3.event.translate,self)}).on("zoom.zoom",function(){if(self._zoomMove)self._zoomMove.call(this,"move",d3.event.scale,d3.event.translate,self);self._refresh(d3.event.scale,d3.event.translate)}).on("zoomend.zoom",function(){if(self._zoomEnd)self._zoomEnd.call(this,"end",d3.event.scale,d3.event.translate,self)})};zoom.underGeoms=function(val){if(!arguments.length)return this._underGeoms;this._underGeoms=val;return this};zoom._cacheAxes=function(){this._axisCache={};for(var axis in this._chart._axes._axes){this._axisCache[axis]=this._chart._axes._axes[axis]}};zoom._removeEvents=function(){this._zoom.on("zoomstart.zoom",null).on("zoom.zoom",null).on("zoomend.zoom",null)};zoom._refresh=function(scale,translate){var self=this,xBounds=[0,this._bounds.width-this._bounds.width*scale],yBounds=[0,this._bounds.height-this._bounds.height*scale];if(scale>=1){translate[0]=Math.min(xBounds[0],Math.max(translate[0],xBounds[1]));translate[1]=Math.min(yBounds[0],Math.max(translate[1],yBounds[1]))}else{translate[0]=translate[0]<xBounds[0]?xBounds[0]:translate[0]>xBounds[1]?xBounds[1]:translate[0];translate[1]=translate[1]<yBounds[0]?yBounds[0]:translate[1]>yBounds[1]?yBounds[1]:translate[1]}this._zoom.translate(translate);setTimeout(function(){self._chart._axes._axes=self._axisCache;self._chart.duration(0);self._chart._finalizePlotBounds();self._chart._facet._render()},0)};zoom._setScales=function(){if(this._fluidDimensions.indexOf("x")>=0){var x=this._chart.getTrainedScale("x");this._zoom.x(x._d3Scale)}if(this._fluidDimensions.indexOf("y")>=0){var y=this._chart.getTrainedScale("y");this._zoom.y(y._d3Scale)}};zoom._render=function(selection){this._zoomContainer=selection.selectAll(".zoom-container").data([0]);this._zoomContainer.enter().append("g").classed("zoom-container");var zoomPane=this._zoomContainer.selectAll(".zoom-pane").data([0]);zoomPane.enter().append("rect").classed("zoom-pane",true);var panel=this._chart.facet().getPanel(0),panelBounds=panel.bounds();zoomPane.attr("x",panelBounds.left).attr("y",panelBounds.top).attr("width",panelBounds.width).attr("height",panelBounds.height).call(this._zoom);this._bounds=panelBounds};zoom.scale=function(scaleFactor){if(!arguments.length)return this._zoom.scale();this._zoom.scale(scaleFactor);this._refresh(scaleFactor,this._zoom.translate());return this};zoom.scaleExtent=function(scaleExtent){if(!arguments.length)return this._zoom.scaleExtent();this._zoom.scaleExtent(scaleExtent);return this};zoom.translate=function(translateCoords){if(!arguments.length)return this._zoom.translate();this._zoom.translate(translateCoords);this._refresh(this._zoom.scale(),translateCoords);return this};zoom.zoomStart=function(val){if(!arguments.length)return this._zoomStart;this._zoomStart=val;return this};zoom.zoomMove=function(val){if(!arguments.length)return this._zoomMove;this._zoomMove=val;return this};zoom.zoomEnd=function(val){if(!arguments.length)return this._zoomEnd;this._zoomEnd=val;return this};zoom.chart=function(val){if(!arguments.length)return this._chart;this._chart=val;this.initializeZoom(this._chart);if(this._chart){this._setScales();this._chart.clipPlot(true)}return this};return zoom});dv.behavior.rollover=dv.behavior.extend(function(){function rollover(){this._selection=null;this._showTooltip=this._defaultShowTooltip;this._hideTooltip=this._defaultHideTooltip;this._orientation="right";this._tooltipPadding=10;this._content=this._defaultContent;this._lastSelectedTarget=null;this._timer=null;this._pressTimer=null;this._dragInspect=true;this._shouldShowTooltip=function(d,i,j){return true}}rollover._render=function(selection){this._xGuides=this.__geom._chart._axes._get("x");this._yGuides=this.__geom._chart._axes._get("y");this._isPolar=this.__geom.coord()instanceof dv.coord.polar;this._selection=selection;this._addEvents()};rollover._addEvents=function(){var self=this;this.__geom.on("mouseover.rollover",function(d,i,j){return self._onMouseOver.call(this,d,i,j,self)}).on("mouseout.rollover",function(d,i,j){return self._onMouseOut.call(this,d,i,j,self)});this.__geom._chart.on("tap.rollover",function(){return self._onTap.call(self,d3.event)},dv.passiveListenerOption).on("touchstart.rollover",function(){return self._onTouchStart.call(self,d3.event)},dv.passiveListenerOption).on("touchmove.rollover",function(){return self._onTouchMove.call(self,d3.event)},dv.passiveListenerOption).on("touchend.rollover",function(){return self._onTouchEnd.call(self,d3.event)})};rollover._removeEvents=function(){this.__geom.on("mouseover.rollover",null).on("mouseout.rollover",null);this.__geom._chart.on("tap.rollover",null).on("touchstart.rollover",null).on("touchmove.rollover",null).on("touchend.rollover",null)};rollover._getElementMetadata=function(geom,d3El){var metadata={d:d3El.datum(),i:0,j:0};geom._geomGroup.selectAll(".series ."+geom._dataPointStyleClass).each(function(d,i,j){if(metadata.d===d){metadata.i=i;metadata.j=j}});return metadata};rollover._defaultShowTooltip=function(d,i,j,event,self){if(self._shouldShowTooltip(d,i,j)){self._darkenGeom.call(this,d,self);self._showTip.call(this,d,i,j,self)}};rollover._defaultHideTooltip=function(d,i,j,event,self){self._brightenGeom.call(this,d,self);self._removeTip.call(this,d,i,j,self)};rollover._darkenGeom=function(d,self){var singleGeom=d3.select(this),fill,stroke,darken=function(attr,d,geom){if(d.hasOwnProperty(attr)){var color=self.__geom.getScale(attr).mapValue(d[attr]);geom.style(attr,d3.rgb(color).darker(1).toString())}};darken("fill",d,singleGeom);darken("stroke",d,singleGeom)};rollover._brightenGeom=function(d,self){var singleGeom=d3.select(this),fill,stroke,darken=function(attr,d,geom){if(d.hasOwnProperty(attr)){var color=self.__geom.getScale(attr).mapValue(d[attr]);geom.style(attr,color)}};darken("fill",d,singleGeom);darken("stroke",d,singleGeom)};rollover._showTip=function(d,i,j,self){var parent=self.__geom.chart()._chartContainer,bounds=this.getBBox(),pos=dv.absoluteCoordinates(self.__geom.chart(),[bounds.x,bounds.y],d.panel),boundingRect={height:bounds.height,width:bounds.width,x:pos[0],y:pos[1]};dv.showTooltip(boundingRect,parent.select(".plot").node().getBBox(),self.content().call(self,d,i,j),self._orientation,self._tooltipPadding,parent)};rollover._removeTip=function(d,i,j,self){dv.removeTooltip(self.__geom.chart()._chartContainer)};rollover._defaultContent=function(d,i,j){var seriesGroup=this.__geom.getExplicitScale("group"),obj=d[0]?d[0]:d,x=obj.panel.xScale(obj),y=obj.panel.yScale(obj),xGuide=this._xGuides[x.scaleIndex()],yGuide=this._yGuides[y.scaleIndex()],xTickFormat=xGuide.__scale&&xGuide.tickFormat()?xGuide.tickFormat():String,yTickFormat=yGuide.__scale&&yGuide.tickFormat()?yGuide.tickFormat():String,content='<span class="metric-value">'+yTickFormat(obj.data[y.mapping()])+'</span><span class="metric-name">'+y.mapping()+"</span>"+'<span class="metric-value">'+xTickFormat(obj.data[x.mapping()])+'</span><span class="metric-name">'+x.mapping()+"</span>";if(seriesGroup&&seriesGroup.mapping()){content='<span class="series-name">'+obj.data[seriesGroup.mapping()]+"</span>"+content}return content};rollover._onMouseOver=function(d,i,j,self){self._showTooltip.call(this,d,i,j,d3.event,self);if(this._mouseOver)this._mouseOver.call(this,d,i,j,d3.event)};rollover._onMouseOut=function(d,i,j,self){self._hideTooltip.call(this,d,i,j,d3.event,self);if(self._mouseOut)self._mouseOut.call(this,d,i,j,d3.event)};rollover._onContextMenu=function(d,i,j,self){d3.event.preventDefault();if(self._contextMenu)self._contextMenu.call(this,d,i,j,d3.event)};rollover._onTap=function(ev){this._dragInspect=true;this._onTouchMove.call(this,ev);this._onTouchEnd.call(this,ev)};rollover._onTouchStart=function(ev){var self=this;if(this._lastSelectedTarget){clearTimeout(self._timer);this._onTouchEnd.call(this,ev,0)}this._dragInspect=false;clearTimeout(this._pressTimer);this._pressTimer=setTimeout(function(){self._dragInspect=true;self._onTouchMove.call(self,ev)},500);return false};rollover._onTouchMove=function(ev){if(!this._dragInspect){clearTimeout(this._pressTimer);return}var rawEvent=ev.touches?ev.touches[0]:ev,target=d3.select(this._elementFromPoint(rawEvent)),sameNodeAsLastTime=this._lastSelectedTarget&&this._lastSelectedTarget.node()===target.node();if(!target.empty()&&target.classed(this.__geom._dataPointStyleClass)){if(this._lastSelectedTarget&&!sameNodeAsLastTime){var lastData=this._lastSelectedTarget.datum();this._brightenGeom.call(this._lastSelectedTarget.node(),lastData,this)}if(!sameNodeAsLastTime){var metadata=this._getElementMetadata(this.__geom,target);this._showTooltip.call(target.node(),metadata.d,metadata.i,metadata.j,ev,this);if(this._mouseOver){this._mouseOver.call(target.node(),metadata.d,metadata.i,metadata.j,ev)}this._lastSelectedTarget=target}}dv.cancelEvent(ev)};rollover._onTouchEnd=function(ev,delay){var self=this;clearTimeout(this._pressTimer);this._dragInspect=false;var rawEvent=ev.touches?ev.touches[0]:ev;if(arguments.length<2){delay=500}if(this._lastSelectedTarget){var hide=function(){if(!self._lastSelectedTarget)return;var metadata=self._getElementMetadata(self.__geom,self._lastSelectedTarget);self._hideTooltip.call(self._lastSelectedTarget.node(),metadata.d,metadata.i,metadata.j,ev,self);if(self._mouseOut){self._mouseOut.call(self._lastSelectedTarget.node(),metadata.d,metadata.i,metadata.j,ev)}self._lastSelectedTarget=null};if(delay){timer=setTimeout(hide,delay)}else{hide.call(this)}}dv.cancelEvent(ev)};rollover._elementFromPoint=function(ev){var point=[ev.clientX,ev.clientY];if(this._testAndroidChromeBug141840()){point=[ev.screenX,ev.screenY]}return document.elementFromPoint(point[0],point[1])};rollover.content=function(html){if(!arguments.length)return this._content;this._content=d3.functor(html);return this};rollover.tooltipPadding=function(val){if(!arguments.length)return this._tooltipPadding;this._tooltipPadding=val;return this};rollover.orientation=function(val){if(!arguments.length)return this._orientation;this._orientation=val;return this};rollover.mouseOver=function(val){if(!arguments.length)return this._mouseOver;this._mouseOver=val;return this};rollover.mouseOut=function(val){if(!arguments.length)return this._mouseOut;this._mouseOut=val;return this};rollover.contextMenu=function(val){if(!arguments.length)return this._contextMenu;this._contextMenu=val;return this};rollover.showTooltip=function(val){if(!arguments.length)return this._showTooltip;this._showTooltip=val;return this};rollover.hideTooltip=function(val){if(!arguments.length)return this._hideTooltip;this._hideTooltip=val;return this};rollover.shouldShowTooltip=function(callback){if(!arguments.length){return this._shouldShowTooltip}this._shouldShowTooltip=callback;return this};rollover._geom=function(val){if(!arguments.length)return this.__geom;if(this.__geom&&this.__geom!==val)this._removeEvents();this.__geom=val;return this};return rollover});dv.behavior.voronoiRollover=dv.behavior.rollover.extend(function(){function voronoi(){this._super();this._voronoiContainer=null;this._points=null;this._pointDetectionRadius=20;this._numHitAreaVertices=12;this._isPolar=false}voronoi._render=function(selection){this._xGuides=this.__geom._chart._axes._get("x");this._yGuides=this.__geom._chart._axes._get("y");this._isPolar=this.__geom.coord()instanceof dv.coord.polar;this._selection=selection;this._createTooltipContainer();this._renderPolygons(this._getPolygonData(),selection);this._addEvents()};voronoi._addEvents=function(){var self=this;this.__geom._chart.on("tap.rollover",function(){return self._onTap.call(self,d3.event)},dv.passiveListenerOption).on("touchstart.rollover",function(){return self._onTouchStart.call(self,d3.event)},dv.passiveListenerOption).on("touchmove.rollover",function(){return self._onTouchMove.call(self,d3.event)},dv.passiveListenerOption).on("touchend.rollover",function(){return self._onTouchEnd.call(self,d3.event)},dv.passiveListenerOption)};voronoi._removeEvents=function(){this.__geom._chart.on("tap.rollover",null,dv.passiveListenerOption).on("touchstart.rollover",null,dv.passiveListenerOption).on("touchmove.rollover",null,dv.passiveListenerOption).on("touchend.rollover",null,dv.passiveListenerOption)};voronoi._createTooltipContainer=function(){this._voronoiContainer=this._selection.selectAll(".voronoiSelection-container").data([this]);this._voronoiContainer.enter().append("g").classed("voronoiSelection-container",true)};voronoi._getPolygonData=function(){var vertices=[],data=this.__geom._nestData,self=this;this._points=[];var pathRenderer=self.__geom.coord()._point().x(function(d,i){return d.x}).y(function(d,i){return d.y}).defined(function(d,i){return true});dv.util.each(this.__geom._nestData,function(seriesArray,j){dv.util.each(seriesArray.values,function(d,i){var cd={},obj=d[0]?d[0]:d,x=obj.panel.xScale(obj),y=obj.panel.yScale(obj);cd.x=x.mapValueToPercent(x.mapToProp(obj,i)+x.rangeBand()/2,i)||0;cd.y=y.mapValueToPercent(y.mapValue(obj.hasOwnProperty("y0")?obj.y+obj.y0:obj.y),i)||0;cd.panel=obj.panel;var data=pathRenderer.getBounds(cd,i);if(self._isPolar){var xyPoint=self.__geom.coord()._transformAngleRadiusToXY(data.bounds.x,data.bounds.y);range.bounds.x=xyPoint[0];range.bounds.y=xyPoint[1]}self._points.push({data:data,rawData:obj,seriesIndex:j,index:i});vertices.push([data.bounds.x+(Math.random()-.5),data.bounds.y+(Math.random()-.5)])})});return d3.geom.voronoi(vertices)};voronoi._renderPolygons=function(polygonData,selection){var self=this,numSeries=this.__geom._nestData.length,numItemsPerSeries=this.__geom._nestData[0].values.length,geomParent=d3.select(selection.node().parentNode),x=0,y=0,pointInfo;if(this._isPolar){var firstPanel=this.__geom._nestData[0].values[0].panel,xRange=dv.util.scaleRangeNoReverse(firstPanel.xOuterScale()),yRange=dv.util.scaleRangeNoReverse(firstPanel.yOuterScale());x=(xRange[0]+xRange[1])/2;y=(yRange[0]+yRange[1])/2}this._voronoiContainer.attr("transform","translate("+x+","+y+")");var paths=this._voronoiContainer.selectAll("path").data(polygonData);paths.exit().remove();paths.enter().append("path").attr("id",function(d,i){return"path-"+i}).classed("voronoi-overlay",true);paths.attr("d",function(d,i){return self._getPolygonPath(d,i,self)}).on("mouseover.rollover",function(d,i,j){return self._onMouseOver.call(this,d.data,i,j,self)}).on("mouseout.rollover",function(d,i,j){return self._onMouseOut.call(this,d.data,i,j,self)}).on("contextmenu",function(d,i,j){return self._onContextMenu.call(this,d.data,i,j,self)}).call(this._removeRegisteredEvents,this).call(this._addRegisteredEvents,this);paths.exit().on("mouseover.rollover",null).on("mouseout.rollover",null).on("contextmenu",null).remove()};voronoi._addRegisteredEvents=function(paths,self){if(!self)self=this;if(!self.__geom)return;paths=paths||self._voronoiContainer.selectAll(".voronoi-overlay");dv.util.each(self.__geom.eventMap,function(e,type){paths.on(type,function(d,i){self.__geom.eventMap[type].callback.call(this,d,i,d3.event)},e.capture)});dv.util.each(self.__geom._chart.eventMap,function(e,type){paths.on(type+".dvchart",function(d,i){var e=d3.event,interactionGroup=self.__geom._chart._interactionGroup.node();if(self._shouldDispatchChartEvent(e,interactionGroup)){self.__geom._chart.eventMap[type].callback.call(interactionGroup,e)}},e.capture)})};voronoi._removeRegisteredEvents=function(paths,self){if(!self)self=this;if(!self.__geom)return;paths=paths||self._voronoiContainer.selectAll(".voronoi-overlay");dv.util.each(self.unregisterEventMap,function(capture,type){paths.on(type,null,capture)});dv.util.each(self.__geom._chart.unregisterEventMap,function(capture,type){paths.on(type+".dvchart",null,capture)})};voronoi._shouldDispatchChartEvent=function(e,interactionGroup){var result=true;if(e.type==="mouseout"||e.type==="mouseover"){var rTarg=e.relatedTarget;if(!rTarg)rTarg=e.type==="mouseout"?e.toElement:e.fromElement;var relTarget=d3.select(rTarg);if(relTarget&&!relTarget.empty()){var className=relTarget.attr("class");result=!(relTarget.node()===interactionGroup||relTarget.classed("voronoi-overlay"))}}return result};voronoi._getPolygonPath=function(d,i,self){if(!d)return null;d.data=self._points[i];var temp=dv.util.clone(d),pointInfo=self._points[i],polygon=d3.geom.polygon(self._getPolygonPoints(pointInfo.data.bounds.x,pointInfo.data.bounds.y)),vertices=polygon.clip(d);return vertices.length?"M"+vertices.join("L")+"Z":null};voronoi._getPolygonPoints=function(centerX,centerY){var points=[];for(var i=360;i>0;i-=360/this._numHitAreaVertices){var radians=i*Math.PI/180,x=Math.cos(radians)*this._pointDetectionRadius+centerX,y=Math.sin(radians)*this._pointDetectionRadius+centerY;points.push([x,y])}return points};voronoi._defaultShowTooltip=function(d,i,j,event,self){self._showPoint.call(this,d,i,j,self);if(self._shouldShowTooltip(d,i,j)){self._showTip.call(this,d,i,j,self)}};voronoi._defaultHideTooltip=function(d,i,j,event,self){self._removePoint.call(this,d,i,j,self);self._removeTip.call(this,d,i,j,self)};voronoi._showPoint=function(d,i,j,self){var radius=10,pointData=d.rawData,elem=self.getGeomFromVoronoiIndex.call(self,pointData,i,j);if(!elem.empty()){var bounds=elem.node().getBoundingClientRect(),boundingRect={height:bounds.height,width:bounds.width,x:bounds.x,y:bounds.y};radius=Math.max(boundingRect.height,boundingRect.width)/2+2.5}self._voronoiContainer.append("circle").classed("hover-point",true).attr("id","point-"+j+"-"+i).attr("cx",d.data.bounds.x).attr("cy",d.data.bounds.y).attr("r",0).style("stroke",function(){return self.__geom.getHighlightColor(d.rawData,i)}).style("pointer-events","none").transition().duration(350).attr("r",radius)};voronoi._removePoint=function(d,i,j,self){self._voronoiContainer.selectAll("#point-"+j+"-"+i).transition().duration(350).attr("r",0).remove()};voronoi._showTip=function(d,i,j,self){var parent=self.__geom.chart()._chartContainer,boundingRect,voronoiData=d.data,pointData=d.rawData;var elem=self.getGeomFromVoronoiIndex.call(self,pointData,i,j);if(elem.empty()){var position=dv.absoluteCoordinates(self.__geom.chart(),[voronoiData.bounds.x,voronoiData.bounds.y],pointData.panel),height=10,width=10;boundingRect={height:height,width:width,y:position[1]-height/2,x:position[0]-width/2}}else{var bounds=elem.node().getBBox();boundingRect={height:bounds.height,width:bounds.width,x:bounds.x,y:bounds.y}}dv.showTooltip(boundingRect,parent.select(".panels").node().getBBox(),self.content().call(self,pointData,i,j),self._orientation,self._tooltipPadding,parent)};voronoi.getGeomFromVoronoiIndex=function(d,i,j){return this.__geom.chart()._g.selectAll(".datum-"+i+".series-"+j).filter(function(eData){return d===eData})};voronoi._onMouseOver=function(d,i,j,self){self._showTooltip.call(this,d,d.index,d.seriesIndex,d3.event,self);if(self._mouseOver){self._mouseOver.call(this,d.rawData,d.index,d.seriesIndex,d3.event)}};voronoi._onMouseOut=function(d,i,j,self){self._hideTooltip.call(this,d,d.index,d.seriesIndex,d3.event,self);if(self._mouseOut)self._mouseOut.call(this,d.rawData,d.index,d.seriesIndex,d3.event)};voronoi._onContextMenu=function(d,i,j,self){d3.event.preventDefault();if(self._contextMenu)self._contextMenu.call(this,d.rawData,d.index,d.seriesIndex,d3.event)};voronoi._onTouchMove=function(ev){if(!this._dragInspect){clearTimeout(this._pressTimer);return}var rawEvent=ev.touches?ev.touches[0]:ev,target=d3.select(this._elementFromPoint(rawEvent)),sameNodeAsLastTime=this._lastSelectedTarget&&this._lastSelectedTarget.node()===target.node();if(!target.empty()&&target.classed("voronoi-overlay")){if(this._lastSelectedTarget&&!sameNodeAsLastTime){var lastData=this._lastSelectedTarget.datum().data;this._removePoint.call(target.node(),lastData.rawData,lastData.index,lastData.seriesIndex,this)}if(!sameNodeAsLastTime){var d=target.datum().data;this._showTooltip.call(target.node(),d,d.index,d.seriesIndex,ev,this);if(this._mouseOver){this._mouseOver.call(target.node(),d.rawData,d.index,d.seriesIndex,ev)}this._lastSelectedTarget=target}}dv.cancelEvent(ev)};voronoi._onTouchEnd=function(ev,delay){var self=this;clearTimeout(this._pressTimer);if(this._dragInspect){this._dragInspect=false}if(arguments.length<2){delay=500}if(this._lastSelectedTarget){var hide=function(){if(!self._lastSelectedTarget)return;var d=self._lastSelectedTarget.datum().data;self._hideTooltip.call(self._lastSelectedTarget.node(),d,d.index,d.seriesIndex,ev,self);if(self._mouseOut){self._mouseOut.call(self._lastSelectedTarget.node(),d.rawData,d.index,d.seriesIndex,ev)}self._lastSelectedTarget=null};if(delay){timer=setTimeout(hide,delay)}else{hide.call(this)}}dv.cancelEvent(ev)};voronoi.pointDetectionRadius=function(val){if(!arguments.length)return this._pointDetectionRadius;this._pointDetectionRadius=val;return this};voronoi.numHitAreaVertices=function(val){if(!arguments.length)return this._numHitAreaVertices;this._numHitAreaVertices=val;return this};return voronoi});dv.behavior.selection=dv.behavior.extend(function(){function selection(){this._super();this._selectionCache=new dv.util.SelectionCache;this._dispatch=d3.dispatch("selectionChanged");this._elementFinder=null;var _self=this;this._selectionCache.on("selectionChanged",function(sourceElement,all,added,removed){_self._dispatch.selectionChanged.call(sourceElement,all,added,removed)});this.on=function(event,handler){_self._dispatch.on(event,handler);return _self}}selection.elementFinder=function(operation){if(!operation)return this._elementFinder;this._elementFinder=operation;return this};selection._geom=function(val){if(!arguments.length)return this.__geom;if(this.__geom&&this.__geom!==val)this._removeEvents();this.__geom=val;this._selectionCache.selectionScope(this.__geom.chart()._g);return this};selection.chart=function(val){this._selectionCache.selectionScope(val._g);return this};selection._render=function(layer){this._selectionCache.markSelectable(this.__geom._geomGroup.selectAll("path"));this._addEvents();return this};selection._addEvents=function(){this.__geom.on("mousedown.selection",this.makeSelectHandler(null,this._elementFinder))};selection._removeEvents=function(){this.__geom.on("mousedown.selection",null)};selection.makeSelectHandler=function(rangeQuery,elementFinder){var _self=this;return function(d,i){var selectionCache=_self._selectionCache;var elementSelected=elementFinder?elementFinder.call(this,d,i):this;var chord=dv.util.determineKeyModifiers(d3.event,selectionCache._keymap);if(chord==dv.util.selectModifiers.toggle){selectionCache.selectionToggle(d3.select(elementSelected));d3.event.stopPropagation();return}if(chord==dv.util.selectModifiers.set){selectionCache.selectionSet(d3.select(elementSelected));d3.event.stopPropagation();return}if(chord&dv.util.selectModifiers.range){var nodesInRange=[];var allSimilar=selectionCache.selectionScope().selectAll("."+selectionCache.selectableClass);selectionCache.savePreviousState(allSimilar);if(rangeQuery){nodesInRange=rangeQuery(selectionCache._lastSelected?selectionCache._lastSelected:this,this)}else{var startPoint=selectionCache._lastSelected?selectionCache._lastSelected:elementSelected;var endPoint=elementSelected;var startRect=startPoint.getBoundingClientRect();var endRect=endPoint.getBoundingClientRect();var r=new dv.collisions.rectFromMinMax(startRect.left+startRect.width*.5,startRect.top+startRect.height*.5,endRect.left+endRect.width*.5,endRect.top+endRect.height*.5);allSimilar.each(function(d,i){var myRect=this.getBoundingClientRect();var boundsRect=new dv.collisions.rectFromMinMax(myRect.left,myRect.top,myRect.right,myRect.bottom);if(r.testRect(boundsRect)){nodesInRange.push(this)}});nodesInRange.push(elementSelected)}selectionCache.brush(d3.selectAll(nodesInRange));d3.event.stopPropagation();return}}};return selection});dv.behavior.identified=dv.behavior.extend(function(prefix){var identity=0;function identified(prefix){var _id=++identity;this._super();this.idPrefix=prefix||"geom";this.idPrefix=this.idPrefix+_id}identified._geom=function(val){if(!arguments.length)return this.__geom;this.__geom=val;return this};identified.chart=function(val){if(!arguments.length)return this.__chart;this.__chart=val;return this};identified._render=function(selection){var self=this;this.__geom._geomGroup.selectAll("path").attr("id",function(d,i,j){return self.identify(d,i,j)});return this};identified.identify=function(d,i,j){return this.idPrefix+"-"+i+"-"+j};return identified});dv.log=dv.log||{};dv.log.NOCONSOLE=false;dv.log.LVL_ERROR=0;dv.log.ERROR="error";dv.log.LVL_WARN=1;dv.log.WARN="warn";dv.log.LVL_DEBUG=2;dv.log.DEBUG="debug";dv.log.LOGLEVEL=dv.log.LVL_DEBUG;dv.log.error=function(error){return dv.log._message(dv.log.ERROR,error)};dv.log.warn=function(error){return dv.log._message(dv.log.WARN,error)};dv.log.debug=function(error){return dv.log._message(dv.log.DEBUG,error)};dv.log.noConsole=function(val){dv.log.NOCONSOLE=val||false;dv.log.console=window.console||dv.util.noop;if(!dv.log.console.log||dv.log.NOCONSOLE)dv.log.console.log=dv.util.noop;if(!dv.log.console.error||dv.log.NOCONSOLE)dv.log.console.error=dv.log.console.log;if(!dv.log.console.warn||dv.log.NOCONSOLE)dv.log.console.warn=dv.log.console.log;if(!dv.log.console.debug||dv.log.NOCONSOLE)dv.log.console.debug=dv.log.console.log};dv.log._message=function(type,error){if(dv.log._isValidType(type)){if(dv.log.LOGLEVEL>=dv.log["LVL_"+type.toUpperCase()])dv.log.console[type](error.msg,error.data);if(type===dv.log.ERROR)throw error.msg+" Context Data: "+JSON.stringify(error.data)}else{dv.log.console.log("Logging message with invalid type: "+type)}};dv.log._isValidType=function(type){return type===dv.log.ERROR||type===dv.log.WARN||type===dv.log.DEBUG};dv.log.noConsole(false);dv.panel=dv.extend(function(){function panel(){this._margins={left:0,top:0,right:0,bottom:0};this._trainedScales={}}panel.getTrainedScale=function(prop){if(prop==="x")return this.xScale();if(prop==="y")return this.yScale();return this._trainedScales[prop]};panel.getOuterScale=function(prop){if(prop==="x")return this._xScale;if(prop==="y")return this._yScale;return null};panel._updateRanges=function(bounds){var xRange=[bounds.left,bounds.right],yRange=[bounds.bottom,bounds.top];if(this._facet._chart.coord().flip()){this._xScale.range(yRange);this._yScale.range(xRange)}else{this._xScale.range(xRange);this._yScale.range(yRange)}};panel.bounds=function(val){if(!arguments.length)return this._bounds;this._bounds=val;this._updateRanges(this._bounds);return this};panel.margins=function(val){if(!arguments.length)return this._margins;this._margins=val;return this};panel.visibleAxisLabelOrientations=function(val){if(!arguments.length)return this._visibleAxisLabelOrientations;this._visibleAxisLabelOrientations=val;return this};panel.columnIndex=function(val){if(!arguments.length)return this._columnIndex;this._columnIndex=val;return this};panel.rowIndex=function(val){if(!arguments.length)return this._rowIndex;this._rowIndex=val;return this};panel.facetIndex=function(val){if(!arguments.length)return this._facetIndex;this._facetIndex=val;return this};panel.facetKey=function(val){if(!arguments.length)return this._facetKey;this._facetKey=val;return this};panel.xFacetTitle=function(val){if(!arguments.length)return this._xFacetTitle;this._xFacetTitle=val;return this};panel.yFacetTitle=function(val){if(!arguments.length)return this._yFacetTitle;this._yFacetTitle=val;return this};panel.xOuterScale=function(val){if(!arguments.length)return this._xScale;this._xScale=val;return this};panel.yOuterScale=function(val){if(!arguments.length)return this._yScale;this._yScale=val;return this};panel.xScale=function(d){var scaleIndex=0;if(d&&d.hasOwnProperty("x-index"))scaleIndex=d["x-index"];return this._xScale.innerScaleGroup()[scaleIndex]};panel.yScale=function(d){var scaleIndex=0;if(d&&d.hasOwnProperty("y-index"))scaleIndex=d["y-index"];return this._yScale.innerScaleGroup()[scaleIndex]};panel.facet=function(val){if(!arguments.length)return this._facet;this._facet=val;this._trainedScales={};return this};return panel});dv.facet=dv.extend(function(){function facet(){this._numColumns=0;this._numRows=0;this._hGap=10;this._vGap=10}facet._prerender=function(){var self=this;this._trainedScales={};this._panels=[];this._rows=[];this._columns=[];this._panelsWithAxisLabels=[];dv.util.each(self._chart._layers,function(geom){geom._prerender(self._chart);self._trainFacetGroups(geom)});this._configureFacets();dv.util.each(self._chart._layers,function(geom){geom._nestData=self._nestFacet(geom);geom._handlePositions();geom._trainScales();geom._createDefaultScales()});this._trainScales()};facet._trainScales=function(){var self=this,trainedScale,scale,host,filter,facetFreeFilter=function(panel){return function(facetKey){return self._getFacetFromFacetKey(facetKey)!==panel.facetKey()}},fixedAccessor=function(geom){return function(property,scaleIndex,value){if(arguments.length<2)scaleIndex=0;if(arguments.length<3)return this._globalScales[property]===undefined?null:this._globalScales[property][scaleIndex];if(!this._globalScales[property])this._globalScales[property]={};this._globalScales[property][scaleIndex]=value;return value}};this._globalScales={};this._positionScales={};dv.util.each(this._panels,function(panel,i){dv.util.each(self._chart._layers,function(geom){for(var property in geom._aes){var aesGroup=geom._aes[property];for(var scaleIndex in aesGroup){var geomScale=geom.getScale(property,scaleIndex);if(!(geomScale instanceof dv.scale.constant)){if(self._isFree.call(self,property)){trainedScale=self._trainFreeScale(geom,panel,property,scaleIndex,facetFreeFilter(panel))}else{trainedScale=self._trainScale(geom,fixedAccessor(geom),property,scaleIndex)}if(!panel._trainedScales[property])panel._trainedScales[property]={};panel._trainedScales[property][scaleIndex]=trainedScale;aesGroup[scaleIndex].domain(trainedScale.domain());aesGroup[scaleIndex].range(trainedScale.range())}}}})});dv.util.each(this._globalScales,function(scaleGroup,prop){dv.util.each(scaleGroup,function(scale,scaleIndex){scale.validateDomain();if(scale.reverse()){scale.domain(scale.domain().reverse())}})})};facet._isFree=function(property){var xProp=property==="x"||property==="xMin"||property==="xMax",yProp=property==="y"||property==="yMin"||property==="yMax";return xProp&&(this._scales==="free"||this._scales==="free_x")||yProp&&(this._scales==="free"||this._scales==="free_y")};facet._trainScale=function(geom,trainedScalesAccessor,property,scaleIndex,filter){var trainedScale=trainedScalesAccessor.call(this,property,scaleIndex),options={stack:geom.position()==="stack"&&property==="y",fill:geom.position()==="fill"&&property==="y",filter:filter},scale;if(trainedScale){scale=geom._aes[property][scaleIndex];scale.domain(scale.calculateDomain(geom._nestData,options));if(geom.allowRecalculateScale()){trainedScale.unionDomain(scale,trainedScale.reverse());trainedScale.unionRange(scale.range())}}else{geom._aes[property][scaleIndex].trainDomain(geom._nestData,options);trainedScale=geom._aes[property][scaleIndex].copy();trainedScalesAccessor.call(this,property,scaleIndex,trainedScale)}return trainedScale};facet._render=function(){this._axes=this._chart._axes;var grid=this._ensureColumnsAndRows();this._adjustPlotBounds(grid[0],grid[1]);this._configurePanels(grid[0],grid[1]);this._axes._initializeAxisRenderers();this._axes._measureTitles(this._chart._plotBounds);var maxMargins=this._measureMargins(grid[0],grid[1]);this._layoutPanels(grid[0],grid[1],maxMargins);this._renderAxisTitles();this._renderPanels()};facet._setVisibleAxisLabelOrientations=function(panel,lastRowIndex,lastColIndex,numPanels){var rowIndex=panel.rowIndex(),colIndex=panel.columnIndex(),labelOrientations={left:colIndex===0,top:rowIndex===0,right:colIndex===lastColIndex||panel.facetIndex()===numPanels-1,bottom:rowIndex===lastRowIndex||colIndex>lastColIndex&&rowIndex===lastRowIndex-1};panel.visibleAxisLabelOrientations(labelOrientations)};facet._changeScaleRangeToLocal=function(outerScale){var outerScaleRange=outerScale.range(),innerScaleGroup=outerScale.innerScaleGroup();for(var scaleIndex in innerScaleGroup){dv.util.scaleRange(innerScaleGroup[scaleIndex],[outerScaleRange[0],outerScaleRange[1]]).applyRangePadding()}return innerScaleGroup};facet._measureMargins=function(cols,rows){var numPanels=this._panels.length,lastRowIndex=~~((numPanels-1)/cols),lastColIndex=(numPanels-1)%cols,axisOrientations=this._axes._getAllOrientations(),maxMargins={rows:[],cols:[]},xIsFree=this._isFree("x"),yIsFree=this._isFree("y"),self=this,firstPanel=this._panels[0];if(firstPanel){this._changeScaleRangeToLocal(firstPanel.getOuterScale("x"));this._changeScaleRangeToLocal(firstPanel.getOuterScale("y"))}var i=-1;while(++i<numPanels){var panel=this._panels[i],colIndex=panel.columnIndex(),rowIndex=panel.rowIndex();this._setVisibleAxisLabelOrientations(panel,lastRowIndex,lastColIndex,numPanels);panel.margins({left:0,top:0,right:0,bottom:0});if(rowIndex>=maxMargins.rows.length)maxMargins.rows[rowIndex]={left:0,top:0,right:0,bottom:0};if(colIndex>=maxMargins.cols.length)maxMargins.cols[colIndex]={left:0,top:0,right:0,bottom:0};this._panelsWithAxisLabels.push(panel);this._axes._measure(panel);var panelMargins=panel.margins();if(axisOrientations["right"]!==undefined&&!yIsFree&&(i===numPanels-1&&colIndex<cols-1))panelMargins.right=0;if(axisOrientations["bottom"]!==undefined&&!xIsFree&&(colIndex>=lastColIndex&&rowIndex===lastRowIndex-1))panelMargins.bottom=0;for(var dim in maxMargins){var index=dim==="rows"?rowIndex:colIndex;var margins=maxMargins[dim][index];margins.left=Math.max(panelMargins.left,margins.left);margins.top=Math.max(panelMargins.top,margins.top);margins.right=Math.max(panelMargins.right,margins.right);margins.bottom=Math.max(panelMargins.bottom,margins.bottom)}}return maxMargins};facet._layoutPanels=function(cols,rows,maxMargins){var plotBounds=this._chart._plotBounds,availableWidth=plotBounds.right-plotBounds.left-(cols-1)*this._hGap,availableHeight=plotBounds.bottom-plotBounds.top-(rows-1)*this._vGap,facetWidth,facetHeight,cursor={x:0,y:0},self=this,i,n;i=-1;n=maxMargins.cols.length;while(++i<n){availableWidth-=maxMargins.cols[i].left+maxMargins.cols[i].right}i=-1;n=maxMargins.rows.length;while(++i<n){availableHeight-=maxMargins.rows[i].bottom+maxMargins.rows[i].top}facetWidth=Math.max(availableWidth/cols,0);facetHeight=Math.max(availableHeight/rows,0);var axesLabelContainer=this._chart._chartContainer.select(".axes-labels");var axesPanels=axesLabelContainer.selectAll(".panel-labels").data(this._panelsWithAxisLabels);axesPanels.enter().append("div");axesPanels.exit().remove();axesPanels.attr("class",function(d,i){return"panel-labels panel-"+d.facetIndex()});var panels=this._chart._panelContainer.selectAll(".panel").data(this._panels);panels.enter().append("g").classed("panel",true);panels.exit().remove();panels.each(function(d,i){self._drawPanel.call(this,self,d,i,plotBounds,maxMargins,facetWidth,facetHeight,cols,rows,cursor);self._axes._render.call(self._axes,d3.select(this),axesLabelContainer.select(".panel-labels.panel-"+d.facetIndex()),d)})};facet._renderAxisTitles=function(){var firstColBounds=this.getColumn(0)[0].bounds(),firstRowBounds=this.getRow(0)[0].bounds(),lastColBounds=this.getColumn(this._columns.length-1)[0].bounds(),lastRowBounds=this.getRow(this._rows.length-1)[0].bounds(),centerColumns=(lastRowBounds.bottom-firstRowBounds.top)/2+firstRowBounds.top,centerRows=(lastColBounds.right-firstColBounds.left)/2+firstColBounds.left,plotBounds=this._chart.plotBounds();this._axes._renderTitles(plotBounds,{left:[plotBounds.left,centerColumns],right:[plotBounds.right,centerColumns],top:[centerRows,plotBounds.top],bottom:[centerRows,plotBounds.bottom]})};facet._renderPanels=function(){var chart=this._chart,bounds=chart._plotBounds,plotG=chart._g.select(".plot"),plotBounds=chart._plotBounds;var draw=function(selection){selection.attr("transform","translate(0,0)").each(function(geom){if(this.__previousData__&&this.__previousData__._dataPointStyleClass!=geom._dataPointStyleClass){this.__previousData__.exit(this)}geom._render(this);this.__previousData__=geom})};var exit=function(selection){selection.each(function(geom){geom.exit(this,function(){selection.remove()})})};var sel=plotG.selectAll(".geom").data(chart._layers);sel.exit().call(exit);sel.enter().append("g").classed("geom",true);sel.call(draw)};facet._updatePanelTitle=function(self,label,orientation,left,top,width,height){var titleBounds={left:0,top:0,width:0,height:0},el=d3.select(this);if(dv.util.isUndefined(label)){self._removePanelTitle.call(this,orientation);return titleBounds}var title=el.selectAll(".panel-title."+orientation).data([0]);var panelTitleEnter=title.enter().append("g").classed("panel-title "+orientation,true).attr("transform","translate("+left+","+top+")");var titleBgEnter=panelTitleEnter.append("rect").classed("panel-title-bg",true);var titleLabelEnter=panelTitleEnter.append("text").classed("panel-title-label",true).attr("text-anchor","middle");if(dv.ANIMATION){title.transition().duration(self._chart._duration).attr("transform","translate("+left+","+top+")")}else{title.attr("transform","translate("+left+","+top+")")}var titleLabel=title.selectAll(".panel-title-label").text(label);var titleBg=title.selectAll(".panel-title-bg");var titleBBox=titleLabel.node().getBBox(),rotation=0;if(dv.ANIMATION){titleLabel=titleLabel.transition().duration(self._chart._duration);titleBg=titleBg.transition().duration(self._chart._duration)}switch(orientation){case"top":x=width/2;y=titleBBox.height;titleBounds.left=0;titleBounds.top=0;titleBounds.width=width;titleBounds.height=titleBBox.height+6;break;case"right":x=height/2;y=-width+titleBBox.height;titleBounds.left=width-(titleBBox.height+6);titleBounds.top=0;titleBounds.width=titleBBox.height+6;titleBounds.height=height;rotation=90;break;case"bottom":x=width/2;y=height-6;titleBounds.left=0;titleBounds.top=height-(titleBBox.height+6);titleBounds.width=width;titleBounds.height=titleBBox.height+6;break;case"left":x=-height/2;y=0+titleBBox.height;titleBounds.left=0;titleBounds.top=0;titleBounds.width=titleBBox.height+6;titleBounds.height=height;rotation=270;break}titleBgEnter.attr("x",titleBounds.left).attr("y",titleBounds.top).attr("width",titleBounds.width).attr("height",titleBounds.height);titleLabelEnter.attr("transform","rotate("+rotation+" 0,0)").attr("x",x).attr("y",y);titleLabel.attr("transform","rotate("+rotation+" 0,0)").attr("x",x).attr("y",y);titleBg.attr("x",titleBounds.left).attr("y",titleBounds.top).attr("width",titleBounds.width).attr("height",titleBounds.height);return titleBounds};facet._removePanelTitle=function(orientation){d3.select(this).selectAll(".panel-title."+orientation).remove()};facet._updatePanelBackground=function(facet,left,top,width,height){var bg=d3.select(this).selectAll(".plot-bg").data([0]);bg.enter().append("rect").classed("plot-bg",true).attr("x",left).attr("y",top).attr("width",width).attr("height",height);if(dv.ANIMATION){bg=bg.transition().duration(facet._chart._duration)}bg.attr("x",left).attr("width",width).attr("height",height)};facet._addToCollection=function(arr,index,panel){if(!arr[index]){arr[index]=[]}arr[index].push(panel)};facet.getPanel=function(panelIndex){return this._panels&&panelIndex<this._panels.length?this._panels[panelIndex]:null};facet.getRow=function(rowIndex){return this._rows[rowIndex]};facet.getColumn=function(colIndex){return this._columns[colIndex]};facet.getTrainedScale=function(prop){if(this._panels.length>0){return this.getPanel(0).getTrainedScale(prop)}return this._trainedScales[prop]};facet.scales=function(val){if(!arguments.length)return this._scales;this._scales=val;return this};facet.space=function(val){if(!arguments.length)return this._space;this._space=val;return this};facet.titleFormat=function(val){if(!arguments.length)return this._titleFormat;this._titleFormat=d3.functor(val);return this};facet.hGap=function(val){if(!arguments.length)return this._hGap;this._hGap=val;return this};facet.vGap=function(val){if(!arguments.length)return this._vGap;this._vGap=val;return this};facet.chart=function(val){if(!arguments.length)return this._chart;this._chart=val;return this};return facet});dv.facet.scale=dv.extend(function(){function scale(){}scale.domain=function(){return this._innerScale.domain()};scale.range=function(val){if(!arguments.length)return this._range;this._range=val;return this};scale._applyPercentage=function(scaleFunc,args){return this._range[0]+(this._range[1]-this._range[0])*scaleFunc.apply(this._innerScale,args)};scale.mapPropToPercent=function(val,i){return this._innerScale.mapPropToPercent(val)};scale.mapValueToPercent=function(val,i){return this._innerScale.mapValueToPercent(val)};scale.mapToProp=function(val,i){return this._applyPercentage(this._innerScale.mapPropToPercent,[val,i])};scale.mapValue=function(val,i){return this._applyPercentage(this._innerScale.mapValueToPercent,[val,i])};scale.rangeBand=function(){return this._applyPercentage(this._innerScale.rangeBand)};scale.innerScaleGroup=function(val){if(!arguments.length)return this._innerScaleGroup;this._innerScaleGroup=val;return this};return scale});dv.facet.wrap=dv.facet.extend(function(){function wrap(){this._super();this._facetScale=null;this._preferredAspectRatio=1;this._titleOrientation="top"}wrap._prerender=function(){this._facetScale=dv.scale.ordinal().mapping(this._group).domain([]);this._super()};wrap._trainFacetGroups=function(geom){var geomFacetTuple=geom.data()[this._facetScale.mapping()];if(geomFacetTuple){this._facetScale.domain(this._facetScale.domain().concat(geomFacetTuple))}};wrap._trainFreeScale=function(geom,panel,property,scaleIndex,filterFunc){var trainedScalesAccessor=function(property,scaleIndex,value){if(arguments.length<2)scaleIndex=0;if(arguments.length<3){if(!panel._trainedScales[property])return undefined;return panel._trainedScales[property][scaleIndex]}if(!panel._trainedScales[property])panel._trainedScales[property]={};panel._trainedScales[property][scaleIndex]=value;return value};return this._trainScale(geom,trainedScalesAccessor,property,scaleIndex,filterFunc)};wrap._showAllPanelLabelsIfFree=function(){return true};wrap._configureFacets=function(){this._facetKeys=this._facetScale.domain();this._facetMap={}};wrap._nestFacet=function(geom){var self=this,normalizedData=geom.normalizedData(),zipData=dv.util.filterAndZip(normalizedData),group=geom.getScale("group"),facetMapping=this._group,facetKeys=this._facetScale.domain(),groupProperty,groupKeys;if(group){groupProperty=group.property();groupKeys=groupProperty?normalizedData[groupProperty]:null}var i=-1,n=zipData.length;while(++i<n){var facetIndex=0,facetTitle,data=zipData[i];if(data.data.hasOwnProperty(facetMapping)){facetIndex=facetKeys.indexOf(data.data[facetMapping]);if(facetIndex>=0){facetTitle=facetKeys[facetIndex]+""}}var panel=this._facetMap[facetIndex];if(!panel){panel=dv.panel().facetIndex(facetIndex).facetKey(facetTitle).xFacetTitle(facetTitle).facet(this);this._facetMap[facetIndex]=panel;this._panels.push(panel)}data.panel=panel}return d3.nest().key(function(d){var id="";id+=(d.data.hasOwnProperty(facetMapping)?d.data[facetMapping]:".")+" ~ ";id+=d.hasOwnProperty(groupProperty)?d[groupProperty]:".";return id}).sortKeys(function(a,b){var groupA=self._getGroupFromFacetKey(a),groupB=self._getGroupFromFacetKey(b),aIndex=-1,bIndex=-1;if(groupA!=="."){aIndex=groupKeys.indexOf(groupA);if(aIndex<0)aIndex=groupKeys.indexOf(Number(groupA))}if(groupB!=="."){bIndex=groupKeys.indexOf(groupB);if(bIndex<0)bIndex=groupKeys.indexOf(Number(groupB))}return bIndex<aIndex?1:-1}).entries(zipData)};wrap._getGroupFromFacetKey=function(facetKey){return/.* ~ (.*)/g.exec(facetKey)[1]};wrap._getFacetFromFacetKey=function(facetKey){return/(.*) ~ .*/g.exec(facetKey)[1]};wrap._ensureColumnsAndRows=function(){var facets=this._panels.length,cols=Math.min(this._numColumns,facets),rows=Math.min(this._numRows,facets);if(cols<1&&rows<1){var plotBounds=this._chart._plotBounds,plotWidth=plotBounds.right-plotBounds.left,plotHeight=plotBounds.bottom-plotBounds.top,columns=Math.min(facets,Math.ceil(Math.sqrt(facets*1*plotWidth/(plotHeight*this._preferredAspectRatio))));columns=isNaN(columns)?1:columns;columns=Math.max(1,columns);return[columns,Math.ceil(facets/columns)]}if(cols<1&&rows>=1){cols=Math.ceil(facets/rows)}if(cols>=1&&rows<1){rows=Math.ceil(facets/cols)}return[cols,rows]};wrap._adjustPlotBounds=function(cols,rows){return};wrap._configurePanels=function(cols,rows){var plotBounds=this._chart._plotBounds,plotWidth=plotBounds.right-plotBounds.left,plotHeight=plotBounds.bottom-plotBounds.top,facetWidth=(plotWidth-(cols-1)*this._hGap)/cols,facetHeight=(plotHeight-(rows-1)*this._vGap)/rows;var i=-1,n=this._panels.length;while(++i<n){var panel=this._panels[i],xFacetScale=dv.facet.scale().innerScaleGroup(panel._trainedScales.x),yFacetScale=dv.facet.scale().innerScaleGroup(panel._trainedScales.y),columnIndex=i%cols,rowIndex=~~(i/cols),panelBounds={left:0,top:0,right:facetWidth,bottom:facetHeight,width:facetWidth,height:facetHeight};this._panels[i].xOuterScale(xFacetScale).yOuterScale(yFacetScale).columnIndex(columnIndex).rowIndex(rowIndex).bounds(panelBounds);this._addToCollection(this._rows,rowIndex,panel);this._addToCollection(this._columns,columnIndex,panel)}};wrap._drawPanel=function(self,d,i,plotBounds,maxMargins,facetWidth,facetHeight,cols,rows,cursor){var colIndex=d.columnIndex(),rowIndex=d.rowIndex(),maxMarginRow=maxMargins.rows[rowIndex],maxMarginCol=maxMargins.cols[colIndex],orientation=self._titleOrientation;if(colIndex===0){cursor.x+=plotBounds.left;if(rowIndex===0){cursor.y+=plotBounds.top}}var top=cursor.y+maxMarginRow.top,left=cursor.x+maxMarginCol.left,title=self._titleFormat?self._titleFormat.call(this,d.xFacetTitle(),i):d.xFacetTitle();var titleBounds=self._updatePanelTitle.call(this,self,title,orientation,left,top,facetWidth,facetHeight);d.bounds({width:facetWidth,height:facetHeight,top:top+(orientation==="top"?titleBounds.height:0),left:left+(orientation==="left"?titleBounds.width:0),right:left+facetWidth+(orientation==="right"?-titleBounds.width:0),bottom:top+facetHeight+(orientation==="bottom"?-titleBounds.height:0)});self._updatePanelBackground.call(this,self,left,top,facetWidth,facetHeight);if(colIndex===cols-1){cursor.x=0;cursor.y+=maxMarginRow.top+facetHeight+maxMarginRow.bottom+self._vGap}else{cursor.x+=maxMarginCol.left+facetWidth+maxMarginCol.right+self._hGap}};wrap.group=function(val){if(!arguments.length)return this._group;this._group=val;return this};wrap.numColumns=function(val){if(!arguments.length)return this._numColumns;this._numColumns=val;return this};wrap.numRows=function(val){if(!arguments.length)return this._numRows;this._numRows=val;return this};wrap.preferredAspectRatio=function(val){if(!arguments.length)return this._preferredAspectRatio;this._preferredAspectRatio=val;return this};return wrap});dv.facet.grid=dv.facet.extend(function(){function grid(){this._super();this._xFacetScale=null;this._yFacetScale=null}grid._prerender=function(){this._xFacetScale=dv.scale.ordinal().mapping(this._xGroup).domain([]);this._yFacetScale=dv.scale.ordinal().mapping(this._yGroup).domain([]);this._super()};grid._trainFacetGroups=function(geom){var xGeomFacetTuple=geom.data()[this._xFacetScale.mapping()];if(xGeomFacetTuple){this._xFacetScale.domain(this._xFacetScale.domain().concat(xGeomFacetTuple))}var yGeomFacetTuple=geom.data()[this._yFacetScale.mapping()];if(yGeomFacetTuple){this._yFacetScale.domain(this._yFacetScale.domain().concat(yGeomFacetTuple))}};grid._trainFreeScale=function(geom,panel,property,scaleIndex,filterFunc){var self=this;var trainedScalesAccessor=function(property,scaleIndex,value){if(arguments.length<2)scaleIndex=0;if(!self._positionScales[property])self._positionScales[property]={};var scaleGroup=self._positionScales[property];if(!scaleGroup[scaleIndex])scaleGroup[scaleIndex]=[];var positionScaleArr=scaleGroup[scaleIndex],index=property.indexOf("x")>=0?panel.columnIndex():panel.rowIndex();if(arguments.length<3)return positionScaleArr[index][scaleIndex];positionScaleArr[index][scaleIndex]=value;return value};return this._trainScale(geom,trainedScalesAccessor,property,filterFunc)};grid._showAllPanelLabelsIfFree=function(){return false};grid._configureFacets=function(){var xFacetTitle,yFacetTitle,xFacetKeys=this._xFacetScale.domain(),yFacetKeys=this._yFacetScale.domain(),facetKey;this._numColumns=Math.max(this._xFacetScale.domain().length,1);this._numRows=Math.max(this._yFacetScale.domain().length,1);var i=-1,r=this._numRows,facetIndex=0;while(++i<r){yFacetIndex=i;if(yFacetKeys&&yFacetKeys.length>i){yFacetTitle=yFacetKeys[i]}var j=-1,c=this._numColumns;while(++j<c){xFacetIndex=j;if(xFacetKeys&&xFacetKeys.length>j){xFacetTitle=xFacetKeys[j]}facetKey=(yFacetKeys.length?yFacetTitle:".")+" ~ "+(xFacetKeys.length?xFacetTitle:".");var panel=dv.panel().facetIndex(facetIndex++).facetKey(facetKey).columnIndex(xFacetIndex).rowIndex(yFacetIndex).xFacetTitle(xFacetTitle).yFacetTitle(yFacetTitle).facet(this);this._panels.push(panel);this._addToCollection(this._rows,yFacetIndex,panel);this._addToCollection(this._columns,xFacetIndex,panel)}}};grid._nestFacet=function(geom){var self=this,normalizedData=geom.normalizedData(),zipData=dv.util.filterAndZip(normalizedData),group=geom.getScale("group"),xFacetKeys=this._xFacetScale.domain(),yFacetKeys=this._yFacetScale.domain(),groupProperty,groupKeys;if(group){groupProperty=group.property();groupKeys=groupProperty?normalizedData[groupProperty]:null}var i=-1,n=zipData.length;while(++i<n){var data=zipData[i],yFacetIndex=0,xFacetIndex=0;if(data.data.hasOwnProperty(this._xGroup)){xFacetIndex=xFacetKeys.indexOf(data.data[this._xGroup]);if(xFacetIndex<0)xFacetIndex=0}if(data.data.hasOwnProperty(this._yGroup)){yFacetIndex=yFacetKeys.indexOf(data.data[this._yGroup]);if(yFacetIndex<0)yFacetIndex=0}panelIndex=yFacetIndex*this._numColumns+xFacetIndex;var panel=this._panels[panelIndex];data.panel=panel}return d3.nest().key(function(d){var id="";id+=(d.data.hasOwnProperty(self._yGroup)?d.data[self._yGroup]:".")+" ~ ";id+=(d.data.hasOwnProperty(self._xGroup)?d.data[self._xGroup]:".")+" ~ ";id+=d.hasOwnProperty(groupProperty)?d[groupProperty]:".";return id}).sortKeys(function(a,b){var groupA=self._getGroupFromFacetKey(a),groupB=self._getGroupFromFacetKey(b),aIndex=-1,bIndex=-1;if(groupA!=="."){aIndex=groupKeys.indexOf(groupA);if(aIndex<0)aIndex=groupKeys.indexOf(Number(groupA))}if(groupB!=="."){bIndex=groupKeys.indexOf(groupB);if(bIndex<0)bIndex=groupKeys.indexOf(Number(groupB))}return bIndex<aIndex?1:-1}).entries(zipData)};grid._getGroupFromFacetKey=function(facetKey){return/.* ~ .* ~ (.*)/g.exec(facetKey)[1]};grid._getFacetFromFacetKey=function(facetKey){return/(.* ~ .*) ~ .*/g.exec(facetKey)[1]};grid._ensureColumnsAndRows=function(){return[this._numColumns,this._numRows]};grid._adjustPlotBounds=function(cols,rows){var height=this._measureTitles(this._xFacetScale.domain(),"temp-column-titles",this._chart._g)+3,width=this._measureTitles(this._yFacetScale.domain(),"temp-row-titles",this._chart._g)+3,plotBounds=this._chart._plotBounds;this._xTitleHeight=height;this._yTitleWidth=width;this._chart._plotBounds.top+=height;this._chart._plotBounds.right-=width};grid._measureTitles=function(titleValues,containerSelector,parent){var titles=this._createTitlesContainer(containerSelector,this._chart._g);var panelTitle=titles.selectAll(".panel-title").data(titleValues);panelTitle.enter().append("text").text(function(d,i){return d});var titlesBBox=titles.node().getBBox();titles.remove();return titlesBBox.height};grid._createTitlesContainer=function(selector,d3Parent){var titles=d3Parent.selectAll("."+selector).data([0]);titles.enter().append("g").classed(selector,true);titles.exit().remove();return titles};grid._configurePanels=function(cols,rows){var plotBounds=this._chart._plotBounds,plotWidth=plotBounds.right-plotBounds.left,plotHeight=plotBounds.bottom-plotBounds.top,facetWidth=(plotWidth-(cols-1)*this._hGap)/cols,facetHeight=(plotHeight-(rows-1)*this._vGap)/rows,xCursor=0,yCursor=0,colCursor=0;var i=-1,n=this._panels.length;while(++i<n){var panel=this._panels[i],xFacetScale=dv.facet.scale().innerScaleGroup(panel._trainedScales.x),yFacetScale=dv.facet.scale().innerScaleGroup(panel._trainedScales.y),panelBounds={left:0,top:0,right:0+facetWidth,bottom:0+facetHeight,width:facetWidth,height:facetHeight};this._panels[i].xOuterScale(xFacetScale).yOuterScale(yFacetScale).bounds(panelBounds);xCursor+=facetWidth+this._hGap;colCursor++;if(colCursor>=cols){xCursor=0;yCursor+=facetHeight+this._vGap;colCursor=0}}};grid._drawPanel=function(self,d,i,plotBounds,maxMargins,facetWidth,facetHeight,cols,rows,cursor){var colIndex=d.columnIndex(),rowIndex=d.rowIndex(),maxMarginRow=maxMargins.rows[rowIndex],maxMarginCol=maxMargins.cols[colIndex];cursor.x+=maxMarginCol.left;if(colIndex===0){cursor.x+=plotBounds.left}if(rowIndex===0){var xTitle=self._titleFormat?self._titleFormat.call(this,d.xFacetTitle(),i):d.xFacetTitle();cursor.y=maxMarginRow.top+plotBounds.top;self._updatePanelTitle.call(this,self,xTitle,"top",cursor.x,cursor.y-self._xTitleHeight,facetWidth,facetHeight)}else{self._removePanelTitle.call(this,"top")}if(colIndex===self._numColumns-1){var yTitle=self._titleFormat?self._titleFormat.call(this,d.yFacetTitle(),i):d.yFacetTitle();self._updatePanelTitle.call(this,self,yTitle,"right",cursor.x+self._yTitleWidth,cursor.y,facetWidth,facetHeight)}else{self._removePanelTitle.call(this,"right")}d.bounds({width:facetWidth,height:facetHeight,top:cursor.y,left:cursor.x,right:cursor.x+facetWidth,bottom:cursor.y+facetHeight});self._updatePanelBackground.call(this,self,cursor.x,cursor.y,facetWidth,facetHeight);cursor.x+=facetWidth+maxMarginCol.right+self._hGap;if(colIndex===self._numColumns-1){cursor.x=0;cursor.y+=maxMarginRow.top+facetHeight+maxMarginRow.bottom+self._vGap}};grid.xGroup=function(val){if(!arguments.length)return this._xGroup;this._xGroup=val;return this};grid.yGroup=function(val){if(!arguments.length)return this._yGroup;this._yGroup=val;return this};grid.aggregate=function(val){if(!arguments.length)return this._aggregate;this._aggregate=val;return this};return grid});dv.chart=dv.container.extend(function(){function chart(){this._super();this._firstRender=false;this._data={};this._coord=dv.coord.cartesian();this._facet=dv.facet.wrap().chart(this);this._layers=[];this._behaviors=[];this._legends=dv.guide.legends();this._axes=dv.guide.axes()._chart(this);this._delay=d3.functor(0);this._duration=d3.functor(1e3);this._ease="cubic-in-out";this._parent=null;this._chartContainer=null;this._svgContainer=null;this._g=null;this._axisLabelContainer=null;this._panelContainer=null;this._interactionGroup=null;this._prerenderFunc=null;this._postrenderFunc=null;this._clipPlot=false;this._width=NaN;this._height=NaN;this._plotWidth=NaN;this._plotHeight=NaN;this._calcWidth=NaN;this._calcHeight=NaN;this._calcPlotWidth=NaN;this._calcPlotHeight=NaN;this._defaultPadding=this._padding=this._plotBounds=this._guidesBounds={top:0,left:0,right:0,bottom:0};this._position="identity"}chart.render=function(){if(dv.util.isUndefined(this._data)||dv.util.isEmpty(this._data)){for(var i=0;i<this._layers.length;i++){if(dv.util.isUndefined(this._layers[i]._data)||dv.util.isEmpty(this._layers[i]._data))dv.log.error({msg:"Cannot render a chart with no data provided.",data:{chartData:this._data,geom:this._layers[i]}})}}this._resolvePercentDimensions();this._createChartContainer();this._prerender();this._renderLegends();if(this._prerenderFunc)this._prerenderFunc.call(this);this._facet._render();if(this._postrenderFunc)this._postrenderFunc.call(this);this._renderBehaviors();this._clipGeoms();this._cleanupGuides();this.unregisterEventMap=null;return this};chart._resolvePercentDimensions=function(){this._calcWidth=dv.util.getPercentValue(this._width,this._parent.node().offsetWidth);this._calcHeight=dv.util.getPercentValue(this._height,this._parent.node().offsetHeight);if(!dv.util.isFinite(this._calcWidth)){this._calcPlotWidth=dv.util.getPercentValue(this._plotWidth,this._parent.node().offsetWidth);if(!dv.util.isFinite(this._calcPlotWidth))this._calcWidth=this._parent.node().offsetWidth}else{this._calcPlotWidth=dv.util.getPercentValue(this._plotWidth,this._calcWidth)}if(!dv.util.isFinite(this._calcHeight)){this._calcPlotHeight=dv.util.getPercentValue(this._plotHeight,this._parent.node().offsetHeight);if(!dv.util.isFinite(this._calcPlotHeight))this._calcHeight=this._parent.node().offsetHeight}else{this._calcPlotHeight=dv.util.getPercentValue(this._plotHeight,this._calcHeight)}};chart._finalizePlotBounds=function(){var legendAreaRemaining=this._legends._allowedDimensions(),lWidth=this._legends._getWidth(),lHeight=this._legends._getHeight(),b={left:Math.max(legendAreaRemaining.left,this._padding.left),top:Math.max(legendAreaRemaining.top,this._padding.top)};if(!dv.util.isFinite(this._calcWidth)){this._calcWidth=this._calcPlotWidth+lWidth+this._padding.left+this._padding.right}else if(!dv.util.isFinite(this._calcPlotWidth)){this._calcPlotWidth=this._calcWidth-this._padding.left-this._padding.right-lWidth}if(!dv.util.isFinite(this._calcHeight)){this._calcHeight=this._calcPlotHeight+lHeight+this._padding.top+this._padding.bottom}else if(!dv.util.isFinite(this._calcPlotHeight)){this._calcPlotHeight=this._calcHeight-this._padding.top-this._padding.bottom-lHeight}this._calcPlotWidth=Math.min(this._calcPlotWidth,this._calcWidth-this._padding.left-this._padding.right-lWidth);this._calcPlotHeight=Math.min(this._calcPlotHeight,this._calcHeight-this._padding.top-this._padding.bottom-lHeight);b.right=b.left+this._calcPlotWidth;b.bottom=b.top+this._calcPlotHeight;this.plotBounds(b);if(this._coord instanceof dv.coord.cartesian){this._plotBounds.right-=this._coord.endX();this._plotBounds.left+=this._coord.startX()}this._chartContainer.style("width",this._calcWidth+"px").style("height",this._calcHeight+"px")};chart._prerender=function(){this._trainedScales={};this._calculateStats();this._facet._prerender();var _normalizedData=this._normalizeData(this.data());this.data(_normalizedData);if(!this._axes._get("x"))this._axes._add("x",dv.guide.axis());if(!this._axes._get("y"))this._axes._add("y",dv.guide.axis())};chart._createChartContainer=function(){this._chartContainer=this._parent.selectAll(".dv-chart-container").data([0]);this._chartContainer.enter().append("div").classed("dv-chart-container",true);this._svgContainer=this._chartContainer.selectAll("svg").data([0]);this._svgContainer.enter().append("svg").style("height","100%").style("width","100%");this._axisLabelContainer=this._chartContainer.selectAll(".axes-labels").data([0]);this._axisLabelContainer.enter().append("div").classed("axes-labels",true);this._g=this._svgContainer.select(".group");if(this._g.empty()){this._firstRender=true;this._g=this._svgContainer.append("g").classed("group",true);this._panelContainer=this._g.append("g").classed("panels",true);this._interactionGroup=this._g.append("g").classed("interaction-group",true);this._g.append("g").classed("behavior-under-geom",true);this._g.append("g").classed("plot",true);this._g.append("g").classed("behavior",true);this._g.append("g").classed("legends",true);this._interactionGroup.append("rect").classed("interaction-canvas",true).classed("background",true)}if(!this._panelContainer){this._panelContainer=this._g.select(".panels")}if(!this._interactionGroup){this._interactionGroup=this._g.select(".interaction-group")}};chart._addRegisteredEvents=function(){var self=this;dv.util.each(self.eventMap,function(e,type){self._interactionGroup.on(type,function(){var e=d3.event,interactionGroup=self._interactionGroup.node();if(self._shouldDispatchChartEvent(e,interactionGroup)){self.eventMap[type].callback.call(self._interactionGroup.node(),d3.event)}},e.capture)});dv.util.each(self._layers,function(geom){geom._addRegisteredEvents()})};chart._removeRegisteredEvents=function(){var self=this;dv.util.each(self.unregisterEventMap,function(capture,type){if(self._interactionGroup){self._interactionGroup.on(type,null,capture)}});dv.util.each(self._layers,function(geom){geom._removeRegisteredEvents()})};chart._shouldDispatchChartEvent=function(e,interactionGroup){var result=true;if(e.type==="mouseout"||e.type==="mouseover"){var relTarget=d3.select(e.relatedTarget);if(relTarget&&!relTarget.empty()){var className=relTarget.attr("class");result=!(className&&className.indexOf("-geom")>=0)}}return result};chart._calculateStats=function(){};chart._renderLegends=function(){var width=dv.util.isFinite(this._calcWidth)?this._calcWidth-this._padding.left-this._padding.right:this._calcPlotWidth,height=dv.util.isFinite(this._calcHeight)?this._calcHeight-this._padding.top-this._padding.bottom:this._calcPlotHeight,allowedDimensions={left:this._padding.left,top:this._padding.top,width:width,height:height},chartOpts={el:this._g,scales:this._facet._globalScales,firstRender:this._firstRender,duration:this._duration,delay:this._delay,ease:this._ease};this._legends._allowedDimensions(allowedDimensions)._render(chartOpts);this._finalizePlotBounds()};chart._cleanupGuides=function(){this._legends._empty();this._axes._empty()};chart._setRanges=function(){var bounds=this.plotBounds(),yScale=this.getTrainedScale("y"),xScale=this.getTrainedScale("x");var xRange=this.coord().flip()?[bounds.bottom-bounds.top,0]:[0,bounds.right-bounds.left],yRange=this.coord().flip()?[0,bounds.right-bounds.left]:[bounds.bottom-bounds.top,0];dv.util.scaleRange(xScale,xRange);dv.util.scaleRange(yScale,yRange)};chart.plotBounds=function(val){if(!arguments.length)return this._plotBounds;this._plotBounds=val;return this};chart._renderBehaviors=function(){var panel=this._facet.getPanel(0),bounds=panel._bounds,behaviorContainer=this._g.select(".behavior").attr("transform","translate(0,0)"),behaviorUnderGeomContainer=this._g.select(".behavior-under-geom").attr("transform","translate(0, 0)");this._interactionGroup.attr("transform","translate(0,0)").select(".interaction-canvas").attr("visibility","hidden").attr("width",bounds.right-bounds.left).attr("height",bounds.bottom-bounds.top).attr("x",bounds.left).attr("y",bounds.top);var self=this;dv.util.each(this._behaviors,function(behavior){if(behavior.underGeoms&&behavior.underGeoms()){behavior.chart(self)._render(behaviorUnderGeomContainer)}else{behavior.chart(self)._render(behaviorContainer)}})};chart.guide=function(property,guide,scaleIndex){if(!property||property==="")throw new Error("Property argument cannot be null or empty");if(property==="all"){if(guide!=="none")throw new Error("'all' can only be used to set all guides to 'none' (e.g. turn off all guides)");this._legends._hide(true);this._axes._add("x","none",0);this._axes._add("y","none",0)}property=dv.util.isArray(property)?property:[property];scaleIndex=dv.util.isUndefined(scaleIndex)?0:scaleIndex;var baseLegend=dv.guide.legend(),type="";for(var i=0;i<property.length;i++){var g=guide,isPositional=this._isPositionProperty(property[i]);if(!type)type=isPositional?"axis":"legend";else if(isPositional&&type!="axis")throw new Error("Cannot mix positional and non-positional guide types");if(!g){g=isPositional?dv.guide.axis():baseLegend}else if(!this._isValidGuideType(property[i],g)&&dv.util.isObject(g)){g=this._buildCustomGuide(g)}if(this._isValidGuideType(property[i],g)){if(g!=="none"){g.scaleIndex(scaleIndex)}if(isPositional){this._axes._add(property[i],g,scaleIndex)}else{if(g!=="none"){this._legends._add({props:property,guide:g});break}else{this._legends._remove(property)}}}}return this};chart.getGuide=function(property){return this._axes._get(property)};chart.getAxis=function(property){this.getGuide(property)};chart._isPositionProperty=function(property){return property==="x"||property==="y"};chart._isValidGuideType=function(property,guide){var isPosProp=this._isPositionProperty(property);return guide&&(guide==="none"||guide instanceof dv.guide.custom)||isPosProp&&guide instanceof dv.guide.axis||!isPosProp&&guide instanceof dv.guide.legend};chart._buildCustomGuide=function(config){var g=dv.guide.custom();for(var funcName in config){g.setFunc(funcName,config[funcName])}return g};chart.getScale=function(property,scaleIndex){if(arguments.length<2)scaleIndex=0;if(property==="group")return this._getGroup();if(this._aes.hasOwnProperty(property))return this._aes[property][scaleIndex]};chart._getGroup=function(){if(this._aes.hasOwnProperty("group"))return this._aes.group[0];var i=-1,len=dv.DEFAULT_CATEGORICAL_AES.length-1;while(i++<len){var catAesGroup=this._aes[dv.DEFAULT_CATEGORICAL_AES[i]];if(catAesGroup&&catAesGroup[0]&&catAesGroup[0]instanceof dv.scale.ordinal&&!dv.util.isUndefined(catAesGroup[0].mapping())){return catAesGroup[0]}}return null};chart._clipGeoms=function(){var self=this;var clipDefs=this._parent.selectAll(".panel").selectAll("defs").data(function(d){return self._clipPlot?[d]:[]});clipDefs.enter().append("defs");clipDefs.exit().remove();var clippaths=clipDefs.selectAll("clipPath").data(function(d){return[d]});clippaths.enter().append("clipPath").classed("dv-clip",true);clippaths.exit().remove();clippaths.attr("id",function(d){return"dv-clip"+d._facetIndex});var clipRects=clippaths.selectAll("rect").data(function(d){return[d]});clipRects.enter().append("rect");clipRects.exit().remove();clipRects.attr("x",function(d){return d._bounds.left}).attr("y",function(d){return d._bounds.top}).attr("width",function(d){return d._bounds.width}).attr("height",function(d){return d._bounds.height});if(self._clipPlot){var geomSeries=this._parent.selectAll(".series");geomSeries.attr("clip-path",function(d){var val=d.values[0],panel=dv.util.isArray(val)?val[0].panel:val.panel;return"url(#dv-clip"+panel._facetIndex+")"})}};chart.getTrainedScale=function(prop){return this._facet.getTrainedScale(prop)};chart.getExplicitScale=function(property,scaleIndex){if(scaleIndex===undefined)scaleIndex=0;return this._aes[property][scaleIndex]};chart.parent=function(val){if(!arguments.length)return this._parent?this._parent.node():null;this._parent=d3.select(val);if(this._parent.empty())throw new Error("The DV parent element was not found.");return this};chart.layers=function(val){if(!arguments.length)return this._layers;this._layers=val;return this};chart.behaviors=function(val){if(!arguments.length)return this._behaviors;this._behaviors=val;return this};chart.data=function(val){if(!arguments.length)return this._data;this._data=val;return this};chart.coord=function(val){if(!arguments.length)return this._coord;this._coord=val;return this};chart.facet=function(val){if(!arguments.length)return this._facet;this._facet=val;this._facet.chart(this);return this};chart.getPlotBounds=function(val){return this._plotBounds};chart.plotWidth=function(val){if(!arguments.length)return this._plotWidth;this._plotWidth=val;return this};chart.plotHeight=function(val){if(!arguments.length)return this._plotHeight;this._plotHeight=val;return this};chart.width=function(val){if(!arguments.length)return this._width;this._width=val;return this};chart.height=function(val){if(!arguments.length)return this._height;this._height=val;return this};chart.padding=function(val){if(!arguments.length)return this._padding;this._padding=dv.util.merge(this._defaultPadding,val);return this};chart.prerender=function(val){if(!arguments.length)return this._prerenderFunc;this._prerenderFunc=val;return this};chart.postrender=function(val){if(!arguments.length)return this._postrenderFunc;this._postrenderFunc=val;return this};chart.clipPlot=function(val){if(!arguments.length)return this._clipPlot;this._clipPlot=val;return this};return chart});dv.collisions=dv.collisions||{};dv.collisions.transformPoint=function(m,p){return[m[0]*p[0]+m[2]*p[1]+m[4],m[1]*p[0]+m[3]*p[1]+m[5]]};dv.collisions.convertMatrixTo2x3=function(m){return[m[0],m[1],m[3],m[4],m[6],m[7]]};dv.collisions.convertMatrixTo3x3=function(m){return[m[0],m[1],0,m[2],m[3],0,m[4],m[5],1]};dv.collisions.matrixMultiply=function(a,b){var output=[];output=[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4]*1,a[1]*b[4]+a[3]*b[5]+a[5]*1];return output};dv.collisions.matrixMultiply3x3=function(ma,mb){var output=[];for(var c=0;c<7;c+=3){for(var r=0;r<3;r++){output.push(ma[r]*mb[c]+ma[r+3]*mb[c+1]+ma[r+6]*mb[c+2])}}return output};dv.collisions.matrixInverse=function(m){var det=dv.collisions.determinant(m);if(det===0)return null;var invdet=1/det;var inv=dv.collisions.matrixInverse3x3([m[0],m[1],0,m[2],m[3],0,m[4],m[5],1]);return[inv[0],inv[1],inv[3],inv[4],inv[6],inv[7]]};dv.collisions.matrixInverse3x3=function(m){var det=dv.collisions.determinant3x3(m);if(det===0)return null;var invdet=1/det;var u11=m[0],u12=m[3],u13=m[6],u21=m[1],u22=m[4],u23=m[7],u31=m[2],u32=m[5],u33=m[8];var inv=[u22*u33-u23*u32,u23*u31-u21*u33,u21*u32-u22*u31,u13*u32-u12*u33,u11*u33-u13*u31,u12*u31-u11*u32,u12*u23-u13*u22,u13*u21-u11*u23,u11*u22-u12*u21];for(var i=0;i<inv.length;i++){inv[i]=inv[i]*invdet}return inv};dv.collisions.determinant=function(m){return m[0]*m[3]-m[2]*m[1]};dv.collisions.determinant3x3=function(m){var u1=m[0],u2=m[3],u3=m[6],v1=m[1],v2=m[4],v3=m[7],w1=m[2],w2=m[5],w3=m[8];return u1*(v2*w3-v3*w2)+u2*(v3*w1-v1*w3)+u3*(v1*w2-v2*w1)};dv.collisions.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};dv.collisions.vectorTo=function(a,b){return[b[0]-a[0],b[1]-a[1]]};dv.collisions.vectorNormal=function(v){return[-v[1],v[0]]};dv.collisions.vectorScale=function(v,s){return[v[0]*s,v[1]*s]};dv.collisions.vectorOffset=function(a,b){return[a[0]+b[0],a[1]+b[1]]};dv.collisions.magSq=function(v){return dv.collisions.dot(v,v)};dv.collisions.distToSegSq=function(p,a,b){var ab=dv.collisions.vectorTo(a,b);var ap=dv.collisions.vectorTo(a,p);var bp=dv.collisions.vectorTo(b,p);var e=dv.collisions.dot(ap,ab);var f=dv.collisions.dot(ab,ab);if(e<0){return dv.collisions.dot(ap,ap)}if(e>=f){return dv.collisions.dot(bp,bp)}return dv.collisions.dot(ap,ap)-e*e/f};dv.collisions.pointInside=function(p,a,b){var ab=dv.collisions.vectorTo(a,b);var abNormal=dv.collisions.vectorNormal(ab);var ap=dv.collisions.vectorTo(a,p);var d=dv.collisions.dot(ap,abNormal);return d>0};dv.collisions.triangleIsCounterClockwise=function(a,b,c){var det=b[0]*c[1]-b[1]*c[0]-a[0]*(c[1]-b[1])+a[1]*(c[0]-b[0]);return det<0};dv.collisions.hullPoint=function(p){this.position=p;this.next=null};dv.collisions.hullPoint.prototype.x=function(){return this.position[0]};dv.collisions.hullPoint.prototype.y=function(){return this.position[1]};dv.collisions.hullPoint.prototype.inTriangle=function(A,B,C){var AB=dv.collisions.vectorTo(A.position,B.position);var AC=dv.collisions.vectorTo(A.position,C.position);var AP=dv.collisions.vectorTo(A.position,this.position);var d00=dv.collisions.dot(AB,AB);var d01=dv.collisions.dot(AB,AC);var d11=dv.collisions.dot(AC,AC);var d20=dv.collisions.dot(AP,AB);var d21=dv.collisions.dot(AP,AC);var denom=d00*d11-d01*d01;var v=(d11*d20-d01*d21)/denom;var w=(d00*d21-d01*d20)/denom;var u=1-v-w;if(0<=v&&0<=w&&0<=u&&v+w+u<=1){return true}return false};dv.collisions.hullPoint.pointFarthestFromEdge=function(a,b,points){var e=dv.collisions.vectorTo(a.position,b.position);var eperp=dv.collisions.vectorNormal(e);var bestIndex=-1;var max=-Number.MAX_VALUE;var rightMax=-Number.MAX_VALUE;for(var i=0;i<points.length;i++){var d=dv.collisions.dot(eperp,dv.collisions.vectorTo(a.position,points[i].position));if(d>=0){var r=dv.collisions.dot(e,dv.collisions.vectorTo(a.position,points[i].position));if(d>max||d==max&&r>rightMax){bestIndex=i;max=d;rightMax=r}}}return bestIndex};dv.collisions.quickHull=function(points){function subdivideRight(points,a,b){var e=dv.collisions.vectorTo(a.position,b.position);var eperp=dv.collisions.vectorNormal(e);var output=[];for(var i=0;i<points.length;i++){if(points[i]!=a&&points[i]!=b){var d=dv.collisions.dot(eperp,dv.collisions.vectorTo(a.position,points[i].position));if(d>=0){output.push(points[i])}}}return output}function findPointsOutsideTri(points,a,b,c){var output=[];for(var i=0;i<points.length;i++){if(!points[i].inTriangle(a,b,c))output.push(points[i])}return output}function maxX(points){var bestIndex=-1;var bestValue=-Number.MAX_VALUE;for(var i=0;i<points.length;i++){if(points[i].x()>bestValue){bestIndex=i;bestValue=points[i].x()}}return bestIndex}function minX(points){var bestIndex=-1;var bestValue=Number.MAX_VALUE;for(var i=0;i<points.length;i++){if(points[i].x()<bestValue){bestIndex=i;bestValue=points[i].x()}}return bestIndex}function findHull(points,p,q){if(points.length===0)return[];var f=dv.collisions.hullPoint.pointFarthestFromEdge(p,q,points);if(f==-1)return;p.next=points[f];points[f].next=q;var A=p;var B=p.next;var C=q;var s=findPointsOutsideTri(points,A,B,C);var s1=subdivideRight(s,A,B);var s2=subdivideRight(s,B,C);findHull(s1,A,B);findHull(s2,B,C)}var minPointIndex=minX(points);var maxPointIndex=maxX(points);var A=points[minPointIndex];var B=points[maxPointIndex];A.next=B;B.next=A;var s1=subdivideRight(points,A,B);var s2=subdivideRight(points,B,A);findHull(s1,A,B);findHull(s2,B,A);var output=[[A.x(),A.y()]];var P=A.next;while(P!=A){output.push([P.x(),P.y()]);P=P.next}return output.reverse()};dv.collisions.collisionPrimitive=dv.extend(function(){function collisionPrimitive(){}collisionPrimitive.testHull=function(hull){throw new Error("testHull must be implemented in subclass")};collisionPrimitive.testPoint=function(point){throw new Error("testPoint must be implemented in a subclass")};collisionPrimitive.testRect=function(rectPrimitive){throw new Error("testRect must be implemented in a subclass")};collisionPrimitive.testCircle=function(circlePrimitive){throw new Error("testCircle must be implemented in a subclass")};return collisionPrimitive});dv.collisions.hullSet=dv.collisions.collisionPrimitive.extend(function(hulls){function hullSet(hulls){this._super();this.hulls=hulls}hullSet.testHull=function(hull){for(var i=0;i<this.hulls.length;i++){if(this.hulls[i].testHull(hull)){return true}}return false};hullSet.testPoint=function(point){for(var i=0;i<this.hulls.length;i++){if(this.hulls[i].testPoint(point)){return true}}return false};hullSet.testRect=function(rectPrimitive){for(var i=0;i<this.hulls.length;i++){if(this.hulls[i].testRect(rectPrimitive)){return true}}return false};hullSet.testCircle=function(circlePrimitive){for(var i=0;i<this.hulls.length;i++){if(this.hulls[i].testCircle(circlePrimitive)){return true}}return false};return hullSet});dv.collisions.hull=dv.collisions.collisionPrimitive.extend(function(hullPoints){function hull(hullPoints){this._super();this.points=hullPoints}hull.testPoint=function(point){var n=this.hullLength();var low=0;var high=n;do{var mid=Math.floor((low+high)/2);var inside=dv.collisions.triangleIsCounterClockwise(this.points[0],point,this.points[mid]);if(inside)low=mid;else high=mid}while(low+1<high);if(low===0||high===n)return false;var output=dv.collisions.triangleIsCounterClockwise(this.points[low],point,this.points[high]);return output};hull.testRect=function(rect){var rectPoints=rect.getCorners();for(var i=0;i<rectPoints.length;i++){if(this.testPoint(rectPoints[i])){return true}}for(i=0;i<this.points.length;i++){if(rect.testPoint(this.points[i])){return true}}return false};hull.testCircle=function(circle){var points=this.points;if(this.testPoint(circle.center))return true;for(var i=1;i<points.length;i++){if(circle.testSegment(points[i-1],points[1]))return true}if(circle.testSegment(points[points.length-1],points[0]))return true;return false};hull.hullLength=function(){return this.points.length};return hull});dv.collisions.hullsFromGeometry=function(geometry,projection){var hulls=[];function adjustCoords(coords){var outCoords=[];for(var i=0;i<coords.length;i++){var adjustment=projection(coords[i]);if(adjustment){outCoords.push(adjustment)}}return outCoords}function readPolygon(coords){var adjustedCoords=adjustCoords(coords[0]);if(adjustedCoords){return dv.collisions.hullFromPoints(adjustedCoords)}return null}function readMultipolygon(coords){var hulls=[];for(var i=0;i<coords.length;i++){var h=readPolygon(coords[i]);if(h){hulls.push(h)}}return hulls}if(!geometry){return hulls}if(geometry.type=="Polygon"){hull=readPolygon(geometry.coordinates);return[hull]}if(geometry.type=="MultiPolygon"){return readMultipolygon(geometry.coordinates)}return hulls};dv.collisions.hullFromGeometry=function(geometry,projection){function coordsFromGeometry(g){var coords=[];function packCoords(source){if(!Array.isArray(source))return;if(source.length==2&&!Array.isArray(source[0])&&!Array.isArray(source[1])){var adjustment=projection(source);if(adjustment==null){}else{coords.push(adjustment)}}else{for(var i=0;i<source.length;i++){packCoords(source[i])}}}packCoords(g.coordinates);return coords}if(geometry){if(geometry.type=="MultiPolygon"){return coords}if(geometry.type=="GeometryCollection"){return coords}var coords=coordsFromGeometry(geometry);return dv.collisions.hullFromPoints(coords)}return null};dv.collisions.hullFromPath=function(pathString){var points=[];return dv.collisions.hullFromPoints(points)};dv.collisions.hullFromPoints=function(pointList){if(!pointList){return null}if(pointList.length===0){return null}var hpoints=[];for(var i=0;i<pointList.length;i++){hpoints.push(new dv.collisions.hullPoint(pointList[i]))}return dv.collisions.hull(dv.collisions.quickHull(hpoints))};dv.collisions.hullSetFromPoints=function(pointList){};dv.collisions.rect=dv.collisions.collisionPrimitive.extend(function(){function rect(){this.min=[0,0];this.max=[0,0]}rect.setBounds=function(min,max){this.min=[min[0]<=max[0]?min[0]:max[0],min[1]<=max[1]?min[1]:max[1]];this.max=[min[0]<=max[0]?max[0]:min[0],min[1]<=max[1]?max[1]:min[1]]};rect.getCorners=function(){return[this.min,[this.max[0],this.min[1]],this.max,[this.min[0],this.max[1]]]};rect.testPoint=function(point){for(var i=0;i<2;i++){if(point[i]<this.min[i]||point[i]>this.max[i])return false}return true};rect.testRect=function(otherRect){for(var i=0;i<2;i++){if(this.max[i]<otherRect.min[i]||this.min[i]>otherRect.max[i])return false}return true};rect.sqDistanceToPoint=function(point){var sqDist=0;for(var i=0;i<2;i++){var c=point[i];if(c<this.min[i])sqDist+=(this.min[i]-c)*(this.min[i]-c);if(c>this.max[i])sqDist+=(c-this.max[i])*(c-this.max[i])}return sqDist};rect.testCircle=function(otherCircle){var distSq=this.sqDistanceToPoint(otherCircle.center);if(distSq<1e-7)return true;if(distSq<otherCircle.radius*otherCircle.radius)return true;return false};return rect});dv.collisions.rectFromMinMax=function(minX,minY,maxX,maxY){var output=dv.collisions.rect();output.setBounds([minX,minY],[maxX,maxY]);return output};dv.collisions.circle=dv.collisions.collisionPrimitive.extend(function(centerX,centerY,r){function circle(centerX,centerY,r){this.center=[centerX,centerY];this.radius=r}circle.setLocation=function(centerX,centerY,r){this.center=[centerX,centerY];this.radius=r};circle.testPoint=function(point){var d=0;for(var i=0;i<2;i++){d+=(point[i]-this.center[i])*(point[i]-this.center[i])}if(d>this.radius*this.radius)return false;return true};circle.testRect=function(otherRect){return otherRect.testCircle(this)};circle.testCircle=function(otherCircle){var d=0;for(var i=0;i<2;i++){d+=(otherCircle.center[i]-this.center[i])*(otherCircle.center[i]-this.center[i])}var rSum=otherCircle.radius+this.radius;if(d<rSum*rSum)return true;return false};circle.testSegment=function(a,b){var dSq=dv.collisions.distToSegSq(this.center,a,b);return dSq<=this.radius*this.radius};return circle});dv.collisions.QuadtreeNode=function(center,halfwidth){this.center=center;this.halfwidth=halfwidth;this.children=[];this.contents=[]};dv.collisions.QuadtreeNode.prototype.clear=function(){this.contents=[];for(var i=0;i<this.children.length;i++){this.children[i].clear()}};dv.collisions.QuadtreeNode.prototype.buildTree=function(depth){if(depth<0)return null;var step=this.halfwidth*.5;for(var i=0;i<4;i++){var offset={x:i&1?step:-step,y:i&2?step:-step};var c=new dv.collisions.QuadtreeNode([this.center[0]+offset.x,this.center[1]+offset.y],step);this.children.push(c);c.buildTree(depth-1)}};dv.collisions.QuadtreeNode.prototype.contains=function(position){var min=[this.center[0]-this.halfwidth,this.center[1]-this.halfwidth];var max=[this.center[0]+this.halfwidth,this.center[1]+this.halfwidth];for(var i=0;i<2;i++){if(position[i]<min[i]||position[i]>max[i])return false}return true};dv.collisions.QuadtreeNode.prototype.testRect=function(minX,minY,maxX,maxY,operation){this.testMinMaxBox({minX:minX,minY:minY,maxX:maxX,maxY:maxY},operation)};dv.collisions.QuadtreeNode.prototype.testRect=function(rect,operation){if(this.center[0]+this.halfwidth<rect.min[0]||this.center[0]-this.halfwidth>rect.max[0]||this.center[1]+this.halfwidth<rect.min[1]||this.center[1]-this.halfwidth>rect.max[1])return;var i;for(i=0;i<this.contents.length;i++){if(this.contents[i].geometry.testRect(rect)){operation(this.contents[i].payload,this.contents[i].geometry,this)}}for(i=0;i<this.children.length;i++){this.children[i].testRect(rect,operation)}};dv.collisions.QuadtreeNode.prototype.testCircle=function(circle,operation){var min=[this.center[0]-this.halfwidth,this.center[1]-this.halfwidth];var max=[this.center[0]+this.halfwidth,this.center[1]+this.halfwidth];var sqDist=0;var intersecting=false;var i;for(i=0;i<2;i++){var c=circle.center[i];if(c<min[i])sqDist+=(min[i]-c)*(min[i]-c);if(c>max[i])sqDist+=(c-max[i])*(c-max[i])}if(sqDist<1e-7||sqDist<circle.radius*circle.radius){}else{return}for(i=0;i<this.contents.length;i++){if(this.contents[i].geometry.testCircle(circle)){operation(this.contents[i].payload,this.contents[i].geometry,this)}}for(i=0;i<this.children.length;i++){this.children[i].testCircle(circle,operation)}};dv.collisions.QuadtreeNode.prototype.testPoint=function(point,operation){if(!this.contains(point)){return}var i;for(i=0;i<this.contents.length;i++){if(this.contents[i].geometry.testPoint(point)){operation(this.contents[i].payload,this.contents[i].geometry,this)}}for(i=0;i<this.children.length;i++){this.children[i].testPoint(point,operation)}};dv.collisions.QuadtreeNode.prototype.nodeContainingRect=function(rect){var index=0;var straddle=false;var quadCenter=this.center;for(var i=0;i<2;i++){if(rect.min[i]<quadCenter[i]&&rect.max[i]>quadCenter[i]){straddle=true;break}if(rect.min[i]>=quadCenter[i])index|=1<<i}if(!straddle&&this.children.length>index){return this.children[index].nodeContainingRect(rect)}else{return this}};dv.collisions.QuadtreeNode.prototype.nodeContainingHull=function(hull){var index=0;var straddle=false;var quadCenter=this.center;for(var i=0;i<2;i++){var delta=hull.points[0][i]-quadCenter[i];for(var p=1;p<hull.points.length;p++){var pdelta=hull.points[p][i]-quadCenter[i];if(pdelta*delta<0){return this}}if(delta>0)index|=1<<i}if(this.children.length>index)return this.children[index].nodeContainingHull(hull);return this};dv.collisions.QuadtreeNode.prototype.nodeContainingCircle=function(circle){var index=0;var straddle=false;var circleCenter=circle.center;var quadCenter=this.center;for(var i=0;i<2;i++){var delta=circleCenter[i]-quadCenter[i];if(Math.abs(delta)<circle.radius){straddle=true;break}if(delta>0)index|=1<<i}if(!straddle&&this.children.length>index){return this.children[index].nodeContainingCircle(circle)}else{return this}};dv.collisions.QuadtreeNode.prototype.insertHull=function(hull,payload){this.nodeContainingHull(hull).contents.push({geometry:hull,payload:payload})};dv.collisions.QuadtreeNode.prototype.insertCircle=function(circle,payload){this.nodeContainingCircle(circle).contents.push({geometry:circle,payload:payload})};dv.collisions.QuadtreeNode.prototype.insertRect=function(rect,payload){this.nodeContainingRect(rect).contents.push({geometry:rect,payload:payload})};dv.collisions.RenderQuadtree=function(root,svg){var group=svg.selectAll(".quadtreedebug").data([0]);group.enter().append("g").classed("quadtreedebug",true);var i=0;var blocks=[];var nodes=[];var n;nodes.push(root);while(nodes.length>0){n=nodes[0];nodes.push.apply(nodes,n.children);blocks.push({x:n.center[0]-n.halfwidth,y:n.center[1]-n.halfwidth,width:n.halfwidth*2,height:n.halfwidth*2,content:n.contents.length});nodes.splice(0,1)}var qt=group.selectAll("rect").data(blocks);qt.enter().append("rect");qt.attr("x",function(d){return d.x}).attr("y",function(d){return d.y}).attr("width",function(d){return d.width}).attr("height",function(d){return d.height}).style("fill","none").style("stroke-width","2px").style("stroke",function(d){return d.content>0?"red":"green"}).style("opacity",function(d){return d.content>0?"0.5":"0.05"})};dv.collisions.RenderHull=function(parent,hull){var g=parent.selectAll("g.hull").data([0]);g.enter().append("g").classed("hull",true);g.selectAll("circle").data(hull.points).enter().append("circle").attr("cx",function(d){return d[0]}).attr("cy",function(d){return d[1]}).attr("r",function(d,i){return 4}).text(function(d,i){return i});var line=d3.svg.line().x(function(d){return d[0]}).y(function(d){return d[1]});var closedLine=[hull.points[0]];function addsegmentwnormal(a,b){var v=dv.collisions.vectorScale(dv.collisions.vectorTo(a,b),.5);var n=dv.collisions.vectorNormal(v);n=dv.collisions.vectorScale(dv.collisions.vectorScale(n,1/Math.sqrt(dv.collisions.magSq(n))),16);var mid=dv.collisions.vectorOffset(a,v);closedLine.push(mid);closedLine.push(dv.collisions.vectorOffset(mid,n));closedLine.push(mid);closedLine.push(b)}for(var i=1;i<hull.points.length;i++){addsegmentwnormal(hull.points[i-1],hull.points[i])}addsegmentwnormal(hull.points[hull.points.length-1],hull.points[0]);g=parent.selectAll("g.line").data([0]);g.enter().append("g").classed("line",true);g.datum(closedLine).classed("line",true).append("path").attr("d",line)};if("function"===typeof define&&define.amd){define(function(){return dv})}else if("undefined"===typeof exports){window.dv=dv}else if("object"!==typeof module||!module.exports){exports.dv=dv}else{module.exports=dv}})();(function(global){"use strict";function rs2dv(rsdata,opts){if(this instanceof rs2dv){return this}var options=opts||{},i=0,filterMax=options.displayCount||-1,showNone=options.showNone,dvd={},dvalue=dvd.value=[],dorigValue=dvd.origValue=[],dlowerBound=dvd.lowerBound=[],dupperBound=dvd.upperBound=[],dseries=dvd.series=[],dseriesname=dvd.series_name=[],dmetricseries=dvd.metric_series=[],dmetricseriesname=dvd.metric_series_name=[],ddate=dvd.date=[],dcategory=dvd.category=[],dlabel=dvd.label=[],dgroups=dvd.groups=[],dfacets=dvd.facets=[],dcell=dvd.cell=[],dfilter=dvd.filter=[],showMetrics=options.showMetrics||false,dmetric=dvd.metric=[];var filter_ref,date_ref,cell,metric,filter,f_name,m_name,date,s_name,m,mm,f,ff,d,dd,series_name,c,cc,facet,facets,facet_names,multipleMetrics=rsdata.metrics.length>1,multipleFilters=false,multipleDataStores=false;if(rsdata.filters.length>1){rsdata.filters.some(function(filter,i,filters){if(i>0&&!multipleDataStores){multipleDataStores=filter.data_store!==filters[i-1].data_store}if(i>0&&!multipleFilters){multipleFilters=(filter.info&&filter.info.name||"")!==(filters[i-1].info&&filters[i-1].info.name||"")}return multipleFilters&&multipleDataStores})}for(m=0,mm=rsdata.metrics.length;m<mm;++m){metric=rsdata.metrics[m];m_name=(metric.name||metric.id||"")+"";filter_ref=metric.filter_ref;date_ref=metric.date_ref;ff=filterMax>=0?Math.min(filterMax,filter_ref.length):filter_ref.length;for(f=0;f<ff;++f){filter=rsdata.filters[filter_ref[f]];if(!filter.facet_ref){filter.facet_ref=[]}facets=[];facet_names=[];for(c=0,cc=filter.facet_ref.length;c<cc;++c){facet=rsdata.facets[filter.facet_ref[c]];facets.push(facet);facet_names.push(facet.info&&facet.info.name||"")}if(filter.info&&filter.info.id===0&&!showNone){if(ff<filter_ref.length){++ff}continue}f_name=(filter.info&&filter.info.name||"")+"";s_name=filter.data_store_name||(filter.data_store&&filter.data_store.replace("dms/","")||"");for(d=0,dd=date_ref.length;d<dd;++d){date=rsdata.dates[date_ref[d]];cell=rsdata.data[filter_ref[f]][date_ref[d]][m];dvalue[i]="invalid"===cell.status||"transform_error"===cell.status||"calc_error"===cell.status?undefined:+cell.val||0;dorigValue[i]="invalid"===cell.status?undefined:+cell.orig_val||0;dlowerBound[i]="invalid"===cell.status||"transform_error"===cell.status?undefined:+cell.lower_bound||0;dupperBound[i]="invalid"===cell.status||"transform_error"===cell.status?undefined:+cell.upper_bound||0;ddate[i]=new Date(date.val);dcategory[i]=f_name;dlabel[i]=m_name;dmetricseriesname[i]=(multipleDataStores?s_name+"   ":"")+m_name;dmetricseries[i]=dmetricseriesname[i]+":m"+metric.ref_id;series_name=[];if(multipleDataStores){series_name.push(s_name)}if(dcategory[i].length){series_name.push(dcategory[i])}dseriesname[i]=series_name.join("   ");if(dseriesname[i].length===0){dseriesname[i]=m_name}else if((showMetrics||multipleMetrics||!multipleFilters)&&m_name.length){dseriesname[i]+=" ("+m_name+")"}dseries[i]=dseriesname[i]+":m"+metric.ref_id+"f"+filter.ref_id;dgroups[i]=facet_names;dfilter[i]=filter;dmetric[i]=metric;dcell[i]=cell;dfacets[i]=facets;++i}}}return dvd}var previousRS2DV=global.rs2dv;rs2dv.noConflict=function(){global.rs2dv=previousRS2DV;return this};rs2dv.prototype.convert=function(){return rs2dv.apply(null,arguments)};global.rs2dv=rs2dv;if("function"===typeof define&&define.amd){define(function(){return rs2dv})}else if("undefined"===typeof exports){global.rs2dv=rs2dv}else if("object"!==typeof module||!module.exports){exports.rs2dv=rs2dv}else{module.exports=rs2dv}})(this);(function(global){"use strict";var cloudViz={},dv=global.dv||{},d3=global.d3||{};var core={};core.determineKeyModifiers=function(event){var chord=0;chord=chord|(event.metaKey?dv.util.selectModifiers.toggle:0);chord=chord|(event.ctrlKey?dv.util.selectModifiers.toggle:0);chord=chord|(event.shiftKey?dv.util.selectModifiers.range:0);if((chord&dv.util.selectModifiers.toggle)===0){chord=chord|dv.util.selectModifiers.set}return chord};core._options=null;core._changedOptions=null;core.init=function(options){this._initDefaultOptions();this.setOptions(options);return this};core._initDefaultOptions=function(defaultsToMerge){var defaults={dataAdapter:"standard",data:null,height:null,parent:null,width:null,autoResize:false,locale:"en-US",tooltipContent:null,isOvertime:undefined,guessOvertimeForNonDateValues:true,onMouseOver:null,onMouseOut:null,onContextMenu:null,customEvents:[],l10n:{}};if(defaultsToMerge){this._mergeOptions(defaults,defaultsToMerge)}this._options=defaults;this._changedOptions={};for(var key in defaults){this._changedOptions[key]=defaults[key]}var defaultEvents=["click","mouseover","mouseout","contextmenu","selectionChanged"];var customEvents=this._options["customEvents"];var events=customEvents?defaultEvents.concat(customEvents):defaultEvents;this._dispatch=d3.dispatch.apply(d3.dispatch,events);return this._options};core._initTooltip=function(d,e,tooltipOpts){var currentChartContainer=this._cvWrapper.select(".svg-wrapper"),tooltipParent=this._tooltipParent,containerBox=currentChartContainer.select("svg").node().getBBox(),bounds,content,opts=this._options;content=!!opts.tooltipContent?opts.tooltipContent(d):this.defaultTooltipContent(d);bounds=this._getTooltipBounds(d,e,containerBox);dv.showTooltip(bounds,containerBox,content,"right",20,tooltipParent)};core._getTooltipBounds=function(d,e,rect){console.error("Must implement _getTooltipBounds in subclass")};core._teardownTooltip=function(d,e){var el=this._tooltipParent||this._cvWrapper.select(".svg-wrapper");dv.removeTooltip(el)};core._getNodeTranslation=function(domNode){if(!domNode.transform){return{x:0,y:0}}var transformList=domNode.transform.baseVal,SVG_TRANSFORM_TRANSLATE=2,translateMatrix=null,len=transformList.length;for(var i=0;i<len;i++){translateMatrix=transformList[i].type===SVG_TRANSFORM_TRANSLATE?transformList[i].matrix:null;if(translateMatrix){break}}if(translateMatrix){return{x:translateMatrix.e,y:translateMatrix.f}}else{return{x:0,y:0}}};core.defaultTooltipContent=function(d){var content="<span class='series-name'>"+this.escapeHtml(d.label)+"</span>"+"<span class='metric-value'>"+this.escapeHtml(d.value)+"</span>";return content};core.on=function(event,handler){this._dispatch.on(event,handler);return this};core._onSelectionChanged=function(source,all,added,removed,layer){this._dispatch.selectionChanged.call(source,all,added,removed,layer)};core._mergeOption=function(dest,name,value){switch(name){case"mappings":case"formats":case"scales":dest[name]=dest[name]||{};this._mergeOptions(dest[name],value);break;default:dest[name]=value;break}return dest};core._mergeOptions=function(dest,source){for(var key in source){this._mergeOption(dest,key,source[key])}return dest};core._truncateLabel=function(label,thresh){var max=thresh||this.X_AXIS_LABEL_MAXLENGTH;return label.length>max?label.substring(0,max)+"...":label};core._formatNumber=function(formatType,value,decimalPlaces,formatOpts){var symbol="",format,small,l10n=this._dataAdapter.l10n.numberFormat,pattern,formatted,precision;if(formatType=="currency"||formatType=="percent"){symbol=l10n[formatType].symbol;if(value>=0){pattern=l10n[formatType].positivePattern}else{pattern=l10n[formatType].negativePattern}}else{if(value>=0){pattern="{number}"}else{pattern=l10n.negativePattern}}if(formatType=="percent"){value*=100}value=Math.abs(value);if(value>=100){precision=3}else if(value>=10){precision=value%1?3:2}else if(value>=1){precision=value%1?3:1}else{precision=value%1?2:1}if(decimalPlaces!=null){if(value>=.01&&value<1){formatted=d3.format("."+decimalPlaces+"f")(value)}else{var prefix=d3.formatPrefix(value);formatted=prefix.scale(value).toFixed(decimalPlaces)+prefix.symbol}}else if(value>=1e3&&value<1e4){formatted=d3.format(",.0f")(value)}else{var d3FormatStr="."+precision;if(value>=.01&&value<1){d3FormatStr+="r"}else{d3FormatStr+="s"}formatted=d3.format(d3FormatStr)(value)}if(decimalPlaces&&value<Math.pow(10,-decimalPlaces)&&value>0){small=true;formatted=Math.pow(10,-decimalPlaces)+""}else if(decimalPlaces==null&&value<.01&&value>0){small=true;formatted="0.01"}format=pattern.replace(/\{number\}/i,formatted).replace(/\{symbol\}/i,symbol).replace(/,/g,l10n.groupSeparator).replace(/\./,l10n.decimalSeparator);if(small){format="<"+format}return format};core._getPropMapping=function(prop){return this._dataAdapter.mappings()[prop]};core.setOption=function(name,value){if(!(name in this._options)){return false}if("dataAdapter"===name&&"rs2dv"===value){value="rs"}if("clickHandler"===name){this.on("click",value)}if("onContextMenu"===name){this.on("contextmenu",value)}if("onMouseOver"===name){this.on("mouseover",value)}if("onMouseOut"===name){this.on("mouseout",value)}this._mergeOption(this._options,name,value);if(!this._changedOptions){this._changedOptions={}}this._changedOptions[name]=value;return true};core.getOption=function(key){var options=this._options;if(key in options){return options[key]}return null};core.setOptions=function(options){for(var k in options){this.setOption(k,options[k])}};core.setColors=function(options){if(options.colors&&options.colors.length>0){return}var i,newcolors=[];newcolors["salmonRun"]=["#ffe6d2","#f8a16a","#e35037","#a31542","#500046"],newcolors["sunnyDay"]=["#fffae6","#96d383","#589d72","#336568","#00325a"],newcolors["blueOcean"]=["#f0fff0","#98cdc1","3795b9","#195c96","#002864"],newcolors["blueGrayGreen"]=["#1e4f7d","#346894","#5980a3","#7e98af","#a3b0bb","#c8c8c8","#93b986","#65a534","#498d13","#337208","#1e5a00"],newcolors["specialDefault"]=["#3287d2","#9b8ce6","#d755a5","#fa5a50","#f0a01e","#c3d250","#5faf69","#1ebed7","#5a6eaa","#78b4f5","#aa5fa5","#f0557d","#e8782d","#f5c841","#8cc350","#3cb5a0","#286eaf","#826ee1","#b93282","#f04641","#e18c00","#a0b400","#50965a","#00a0be","#465a87","#4196e6","#964196","#dc3c69","#dc5f00","#e6b43c","#7daf4b","#32a08c"],newcolors["default"]=["#8cc350","#5a6eaa","#d755a5","#1ebed7","#f0a01e","#9b8ce6","#3cb5a0","#3287d2","#f0557d","#c3d250","#eb782d","#78b4f5","#5faf69","#aa5fa5","#fa5a50","#f5c841"],newcolors["d3.category10"]=[],newcolors["d3.category20"]=[],newcolors["d3.category20b"]=[],newcolors["d3.category20c"]=[];var fill10=d3.scale.category10(),fill20=d3.scale.category20(),fill20b=d3.scale.category20b(),fill20c=d3.scale.category20c();for(i=0;i<20;i++){if(i<10){newcolors["d3.category10"][i]=fill10(i)}newcolors["d3.category20"][i]=fill20(i);newcolors["d3.category20b"][i]=fill20b(i);newcolors["d3.category20c"][i]=fill20c(i)}options.colors=newcolors[options.theme]?newcolors[options.theme]:newcolors["default"]};core.selectionCache=function(selectionCache){if(selectionCache!=null){this._selectionCache=selectionCache}return this._selectionCache};core.renderRects=function(rects,parent,cssClass){var container=parent||d3;var data=Array.isArray(rects)&&Array.isArray(rects[0])?rects:[rects];var element=cssClass?"rect."+cssClass:"rect";var items=container.selectAll(element).data(data);items.enter().append("rect");if(cssClass){items.classed(cssClass,true)}items.attr("x",function(d){return d[0]}).attr("y",function(d){return d[1]}).attr("width",function(d){return d[2]}).attr("height",function(d){return d[3]});items.exit().remove();return items};core._preRender=function(){this._clearErrorMessage();this.setColors(this._options);if("autoResize"in this._changedOptions){this._updateWindowResize()}if("dataAdapter"in this._changedOptions){var dataAdapterOption=this._changedOptions["dataAdapter"];if(!this._dataAdapter||this._options.dataAdapter!==dataAdapterOption){var adapters=cloudViz.dataAdapter[dataAdapterOption];if(!adapters){throw new Error("No data adapters were found for data adapter type "+dataAdapterOption)}var adapterConstructor=adapters[this._type]||adapters["base"]||cloudViz.dataAdapter.standard.base;this._dataAdapter=adapterConstructor()}}this._dataAdapter.process(this._options,this._changedOptions);this._highlightedOverlay=cloudViz.util.selectedOverlay(d3.select(this._options.parent))};core._render=function(){};core._postRender=function(){this._changedOptions={}};core.render=function(animate){this.reset();this._preRender();this._render(animate);this._postRender();return this};core.reset=function(){};core._updateWindowResize=function(){if(this._options.autoResize){this._autoResizeHandler=this._autoResizeHandler||dv.util.bind(this._onAutoResize,this);cloudViz.windowResize.addHandler(this._autoResizeHandler)}else{cloudViz.windowResize.removeHandler(this._autoResizeHandler)}};core._onAutoResize=function(){};core.RESPONSIVE_WIDTH_THRESHOLD=400;core._isSmallChart=function(width){return width<core.RESPONSIVE_WIDTH_THRESHOLD};core._getChartWidth=function(){var options=this._options,d3Parent=d3.select(options.parent),cvWrapper=d3Parent.select(".cv-wrapper");if(cvWrapper.empty()){cvWrapper=d3Parent}if(this.isPresent(this.plotWidth)&&!dv.util.isPercentString(options.plotWidth)){return options.plotWidth}else if(this.isPresent(this.width)&&!dv.util.isPercentString(options.width)){return options.width}var parentWidth=cvWrapper.node().offsetWidth;var parentHeight=cvWrapper.node().offsetHeight;if(this.isPresent(this.plotWidth)){return parseInt(options.plotWidth,10)/100*parentWidth}else if(this.isPresent(this.width)){return parseInt(options.width,10)/100*parentWidth}else{return this.isPresent(options.aspectRatio)&&this.isPresent(parentHeight)?parentHeight*options.aspectRatio:parentWidth}};core._getChartHeight=function(){var options=this._options;if(this.isPresent(options.plotHeight)&&!dv.util.isPercentString(options.plotHeight)){return options.plotWidth}else if(this.isPresent(options.height)&&!dv.util.isPercentString(options.height)){return options.height}var parentWidth=d3.select(options.parent).node().offsetWidth;var parentHeight=d3.select(options.parent).node().offsetHeight;if(this.isPresent(options.plotHeight)){return parseInt(options.plotHeight,10)/100*parentHeight}else if(this.isPresent(options.height)){return parseInt(options.height,10)/100*parentHeight}else{return this.isPresent(options.aspectRatio)&&this.isPresent(parentWidth)?parentWidth/options.aspectRatio:parentHeight}};core.handleError=function(error){var l10n=this._dataAdapter.l10n;var clientMsg=l10n.labels.core.erroronrender;if("invaliddata"===error.code){clientMsg=l10n.labels.core.nodata}this._setErrorMessage(clientMsg);console.log("EXCEPTION",error.message);console.log(error.stack);return this};core.isPresent=function(value){return!!value||value===0};core._setErrorMessage=function(message){if(message&&message.length){d3.select(this._options.parent).html('<div class="cv-error">'+message+"</div>")}else{this._clearErrorMessage()}};core._clearErrorMessage=function(){d3.select(this._options.parent).select(".cv-error").remove()};core.destroy=function(){this.reset();cloudViz.windowResize.removeHandler(this._autoResizeHandler)};core.escapeHtml=function(str){return cloudViz.escapeHtml(str)};core.makeContextMenuHandler=function(chart){return function(data,index,j){if(d3.event.altKey){return}d3.event.preventDefault();chart._dispatch.contextmenu.call(this,data,index,j,d3.event)}};core.makeMouseOverHandler=function(chart){return function(data,index,j){chart._dispatch.mouseover.call(this,data,index,j,d3.event)}};core.makeMouseOutHandler=function(chart){return function(data,index,j){chart._dispatch.mouseout.call(this,data,index,j,d3.event)}};core.makeClickHandler=function(chart){return function(data,index,j){chart._dispatch.click.call(this,data,index,j,d3.event)}};core.addToSelectionByDatumSeries=function(){var s=this._selectionCache;if(arguments.length==2&&!Array.isArray(arguments[0])){return this.selectByDatumSeries([[arguments[0],arguments[1]]],function(sel){s.selectionAdd(sel)})}return this.selectByDatumSeries(arguments,function(sel){s.selectionAdd(sel)})};core.setSelectionByDatumSeries=function(){var s=this._selectionCache;if(arguments.length==2&&!Array.isArray(arguments[0])){return this.selectByDatumSeries([[arguments[0],arguments[1]]],function(sel){s.selectionSet(sel)})}return this.selectByDatumSeries(arguments,function(sel){s.selectionSet(sel)})};core.selectByDatumSeries=function(datumSeriesPairs,operation){var parent=d3.select(this._options.parent);var selection=null;var items=[];function loadItems(d){items.push(this)}for(var i=0;i<datumSeriesPairs.length;i++){if(Array.isArray(datumSeriesPairs[i])){selection=this.selectDatumSeriesPair(datumSeriesPairs[i],parent);selection.each(loadItems)}}selection=d3.selectAll(items);operation(selection);return selection};core.selectDatumSeriesPair=function(datumSeriesPair,parent){var dsel=datumSeriesPair[0]!=null?".datum-"+datumSeriesPair[0]:null;var ssel=datumSeriesPair[1]!=null?".series-"+datumSeriesPair[1]:null;if(dsel==null&&ssel==null){return parent.selectAll([])}if(ssel==null){return parent.selectAll(dsel)}if(dsel==null){return parent.selectAll(ssel)}return parent.selectAll(dsel).filter(ssel)};core.currentSelection=function(){var parent=d3.select(this._options.parent);return parent.selectAll(".selected")};core.makeSelectHandler=function(rangeQuery,elementFinder){var self=this;if(!this._options.enableSelection){return null}return function(d,i){var selectionCache=self.selectionCache();var elementSelected=elementFinder?elementFinder.call(this,d,i):this;var chord=dv.util.determineKeyModifiers(d3.event,selectionCache._keymap);if(chord==dv.util.selectModifiers.toggle){selectionCache.selectionToggle(d3.select(elementSelected));d3.event.stopPropagation();return}if(chord==dv.util.selectModifiers.set){selectionCache.selectionSet(d3.select(elementSelected));d3.event.stopPropagation();return}if(chord&dv.util.selectModifiers.range){var nodesInRange=[];var allSimilar=d3.selectAll("."+selectionCache.selectableClass);selectionCache.savePreviousState(allSimilar);if(rangeQuery){nodesInRange=rangeQuery(selectionCache._lastSelected?selectionCache._lastSelected:this,this)}else{var startPoint=selectionCache._lastSelected?selectionCache._lastSelected:elementSelected;var endPoint=elementSelected;var startRect=startPoint.getBoundingClientRect();var endRect=endPoint.getBoundingClientRect();var r=new dv.collisions.rectFromMinMax(startRect.left+startRect.width*.5,startRect.top+startRect.height*.5,endRect.left+endRect.width*.5,endRect.top+endRect.height*.5);allSimilar.each(function(d,i){var myRect=this.getBoundingClientRect();var boundsRect=new dv.collisions.rectFromMinMax(myRect.left,myRect.top,myRect.right,myRect.bottom);if(r.testRect(boundsRect)){nodesInRange.push(this)}});nodesInRange.push(elementSelected)}selectionCache.brush(d3.selectAll(nodesInRange));d3.event.stopPropagation();return}}};global.cloudViz=cloudViz;cloudViz.d3=d3;cloudViz.dv=dv;cloudViz.rs2dv=global.rs2dv||{};cloudViz.core=core;cloudViz.localeDefinition=function(locale,definition,key){var localeDefs,cultureCodes,localeKeys,localeDef;locale=locale.toLowerCase();cloudViz._localeDefinitions=localeDefs=cloudViz._localeDefinitions||{};if(arguments.length>1){cultureCodes=locale.split("-");if(cultureCodes.length<=1){throw new Error("A registered CloudViz locale must be a hyphenated language culture code (e.g. en-US).")}localeKeys=[locale,cultureCodes[0],cultureCodes.join("_")];localeKeys.forEach(function(localeKey){if(key==null){localeDefs[localeKey]=definition}else{localeDefs[localeKey]=localeDefs[locale]||{};localeDefs[localeKey][key]=definition}})}else{localeDef=localeDefs[locale];if(!localeDef){localeDef=localeDefs["en-us"];console.error("Locale definition for "+locale+" not found. Reverting to en-us.")}return localeDef}};cloudViz.escapeHtml=function(str){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(str).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})};if("function"===typeof define&&define.amd){define(function(){return cloudViz})}else if("undefined"===typeof exports){global.cloudViz=cloudViz}else if("object"!==typeof module||!module.exports){exports.cloudViz=cloudViz}else{module.exports=cloudViz}})(this);(function(global){"use strict";global.cloudViz.seriesState=function(){var seriesState={},states=[],stateListeners={};seriesState.isSeriesEnabled=function(seriesId,seriesType){if(!states){return true}var i,length=states.length,state;for(i=0;i<length;i++){state=states[i];if(state.id===seriesId&&state.type===seriesType){return state.enabled}}return false};seriesState.doesSeriesStateExist=function(seriesId,seriesType){if(!states){return false}var i,length=states.length,state;for(i=0;i<length;i++){state=states[i];if(state.id===seriesId&&state.type===seriesType){return true}}return false};seriesState._createStateObject=function(label,id,stateType,enabled,hiddenInLegend){var newObj;if(arguments.length<3){throw new Error("A state object requires a label and stateType.")}if(arguments.length<4){enabled=true}newObj={name:label,id:id,type:stateType,enabled:enabled,hiddenInLegend:!!hiddenInLegend};this.dispatch("create",newObj);return newObj};seriesState.insertState=function(label,id,stateType,enabled,hiddenInLegend){states.unshift(this._createStateObject.apply(this,arguments))};seriesState.appendState=function(label,id,stateType,enabled,hiddenInLegend){states.push(this._createStateObject.apply(this,arguments))};seriesState.enableStateByIndex=function(stateIndex,enabled){if(stateIndex<states.length){var state=states[stateIndex];if(state.enabled!==enabled){state.enabled=enabled;this.dispatch("enableChange",state)}}};seriesState.enableStateByTypeAndId=function(stateType,stateId,enabled){var i,length=states.length,state;for(i=0;i<length;i++){state=states[i];if(state.id===stateId&&state.type===stateType){this.enableStateByIndex(i,enabled)}}};seriesState.removeStatesByType=function(stateType){var self=this;if(states&&states.length){states=states.filter(function(d){if(d.type===stateType){self.dispatch("remove",d);return false}return true})}};seriesState.on=function(eventType,func){if(arguments.length<1){throw new Error("series state listeners require an eventType to be specified.")}var i=eventType.indexOf("."),name="",listeners;if(i>0){name=eventType.substring(i+1);eventType=eventType.substring(0,i)}listeners=stateListeners[eventType]||{};if(!func){delete listeners[name]}else{listeners[name]=func;stateListeners[eventType]=listeners}};seriesState.dispatch=function(eventType,obj){var listeners=stateListeners[eventType];if(listeners){for(var listener in listeners){listeners[listener].call(this,eventType,obj)}}};seriesState.getStateObjects=function(){return states};seriesState.getVisibleStateObjects=function(){return states.filter(function(state){return!state.hiddenInLegend})};seriesState.areSomeSeriesDisabled=function(){if(!states){return false}return Math.min.apply(null,states.map(function(s){return+s.enabled}))===0};seriesState.areAllSeriesDisabled=function(){if(!states){return false}return Math.max.apply(null,states.map(function(s){return+s.enabled}))===0};return seriesState}})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{};var util=cloudViz.util=cloudViz.util||{};util.deepExtend=function(dest){var sources=Array.prototype.slice.call(arguments,1);var i=-1,n=sources.length;while(++i<n){var source=sources[i];if(source){for(var prop in source){if(source[prop]&&source[prop].constructor&&source[prop].constructor===Object){dest[prop]=dest[prop]||{};util.deepExtend(dest[prop],source[prop])}else{dest[prop]=source[prop]}}}}return dest};util.createConstructor=function(proto){function init(){var instance=Object.create(proto);if("function"==typeof instance.init){instance.init.apply(instance,arguments)}return instance}init.prototype=proto;return init};util.selectedOverlay=function(scope,selector){var selectedOverlay={};var sel=selector||".selected-overlay";var overlayClass=sel.substring(1);var selectionScope=scope||d3;selectedOverlay.select=function(){return selectionScope.selectAll(sel)};selectedOverlay.setUpSelectedOverlay=function(parent){var selectedOverlay=parent.selectAll(sel).data([0]).enter().append("g").classed(overlayClass,true).style("pointer-events","none");return selectedOverlay};selectedOverlay.updateSelectedDisplay=function(all,transformFinder){var data=[];var findTransform=transformFinder||function(){return this.attributes["transform"]?this.attributes["transform"].nodeValue:"translate(0,0)"};all.each(function(d){data.push([this.id,findTransform.call(this)])});var elem=this.select().selectAll("use").data(data);elem.enter().append("use");elem.attr("xlink:href",function(d){return"#"+d[0]}).attr("transform",function(d){return d[1]});elem.exit().remove();return elem};return selectedOverlay};util.namespace=function(namespace,head){var segments=namespace.split(".");var tail=head||global;segments.forEach(function(segment){var current=tail[segment];if(!current){current=tail[segment]={}}tail=current});return tail};util.inputFilter=function(brushSelector,zoomSelector,contentSelector){var inputFilter={};var brushSel=brushSelector||".brush-container";var zoomSel=zoomSelector||".zoom-container";var contentSel=contentSelector||".content-container";var brush=null;var events=d3.dispatch("brush","brushstart","brushend");var mySelectionCache=null;d3.rebind(inputFilter,events,"on");inputFilter.setUpBrush=function(parent,selectionCache,searchTree){var self=this;var currentScale=1;var currentOffset=[0,0];mySelectionCache=selectionCache;var mySearchTree=searchTree;function findScrollOffset(transformContainer){if(transformContainer.empty()){return[0,0]}var transformString=transformContainer.attr("transform");var translateGrab=/translate\((-?\d+\.?\d*),(-?\d+\.?\d*)/;var translateValues=translateGrab.exec(transformString);var currentOffset=[0,0];if(translateValues){currentOffset=[translateValues[1],translateValues[2]];currentOffset=dv.collisions.vectorScale(currentOffset,-1)}return currentOffset}function findInverseScale(transformContainer){if(transformContainer.empty()){return 1}var transformString=transformContainer.attr("transform");var scaleGrab=/scale\((-?\d+\.?\d*)\)/;var scaleValues=scaleGrab.exec(transformString);if(!scaleValues){return 1}return 1/scaleValues[1]}var parentSize=[];parent.each(function(d){parentSize[0]=this.clientWidth;parentSize[1]=this.clientHeight});brush=d3.svg.brush().x(d3.scale.identity().domain([0,parentSize[0]])).y(d3.scale.identity().domain([0,parentSize[1]])).on("brushstart",function(){var allItems=d3.selectAll("."+selectionCache.selectableClass);selectionCache.savePreviousState(allItems);var transformingContainer=d3.select(contentSel);currentOffset=findScrollOffset(transformingContainer);currentScale=findInverseScale(transformingContainer);events.brushstart()}).on("brushend",function(){d3.event.target.clear();d3.select(this).call(d3.event.target);self.interceptBrushEvents();events.brushend()}).on("brush",function(){var extent=d3.event.target.extent();var min=extent[0];var max=extent[1];min=dv.collisions.vectorOffset(min,currentOffset);max=dv.collisions.vectorOffset(max,currentOffset);min=dv.collisions.vectorScale(min,currentScale);max=dv.collisions.vectorScale(max,currentScale);var r=new dv.collisions.rectFromMinMax(min[0],min[1],max[0],max[1]);var selected=[];if(mySearchTree){mySearchTree.testRect(r,function(payload,g,node){selected.push(payload)})}else{var allSimilar=d3.selectAll(contentSel).selectAll("."+mySelectionCache.selectableClass);allSimilar.each(function(d,i){var myRect=this.getBoundingClientRect();var boundsRect=new dv.collisions.rectFromMinMax(myRect.left,myRect.top,myRect.right,myRect.bottom);if(r.testRect(boundsRect)){selected.push(this)}})}var brushed=d3.selectAll(selected);mySelectionCache.brush(brushed);events.brush()});var brushg=parent.selectAll(brushSel).data([0]).enter().append("g").call(brush).style("pointer-events","none").classed(brushSel.substring(1),true)};inputFilter.setUpBrushOverlay=function(parent){if(brush==null){throw new Error("you must call setUpBrush first")}var overlayLayer=parent.selectAll(".brushOverlay").data([0]).enter().append("g").style("pointer-events","none").classed("brushOverlay",true);var overlayExtent=overlayLayer.selectAll(".extent").data([0]).enter().append("rect").classed("extent",true);brush.on("brush.overlay",function(){var extent=d3.event.target.extent();overlayExtent.attr("x",extent[0][0]).attr("y",extent[0][1]).attr("width",extent[1][0]-extent[0][0]).attr("height",extent[1][1]-extent[0][1])}).on("brushstart.overlay",function(){overlayExtent.style("visibility","")}).on("brushend.overlay",function(){overlayExtent.style("visibility","hidden")});return overlayLayer};inputFilter.setUpZoom=function(){};inputFilter.interceptBrushEvents=function(){var brushGroup=d3.selectAll(brushSel);var contentGroup=d3.selectAll(contentSel);var zoomGroup=d3.selectAll(zoomSel);var origmousedown=brushGroup.node()["__onmousedown.brush"];var origZoomDown=zoomGroup.empty()?null:zoomGroup["0"]["0"]["__onmousedown.zoom"];var brushState=0;var lastMouse=[0,0];var thisMouse=[0,0];var capturedEvents=[];brushGroup.on("mousedown.brush",function(args){if(brushState==2){origmousedown.call(brushGroup.node(),d3.event)}});zoomGroup.on("mousedown.zoom",function(args){if(!triggersSelection(d3.event)){origZoomDown.call(zoomGroup.node(),d3.event)}});function setWaitingMode(){brushGroup.style("pointer-events","none");if(!zoomGroup.empty()){zoomGroup.style("pointer-events","all")}contentGroup.style("pointer-events","visible")}function setBrushAnticipationMode(){brushGroup.style("pointer-events","all");if(!zoomGroup.empty()){zoomGroup.style("pointer-events","none")}contentGroup.style("pointer-events","none")}function triggersSelection(evt){var selectChord=dv.util.determineKeyModifiers(evt,mySelectionCache.selectionKeymap());return evt.buttons==1&&selectChord&dv.util.selectModifiers.range}function dispatchFakeEvent(target,type,evt){var myevent=new MouseEvent(type,{screenX:evt.screenX,screenY:evt.screenY,clientX:evt.clientX,clientY:evt.clientY,ctrlKey:evt.ctrlKey,shiftKey:evt.shiftKey,altKey:evt.altKey,metaKey:evt.metaKey,button:evt.button,buttons:evt.buttons});target.each(function(d,i,j){this.dispatchEvent(myevent)})}function advanceBrushState(container){if(brushState===0){if(triggersSelection(d3.event)){lastMouse=d3.mouse(container);brushState++;capturedEvents.push(d3.event);setBrushAnticipationMode()}}if(brushState==1){thisMouse=d3.mouse(container);if(dv.collisions.magSq(dv.collisions.vectorTo(lastMouse,thisMouse))>16*16&&triggersSelection(d3.event)){brushState++;dispatchFakeEvent(brushGroup,"mousedown",capturedEvents[0])}if(!triggersSelection(d3.event)){if(dv.collisions.magSq(dv.collisions.vectorTo(lastMouse,thisMouse))<2){mySelectionCache.selectionSet(d3.selectAll([]))}brushState=0;capturedEvents.length=0;setWaitingMode()}}}d3.selectAll("body").on("mousemove.interceptor",function(){advanceBrushState(this)}).on("mousedown.interceptor",function(){advanceBrushState(this)}).on("mouseup.interceptor",function(){advanceBrushState(this)}).on("keydown.interceptor",function(){}).on("keyup.interceptor",function(){});setWaitingMode()};return inputFilter}})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},dvcore=Object.create(core);dvcore.X_AXIS_LABEL_MAXLENGTH=25;dvcore.LEGEND_ORIENTATIONS=["top","right","left"];dvcore._chart=null;dvcore.clipIdCounter={count:0};dvcore._legend=null;dvcore._seriesState=null;dvcore.init=function(options){Object.getPrototypeOf(dvcore).init.apply(this,arguments);this._seriesState=cloudViz.seriesState();return this};dvcore._initDefaultOptions=function(defaultsToMerge){var defaults={aspectRatio:null,colors:[],theme:"default",dateGranularity:undefined,flip:false,interactive:false,legendOrientation:null,legendVerticalWidth:110,legendVisible:true,targetValues:null,targetNames:null,targetLabel:undefined,mappings:{x:"x",y:"y",series:"series",seriesLabel:"series"},plotHeight:null,plotWidth:null,preRender:null,xAxisTitle:"",yAxisTitle:"",precision:null};if(defaultsToMerge){this._mergeOptions(defaults,defaultsToMerge)}return Object.getPrototypeOf(dvcore)._initDefaultOptions.call(this,defaults)};dvcore.getChart=function(){return this._chart};dvcore.getDVGuide=function(prop,index){index=index||0;return this.getChart().getGuide(prop)[index]};dvcore.getDVAesthetic=function(prop,index){index=index||0;return this.getChart()._aes[prop][index]};dvcore.enableSeriesByIndex=function(index,enabled){this._seriesState.enableStateByIndex(index,enabled)};dvcore._highlight=function(selection,enabled){selection.classed("cv-highlight",enabled)};dvcore._getYTitleFromLabels=function(labels){var uniqLabels=dv.util.uniq(labels);if(uniqLabels&&uniqLabels.length===1){return uniqLabels[0]}return null};dvcore._preRender=function(){Object.getPrototypeOf(dvcore)._preRender.call(this);try{this._createSeriesStates()}catch(e){var error=new Error("The chart data is invalid");error.code="invaliddata";this.handleError(error)}};dvcore._postRender=function(){Object.getPrototypeOf(dvcore)._postRender.call(this);var options=this._options,d3Parent=d3.select(options.parent);this._updateYAxisHitBox(d3Parent);this._colorDualYAxes(options,d3Parent);this._highlightedOverlay.setUpSelectedOverlay(d3Parent.selectAll(".behavior"));var background=d3Parent.selectAll(".interaction-canvas");var selectionCache=this.selectionCache();if(selectionCache){selectionCache.setDeselector(background);selectionCache.selectionKeymap(this.determineKeyModifiers)}};dvcore._removeYAxisHitBox=function(d3Parent){d3Parent.selectAll(".axis-y .cv-axis-hitbox").remove()};dvcore._colorDualYAxes=function(options,d3Parent){if(options.dualYAxis&&(!this._isNormalized||!this._isNormalized())&&(this._options.position==="identity"||this._options.position==="dodge")){d3Parent.selectAll(".axis-y.axis-index-0 span").style("color",options.colors[0]);d3Parent.selectAll(".axis-y.axis-index-1 span").style("color",options.colors[1]);d3Parent.selectAll(".axis-title-y.axis-title-index-0").style("color",options.colors[0]);d3Parent.selectAll(".axis-title-y.axis-title-index-1").style("color",options.colors[1])}};dvcore._createSeriesStates=function(){var options=this._options;if("data"in this._changedOptions&&this._changedOptions.data){this._seriesState.removeStatesByType("standard");var seriesIds=this._dataAdapter.data()[this._getPropMapping("series")],seriesNames=this._dataAdapter.data()[this._getPropMapping("seriesLabel")];if(seriesIds){var seriesTypes=seriesIds.reduce(function(memo,d,i){if(memo.ids.indexOf(d)<0){memo.ids.push(d);memo.names.push(seriesNames?seriesNames[i]:d)}return memo},{names:[],ids:[]}),i=seriesTypes.ids.length;while(i--){var seriesName=seriesTypes.names[i],seriesId=seriesTypes.ids[i];this._seriesState.insertState(seriesName||seriesId,seriesId,"standard")}}}if("targetValues"in this._changedOptions){if(options.targetValues){this._seriesState.removeStatesByType("target");this._seriesState.appendState(options.targetLabel||this._dataAdapter.l10n.labels.dvcore.target,"target","target")}}};dvcore._createTargetHLines=function(){var options=this._options,chart=this._chart,self=this,hlineData={y:[],name:[]};if(options.targetValues&&options.targetValues.length){var layers=chart.layers(),hline=dv.geom.hline(),enabled=self._seriesState.isSeriesEnabled("target","target"),i,length=options.targetValues.length,rangePadding=[0,this._isSmallChart()?24:6],scale=options.scales&&options.scales.y==="log"?dv.scale.log():dv.scale.linear();for(i=0;i<length;i++){hlineData.y.push(options.targetValues[i]);hlineData.name.push(options.targetNames&&options.targetNames[i]?options.targetNames[i]:"")}hline.data(hlineData).position("identity").map("y","y",scale.includeInDomain(function(){if(!self._valuesAreFilterable()){return true}return enabled}).rangePadding(rangePadding)).each("start",function(d,i){d3.select(this).attr("legend-type","target")});if(this._type==="line"){layers.unshift(hline)}else{layers.push(hline)}chart.layers(layers)}return hlineData};dvcore._domainNaturallyIncludesZero=function(scale){if(!scale){return false}var options=this._options,prop=scale.property(),natDomain=scale.naturalDomain(),lowerBound=natDomain[0];if(options.scales&&options.scales[prop]==="log"){return lowerBound<=1}return lowerBound<=0};dvcore._updateYAxisHitBox=function(d3Parent){var self=this,options=this._options,panel=this._chart.facet().getPanel(0);if(panel){var isSmall=this._isSmallChart(),normalized=this._isNormalized&&this._isNormalized(),yScale=this._chart.getTrainedScale("y"),naturallyIncludesZero=this._domainNaturallyIncludesZero(yScale),left=panel.bounds().left,top=yScale.range()[1],bottom=yScale.range()[0],yAxisParent=d3Parent.selectAll(".axes-labels .axis-y.axis-index-0"),hitbox=yAxisParent.selectAll(".cv-axis-hitbox").data([0]);if(options.interactive&&!isSmall&&!normalized&&!naturallyIncludesZero&&options.position==="identity"){hitbox.enter().append("div").classed("cv-axis-hitbox",true);hitbox.on("click",function(){if(options.interactive&&!isSmall){if(options.onYAxisClick){options.onYAxisClick()}else{self._dataAdapter._forceZero=!self._dataAdapter._forceZero;self._render(true);self._postRender()}}});if(this._legend!=="none"&&this._legend.isVertical()){left-=this._legend.orientation()==="left"?this._legend._getUsedWidth():0}hitbox.style("width",left+"px").style("height",bottom-top+"px").style("top",top+"px").style("left",-left+"px");hitbox.exit().on("click",null)}else{this._removeYAxisHitBox(d3Parent)}}else{this._removeYAxisHitBox(d3Parent)}};dvcore._render=function(animate){Object.getPrototypeOf(dvcore)._render.apply(this,arguments);var options=this._options,error;try{if(!this._dataAdapter.isDataValid()){error=new Error("The chart data is invalid");error.code="invaliddata";throw error}if(!options.parent){throw new Error("The chart options did not contain a parent")}return this._draw(animate)}catch(e){this.handleError(e)}};dvcore.reset=function(){Object.getPrototypeOf(dvcore).reset.apply(this,arguments)};dvcore.destroy=function(){Object.getPrototypeOf(dvcore).destroy.apply(this,arguments);if(this._options&&this._options.parent){d3.select(this._options.parent).select(".cv-wrapper").remove()}return this};dvcore._isMappedAndExistsInData=function(prop){var mapping=this._getPropMapping(prop);return mapping&&this._options.data[mapping]};dvcore._setChartCoreOptions=function(){var options=this._options,chart=this._chart,self=this,aspectRatio=options.aspectRatio,width=options.width,height=options.height,parent=d3.select(options.parent);chart.data(this._dataAdapter.data()).width(aspectRatio!==null&&height!==null?height*aspectRatio:width).height(aspectRatio!==null&&width!==null?width/aspectRatio:height);var container=parent.selectAll(".cv-wrapper").data([0]);container.enter().insert("div",":first-child").classed("cv-wrapper",true);container.attr("data-chart-type",this._type);container.classed({interactive:options.interactive,"right-overflow":this._adjustClipWidth,"cv-small-chart":this._isSmallChart()});chart.parent(container.node());this._legend=this._buildLegend();this._seriesState.on("enableChange.paths",function(eventType,state){self._preRender();self._render(true);self._postRender();setTimeout(function(){self._updatePathStates()},10)});if(!this._isSmallChart()){var padding={left:10};if(options.dualYAxis){padding.right=10}chart.padding(padding)}else{chart.padding({})}};dvcore._isVisible=function(parent){var elem=d3.select(parent).node();return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)};dvcore._draw=function(a){var chart=this._chart,options=this._options,animate=a===undefined?false:a;if(!this._isVisible(options.parent)){return this}if(!chart){throw new Error("DV Chart was not created")}this._setChartCoreOptions();this._setChartTypeOptions();this._createTargetHLines();if(this._isSmallChart()){this._drawSmall()}else{this._drawLarge()}if(!animate){chart.duration(0)}else{chart.duration(1e3)}this._renderChart();return this};dvcore._drawBackground=function(){var options=this._options;if(options.interactive){var container=d3.select(options.parent).select(".cv-wrapper"),bg=container.selectAll(".cv-bg").data([0]),orientation=this._legend==="none"?null:this._legend.orientation();bg.enter().insert("div",":first-child").classed("cv-bg",true);var chart=this._chart,legend=d3.select(options.parent).select(".cv-legend"),borderAdjust=this._legend!=="none"&&this._legend.isVertical()||legend.empty()?0:1,shadowAdjust=1,padding=chart.padding(),lastPanelBounds=chart.facet().getPanel(chart.facet()._panels.length-1).bounds(),plotBounds=chart.plotBounds(),legendWidth=this._chart._legends&&this._chart._legends.hasOwnProperty("_w")?this._chart._legends._w:0,x=this._legend!=="none"&&(orientation==="left"||!orientation&&this._legend.isVertical())?legendWidth:0,y=plotBounds.top-borderAdjust-padding.top,width=chart._calcWidth-x-(orientation==="right"?legendWidth:0),height=lastPanelBounds.top+lastPanelBounds.height-plotBounds.top+borderAdjust+padding.top;bg.style("top",y+"px").style("left",x+"px").style("height",height+shadowAdjust+"px").style("width",width+"px");if(this._legend!=="none"&&this._legend.isVertical()){var adjust=1,d3Legend=d3.select(options.parent).selectAll(".cv-legend"),lHeight=!legend.empty()&&d3Legend.node().scrollHeight||0,clipped=lHeight>=height-adjust;d3Legend.style("height",clipped?height-adjust+"px":null).classed("clipped",clipped)}}};dvcore._drawClipping=function(){var chart=this._chart,options=this._options,svg=chart._svgContainer,defs=svg.selectAll("defs").data([0]);defs.enter().insert("defs",":first-child");var clipId="cv-clip"+this.clipIdCounter.count++,clip=defs.selectAll(".cv-clip").data([0]);clip.enter().append("clipPath").classed("cv-clip",true).append("rect");clip.attr("id",clipId);var rect=clip.selectAll("rect"),padding=chart.padding(),lastPanelBounds=chart.facet().getPanel(chart.facet()._panels.length-1).bounds(),plotBounds=chart.plotBounds(),x=plotBounds.left-padding.left,y=plotBounds.top,width=plotBounds.right-x+padding.right,height=lastPanelBounds.top+lastPanelBounds.height-plotBounds.top+1;if(options.interactive){width-=1;height-=1}if(this._adjustClipHeight){height+=this._adjustClipHeight}if(this._adjustClipWidth){width+=this._adjustClipWidth}rect.attr("x",x).attr("y",y).attr("width",Math.max(width,0)).attr("height",Math.max(height,0));svg.selectAll(".geom").attr("clip-path",null);svg.selectAll(".geom:not(.no-clip)").attr("clip-path","url(#"+clipId+")")};dvcore._renderChart=function(){var self=this,options=this._options;if("function"==typeof options.preRender){options.preRender(this.getChart())}this._chart.render();this._drawBackground();this._drawClipping();setTimeout(function(){self._updatePathStates()},10)};dvcore._onAutoResize=function(){this._draw(false)};dvcore._setChartTypeOptions=function(){};dvcore._drawSmall=function(a){};dvcore._drawLarge=function(a){};dvcore._isSmallChart=function(){return Object.getPrototypeOf(dvcore)._isSmallChart.apply(this,[this._getChartWidth()])};dvcore._constructScale=function(axis,dvscale){var options=this._options,scale=dvscale;if(!scale){var scaleType=options.scales&&options.scales[axis];if(!scaleType||scaleType==="default"){scaleType="linear"}scale=dv.scale[scaleType]()}if(options.interactive){scale=this._adjustLimits(scale)}if(axis==="y"&&this._dataAdapter._forceZero){this._applyForceZero(scale)}return scale};dvcore._applyForceZero=function(scale){var options=this._options,isLogY=options.scales&&options.scales.y==="log",minYBaseline=isLogY?1:0,maxYBaseline=isLogY?-1:0;scale.lowerLimit(function(min,max){return min<minYBaseline?min:minYBaseline});scale.upperLimit(function(min,max){return max>maxYBaseline?max:maxYBaseline});return scale};dvcore._adjustLimits=function(scale){var self=this,options=this._options;scale.includeInDomain(function(d,i){if(!self._valuesAreFilterable()){return true}return self._seriesState.isSeriesEnabled(d.data[self._getPropMapping("sliceId")||self._getPropMapping("series")],"standard")});return scale};dvcore._valuesAreFilterable=function(){return this._options.interactive&&this._seriesState.areSomeSeriesDisabled()&&!this._seriesState.areAllSeriesDisabled()};dvcore._getEnabledValues=function(key){var self=this,options=this._options,values=this._dataAdapter.data()[this._getPropMapping(key)];if(!this._valuesAreFilterable()){return values}var seriesKey=this._legend&&this._legend.mapping?this._legend.mapping():"series";var mapping=this._dataAdapter.data()[seriesKey];values=values.filter(function(v,i){return mapping[i]&&self._seriesState.isSeriesEnabled(mapping[i],"standard")});return values};dvcore._updatePathStates=function(seriesIdKey){var self=this,options=this._options,parent=d3.select(options.parent);parent.selectAll(".plot .series [legend-group]").classed("path-inactive",function(){if(!options.interactive){return false}var el=d3.select(this),data=el.datum(),dataPoint=dv.util.isArray(data)?data[0].data:data.data,seriesId=dataPoint[self._getPropMapping(seriesIdKey||"series")];if(self._seriesState.doesSeriesStateExist(seriesId,"standard")){return!self._seriesState.isSeriesEnabled(seriesId,"standard")}return el.classed("path-inactive")});if(options.targetValues){parent.selectAll(".plot .series [legend-type]").classed("path-inactive",function(){if(!options.interactive){return false}var el=d3.select(this),seriesType=el.attr("legend-type");if(self._seriesState.doesSeriesStateExist("target",seriesType)){return!self._seriesState.isSeriesEnabled("target",seriesType)}return el.classed("path-inactive")})}};dvcore._buildLegend=function(seriesMapKey,seriesLabelMapKey){var labels=null,options=this._options,container=d3.select(options.parent).select(".cv-wrapper"),seriesMapping=this._getPropMapping(seriesMapKey||"series"),seriesLabelMapping=this._getPropMapping(seriesLabelMapKey||"seriesLabel");if(seriesMapping&&seriesLabelMapping&&seriesMapping!==seriesLabelMapping){var data=this._dataAdapter.data(),series=data[seriesMapping],seriesLabels=data[seriesLabelMapping]||series;labels=[];series.forEach(function(v,i,a){if(a.indexOf(v)===i){labels.push(seriesLabels[i])}})}if(!options.legendVisible){container.selectAll(".cv-legend").remove();container.selectAll(".cv-bg").remove();return"none"}if(options.interactive){return this._buildInteractiveLegend(labels)}else{return this._buildStandardLegend(labels)}};dvcore._buildStandardLegend=function(labels){var options=this._options,container=d3.select(options.parent).select(".cv-wrapper");this._legend=null;container.selectAll(".cv-legend").remove();container.selectAll(".cv-bg").remove();var padding,orientation=this.LEGEND_ORIENTATIONS.indexOf(options.legendOrientation)>-1?options.legendOrientation:"top";switch(this._calculatedLegendOrientation){case"top":case"bottom":padding={top:5,bottom:5,left:0,right:0};break;case"left":case"right":padding={top:0,bottom:0,left:5,right:5};break}var legend=dv.guide.legend().orientation(orientation).padding(padding);if(labels){legend.labels(labels)}if(this._isSmallChart()){legend.hGap(10).vGap(2)}return legend};dvcore._buildInteractiveLegend=function(labels){var options=this._options,self=this,container=d3.select(options.parent).select(".cv-wrapper");if(!this._legend||this._legend==="none"){this._legend=cloudViz.interactiveLegend()}var groups=this._dataAdapter.data()[this._getPropMapping("series")],multipleGroups=groups.some(function(name,i,names){return name!==names[i-1]});if(!multipleGroups){this._legend.remove();container.selectAll(".path-inactive").classed("path-inactive",false);return"none"}this._legend.parent(container.node()).orientation(options.legendOrientation).chartWidth(this._getChartWidth()).chartHeight(this._getChartHeight()).chartPadding(this._chart.padding()).validOrientations(this.LEGEND_ORIENTATIONS).legendVerticalWidth(options.legendVerticalWidth).type(this._type).seriesState(this._seriesState);if(labels){if(this._getCategoryTotal){this._legend.totals(labels.map(function(d){return this._getCategoryTotal(d)}))}}return this._legend};dvcore._numXTicks=function(){return function(range){return Math.max(range/120,2)}};dvcore._yTitleFormat=function(scaleIndex,values){var adapter=this._dataAdapter,title=adapter.yAxisTitle(),l10n=adapter.l10n,format=this._getYFormatType(scaleIndex),time,pattern;if("time"===format){if(!values){values=this._getEnabledValues("y")}time=this._yTimeGranularity(values,dv.guide.axis().ticks()());time=l10n.time.plural[time.gran];pattern=title?l10n.labels.dvcore.yAxisTimeWithTitle:l10n.labels.dvcore.yAxisTimeNoTitle;title=pattern.replace(/\{time\}/i,time).replace(/\{title\}/i,title)}return title};dvcore._formatYTickValue=dvcore._formatYValue=function(value,type,time,precision,formatOpts){if(time&&time.divisor>0){value=value/time.divisor}formatOpts=formatOpts||{};formatOpts.prop=formatOpts.prop||"y";return this._formatNumber(type,value,precision,formatOpts)};dvcore._formatLegendValue=function(value,type,precision,formatOpts){return this._formatNumber(type,value,precision,{prop:"y",seriesIndex:formatOpts.seriesIndex,isLegend:true,dataItem:formatOpts.dataItem})};dvcore._getYFormatType=function(scaleIndex){var yFormats=this._dataAdapter.formats().y;if(!yFormats){return"decimal"}if(dv.util.isArray(yFormats)){if(!yFormats[scaleIndex]){return"decimal"}return yFormats[scaleIndex]}return yFormats};dvcore._tickSize=function(property){var options=this._options,dualAxis=options.dualYAxis&&property==="y",tickSize;return function(d){if(options.scales&&options.scales[property]==="log"){if(Math.round(Math.log(Math.abs(d))/Math.LN10*1e6)/1e6%1){tickSize=10}else{tickSize=null}}else{tickSize=null}if(!tickSize){return dualAxis?15:null}return tickSize}};dvcore._yLabelFormat=function(scaleIndex){var type=this._getYFormatType(scaleIndex),adapter=this._dataAdapter,opts=this._options,self=this;return function(d,i,formatOpts){var str,time,l10n=adapter.l10n.time;if("time"===type){time=adapter.getTimeGranularity(d,true);l10n=1!==+d?l10n.plural:l10n.singular}formatOpts=formatOpts||{};formatOpts.seriesIndex=formatOpts.seriesIndex||scaleIndex;formatOpts.dataItem=formatOpts.dataItem||d;str=self._formatYValue(d,type,time,opts.precision,formatOpts);if(time&&time.gran){str+=" "+l10n[time.gran]}return str}};dvcore._yTickFormat=function(scaleIndex,values,showAllLabels){var self=this,type=this._getYFormatType(scaleIndex),options=this._options,isLogY=options.scales&&options.scales.y==="log",yMinBaseline=isLogY?1:0,useSecondAxisLabelForArrow=false,logAxisLabels,arrowDrawn,minDomain,time;if("time"===type){if(!values){values=this._getEnabledValues("y")}time=self._yTimeGranularity(values,dv.guide.axis().ticks()())}return function(d,i,panel){var el=d3.select(this),yScale=panel.yOuterScale().innerScaleGroup()[scaleIndex],distFromBottom,hideValue=false;if(i===0){arrowDrawn=false}if(!yScale){yScale=panel.getTrainedScale("y")}minDomain=yScale.domain()[0];distFromBottom=yScale.range()[0]-yScale.mapValue(d);if(isLogY){if(!logAxisLabels){var logScale=d3.scale.log().domain(yScale.domain());logAxisLabels=logScale.ticks().map(logScale.tickFormat(5,function(val){return self._formatYTickValue(val,type,time,options.precision,{seriesIndex:scaleIndex,isTickLabel:true,dataItem:d})}))}}if(distFromBottom<10&&!options.flip){hideValue=true}if(isLogY&&logAxisLabels[i]===""){hideValue=true}if(minDomain>yMinBaseline&&!hideValue&&!arrowDrawn&&options.interactive){el.classed("arrow-container",true);arrowDrawn=true}else{el.classed("arrow-container",false)}if(hideValue&&!showAllLabels){return""}if(isLogY){return logAxisLabels[i]}return self._formatYTickValue(d,type,time,options.precision,{seriesIndex:scaleIndex,isTickLabel:true,dataItem:d})}};dvcore._yTimeGranularity=function(values,ticks){values=values&&values.filter(function(v){return isFinite(v)})||[];ticks=ticks||1;if(!values.length){return null}var max=Math.max.apply(null,values),min=Math.min.apply(null,values),arr=d3.scale.linear().domain([min,max]).ticks(ticks),diff=arr.length?arr.length>1?arr[1]-arr[0]:max-arr[0]:max,step=arr.length?diff/arr.length:diff;return this._dataAdapter.getTimeGranularity(step)};dvcore._xTickAnchor=function(chart){return function(d,i,n){var xScale=chart.getTrainedScale("x"),xRange=dv.util.scaleRange(xScale),insetWidth=20;var labelXPos=xScale.mapValue(d)+xScale.rangeBand()/2;if(labelXPos-xRange[0]<insetWidth){return"start"}if(xRange[1]-labelXPos<insetWidth){return"end"}return"middle"}};dvcore._checkNormalized=function(){var chart=this._chart,l10n=this._dataAdapter.l10n;if(this._isNormalized&&this._isNormalized()){chart.guide("y","none",1);chart.guide("y",dv.guide.axis().ticks(0).tickFormat(function(d,i){return""}).title(l10n.labels.core.normalized));chart.padding({})}};dvcore._formatTime=function(date,template,gran){var l10n=this._dataAdapter.l10n.calendar;var formatters={a:function(d){return l10n.weekdayAbbreviations[d.getDay()]},A:function(d){return l10n.weekdays[d.getDay()]},b:function(d){return l10n.monthAbbreviations[d.getMonth()]},B:function(d){return l10n.months[d.getMonth()]},p:function(d){return l10n.ampm[Math.floor(d.getHours()/12)]}};var string="",i=-1,j=0,n=template.length;var addSkipped=function(){var skipped=template.substring(j,i);if(skipped.length){string+=d3.time.format(skipped)(date)}};while(++i<n){if(template.charCodeAt(i)==37){var token=template.charAt(i+1);var tokenFormatter=formatters[token];if(tokenFormatter){addSkipped();string+=tokenFormatter(date);i++;j=i+1}}}addSkipped();var locale=this._options.locale.toLowerCase();if(("hour"===gran||"minute"===gran||"second"===gran)&&"en-us"===locale&&0===string.indexOf("0")){string=string.slice(1)}return string};dvcore._timeGranTemplate=function(gran,format){var t;switch(gran){case"second":t=format.second;break;case"minute":t=format.minute;break;case"hour":t=format.hour;break;case"day":t=format.day;break;case"week":t=format.week;break;case"month":t=format.month;break;case"quarter":t=format.quarter;break;case"year":t=format.year;break;default:t=format.fallback;break}return t};dvcore._timeSmallXFormat=function(){var self=this,adapter=self._dataAdapter,format=adapter.l10n.dateFormat.fullFormat,gran=adapter?adapter.dateGranularity():"*",template=format.condensed;if("hour"===gran||"minute"===gran||"second"===gran){template=format.timestamp}return function(d,i){return self._formatTime(d,template)}};dvcore._timeXTickFormat=function(validTickFunc){var self=this,options=self._options,chart=this._chart,adapter=self._dataAdapter,prevTick=new Date(0),prevGranLabel="",prevSwitchLabel="",date=adapter.l10n.dateFormat,switchFormat=date.mediumFormat,gran=adapter?adapter.dateGranularity():"*",granTemplate=this._timeGranTemplate(gran,date.shortFormat);return function(d,i){var template,granLabel,switchLabel,label;d=new Date(d);if(0===i){prevTick=new Date(0);prevGranLabel=null;prevSwitchLabel=null}if(validTickFunc&&!validTickFunc.call(this,d,i)){return""}if("second"===gran&&(i===0||prevTick.getMinutes()!==d.getMinutes())){template=switchFormat.minute}if("hour"===gran&&(i===0||prevTick.getDate()!==d.getDate())){template=switchFormat.day}if(("day"===gran||"week"===gran)&&(i===0||prevTick.getMonth()!==d.getMonth())){template=switchFormat.month}if(("month"===gran||"quarter"===gran)&&(i===0||prevTick.getYear()!==d.getYear())){template=switchFormat.year}granLabel=self._formatTime(d,granTemplate,gran);if("minute"===gran&&prevTick.getHours()!==d.getHours()){granLabel=self._formatTime(d,self._timeGranTemplate("minute",date.mediumFormat),gran)}prevTick=d;if(template){switchLabel=self._formatTime(d,template);var prefix=options.flip?" ":"<br/>";switchLabel=prefix.concat(switchLabel)}else if(!options.flip){switchLabel="<br/>&nbsp;"}if(granLabel===prevGranLabel&&(switchLabel===prevSwitchLabel||!template)){label=""}else{label=switchLabel?granLabel+switchLabel:granLabel}prevGranLabel=granLabel;prevSwitchLabel=switchLabel;return label}};global.cloudViz.dvcore=dvcore})(this);(function(global){"use strict";var enabled,handlers=[];var debounce=function(fn,timeout){var timeoutID=-1;return function(){if(timeoutID>-1){window.clearTimeout(timeoutID)}timeoutID=window.setTimeout(fn,timeout)}};var debouncedHandler=debounce(function(){handlers.forEach(function(handler){handler()})},30);var addHandler=function(handler){if(handlers.indexOf(handler)==-1){handlers.push(handler)}if(!enabled){window.addEventListener("resize",debouncedHandler);enabled=true}};var removeHandler=function(handler){var index=handlers.indexOf(handler);if(index>-1){handlers.splice(index,1)}if(handlers.length===0&&enabled){window.removeEventListener("resize",debouncedHandler);enabled=false}};global.cloudViz.windowResize={addHandler:addHandler,removeHandler:removeHandler}})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},dvcore=cloudViz.dvcore||{},dv=global.dv||{},d3=global.d3||{},line=Object.create(dvcore),timeoutId=-1;line.init=function(options){Object.getPrototypeOf(line).init.apply(this,arguments);this._type="line";this._chart=dv.chart();this._displayPoints=null;this._adjustClipHeight=6;this._adjustClipWidth=6;this._minTrendTickSpace=135;this._showRibbons=false;this._uniqueGroups=null;return this};line._initDefaultOptions=function(){var defaults={normalized:false,filled:false,position:"identity",forceZero:null,dualYAxis:false,showAnomalies:false,lines:null,pointTooltipContent:null,pointShouldShowTooltip:null,islinePoint:null,shouldDisplayPoint:null,mappings:{upperRangeBand:"upper",lowerRangeBand:"lower",forecast:"forecast"},formats:{x:"decimal",y:"decimal"},scales:{x:"default",y:"default"},enableSelection:false,onYAxisClick:null};return Object.getPrototypeOf(line)._initDefaultOptions.call(this,defaults)};line.reset=function(){Object.getPrototypeOf(line).reset.apply(this,arguments);var options=this._options;var d3Parent=d3.select(options.parent);d3Parent.selectAll(".behavior").text("");d3Parent.selectAll(".behavior-under-geom").text("");this._chart.on("mousemove.inspector",null);this._chart.on("mouseout.inspector",null);d3Parent.selectAll(".axis-y.axis-index-1").remove()};line._addStatLines=function(){var chart=this._chart,options=this._options,data=chart._data,yvals=data[this._getPropMapping("y")].slice(),hlineData={xstart:[],xend:[],y:[],name:[]},lineOpts=options.lines,l10n=this._dataAdapter.l10n.labels.bar,mean=0,median=0,tot=0,len=yvals.length,i;if(!lineOpts||lineOpts.length===0){return}if(lineOpts["max"]=="chart"){hlineData.y.push(Math.max.apply(null,yvals));hlineData.name.push(l10n["max"])}if(lineOpts["min"]=="chart"){hlineData.y.push(Math.min.apply(null,yvals));hlineData.name.push(l10n["min"])}if(lineOpts["mean"]=="chart"){for(i=0;i<len;i++){tot+=yvals[i]}mean=tot/len;hlineData.y.push(mean);hlineData.name.push(l10n["mean"])}if(lineOpts["median"]=="chart"){yvals.sort();if(len%2===0){median=(yvals[len/2]+yvals[len/2-1])/2;hlineData.y.push(median)}else{hlineData.y.push(yvals[Math.floor(len/2)])}hlineData.name.push(l10n["median"])}var hline=dv.geom.hline().data(hlineData).set("alpha",.3).set("stroke",function(d,i){return"#222222"});this._addGeomBehaviors(hline,options);if(this.labelData){this.labelData.y.push.apply(this.labelData.y,hlineData.y);this.labelData.name.push.apply(this.labelData.name,hlineData.name)}else{this.labelData=Object.create(hlineData);this.labelData.y=hlineData.y.slice();this.labelData.name=hlineData.name.slice()}chart.layers().push(hline)};line._createTargetHLines=function(){var options=this._options;if(options.targetValues&&options.targetValues.length){var hlineData=Object.getPrototypeOf(line)._createTargetHLines.apply(this,arguments);var chart=this._chart;this._addGeomBehaviors(chart._layers[0],options);if(this.labelData){this.labelData.y.push.apply(this.labelData.y,hlineData.y);this.labelData.name.push.apply(this.labelData.name,hlineData.name)}else{this.labelData=Object.create(hlineData);this.labelData.y=hlineData.y.slice();this.labelData.name=hlineData.name.slice()}}};line._setChartTypeOptions=function(){var chart=this._chart,options=this._options,adapter=this._dataAdapter,self=this,layers=[dv.geom.line().each("start",function(d,i){d3.select(this).attr("legend-group",d[0]["stroke"])}).map("stroke",this._getPropMapping("series"),dv.scale.color().values(options.colors))];this._uniqueGroups=dv.util.uniq(chart.data()[this._getPropMapping("series")]);this._showRibbons=this._uniqueGroups.length==1&&this._isMappedAndExistsInData("upperRangeBand")&&this._isMappedAndExistsInData("lowerRangeBand");if(this._showRibbons){layers.unshift(dv.geom.ribbon().map("yMin",this._getPropMapping("lowerRangeBand")).map("yMax",this._getPropMapping("upperRangeBand")).set("alpha",.15).interpolate("cardinal"));options.filled=false}if(this._showRibbons&&this._isMappedAndExistsInData("forecast")){layers.push(dv.geom.line().map("y",this._getPropMapping("forecast")).set("alpha",.5).set("linetype","dotted").interpolate("cardinal"))}if(options.filled){layers.push(dv.geom.area().baseline(undefined).each("start",function(d,i){d3.select(this).attr("legend-group",d[0]["fill"])}).map("fill",this._getPropMapping("series"),dv.scale.color().values(options.colors)).set("alpha",.2))}var pointGeom=dv.geom.point().map("stroke",this._getPropMapping("series"),dv.scale.color().values(options.colors)).set("fill","#fff").set("size",7);layers.push(pointGeom);var groupMapping=this._getPropMapping("group")||this._getPropMapping("series");chart.layers(layers).guide("stroke",this._legend).map("group",groupMapping).set("linetype",function(d,i,j){return/::incomplete::$/.test(d.data[groupMapping])?"0,4,7,0":"solid"}).position(options.position);pointGeom.each("start",function(d,i){d3.select(this).classed("point-hidden",!self._shouldDisplayPoint.call(self,d)).attr("legend-group",d["stroke"]).classed("line-point",self._options.islinePoint?self._options.islinePoint.call(self,d):true).on("contextmenu",dvcore.makeContextMenuHandler(self))});this._addBehaviors(chart,layers.length-1,options);var enabledSeriesIndexes=this._getEnabledSeriesIndexes();pointGeom.behaviors([dv.behavior.voronoiRollover().orientation("top").pointDetectionRadius(7).shouldShowTooltip(function(d,i,j){if(options.pointShouldShowTooltip){return options.pointShouldShowTooltip.call(this,d,i,j)}return enabledSeriesIndexes.indexOf(j)>-1}).content(function(d,i,j){var seriesGroup=this.__geom.getExplicitScale("group"),valueFormat=self._yLabelFormat(j),gran=adapter.dateGranularity(),format=adapter.l10n.dateFormat.fullFormat,xLabel=adapter.isOvertime()?self._formatTime(new Date(d.x),self._timeGranTemplate(gran,format),gran):d.x,metricValue=line.escapeHtml(valueFormat(d.y,null,{dataItem:d})),metricName=line.escapeHtml(d.data[self._getPropMapping("seriesLabel")]),seriesName=seriesGroup&&seriesGroup.mapping()?line.escapeHtml(xLabel):"";var formatted={metricValue:metricValue,metricName:metricName,seriesName:seriesName};if(options.pointTooltipContent){return options.pointTooltipContent.call(this,d,i,j,formatted)}var content='<span class="metric-value">'+metricValue+'</span><span class="metric-name">'+metricName+"</span>";if(seriesName){content='<span class="series-name">'+seriesName+"</span>"+content}return content})]);this._mapPositionScales(chart,options)};line._getEnabledSeriesIndexes=function(){var seriesObjects=this._seriesState.getStateObjects()||[];var enabledSeriesIndexes=[];seriesObjects.forEach(function(seriesObject,seriesIndex){if(seriesObject.enabled===true){enabledSeriesIndexes.push(seriesIndex)}});return enabledSeriesIndexes};line._shouldDisplayPoint=function(d){var shouldShow;if(this._showRibbons){shouldShow=this._isAnomalousDataPoint(d)}if(typeof this._options.shouldDisplayPoint==="function"){shouldShow=this._options.shouldDisplayPoint.call(this,d)}if(shouldShow===undefined){shouldShow=this._shouldDisplayPoints()}return shouldShow};line._shouldDisplayPoints=function(){if(this._displayPoints!==null){return this._displayPoints}var options=this._options,chart=this._chart,array=chart.layers()[1]._nestData,max=Math.max.apply(null,array.map(function(d){return d.values.length})),range=chart.getTrainedScale("x").range();return this._displayPoints=options.showAnomalies&&this._showRibbons||(range[1]-range[0])/max>=60};line._isAnomalousDataPoint=function(d){return d.data[this._getPropMapping("y")]>d.data[this._getPropMapping("upperRangeBand")]||d.data[this._getPropMapping("y")]<d.data[this._getPropMapping("lowerRangeBand")]};line._hLineToolTip=function(d,i,j){return'<span class="metric-value">'+line.escapeHtml(d[0].data.name)+'</span><span class="metric-name">'+line.escapeHtml(d[0].data.y)+"</span>"};line._addGeomBehaviors=function(geom,options){var d3Parent=d3.select(options.parent),timer,adapter=this._dataAdapter,self=this;if(!this._isSmallChart()&&options.interactive){geom.behaviors([dv.behavior.rollover().orientation("top").content(function(d,i,j){if(!("data"in d)){return self._hLineToolTip(d,i,j)}return""}).showTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._showTip.call(this,d,i,j,behavior);clearTimeout(timer);d3Parent.selectAll(".bar-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(pointD){return d!==pointD});d3Parent.selectAll(".cv-legend-marker").classed("cv-unselected",function(legendD){return legendD.id!==d.fill}).classed("cv-medium-duration",false);self._dispatch.mouseover.call(this,d,i,j,ev)}}).hideTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._removeTip.call(this,d,i,j,behavior);timer=setTimeout(function(){d3Parent.selectAll(".bar-geom, .cv-legend-marker").classed("cv-unselected",false).classed("cv-medium-duration",true);self._dispatch.mouseout.call(this,d,i,j,ev)},400)}})])}};line._addBehaviors=function(chart,selectLayer,options){var self=this,d3Parent=d3.select(options.parent),adapter=this._dataAdapter,xFormat=adapter.formats().x;if(options.interactive){var behaviors=[dv.behavior.identified()];if(this._options.enableSelection){var selectionBehavior=dv.behavior.selection().on("selectionChanged",function(all,added,removed){var highlights=self._highlightedOverlay.updateSelectedDisplay(all);highlights.style("visibility","visible");self._onSelectionChanged(this,all,added,removed,selectLayer)});this.selectionCache(selectionBehavior._selectionCache);behaviors.push(selectionBehavior)}chart._layers[selectLayer].behaviors(behaviors);chart.behaviors([dv.behavior.inspector().gutterPadding(0).orientation("bottom").thickness(2).label(function(d){if(adapter.isOvertime()){var gran=adapter.dateGranularity(),format=adapter.l10n.dateFormat.fullFormat;return self._formatTime(d,self._timeGranTemplate(gran,format),gran)}return self._formatNumber(xFormat,d,options.precision,{prop:"x",dataItem:d})}).inspectorMove(function(lbl,index,xPos,val){var colorScale=chart.getTrainedScale("stroke")[0];self._highlightHoveredPoints.call(self,d3Parent,val,colorScale);dv.setVisibilityWaning(d3Parent.selectAll(".axis-x .axis-label"));dv.setVisibilityWaning(d3Parent.selectAll(".axis-x-title"));dv.setVisibilityWaning(d3Parent.selectAll(".text-geom"));self._dispatch.mouseover.call(this,lbl,index,xPos,val,d3.event)}).inspectorOut(function(){var colorScale=chart.getTrainedScale("stroke")[0];self._highlightHoveredPoints.call(self,d3Parent,null,colorScale);dv.setVisibilityForeground(d3Parent.selectAll(".axis-x .axis-label"));dv.setVisibilityForeground(d3Parent.selectAll(".axis-x-title"));dv.setVisibilityForeground(d3Parent.selectAll(".text-geom"));self._dispatch.mouseout.call(this,d3.event)}).underGeoms(true)])}};line._highlightHoveredPoints=function(parent,xPoint,colorScale){var legendValues={},self=this,seriesNames=colorScale.domain(),opts=this._options,stateObjects=self._seriesState.getVisibleStateObjects();parent.selectAll(".line-point").each(function(d){var d3Element=d3.select(this),color=colorScale.mapValue(d.stroke),isSelected=self._dataValuesEqual.call(self,d.x,xPoint),datum=d3Element.datum();d3Element.classed("point-hidden",isSelected?false:!self._shouldDisplayPoint.call(self,d));d3Element.style("fill",isSelected?color:"#FFF").style("opacity",isSelected?1:"");if(isSelected){var seriesId=d3Element.datum().data[self._getPropMapping("series")];legendValues[seriesId]={yVal:datum.y,scaleIndex:seriesNames.indexOf(d.stroke||d.group)}}});parent.selectAll(".cv-legend-entry").each(function(d){var key=d.id,valueObj=legendValues[key],num=d3.select(this).select(".cv-legend-num");if(!valueObj||!d.enabled){return num.text("")}var format=self._getYFormatType(valueObj.scaleIndex),value=valueObj.yVal,text;if("time"===format){var l10n=self._dataAdapter.l10n,timeGran=self._yTimeGranularity(self._dataAdapter.getUniqueStrokeExtentByStroke(key),dv.guide.axis().ticks()()),time=l10n.time.plural[timeGran.gran],pattern=l10n.labels.dvcore.legendTime;if(timeGran&&timeGran.divisor>0){value=value/timeGran.divisor}text=pattern.replace(/\{time\}/i,time).replace(/\{value\}/i,self._formatLegendValue(value,format,opts.precision,{seriesIndex:valueObj.scaleIndex,dataItem:d}))}else{text=self._formatLegendValue(value,format,opts.precision,{seriesIndex:valueObj.scaleIndex,dataItem:d})}num.text(text)})};line._dataValuesEqual=function(a,b){if(!a||!b){return false}if(this._dataAdapter.isOvertime()&&a.getTime()===b.getTime()){return true}return a===b};line._mapPositionScales=function(chart,options){var rangePadding=[0,this._isSmallChart()?24:6],scale=this._constructScale("y").rangePadding(rangePadding),strokeMapping=this._getPropMapping("series"),yMapping=this._getPropMapping("y"),xMapping=this._getPropMapping("x"),self=this;if(self._dataAdapter._forceZero===null&&options.filled){self._dataAdapter._forceZero=true;this._applyForceZero(scale)}if(options.normalized||options.dualYAxis&&(options.position==="identity"||options.position==="dodge")){var uniqueGroups=self._dataAdapter.uniqueStrokeValues();uniqueGroups.forEach(function(g,index){var strokeScale=0===index?scale:scale.copy();strokeScale.includeInDomain(function(d,i){return d.data[strokeMapping]===self._dataAdapter.uniqueStrokeValues()[index]});if(index>0){chart.map("y",yMapping,strokeScale,index)}})}else{var yScales=chart.getExplicitScalesMap().y;var i=1;while(!!yScales&&!!yScales[i]){delete yScales[i];i++}}var xScale=this._dataAdapter.isOvertime()?dv.scale.time():options.scales.x==="log"?dv.scale.log():dv.scale.linear();xScale.rangePadding([10,10]);chart.map("y",yMapping,scale,0);chart.map("x",xMapping,this._constructScale("x",xScale))};line._xTickFormat=function(){var self=this,adapter=this._dataAdapter,opts=this._options,format=adapter.formats().x;return function(d,i){return self._formatNumber(format,d,opts.precision,{prop:"x",dataItem:d})}};line._drawSmall=function(){var options=this._options,chart=this._chart,self=this,yExtent=this._computeExtents(),dateExtent=d3.extent(this._getEnabledValues("x")),yFormat=this._getYFormatType(0),yLabelFormat=function(d,i,j){return d?self._formatNumber(yFormat,d,options.precision,{prop:"y",seriesIndex:j,dataItem:d}):"0"},xAxis=dv.guide.axis().tickSize(0).title(this._dataAdapter.xAxisTitle()).tickDy(yExtent.y.length>1?-26:-14).tickAnchor(function(d,i){return i>0?"end":"start"}),yAxis=dv.guide.axis().ticks(2).title(this._dataAdapter.yAxisTitle()),showFullAxis=options.dualYAxis||options.position==="stack"&&this._uniqueGroups.length>1,xScale,yScale,uniqueGroups=this._uniqueGroups;xScale=this._dataAdapter.isOvertime()?dv.scale.time():options.scales.x==="log"?dv.scale.log():dv.scale.linear();yScale=options.scales.y==="log"?dv.scale.log():dv.scale.linear();if(!showFullAxis){var layers=[dv.geom.point().data(yExtent).set("stroke","none").map("y","y",yScale).map("x","x",xScale).each("start",function(d,i){var colorScale=d.panel.getTrainedScale("fill")[0],el=d3.select(this);el.style("fill",colorScale.mapValue(d.data.fill)).attr("legend-group",d.data.fill)}).map("group","fill").set("size",6),dv.geom.text().data(yExtent).set("stroke","none").map("y","y",yScale).map("x","x",xScale).each("start",function(d,i){var colorScale=d.panel.getTrainedScale("fill")[0],el=d3.select(this);el.style("fill",colorScale.mapValue(d.data.fill)).attr("legend-group",d.data.fill);if(this.parentNode){d3.select(this.parentNode.parentNode).classed("no-clip",true).attr("clip-path",null)}}).map("group","fill").set("size","11px").set("label",function(d,i){var seriesIndex=Math.max(uniqueGroups.indexOf(d.group),0);var lbl=self._yTickFormat(seriesIndex,null,true)(d.y,i,d.panel);if("time"===yFormat){var time=self._yTimeGranularity(self._getEnabledValues("y"),dv.guide.axis().ticks()());lbl+=" "+self._dataAdapter.l10n.time.plural[time.gran]}return lbl}).textAnchor(function(d,i){return d.data&&d.data.anchor||"middle"}).dy(function(d,i){return yExtent.y.length===1||d.y===yExtent.y[1]?-8:15}).dx(function(d,i){return d.data&&d.data.anchor=="end"?3:0})];chart.layers(chart.layers().concat(layers))}chart.map("fill",this._getPropMapping("series"),dv.scale.color().values(options.colors));if(this._dataAdapter.isOvertime()){xAxis.tickValues(dateExtent).tickFormat(self._timeSmallXFormat());if(showFullAxis){yAxis.tickFormat(this._yTickFormat(0))}else{yAxis.tickFormat(function(){return""})}}else{if(options.dualYAxis){var yAxis2=dv.guide.axis().tickFormat(this._yTickFormat(1)).orientation("right").tickSize(this._tickSize("y")).tickDy(-8).tickAnchor("end").tickDx(4).ticks(3);yAxis.tickSize(this._tickSize("y")).tickDy(-8).tickAnchor("start").tickDx(4).ticks(3);chart.guide("y",yAxis2,1)}else{var xExtent=d3.extent(this._dataAdapter.data()[this._getPropMapping("x")]);xAxis.tickValues(xExtent).tickFormat(this._xTickFormat());yAxis.tickFormat(this._yTickFormat(0));chart.guide("y","none",1)}}chart.guide("x",xAxis).guide("y",yAxis);this._checkNormalized()};line._numXTicks=function(){var self=this;if(this._dataAdapter.isOvertime()){var points=this._chart._data[this._getPropMapping("x")].length;return function(range){var ticks=0;var size=Math.max(range/points,self._minTrendTickSpace);return Math.max(Math.min(Math.floor(range/size),points),2)}}return Object.getPrototypeOf(line)._numXTicks.call(this)};line._drawLarge=function(){var options=this._options,chart=this._chart,d3Parent=d3.select(options.parent),useSecondAxisLabelForArrow=false,uniqueStrokeExtent0=this._dataAdapter.getUniqueStrokeExtent(0),uniqueStrokeExtent1=this._dataAdapter.getUniqueStrokeExtent(1),yTickFormatFunc,xAxis=dv.guide.axis().ticks(this._numXTicks()).title(this._dataAdapter.xAxisTitle()).tickSize(this._tickSize("x")).tickDy(-8).tickAnchor(this._xTickAnchor(chart)),yAxis=dv.guide.axis().htmlLabels(true);if(this._dataAdapter.isOvertime()){xAxis.tickFormat(this._timeXTickFormat()).htmlLabels(true)}else{xAxis.tickFormat(this._xTickFormat())}if(options.dualYAxis&&(options.position==="identity"||options.position==="dodge")){yTickFormatFunc=this._yTickFormat(0,uniqueStrokeExtent0);yAxis.title(this._yTitleFormat(0,uniqueStrokeExtent0));var yAxis2=dv.guide.axis().tickFormat(this._yTickFormat(1,uniqueStrokeExtent1)).title(this._yTitleFormat(1,uniqueStrokeExtent1)).orientation("right").tickSize(this._tickSize("y"));yAxis.tickSize(this._tickSize("y"));chart.guide("y",yAxis2,1)}else{yTickFormatFunc=this._yTickFormat(0);yAxis.title(this._yTitleFormat(0));yAxis.tickSize(this._tickSize("y"));chart.guide("y","none",1)}yAxis.tickFormat(yTickFormatFunc);chart.guide("x",xAxis).guide("y",yAxis);this._checkNormalized();this._addStatLines()};line._preRender=function(){Object.getPrototypeOf(line)._preRender.call(this);this._displayPoints=null};line._computeExtents=function(){var i=-1,options=this._options,yTuple=this._getEnabledValues("y"),xTuple=this._getEnabledValues("x"),strokeTuple=this._getEnabledValues("series"),n=yTuple.length,extent={x:[undefined,undefined],y:[undefined,undefined],fill:[undefined,undefined],anchor:[undefined,undefined]},xLowerLimit=null,xUpperLimit=null;xTuple.forEach(function(v,i){xLowerLimit=xLowerLimit===null||xLowerLimit>v?v:xLowerLimit;xUpperLimit=xUpperLimit===null||xUpperLimit<v?v:xUpperLimit});while(++i<n){var yVal=yTuple[i],xVal=xTuple[i],color=strokeTuple?strokeTuple[i]:options.colors[0];if(extent.y[0]===undefined||yVal<extent.y[0]){extent.y[0]=yVal;extent.x[0]=xVal;extent.fill[0]=color;extent.anchor[0]=+xVal==+xLowerLimit?"start":+xVal==+xUpperLimit?"end":"middle"}if(extent.y[1]===undefined||yVal>extent.y[1]){extent.y[1]=yVal;extent.x[1]=xVal;extent.fill[1]=color;extent.anchor[1]=+xVal==+xLowerLimit?"start":+xVal==+xUpperLimit?"end":"middle"}}if(extent.y[0]===0){extent.y.splice(0,1);extent.x.splice(0,1);extent.fill.splice(0,1);extent.anchor.splice(0,1)}return extent};line._isNormalized=function(){var options=this._options,tooManySeries=this._isSmallChart()?1:2;return options.normalized||options.dualYAxis&&this._dataAdapter.uniqueStrokeValues().length>tooManySeries&&(options.position==="identity"||options.position==="dodge")};line.lineWithinBounds=function(top,bottom,ignore){var labelData=this.labelData,len=labelData.y.length,i,chart=this._chart,yScale=chart.getTrainedScale("y");for(i=0;i<len;i++){var yval=yScale.mapValue(labelData.y[i]);if(i!=ignore&&yval>=top&&yval<=bottom){return i}}return-1};line._postRender=function(){Object.getPrototypeOf(line)._postRender.apply(this,arguments);this._changedOptions={};var highlightContainer=d3.select(this._chart.parent());highlightContainer=highlightContainer.selectAll(".behavior");this._highlightedOverlay.setUpSelectedOverlay(highlightContainer);var selectionCache=this.selectionCache();if(selectionCache){selectionCache.setDeselector(d3.select(this._chart.parent()).select("rect.interaction-canvas"))}if(!this.labelData){return}var labelData=this.labelData,chart=this._chart,options=this._options,xScale=chart.getTrainedScale("x"),yScale=chart.getTrainedScale("y"),svgPlot=d3.select(chart.parent()).select(".plot"),bounds=chart._facet.getPanel(0).bounds(),textOffset=[],len=labelData.y.length,i;var leftAxis=d3.select(chart.parent()).select(".axis-index-0"),leftOffset=Number(leftAxis.style("left").slice(0,-2));var textWidth=[],textHeight=[];svgPlot.append("g").selectAll(".dummyText").data(labelData.name).enter().append("text").classed("data-label",true).text(function(d){return d}).each(function(d,i){var thisWidth=this.getComputedTextLength();textWidth.push(thisWidth)}).remove();for(i=0;i<len;i++){var ypos=yScale.mapValue(labelData.y[i]);if(this.lineWithinBounds(ypos-15,ypos,i)==-1&&ypos>=12){textOffset.push(-2)}else if(this.lineWithinBounds(ypos,ypos+15,i)==-1||ypos<12){textOffset.push(11)}else{textOffset.push(-2);labelData.name[i]=""}}var labels=svgPlot.selectAll(".data-label").data(labelData.name);labels.enter().append("text").classed("data-label",true).text(function(d){return d}).attr("x",bounds.top).attr("y",yScale.range()[0]);labels.transition().duration(0).attr("x",function(d,i){return leftOffset+(labelData.xstart&&labelData.xstart[i]?labelData.xstart[i]*bounds.width:0)}).attr("y",function(d,i){return yScale.mapValue(labelData.y[i])+textOffset[i]});labels.exit().transition().duration(0).attr("y",yScale.range()[0]).remove()};global.cloudViz.line=cloudViz.util.createConstructor(line)})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},dvcore=cloudViz.dvcore||{},dv=global.dv||{},d3=global.d3||{},point=Object.create(dvcore);point.init=function(options){Object.getPrototypeOf(point).init.apply(this,arguments);this._type="point";this._chart=dv.chart();this._inputFilter=cloudViz.util.inputFilter(".brush-interaction-group","",".plot");return this};point.getSelected=function(){return this.selectionCache.currentSelection()};point.setSelected=function(selectorFn){var self=this,selectedPoints=[],selected=d3.select(this._options.parent).selectAll(".point-geom").filter(selectorFn);selected.each(function(point){selectedPoints.push(point)});self.selectionCache().selectionSet(d3.selectAll(selectedPoints));return self};point._initDefaultOptions=function(){var defaults={mappings:{size:"size"},sizeTitle:"",formats:{x:"decimal",y:"decimal",size:"decimal"},scales:{x:"default",y:"default"},domains:{x:null,y:null},forceZero:null,onYAxisClick:null,position:"identity",selectionEnabled:false,selectPolicyCB:function(){return{start:null,end:null,move:null}},tooltipContent:null,customEvents:["selectionStart","selectionEnd"],enableSelection:false};return Object.getPrototypeOf(point)._initDefaultOptions.call(this,defaults)};point._setChartTypeOptions=function(){var chart=this._chart,options=this._options,layers=[],self=this;layers[0]=dv.geom.point().each("start",function(d,i){d3.select(this).attr("legend-group",d["fill"])});chart.layers(layers).map("x",this._getPropMapping("x"),this._constructScale("x").rangePadding([this._isSmallChart()?10:20,this._isSmallChart()?10:20])).map("y",this._getPropMapping("y"),this._constructScale("y").rangePadding([this._isSmallChart()?10:20,this._isSmallChart()?10:20])).map("fill",this._getPropMapping("series"),dv.scale.color().values(options.colors)).guide("fill",this._legend).padding({left:10});if(this._dataAdapter.isBubble()){layers[0].map("size",this._getPropMapping("size"),dv.scale.linear().to([9,60]))}else{layers[0].set("size",10).set("alpha",.6)}if(options.selectionEnabled){chart.postrender(function(val){self._inputFilter.setUpBrush(d3.selectAll(".behavior-under-geom"),self.selectionCache(),null);self._inputFilter.setUpBrushOverlay(d3.selectAll(".behavior"));self._inputFilter.interceptBrushEvents()})}this._addBehaviors(chart,layers[0],options);this._mapPositionScales(chart,options)};point._mapPositionScales=function(chart,options){var rangePadding=[0,this._isSmallChart()?24:6],scale=this._constructScale("y").rangePadding(rangePadding),yMapping=this._getPropMapping("y"),self=this;if(self._dataAdapter._forceZero===null&&options.filled){self._dataAdapter._forceZero=true;this._applyForceZero(scale)}chart.map("y",yMapping,scale,0)};point._addBehaviors=function(chart,geom,options){var d3Parent=d3.select(options.parent),timer,self=this,yFormat=this._getYFormatType(),sizeFormat=this._getSizeFormatType(),addMetricValue=function(d,scale,format,title){if(!d.data.hasOwnProperty(scale.mapping())){return""}return'<span class="metric-value">'+point.escapeHtml(format(d.data[scale.mapping()]))+'</span><span class="metric-name">'+point.escapeHtml(title)+"</span>"};chart.behaviors([]);if(!this._isSmallChart()&&options.interactive){var voronoiRollover=dv.behavior.voronoiRollover().pointDetectionRadius(25).content(function(d,i,j){if(options.tooltipContent){return options.tooltipContent.call(this,d,i,j)}var seriesGroup=this.__geom.getExplicitScale("group"),x=d.panel.xScale(d),y=d.panel.yScale(d),xGuide=this._xGuides[x.scaleIndex()],yGuide=this._yGuides[y.scaleIndex()],l10n=self._dataAdapter.l10n,xTickFormat=xGuide.__scale&&xGuide.tickFormat()?xGuide.tickFormat():String,yTickFormat=function(d){return self._formatNumber(yFormat,d,options.precision,{prop:"y",seriesIndex:x.scaleIndex(),dataItem:d})},sizeFormatter=function(d){return self._formatNumber(sizeFormat,d,options.precision,{prop:"size",dataItem:d})},content=addMetricValue(d,y,yTickFormat,self._dataAdapter.yAxisTitle()||l10n.labels.point.yScale)+addMetricValue(d,x,xTickFormat,self._dataAdapter.xAxisTitle()||l10n.labels.point.xScale);if(self._dataAdapter.isBubble()){var size=d.panel.getTrainedScale("size")[0];content+=addMetricValue(d,size,sizeFormatter,self._dataAdapter.sizeMetricName()||l10n.labels.point.sizeScale)}if(seriesGroup&&seriesGroup.mapping()){content='<span class="series-name">'+point.escapeHtml(d.data[self._getPropMapping("seriesLabel")||seriesGroup.mapping()])+"</span>"+content}return content}).mouseOver(function(d,i,j,ev){clearTimeout(timer);d3Parent.selectAll(".point-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(pointD){return d!==pointD});d3Parent.selectAll(".cv-legend-marker").classed("cv-unselected",function(legendD){return legendD.id!==d.fill}).classed("cv-medium-duration",false);self._dispatch.mouseover.call(this,d,i,j,ev)}).contextMenu(function(d,i,j,ev){self._dispatch.contextmenu.call(this,d,i,j,ev)}).mouseOut(function(d,i,j,ev){timer=setTimeout(function(){d3Parent.selectAll(".point-geom, .cv-legend-marker").classed("cv-unselected",false).classed("cv-medium-duration",true);self._dispatch.mouseout.call(this,d,i,j,ev)},400)});var behaviors=[dv.behavior.identified(),voronoiRollover];if(this._options.enableSelection){var selectionBehavior=dv.behavior.selection().on("selectionChanged",function(all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all);self._onSelectionChanged(this,all,added,removed,0)}).elementFinder(function(d,i){var data=d.data;if(!data){return this}var geom=voronoiRollover.getGeomFromVoronoiIndex(data.rawData,data.index,data.seriesIndex);if(!geom.empty()){return geom[0][0]}return this});this.selectionCache(selectionBehavior._selectionCache);behaviors.push(selectionBehavior)}geom.behaviors(behaviors)}};point._getSizeFormatType=function(){var formats=this._dataAdapter.formats()||{};return formats.size||"decimal"};point._drawSmall=function(){var chart=this._chart,xExtent=d3.extent(this._getEnabledValues("x")),self=this,adapter=this._dataAdapter,opts=this._options,xFormat=adapter.formats().x,yFormat=this._getYFormatType();chart.guide("x",dv.guide.axis().tickSize(0).tickValues(xExtent).title(this._dataAdapter.xAxisTitle()).tickFormat(function(d,i,panel){return self._formatNumber(xFormat,d,opts.precision,{prop:"x",seriesIndex:!!panel?panel._trainedScales.x[0].scaleIndex():null,dataItem:d})}).tickAnchor(function(d,i){return i>0?"end":"start"}).domain(opts.domains.x)).guide("y",dv.guide.axis().ticks(2).title(this._dataAdapter.yAxisTitle()).tickFormat(this._yTickFormat(0)).domain(opts.domains.y))};point._drawLarge=function(){var chart=this._chart,numYTicks=function(range){return Math.max(2,Math.min(5,range/70))},self=this,adapter=this._dataAdapter,opts=this._options,xFormat=adapter.formats().x,yFormat=this._getYFormatType();chart.guide("x",dv.guide.axis().ticks(this._numXTicks()).title(this._dataAdapter.xAxisTitle()).tickFormat(function(d,i,panel){return self._formatNumber(xFormat,d,opts.precision,{prop:"x",seriesIndex:!!panel?panel._trainedScales.x[0].scaleIndex():null,dataItem:d})}).domain(opts.domains.x)).guide("y",dv.guide.axis().ticks(numYTicks).tickSize(this._tickSize("y")).title(this._dataAdapter.yAxisTitle()).tickFormat(this._yTickFormat(0)).domain(opts.domains.y))};point._postRender=function(){Object.getPrototypeOf(point)._postRender.call(this);var options=this._options,chart=this._chart,rightPadding=5,container=d3.select(options.parent).select(".cv-wrapper"),label=container.selectAll(".cv-bubble-size-metric").data([0]);if(this._dataAdapter.sizeMetricName()){label.enter().append("div").classed("cv-bubble-size-metric",true).html("<span>"+point.escapeHtml(this._dataAdapter.sizeMetricName())+"</span>  <i></i> &ndash; <i></i>");setTimeout(function(){var padding=chart.padding(),lastPanelBounds=chart.facet().getPanel(chart.facet()._panels.length-1).bounds(),plotBounds=chart.plotBounds(),span=label.selectAll("span"),width=plotBounds.right+padding.right,height=lastPanelBounds.top+lastPanelBounds.height,node=label.node(),x,y;if(node){x=width-node.offsetWidth-rightPadding,y=height-node.offsetHeight;label.style("top",y+"px").style("left",x+"px")}},300)}else{label.remove()}};global.cloudViz.point=cloudViz.util.createConstructor(point)})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},dvcore=cloudViz.dvcore||{},dv=global.dv||{},d3=global.d3||{},bar=Object.create(dvcore);bar.init=function(options){Object.getPrototypeOf(bar).init.apply(this,arguments);this._type="bar";this._chart=dv.chart();this._minTickSpace=60;return this};bar._initDefaultOptions=function(){var defaults={normalized:false,position:"dodge",dualYAxis:false,xAxisTruncation:"ellipsis",clickHandler:null,formats:{x:"decimal",y:"decimal"},lines:null,tooltipContent:null,forceHistogramStyles:false,enableSelection:false};return Object.getPrototypeOf(bar)._initDefaultOptions.call(this,defaults)};bar.reset=function(){Object.getPrototypeOf(bar).reset.apply(this,arguments);var options=this._options,data=options.data,d3Parent=d3.select(options.parent);d3Parent.selectAll(".axis-y.axis-index-1").remove()};bar._addStatLines=function(){var chart=this._chart,options=this._options,data=chart._data,yvals=data[this._getPropMapping("y")].slice(),hlineData={xstart:[],xend:[],y:[],name:[]},lineOpts=options.lines,l10n=this._dataAdapter.l10n.labels.bar,mean=0,median=0,tot=0,len=yvals.length,i,self=this;if(options["normalized"]||options["position"]=="stack"||!lineOpts||lineOpts.length===0){return}if(lineOpts["max"]=="chart"){hlineData.y.push(Math.max.apply(null,yvals));hlineData.name.push(l10n["max"])}if(lineOpts["min"]=="chart"){hlineData.y.push(Math.min.apply(null,yvals));hlineData.name.push(l10n["min"])}if(lineOpts["mean"]=="chart"){for(i=0;i<len;i++){tot+=yvals[i]}mean=tot/len;hlineData.y.push(mean);hlineData.name.push(l10n["mean"])}if(lineOpts["median"]=="chart"){yvals.sort();if(len%2===0){median=(yvals[len/2]+yvals[len/2-1])/2;hlineData.y.push(median)}else{hlineData.y.push(yvals[Math.floor(len/2)])}hlineData.name.push(l10n["median"])}var enabled=self._seriesState.isSeriesEnabled("target","target"),scale=options.scales&&options.scales.y==="log"?dv.scale.log():dv.scale.linear(),hline=dv.geom.hline().data(hlineData).position("identity").map("y","y",scale.includeInDomain(function(){if(!self._valuesAreFilterable()){return true}return enabled})).set("alpha",.3).set("stroke",function(d,i){return"#222222"});if(this.labelData){this.labelData.y.push.apply(this.labelData.y,hlineData.y);this.labelData.name.push.apply(this.labelData.name,hlineData.name)}else{this.labelData=Object.create(hlineData);this.labelData.y=hlineData.y.slice();this.labelData.name=hlineData.name.slice()}chart.layers().push(hline)};bar._createTargetHLines=function(){var options=this._options;if(options.targetValues&&options.targetValues.length){var hlineData=Object.getPrototypeOf(bar)._createTargetHLines.apply(this,arguments);var chart=this._chart,len=chart._layers.length;this._addBehaviors(chart._layers[len-1],options);if(this.labelData){this.labelData.y.push.apply(this.labelData.y,hlineData.y);this.labelData.name.push.apply(this.labelData.name,hlineData.name)}else{this.labelData=Object.create(hlineData);this.labelData.y=hlineData.y.slice();this.labelData.name=hlineData.name.slice()}}};bar._setChartTypeOptions=function(){var chart=this._chart,options=this._options,data=options.data;this._minTickSpace=this._options.flip?15:this._minTickSpace;chart.layers([dv.geom.bar().each("start",function(d,i){d3.select(this).attr("legend-group",d["fill"])})]).map("fill",this._getPropMapping("series"),dv.scale.color().values(options.colors)).guide("fill",this._legend).position(options.position).coord(dv.coord.cartesian().flip(options.flip));chart._layers[0].on("click",dvcore.makeClickHandler(this));chart._layers[0].on("contextmenu",dvcore.makeContextMenuHandler(this));this._addBehaviors(chart.layers()[0],options);this._mapPositionScales(chart,options);var self=this};bar._mapPositionScales=function(chart,options){var isSmall=this._isSmallChart(),rangePadding=[0,isSmall?10:15],yScale=this._applyForceZero(this._constructScale("y")).rangePadding(rangePadding),fillMapping=this._getPropMapping("series"),yMapping=this._getPropMapping("y"),xMapping=this._getPropMapping("x"),xInnerPadding=isSmall?Math.max(.3,Math.min(.6,this._getChartWidth()/this._dataAdapter.uniqueXValues().length/200)):Math.min(.6,Math.max(.05,this._getChartWidth()/4e3)),xOuterPadding=isSmall?.3:.5,minPadding=.3,maxPadding=.7,minCalculatedPadding=15,self=this;if(this._dataAdapter.isOvertime()||options.forceHistogramStyles){xInnerPadding=.05}if(this._dataAdapter.isOvertime()){xOuterPadding=.7}else if(isSmall&&options.flip){xOuterPadding=.5;var hasEnoughRoomForLabels=true;var estLegendHeight=this._options.interactive?61:39;var tmpScale=d3.scale.ordinal().domain(this._dataAdapter.data()[xMapping]).rangeBands([estLegendHeight,this._getChartHeight()]);xInnerPadding=this._findMinimumPadding(minPadding,maxPadding,minCalculatedPadding,tmpScale.rangeBand());hasEnoughRoomForLabels=tmpScale.rangeBand()*xInnerPadding>minCalculatedPadding;this._hideXTicks=!hasEnoughRoomForLabels}else{this._hideXTicks=false}if(options.normalized||options.dualYAxis&&(this._options.position==="identity"||this._options.position==="dodge")){var uniqueGroups=self._dataAdapter.uniqueFillValues();uniqueGroups.forEach(function(g,index){var fillScale=0===index?yScale:yScale.copy();fillScale.includeInDomain(function(d,i){return d.data[fillMapping]===self._dataAdapter.uniqueFillValues()[index]});if(index>0){chart.map("y",yMapping,fillScale,index)}})}else{var yScales=chart.getExplicitScalesMap().y;var i=1;while(!!yScales&&!!yScales[i]){delete yScales[i];i++}}chart.map("y",yMapping,yScale,0);chart.map("x",this._getPropMapping("x"),dv.scale.ordinal().padding(xInnerPadding).outerPadding(xOuterPadding).reverse(options.flip))};bar._findMinimumPadding=function(minVal,maxVal,optimumPadding,bandWidth,precission){precission=precission||.1;var prevPaddingVal=maxVal,paddingVal;for(var i=maxVal;i>=minVal;i=i-precission){paddingVal=i;if(paddingVal*bandWidth<optimumPadding&&prevPaddingVal*bandWidth>=optimumPadding){break}prevPaddingVal=paddingVal}return prevPaddingVal};bar._hLineToolTip=function(d,i,j){return'<span class="metric-value">'+bar.escapeHtml(d[0].data.name)+'</span><span class="metric-name">'+bar.escapeHtml(d[0].data.y)+"</span>"};bar._addBehaviors=function(geom,options){var d3Parent=d3.select(options.parent),timer,adapter=this._dataAdapter,self=this;if(!this._isSmallChart()&&options.interactive){var selectionBehavior=dv.behavior.selection().on("selectionChanged",function(all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all);self._onSelectionChanged(this,all,added,removed,0)});this.selectionCache(selectionBehavior._selectionCache);var behaviors=[dv.behavior.identified(),dv.behavior.rollover().orientation("_data"in geom?options.flip?"right":"top":options.flip?"top":"right").content(function(d,i,j){if(!d.hasOwnProperty("data")){return self._hLineToolTip(d,i,j)}if(options.tooltipContent){return options.tooltipContent.call(this,d,i,j)}var seriesGroup=this.__geom.getExplicitScale("group"),valueFormat=self._yLabelFormat(j),content='<span class="metric-value">'+bar.escapeHtml(valueFormat(d.y,null,{dataItem:d}))+'</span><span class="metric-name">'+bar.escapeHtml(d.data[self._getPropMapping("seriesLabel")])+"</span>",gran=adapter.dateGranularity(),format=adapter.l10n.dateFormat.fullFormat,xLabel=adapter.isOvertime()?self._formatTime(new Date(d.x),self._timeGranTemplate(gran,format),gran):d.x;if(seriesGroup&&seriesGroup.mapping()){content='<span class="series-name">'+bar.escapeHtml(xLabel)+"</span>"+content}return content}).showTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._showTip.call(this,d,i,j,behavior);clearTimeout(timer);d3Parent.selectAll(".bar-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(pointD){return d!==pointD});d3Parent.selectAll(".cv-legend-marker").classed("cv-unselected",function(legendD){return legendD.id!==d.fill}).classed("cv-medium-duration",false);self._dispatch.mouseover.call(this,d,i,j,ev)}}).hideTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._removeTip.call(this,d,i,j,behavior);timer=setTimeout(function(){d3Parent.selectAll(".bar-geom, .cv-legend-marker").classed("cv-unselected",false).classed("cv-medium-duration",true);self._dispatch.mouseout.call(this,d,i,j,ev)},400)}})];if(this._options.enableSelection){behaviors.push(selectionBehavior)}geom.behaviors(behaviors)}};bar._drawSmall=function(){var chart=this._chart,options=this._options,xAxis,width=options.width,height=options.height,threshold=options.flip?width/7:10,numBars=this._dataAdapter.uniqueXValues().length,self=this;if(options.flip){xAxis=dv.guide.axis().tickDx(function(d,i){return d3.select(this).select("span").node().offsetWidth+2}).tickDy(0).tickSize(10)}else{xAxis=dv.guide.axis().tickSize(0).tickDy(function(d,i){return i%2===0?-8:-26})}if(options.forceHistogramStyles){xAxis.tickDy(options.flip?-4:-8).tickFormat(function(d,i,panel){xAxis.tickDx(-panel.getTrainedScale("x").rangeBand()/2);var label=d instanceof Date?self._timeXTickFormat(chart._data.x.length)(d,i):d;return self._timeXTickValidator(chart._data.x.length)(d,i)?label:""}).htmlLabels(true)}else if(this._dataAdapter.isOvertime()){var dates={},points=0;chart._data[this._getPropMapping("x")].forEach(function(d,i){if(!dates[+new Date(d)]){points++;dates[+new Date(d)]=1}});xAxis.tickValues(d3.extent(this._dataAdapter.data()[this._getPropMapping("x")])).tickFormat(this._timeXTickFormat(points)).tickAnchor(function(d,i){return i>0?"end":"start"}).tickDx(function(d,i){var rangeBand=chart.getTrainedScale("x").rangeBand()/2;return i>0?rangeBand:-rangeBand}).tickDy(-8).htmlLabels(true)}else{this._formatNonDateXAxis(xAxis);xAxis.tickFormat(function(d,i){return self._truncateLabel(d,threshold)})}chart.guide("x",xAxis.title(this._dataAdapter.xAxisTitle())).guide("y",dv.guide.axis().ticks(0).tickSize(0).tickFormat(function(d,i){return""}).title(this._dataAdapter.yAxisTitle()));this._checkNormalized()};bar._drawLarge=function(){var chart=this._chart,options=this._options,self=this,numYTicks=function(range){return Math.max(2,Math.min(5,range/75))},xAxis=dv.guide.axis().tickSize(0),yAxis=dv.guide.axis().ticks(numYTicks),yAxis2;if(options.dualYAxis&&(this._options.position==="identity"||this._options.position==="dodge")){var uniqueFillExtent0=self._dataAdapter.getUniqueFillExtent(0),uniqueFillExtent1=self._dataAdapter.getUniqueFillExtent(1);yAxis.tickSize(this._tickSize("y")).tickFormat(this._yTickFormat(0,uniqueFillExtent0)).title(this._yTitleFormat(0,uniqueFillExtent0));yAxis2=dv.guide.axis().ticks(numYTicks).tickFormat(this._yTickFormat(1,uniqueFillExtent1)).title(this._yTitleFormat(1,uniqueFillExtent1)).orientation("right").tickSize(this._tickSize("y"));chart.guide("y",yAxis2,1)}else{yAxis.tickFormat(this._yTickFormat(0)).title(this._yTitleFormat(0));chart.guide("y","none",1)}if(options.flip){xAxis.tickDx(-10)}else{xAxis.tickDy(function(d,i){return i%2===0?-8:-26});yAxis.tickDx(-10);if(yAxis2){yAxis2.tickDx(-10)}}if(options.forceHistogramStyles){xAxis.tickDy(options.flip?-4:-8).tickFormat(function(d,i,panel){xAxis.tickDx(-panel.getTrainedScale("x").rangeBand()/2);var label=d instanceof Date?self._timeXTickFormat(chart._data.x.length)(d,i):d;return self._timeXTickValidator(chart._data.x.length)(d,i)?label:""}).htmlLabels(true)}else if(this._dataAdapter.isOvertime()){var dates={},points=0;chart._data[this._getPropMapping("x")].forEach(function(d,i){if(!dates[+new Date(d)]){points++;dates[+new Date(d)]=1}});xAxis.tickDy(options.flip?-4:-8).tickFormat(this._timeXTickFormat(points)).htmlLabels(true)}else{this._formatNonDateXAxis(xAxis)}chart.guide("x",xAxis.title(this._dataAdapter.xAxisTitle())).guide("y",yAxis);this._checkNormalized();this._addStatLines()};bar._timeSmallXFormat=function(validTickFunc){var self=this,adapter=self._dataAdapter,format=adapter.l10n.dateFormat.fullFormat,gran=adapter?adapter.dateGranularity():"*",template=format.condensed;if("hour"===gran||"minute"===gran||"second"===gran){template=format[gran]}return function(d,i){if(validTickFunc&&!validTickFunc.call(this,d,i)){return""}return self._formatTime(d,template)}};bar._formatNonDateXAxis=function(xAxis){var options=this._options;if(this._hideXTicks){xAxis.tickValues([""])}else if(options.flip&&!this._isSmallChart()){var currentSampleIndex=0,sampleSet=this._dataAdapter.uniqueXValues(),height=this._options.height||this._getChartHeight(),sampleRate=Math.ceil(sampleSet.length/(height/this._minTickSpace)),tickValues=sampleSet.map(function(v,i){return currentSampleIndex++%sampleRate===0?v:null});xAxis.tickValues(tickValues)}xAxis.tickFormat(function(d,i){return d});xAxis.tickWidth(function(d,i,panel,len){if(!options.flip&&(options.xAxisTruncation==="ellipsis"||options.xAxisTruncation==="clip")){var elementsInRow=len/2;elementsInRow+=i%2===0&&len%2===1?1:0;var myWidth=panel._bounds.width/elementsInRow;return myWidth*.8+"px"}return"100%"});xAxis.tickDisplay(function(d,i,panel){return!options.flip&&(options.xAxisTruncation==="ellipsis"||options.xAxisTruncation==="clip")?"inline-block":"inline"});xAxis.tickOverflow(function(d,i,panel){return options.xAxisTruncation==="ellipsis"||options.xAxisTruncation==="clip"?"hidden":""});xAxis.tickTextOverflow(function(d,i,panel){return options.xAxisTruncation})};bar._timeXTickValidator=function(points){var self=this,options=self._options;return function(d,i){var xScale=self._chart.getTrainedScale("x"),xRange=dv.util.scaleRange(xScale),width=options.flip?xRange[0]-xRange[1]:xRange[1]-xRange[0],minTickWidth=Math.ceil(self._minTickSpace/(width/points));return i%minTickWidth===0}};bar._timeXTickFormat=function(points){if(this._isSmallChart()){return this._timeSmallXFormat(this._options.flip?null:this._timeXTickValidator(points))}return Object.getPrototypeOf(bar)._timeXTickFormat.call(this,this._timeXTickValidator(points))};bar._isNormalized=function(){var options=this._options,tooManySeries=this._isSmallChart()?1:2;return options.normalized||options.dualYAxis&&this._dataAdapter.uniqueFillValues().length>tooManySeries&&(options.position==="identity"||options.position==="dodge")};bar._postRenderLabels=function(){var chart=this._chart,isOvertime=this._dataAdapter.isOvertime();var topPos={},boxHeight={},series=d3.select(chart.parent()).selectAll(".series").each(function(d,i){var path=d3.select(this).selectAll("path").each(function(d2,i2){var bbox=d3.select(this).node().getBBox();if(!topPos[d2.x]){topPos[d2.x]=bbox.y}if(!boxHeight[d2.x]){boxHeight[d2.x]=bbox.height}})});var axisLabels=d3.select(chart.parent()).selectAll(".axis-label");axisLabels.style("left",function(d,i){return axisLabels.empty()?0:axisLabels.style("left")}).style("top",function(d,i){if(isOvertime&&i>0){return topPos[d]+boxHeight[d]+"px"}return topPos[d]-13+"px"})};bar.lineWithinBounds=function(top,bottom,ignore){var labelData=this.labelData,len=labelData.y.length,i,chart=this._chart,yScale=chart.getTrainedScale("y");for(i=0;i<len;i++){var yval=yScale.mapValue(labelData.y[i]);if(i!=ignore&&yval>=top&&yval<=bottom){return i}}return-1};bar._postRender=function(){var labelData=this.labelData,chart=this._chart,options=this._options,flip=options.flip;this._changedOptions={};if(this._isSmallChart()&&flip){this._postRenderLabels()}var highlightContainer=d3.select(chart.parent());highlightContainer=highlightContainer.selectAll(".behavior");this._highlightedOverlay.setUpSelectedOverlay(highlightContainer);var background=d3.select(chart.parent()).selectAll(".interaction-canvas");var selectionCache=this.selectionCache();if(selectionCache){selectionCache.setDeselector(d3.select(this._chart.parent()).select("rect.interaction-canvas"));selectionCache.selectionKeymap(this.determineKeyModifiers)}if(!this.labelData){return}var xScale=chart.getTrainedScale("x"),yScale=chart.getTrainedScale("y"),svgPlot=d3.select(chart.parent()).select(".plot"),bounds=chart._facet.getPanel(0).bounds(),textOffset=[],len=labelData.y.length,i;var leftAxis=d3.select(chart.parent()).select(".axis-index-0"),leftOffset=Number(leftAxis.style("left").slice(0,-2));var topBar=d3.select(chart.parent()).select(".cv-bg"),topHeight=Number(topBar.style("top").slice(0,-2))+10;var textWidth=[],textHeight=[];svgPlot.append("g").selectAll(".dummyText").data(labelData.name).enter().append("text").classed("data-label",true).text(function(d){return d}).each(function(d,i){var thisWidth=this.getComputedTextLength();textWidth.push(thisWidth)}).remove();if(flip){for(i=0;i<len;i++){var xpos=yScale.mapValue(labelData.y[i]);if(this.lineWithinBounds(xpos,xpos+textWidth[i],i)==-1&&xpos+textWidth[i]<bounds.right){textOffset.push(2)}else if(this.lineWithinBounds(xpos-textWidth[i],xpos,i)==-1&&xpos-textWidth[i]>bounds.left){textOffset.push(-textWidth[i])}else{textOffset.push(0);labelData.name[i]=""}}}else{for(i=0;i<len;i++){var ypos=yScale.mapValue(labelData.y[i]);if(this.lineWithinBounds(ypos-15,ypos,i)==-1){textOffset.push(-2)}else if(this.lineWithinBounds(ypos,ypos+15,i)==-1){textOffset.push(11)}else{textOffset.push(0);labelData.name[i]=""}}}var labels=svgPlot.selectAll(".data-label").data(labelData.name);labels.enter().append("text").classed("data-label",true).text(function(d){return d}).attr("x",bounds.top).attr("y",yScale.range()[0]);labels.transition().duration(0).attr("x",function(d,i){if(flip){return yScale.mapValue(labelData.y[i])+textOffset[i]}return leftOffset+(labelData.xstart&&labelData.xstart[i]?labelData.xstart[i]*bounds.width:0)}).attr("y",function(d,i){if(flip){return topHeight+(labelData.xstart&&labelData.xstart[i]?labelData.xstart[i]*bounds.width:0)}return yScale.mapValue(labelData.y[i])+textOffset[i]});labels.exit().transition().duration(0).attr("y",yScale.range()[0]).remove()};global.cloudViz.bar=cloudViz.util.createConstructor(bar)})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},dvcore=cloudViz.dvcore||{},dv=global.dv||{},d3=global.d3||{},donut=Object.create(dvcore);donut.init=function(options){Object.getPrototypeOf(donut).init.apply(this,arguments);this._type="donut";this._chart=dv.chart();this.__other__="__other__";return this};donut._initDefaultOptions=function(){var defaults={sort:"descending",maxSlices:6,innerRadius:"45%",outerRadius:"35%",clickHandler:null,formats:{x:"decimal",y:"decimal"},mappings:{totals:""},showPrecalculatedSubtitle:false,tooltipContent:null,enableSelection:false};return Object.getPrototypeOf(donut)._initDefaultOptions.call(this,defaults)};donut._buildLegend=function(){var self=this,options=this._options,legend=Object.getPrototypeOf(donut)._buildLegend.call(this,"x","x");this._dataAdapter.processLabelData(legend);if(legend!=="none"){if(this._dataAdapter.numberOfFacets()==1){var legendValues=this._dataAdapter.labelData().cvtextvallabel.map(function(d,i){return self._yLabelFormat(0)(d)});legend.values(legendValues)}else{legend.values([])}if(!options.interactive&&(!options.legendOrientation||options.legendOrientation==="top")){legend.padding({bottom:20})}}return legend};donut._isNumber=function(obj){return!isNaN(parseFloat(obj))};donut._usePretotals=function(series){var adapter=this._dataAdapter,data=adapter.data(),labels=data[this._getPropMapping("series")],i,ii=labels.length,pretotals=data[this._getPropMapping("totals")]||[];if(pretotals.length==labels.length){for(i=0;i<ii;++i){if(labels[i]+""===series+""){if(donut._isNumber(pretotals[i])&&pretotals[i]>=0){return true}}}}return false};donut._getSeriesTotal=function(series){var adapter=this._dataAdapter,data=adapter.data(),values=data[this._getPropMapping("y")],labels=data[this._getPropMapping("series")],pretotals=data[this._getPropMapping("totals")]||[],i,ii=labels.length,total=0,usepretotals=pretotals.length==labels.length;for(i=0;i<ii;++i){if(labels[i]+""===series+""){if(usepretotals&&donut._isNumber(pretotals[i])&&pretotals[i]>=0){return pretotals[i]}total+=values[i]}}return total};donut._addAggregateLabel=function(uniqueSliceNames,uniqueSliceIds){var masterList=uniqueSliceIds||uniqueSliceNames;var otherIndex=masterList.indexOf(this.__other__);if(otherIndex!==-1){uniqueSliceNames.splice(otherIndex,1);uniqueSliceNames.push(this._dataAdapter.data()[this._getPropMapping("aggregateLabel")]||this._dataAdapter.l10n.labels.core.other);if(uniqueSliceIds){uniqueSliceIds.splice(otherIndex,1);uniqueSliceIds.push(this.__other__)}}};donut._insertSeriesStates=function(uniqueSliceNames,uniqueSliceIds){var masterList=uniqueSliceIds||uniqueSliceNames;var i=masterList.length;while(i--){var sliceName=uniqueSliceNames[i],sliceId=uniqueSliceIds?uniqueSliceIds[i]:null;this._seriesState.insertState(sliceName,sliceId||sliceName,"standard")}};donut._createSeriesStates=function(){var options=this._options;if("data"in this._changedOptions&&this._changedOptions.data){this._seriesState.removeStatesByType("standard");var legendLabels=this._dataAdapter.data()[this._getPropMapping("legendLabel")];var sliceNames=legendLabels?legendLabels:this._dataAdapter.data()[this._getPropMapping("x")],sliceIds=this._dataAdapter.data()[this._getPropMapping("sliceId")];var uniqueSliceNames;if(sliceIds.length){var uniqueSliceIds=dv.util.uniq(sliceIds);uniqueSliceNames=uniqueSliceIds.map(function(id,index){return sliceNames[sliceIds.indexOf(id)]});this._addAggregateLabel(uniqueSliceNames,uniqueSliceIds);this._insertSeriesStates(uniqueSliceNames,uniqueSliceIds)}else{uniqueSliceNames=dv.util.uniq(sliceNames);this._addAggregateLabel(uniqueSliceNames);this._insertSeriesStates(uniqueSliceNames)}}if("targetValues"in this._changedOptions){if(options.targetValues){this._seriesState.removeStatesByType("target");this._seriesState.appendState(options.targetLabel||this._dataAdapter.l10n.labels.dvcore.target,"target","target")}}};donut._getCategoryTotal=function(cat){if(this._dataAdapter.numberOfFacets()!==1){return""}var data=this._dataAdapter.data(),values=data[this._getPropMapping("y")],cats=data[this._getPropMapping("x")],i,ii=cats.length,total=0;for(i=0;i<ii;++i){if(cats[i]+""===cat+""){total+=values[i]}}return total};donut._shouldHideLabels=function(d){var panelBounds=d.panel.bounds();return d.y<=.05||Math.min(panelBounds.width,panelBounds.height)/2<80};donut._setChartTypeOptions=function(){var chart=this._chart,adapter=this._dataAdapter,options=this._options,d3Parent=d3.select(options.parent),self=this,colors=adapter.colors().slice(0);if(options.interactive){chart.padding({top:10})}if(adapter.showOtherCategory()){for(var i=options.maxSlices-1;i<adapter.data().cvdonutorder.length;i+=options.maxSlices){colors.splice(i,0,"#ccc");adapter._processedOptions.data[this._getPropMapping("x")][i]=this._dataAdapter.data()[this._getPropMapping("aggregateLabel")]||this._dataAdapter.l10n.labels.core.other}}var layers=[dv.geom.bar().position("fill").set("stroke","#fff").each("start",function(d,i){d3.select(this).attr("legend-group",d["fill"])})];layers[0].on("click",dvcore.makeContextMenuHandler(this));layers[0].on("contextmenu",dvcore.makeContextMenuHandler(this));var labelData=self._dataAdapter.labelData();layers.push(dv.geom.text().data(labelData).map("label","cvtextperclabel").set("stroke","none").position("fill").textAnchor(function(d,i){var val=d.y0+d.y/2;if(val<50){return"start"}if(val>50){return"end"}return"middle"}).each("start",function(d,i){d3.select(this).classed("slice-label",true).classed("hidden",self._shouldHideLabels.call(self,d)).attr("dy",".35em").attr("legend-group",d["fill"])}).set("alpha",function(d,i,j){return self._shouldHideLabels.call(self,d)?0:1}).dx(function(d,i){var xrange=d.panel.xOuterScale().range(),xDist=xrange[1]-xrange[0],radius=xDist?xDist/2:0,outerRadius=dv.util.getPercentValue(options.outerRadius,radius),padding=30;return radius+outerRadius-padding}).dy(function(d,i){var position=-d.panel._bounds.width/2*(d.y/100),val=d.y0+d.y/2;if(val<10){position-=(10-val)/2}if(val>90){position+=(10-(100-val))/2}if(val<=50&&val>40){position+=(10-(50-val))/2}if(val>50&&val<60){position-=(10-(val-50))/2}return position}));chart.layers(layers).map("group","cvdonutorder").map("x",this._getPropMapping("series"),dv.scale.ordinal()).map("y",this._getPropMapping("y"),this._constructScale("y")).map("fill",this._getPropMapping("sliceId")||this._getPropMapping("x"),dv.scale.color().values(colors)).guide("fill",this._legend).guide(["x","y"],"none").coord(dv.coord.polar().flip(true).innerRadius(options.innerRadius).outerRadius(options.outerRadius)).postrender(function(){var container=d3.select(options.parent).select(".cv-wrapper"),donutLabels=container.selectAll(".cv-donut-facet-labels").data([0]),adapter=self._dataAdapter;donutLabels.enter().append("div").classed("cv-donut-facet-labels",true);donutLabels.exit().remove();var donutLabel=donutLabels.selectAll(".cv-donut-facet-label").data(this.facet()._panels),donutLabelEnter=donutLabel.enter().append("div").classed("cv-donut-facet-label",true);donutLabel.each(function(d,i){var bounds=d.bounds(),label=d3.select(this),radius=Math.min(bounds.width,bounds.height)/2,topSpace=bounds.height/2-radius,innerRadius=dv.util.getPercentValue(options.innerRadius,radius),size=innerRadius<25?"small":innerRadius>50?"large":"medium",width=size==="large"?innerRadius*2:bounds.width,left=size==="large"?bounds.left+bounds.width/2-width/2:bounds.left,top=size==="large"?bounds.top+bounds.height/2-27:bounds.top+topSpace-10;label.style("top",top+"px").style("width",width+"px").style("left",left+"px").classed("cv-donut-small-facet cv-donut-medium-facet cv-donut-large-facet",false).classed("cv-donut-"+size+"-facet",true);var num=label.selectAll(".cv-donut-label-number").data([0]);num.enter().append("div").classed("cv-donut-label-number",true);var value=self._getSeriesTotal(d.xFacetTitle());num.text(self._yLabelFormat(d._facetIndex)(value));var title=label.selectAll(".cv-donut-label-title").data([0]);title.enter().append("div").classed("cv-donut-label-title",true);title.text(adapter.yAxisTitle(d._facetIndex));if(self._usePretotals(d.xFacetTitle())&&options.showPrecalculatedSubtitle){var l10n=adapter.l10n.labels.donut;title.enter().append("div").classed("cv-donut-label-subtitle",true);title.text(l10n["precalculated"])}if(size==="medium"){num.style("top",bounds.height/2-topSpace+"px")}});donutLabel.exit().remove()});this._addBehaviors(layers[0],options)};donut._addBehaviors=function(geom,options){var d3Parent=d3.select(options.parent),timer,adapter=this._dataAdapter,self=this,addMetricValue=function(d,scale,format){if(!d.data.hasOwnProperty(scale.mapping())){return""}return'<span class="metric-value">'+donut.escapeHtml(format(d.data[scale.mapping()]))+'</span><span class="metric-name">'+donut.escapeHtml(scale.mapping())+"</span>"};if(options.interactive){var selectionBehavior=dv.behavior.selection().on("selectionChanged",function(all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all,function(){return this.parentNode.attributes["transform"]?this.parentNode.attributes["transform"].nodeValue:"translate(0,0)"});self._onSelectionChanged(this,all,added,removed,0)});this.selectionCache(selectionBehavior._selectionCache);var behaviors=[dv.behavior.identified(),dv.behavior.rollover().content(function(d,i,j){if(options.tooltipContent){return options.tooltipContent.call(this,d,i,j)}var seriesGroup=this.__geom.getExplicitScale("group"),cIndex=d.panel.columnIndex(),valueFormat=self._yLabelFormat(cIndex),content='<span class="metric-value">'+donut.escapeHtml(valueFormat(d.data[self._getPropMapping("y")]))+'</span><span class="metric-name">'+donut.escapeHtml(d.data[self._getPropMapping("seriesLabel")])+"</span>",gran=self._dataAdapter.dateGranularity(),format=adapter.l10n.dateFormat.fullFormat,xLabel=dv.util.isDate(d.fill)?self._formatTime(d.fill,self._timeGranTemplate(gran,format),gran):d.data[self._getPropMapping("x")];if(seriesGroup&&seriesGroup.mapping()){content='<span class="series-name">'+donut.escapeHtml(xLabel)+"</span>"+content}return content}).showTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._showTip.call(this,d,i,j,behavior);clearTimeout(timer);d3Parent.selectAll(".bar-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(pointD){return d!==pointD});d3Parent.selectAll(".text-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(pointD){return d.group!==pointD.group}).classed("cv-selected",function(pointD){return d.group===pointD.group});d3Parent.selectAll(".cv-legend-marker").classed("cv-unselected",function(legendD){return legendD.id!==d.fill}).classed("cv-medium-duration",false);self._dispatch.mouseover.call(this,d,i,j,ev)}}).hideTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._removeTip.call(this,d,i,j,behavior);timer=setTimeout(function(){d3Parent.selectAll(".bar-geom, .cv-legend-marker").classed("cv-unselected",false).classed("cv-medium-duration",true);d3Parent.selectAll(".text-geom").classed("cv-unselected cv-selected",false).classed("cv-medium-duration",true);self._dispatch.mouseout.call(this,d,i,j,ev)},400)}})];if(options.enableSelection){behaviors.push(selectionBehavior)}geom.behaviors(behaviors)}};donut._drawSmall=function(){var chart=this._chart,options=this._options;chart.facet(dv.facet.wrap().group(this._getPropMapping("series")).scales("free").numColumns(1).titleFormat(undefined))};donut._drawLarge=function(){var chart=this._chart;chart.facet(dv.facet.wrap().group(this._getPropMapping("series")).scales("free").numColumns(3).titleFormat(undefined))};donut._updatePathStates=function(){Object.getPrototypeOf(donut)._updatePathStates.call(this,this._getPropMapping("sliceId")||this._getPropMapping("x"))};global.cloudViz.donut=cloudViz.util.createConstructor(donut)})(this);(function(global){"use strict";global.cloudViz.interactiveLegend=function(){var VERT_LEGEND_MARGIN=10,minLegendEntryWidth=110,legendVerticalWidth=110,parent,orientation,validOrientations=["top","right","left"],chartWidth,chartHeight,chartPadding,isVertical,values,type,showTargetEntry,seriesState,interactive=true,legendEntryWidth,legendEntries,legend,legendStates=null,manualStates=null,mapping,interactiveLegend={};interactiveLegend._render=function(parent,scales,opts){this._initSVG(scales);this._sizeAndPositionLegendEntries();this._positionLegend()};interactiveLegend._initSVG=function(scales){legend=d3.select(parent).selectAll(".cv-legend").data([0]);legend.enter().append("div").classed("cv-legend",true);legendEntries=this._createLegendEntries(legend,scales);legendEntryWidth=Math.floor(this._getLegendContainingWidth()/legendEntries.size());if(validOrientations.indexOf(orientation)>-1){this._calculatedLegendOrientation=orientation}else{this._calculatedLegendOrientation="top"}var isSmall=global.cloudViz.core._isSmallChart(chartWidth);if(legendEntryWidth<minLegendEntryWidth&&!isSmall&&(this._calculatedLegendOrientation=="top"||this._calculatedLegendOrientation=="bottom")){this._calculatedLegendOrientation="left"}switch(this._calculatedLegendOrientation){case"top":case"bottom":legendEntryWidth=Math.max(legendEntryWidth,minLegendEntryWidth);legend.style("height",null);isVertical=false;break;case"left":case"right":legendEntryWidth=legendVerticalWidth;isVertical=true;break}validOrientations.forEach(dv.util.bind(function(orientation){legend.classed(orientation,this._calculatedLegendOrientation===orientation)},this))};interactiveLegend._getAdjustedDimensions=function(dim){var legendNode=legend.node();switch(this._calculatedLegendOrientation){case"top":dim.top+=this._getUsedHeight();break;case"right":dim.width-=this._getUsedWidth();break;case"left":dim.left+=this._getUsedWidth();break;case"bottom":dim.height-=this._getUsedHeight();break}return dim};interactiveLegend._createLegendEntries=function(legend,scales){var self=this,states=seriesState.getStateObjects(),entries,newEntries,k,scale;states=states.filter(function(state){return!state.hiddenInLegend});for(k in scales){scale=scales[k][0];mapping=scale._mapping}entries=legend.selectAll(".cv-legend-entry").data(states);newEntries=entries.enter().append("div").attr("class",function(d){return"cv-legend-entry cv-legend-"+d.type+"-entry"});newEntries.append("div").classed("cv-legend-title",true);var secondLine=newEntries.append("div").classed("cv-legend-details",true);secondLine.append("div").classed("cv-legend-marker",true);secondLine.append("div").classed("cv-legend-num",true);entries.exit().on("click",null).remove();entries.each(function(d,i){var entry=d3.select(this);entry.select(".cv-legend-title").text(d.name);entry.select(".cv-legend-num").text(values&&values.length>i?values[i]:"");entry.select(".cv-legend-marker").attr("class","cv-legend-marker "+type).style("background-color",function(d){var color=scale.mapValue(d.id);return color?color:null})});entries.classed("inactive",function(d,i){return interactive&&!d.enabled});entries.on("click",function(d,i){if(interactive){seriesState.enableStateByIndex(i,!d.enabled)}});return entries};interactiveLegend._onSeriesEnableChange=function(eventType,obj){if(interactive){legendEntries.filter(function(d){return d.id===obj.id&&d.type===obj.type}).classed("inactive",!obj.enabled)}};interactiveLegend._positionLegend=function(){var legendPosition={top:0,left:0};switch(this._calculatedLegendOrientation){case"bottom":legendPosition.top=chartHeight-legend.node().offsetHeight;break;case"right":legendPosition.left=chartWidth-legendVerticalWidth;break}legend.style("top",legendPosition.top+"px").style("left",legendPosition.left+"px")};interactiveLegend._sizeAndPositionLegendEntries=function(){if(isVertical){legend.style("width","");legendEntries.each(function(d,i,s){d3.select(this).style("width",legendEntryWidth+"px").select(".cv-legend-title").style("height",null)})}else{var entry,height,largestEntryTitleHeight=0,entryTitleHeightsDifferent=false;var numLegendEntries=legendEntries[0].length;var legendWidth=numLegendEntries*legendEntryWidth;var containingWidth=this._getLegendContainingWidth();var legendWidthAdjustment=0;if(legendWidth<containingWidth&&legendWidth+numLegendEntries>containingWidth){legendWidthAdjustment=containingWidth-legendWidth}legend.style("width",legendWidth>containingWidth&&!isVertical?containingWidth+"px":"");legendEntries.each(function(d,i,s){entry=d3.select(this);var entryWidth=legendEntryWidth;if(legendWidthAdjustment>0){entryWidth+=1;legendWidthAdjustment-=1}entry.style("width",entryWidth+"px");height=entry.select(".cv-legend-title").style("height",null).node().offsetHeight;if(height!==largestEntryTitleHeight){entryTitleHeightsDifferent=true;largestEntryTitleHeight=Math.max(height,largestEntryTitleHeight)}});if(entryTitleHeightsDifferent){legendEntries.selectAll(".cv-legend-title").style("height",largestEntryTitleHeight+"px")}}};interactiveLegend._getLegendContainingWidth=function(){return chartWidth};interactiveLegend._getUsedWidth=function(){return isVertical?legendVerticalWidth+VERT_LEGEND_MARGIN:0};interactiveLegend._getUsedHeight=function(){if(isVertical){return 0}else{return legend.node().offsetHeight||0}};interactiveLegend.destroy=function(){legend.remove()};interactiveLegend.parent=function(_){if(!arguments.length){return parent}parent=_;return interactiveLegend};interactiveLegend.minLegendEntryWidth=function(_){if(!arguments.length){return minLegendEntryWidth}minLegendEntryWidth=_;return interactiveLegend};interactiveLegend.legendVerticalWidth=function(_){if(!arguments.length){return legendVerticalWidth}legendVerticalWidth=+_;return interactiveLegend};interactiveLegend.values=function(_){if(!arguments.length){return values}values=_;return interactiveLegend};interactiveLegend.type=function(_){if(!arguments.length){return type}type=_;return interactiveLegend};interactiveLegend.chartWidth=function(_){if(!arguments.length){return chartWidth}chartWidth=_;return interactiveLegend};interactiveLegend.chartHeight=function(_){if(!arguments.length){return chartHeight}chartHeight=_;return interactiveLegend};interactiveLegend.chartPadding=function(_){if(!arguments.length){return chartPadding}chartPadding=_;return interactiveLegend};interactiveLegend.seriesState=function(_){if(!arguments.length){return seriesState}seriesState=_;seriesState.on("enableChange.legend",this._onSeriesEnableChange);return interactiveLegend};interactiveLegend.validOrientations=function(_){if(!arguments.length){return validOrientations}validOrientations=_;return interactiveLegend};interactiveLegend.orientation=function(_){if(!arguments.length){return orientation}orientation=_;return interactiveLegend};interactiveLegend.interactive=function(_){if(!arguments.length){return interactive}interactive=_;return interactiveLegend};interactiveLegend.mapping=function(){return mapping};interactiveLegend.isVertical=function(){return isVertical};return interactiveLegend}})(this);(function(global){"use strict";d3.anomaly=function(){var anomaly={},data,mappings={x:"date",y:"deviation"},padding,size=[50,25],interactive=true,bins=6,normalizePositive=false,p=null,anomalyWidth,anomalyHeight,xTicks=7,xTickInterval,xUpperLimit,xLowerLimit,dispatch=d3.dispatch("select","mouseover","mouseout","contextmenu"),lastMouseOverNode,x=d3.time.scale(),y=d3.scale.linear(),gradient,height,width,binData,binSize,buckets,interactionLayer=cloudViz.util.inputFilter(".brush-container",".zoom-container",".anom-container"),xTickValues,xMapping,yMapping,$p,$container,selectLogic=new dv.util.SelectionCache,treeRoot=new dv.collisions.QuadtreeNode([512,512],512),chart=null;treeRoot.buildTree(3);selectLogic.lastSelected=function(){return this._lastSelected};selectLogic.on("selectionChanged",function(source,all,added,removed){dispatch.select.call(source,all,added,removed)});var BAND_PADDING=8,ANOMALY_PADDING=1,DAY_IN_MILLIS=864e5;d3.rebind(anomaly,dispatch,"on");anomaly.selectionCache=function(){return selectLogic};anomaly.chart=function(c){if(c){chart=c}return chart};anomaly.data=function(_){if(!arguments.length){return data}data=_;return anomaly};anomaly.mappings=function(_){if(!arguments.length){return mappings}mappings=extend(mappings,_);return anomaly};anomaly.xUpperLimit=function(_){if(!arguments.length){return xUpperLimit}xUpperLimit=_;return anomaly};anomaly.xLowerLimit=function(_){if(!arguments.length){return xLowerLimit}xLowerLimit=_;return anomaly};anomaly.normalizePositive=function(_){if(!arguments.length){return normalizePositive}normalizePositive=_;return anomaly};anomaly.xTicks=function(arg1,arg2){if(!arguments.length){return arg2!==undefined?[xTicks,xTickInterval]:this.xTicks}var isArg1Func=!!(arg1&&arg1.constructor&&arg1.call&&arg1.apply);xTicks=isArg1Func?d3.functor(arg1):arg1;xTickInterval=isArg1Func?arg2:undefined;return this};anomaly.bins=function(_){if(!arguments.length){return bins}bins=_;return anomaly};anomaly.size=function(_){if(!arguments.length){return size}size=_;return anomaly};anomaly.interactive=function(_){if(!arguments.length){return interactive}interactive=_;return anomaly};anomaly.parent=function(_){if(!arguments.length){return p}p=_;return anomaly};anomaly.anomalyWidth=function(){return anomalyWidth};anomaly.anomalyHeight=function(){return anomalyHeight};anomaly.layout=function(options){if(!anomaly.data()||!anomaly.data().length){throw new EmptyDataException}if(!anomaly.parent()){throw new ParentNotSpecifiedException}xMapping=getMapping("x");yMapping=getMapping("y");createScales(options);binData=generateBinData();y.domain([buckets[0],buckets[buckets.length-1]]);var qtDim=width>height?width:height;qtDim=qtDim/2;treeRoot=new dv.collisions.QuadtreeNode([qtDim,qtDim],qtDim);treeRoot.buildTree(4);$container=createSVGContainer();determineSize();$container.attr("transform","translate("+padding.left+","+padding.top+")");var deselector=$container.selectAll(".anom-background").data([0]).enter().append("rect").classed("anom-background",true);selectLogic.setDeselector(deselector);drawAxes($container,width,height);drawInteractionLayer();drawAnomalies();interactionLayer.interceptBrushEvents();return anomaly};anomaly.nodes=function(f){if(!$p){throw new Error("layout must be called before nodes may be requested.")}$p.selectAll(".anom-anomaly").each(f)};function extend(dest,source){for(var prop in source){dest[prop]=source[prop]}return dest}function determineSize(){var tempAxisContainer=$container.append("g").classed("temp-axis",true);drawAxes(tempAxisContainer,size[0],size[1]);padding=measureAxis(tempAxisContainer);width=size[0]-padding.left-padding.right;height=size[1]-padding.top-padding.bottom;tempAxisContainer.remove()}function measureAxis(axisContainer){var bbox=axisContainer.node().getBBox(),left=Math.abs(bbox.x),top=Math.abs(bbox.y);return{left:left,top:top,right:bbox.width-size[0]-left,bottom:bbox.height-size[1]-top}}function createScales(options){var xExtent=calculateExtent(data,function(d){return Date.parse(d[xMapping])},[xLowerLimit,xUpperLimit]);var yExtent=calculateExtent(data,function(d){return d[yMapping]});x.domain(xExtent);var tickVals=x.ticks(xTicks,xTickInterval);var tickIntMillis=+tickVals[1]-+tickVals[0];xExtent[1]=tickIntMillis+ +tickVals[tickVals.length-1];xExtent[0]=+tickVals[0]>xExtent[0]?+tickVals[0]-tickIntMillis:xExtent[0];x.domain(xExtent);xTickValues=x.ticks(xTicks,xTickInterval);var extentMax=Math.max(Math.abs(yExtent[0]),Math.abs(yExtent[1]));if(normalizePositive){y.domain([0,extentMax]);gradient=d3.scale.linear().domain([-extentMax,extentMax])}else{y.domain([-extentMax,extentMax]);gradient=d3.scale.linear().domain(y.domain())}gradient.domain([0,1/10,1/5,3/10,2/5,.5,3/5,7/10,4/5,9/10,1].map(gradient.invert));gradient.range(options.colors)}function calculateExtent(data,limitAccessor,manualLimits){var limits=[];if(arguments.length<3||manualLimits[0]===undefined&&manualLimits[1]===undefined){limits=d3.extent(data,limitAccessor)}else{limits[0]=manualLimits[0]===undefined?d3.min(data,limitAccessor):manualLimits[0];limits[1]=manualLimits[1]===undefined?d3.max(data,limitAccessor):manualLimits[1]}return limits}function createSVGContainer(){$p=d3.select(p);var $wrapper=$p.selectAll(".cv-wrapper").data([data]);$wrapper.enter().append("div").classed("cv-wrapper",true);$wrapper.classed("cv-anomaly",true);var svg=$wrapper.selectAll("svg").data([data]);svg.enter().append("svg").on("contextmenu",function(d,i){d3.event.preventDefault()});svg.exit().remove();svg.attr("width",size[0]).attr("height",size[1]);interactionLayer.setUpBrush(svg,selectLogic,treeRoot);var container=svg.selectAll(".anom-container").data([0]);container.enter().append("g").classed("anom-container",true);interactionLayer.setUpBrushOverlay(svg);return container}function generateBinData(){buckets=y.ticks(bins);var bucketSize=buckets[1]-buckets[0];buckets.push(bucketSize+buckets[buckets.length-1]);if(!normalizePositive){buckets.unshift(buckets[0]-bucketSize)}data=filterData(data);sortData(data);var nestData=nestDataByX(data);binNestedData(buckets,nestData);return nestData}function filterData(data,xExtent){var xDomain=x.domain();return data.filter(function(d){var date=new Date(d[xMapping]);return date>=xDomain[0]&&date<xDomain[1]})}function sortData(data){data.sort(function(a,b){a=new Date(a[xMapping]);b=new Date(b[xMapping]);return a<b?-1:a>b?1:0})}function nestDataByX(data){return d3.nest().key(function(d){var date=Date.parse(d[xMapping]),tickIndex=0;var i=-1,n=xTickValues.length;while(++i<n){if(+xTickValues[i]>+date){break}tickIndex=i}return+xTickValues[tickIndex]}).entries(data)}function binNestedData(buckets,nestData){nestData.forEach(function(d){d.values=d3.layout.histogram().bins(buckets).value(function(d){return normalizePositive?Math.abs(d[yMapping]):d[yMapping]})(d.values);binSize=d.values[0].dx})}function xTickLabelFormat(w){var prevTick=new Date(0),numTicks=xTickValues.length,maxTickDensity=Math.max(Math.ceil((xTickValues.length-1)/(w/70)),1),fullFormat=d3.time.format("%b %e, %Y"),monthFormat=d3.time.format("%b %e"),dayFormat=d3.time.format("%a %e"),hourFormat=d3.time.format("%I:%M %p");return function(d,i){var value="";if(i===numTicks-1||i%maxTickDensity!==0){return""}else if(i===0||prevTick.getYear()!==d.getYear()){value=fullFormat(d)}else if(prevTick.getMonth()!==d.getMonth()){value=monthFormat(d)}else if(prevTick.getDate()!==d.getDate()){value=dayFormat(d)}else if(prevTick.getHours()!==d.getHours()){value=hourFormat(d)}prevTick=d;return value}}function drawAxes(container,w,h){var numXTicks=xTickValues.length,showWeekendMarkers=xTickValues.length>1&&+xTickValues[1]-+xTickValues[0]<=DAY_IN_MILLIS,lastXLabelDate;x.rangeRound([0,w]);y.rangeRound([h,0]);var axes=container.selectAll(".anom-axes").data([0]);axes.enter().append("g").classed("anom-axes",true);var axis=axes.selectAll(".anom-axis").data(["x","y"]);axis.enter().append("g").attr("class",function(d){return"anom-"+d+" anom-axis"});var xAxis=axes.selectAll(".anom-x").attr("transform","translate(0,"+h+")").call(d3.svg.axis().scale(x).ticks(xTicks,xTickInterval).orient("bottom").tickSize(-h).tickPadding(20).tickFormat(xTickLabelFormat(w)));xAxis.selectAll("text").style("text-anchor","start");xAxis.selectAll("line").style("opacity",function(d,i){if(i===numXTicks-1){return 0}if(showWeekendMarkers&&(d.getDay()===6||d.getDay()===1)&&d.getHours()===0&&i<numXTicks-1){return.3}return null});var yAxis=axes.selectAll(".anom-y").call(d3.svg.axis().scale(y).tickValues(buckets).orient("left").tickSize(-w).tickPadding(10).tickFormat(function(d,i){if(i===0||i===Math.floor(buckets.length/2)||i===buckets.length-1){return Math.round(d*1e5)/1e5+"%"}return""}));if(!normalizePositive){yAxis.selectAll("line").filter(function(d,i){return d===0}).style("stroke-dasharray","4 4").style("opacity",.7)}}function drawAnomalies(){var anomalyHeight=Math.round(buckets.length>1?y(buckets[0])-y(buckets[1]):height)-1,anomalyWidth=Math.round(computeAnomalyWidth(anomalyHeight))-1;var plot=$container.selectAll(".anom-plot").data([binData]);plot.enter().append("g").classed("anom-plot",true);plot.exit().remove();var columns=plot.selectAll(".anom-column").data(function(d){return d});columns.enter().append("g").classed("anom-column",true);columns.exit().remove();columns.attr("transform",function(d){return"translate("+x(+d.key)+",0)"});var rows=columns.selectAll(".anom-row").data(function(d){return d.values});rows.enter().append("g").classed("anom-row",true);rows.exit().remove();rows.attr("transform",function(d,i){return"translate(0,"+(y(buckets[i])-anomalyHeight)+")"});var anomalies=rows.selectAll(".anom-anomaly").data(function(d){return d});var anomaliesEnter=anomalies.enter().append("g").attr("class",function(d,i,j){return"datum-"+i+" series-"+j}).classed("anom-anomaly",true);anomalies.attr("transform",function(d,i){var bucket=getBucket(normalizePositive?Math.abs(d[yMapping]):d[yMapping]);if(d[yMapping]>=0){bucket+=binSize}d.bounds={x:x(Date.parse(d[xMapping]))+(i*(anomalyWidth+ANOMALY_PADDING)+ANOMALY_PADDING),y:y(bucket),width:anomalyWidth,height:anomalyHeight};return"translate("+(i*(anomalyWidth+ANOMALY_PADDING)+ANOMALY_PADDING)+",0)"});anomalies.exit().remove();anomaliesEnter.append("rect").classed("anom-cell",true).attr("x",anomalyWidth/2).attr("y",anomalyHeight/2).attr("width",0).attr("height",0);anomalies.selectAll(".anom-cell").attr("fill",function(d){var bucket=getBucket(normalizePositive?Math.abs(d[yMapping]):d[yMapping]);if(normalizePositive&&d[yMapping]<0){bucket*=-1}return gradient(bucket)}).transition().duration(500).attr("x",0).attr("y",0).attr("width",anomalyWidth).attr("height",anomalyHeight);var anomalySelectEnter=anomaliesEnter.append("g").classed("anom-select",true);anomalySelectEnter.append("path").classed("outer-border",true);anomalySelectEnter.append("path").classed("inner-border",true);var anomalySelect=anomalies.selectAll(".anom-select");anomalySelect.select(".outer-border").attr("d",rectPath(0,0,anomalyWidth+.5,anomalyHeight+.5,1));if(anomalyWidth>3){anomalySelect.select(".inner-border").attr("d",rectPath(0,0,anomalyWidth+1,anomalyHeight+1,2))}var rangeSelector=function(start,end){var ox1=start.__data__.bounds.x+start.__data__.bounds.width/2;var oy1=start.__data__.bounds.y+start.__data__.bounds.height/2;var ox2=end.__data__.bounds.x+end.__data__.bounds.width/2;var oy2=end.__data__.bounds.y+end.__data__.bounds.height/2;var extent=new dv.collisions.rectFromMinMax(ox1,oy1,ox2,oy2);var output=[];treeRoot.testRect(extent,function(payload,geometry,node){if(payload!=start){output.push(payload)}});return output};anomaliesEnter.on("contextmenu",function(d,i,j){dispatch.contextmenu.call(this,d,i,j)}).on("mouseover",function(d,i,j){dispatch.mouseover.call(this,d,i,j)}).on("mouseout",function(d,i,j){dispatch.mouseout.call(this,d,i,j)}).on("mousedown",chart.makeSelectHandler(rangeSelector)).on("click",function(d,i){d3.event.preventDefault()}).classed("selectable",true);anomaliesEnter.each(function(d,i){var rect=new dv.collisions.rectFromMinMax(d.bounds.x,d.bounds.y,d.bounds.x+d.bounds.width,d.bounds.y+d.bounds.height);treeRoot.insertRect(rect,this)})}function drawInteractionLayer(){var interactionCanvas=$container.selectAll(".anom-plot").data([0]);interactionCanvas.enter().append("g").classed("anom-plot",true);interactionCanvas.exit().remove()}function rectPath(x,y,width,height,inset){return"M"+inset+","+inset+"L"+(width-inset*2)+","+inset+"L"+(width-inset*2)+","+(height-inset*2)+"L"+inset+","+(height-inset*2)+"z"}function getBucket(y){var i=-1,n=buckets.length;while(++i<n){if(y>=0&&buckets[i]+binSize>y){return buckets[i]}if(y<0&&buckets[i]+binSize>y){return buckets[i]+binSize}}return buckets[0]}function computeAnomalyWidth(anomalyHeight){var bandWidth=(xTickValues.length>1?x(xTickValues[1])-x(xTickValues[0]):width)-BAND_PADDING,maxAnomaliesPerBand=getMaxAnomaliesPerBand();anomalyWidth=bandWidth/maxAnomaliesPerBand;return anomalyWidth>anomalyHeight?anomalyHeight:anomalyWidth}function getMaxAnomaliesPerBand(){var maxAnomalies=0;binData.forEach(function(band){band.values.forEach(function(bandRow){maxAnomalies=Math.max(bandRow.length,maxAnomalies)})});return maxAnomalies}function getMapping(prop){if(mappings[prop]===undefined){throw new MappingNotDefinedException(prop)}return mappings[prop]}function MappingNotDefinedException(prop){this.type="MappingNotDefinedException";this.message="The mapping for property "+prop+" was not defined.";this.toString=function(){return this.type+" - "+this.message}}function EmptyDataException(){this.type="EmptyDataException";this.message="The data is empty or null";this.toString=function(){return this.type+" - "+this.message}}function ParentNotSpecifiedException(){this.type="ParentNotSpecifiedException";this.message="A p was not specified for this visualization";this.toString=function(){return this.type+" - "+this.message}}return anomaly}})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},pathing=Object.create(core),animationDuration=400;pathing.init=function(options){this._type="pathing";this._initDefaultOptions();this.setOptions(options);this._pathLocked=null;this._pathedObj=null;this._activePaths=[];this._lineLocked=null;this._lastSide=0;this._identifiedBehavior=dv.behavior.identified();if(options.enableSelection){this.selectionCache(new dv.util.SelectionCache);var self=this;this._selectionCache.on("selectionChanged",function(source,all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all,function(){return"translate(0,0)"});self._onSelectionChanged(source,all,added,removed,0)})}return this};pathing._initDefaultOptions=function(){var metricName="Visits",defaults={mappings:{},colors:[],theme:"specialDefault",nodeWidth:100,nodeTitleMaxChars:22,nodeTitleTruncationTailLength:10,minNodeHeight:1,avgNodeHeight:30,padding:{top:80,left:30,right:30,bottom:20},metricName:metricName,minNodeHorzPadding:80,nodeVertPadding:34,iterations:32,shouldShowTooltip:function(d,i,event){return true},enableInfoPane:true,enableQuickActionsMenu:true,pivotNode:null,collapseNode:null,expandNode:null,pathSelected:null,toggleNode:null,disableTruncation:false,wrappedTitleLineHeight:1.1,wrappedTitleWidth:100,enableSelection:false};return Object.getPrototypeOf(pathing)._initDefaultOptions.call(this,defaults)};pathing._onAutoResize=function(){this.render()};pathing.reset=function(){Object.getPrototypeOf(pathing).reset.apply(this,arguments)};pathing._preRender=function(){Object.getPrototypeOf(pathing)._preRender.apply(this);var options=this._options,parent=d3.select(options.parent),padding=options.padding;var infoWrapper=parent.selectAll(".pathing-cv-info-wrapper").data([0]);infoWrapper.enter().insert("div",":first-child").classed("pathing-cv-info-wrapper",true);var wrapper=infoWrapper.selectAll(".pathing-cv-wrapper").data([0]);wrapper.enter().insert("div",":first-child").classed("pathing-cv-wrapper",true);wrapper.classed("cv-wrapper",true);var container=wrapper.selectAll(".pathing-cv-container").data([0]);container.enter().insert("div",":first-child").classed("pathing-cv-container",true);var svg=container.selectAll(".pathing-svg").data([0]);svg.enter().append("svg").classed("pathing-svg",true);var paths=svg.selectAll(".pathing-svg-container").data([0]);paths.enter().append("g").classed("pathing-svg-container",true);paths.attr("transform","translate("+padding.left+","+padding.top+")");if(options.enableInfoPane){var pane=infoWrapper.selectAll(".pathing-cv-info-pane").data([0]);pane.enter().append("div").classed("pathing-cv-info-pane",true);pane.exit().remove();var paneContent=pane.selectAll(".info-pane-content").data([0]);paneContent.enter().append("div").classed("info-pane-content",true);paneContent.exit().remove();var paneTitle=paneContent.selectAll(".pathing-cv-info-title").data([0]);paneTitle.enter().append("div").classed("pathing-cv-info-title",true);paneTitle.exit().remove();var paneValue=paneContent.selectAll(".pathing-cv-info-value").data([0]);paneValue.enter().append("div").classed("pathing-cv-info-value",true);paneValue.exit().remove();var panePaths=paneContent.selectAll(".pathing-cv-info-paths").data([0]);panePaths.enter().append("div").classed("pathing-cv-info-paths",true);panePaths.exit().remove()}this._sizeChart();this._createGradients(svg);var pathed=this._pathedObj;if(this._changedOptions&&this._changedOptions.data&&pathed){if(this._isDataObjNode(pathed.data)){this._unlockNode(pathed.data,pathed.elem)()}else{this._unlockLink(pathed.data,pathed.elem)()}}else{container.on("mousemove.node",null).on("click.node",null).on("click.link",null);this._removePathOverlays(container);this._removeNodeOptions(true);this._defaultInformation()}},pathing._render=function(){Object.getPrototypeOf(pathing)._render.apply(this);if(!this._dataAdapter.isValidPathingData()){return}this._createDiagram();var pathed=this._pathedObj;if(this._activePaths.length&&pathed){if(this._isDataObjNode(pathed.data)){this._renderNodePaths(pathed.data,pathed.elem,true);this._showNodeOptions(pathed.data,pathed.elem)}else{this._renderLinkPaths(pathed.data,pathed.elem,true)}}};pathing._postRender=function(){Object.getPrototypeOf(pathing)._postRender.apply(this);this._highlightedOverlay.setUpSelectedOverlay(d3.selectAll(".pathing-svg-container"))};pathing._sizeChart=function(focusElem){clearTimeout(this._wrapperAnimation);clearTimeout(this._scrollAnimation);var options=this._options,data=this._dataAdapter.data(),parent=d3.select(options.parent),self=this,infoWrapper=parent.selectAll(".pathing-cv-info-wrapper"),wrapper=infoWrapper.selectAll(".pathing-cv-wrapper"),container=wrapper.selectAll(".pathing-cv-container"),infoPane=infoWrapper.selectAll(".pathing-cv-info-pane"),parentWidth=options.parent.offsetWidth,parentHeight=options.parent.offsetHeight,visibleWidth=options.width!==undefined&&options.width!==null?dv.util.getPercentValue(options.width,parentWidth):parentWidth,visibleHeight=dv.util.getPercentValue(options.height,parentHeight),infoPaneWidth=options.enableInfoPane?parseInt(infoPane.style("width"),10):0,adjustedWidth=visibleWidth-infoPaneWidth,padding=options.padding;var nodes=data&&data.nodes||[],numCols=this._numColumns=nodes.length&&Math.max.apply(null,nodes.map(function(n){return n.column}))+1||1,colNodeCount=[],maxNodes=0;data.nodes.forEach(function(n,i){if(colNodeCount[n.column]){colNodeCount[n.column]++}else{colNodeCount[n.column]=1}});maxNodes=colNodeCount.length&&Math.max.apply(null,colNodeCount)||0;var containerWidth=adjustedWidth-2,containerHeight=visibleHeight-2,neededWidth=numCols*options.nodeWidth+(numCols-1)*options.minNodeHorzPadding+padding.left+padding.right,neededHeight=maxNodes*options.avgNodeHeight+maxNodes*options.nodeVertPadding+padding.top+padding.bottom,wider=neededWidth>adjustedWidth,taller=neededHeight>visibleHeight;wrapper.classed("is-wider",wider);if(wider){containerWidth=neededWidth;containerHeight-=20}wrapper.classed("is-taller",taller);if(taller){containerHeight=neededHeight;containerWidth-=20}if(options.enableInfoPane){infoWrapper.style("width",visibleWidth+"px").style("height",visibleHeight+"px")}else{infoWrapper.select(".pathing-cv-info-pane").style("display","none")}wrapper.style("width",adjustedWidth+"px").style("height",visibleHeight+"px");container.style("width",containerWidth+"px").style("height",containerHeight+"px");containerHeight=this._measureChart(options,data)+padding.top+padding.bottom;container.style("height",containerHeight+"px")};pathing._getInnerDimensions=function(){var options=this._options,padding=options.padding,container=d3.select(options.parent).select(".pathing-cv-container"),dimensions=container.node().getBoundingClientRect(),width=dimensions.width,height=dimensions.height;this.innerDimensions=[width-padding.right-padding.left,height-padding.top-padding.bottom];return this.innerDimensions};pathing.splitLongWord=function(word,width,tspan){var _self=this,options=this._options;var newWord=[],oldWord=word.split("").reverse(),newWords=[];while(oldWord.length){var c=oldWord.pop();newWord.push(c);tspan.text(newWord.join(""));if(tspan.node().getComputedTextLength()>width){newWord.pop();newWords.push(newWord.join(""));newWord=[c]}}newWords.push(newWord.join(""));newWords.reverse();return newWords};pathing._wrapText=function(text){var options=this._options,words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=options.wrappedTitleLineHeight,x=parseFloat(text.attr("x"))||0,y=parseFloat(text.attr("y"))||0,tspan=text.text(null).append("tspan").attr("x",x).attr("y",y),width=options.wrappedTitleWidth;tspan.style("font-size",options.wrappedTitleFontSize);while(word=words.pop()){line.push(word);tspan.text(line.join(" "));while(tspan.node().getComputedTextLength()>width){if(line.length==1){words=words.concat(this.splitLongWord(word,width,tspan));line=[];break}else{line.pop();tspan.text(line.join(" "));line=[word];++lineNumber;tspan=text.append("tspan").attr("x",x).attr("y",y).attr("dy",lineNumber*lineHeight+"em").text(word)}}}return text};pathing._measureColumns=function(options,data){var _self=this;var path=d3.pathing().nodeWidth(options.nodeWidth).nodePadding(options.nodeVertPadding).size(this._getInnerDimensions()).nodes(data.nodes).links(data.links).minNodeHeight(options.minNodeHeight).layout(options.iterations);var columns=[];data.nodes.map(function(n){if(!columns[n.column]){columns[n.column]=[n]}else{columns[n.column].push(n)}});this.columns=columns;var totalHeight=0;var svg=d3.select(options.parent).select(".pathing-svg");var colHeights=[];columns.forEach(function(col,j){var totalNodeHeights=0;var tempNode=svg.append("g").classed("node",true);col.forEach(function(node,i,row){var text=tempNode.append("text").classed("node-title",true).text(node.label);if(options.disableTruncation){_self._wrapText(text)}node.titleHeight=text.node().getBBox().height;var nodeHeight=Math.max(node.dy,node.titleHeight);node.height=nodeHeight;totalNodeHeights+=i===col.length-1?nodeHeight:nodeHeight+options.nodeVertPadding;text.remove()});tempNode.remove();colHeights.push(totalNodeHeights)});return Math.max.apply(Math,colHeights)};pathing._measureLabels=function(options,nodes){var maxLabelHeight=0,_self=this;var labelData=nodes.filter(function(d){return d.row===0});var svg=d3.select(options.parent).select(".pathing-svg");labelData.forEach(function(d){var text=svg.append("text").classed("node-title",true).text(d.dimensionLabel);if(options.disableTruncation){_self._wrapText(text)}var labelHeight=text.node().getBBox().height;if(labelHeight>maxLabelHeight){maxLabelHeight=labelHeight}text.remove()});this.maxLabelHeight=maxLabelHeight+options.nodeVertPadding;return this.maxLabelHeight};pathing._measureChart=function(options,data){var maxColumnHeight=this._measureColumns(options,data),maxLabelHeight=this._measureLabels(options,data.nodes);return maxLabelHeight+maxColumnHeight};pathing._setOffsets=function(node,upperNode){var options=this._options;this.columns.forEach(function(col,i){col.forEach(function(node,i,row){var upperNode=row[i-1];if(!upperNode){node.y=0}else{var offset=Math.max(upperNode.titleHeight,upperNode.dy);node.y=upperNode.y+offset+options.nodeVertPadding}node.totalY=node.titleHeight})})};pathing._createDiagram=function(){var options=this._options,data=this._dataAdapter.data(),container=d3.select(options.parent).selectAll(".pathing-cv-container"),containerWidth=parseInt(container.style("width"),10),containerHeight=parseInt(container.style("height"),10),path=this._path=d3.pathing().nodeWidth(options.nodeWidth).nodePadding(options.nodeVertPadding).size(this.innerDimensions).nodes(data.nodes).links(data.links).minNodeHeight(options.minNodeHeight).layout(options.interations),d3Parent=d3.select(options.parent);this._setOffsets();this._cvWrapper=d3Parent.selectAll(".cv-wrapper");this._tooltipParent=d3Parent;this._cvWrapper.select(".pathing-cv-container").classed("svg-wrapper",true);if(!data.nodes.some(function(n){return n.column!==0})){var nodeWidth=path.nodeWidth(),padding=options.padding;data.nodes.forEach(function(d){d.x+=(containerWidth-padding.left-padding.right)/2-nodeWidth/2})}var link=this._updateLinks(path,data.links);this._updateNodes(path,data.nodes,link,containerHeight);var svg=d3.select(options.parent).select(".pathing-svg").node();svg.style.display="none";var h=svg.offsetHeight;svg.style.display=""};pathing._updateNodes=function(path,nodeData,link,height){var self=this,options=this._options,svg=d3.select(options.parent).select(".pathing-svg-container"),nodeSelectHandler=this._options.onNodeSelect,padding=this._options.padding,isResize=!this._changedOptions||!this._changedOptions.data,dur=isResize?0:animationDuration;function dragmove(d){var maxY=height-this.getBBox().height-padding.bottom;d3.select(this).attr("transform","translate("+d.x+","+(d.y=Math.max(0,Math.min(maxY,d3.event.y)))+")");path.relayout();link.attr("d",path.link())}function wrap(text,width){text.each(function(){self._wrapText(d3.select(this))})}function truncateTitle(title){if(!title){return}var maxChars=options.nodeTitleMaxChars,endChars=options.nodeTitleTruncationTailLength,delimiter="";if(title.length<=maxChars+endChars){return title}return title.slice(0,Math.max(maxChars-endChars,0))+delimiter+title.slice(title.length-endChars)}function setAlignment(d){var midCol=true,firstCol=false,lastCol=false;if(self._numColumns>1){firstCol=0===d.column;lastCol=self._numColumns-1===d.column;midCol=!(firstCol||lastCol)}d3.select(this).attr("x",midCol?nodeWidth/2:firstCol?2:nodeWidth-4).attr("text-anchor",midCol?"middle":firstCol?"start":"end")}var nodeGroup=svg.selectAll(".node-container").data([0]);nodeGroup.enter().append("g").classed("node-container",true);nodeGroup.exit().remove();var node=nodeGroup.selectAll(".node").data(nodeData,this._dataAdapter.nodeKey()),nodeWidth=path.nodeWidth();svg.selectAll(".path-overlay-container").transition().duration(dur).attr("transform",function(d){return"translate(0,"+self.maxLabelHeight+")"});svg.selectAll(".link-container").transition().duration(dur).attr("transform",function(d){return"translate(0,"+self.maxLabelHeight+")"});nodeGroup.transition().duration(dur).attr("transform",function(d){return"translate(0,"+self.maxLabelHeight+")"});var columnLabels=svg.selectAll(".column-label-container").data([0]);columnLabels.enter().append("g").classed("column-label-container",true);columnLabels.exit().remove();columnLabels.selectAll(".column-label").remove();var labelData=nodeData.filter(function(d){return d.row===0});var dimensionLabels=columnLabels.selectAll(".column-label").data(labelData);dimensionLabels.enter().append("text").attr("transform",function(d){return"translate("+d.x+", 0)"}).classed("column-label",true).text(function(d){return options.disableTruncation?d.dimensionLabel:truncateTitle(d.dimensionLabel)});dimensionLabels.exit().remove();dimensionLabels.each(setAlignment);if(options.disableTruncation){wrap(dimensionLabels)}node.enter().append("g").classed("hide-node",true).attr("transform",function(d){return"translate("+d.x+",0)"});node.attr("id",function(d,i,j){return self._identifiedBehavior.identify(d,i,j)});node.on("mouseover.node",function(d,i){self._showNodePaths(d,this);if(!options.disableTruncation){self._showFullTitle(d,this)}if(!self.getOption("enableInfoPane")&&self.getOption("shouldShowTooltip")(d,i,d3.event)){self._initTooltip(d,d3.event)}self._dispatch.mouseover.call(this,d)}).on("contextmenu.node",self.makeContextMenuHandler(self)).on("contextmenu.node",function(d,i,j,e){self._dispatch.contextmenu.call(this,d)}).on("mouseout.node",function(d,i){self._hideNodePaths();self._truncateFullTitle(d,this);if(!self.getOption("enableInfoPane")){self._teardownTooltip(d,d3.event)}self._dispatch.mouseout.call(this,d)}).on("mousedown.node",self.makeSelectHandler()).on("click.node",function(d,i){if(options.enableQuickActionsMenu){self._activateNode(d,this)}else{self._toggleNode(d,this)}self._dispatch.click.call(this,d)});var exitNodes=node.exit();exitNodes.classed("hide-node",true).on("mousedown.node",null).on("mouseover.node",null).on("mouseout.node",null).on("click.node",null).transition().duration(dur).style("opacity",0).attr("transform",function(d){return"translate("+d.x+",0)"});setTimeout(function(){exitNodes.remove()},dur);node.selectAll(".node-total").remove();node.transition().duration(dur).attr("transform",function(d){return"translate("+d.x+","+d.y+")"});var numCols=this._numColumns;node.each(function(d,i){var e=d3.select(this),isNew=e.classed("hide-node");e.attr("class","node");e.classed("hide-node",isNew);e.classed("filter",d.id==="E_0");e.classed("exit-filter",d.id==="X_0");if(d.classname){e.classed(d.classname,true)}var rect=e.selectAll(".node-bg").data([d]);rect.enter().append("rect").classed("node-bg",true);rect.exit().remove();rect.attr("width",nodeWidth);rect.transition().duration(dur).attr("height",function(d){return d.dy});var text=e.selectAll(".node-title").data([d]);text.enter().append("text").classed("node-title",true).attr("y",-5).attr("transform",null);text.exit().remove();text.each(setAlignment);text.text(function(d){return options.disableTruncation?d.label:truncateTitle(d.label)});if(options.disableTruncation){wrap(text,options.wrappedTitleWidth)}var num=e.selectAll(".node-total").data([d]);num.enter().append("text").classed("node-total",true).attr("y",function(d){return d.totalY}).attr("transform",null);num.exit().remove();num.each(setAlignment);num.text(function(d){return d3.format(",.0f")(d.value)});var hitArea=e.selectAll(".node-hit-area").data([d]);hitArea.enter().append("rect").classed("node-hit-area",true);hitArea.exit().remove();hitArea.attr("height",function(d){return d.dy+4}).attr("y",-4).attr("width",path.nodeWidth()).style("opacity",0);setTimeout(function(){e.classed("hide-node",false)},dur)})};pathing.defaultTooltipContent=function(d){if(this._isDataObjNode(d)){return this.nodeTooltipContent(d)}else{return this.pathTooltipContent(d)}};pathing.nodeTooltipContent=function(d){var content="<span class='series-name'>"+this.escapeHtml(d.label)+"</span>"+"<span class='metric-value'>"+d.value+"</span>";return content};pathing.pathTooltipContent=function(d){function getPathNodeLabel(node){return!!node?node.label:""}var sourceLabel=getPathNodeLabel(d.source),targetLabel=getPathNodeLabel(d.target),content="<span class='series-name'>"+this.escapeHtml(sourceLabel)+" "+this.nodeJoinCharacter+" "+this.escapeHtml(targetLabel)+"</span>"+"<span class='metric-value'>"+d.value+"</span>";return content};pathing.getNodeBounds=function(d,node,rect){var target=node,targetBox;targetBox=target.getBBox();if(target.nodeName==="g"){targetBox=target.getBBox();var translate=this._getNodeTranslation(target);targetBox.x+=translate.x;targetBox.y+=translate.y}return{x:targetBox.x,y:targetBox.y,height:targetBox.height,width:0}};pathing._getTooltipBounds=function(d,e,rect){var mouseCoords=d3.mouse(this._options.parent),x=mouseCoords[0],y=mouseCoords[1];return{x:x,y:y,height:0,width:0}};pathing.nodeJoinCharacter="&#x2192;";pathing._toggleNode=function(data,node){var options=this._options,adapter=this._dataAdapter;data.canExpand=adapter.canExpandNode(data);data.canCollapse=adapter.canCollapseNode(data);if(typeof options.toggleNode==="function"){options.toggleNode.call(this,data)}};pathing.gradientCounter={count:0};pathing._updateLinks=function(path,linkData){var options=this._options,self=this,svg=d3.select(options.parent).select(".pathing-svg-container"),container=d3.select(options.parent).selectAll("svg"),defs=container.selectAll("defs").data([0]),isResize=!this._changedOptions||!this._changedOptions.data,dur=isResize?0:animationDuration;defs.enter().append("defs");var group=defs.selectAll(".path-fills").data([0]),groupEnter=group.enter().append("g").classed("path-fills",true);var linkGroup=svg.selectAll(".link-container").data([0]);linkGroup.enter().append("g").classed("link-container",true);linkGroup.exit().remove();var linkOverlays=svg.selectAll(".path-overlay-container").data([0]);linkOverlays.enter().append("g").classed("path-overlay-container",true);linkOverlays.exit().remove();var link=linkGroup.selectAll("path").data(linkData,this._dataAdapter.linkKey());link.enter().append("path").classed("hide-link",true);link.on("mouseover.link",function(d,i){self._showLinkPaths(d,this)}).on("mousedown.link",self.makeSelectHandler()).on("mouseout.link",function(d,i){self._hideLinkPaths()});if(options.enableInfoPane){link.on("click.link",function(d,i){self._activateLink(d,this)})}var exitLinks=link.exit();exitLinks.classed("hide-link",true).on("mousedown.link",null).on("click.link",null).on("mouseover.link",null).on("mouseout.link",null);setTimeout(function(){exitLinks.remove()},dur);link.each(function(d,i){var e=d3.select(this),isNew=e.classed("hide-link");e.attr("class",function(d){return!d.source?"entry":!d.target?"exit":"link"});e.classed("hide-link",isNew);if(e.classed("hide-link")){e.attr("d",path.link()(d));setTimeout(function(){e.classed("hide-link",false)},dur)}else{e.transition().duration(dur).attr("d",path.link()(d))}if(d.source&&"E_0"===d.source.id){e.classed("entry-path",true)}else if(d.target&&"X_0"===d.target.id){e.classed("exit-path",true)}var efilter=d.source&&"E_0"===d.source.id,xfilter=d.target&&"X_0"===d.target.id;e.classed("filter",efilter);e.classed("exit-filter",xfilter)});return link};pathing._createGradients=function(svgContainer){var styles=svgContainer.selectAll("style").data([0]);styles.enter().append("style");styles.text(function(d){var style=".pathing-svg .exit { fill: url(#exitFill); } \n";style+=".pathing-svg .entry { fill: url(#entryFill); } \n";style+=".pathing-svg .exit:hover { fill: url(#exitHighlightFill); } \n";style+=".pathing-svg .entry:hover { fill: url(#entryHighlightFill); } \n";style+=".pathing-svg .pivot-entry { mask: url(#pivotEnterMask); } \n";style+=".pathing-svg .pivot-exit { mask: url(#pivotExitMask); } \n";style+=".pathing-svg .link-container .entry-path { fill: url(#entryGradient); } \n";style+=".pathing-svg .link-container .exit-path { fill: url(#exitGradient); } \n";return style});var svg=d3.select("body").selectAll("svg.global-cv-pathing-defs").data([0]);svg.enter().append("svg").classed("global-cv-pathing-defs",true);var defs=svg.selectAll("defs").data([0]);defs.enter().append("defs");var group=defs.selectAll(".bounce-fills").data([0]),groupEnter=group.enter().append("g").classed("bounce-fills",true);var pivotEnterGrad=groupEnter.append("linearGradient").attr("id","pivotEnterGrad");pivotEnterGrad.append("stop").attr("offset","0%").style("stop-color","#fff").style("stop-opacity",0);pivotEnterGrad.append("stop").attr("offset","50%").style("stop-color","#fff").style("stop-opacity",0);pivotEnterGrad.append("stop").attr("offset","70%").style("stop-color","#fff").style("stop-opacity",.5);pivotEnterGrad.append("stop").attr("offset","100%").style("stop-color","#fff").style("stop-opacity",1);var pivotEnterMask=groupEnter.append("mask").attr("id","pivotEnterMask").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("maskUnits","objectBoundingBox").attr("maskContentUnits","objectBoundingBox");pivotEnterMask.append("rect").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("fill","url(#pivotEnterGrad)");var pivotExitGrad=groupEnter.append("linearGradient").attr("id","pivotExitGrad").attr("x1","100%").attr("y1","0%").attr("x2","0%").attr("y2","0%");pivotExitGrad.append("stop").attr("offset","0%").style("stop-color","#fff").style("stop-opacity",0);pivotExitGrad.append("stop").attr("offset","50%").style("stop-color","#fff").style("stop-opacity",0);pivotExitGrad.append("stop").attr("offset","70%").style("stop-color","#fff").style("stop-opacity",.5);pivotExitGrad.append("stop").attr("offset","100%").style("stop-color","#fff").style("stop-opacity",1);var pivotExitMask=groupEnter.append("mask").attr("id","pivotExitMask").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("maskUnits","objectBoundingBox").attr("maskContentUnits","objectBoundingBox");pivotExitMask.append("rect").attr("x","0").attr("y","0").attr("width","1").attr("height","1").attr("fill","url(#pivotExitGrad)");var entryGradient=groupEnter.append("linearGradient").attr("id","entryGradient").attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%");entryGradient.append("stop").attr("offset","0%").style("stop-color","#8cc350");entryGradient.append("stop").attr("offset","100%").style("stop-color",this._options.colors?this._options.colors[1]:"#3287D2");group.select("#entryGradient stop + stop").style("stop-color",this._options.colors[1]);var exitGradient=groupEnter.append("linearGradient").attr("id","exitGradient").attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%");exitGradient.append("stop").attr("offset","0%").style("stop-color",this._options.colors?this._options.colors[1]:"#3287D2");exitGradient.append("stop").attr("offset","100%").style("stop-color","#cc2539");group.select("#exitGradient stop").style("stop-color",this._options.colors[1]);var exitFill=groupEnter.append("linearGradient").attr("id","exitFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");exitFill.append("stop").attr("offset","0%").style("stop-color","#FA5A50").style("stop-opacity",.5);exitFill.append("stop").attr("offset","85%").style("stop-color","#FA5A50").style("stop-opacity",.5);exitFill.append("stop").attr("offset","100%").style("stop-color","#FA5A50").style("stop-opacity",.1);var exitHighlightFill=groupEnter.append("linearGradient").attr("id","exitHighlightFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");exitHighlightFill.append("stop").attr("offset","0%").style("stop-color","#FA5A50").style("stop-opacity",1);exitHighlightFill.append("stop").attr("offset","85%").style("stop-color","#FA5A50").style("stop-opacity",1);exitHighlightFill.append("stop").attr("offset","100%").style("stop-color","#FA5A50").style("stop-opacity",.1);var entriesFill=groupEnter.append("linearGradient").attr("id","entryFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");entriesFill.append("stop").attr("offset","0%").style("stop-color","#58AF5E").style("stop-opacity",.1);entriesFill.append("stop").attr("offset","15%").style("stop-color","#58AF5E").style("stop-opacity",.5);entriesFill.append("stop").attr("offset","100%").style("stop-color","#58AF5E").style("stop-opacity",.5);var entriesHighlightFill=groupEnter.append("linearGradient").attr("id","entryHighlightFill").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");entriesHighlightFill.append("stop").attr("offset","0%").style("stop-color","#58AF5E").style("stop-opacity",.1);entriesHighlightFill.append("stop").attr("offset","15%").style("stop-color","#58AF5E").style("stop-opacity",1);entriesHighlightFill.append("stop").attr("offset","100%").style("stop-color","#58AF5E").style("stop-opacity",1)};pathing._setOptionContainerContent=function(container,data){var options=this._options,content="",node,numOptions=0,last=container.classed("is-last-column"),adapter=this._dataAdapter,l10n=adapter.l10n.labels.pathing,nodeOptions=[{id:"expand",label:l10n.expand,valid:options.expandNode&&adapter.canExpandNode(data)},{id:"pivot",label:l10n.focus,valid:options.pivotNode&&adapter.canPivotNode(data)},{id:"collapse",label:l10n.collapse,valid:options.collapseNode&&adapter.canCollapseNode(data)}];if(last){nodeOptions.reverse()}nodeOptions=nodeOptions.filter(function(n){return n.valid});if(options.expandNode||options.collapseNode||options.pivotNode){for(var i=0,ii=nodeOptions.length;i<ii;++i){node=nodeOptions[i];content+='<a class="cv-node-option cv-node-option'+(last?ii-numOptions-1:numOptions)+" cv-node-"+node.id+'"><i class="'+node.id+'"></i><span>'+pathing.escapeHtml(node.label)+"</span></a>";++numOptions}}content='<div class="cv-node-options num-options-'+numOptions+'">'+content+"</div>";container.html(content)};pathing._activateNode=function(data,node){var self=this,activeNode;if(this._pathLocked&&data===this._pathLocked.data){self._unlockNode(data,node)();var side=d3.mouse(node)[0]>=self._options.nodeWidth/2?1:-1;if(!data.isPivot||side===self._lastSide){return}}this._setPathLocked({data:data,elem:node});d3.select(self._options.parent).select(".pathing-cv-container").on("click.node",null).on("click.link",null);activeNode=d3.selectAll(".cv-node-active");activeNode.classed("cv-node-active",false);d3.selectAll(".cv-link-active").classed("cv-link-active",false);d3.select(node).classed("cv-node-active",true);if(activeNode.node()){this._truncateFullTitle(activeNode.datum(),activeNode.node())}this._renderNodePaths(data,node);this._showNodeOptions(data,node);this._showInformation(data,node);this._scrollToElem(node);this._showFullTitle(data,node);setTimeout(function(){d3.select(self._options.parent).select(".pathing-cv-container").on("click.node",self._unlockNode(data,node))},10)};pathing._showNodePaths=function(data,node){if(this._pathLocked){return}this._renderNodePaths(data,node)};pathing._showFullTitle=function(data,node){var title=d3.select(node).select(".node-title");if(title.text()!==data.label){node.parentNode.appendChild(node);data.truncation=title.text();title.text(data.label);this._titleBackground(title,true)}};pathing._truncateFullTitle=function(data,node){if(this._pathLocked&&this._pathLocked.data===data){return}if(data.truncation){var title=d3.select(node).select(".node-title");title.text(data.truncation);this._titleBackground(title,false)}};pathing._titleBackground=function(title,visible){var container=d3.select(title.node().parentNode),titleRect,titleWidth;if(!visible){container.select(".text-bg").remove()}else{titleRect=title.node().getBoundingClientRect();titleWidth=titleRect.width+10;container.insert("rect",":first-child").classed("text-bg",true).attr("height",titleRect.height).attr("width",titleWidth).attr("x",this._getTitleBackgroundXValue(title,titleWidth)).attr("y",(titleRect.height+1)*-1)}};pathing._getTitleBackgroundXValue=function(title,width){var titleX=title.attr("x");if(title.attr("text-anchor")==="start"){return titleX}else if(title.attr("text-anchor")==="middle"){return titleX-width/2}else if(title.attr("text-anchor")==="end"){return titleX-width}};pathing._renderNodePaths=function(data,node,resize){var parent=d3.select(this._options.parent).select(".pathing-cv-container");clearTimeout(this._hidePathOverlaysTimer);parent.on("mousemove.node",null);if(this._pathedObj&&this._pathedObj.data===data&&!resize){return}this._setPathedObj({data:data,elem:node});var side=0,self=this,overlays,paths,nodePaths=this._dataAdapter.nodePaths(data);function sideLinkPaths(){paths=self._activePaths=nodePaths.filter(function(p){var index=p.nodes.indexOf(data._pid);return side>0&&index+1<p.nodes.length||side<0&&index>0});overlays=self._dataAdapter.nodePathData(paths,data,side);self._createPathOverlays(overlays)}function updateLinkPaths(){var x=0;try{x=d3.mouse(node)[0]}catch(e){}var newSide=x>=self._options.nodeWidth/2?1:-1;if(newSide!==side){self._lastSide=side=newSide;sideLinkPaths()}}if(data.isPivot){if(resize){side=self._lastSide;sideLinkPaths()}else{updateLinkPaths();if(!self._pathLocked){parent.on("mousemove.node",function(d,i){updateLinkPaths()})}}}else{self._lastSide=0;self._activePaths=nodePaths;overlays=this._dataAdapter.nodePathData(nodePaths,data,side);self._createPathOverlays(overlays)}setTimeout(function(){parent.classed("path-overlays",true)},1)};pathing._showNodeOptions=function(data,node){var self=this,numCols=this._numColumns,parent=d3.select(this._options.parent).select(".pathing-cv-container"),offsetContainer=parent.node(),options=this._options,delay=50,rectNode=d3.select(node).select(".node-bg").node(),containerBounds=offsetContainer.getBoundingClientRect(),nodeBounds=rectNode.getBoundingClientRect(),top=nodeBounds.top-containerBounds.top,left=nodeBounds.left-containerBounds.left+options.nodeWidth/2,optionContainer=parent.select(".cv-path-node-options");if(optionContainer.empty()){optionContainer=parent.append("div").classed("cv-path-node-options",true).attr("node",data._pid)}else if(optionContainer.attr("node")==data._pid&&optionContainer.classed("is-open")){}else{this._removeNodeOptions();delay=300;optionContainer=parent.append("div").classed("cv-path-node-options",true).attr("node",data._pid)}optionContainer.classed("is-last-column",numCols>1&&numCols-1===data.column).style("top",top+"px").style("left",left+"px");this._setOptionContainerContent(optionContainer,data);setTimeout(function(){optionContainer.classed("is-open",true)},delay)};pathing._formatMetricValue=function(d){return this._formatNumber("decimal",d.value,null,{dataItem:d})+" "+this._options.metricName};pathing._formatPathInformation=function(t){var options=this._options,self=this,colors=options.colors;return function(d,i){var endNode=self._dataAdapter.getPathEnd(d),total=endNode?endNode.value?endNode.value:t:t,content="",value=d.values[0],percent=value/total;i=i%colors.length;content+='<span class="pathing-path-marker" style="background-color: '+pathing.escapeHtml(colors[i])+'"></span>';content+='<span class="pathing-path-value"><span class="pathing-path-num">'+pathing.escapeHtml(self._formatNumber("decimal",value,null,{dataItem:d}))+'</span> <span class="pathing-path-perc">'+pathing.escapeHtml(self._formatNumber("percent",percent,null,{dataItem:d}))+"</span></span>";return content}};pathing._highlightPath=function(data,index,elem){var options=this._options,parent=options.parent,e=d3.event,lock=!e||e&&"click"===e.type,container=d3.select(parent).selectAll(".path-overlay-container"),infoContainer=d3.select(parent).selectAll(".pathing-cv-info-pane"),line=container.selectAll(".link.path"+index),links=container.selectAll(".link:not(.path"+index+")");if(lock&&options.enableInfoPane){if(this._lineLocked===data){this._setLineLock(null);return this._removeHightlightPath()}this._setLineLock(data);infoContainer.selectAll(".locked").classed("locked",false);d3.select(elem).classed("locked",true)}else if(this._lineLocked){return}container.selectAll(".link.inactive").classed("inactive",false);links.classed("inactive",true);line.classed("active",true)};pathing._setLineLock=function(d){var options=this._options;if(this._lineLocked===d){return}this._lineLocked=d;this._callPathSelected(d)};pathing._setPathedObj=function(d){this._pathedObj=d};pathing._setPathLocked=function(d){var options=this._options;if(this._pathLocked===d){return}this._pathLocked=d;this._callPathSelected()};pathing._callPathSelected=function(path){var params={},options=this._options,data=this._pathLocked&&this._pathLocked.data||{};if(path){params.path=path.nodes+""}if("undefined"!==typeof data._pid){params.node=data._pid;params.side=this._lastSide}if("undefined"!==typeof data.source||"undefined"!==typeof data.target){params.source=data.source?data.source._pid:null;params.target=data.target?data.target._pid:null}if("function"==typeof options.pathSelected){options.pathSelected(params,this._pathLocked,path)}};pathing._removeHightlightPath=function(){if(this._lineLocked){return}var options=this._options,parent=options.parent,infoContainer=d3.select(parent).selectAll(".pathing-cv-info-pane"),links=d3.select(parent).selectAll(".path-overlay-container").selectAll(".link");links.classed("inactive",false).classed("active",false);if(options.enableInfoPane){infoContainer.selectAll(".locked").classed("locked",false)}};pathing._showInformation=function(data,elem){var options=this._options;if(!options.enableInfoPane){return}var self=this,content="",isNode=this._isDataObjNode(data),l10n=this._dataAdapter.l10n.labels.pathing,pane=d3.select(this._options.parent).select(".pathing-cv-info-pane"),paneTitle=pane.selectAll(".pathing-cv-info-title"),paneValue=pane.selectAll(".pathing-cv-info-value"),panePaths=pane.selectAll(".pathing-cv-info-paths");this._setLineLock(null);this._removeHightlightPath();var label,value=this._formatMetricValue(data),last=false;if(isNode){label=pathing.escapeHtml(data.label);value=pathing.escapeHtml(this._formatMetricValue(data));last=data.column==this._numColumns-1}else{var pattern=l10n.percOfNode;if(!data.source){label=l10n["nodeEntries"].replace(/\{label\}/i,data.target.label);value=this._formatMetricValue(data)+'<span class="perc">'+pathing.escapeHtml(pattern.replace(/\{perc\}/i,this._formatNumber("percent",data.value/data.target.value,null,{dataItem:data})).replace(/\{label\}/i,data.target.label))+"</span>"}else if(!data.target){label=l10n["nodeExits"].replace(/\{label\}/i,data.source.label);value=this._formatMetricValue(data)+'<span class="perc">'+pathing.escapeHtml(pattern.replace(/\{perc\}/i,this._formatNumber("percent",data.value/data.source.value,null,{dataItem:data})).replace(/\{label\}/i,data.source.label))+"</span>"}else{var adapter=this._dataAdapter,dir=adapter.getPathDirection(adapter.data().paths[data.paths[0]]),node=dir<0?data.target:data.source;label=l10n["nodeToNode"].replace(/\{source\}/i,data.source.label).replace(/\{target\}/i,data.target.label);value=this._formatMetricValue(data)+'<span class="perc">'+pathing.escapeHtml(pattern.replace(/\{perc\}/i,this._formatNumber("percent",data.value/node.value,null,{dataItem:data})).replace(/\{label\}/i,node.label))+"</span>"}}pane.classed("is-last-column",last);paneTitle.html(label);paneValue.html(value);var pathTitle=panePaths.selectAll(".pathing-cv-path-title").data([0]);pathTitle.enter().append("span").classed("pathing-cv-path-title",true);pathTitle.html(this._dataAdapter.activePathsTitle(this._activePaths));var path=panePaths.selectAll(".pathing-cv-path-info").data(this._activePaths);path.enter().append("span").classed("pathing-cv-path-info",true);if(options.enableInfoPane){path.on("click.line",function(d,i){self._highlightPath(d,i,this)}).html(this._formatPathInformation(data.value))}path.on("mouseover.line",function(d,i){self._highlightPath(d,i,this)}).on("mousedown.line",self.makeSelectHandler()).on("mouseout.line",function(d,i){self._removeHightlightPath()});path.exit().on("mousedown.line",null).on("click.line",null).on("mouseover.line",null).on("mouseout.line",null).remove()};pathing._defaultInformation=function(){var options=this._options;if(!options.enableInfoPane){return}this._setLineLock(null);this._removeHightlightPath();var pane=d3.select(options.parent).select(".pathing-cv-info-pane"),paneTitle=pane.selectAll(".pathing-cv-info-title"),paneValue=pane.selectAll(".pathing-cv-info-value"),panePaths=pane.selectAll(".pathing-cv-info-paths"),l10n=this._dataAdapter.l10n.labels.pathing;var help="<p>"+l10n.help1+"</p>";help+="<p>"+l10n.help2+"</p>";help+="<p>"+l10n.help3+"</p>";help+='<p><span class="cv-node-option"><i class="pivot"></i></span><span class="cv-option-title">'+l10n.focus+"</span></p>";help+="<p>"+l10n.focusHelp+"</p>";help+='<p><span class="cv-node-option"><i class="expand"></i></span><span class="cv-option-title">'+l10n.expand+"</span></p>";help+="<p>"+l10n.expandHelp+"</p>";help+='<p><span class="cv-node-option"><i class="collapse"></i></span><span class="cv-option-title">'+l10n.collapse+"</span></p>";help+="<p>"+l10n.collapseHelp+"</p>";paneTitle.html(l10n.title);paneValue.html('<div class="help">'+help+"</div>");panePaths.html("")};pathing._scrollToElem=function(elem){var options=this._options,parent=d3.select(this._options.parent).select(".pathing-cv-container"),offsetContainer=parent.node(),wrapper=d3.select(options.parent).select(".pathing-cv-wrapper"),node=d3.select(elem),rectNode=!node.selectAll(".node-bg").empty()?node.select(".node-bg").node():node.node(),containerBounds=offsetContainer.getBoundingClientRect(),nodeBounds=rectNode.getBoundingClientRect(),top=nodeBounds.top-containerBounds.top,left=nodeBounds.left-containerBounds.left+options.nodeWidth/2;if(!wrapper.classed("is-wider")&&!wrapper.classed("is-taller")){return}function scrollTween(offsetX,offsetY){return function(){var iX=offsetX!==null?d3.interpolateNumber(wrapper.node().scrollLeft,offsetX):null,iY=offsetY!==null?d3.interpolateNumber(wrapper.node().scrollTop,offsetY):null;return function(t){if(iX!==null){wrapper.node().scrollLeft=iX(t)}if(iY!==null){wrapper.node().scrollTop=iY(t)}}}}var scrollX=null,scrollY=null;if(wrapper.classed("is-wider")){var viewportWidth=parseInt(wrapper.style("width"),10),visibleWidth=parseInt(parent.style("width"),10);scrollX=Math.min(visibleWidth-viewportWidth,Math.max(0,left-viewportWidth/2))}if(wrapper.classed("is-taller")){var viewportHeight=parseInt(wrapper.style("height"),10),visibleHeight=parseInt(parent.style("height"),10);scrollY=Math.min(visibleHeight-viewportHeight,Math.max(0,top+40-viewportHeight/2))}d3.transition().duration(300).tween("scroll",scrollTween(scrollX,scrollY))};pathing._unlockNode=function(data,node){var self=this;return function(d,i){self._setPathLocked(null);d3.select(self._options.parent).select(".pathing-cv-container").on("click.node",null);self._deactivateNode(d3.event,data,node);self._truncateFullTitle(data,node)}},pathing._deactivateNode=function(e,d,node){d3.select(node).classed("cv-node-active",false);this._removeNodeOptions(false);this._defaultInformation();this._hideNodePaths();if(!e){return}var target=d3.select(e.target),options=this._options,data=d||{};if("click"===e.type){if(!target.classed("cv-node-option")){target=d3.select(target.node().parentNode)}if(target.classed("cv-node-expand")&&"function"===typeof options.expandNode){options.expandNode(data)}if(target.classed("cv-node-collapse")&&"function"===typeof options.collapseNode){options.collapseNode(data)}if(target.classed("cv-node-pivot")&&"function"===typeof options.pivotNode){options.pivotNode(data)}}};pathing._removeNodeOptions=function(now){var container=d3.selectAll(".cv-path-node-options");container.classed("is-open",false);setTimeout(function(){container.remove()},now?0:300)};pathing._hideNodePaths=function(){var parent=d3.select(this._options.parent).select(".pathing-cv-container");parent.on("mousemove.node",null);if(this._pathLocked){return}this._removePathOverlays(parent)};pathing._activateLink=function(data,link){var self=this;if(this._pathLocked&&data===this._pathLocked.data){self._unlockLink(data,link);return}this._setPathLocked({data:data,elem:link});d3.select(self._options.parent).select(".pathing-cv-container").on("click.node",null).on("click.link",null);d3.selectAll(".cv-node-active").classed("cv-node-active",false);d3.selectAll(".cv-link-active").classed("cv-link-active",false);d3.select(link).classed("cv-link-active",true);this._removeNodeOptions();this._renderLinkPaths(data,link);this._showInformation(data,link);this._scrollToElem(link);setTimeout(function(){d3.select(self._options.parent).select(".pathing-cv-container").on("click.link",self._unlockLink(data,link))},10)};pathing._showLinkPaths=function(data,link){if(this._pathLocked){return}if(!this.getOption("enableInfoPane")){this._initTooltip(data,d3.event)}this._renderLinkPaths(data,link)};pathing._renderLinkPaths=function(data,link,resize){clearTimeout(this._hidePathOverlaysTimer);if(this._pathedObj&&this._pathedObj.data===data&&!resize){return}this._setPathedObj({data:data,elem:link});var adapter=this._dataAdapter;this._activePaths=adapter.linkSortActivePaths(data);this._createPathOverlays(adapter.linkPathData(this._activePaths));var parent=d3.select(this._options.parent).select(".pathing-cv-container");setTimeout(function(){parent.classed("path-overlays",true)},1)};pathing._unlockLink=function(data,link){var self=this;return function(d,i){self._setPathLocked(null);d3.select(self._options.parent).select(".pathing-cv-container").on("click.link",null);self._deactivateLink(d3.event,data,link)}},pathing._deactivateLink=function(e,d,link){var parent=d3.select(this._options.parent).select(".pathing-cv-container");d3.select(link).classed("cv-link-active",false);this._defaultInformation();this._hideLinkPaths()};pathing._hideLinkPaths=function(){var parent=d3.select(this._options.parent).select(".pathing-cv-container");if(this._pathLocked){return}if(!this.getOption("enableInfoPane")){this._teardownTooltip()}this._removePathOverlays(parent)};pathing._createPathOverlays=function(links){var options=this._options,path=this._path,linkOverlay=d3.select(options.parent).select(".path-overlay-container"),link=linkOverlay.selectAll("path").data(links);link.enter().append("path");link.exit().remove();link.attr("class",function(d){var pivot=d.pivotStart?" pivot-entry":d.pivotEnd?" pivot-exit":"";return"link path"+d.path+pivot}).attr("d",path.link()).attr("style",function(d,i){var p=d.path%options.colors.length;return"fill: "+options.colors[p]+";"}).sort(function(a,b){if(!a&&!b){return 0}if(!a){return 1}if(!b){return-1}return b.dy-a.dy})};pathing._removePathOverlays=function(parent){clearTimeout(this._hidePathOverlaysTimer);this._setPathedObj(null);this._hidePathOverlaysTimer=setTimeout(function(){parent.classed("path-overlays",false)},20)};pathing.getColumnElementsByDataNode=function(dataNode){var nodes=this._cvWrapper.select("svg").selectAll(".node").filter(function(d){return d.column===dataNode.column});return nodes};pathing.getColumnBBox=function(node){var targetColumn=this.columns[node.datum().column],translation=this._getNodeTranslation(this._cvWrapper.select(".pathing-svg-container").node()),width=node.node().getBBox().width,x=targetColumn[0].x+translation.x,y=targetColumn[0].y+translation.y+this.maxLabelHeight-15;var height=targetColumn.reduce(function(acc,col){return acc+col.height},0);height+=this._options.nodeVertPadding*(targetColumn.length-1)+15;var columnBox={width:width,height:height,x:x,y:y};return columnBox};pathing._isDataObjNode=function(data){return"undefined"!==typeof data._pid};pathing.setActivePath=function(params){var options=this._options,self=this,data=this._dataAdapter.data();params=params||{};var isNode="undefined"!==typeof params.node,type,elems;if(isNode){type=data.nodesById[params.node]}else{type=data.links.filter(function(l){return(!l.source&&!params.source||l.source&&params.source&&l.source._pid+""===params.source)&&(!l.target&&!params.target||l.target&&params.target&&l.target._pid+""===params.target)});type=type.length&&type[0]||null}elems=isNode?".node":".link";if(!type){return}var hasPath=false,path;hasPath=data.paths.some(function(p){path=p.nodes;return p.nodes.toString()===params.path});d3.select(options.parent).selectAll(elems).each(function(d,i){if(d===type){if(isNode){self._activateNode(d,this)}else{self._activateLink(d,this)}if(!hasPath){return}d3.select(options.parent).selectAll(".pathing-cv-path-info").filter(function(d,i){if(d.nodes.toString()===path.toString()){self._highlightPath(d,i,this)}})}})};global.cloudViz.pathing=cloudViz.util.createConstructor(pathing)})(this);(function(global){"use strict";d3.pathing=function(){var pathing={},nodeWidth=24,nodePadding=8,size=[1,1],nodes=[],links=[],numColumns=NaN,minNodeHeight=0;pathing.nodeWidth=function(_){if(!arguments.length){return nodeWidth}nodeWidth=+_;return pathing};pathing.nodePadding=function(_){if(!arguments.length){return nodePadding}nodePadding=+_;return pathing};pathing.nodes=function(_){if(!arguments.length){return nodes}nodes=_;return pathing};pathing.links=function(_){if(!arguments.length){return links}links=_;return pathing};pathing.size=function(_){if(!arguments.length){return size}size=_;return pathing};pathing.numColumns=function(){return numColumns};pathing.minNodeHeight=function(_){if(!arguments.length){return minNodeHeight}minNodeHeight=_;return pathing};pathing.layout=function(iterations){computeNodeLinks();computeNodeValues();computeNodeBreadths();computeNodeDepths(iterations);computeLinkDepths();return pathing};pathing.relayout=function(){computeLinkDepths();return pathing};pathing.link=function(){var curvature=.5;function link(d){var x0,x1,xi,x2,x3,x4,x5,y0,y1,y2,y3,curveWidth,curveHeight,heightOffset=5,maxWidth=15;curveWidth=curveHeight=Math.min(d.dy+heightOffset,maxWidth);if(d.source===null){x0=d.target.x-curveWidth;x1=d.target.x;y0=d.target.y-heightOffset;y1=d.target.y+d.dy;return"M"+x0+","+y0+"h"+curveWidth+"v"+(y1-y0)+"c-"+curveWidth+",0"+",-"+curveWidth+",-"+curveHeight/2+",-"+curveWidth+",-"+curveHeight+"z"}if(d.target===null){x0=d.source.x+d.source.dx;x1=d.source.x+d.source.dx+curveWidth;y0=d.source.y+d.source.dy-d.dy;y1=d.source.y+d.source.dy+heightOffset;return"M"+x1+","+y1+"h-"+curveWidth+"v-"+(y1-y0)+"c"+curveWidth+",0"+","+curveWidth+","+curveHeight/2+","+curveWidth+","+curveHeight+"V"+y1+"z"}x0=d.source.x+d.source.dx,x1=d.target.x,xi=d3.interpolateNumber(x0,x1),x2=xi(curvature),x3=xi(1-curvature),x4=x3+(d.dy<15?d.source.y<d.target.y?-1*d.dy:d.dy:0),x5=x2+(d.dy<15?d.source.y<d.target.y?-1*d.dy:d.dy:0),y0=d.source.y+d.sy,y1=d.target.y+d.ty,y2=y1+d.dy,y3=y0+d.dy;return"M"+x0+","+y0+"C"+x2+","+y0+" "+x3+","+y1+" "+x1+","+y1+"v"+d.dy+"C"+x4+","+y2+" "+x5+","+y3+" "+x0+","+y3+"Z"}link.curvature=function(_){if(!arguments.length){return curvature}curvature=+_;return link};return link};function computeNodeLinks(){nodes.forEach(function(node){node.sourceLinks=[];node.targetLinks=[];node.entryLinks=[];node.exitLinks=[]});links.forEach(function(link){var source=link.source,target=link.target;if(source!==null&&typeof source==="number"){source=link.source=nodes[link.source]}if(target!==null&&typeof target==="number"){target=link.target=nodes[link.target]}if(source!==null&&target!==null){source.sourceLinks.push(link);target.targetLinks.push(link)}else if(source===null){target.entryLinks.push(link)}else{source.exitLinks.push(link)}})}function computeNodeValues(){nodes.forEach(function(node){if(node.hasOwnProperty("total")){node.value=node.total}else{node.value=Math.max(d3.sum(node.sourceLinks,value)+d3.sum(node.exitLinks,value),d3.sum(node.targetLinks,value)+d3.sum(node.entryLinks,value))}});function hasLinks(node){return node.sourceLinks&&node.sourceLinks.length||node.targetLinks&&node.targetLinks.length||node.exitLinks&&node.exitLinks.length||node.entryLinks&&node.entryLinks.length}nodes.sort(function(a,b){if(a.isMoreNode){return 1}if(b.isMoreNode){return-1}var al=hasLinks(a),bl=hasLinks(b);if(al&&!bl){return-1}if(bl&&!al){return 1}return b.value-a.value})}function computeNodeBreadths(){var x=0,columns=[],nodeSize=size[0]-nodeWidth;nodes.forEach(function(node){node.x=node.column;node.dx=nodeWidth;if(columns.indexOf(node.column)<0){columns.push(node.column);node.columnIndex=columns.length-1}else{node.columnIndex=columns.indexOf(node.column)}});numColumns=columns.length;scaleNodeBreadths(numColumns>1?nodeSize/(numColumns-1):nodeSize)}function moveSourcesRight(){nodes.forEach(function(node){if(!node.targetLinks.length){node.x=d3.min(node.sourceLinks,function(d){return d.target.x})-1}})}function moveSinksRight(x){nodes.forEach(function(node){if(!node.sourceLinks.length){node.x=x-1}})}function scaleNodeBreadths(kx){nodes.forEach(function(node){node.x*=kx})}function computeNodeDepths(iterations){var nodesByBreadth=d3.nest().key(function(d){return d.x}).sortKeys(d3.ascending).entries(nodes).map(function(d){return d.values});function initializeNodeDepth(){var ky=d3.min(nodesByBreadth,function(nodes){var sum=d3.sum(nodes,value)||1;return(size[1]-(nodes.length-1)*nodePadding)/sum});nodesByBreadth.forEach(function(nodes){nodes.forEach(function(node,i){node.y=i;node.row=i;node.dy=Math.max(minNodeHeight,node.value*ky)})});links.forEach(function(link){link.dy=link.value*ky})}function relaxLeftToRight(alpha){nodesByBreadth.forEach(function(nodes,breadth){nodes.forEach(function(node){if(node.targetLinks.length){var y=d3.sum(node.targetLinks,weightedSource)/d3.sum(node.targetLinks,value);node.y+=(y-center(node))*alpha}})});function weightedSource(link){return center(link.source)*link.value}}function relaxRightToLeft(alpha){nodesByBreadth.slice().reverse().forEach(function(nodes){nodes.forEach(function(node){if(node.sourceLinks.length){var y=d3.sum(node.sourceLinks,weightedTarget)/d3.sum(node.sourceLinks,value);node.y+=(y-center(node))*alpha}})});function weightedTarget(link){return center(link.target)*link.value}}function resolveCollisions(){nodesByBreadth.forEach(function(nodes){var node,dy,y0=0,n=nodes.length,i;nodes.sort(ascendingDepth);for(i=0;i<n;++i){node=nodes[i];dy=y0-node.y;if(dy>0){node.y+=dy}y0=node.y+node.dy+nodePadding}dy=y0-nodePadding-size[1];if(dy>0){y0=node.y-=dy;for(i=n-2;i>=0;--i){node=nodes[i];dy=node.y+node.dy+nodePadding-y0;if(dy>0){node.y-=dy}y0=node.y}}})}function ascendingDepth(a,b){return a.y-b.y}initializeNodeDepth();resolveCollisions();for(var alpha=1;iterations>0;--iterations){relaxRightToLeft(alpha*=.99);resolveCollisions();relaxLeftToRight(alpha);resolveCollisions()}}function computeLinkDepths(){nodes.forEach(function(node){node.sourceLinks.sort(ascendingTargetDepth);node.targetLinks.sort(ascendingSourceDepth)});nodes.forEach(function(node){var sy=0,ty=0;node.entryLinks.forEach(function(link){link.ty=ty;ty+=link.dy});node.sourceLinks.forEach(function(link){link.sy=sy;sy+=link.dy});node.targetLinks.forEach(function(link){link.ty=ty;ty+=link.dy});node.exitLinks.forEach(function(link){link.sy=sy;sy+=link.dy})});function ascendingSourceDepth(a,b){return a.source.y-b.source.y}function ascendingTargetDepth(a,b){return a.target.y-b.target.y}}function center(node){return node.y+node.dy/2}function value(link){return link.value}return pathing}})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},anomaly=Object.create(core);anomaly.init=function(options){this._type="anomaly";options=options||{};this._initDefaultOptions();this.setOptions(options);this._initializeAnomaly();return this};anomaly._initDefaultOptions=function(options){var defaults={mappings:{x:"date",y:"deviation",category:"metric"},bins:12,xTicks:7,xTickInterval:undefined,xUpperLimit:undefined,xLowerLimit:undefined,normalizePositive:false,onMouseOverAnomaly:null,onMouseOutAnomaly:null,onContextMenu:null,onSelectAnomalies:null,colors:[],theme:"blueGrayGreen"};return Object.getPrototypeOf(anomaly)._initDefaultOptions.call(this,defaults)};anomaly._render=function(){this._configureAnomaly();this._anom.layout(this._options)};anomaly._initializeAnomaly=function(){var options=this._options,mappings=options.mappings,self=this;this._anom=d3.anomaly();var _dispatch=d3.dispatch("contextmenu","mouseoveranomaly","mouseoutanomaly","selectanomalies");_dispatch.on("contextmenu",options.onContextMenu);_dispatch.on("mouseoveranomaly",options.onMouseOverAnomaly);_dispatch.on("mouseoutanomaly",options.onMouseOutAnomaly);_dispatch.on("selectanomalies",options.onSelectAnomalies);this.selectionCache(this._anom.selectionCache());this._anom.chart(this);this._anom.selectionCache().selectionKeymap(this.determineKeyModifiers);this._anom.on("mouseover",function(data,index,j){self._anom.nodes(function(d,i){var e=d3.select(this).transition().duration(750).style("opacity",d[mappings.category]===data[mappings.category]?.8:.2)});_dispatch.mouseoveranomaly.call(this,data,index,j,d3.event)}).on("mouseout",function(data,index,j){self._anom.nodes(function(d,i){var e=d3.select(this).transition().duration(750).style("opacity",1)});_dispatch.mouseoutanomaly.call(this,data,index,j,d3.event)}).on("contextmenu",function(data,index,j){_dispatch.contextmenu.call(this,data,index,j,d3.event)});if(options.enableSelection){this._anom.on("select",function(all,added,removed){self._anom.nodes(function(d,i){d3.select(this).classed("selected",false)});all.classed("selected",true);_dispatch.selectanomalies.call(this,all,added,removed,0)})}d3.rebind(this,_dispatch,"on")};anomaly._configureAnomaly=function(){var options=this._options;var width=dv.util.getPercentValue(options.width,options.parent.offsetWidth);var height=dv.util.getPercentValue(options.height,options.parent.offsetHeight);this._anom.data(zipData(options.data)).parent(options.parent).mappings(options.mappings).bins(options.bins).size([width,height]).xUpperLimit(options.xUpperLimit).xLowerLimit(options.xLowerLimit).normalizePositive(options.normalizePositive).xTicks(options.xTicks,options.xTickInterval)};anomaly._onAutoResize=function(){this.render()};function zipData(data){var retData=[],firstMapping=true;for(var mapping in data){var tuple=data[mapping],i=-1,n=tuple.length;while(++i<n){var obj,val=tuple[i];if(firstMapping){obj={};retData.push(obj)}else{obj=retData[i]}obj[mapping]=val}firstMapping=false}return retData}anomaly.chart=function(){return this._anom};global.cloudViz.anomaly=cloudViz.util.createConstructor(anomaly)})(this);(function(global){"use strict";d3.choroplethID=0;d3.choropleth=function(){var choropleth={},selectionCache=new dv.util.SelectionCache,searchTree=new dv.collisions.QuadtreeNode([2,2],2),inputFilter=cloudViz.util.inputFilter(".interaction-group",".zoom-container",".choro-container"),selectedOverlay=cloudViz.util.selectedOverlay(),data,size=[],p,$p,$wrapper,$container,svg,zoomContainer,options,projection,path,tooltip,max,min,extent=[0,1],extentMin=(max-min)*extent[0],extentMax=(max-min)*extent[1],originalSibling={},brushing=false,padding={top:0,left:0,right:0,bottom:40},instanceId=d3.choroplethID++,chart=null;choropleth.selectionCache=function(){return selectionCache};choropleth.chart=function(c){if(c){chart=c}return chart};choropleth.layout=function(){var self=this;if(!choropleth.data()){throw new EmptyDataException}if(!choropleth.parent()){throw new ParentNotSpecifiedException}size=choropleth.determineSize(options);var qt=size[0]>size[1]?size[0]/2:size[1]/2;searchTree=new dv.collisions.QuadtreeNode([qt,qt],qt);searchTree.buildTree(5);choropleth.calcRange();$container=choropleth.createSVGContainer();if(typeof options.geoJson==="string"){d3.json(options.geoJson,function(jsonData){self._layoutWithData.call(self,jsonData)})}else{this._layoutWithData(options.geoJson)}};choropleth._layoutWithData=function(geoJsonData){choropleth.drawGeos(geoJsonData);if(options.interactive){choropleth.drawTooltip()}choropleth.drawLegend(options.theme,options.colors,geoJsonData)};choropleth.determineSize=function(options){var parent=options.parent,width=options.width?options.width:parent.offsetWidth,height=options.height?options.height:parent.offsetHeight;width=width?width:700;height=height?height:450;return[width,height]};choropleth.calcRange=function(){for(var key in options.data.values){if(typeof max=="undefined"){max=options.data.values[key];min=options.data.values[key]}if(options.data.values[key]>max){max=options.data.values[key]}if(options.data.values[key]<min){min=options.data.values[key]}}};choropleth.drawLegend=function(theme,colors,geoJsonData){var self=this,height=9,controlSpacer=12,minMaxWidth=35,legendWidth=Math.min(size[0]-padding.left,630)-25,leftPos=(size[0]-padding.left-legendWidth)/2,barWidth=legendWidth-minMaxWidth*2-controlSpacer*2;var legend=svg.selectAll(".legend").data([data]);legend.enter().append("g").classed("legend",true);legend.attr("transform","translate("+leftPos+","+(size[1]-24)+")");var defs=legend.selectAll("defs").data([theme]);defs.enter().append("defs");defs.exit().remove();var defaultGradient=defs.selectAll("#defaultGradient-"+theme).data([theme]);defaultGradient.enter().append("linearGradient").attr("id","defaultGradient-"+theme);defaultGradient.exit().remove();var i,len=colors.length,positions=[];for(i=1;i<len;i++){positions[i]=(i+0)/(len-1)}positions[0]=0;var stop=defaultGradient.selectAll("stop").data(positions);stop.enter().append("stop").attr("class",function(d,i){return"stop"+i});stop.attr("offset",function(d){return d}).attr("stop-color",function(d,i){return colors[i]});var gradBg=legend.selectAll(".grad-bg").data([data]);gradBg.enter().append("rect").classed("grad-bg",true);gradBg.attr("x",minMaxWidth+controlSpacer).attr("y",0).attr("rx",height/2).attr("ry",height/2).attr("width",barWidth).attr("height",height);var gradRect=legend.selectAll(".grad-rect").data([data]);gradRect.enter().append("rect").classed("grad-rect",true);gradRect.classed("grad-rect",true).attr("x",minMaxWidth+controlSpacer).attr("y",0).style("fill","url(#defaultGradient-"+theme+")").attr("width",barWidth).attr("height",height);var legendLabel=$wrapper.selectAll(".legend-label").data([min,max]);legendLabel.enter().append("div").attr("class",function(d,i){return"legend-label "+(i?"max":"min")});legendLabel.style("left",function(d,i){return i?null:leftPos+"px"}).style("right",function(d,i){return i?leftPos+"px":null}).text(function(d,i){return options.formatFunction(i?max:min)});if(options.interactive){var brush=d3.svg.brush().x(d3.scale.linear().range([0,barWidth])).extent(extent).on("brushstart",function(){brushing=true}).on("brushend",function(){brushing=false}).on("brush",function(){extent=brush.extent();svg.selectAll(".grad-rect").attr("width",(extent[1]-extent[0])*barWidth).attr("x",barWidth*extent[0]+minMaxWidth+controlSpacer);choropleth.drawGeos(geoJsonData)});var handleWidth=9;var handleHeight=26;var brushg=legend.selectAll(".brush").data([data]);brushg.enter().append("g").classed("brush",true);brushg.attr("transform","translate("+(minMaxWidth+controlSpacer)+",0)").call(brush);var resize=brushg.selectAll(".resize");var handle=resize.selectAll(".handle").data(function(d){return d});handle.enter().append("rect").classed("handle",true);handle.attr("transform","translate("+-(handleWidth/2)+","+-handleWidth+")").attr("rx",handleWidth/3).attr("ry",handleWidth/3).attr("width",handleWidth).attr("height",handleHeight)}};choropleth.drawTooltip=function(data){var self=this,dataUndefined=data==null||data.value==null;tooltip=$wrapper.selectAll(".tooltip").data(dataUndefined?[]:[data]);tooltip.enter().append("div").classed("tooltip",true);tooltip.exit().classed("visible",false);setTimeout(function(){tooltip.classed("visible",true)},10);var tooltipBack=tooltip.selectAll(".tooltip-back").data([data]);tooltipBack.enter().append("div").classed("tooltip-back",true);var ttName=tooltipBack.selectAll(".tt-name").data(function(d){return[d.name]});ttName.enter().append("p").classed("tt-name",true);ttName.text(function(d){return d});var ttValue=tooltipBack.selectAll(".tt-value").data(function(d){return[d.value]});ttValue.enter().append("p").classed("tt-value",true);ttValue.text(function(d){return options.formatFunction(d)});var ttMetric=tooltipBack.selectAll(".tt-metric").data(typeof options.metric!=="undefined"?[options.metric]:[]);ttMetric.enter().append("p").classed("tt-metric",true);ttMetric.text(function(d){return d});ttMetric.exit().remove()};choropleth.hideTooltip=function(){choropleth.drawTooltip({})};choropleth.showTooltip=function(data){if("value"in data&&data.value){choropleth.drawTooltip(data)}else{choropleth.hideTooltip()}};choropleth.drawGeos=function(geoJsonData){searchTree.clear();var color=null,interpretedDomain=[],xStart,yStart,currentScale=1,minDimScale=Math.min(size[0],size[1]),width=size[0]-padding.left-padding.right,height=size[1]-padding.top-padding.bottom,scale=1,offset=[0,0];if(options.projection){projection=d3.geo[options.projection]()}else{projection=d3.geo.equirectangular()}projection.scale(scale).translate(offset);var path=d3.geo.path().projection(projection);var bounds=path.bounds(geoJsonData);scale=.95/Math.max((bounds[1][0]-bounds[0][0])/width,(bounds[1][1]-bounds[0][1])/height);offset=[(width-scale*(bounds[1][0]+bounds[0][0]))/2,(height-scale*(bounds[1][1]+bounds[0][1]))/2];var bboxHeight=scale*((bounds[1][1]-bounds[0][1])/height)*height,bboxWidth=scale*((bounds[1][0]-bounds[0][0])/width)*width;projection.scale(scale).translate(offset);path=path.projection(projection);if(options.interactive){var zoom=d3.behavior.zoom(),zoomMax=4;zoomContainer.call(zoom.scaleExtent([1,zoomMax]).translate([width/2,height/2]).scale(1).on("zoom",function(){if(d3.event){var t=d3.event.translate,s=d3.event.scale,widthScaled2=width/2*s,heightScaled2=height/2*s,newX=t[0]-widthScaled2,newY=t[1]-heightScaled2,visibleChartWidth=bboxWidth/6,visibleChartHeight=bboxHeight/6,minX=-widthScaled2-visibleChartWidth,maxX=width-widthScaled2+visibleChartWidth,minY=-heightScaled2-visibleChartHeight,maxY=height-heightScaled2+visibleChartHeight;newX=Math.min(newX,maxX);newX=Math.max(newX,minX);newY=Math.min(newY,maxY);newY=Math.max(newY,minY);t[0]=newX+widthScaled2;t[1]=newY+heightScaled2;zoom.translate(t);$container.attr("transform","translate("+newX+","+newY+") scale("+s+")");selectedOverlay.select().attr("transform","translate("+newX+","+newY+") scale("+s+")")}}));inputFilter.interceptBrushEvents()}var i,len=options.colors.length;extentMin=(max-min)*extent[0]+min;extentMax=(max-min)*extent[1]+min;interpretedDomain[0]=0;for(i=1;i<len;i++){interpretedDomain[i]=i*(extentMax-extentMin)/(len-1)}$p.selectAll(".legend-label.min").text(function(d,i){return options.formatFunction(extentMin)});$p.selectAll(".legend-label.max").text(function(d,i){return options.formatFunction(extentMax)});color=d3.scale.linear().domain(interpretedDomain).range(options.colors);var getColor=function(d){if(typeof data.values[d.properties.GEO_ID]=="undefined"||data.values[d.properties.GEO_ID]<extentMin||data.values[d.properties.GEO_ID]>extentMax){return"#ddd"}else{return color(data.values[d.properties.GEO_ID])}};var geoMouseOver=function(d,i,j){if(options.interactive){if(brushing){return}var elem=this,fillColor=d3.rgb(elem.style.fill);elem.parentNode.appendChild(elem);d3.select(this).classed("hovered",true);choropleth.showTooltip({name:d.properties.name,id:d.properties.GEO_ID,value:data.values[d.properties.GEO_ID]});choropleth._dispatch.mouseover.call(this,d,i,j,d3.event)}};var geoMouseOut=function(d,i,j){if(options.interactive){if(brushing){return}var elem=this,parentElem=elem.parentNode;d3.select(this).classed("hovered",false);choropleth.hideTooltip();choropleth._dispatch.mouseout.call(this,d,i,j,d3.event)}};var geoContextMenu=function(d,i,j){d3.event.preventDefault();if(options.interactive){choropleth._dispatch.contextmenu.call(this,d,i,j,d3.event)}};var rangeSelector=function(start,end){var startRect=start.getBBox();var endRect=end.getBBox();var potentialEnds=[startRect.x+startRect.width,startRect.y+startRect.height,endRect.x+endRect.width,endRect.y+endRect.height];var searchArea=new dv.collisions.rectFromMinMax(startRect.x>endRect.x?endRect.x:startRect.x,startRect.y>endRect.y?endRect.y:startRect.y,potentialEnds[0]>potentialEnds[2]?potentialEnds[0]:potentialEnds[2],potentialEnds[1]>potentialEnds[3]?potentialEnds[1]:potentialEnds[3]);var output=[];searchTree.testRect(searchArea,function(payload,geometry,node){if(payload!=start){output.push(payload)}});return output};var geos=$container.selectAll(".geo").data(geoJsonData.features,function(d){return d.properties.GEO_ID});geos.enter().append("path").attr("class",function(d,i,j){return"datum-"+i+" series-"+j+" geo_id-"+d.properties.GEO_ID}).classed("geo",true).classed("selectable",true).attr("id",function(d,i){return d.properties.GEO_ID+instanceId}).attr("vector-effect","non-scaling-stroke").on("mousedown.choro",chart.makeSelectHandler(rangeSelector)).on("mouseover.choro",geoMouseOver).on("mouseout.choro",geoMouseOut).on("contextmenu",geoContextMenu).on("click",function(d,i,j){choropleth._dispatch.click.call(this,d,i,j,d3.event)});geos.exit().on("mouseover.choro",null).on("mouseout.choro",null).on("contextmenu",null).on("click",null);geos.attr("d",path).style("fill",getColor);if(chart._options.enableSelection){geos.each(function(d,i){var hulls=dv.collisions.hullsFromGeometry(d.geometry,path.projection());for(var hi=0;hi<hulls.length;hi++){searchTree.insertHull(hulls[hi],this)}})}};choropleth.createSVGContainer=function(){$p=d3.select(p);$wrapper=$p.selectAll(".cv-choropleth").data([data]);$wrapper.enter().append("div").classed("cv-choropleth",true);$wrapper.classed("cv-wrapper",true);$wrapper.style("width",size[0]+"px").style("height",size[1]+"px");svg=$wrapper.selectAll("svg").data([data]);svg.enter().append("svg").attr("width","100%").attr("height","100%");svg.exit().remove();var clipPath=svg.selectAll("#plotClip").data([0]);clipPath.enter().append("clipPath").attr("id","plotClip").append("rect");clipPath.select("rect").attr("x",padding.left).attr("y",padding.top).attr("width",size[0]-padding.left-padding.right).attr("height",size[1]-padding.top-padding.bottom);var zoomContainerBg=svg.selectAll(".container-bg").data([data]);zoomContainerBg.enter().append("rect").classed("container-bg",true).attr("width","100%").attr("height","100%").style("visible","false");var brush=inputFilter.setUpBrush(svg,selectionCache,searchTree);zoomContainer=svg.selectAll(".zoom-container").data([data]);zoomContainer.enter().append("g").classed("zoom-container",true).attr("clip-path","url(#plotClip)");inputFilter.setUpBrushOverlay(svg);var zoomContainerPlotBg=zoomContainer.selectAll(".zoom-container-plot-bg").data([data]);zoomContainerPlotBg.enter().append("rect").classed("zoom-container-plot-bg",true);zoomContainerPlotBg.attr("x",padding.left).attr("y",padding.top).attr("width",size[0]-padding.left-padding.right).attr("height",size[1]-padding.top-padding.bottom);selectionCache.setDeselector(zoomContainerPlotBg);var container=zoomContainer.selectAll(".choro-container").data([data]);container.enter().append("g").classed("choro-container",true);selectedOverlay=cloudViz.util.selectedOverlay(zoomContainer);selectedOverlay.setUpSelectedOverlay(zoomContainer);var zoomg=svg.selectAll(".zoom-container").style("pointer-events","none");return container};choropleth.selectedOverlay=function(){return selectedOverlay};choropleth.data=function(_){if(!arguments.length){return data}data=_;return choropleth};choropleth.parent=function(_){if(!arguments.length){return p}p=_;return choropleth};choropleth.options=function(_){if(!arguments.length){return options}options=_;return choropleth};function EmptyDataException(){this.type="EmptyDataException";this.message="The data is empty or null";this.toString=function(){return this.type+" - "+this.message}}function ParentNotSpecifiedException(){this.type="ParentNotSpecifiedException";this.message="A parent was not specified for this visualization";this.toString=function(){return this.type+" - "+this.message}}return choropleth};d3.choropleth.gradIdCounter=0})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},dvcore=cloudViz.dvcore||{},choropleth=Object.create(core);choropleth.init=function(options){this._type="choropleth";options=options||{};this._initDefaultOptions();this.setOptions(options);this._initChoropleth(options);return this};choropleth._initDefaultOptions=function(options){var defaults={geoJson:null,colors:[],theme:"sunnyDay",metric:"",projection:"equirectangular",format:"decimal",interactive:true,enableSelection:false};return Object.getPrototypeOf(choropleth)._initDefaultOptions.call(this,defaults)};choropleth._render=function(){this._configure();this._choro.layout()};choropleth._initChoropleth=function(options){var self=this;this._choro=d3.choropleth();this._choro._dispatch=this._dispatch;this._choro.chart(this);if(this._options.enableSelection){this._choro.selectionCache().selectionKeymap(this.determineKeyModifiers);this._choro.selectionCache().on("selectionChanged",function(source,all,added,removed){self._choro.selectedOverlay().updateSelectedDisplay(all);self._onSelectionChanged(source,all,added,removed,0)});this.selectionCache(this._choro.selectionCache())}};choropleth._configure=function(){var self=this,opts=this._options,adapter=this._dataAdapter;opts.formatFunction=function(val){return self._formatNumber(opts.format,val)};opts.metric=adapter.metric();opts.format=adapter.format();opts.data=adapter.data();this._choro.data(this._options.data).parent(this._options.parent).options(this._options)};global.cloudViz.choropleth=cloudViz.util.createConstructor(choropleth)})(this);(function(venn){"use strict";venn.venn=function(sets,overlaps,parameters){parameters=parameters||{};parameters.distance=parameters.distance||0;parameters.maxIterations=parameters.maxIterations||500;var lossFunction=parameters.lossFunction||venn.lossFunction;var initialLayout=parameters.layoutFunction||venn.greedyLayout;sets=initialLayout(sets,overlaps,parameters.distance);var initial=new Array(2*sets.length);for(var i=0;i<sets.length;++i){initial[2*i]=sets[i].x;initial[2*i+1]=sets[i].y}var totalFunctionCalls=0;var solution=venn.fmin(function(values){totalFunctionCalls+=1;var current=new Array(sets.length);for(var i=0;i<sets.length;++i){current[i]={x:values[2*i],y:values[2*i+1],radius:sets[i].radius,size:sets[i].size}}return lossFunction(current,overlaps)},initial,parameters);var positions=solution.solution;for(i=0;i<sets.length;++i){sets[i].x=positions[2*i];sets[i].y=positions[2*i+1]}return sets};venn.distanceFromIntersectArea=function(r1,r2,overlap){if(Math.min(r1,r2)*Math.min(r1,r2)*Math.PI<=overlap){return Math.abs(r1-r2)}return venn.bisect(function(distance){return window.circleIntersection.circleOverlap(r1,r2,distance)-overlap},0,r1+r2)};venn.getDistanceMatrix=function(sets,overlaps,dist){var distances=[],i;for(i=0;i<sets.length;++i){distances.push([]);for(var j=0;j<sets.length;++j){distances[i].push(0)}}for(i=0;i<overlaps.length;++i){var current=overlaps[i];if(current.sets.length!==2){continue}var left=current.sets[0],right=current.sets[1],r1=Math.sqrt(sets[left].size/Math.PI),r2=Math.sqrt(sets[right].size/Math.PI),distance=dist;try{distance=venn.distanceFromIntersectArea(r1,r2,current.size)+dist}catch(e){console.error("Error creating distance matrix: ",e)}distances[left][right]=distances[right][left]=distance}return distances};venn.greedyLayout=function(sets,overlaps,distance){var setOverlaps={},set,i,j;for(i=0;i<sets.length;++i){setOverlaps[i]=[];sets[i].radius=Math.sqrt(sets[i].size/Math.PI);sets[i].x=sets[i].y=0}for(i=0;i<overlaps.length;++i){var current=overlaps[i];if(current.sets.length!==2){continue}var left=current.sets[0],right=current.sets[1];if(!setOverlaps[left]||!setOverlaps[right]){continue}setOverlaps[left].push({set:right,size:current.size});setOverlaps[right].push({set:left,size:current.size})}var mostOverlapped=[];for(set in setOverlaps){if(setOverlaps.hasOwnProperty(set)){var size=0;for(i=0;i<setOverlaps[set].length;++i){size+=setOverlaps[set][i].size}mostOverlapped.push({set:set,size:size})}}if(!mostOverlapped.length){return sets}function sortOrder(a,b){return b.size-a.size}mostOverlapped.sort(sortOrder);var positioned={};function isPositioned(element){return element.set in positioned}function positionSet(point,index){sets[index].x=point.x;sets[index].y=point.y;positioned[index]=true}positionSet({x:0,y:0},mostOverlapped[0].set);var distances=venn.getDistanceMatrix(sets,overlaps,distance);for(i=1;i<mostOverlapped.length;++i){var setIndex=mostOverlapped[i].set,overlap=setOverlaps[setIndex].filter(isPositioned);set=sets[setIndex];overlap.sort(sortOrder);if(overlap.length===0){throw"Need overlap information for set "+set}var points=[];for(j=0;j<overlap.length;++j){var p1=sets[overlap[j].set],d1=distances[setIndex][overlap[j].set];points.push({x:p1.x+d1,y:p1.y});points.push({x:p1.x-d1,y:p1.y});points.push({y:p1.y+d1,x:p1.x});points.push({y:p1.y-d1,x:p1.x});for(var k=j+1;k<overlap.length;++k){var p2=sets[overlap[k].set],d2=distances[setIndex][overlap[k].set];var extraPoints=window.circleIntersection.circleCircleIntersection({x:p1.x,y:p1.y,radius:d1},{x:p2.x,y:p2.y,radius:d2});for(var l=0;l<extraPoints.length;++l){points.push(extraPoints[l])}}}var bestLoss=1e50,bestPoint=points[0];for(j=0;j<points.length;++j){sets[setIndex].x=points[j].x;sets[setIndex].y=points[j].y;var loss=venn.lossFunction(sets,overlaps);if(loss<bestLoss){bestLoss=loss;bestPoint=points[j]}}positionSet(bestPoint,setIndex)}return sets};venn.classicMDSLayout=function(sets,overlaps){var distances=venn.getDistanceMatrix(sets,overlaps,0);var positions=window.mds.classic(distances);for(var i=0;i<sets.length;++i){sets[i].x=positions[i][0];sets[i].y=positions[i][1];sets[i].radius=Math.sqrt(sets[i].size/Math.PI)}return sets};venn.lossFunction=function(sets,overlaps){var output=0;function getCircles(indices){return indices.map(function(i){return sets[i]})}for(var i=0;i<overlaps.length;++i){var area=overlaps[i],overlap;if(area.sets.length==2){var left=sets[area.sets[0]],right=sets[area.sets[1]];if(left==null||right==null){overlap=0}else{overlap=window.circleIntersection.circleOverlap(left.radius,right.radius,window.circleIntersection.distance(left,right))}}else{overlap=window.circleIntersection.intersectionArea(getCircles(area.sets))}var weight=area.weight==null?1:area.weight;output+=weight*(overlap-area.size)*(overlap-area.size)}return output};venn.scaleSolution=function(solution,width,height,padding){var minMax=function(d){var hi=Math.max.apply(null,solution.map(function(c){return c[d]+c.radius})),lo=Math.min.apply(null,solution.map(function(c){return c[d]-c.radius}));return{max:hi,min:lo}};width-=2*padding;height-=2*padding;var xRange=minMax("x"),yRange=minMax("y"),xExtent=xRange.max-xRange.min,yExtent=yRange.max-yRange.min,xScaling=xExtent?width/xExtent:0,yScaling=yExtent?height/yExtent:0,scaling=Math.min(yScaling,xScaling);for(var i=0;i<solution.length;++i){var set=solution[i];set.radius=scaling*set.radius;set.x=padding+(set.x-xRange.min)*scaling;set.y=padding+(set.y-yRange.min)*scaling}solution.scaling=scaling;return solution};function weightedSum(a,b){var ret=new Array(a[1].length||0);for(var j=0;j<ret.length;++j){ret[j]=a[0]*a[1][j]+b[0]*b[1][j]}return ret}venn.bisect=function(f,a,b,parameters){parameters=parameters||{};var maxIterations=parameters.maxIterations||100,tolerance=parameters.tolerance||1e-10,fA=f(a),fB=f(b),delta=b-a;if(fA*fB>0){throw"initial bisect points must have opposite signs"}if(fA===0){return a}if(fB===0){return b}for(var i=0;i<maxIterations;++i){delta/=2;var mid=a+delta,fMid=f(mid);if(fMid*fA>=0){a=mid}if(Math.abs(delta)<tolerance||fMid===0){return mid}}return a+delta};venn.fmin=function(f,x0,parameters){parameters=parameters||{};var maxIterations=parameters.maxIterations||x0.length*200,nonZeroDelta=parameters.nonZeroDelta||1.1,zeroDelta=parameters.zeroDelta||.001,minErrorDelta=parameters.minErrorDelta||1e-5,rho=parameters.rho||1,chi=parameters.chi||2,psi=parameters.psi||-.5,sigma=parameters.sigma||.5,callback=parameters.callback;var N=x0.length,simplex=new Array(N+1);simplex[0]=x0;simplex[0].fx=f(x0);for(var i=0;i<N;++i){var point=x0.slice();point[i]=point[i]?point[i]*nonZeroDelta:zeroDelta;simplex[i+1]=point;simplex[i+1].fx=f(point)}var sortOrder=function(a,b){return a.fx-b.fx};for(var iteration=0;iteration<maxIterations;++iteration){simplex.sort(sortOrder);if(callback){callback(simplex)}if(Math.abs(simplex[0].fx-simplex[N].fx)<minErrorDelta){break}var centroid=new Array(N);for(i=0;i<N;++i){centroid[i]=0;for(var j=0;j<N;++j){centroid[i]+=simplex[j][i]}centroid[i]/=N}var worst=simplex[N];var reflected=weightedSum([1+rho,centroid],[-rho,worst]);reflected.fx=f(reflected);var replacement=reflected;if(reflected.fx<=simplex[0].fx){var expanded=weightedSum([1+chi,centroid],[-chi,worst]);expanded.fx=f(expanded);if(expanded.fx<reflected.fx){replacement=expanded}}else if(reflected.fx>=simplex[N-1].fx){var shouldReduce=false;var contracted;if(reflected.fx<=worst.fx){contracted=weightedSum([1+psi,centroid],[-psi,worst]);contracted.fx=f(contracted);if(contracted.fx<worst.fx){replacement=contracted}else{shouldReduce=true}}else{contracted=weightedSum([1-psi*rho,centroid],[psi*rho,worst]);contracted.fx=f(contracted);if(contracted.fx<=reflected.fx){replacement=contracted}else{shouldReduce=true}}if(shouldReduce){for(i=1;i<simplex.length;++i){simplex[i]=weightedSum([1-sigma,simplex[0]],[sigma-1,simplex[i]]);simplex[i].fx=f(simplex[i])}}}simplex[N]=replacement}simplex.sort(sortOrder);return{f:simplex[0].fx,solution:simplex[0]}};venn.drawD3Diagram=function(element,dataset,width,height,parameters){parameters=parameters||{};var colours=d3.scale.category10(),circleFillColours=parameters.circleFillColours||colours,circleStrokeColours=parameters.circleStrokeColours||circleFillColours,circleStrokeWidth=parameters.circleStrokeWidth||function(i){return 0},textFillColours=parameters.textFillColours||colours,textStrokeColours=parameters.textStrokeColours||textFillColours,nodeOpacity=parameters.opacity||.3,padding=parameters.padding||6;dataset=venn.scaleSolution(dataset,width,height,padding);var svg=element.append("svg").attr("width",width).attr("height",height);var nodes=svg.selectAll("circle").data(dataset).enter().append("g");var circles=nodes.append("circle").attr("r",function(d){return d.radius}).style("fill-opacity",nodeOpacity).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}).style("stroke",function(d,i){return circleStrokeColours(i)}).style("stroke-width",function(d,i){return circleStrokeWidth(i)}).style("fill",function(d,i){return circleFillColours(i)});var text=nodes.append("text").attr("x",function(d){return d.x}).attr("y",function(d){return d.y}).attr("text-anchor","middle").style("stroke",function(d,i){return textStrokeColours(i)}).style("fill",function(d,i){return textFillColours(i)}).text(function(d){return d.label});return{svg:svg,nodes:nodes,circles:circles,text:text}};venn.updateD3Diagram=function(element,dataset){var svg=element.select("svg"),width=parseInt(svg.attr("width"),10),height=parseInt(svg.attr("height"),10);dataset=venn.scaleSolution(dataset,width,height,6);element.selectAll("circle").data(dataset).transition().duration(400).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}).attr("r",function(d){return d.radius});element.selectAll("text").data(dataset).transition().duration(400).attr("x",function(d){return d.x}).attr("y",function(d){return d.y})}})(window.venn=window.venn||{});(function(circleIntersection){"use strict";var SMALL=1e-10;circleIntersection.intersectionArea=function(circles,stats){var intersectionPoints=getIntersectionPoints(circles);var innerPoints=intersectionPoints.filter(function(p){return circleIntersection.containedInCircles(p,circles)});var arcArea=0,polygonArea=0,arcs=[],i;if(innerPoints.length>1){var center=circleIntersection.getCenter(innerPoints);for(i=0;i<innerPoints.length;++i){var p=innerPoints[i];p.angle=Math.atan2(p.x-center.x,p.y-center.y)}innerPoints.sort(function(a,b){return b.angle-a.angle});var p2=innerPoints[innerPoints.length-1];for(i=0;i<innerPoints.length;++i){var p1=innerPoints[i];polygonArea+=(p2.x+p1.x)*(p1.y-p2.y);var midPoint={x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2},arc=null;for(var j=0;j<p1.parentIndex.length;++j){if(p2.parentIndex.indexOf(p1.parentIndex[j])>-1){var circle=circles[p1.parentIndex[j]],a1=Math.atan2(p1.x-circle.x,p1.y-circle.y),a2=Math.atan2(p2.x-circle.x,p2.y-circle.y);var angleDiff=a2-a1;if(angleDiff<0){angleDiff+=2*Math.PI}var a=a2-angleDiff/2,width=circleIntersection.distance(midPoint,{x:circle.x+circle.radius*Math.sin(a),y:circle.y+circle.radius*Math.cos(a)});if(arc===null||arc.width>width){arc={circle:circle,width:width,p1:p1,p2:p2}}}}arcs.push(arc);arcArea+=circleIntersection.circleArea(arc.circle.radius,arc.width);p2=p1}}else{var smallest=circles[0];for(i=1;i<circles.length;++i){if(circles[i].radius<smallest.radius){smallest=circles[i]}}var disjoint=false;for(i=0;i<circles.length;++i){if(circleIntersection.distance(circles[i],smallest)>Math.abs(smallest.radius-circles[i].radius)){disjoint=true;break}}if(disjoint){arcArea=polygonArea=0}else{arcArea=smallest.radius*smallest.radius*Math.PI;arcs.push({circle:smallest,p1:{x:smallest.x,y:smallest.y+smallest.radius},p2:{x:smallest.x-SMALL,y:smallest.y+smallest.radius},width:smallest.radius*2})}}polygonArea/=2;if(stats){stats.area=arcArea+polygonArea;stats.arcArea=arcArea;stats.polygonArea=polygonArea;stats.arcs=arcs;stats.innerPoints=innerPoints;stats.intersectionPoints=intersectionPoints}return arcArea+polygonArea};circleIntersection.containedInCircles=function(point,circles){for(var i=0;i<circles.length;++i){if(circleIntersection.distance(point,circles[i])>circles[i].radius+SMALL){return false}}return true};function getIntersectionPoints(circles){var ret=[];for(var i=0;i<circles.length;++i){for(var j=i+1;j<circles.length;++j){var intersect=circleIntersection.circleCircleIntersection(circles[i],circles[j]);for(var k=0;k<intersect.length;++k){var p=intersect[k];p.parentIndex=[i,j];ret.push(p)}}}return ret}circleIntersection.circleIntegral=function(r,x){var y=Math.sqrt(r*r-x*x);return x*y+r*r*Math.atan2(x,y)};circleIntersection.circleArea=function(r,width){return circleIntersection.circleIntegral(r,width-r)-circleIntersection.circleIntegral(r,-r)};circleIntersection.distance=function(p1,p2){return Math.sqrt((p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y))};circleIntersection.circleOverlap=function(r1,r2,d){if(d>=r1+r2){return 0}if(d<=Math.abs(r1-r2)){return Math.PI*Math.min(r1,r2)*Math.min(r1,r2)}var w1=r1-(d*d-r2*r2+r1*r1)/(2*d),w2=r2-(d*d-r1*r1+r2*r2)/(2*d);return circleIntersection.circleArea(r1,w1)+circleIntersection.circleArea(r2,w2)};circleIntersection.circleCircleIntersection=function(p1,p2){var d=circleIntersection.distance(p1,p2),r1=p1.radius,r2=p2.radius;if(d>=r1+r2||d<=Math.abs(r1-r2)){return[]}var a=(r1*r1-r2*r2+d*d)/(2*d),h=Math.sqrt(r1*r1-a*a),x0=p1.x+a*(p2.x-p1.x)/d,y0=p1.y+a*(p2.y-p1.y)/d,rx=-(p2.y-p1.y)*(h/d),ry=-(p2.x-p1.x)*(h/d);return[{x:x0+rx,y:y0-ry},{x:x0-rx,y:y0+ry}]};circleIntersection.getCenter=function(points){var center={x:0,y:0};for(var i=0;i<points.length;++i){center.x+=points[i].x;center.y+=points[i].y}center.x/=points.length;center.y/=points.length;return center}})(window.circleIntersection=window.circleIntersection||{});(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},venn=Object.create(core);var chartContainer;var vennIdentity=0;venn.init=function(options){var self=this;this._type="venn";options=options||{};this._initDefaultOptions();this.setOptions(options);this._cvWrapper=null;this._identity="venn-"+vennIdentity++;this._seriesState=cloudViz.seriesState();this._seriesState.on("enableChange.venn",function(eventType,state){self._onEnableState(state)});if(options.enableSelection){this.selectionCache(new dv.util.SelectionCache);this._selectionCache.on("selectionChanged",function(source,all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all);self._onSelectionChanged(source,all,added,removed,0)});this.selectionCache().selectionKeymap(this.determineKeyModifiers)}this._dvColorScale=dv.scale.ordinal();return this};venn._initDefaultOptions=function(options){var defaults={colors:[],theme:"default",legendVerticalWidth:110,duration:500,defineAudience:true,hideOverlapInLegend:true,legendVisible:true,legendOrientation:"top",distance:0,tooltipContent:null,formatType:"decimal",enableSelection:false};this._margins={top:0,left:0,right:0,bottom:0};return Object.getPrototypeOf(venn)._initDefaultOptions.call(this,defaults)};venn._render=function(animate){this._id=Math.floor(Math.random()*1e4);try{this._determineSize();this._initScales();this._draw(animate)}catch(e){this.handleError(e)}};venn.reset=function(){Object.getPrototypeOf(venn).reset.apply(this,arguments);if(!this._d3Container){return}var hitAreaCircles=this._d3Container.selectAll(".set-hit-areas-container circles"),filledRegions=this._d3Container.selectAll(".filled-regions"),legendEntries=this._cvWrapper.selectAll(".cv-legend-entry");[hitAreaCircles,filledRegions,legendEntries].forEach(function(selection){selection.on("mouseover",null);selection.on("mouseout",null);selection.on("contextmenu",null)});d3.select(this._options.parent).selectAll(".cv-wrapper.cv-venn svg").remove()};venn._draw=function(animate){var d3Parent=d3.select(this._options.parent);var data=this._options.data;data.distance=this._options.distance;this._initSVG();this._createStates();this._parsedSetNotation=this._parseSetNotation(data.notation);this._overlapMap=this._createOverlapMap(data.sets,data.overlaps);var legendDimensions=this._drawLegend();this._positionContainer(legendDimensions);var sets=this._configureSets(data);var overlayCombos=this._generateOverlayCombinations(sets,this._parsedSetNotation);this._drawCircles(sets,overlayCombos,animate);this._highlightedOverlay.setUpSelectedOverlay(d3Parent.selectAll(".transformed-container"));var selectionCache=this.selectionCache();if(selectionCache){selectionCache.setDeselector(d3Parent.selectAll(".interaction-canvas"))}};venn._onAutoResize=function(){this.render()};venn._determineSize=function(options){var opts=this._options,data=this._dataAdapter.data(),parentDimensions=opts.parent.getBoundingClientRect(),parentWidth=parentDimensions.width,parentHeight=parentDimensions.height,width=dv.util.getPercentValue(opts.width,parentWidth)||parentWidth,height=dv.util.getPercentValue(opts.height,parentHeight)||parentHeight;width=Math.floor(width-2);height=Math.floor(height-2);this.width(width);this.height(height)};venn._size=[0,0];venn.width=function(width){if(width!==undefined){return this._size[0]=Math.max(0,width)}return this._size[0]};venn.height=function(height){if(height!==undefined){return this._size[1]=Math.max(0,height)}return this._size[1]};venn._initScales=function(){this._dvColorScale.range(this._options.colors)};venn._parseSetNotation=function(notationString){var jsonNotation=[];if(!notationString){return jsonNotation}var ors=notationString.split("|"),indexPattern=/\d+/g;var i,orLength=ors.length,or;for(i=0;i<orLength;i++){or=ors[i];var andMatches=or.match(indexPattern);var j,sets=[],andLength=andMatches.length,and;for(j=0;j<andLength;j++){sets.push(+andMatches[j])}jsonNotation.push(sets)}return jsonNotation};venn._initSVG=function(){var opts=this._options,d3Parent=d3.select(opts.parent);this._cvWrapper=d3Parent.selectAll(".cv-wrapper.cv-venn").data([0]);this._cvWrapper.enter().append("div").classed("cv-wrapper cv-venn",true);this._cvWrapper.style("width",this._size[0]+"px").style("height",this._size[1]+"px");chartContainer=this._cvWrapper.selectAll(".svg-wrapper").data([0]);chartContainer.enter().append("div").classed("svg-wrapper",true);var svg=chartContainer.selectAll("svg").data([0]);svg.enter().append("svg");var background=svg.selectAll(".cv-venn-background").data([0]).enter().append("rect").classed("cv-venn-background",true);if(this.selectionCache()){this.selectionCache().setDeselector(background)}this._d3Container=svg.selectAll("g").data([0]);var transformedG=this._d3Container.enter().append("g").classed("transformed-container",true);var interactiongroup=transformedG.selectAll(".interaction-group").data([0]);interactiongroup.enter().append("g").classed("interaction-group",true).append("rect").attr("x","0").attr("y","0").attr("width",this._size[0]).attr("height",this._size[1]).classed("interaction-canvas",true)};venn._positionContainer=function(legendDimensions){this.width(this._size[0]-(legendDimensions.left+legendDimensions.right));this.height(this._size[1]-(legendDimensions.top+legendDimensions.bottom));this._cvWrapper.select(".svg-wrapper").style({"margin-left":legendDimensions.left+"px","margin-top":legendDimensions.top+"px","margin-right":legendDimensions.right+"px","margin-bottom":legendDimensions.bottom+"px",height:this._size[1]+"px"});this._cvWrapper.selectAll(".cv-legend").style("height",legendDimensions.left||legendDimensions.right?this._size[1]-1+"px":null)};venn._configureSets=function(data){var opts=this._options;data=this._sanitizeOverlaps(data);var circles=global.venn.scaleSolution(global.venn.venn(data.sets,data.overlaps,{distance:data.distance}),this._size[0],this._size[1],7);circles.scaling=Math.max(0,circles.scaling);var i,length=circles.length,circle;for(i=0;i<length;i++){circle=circles[i];circle.index=i;circle.radius=Math.max(0,circle.radius)}return circles};venn._combine=function(sets,minLength,maxLength){if(arguments.length<3){maxLength=sets.length-1}else{maxLength--}if(arguments.length<2){minLength=1}var fn=function(n,src,got,all){if(n===0){if(got.length>0){all[all.length]=got}return}for(var j=0;j<src.length;j++){fn(n-1,src.slice(j+1),got.concat([src[j]]),all)}return};var all=[];for(var i=minLength;i<=maxLength+1;i++){fn(i,sets,[],all)}return all};venn._intersect=function(a,b){var res=[];for(var i=0;i<a.length;i++){for(var j=0;j<b.length;j++){if(a[i]==b[j]){res.push(a[i]);break}}}return res};venn._union=function(a,b){var obj={};for(var i=a.length-1;i>=0;--i){obj[a[i]]=a[i]}for(var j=b.length-1;j>=0;--j){obj[b[j]]=b[j]}var res=[];for(var k in obj){if(obj.hasOwnProperty(k)){res.push(obj[k])}}res.sort(function(a,b){return a-b});return res};venn._generateOverlayCombinations=function(sets,parsedNotation){var self=this,comboMap={},combinedPermutations=[],dataFills=[];parsedNotation.sort(function(a,b){return b.length-a.length});parsedNotation.forEach(function(and,i){var joinedAnd=and.join("-");combinedPermutations=combinedPermutations.concat(self._combine(and,1));combinedPermutations.forEach(function(d,j){var key=d.join("-"),obj=comboMap[key]||{},intersections;if(!obj.fill){intersections=self._intersect(and,d);obj.fill=intersections.join("-")===joinedAnd}comboMap[key]=obj})});for(var key in comboMap){var setIndices=key.split("-"),setSubset=[],i,setLength=setIndices.length;for(i=0;i<setLength;i++){var set=sets[setIndices[i]];if(set){setSubset.push(sets[setIndices[i]])}}var intersectionData={};if(setSubset.length>1){global.circleIntersection.intersectionArea(setSubset,intersectionData)}if(!setSubset.length){intersectionData.area=0}else{intersectionData.area=Math.PI*Math.pow(setSubset[0].radius,2)}dataFills.push({key:key,fill:comboMap[key].fill,area:intersectionData.area})}dataFills.sort(function(a,b){var diff=b.area-a.area;if(diff){return diff}return a.key.length-b.key.length});return dataFills};venn._sanitizeOverlaps=function(data){var sets=data.sets,overlaps=data.overlaps,zeroOverlaps=[],setIndex,otherSetIndex,overlapIndex,set,otherSet,overlap,found,setLen=sets.length,overlapLen=overlaps.length,overlapMap={},overlapSort=function(a,b){return+a-+b};for(overlapIndex=0;overlapIndex<overlapLen;overlapIndex++){overlap=overlaps[overlapIndex];overlap.sets.sort(overlapSort);overlapMap[overlap.sets.join("-")]=overlap}for(setIndex=0;setIndex<setLen;setIndex++){set=sets[setIndex];for(otherSetIndex=setIndex+1;otherSetIndex<setLen;otherSetIndex++){otherSet=sets[otherSetIndex];found=false;if(!overlapMap.hasOwnProperty(setIndex+"-"+otherSetIndex)||overlapMap[setIndex+"-"+otherSetIndex].size==="0"){zeroOverlaps.push({sets:[setIndex,otherSetIndex],size:0})}}}data.overlaps=overlaps.concat(zeroOverlaps);return data};venn._createOverlapMap=function(sets,overlaps){var overlapMap={},sort=function(a,b){return a-b};var i,setLength=sets.length,set;for(i=0;i<setLength;i++){set=sets[i];overlapMap[i]=set.size}var j,overlapLength=overlaps.length,overlap;for(i=0;i<overlapLength;i++){overlap=overlaps[i];overlap.sets.sort(sort);overlapMap[overlap.sets.join("-")]=overlap.size}return overlapMap};venn._drawCircles=function(sets,overlayCombos,animate){this._createClipPaths(sets,overlayCombos);this._drawSetFills(sets,animate);this._drawBorders(sets,animate);this._drawFilledRegions(overlayCombos,animate);this._drawPadding(sets,animate);this._makePlotFit(sets)};venn._drawSetHitAreas=function(sets,animate){var self=this,opts=this._options;var nodes=this._d3Container.selectAll(".set-hit-areas-container").data([sets]);nodes.enter().append("g").classed("set-hit-areas-container",true);nodes.exit().remove();var circles=nodes.selectAll("circle").data(function(d){return d});circles.enter().append("circle").attr("r",animate?0:function(d){return Math.max(d.radius,0)}).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}).attr("tooltip",function(d){return d.tooltip});circles.exit().remove();circles.attr("id",function(d,i,j){return self._identity+"-circles-"+i+"-"+j}).on("mouseover",function(d,i,j){self._initTooltip(d,d3.event);self._seriesState.enableStateByTypeAndId("standard",d.index,true);self._dispatch.mouseover.call(this,d,i,j,d3.event)}).on("mouseout",function(d,i,j){self._teardownTooltip(d,d3.event);self._seriesState.enableStateByTypeAndId("standard",d.index,false);self._dispatch.mouseout.call(this,d,i,j,d3.event)}).on("contextmenu",self.makeContextMenuHandler(self)).on("mousedown",self.makeSelectHandler());if(animate){circles.transition().duration(opts.duration).attr("r",function(d){return Math.max(d.radius,0)}).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y})}this._selectionCache.markSelectable(circles)};venn._conditionClipPath=function(path){var circleIndexRegex=/((-\d)*)\)$/g,matchedPath=path.match(circleIndexRegex);if(matchedPath){path=matchedPath[0].slice(1,-1);path=path.replace(/\"/g,"")}return path};venn._updateDataItemForOverlapHover=function(dataItem,clipPath){var circleIndicies=clipPath.split("-"),sets=this._options.data.sets,overlappingSets=circleIndicies.map(function(i){return sets[i]}),overlap=this._getOverlapByKey(dataItem.key),centerVector=this._getCenterVector(overlappingSets);dataItem.label=overlappingSets.map(function(s){return s.label}).join(" & ");dataItem.size=overlap.size;dataItem.x=centerVector.x;dataItem.y=centerVector.y};venn._getOverlapByKey=function(key){var overlaps=this._options.data.overlaps||[],overlap=overlaps.filter(function(o){return o.sets.join("-")===key});return overlap[0]};venn._getCenterVector=function(circles){var centerVector=circles.reduce(function(memo,val,i){memo.x+=val.x/circles.length;memo.y+=val.y/circles.length;return memo},{x:0,y:0});return centerVector};venn._initTooltip=function(d,e,tooltipOpts){var currentChartContainer=this._cvWrapper.select(".svg-wrapper"),containerBox=currentChartContainer.select("svg").node().getBBox(),bounds,content,marginAdjust,opts=this._options;content=!!opts.tooltipContent?opts.tooltipContent(d):this.defaultTooltipContent(d);bounds=this._getTooltipBounds(d,e,containerBox);marginAdjust={top:parseFloat(currentChartContainer.style("margin-top")),left:parseFloat(currentChartContainer.style("margin-left"))};bounds.x+=marginAdjust.left;bounds.y+=marginAdjust.top;containerBox.x+=marginAdjust.left;containerBox.y+=marginAdjust.top;dv.showTooltip(bounds,containerBox,content,"top",20,currentChartContainer)};venn._getTooltipBounds=function(d,e,rect){var container=d3.select(this._options.parent).select(".svg-wrapper"),mouseCoords=d3.mouse(container.node());return{x:mouseCoords[0],y:mouseCoords[1],height:0,width:0}};venn.defaultTooltipContent=function(d){var content="<span class='series-name'>"+this.escapeHtml(d.label)+"</span>"+"<span class='metric-value'>"+this.escapeHtml(d.size)+"</span>";return content};venn._createClipPaths=function(sets,overlayCombos){var self=this;var defs=this._cvWrapper.select("svg").selectAll("defs").data(overlayCombos.length?[0]:[]);defs.enter().insert("defs",":first-child");defs.exit().remove();var masks=defs.selectAll("clipPath").data(overlayCombos);masks.enter().append("clipPath");masks.exit().remove();masks.attr("id",function(d){return"clip-"+self._id+"-"+d.key});var clipCircle=masks.selectAll("circle").data(function(d){if(!d.key||!d.key.length){return[]}var setIndices=d.key.split("-"),maskInfo={circleIndex:setIndices.shift()};if(setIndices.length){maskInfo.maskId=setIndices.join("-")}if(!sets||!sets[maskInfo.circleIndex]){return[]}return[maskInfo]});clipCircle.enter().append("circle");clipCircle.exit().remove();clipCircle.attr("clip-path",function(d){return d.hasOwnProperty("maskId")?"url(#clip-"+self._id+"-"+d.maskId+")":null}).attr("r",function(d){return sets[d.circleIndex].radius}).attr("cx",function(d){return sets[d.circleIndex].x}).attr("cy",function(d){return sets[d.circleIndex].y}).style("fill","#FFF")};venn._drawFilledRegions=function(overlayCombos,animate){var self=this,opts=this._options;overlayCombos.sort(function(a,b){var overlapA=self._getOverlapByKey(a.key)||{area:0,key:""},overlapB=self._getOverlapByKey(b.key)||{area:0,key:""},diff;diff=overlapB.area-overlapA.area;if(diff){return diff}return a.key.length-b.key.length});var filledRegions=this._d3Container.selectAll(".filled-regions").data(overlayCombos?[overlayCombos]:[]);filledRegions.enter().append("g").classed("filled-regions",true);filledRegions.exit().remove();var regions=filledRegions.selectAll(".fill-region").data(function(d){return d});regions.enter().append("rect").classed("fill-region",true);regions.exit().remove();regions.attr("clip-path",function(d){return"url(#clip-"+self._id+"-"+d.key+")"}).style("opacity",opts.defineAudience&&!animate?1:1e-6).attr("width",self._size[0]).attr("height",self._size[1]).attr("id",function(d,i,j){return self._identity+"-regions-"+i+"-"+j}).classed("overlay",function(d){return d.fill}).on("mouseover",function(d,i,j){var clipPath=d3.select(d3.event.target).attr("clip-path")||"";clipPath=self._conditionClipPath(clipPath);if(clipPath){self._updateDataItemForOverlapHover(d,clipPath)}self._initTooltip(d,d3.event);self._seriesState.enableStateByTypeAndId("overlap",opts.defineAudience?"audience":d.key,true);self._dispatch.mouseover.call(this,d,i,j,d3.event)}).on("mouseout",function(d,i,j){self._teardownTooltip(d,d3.event);self._seriesState.enableStateByTypeAndId("overlap",opts.defineAudience?"audience":d.key,false);self._dispatch.mouseout.call(this,d,i,j,d3.event)}).on("contextmenu",self.makeContextMenuHandler(self)).on("mousedown",self.makeSelectHandler());if(this.selectionCache()){this.selectionCache().markSelectable(regions)}if(opts.defineAudience){regions.transition().delay(opts.duration).duration(opts.duration).style("opacity",1)}};venn._drawPadding=function(sets,animate){var opts=this._options;var nodes=this._d3Container.selectAll(".padding-container").data([sets]);nodes.enter().append("g").classed("padding-container",true);nodes.exit().remove();function makeCircleRadius(d){return d.radius}var circles=nodes.selectAll("circle").data(function(d){return d});circles.enter().append("circle").attr("r",animate?0:makeCircleRadius).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y});circles.exit().remove();if(animate){circles.transition().duration(opts.duration).attr("r",makeCircleRadius).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y})}};venn._drawSetFills=function(sets,animate){var self=this,opts=this._options;var nodes=this._d3Container.selectAll(".set-fills-container").data([sets]);nodes.enter().append("g").classed("set-fills-container",true);nodes.exit().remove();var circles=nodes.selectAll("circle").data(function(d){return d});circles.enter().append("circle").attr("r",animate?0:function(d){return Math.max(d.radius,0)}).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y});circles.exit().remove();circles.attr("id",function(d,i,j){return self._identity+"-circles-"+i+"-"+j}).on("mouseover",function(d,i,j){self._initTooltip(d,d3.event);self._seriesState.enableStateByTypeAndId("standard",d.index,true);self._dispatch.mouseover.call(this,d,i,j,d3.event)}).on("mouseout",function(d,i,j){self._teardownTooltip(d,d3.event);self._seriesState.enableStateByTypeAndId("standard",d.index,false);self._dispatch.mouseout.call(this,d,i,j,d3.event)}).on("contextmenu",self.makeContextMenuHandler(self)).on("mousedown",self.makeSelectHandler()).style("fill",function(d,i){return self._dvColorScale.mapValue(i)});if(animate){circles.transition().duration(opts.duration).attr("r",function(d){return Math.max(d.radius,0)}).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y})}if(this.selectionCache()){this.selectionCache().markSelectable(circles)}};venn._drawBorders=function(sets,animate){var self=this,opts=this._options;var nodes=this._d3Container.selectAll(".border-container").data([sets]);nodes.enter().append("g").classed("border-container",true);nodes.exit().remove();function makeCircleRadius(d){return Math.max(0,d.radius-1)}var circles=nodes.selectAll("circle").data(function(d){return d});circles.enter().append("circle").attr("r",animate?0:makeCircleRadius).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y});circles.exit().remove();circles.style("stroke",function(d,i){return self._dvColorScale.mapValue(i)}).classed("predicted",function(d){return d.predicted});if(animate){circles.transition().duration(opts.duration).attr("r",makeCircleRadius).attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y})}};venn._createStates=function(){var opts=this._options,sets=opts.data.sets,seriesState=this._seriesState,set_labels=sets.map(function(set){return set.label});if("data"in this._changedOptions&&this._changedOptions.data){seriesState.removeStatesByType("standard");seriesState.removeStatesByType("overlap");if(opts.defineAudience){seriesState.appendState(this._dataAdapter.l10n.labels.venn.definedAudience,"audience","overlap",false,false)}var i,length=sets.length,domain=[],set;for(i=0;i<length;i++){set=sets[i];domain.push(i);seriesState.appendState(set.label||i,i,"standard",false)}if(!opts.defineAudience){if(opts.data.notation){opts.data.notation.split("|").forEach(function(overlay){var indices=overlay.split("&").map(function(i){return parseInt(i,10)}),labels=indices.map(function(i){return set_labels[i]}),hideInLegend=!!opts.hideOverlapInLegend;seriesState.appendState(labels.join(" & "),overlay.replace(/\&/g,"-"),"overlap",false,hideInLegend)})}}this._dvColorScale.domain(domain)}};venn._drawLegend=function(){var opts=this._options,self=this,orientation=opts.legendOrientation;if(opts.legendVisible===false||opts.normalized){if(this._legend){this._legend.destroy();this._legend=undefined}return{left:0,bottom:0,right:0,top:0}}if(!this._legend){this._legend=cloudViz.interactiveLegend()}this._legend.parent(this._cvWrapper.node()).orientation(orientation).chartWidth(this._size[0]).chartHeight(this._size[1]).chartPadding({left:0,top:0,right:0,bottom:0}).validOrientations(["top","left","bottom","right"]).legendVerticalWidth(opts.legendVerticalWidth).type("bar").seriesState(this._seriesState).interactive(false).values(this._calculateValues(this._options.data.sets,this._overlapMap,this._parsedSetNotation))._render(null,{fill:[this._dvColorScale]});var width=this._legend._getUsedWidth(),height=this._legend._getUsedHeight(),isHorizontallyOriented=height!==0;var legendEntries=this._cvWrapper.selectAll(".cv-legend-entry").on("mouseover",function(d){self._seriesState.enableStateByTypeAndId(d.type,d.id,true)}).on("mouseout",function(d){self._seriesState.enableStateByTypeAndId(d.type,d.id,false)});var left=!isHorizontallyOriented&&orientation!="right"?width:0,right=!isHorizontallyOriented&&orientation=="right"?width:0,top=isHorizontallyOriented&&orientation!="bottom"?height:0,bottom=isHorizontallyOriented&&orientation=="bottom"?height:0;return{left:left,bottom:bottom,right:right,top:top}};venn._onEnableState=function(state){this._cvWrapper.selectAll(".set-fills-container circle").style("fill-opacity",function(d,i){return state.type==="standard"&&state.id===i&&state.enabled?"0.5":"0.2"});if(state.type==="overlap"){this._cvWrapper.selectAll(".set-fills-container circle").style("fill-opacity",function(d,i){return state.enabled?"0.1":"0.2"})}this._cvWrapper.selectAll(".border-container circle").style("stroke-width",function(d,i){return state.type==="standard"&&state.id===i&&state.enabled?"2":"1"});if(this._options.defineAudience){this._cvWrapper.selectAll(".filled-regions rect").classed("muted",function(d,i){return state.type==="standard"&&state.enabled})}else{this._cvWrapper.selectAll(".fill-region.overlay").style("opacity",function(d,i){return d.key===state.id&&state.enabled?".75":"0"})}var inactiveFilter;if(!this._options.defineAudience&&this._options.hideOverlapInLegend){var ids=state.id.toString().split("-").map(function(x){return parseInt(x,10)});inactiveFilter=function(d){return state.enabled&&ids.indexOf(d.id)==-1}}else{inactiveFilter=function(d){return state.enabled&&(d.id!==state.id||d.type!==state.type)}}this._cvWrapper.selectAll(".cv-legend-entry").classed("inactive",inactiveFilter)};venn._calculateValues=function(sets,overlapMap,parsedNotation){var opts=this._options,values=[],set,formatType=opts.formatType;if(opts.defineAudience){values.push(this._formatNumber(formatType,this._calculateHighlightedValue(sets,overlapMap,parsedNotation,null,{isLegend:true})))}for(set in overlapMap){values.push(this._formatNumber(formatType,overlapMap[set],null,{dataItem:set,isLegend:true}))}return values};venn._calculateHighlightedValue=function(sets,overlapMap,parsedNotation){var calculateTotalByLevel=function(parsedNotation,indexArray,total,depth){var combinations=this._combine(indexArray,depth,depth);var i,combinationsLength=combinations.length,combo,sign=depth%2?1:-1;for(i=0;i<combinationsLength;i++){combo=combinations[i];var j,comboLength=combo.length,index,setOverlapKey,unionedSets=[];for(j=0;j<comboLength;j++){index=combo[j];unionedSets=this._union(parsedNotation[index],unionedSets)}setOverlapKey=unionedSets.join("-");total+=(overlapMap.hasOwnProperty(setOverlapKey)?overlapMap[setOverlapKey]:0)*sign}depth++;if(depth<=parsedNotation.length){total=calculateTotalByLevel.call(this,parsedNotation,indexArray,total,depth)}return total},generateIndexArray=function(length){var indexArray=[],i;for(i=0;i<length;i++){indexArray.push(i)}return indexArray};return calculateTotalByLevel.call(this,parsedNotation,generateIndexArray(parsedNotation.length),0,1)};venn._makePlotFit=function(sets){var opts=this._options,transformCoords={x:0,y:0},largestX=0,largestY=0,padding=4;sets.forEach(function(d){largestX=Math.max(largestX,d.x+d.radius);largestY=Math.max(largestY,d.y+d.radius)});if(this._size[0]-largestX>this._size[1]-largestY){transformCoords.x=(this._size[0]-largestX)/2-padding}else{transformCoords.y=(this._size[1]-largestY)/2-padding}this._cvWrapper.select("g").attr("transform","translate("+transformCoords.x+","+transformCoords.y+")")};global.cloudViz.venn=cloudViz.util.createConstructor(venn)})(this);(function(global){"use strict";var sunburstIdentity=0;var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},sunburst=Object.create(core);sunburst.init=function(options){this._type="sunburst";this._hiddenNodes=[];this._outRangeNodes=[];this._invalidNodes=[];this._initDefaultOptions();this.setOptions(options);this.chartId="sunburst-"+sunburstIdentity++;if(options.enableSelection){this.selectionCache(new dv.util.SelectionCache);var self=this;this._selectionCache.on("selectionChanged",function(source,all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all);self._onSelectionChanged(source,all,added,removed,0)})}return this};sunburst._initDefaultOptions=function(){var metricName="Visits",defaults={otherColor:"#ccc",otherGrayColor:"#999",outRangeColor:"#5a5a5a",metricColor:"#fff",seqColors:["#faf0c8","#d2dc73","#5faf69","#00505A"],seqColorsHeat:["#5a6eaa","#3287d2","#3cb5a0","#5faf69","#8cc350","#c3d250","#f5c841","#f0a01e","#eb782d","#fa5a50"],colors:[],theme:"specialDefault",padding:{top:10,bottom:60,left:10,right:10},customEvents:["metric","select","zoom","hidden"],selectActions:[],hiddenItems:[],selectedItem:null,zoomedItem:null,secondaryMetricIndex:null,secondaryMetricType:null,enableSelection:false};return Object.getPrototypeOf(sunburst)._initDefaultOptions.call(this,defaults)};sunburst._onAutoResize=function(){this.resize()};sunburst.resize=function(){if(!d3.select(this._options.parent).selectAll(".sunburst-cv").node()){return}this._sizeChart();this._render(true)};sunburst.reset=function(){Object.getPrototypeOf(sunburst).reset.apply(this,arguments)};sunburst._preRender=function(){if(this._paths){var keys=this._oldKeys=this._dataAdapter.getDataByPathKey(),k,d;for(k in keys){d=keys[k];keys[k]={xo:d.x,dxo:d.dx,yo:d.y,dyo:d.dy}}}Object.getPrototypeOf(sunburst)._preRender.apply(this);var options=this._options,self=this,adapter=this._dataAdapter,l10n=adapter.l10n.labels.sunburst,parent=d3.select(options.parent);if(options.secondaryMetricIndex){adapter.setSecondaryMetricIndex(options.secondaryMetricIndex)}if(options.secondaryMetricType){adapter.setSecondaryMetricType(options.secondaryMetricType)}if(options.selectActions){this._customActions=options.selectActions}if(adapter.getSecondaryMetricIndex()){self._hideNode(adapter.data(),self._invalidNodes,function(d){return self._isInvalidNode(d)})}var hiddenItems=options.hiddenItems||[];hiddenItems=hiddenItems.length?hiddenItems:this._hiddenNodes;this._setHiddenNodes(hiddenItems);this._setZoomPath(options.zoomedItem||this._zoomedPath);this._setSelectedNode(options.selectedItem||this._lockedNode,true);var infoWrapper=parent.selectAll(".sunburst-cv").data([0]);infoWrapper.enter().insert("div",":first-child").classed("sunburst-cv",true);var wrapper=infoWrapper.selectAll(".sunburst-cv-wrapper").data([0]);wrapper.enter().insert("div",":first-child").classed("sunburst-cv-wrapper",true);var container=wrapper.selectAll(".sunburst-cv-container").data([0]);container.enter().insert("div",":first-child").classed("sunburst-cv-container",true);var svg=container.selectAll(".sunburst-svg").data([0]);svg.enter().append("svg").classed("sunburst-svg",true);var paths=svg.selectAll(".sunburst-svg-container").data([0]);paths.enter().append("g").classed("sunburst-svg-container",true);var pathsContainer=paths.selectAll(".sunburst-path-container").data([0]);pathsContainer.enter().append("g").classed("sunburst-path-container",true);var chartLabel=wrapper.selectAll(".sunburst-cv-label").data([0]);chartLabel.enter().append("div").classed("sunburst-cv-label",true);var chartLabelWrap=chartLabel.selectAll(".sunburst-cv-label-wrap").data([0]);chartLabelWrap.enter().append("div").classed("sunburst-cv-label-wrap",true);var chartLabelMetric=chartLabelWrap.selectAll(".sunburst-cv-label-metric").data([0]);chartLabelMetric.enter().append("div").classed("sunburst-cv-label-metric",true);var chartAudiences=chartLabelWrap.selectAll(".sunburst-audiences").data([0]);chartAudiences.enter().append("div").classed("sunburst-audiences",true);chartAudiences.exit().remove();self._highlightedOverlay.setUpSelectedOverlay(paths);var actions=infoWrapper.selectAll(".sunburst-cv-actions-pane").data([0]);actions.enter().append("div").classed("sunburst-cv-actions-pane",true);actions.exit().remove();var zoomout=actions.selectAll(".actions-pane-zoomout").data([0]);zoomout.enter().append("div").classed("actions-pane-zoomout",true).classed("actions-pane-action",true);zoomout.html('<i class="icon zoomout"></i><span>'+sunburst.escapeHtml(l10n.zoomout)+"</span>");zoomout.on("click",function(){self._zoomPath(adapter.data())});zoomout.exit().remove();var hidden=actions.selectAll(".actions-pane-hidden").data([0]);hidden.enter().append("div").classed("actions-pane-hidden",true).classed("actions-pane-action",true);hidden.html('<i class="icon hide"></i><span>'+sunburst.escapeHtml(self._hideLabelText())+"</span>");hidden.on("click",function(){self._unhidePaths()});hidden.exit().remove();var second=wrapper.selectAll(".sunburst-cv-sec-viz").data([0]);var secondEntry=second.enter().append("div").classed("sunburst-cv-sec-viz",true);secondEntry.append("span").classed("title",true);var secondEntryBar=secondEntry.append("span").classed("bar",true);secondEntryBar.append("span").classed("button",true).classed("color",true).append("span");secondEntryBar.append("span").classed("button",true).classed("height",true).append("span");secondEntryBar.append("span").classed("button",true).classed("both",true).append("span");second.selectAll(".button.color").on("click",function(){adapter.setSecondaryMetricType("color");self._secondaryMetricChanged()}).selectAll("span").html(l10n.color);second.selectAll(".button.height").on("click",function(){adapter.setSecondaryMetricType("height");self._secondaryMetricChanged()}).selectAll("span").html(l10n.height);second.selectAll(".button.both").on("click",function(){adapter.setSecondaryMetricType("both");self._secondaryMetricChanged()}).selectAll("span").html(l10n.both);second.exit().remove();var secSeq=wrapper.selectAll(".sunburst-cv-secondary").data([0]);secSeq.enter().append("div").classed("sunburst-cv-secondary",true);secSeq.exit().remove();var paneSeq=secSeq.selectAll(".sunburst-cv-color").data([0]);paneSeq.enter().append("div").classed("sunburst-cv-color",true);paneSeq.exit().remove();var pane=infoWrapper.selectAll(".sunburst-cv-info-pane").data([0]);pane.enter().append("div").classed("sunburst-cv-info-pane",true);pane.exit().remove();var paneContent=pane.selectAll(".info-pane-content").data([0]);paneContent.enter().append("div").classed("info-pane-content",true);paneContent.exit().remove();var paneCategories=paneContent.selectAll(".info-pane-categories").data([0]);paneCategories.enter().append("div").classed("info-pane-categories",true).append("div").classed("pane-title",true).append("span");paneCategories.exit().remove();var paneAudiences=paneContent.selectAll(".sunburst-audiences").data([0]);paneAudiences.enter().append("div").classed("sunburst-audiences",true).append("div").classed("pane-title",true).append("span").text(l10n.audience);paneAudiences.exit().remove();var paneActions=paneContent.selectAll(".info-pane-actions").data([0]);paneActions.enter().append("div").classed("info-pane-actions",true);paneActions.exit().remove();var paneMetrics=paneContent.selectAll(".info-pane-metrics").data([0]);var metricsEnter=paneMetrics.enter().append("div").classed("info-pane-metrics",true);metricsEnter.append("div").classed("pane-title",true).classed("pri-metric",true).append("span");metricsEnter.append("div").classed("info-pane-metrics-labels",true).classed("pri-metric-labels",true);metricsEnter.append("div").classed("pane-title",true).classed("sec-metric",true).append("span");metricsEnter.append("div").classed("info-pane-metrics-labels",true).classed("sec-metrics-labels",true).append("span").classed("sec-metrics-help",true);metricsEnter.append("div").classed("pane-title",true).classed("rank-chart",true).append("span");metricsEnter.append("div").classed("info-pane-metrics-chart",true);paneMetrics.exit().remove();var paneExtra=paneContent.selectAll(".info-pane-extra").data([0]);paneExtra.enter().append("div").classed("info-pane-extra",true);paneExtra.exit().remove();var scrollTip=infoWrapper.selectAll(".sunburst-cv-mobile-scroll").data([0]);scrollTip.enter().append("div").classed("sunburst-cv-mobile-scroll",true);scrollTip.html(l10n.mobilescroll);scrollTip.exit().remove();this._sizeChart();infoWrapper.classed("hiddenpaths",!!this._hiddenNodes.length)};sunburst._render=function(resize){Object.getPrototypeOf(sunburst)._render.apply(this);var self=this,options=this._options,adapter=this._dataAdapter,data=adapter.data(),wrapper=d3.select(options.parent).selectAll(".sunburst-cv"),container=wrapper.selectAll(".sunburst-cv-container"),svg=container.selectAll(".sunburst-svg-container"),width=parseInt(container.style("width"),10),height=parseInt(container.style("height"),10),radius=this._radius=Math.min(width,height)/2;var isMobileSize=this._isMobileSize(),numRings=data.categories.length+1,ringDivisor=this._ringDivisor=1/numRings,centerLabelWidth=isMobileSize?20:140,centerRadius=this._centerRadius=Math.ceil(centerLabelWidth/2/Math.cos(Math.PI/4));svg.attr("transform","translate("+width/2+","+height/2+")");if(!resize&&this._yScale){this._oldYScale=this._yScale}if(!resize&&this._xScale){this._oldXScale=this._xScale}var xScale=this._xScale=d3.scale.linear().domain(this._oldXScale?this._oldXScale.domain():[0,1]).range([0,2*Math.PI]),yScale=this._yScale=d3.scale.linear().domain([0,ringDivisor,1]).range([0,centerRadius,radius]),arc=this._arc=d3.svg.arc().startAngle(function(d){return Math.max(0,Math.min(2*Math.PI,xScale(d.x)))}).endAngle(function(d){return Math.max(0,Math.min(2*Math.PI,xScale(d.x+d.dx)))}).innerRadius(function(d){return Math.max(0,yScale(d.y))}).outerRadius(function(d){return Math.max(0,yScale(d.y+d.dy))});this._layoutPaths(resize);var chartLabel=d3.select(options.parent).select(".sunburst-cv-label"),labelWidth=Math.ceil(centerRadius*Math.cos(Math.PI/4)*2),labelHeight=labelWidth,labelTop=options.padding.top+Math.floor(height/2-labelHeight/2),labelLeft=options.padding.left+Math.floor(width/2-labelWidth/2);if(!isMobileSize){chartLabel.style("top",labelTop+"px").style("left",labelLeft+"px").style("width",labelWidth+"px").style("height",labelHeight+"px")}else{chartLabel.style("top","").style("left","").style("width","").style("height","")}this._updateDetails(this._lockedNode);if(adapter.isDataEmpty()){this._setErrorMessage(adapter.l10n.labels.core.nodata)}else if(adapter.isSizeEmpty()){this._setErrorMessage(adapter.l10n.labels.sunburst.emptyFirstMetric)}else{this._clearErrorMessage()}};sunburst._getHiddenNodes=function(){return this._hiddenNodes.concat(this._outRangeNodes,this._invalidNodes)};sunburst._adjustDataSize=function(node,modifier,minmax){var options=this._options,self=this,adapter=this._dataAdapter,level=node.depth-1,zoomed=this._zoomedPath,minHeight=.15,metricIndex=adapter.getStackedMetricIndex();if(level>=0&&node.metrics&&node.metrics[metricIndex]){node.y-=modifier;var value=node.metrics[metricIndex].value,cat=minmax[level],max=cat.max,min=Math.min(0,cat.min),scale=d3.scale.linear().domain([min,max]).range([minHeight,1]),newDy=scale(value)*node.dy;if(max===min||zoomed&&zoomed.depth>node.depth){newDy=node.dy}modifier+=node.dy-newDy;node.dy=newDy}if(!node.children||!node.children.length){return}node.children.forEach(function(c){self._adjustDataSize(c,modifier,minmax)})};sunburst._getLevelUniqueNodes=function(node,level,includeHidden){var adapter=this._dataAdapter,hidden=this._getHiddenNodes(),nodes=[],nodesByName=[],self=this,zoomed=this._zoomedPath;function getNodes(d){if(zoomed&&zoomed.depth===d.depth&&zoomed!==d){return}if(d.depth===level){if(!includeHidden&&hidden.indexOf(d)>=0){return}if(nodesByName.indexOf(d.name)>=0){return}nodes.push(d);nodesByName.push(d.name);return}if(!d.children||!d.children.length){return}d.children.forEach(function(c){getNodes(c)})}getNodes(node);return nodes||[]};sunburst._layoutPaths=function(modify){var options=this._options,arc=this._arc,self=this,adapter=this._dataAdapter,data=adapter.data(),hidden=this._getHiddenNodes(),container=d3.select(options.parent).selectAll(".sunburst-path-container"),partition=d3.layout.partition().value(function(d){return hidden.indexOf(d)<0?d.size:0}).sort(function(a,b){if(adapter.isOther(a)){return 1}if(adapter.isOther(b)){return-1}return b.size-a.size});if(modify&&self._paths){self._paths.each(function(d){d.xo=d.x;d.dxo=d.dx;d.yo=d.y;d.dyo=d.dy})}var nodes=partition.nodes(data);var paths=this._paths=container.selectAll("path").data(nodes,adapter.getPathKey);paths.enter().insert("path",":first-child");paths.attr("id",function(d,i,j){return self.chartId+"-"+d._sid}).attr("class",function(d,i,j){return"datum-"+d._sid}).attr("data-sid",function(d,i){return d._sid}).on("contextmenu",self.makeContextMenuHandler(self)).on("mousedown",self.makeSelectHandler()).on("click",function(d,i){var chord=dv.util.determineKeyModifiers(d3.event,self._selectionCache.selectionKeymap());if(!chord){self._lockNode({data:d,type:"path"})}}).on("dblclick",function(d,i){var chord=dv.util.determineKeyModifiers(d3.event,self._selectionCache.selectionKeymap());if(!chord){self._zoomPath(d)}}).on("mouseenter",function(d,i){if(self._lockedNode||self._isTouch()){return}self._highlightNode({data:d,type:"path"})});var pathsExit=paths.exit().classed("removing",true);setTimeout(function(){pathsExit.remove()},501);self.setColorScale();this._updatePathColors();self._buildColorSlider();this._updateSecondaryMetricClasses();var metric;if(metric=adapter.getStackedMetric()){var index=adapter.getStackedMetricIndex(),zoomed=this._zoomedPath,isRate=false,minMax;if(isRate){var metricMinMax=self.getMetricCategoryMinMax(index);minMax=Array.apply(null,new Array(data.categories.length)).map(function(){return metricMinMax})}else{minMax=data.categories.map(function(c,i){return self.getMetricCategoryMinMax(index,i)})}self._adjustDataSize(data,0,minMax)}if(this._oldKeys){var key,k,os=this._oldYScale,osd=os.domain(),s=this._yScale,sd=s.domain();self._paths.each(function(d){key=adapter.getPathKey(d);if(k=self._oldKeys[key]){d.xo=k.xo;d.dxo=k.dxo;d.yo=s.invert(os(k.yo));if(adapter.isRoot(d)){d.dyo=s.invert(os(k.dyo))}else{d.dyo=s.invert(os(osd[1]+k.dyo))-sd[1]}}});this._oldKeys=null}paths.each(function(d){var key=adapter.getPathKey(d);if("undefined"===typeof d.xo){d.xo=d.x;d.dxo=d.dx;d.yo=0;d.dyo=0}});paths.transition().duration(500).attrTween("d",this._changeTween(true));container.on("mouseleave",function(d,i){if(self._lockedNode||self._isTouch()){return}self._unhighlightNode()});if(!modify){if(this._oldLockedNode){this._lockNode(this._oldLockedNode)}else{this._unlockNode()}this._oldLockedNode=null;this._updateZoomPathStyles(this._oldZoomed);this._oldZoomed=null}};sunburst._isMobileSize=function(){var options=this._options,parentWidth=options.parent.offsetWidth,visibleWidth=dv.util.getPercentValue(options.width,parentWidth);return visibleWidth<640};sunburst._isTouch=function(){return"ontouchstart"in document.documentElement};sunburst._postRender=function(){Object.getPrototypeOf(sunburst)._postRender.apply(this)};sunburst._sizeChart=function(focusElem){var options=this._options,data=this._dataAdapter.data(),parent=d3.select(options.parent),self=this,infoWrapper=parent.selectAll(".sunburst-cv"),wrapper=infoWrapper.selectAll(".sunburst-cv-wrapper"),container=wrapper.selectAll(".sunburst-cv-container"),infoPane=infoWrapper.selectAll(".sunburst-cv-info-pane"),scrollTip=infoWrapper.selectAll(".sunburst-cv-mobile-scroll"),parentWidth=options.parent.offsetWidth,parentHeight=options.parent.offsetHeight,visibleWidth=dv.util.getPercentValue(options.width,parentWidth),visibleHeight=dv.util.getPercentValue(options.height,parentHeight),isMobileSize=this._isMobileSize(),adjustedWidth=visibleWidth+(isMobileSize?0:-250),adjustedHeight=isMobileSize?Math.min(adjustedWidth,visibleHeight):visibleHeight,padding=options.padding;var containerWidth=adjustedWidth-2-(padding.left+padding.right),containerHeight=adjustedHeight-2-(padding.top+padding.bottom);infoWrapper.style("width",visibleWidth+"px").style("height",visibleHeight+"px").classed("is-desktop",!isMobileSize).classed("not-touch",!this._isTouch());wrapper.style("width",adjustedWidth+"px").style("height",adjustedHeight+"px");container.style("width",containerWidth+"px").style("height",containerHeight+"px");container.style("padding-top",padding.top+"px").style("padding-left",padding.left+"px");scrollTip.style("top",visibleHeight-30+"px").classed("visible",!infoWrapper.node().scrollTop).classed("show",visibleHeight<=adjustedHeight+130);infoWrapper.on("scroll",function(){scrollTip.classed("visible",!infoWrapper.node().scrollTop)})};sunburst._buildColorSlider=function(){var options=this._options,self=this,adapter=this._dataAdapter,pane=d3.select(options.parent).selectAll(".sunburst-cv-color");if(!adapter.getColorMetric()){return pane.text("")}var data=adapter.data(),metric=adapter.getColorMetric(),extent=this._colorExtent,min=self._colorExtentMin,max=self._colorExtentMax,container=d3.select(options.parent).selectAll(".sunburst-cv-container"),containerWidth=parseInt(container.style("width"),10),paneWidth=containerWidth/2,colors=adapter.seqColors(),colorDiv=Math.round(100/(colors.length-1)),positions=[],height=12,padding=10,controlSpacer=9,minMaxWidth=40,legendHeight=height+padding*2+2,legendWidth=paneWidth,barWidth=legendWidth-minMaxWidth*2-controlSpacer*2;colors.forEach(function(c,i){positions.push(i*colorDiv+"%")});pane.style("width",legendWidth+"px");var legendTitle=pane.selectAll(".legend-title").data([0]);legendTitle.enter().insert("div",":first-child").classed("legend-title",true);legendTitle.text(metric.name);var legend=pane.selectAll(".color-slider-legend").data([0]);legend.enter().append("div").classed("color-slider-legend",true);legend.style("width",legendWidth+"px").style("height",legendHeight+"px");var svg=legend.selectAll(".color-slider").data([0]);svg.enter().append("svg").classed("color-slider",true).style("height",legendHeight+"px").style("width","100%");var styles=svg.selectAll("style").data([0]);styles.enter().append("style");styles.text(function(d){var style=".sunburst-cv .sunburst-cv-color .grad-rect { fill: url(#backGradient); \n";return style});var defs=svg.selectAll("defs").data([0]);defs.enter().append("defs");var backGradient=defs.selectAll("#backGradient").data([0]);backGradient.enter().append("linearGradient").attr("id","backGradient");var applyStops=function(selection,positions,colors){var stop=selection.selectAll("stop").data(positions);stop.enter().append("stop").attr("class",function(d,i){return"stop"+i});stop.attr("offset",function(d){return d}).attr("stop-color",function(d,i){return colors[i]})};applyStops(backGradient,positions,colors);var gradRect=svg.selectAll(".grad-rect").data([0]);gradRect.enter().append("rect").classed("grad-rect",true);gradRect.attr("x",minMaxWidth+controlSpacer).attr("y",padding).attr("rx",height/2).attr("ry",height/2).attr("width",barWidth).attr("height",height);var legendLabel=legend.selectAll(".legend-label").data(["min","max"]);legendLabel.enter().append("div").attr("class",function(d){return"legend-label "+d});legendLabel.style("left",function(d){return(d==="min"?0:minMaxWidth+controlSpacer*2+barWidth)+"px"}).style("width",minMaxWidth+"px").text(function(d){var val=d==="min"?min:max;val=null===val?d==="min"?"-":"+":self._formatNumber(metric.format,val,null,{dataItem:d});return val})};sunburst._isNodeOutsideRange=function(n){var adapter=this._dataAdapter,self=this,children=n.children||[],inside=children.some(function(c){return!self._isNodeOutsideRange(c)});return!inside&&this.isOutsideRange(n)};sunburst._isInvalidNode=function(n){return this._dataAdapter.isOther(n)};sunburst._getDataNode=function(n){if(!n){return null}var adapter=this._dataAdapter;if(typeof n==="object"){n=adapter.getPathKey(n)}return adapter.getDataByPathKey()[n]||null};sunburst._getCategoryObj=function(n){if(!n){return null}return this._dataAdapter.getCategoryByName(n)};sunburst._hideLabelText=function(){var num=this._hiddenNodes.length,l10n=this._dataAdapter.l10n.labels.sunburst,label=num===1?l10n.hidden:l10n["hidden2+"];return label.replace(/\{value\}/i,num)};sunburst._hideNode=function(n,hidden,hide){var self=this;if(hidden.indexOf(n)>-1){return}if(hide&&hide(n)||!hide){hidden.push(n)}if(!n.children||!n.children.length){return}n.children.forEach(function(c){self._hideNode(c,hidden,hide)})};sunburst._hidePath=function(d,hidden,hide){this._hideNode(d,hidden,hide);this._hidePathRender(hidden)};sunburst._hidePathRender=function(hidden){var options=this._options,adapter=this._dataAdapter;this._layoutPaths(true);this._updateHiddenState(this._hiddenNodes);if(this._lockedNode&&hidden.indexOf(this._lockedNode.data)>-1){this._unlockNode()}if(this._zoomedPath&&hidden.indexOf(this._zoomedPath)>-1){this._zoomPath(adapter.data())}var num=this._hiddenNodes.length,parent=d3.select(options.parent);parent.selectAll(".actions-pane-hidden").selectAll("span").html(this._hideLabelText());parent.selectAll(".sunburst-cv").classed("hiddenpaths",!!num)};sunburst._setHiddenNodes=function(nodes){nodes=[].concat(nodes||[]);var self=this;this._hiddenNodes=[];nodes.forEach(function(n){n=self._getDataNode(n);if(n){self._hideNode(n,self._hiddenNodes)}})};sunburst._unhidePaths=function(){this._hiddenNodes=[];this._layoutPaths(true);this._updateHiddenState(this._hiddenNodes);d3.select(this._options.parent).selectAll(".sunburst-cv").classed("hiddenpaths",false)};sunburst._zoomPath=function(d){if(!this._canZoomIn(d)){return}this._zoomedPath=d;this._zoomPathRender()};sunburst._zoomPathRender=function(){this._layoutPaths(true);this._updateZoomPathStyles(this._zoomedPath);this._updateZoomedState(this._zoomedPath);this._updateDetails(this._lockedNode)};sunburst._setZoomPath=function(node){this._zoomedPath=null;var d=this._getDataNode(node);if(!d){return}if(!this._canZoomIn(d)){return}this._zoomedPath=this._oldZoomed=d};sunburst._updateZoomPathStyles=function(d){var self=this,container=d3.select(this._options.parent).selectAll(".sunburst-cv");container.classed("zoomed",d&&d.depth>0);container.selectAll(".sunburst-cv-container").selectAll("path").each(function(node){d3.select(this).classed("beyondzoom",node&&d&&node!==d&&node.depth>0&&(node.depth<=d.depth||!self._hasAncestorNode(node,d)));d3.select(this).classed("zoomed",node===d)})};sunburst._changeTween=function(hide){var x=this._xScale,y=this._yScale,path=this._zoomedPath||this._dataAdapter.data(),arc=this._arc,radius=this._radius,ringDivisor=this._ringDivisor,centerRadius=this._centerRadius,cats=this._dataAdapter.categories(),xd=d3.interpolate(x.domain(),[path.x,path.x+path.dx]),yd=d3.interpolate(y.domain(),path.y?[0,ringDivisor,path.y,1]:[0,ringDivisor,1]),yr=d3.interpolate(y.range(),path.y?[0,centerRadius,centerRadius,radius]:[0,centerRadius,radius]);return function(d,i){var ip=d3.interpolate({x:d.xo,dx:d.dxo,y:d.yo,dy:d.dyo},d);return i?function(t){return hide?arc(ip(t)):arc(d)}:function(t){x.domain(xd(t));y.domain(yd(t)).range(yr(t));return hide?arc(ip(t)):arc(d)}}};sunburst._updatePathColors=function(){var self=this,adapter=this._dataAdapter,hidden=this._getHiddenNodes(),container=d3.select(this._options.parent).selectAll(".sunburst-cv"),highlighted=container.classed("node-highlighted");this._paths.style("fill",function(d){var path=d3.select(this),gray=highlighted&&!path.classed("highlighted");return self.getNodeColor(d,gray)}).classed("hidden",function(d){return hidden.indexOf(d)>=0})};sunburst._lockNode=function(node){var self=this,locked=self._lockedNode;if(locked&&locked.data===node.data&&locked.type===node.type){return self._unlockNode(node)}self._lockedNode=node;self._highlightNode(node);self._updateLockedState(node);setTimeout(function(){d3.select(self._options.parent).select(".sunburst-cv-wrapper").on("click.cvpath",function(){if(d3.event&&d3.event.target&&d3.event.target.nodeName==="path"){return}self._unlockNode()})},10)};sunburst._setSelectedNode=function(node,initial){this._lockedNode=null;var locked=this._determineSelectedNode(node);if(!locked){if(!initial){this._unlockNode()}return}if(initial){this._oldLockedNode=locked}else{this._lockNode(locked)}};sunburst._determineSelectedNode=function(locked){if(!locked){return null}var lockedNode=null;if(locked.type){if("path"===locked.type){locked.data=this._getDataNode(locked.data);if(locked.data){lockedNode=locked}}if("category"===locked.type&&locked.data&&locked.data.name){lockedNode=this._dataAdapter.getCategoryByName(locked.data.name)}return lockedNode}var node;node=this._getCategoryObj(locked);if(node){return{data:node,type:"category"}}node=this._getDataNode(locked);if(node){return{data:node,type:"path"}}};sunburst._unlockNode=function(node){var self=this;self._lockedNode=null;self._updateLockedState();if(node&&!self._isTouch()){self._highlightNode(node)}else{self._unhighlightNode()}d3.select(self._options.parent).select(".sunburst-cv-container").on("click.cvpath",null)};sunburst._highlightNode=function(d){var self=this,type=d&&d.type||"path",node=d&&d.data||null,nodes=this._getAncestorNodes(node),methods={};methods.category=function(n){return n.depth===node.index+1};methods.item=function(n){return n&&node&&n.name===node.name};methods.path=function(n){return nodes.indexOf(n)>=0||self._lockedNode&&n.parent===node};var container=d3.select(this._options.parent).selectAll(".sunburst-cv");container.classed("node-highlighted",true);container.selectAll(".sunburst-cv-container").selectAll("path").each(function(n){d3.select(this).classed("highlighted",methods[type](n))});if(!self._lockedNode){container.selectAll(".info-pane-category").each(function(c){d3.select(this).classed("disabled","category"===type&&c!==node)})}this._updateDetails(d);this._updatePathColors()};sunburst._unhighlightNode=function(){this._removeHighlights();this._updateDetails()};sunburst._removeHighlights=function(){var container=d3.select(this._options.parent);container.selectAll(".sunburst-cv").classed("node-highlighted",false).selectAll("path").classed("highlighted",false);container.selectAll(".info-pane-category").classed("disabled",false);this._updatePathColors()};sunburst._secondaryMetricChanged=function(){var self=this,adapter=this._dataAdapter,m=adapter.getSecondaryMetricIndex();self._outRangeNodes=[];if(m){self._hidePath(adapter.data(),self._invalidNodes,function(d){return self._isInvalidNode(d)})}else{self._invalidNodes=[];self._layoutPaths(true)}this._updateDetails(this._lockedNode);this._updateMetricState()};sunburst._updateSecondaryMetricClasses=function(){var adapter=this._dataAdapter,l10n=adapter.l10n.labels.sunburst,m=adapter.getSecondaryMetricIndex();var container=d3.select(this._options.parent);container.selectAll(".sunburst-cv").classed("secondary-metric",!!m);var secondary=container.selectAll(".sunburst-cv-sec-viz");secondary.selectAll(".button").classed("active",false);var type=adapter.getSecondaryMetricType();if(type){secondary.selectAll(".button."+type).classed("active",true)}var metric=adapter.getSecondaryMetric(),name=metric&&metric.name||null;secondary.selectAll(".title").html(name?l10n["mapmetric"].replace(/\{metric\}/i,name):"")};sunburst._updateDetails=function(d){if(d&&d.type==="item"){return}this._setChartMetrics(d);this._setDetailsMetrics(d);this._setDetailsAudiences(d);this._setDetailsCategories(d);this._setDetailsActions(d)};sunburst._setDetailsCategories=function(d){var self=this,adapter=this._dataAdapter,l10n=adapter.l10n.labels.sunburst,data=adapter.data(),categories=adapter.categories(),pane=d3.select(this._options.parent).select(".info-pane-categories"),zoomDepth=Math.max(0,self._zoomedPath?self._zoomedPath.depth-1:0),list=d&&d.type==="path"&&self._lockedNode?[]:categories.slice(zoomDepth),numCats=list.length,node=d||{},categoryLabel=pane.selectAll(".info-pane-category").data(list),categoryEnter=categoryLabel.enter().append("div").classed("info-pane-category",true).classed("inactive",true);pane.select(".pane-title").select("span").text(1===numCats.length?l10n["category"]:l10n["category2+"]);categoryLabel.each(function(d,i){var label=d3.select(this);label.text("");self._createRingMarker(label,numCats,i);label.append("span").classed("name",true).html(d&&sunburst.escapeHtml(d.name)||"");label.append("span").classed("top",true).html("("+l10n["topresults"].replace(/\{value\}/i,d.top)+")");if(node.type==="path"){label.classed("disabled",!self._lockedNode&&node.data&&node.data.depth-1!==i-zoomDepth)}else if(self._lockedNode&&self._lockedNode.type==="category"){label.classed("disabled",d!==self._lockedNode.data)}});setTimeout(function(){categoryEnter.classed("inactive",false)},1);var categoryExit=categoryLabel.exit().classed("inactive",true).on("mouseenter",null).on("mouseleave",null).on("click",null);setTimeout(function(){categoryExit.remove()},400);categoryLabel.on("mouseenter",function(d,i){if(self._lockedNode||self._isTouch()){return}self._highlightNode({data:d,type:"category"})});categoryLabel.on("mouseleave",function(d,i){if(self._lockedNode||self._isTouch()){return}self._unhighlightNode()});categoryLabel.on("click",function(d,i){self._lockNode({data:d,type:"category"})});pane.classed("empty",!list.length)};sunburst._setDetailsAudiences=function(d){var self=this,adapter=this._dataAdapter,type=d&&d.type||"",node=d&&d.data||null,isCategory=type==="category",data=adapter.data(),nodes=isCategory?this._getLevelUniqueNodes(data,node.index+1,false):this._getAncestorNodes(node),dataKey=isCategory?function(d,i){return i}:function(d,i){return d&&d.depth||0},categories=adapter.categories(),container=d3.select(this._options.parent).selectAll(".sunburst-audiences"),endNode=nodes&&nodes[0]||data,pathIsMetric=data===endNode,nodesList=!nodes||pathIsMetric?[]:nodes.slice();container.each(function(d){var pane=d3.select(this),list=nodesList.slice();var isCenterLabel=d3.select(pane.node().parentNode).classed("sunburst-cv-label-wrap");if(!isCategory&&!isCenterLabel){if(!self._lockedNode){list=[]}list.reverse()}else if(isCategory&&isCenterLabel){list=[]}var audienceLabel=pane.selectAll(".sunburst-audience").data(list,dataKey),audienceEnter=audienceLabel.enter().append("span").classed("sunburst-audience",true).classed("inactive",true);audienceEnter.append("span").classed("marker",true).style("background-color","#dcdcdc");audienceEnter.append("span").classed("category",true);audienceEnter.append("span").classed("name",true);audienceLabel.each(function(d,i){var label=d3.select(this),category=categories[d.depth-1];label.select(".marker").style("background-color",self.getNodeColor(d));label.select(".category").classed("hidden",isCategory||isCenterLabel).text(!isCategory&&category&&category.name||"");label.select(".name").text(d.name);label.classed("to-remove",false).attr("my-name",d.name).attr("my-depth",d.depth);label.on("mouseenter",function(d,i){if(self._isTouch()){return}self._highlightNode({data:d,type:"item"})});label.on("mouseleave",function(d,i){if(self._isTouch()){return}if(self._lockedNode){self._highlightNode(self._lockedNode)}else{self._unhighlightNode()}});if(isCenterLabel){return}var clone=d3.select(label.node().cloneNode(true)).style("height","").classed("test",true).classed("inactive",false);pane.node().appendChild(clone.node());label.attr("my-height",parseInt(clone.style("height"),10));clone.remove()});audienceLabel.order();setTimeout(function(){audienceLabel.each(function(d,i){var label=d3.select(this);label.classed("inactive",false);if(isCenterLabel){return}label.style("height",label.attr("my-height")+"px")})},1);var audienceExit=audienceLabel.exit().classed("inactive",true).style("height","").classed("to-remove",true).on("mouseenter",null).on("mouseleave",null).on("click",null);setTimeout(function(){audienceExit.each(function(d,i){var exitLabel=d3.select(this);if(exitLabel.classed("to-remove")){exitLabel.remove()}})},400);pane.classed("empty",!list.length)})};sunburst._setDetailsActions=function(d){var self=this,adapter=this._dataAdapter,data=adapter.data();function zoomin(){self._zoomPath(self._lockedNode.data)}function zoomout(){self._zoomPath(data)}function hide(){self._hidePath(self._lockedNode.data,self._hiddenNodes)}function hideall(){var node=self._lockedNode.data,hidden=self._hiddenNodes;if(!node){return}self._hidePath(data,hidden,function(d){return d.name===node.name||hidden.indexOf(d.parent)>=0})}var actions=[],l10n=adapter.l10n.labels.sunburst;if(d&&d.type==="path"&&self._lockedNode){var node=d.data,allowedZoom=self._canZoomIn(node),pathIsMetric=node===data;if(!self._lockedNode){if(!pathIsMetric){actions.push({click:false,icon:"more",label:l10n.moreAction})}if(allowedZoom){actions.push({click:false,icon:"zoomin",label:l10n.zoomAction})}}else if(!pathIsMetric){if(allowedZoom){actions.push({click:zoomin,className:"zoomin",icon:"zoomin",label:l10n.zoomin})}else if(self._canZoomOut(node)){actions.push({click:zoomout,className:"zoomout",icon:"zoomout",label:l10n.zoomout})}actions.push({click:hide,className:"hide",icon:"hide",label:l10n.hide});actions.push({click:hideall,className:"hideallname",icon:"hide",label:l10n.hideall})}}this._actions=actions;this._renderDetailsActions()};sunburst._renderDetailsActions=function(){var self=this,pane=d3.select(this._options.parent).select(".info-pane-actions");var chartActions=pane.selectAll(".info-pane-actions-chart").data([0]);chartActions.enter().append("div").classed("info-pane-actions-chart",true).classed("info-pane-actions-pane",true);var extraActions=pane.selectAll(".info-pane-actions-extra").data([0]);extraActions.enter().append("div").classed("info-pane-actions-extra",true).classed("info-pane-actions-pane",true);var actions=this._actions||[],extras=self._lockedNode&&self._lockedNode.type==="path"?self._customActions:[],ap=!!actions.length,ep=!!extras.length;pane.classed("full-width",!ap&&ep||!ep&&ap);pane.classed("empty",!ap&&!ep);self._buildActionsPane(chartActions,actions);self._buildActionsPane(extraActions,extras);var hidename=pane.selectAll(".hideallname");hidename.on("mouseenter",function(){if(self._isTouch()){return}self._highlightNode({data:self._lockedNode.data,type:"item"})});hidename.on("mouseleave",function(d,i){if(self._isTouch()){return}if(self._lockedNode){self._highlightNode(self._lockedNode)}else{self._unhighlightNode()}})};sunburst._buildActionsPane=function(container,actions){var actionButtons=container.selectAll(".info-pane-action").data(actions);var actionEnter=actionButtons.enter().append("a").classed("info-pane-action",true).classed("inactive",true);actionEnter.append("i").classed("icon",true);actionEnter.append("span");actionButtons.each(function(d,i){var btn=d3.select(this);btn.select(".icon").attr("class","icon").classed(d.icon,true);btn.select("span").text(d.label);btn.attr("class","info-pane-action"+(btn.classed("inactive")?" inactive":"")+(d.click||d.href?" action":" help"));if(d.click){btn.on("click",d.click)}else{btn.on("click",null)}if(d.href){btn.attr("href",d.href)}else{btn.attr("href",null)}if(d.className){btn.classed(d.className,true)}var clone=d3.select(btn.node().cloneNode(true)).style("height","").classed("test",true).classed("inactive",false);container.node().appendChild(clone.node());btn.attr("my-height",parseInt(clone.style("height"),10));clone.remove()});setTimeout(function(){actionButtons.each(function(d,i){var btn=d3.select(this);btn.style("height",btn.attr("my-height")+"px").classed("inactive",false)})},1);var actionExit=actionButtons.exit().classed("inactive",true).style("height","").classed("to-remove",true).on("click",null);setTimeout(function(){actionExit.each(function(d,i){var exitAction=d3.select(this);if(exitAction.classed("to-remove")){exitAction.remove()}})},400);return!!actions.length};sunburst._setDetailsMetrics=function(d){var self=this,container=d3.select(this._options.parent).select(".info-pane-metrics"),plabels=container.select(".pri-metric-labels"),slabels=container.select(".sec-metrics-labels"),chart=container.select(".info-pane-metrics-chart"),adapter=this._dataAdapter,data=adapter.data(),pmetric=data.metrics.slice(0,1),smetrics=data.metrics.slice(1),categories=adapter.categories(),l10n=adapter.l10n.labels.sunburst,pathNode=d&&d.type==="path"?d.data:null,node=pathNode||data,hasChildren=pathNode&&pathNode.children&&pathNode.children.length&&this._lockedNode;container.classed("total",!hasChildren);container.selectAll(".pane-title").each(function(d,i){var title=d3.select(this),label=title.select("span");if(title.classed("pri-metric")){return label.text(l10n["primarymetric"])}if(title.classed("sec-metric")){title.classed("hidden",!smetrics.length);return label.text(!smetrics.length?"":smetrics.length===1?l10n["secondarymetric"]:l10n["secondarymetric2+"])}if(title.classed("rank-chart")){label.text(hasChildren?categories[pathNode.depth]&&categories[pathNode.depth].name:"")}});container.selectAll(".sec-metrics-help").each(function(d,i){d3.select(this).text(smetrics.length===1?l10n["secondarymetrichelp"]:l10n["secondarymetrichelp2+"]).classed("hidden",!smetrics.length)});this._setNodeMetricLabels(plabels,node,pmetric,!!pathNode);this._setNodeMetricLabels(slabels,node,smetrics,!!pathNode);this._setNodeMetricChart(chart,this._lockedNode?pathNode:null)};sunburst._setChartMetrics=function(d){var chartLabel=d3.select(this._options.parent).select(".sunburst-cv-label-wrap"),data=this._dataAdapter.data(),metrics=data.metrics.slice(),node=d&&d.type==="path"?d.data:data;if(metrics.length>1){metrics.length=1}this._setNodeMetricLabels(chartLabel,node,metrics,false)};sunburst._setNodeMetricLabels=function(container,node,metrics,marker){var self=this,adapter=this._dataAdapter,data=adapter.data(),l10n=adapter.l10n.labels.sunburst,primary=container.classed("pri-metric-labels")||container.classed("sunburst-cv-label-wrap"),metricLabel=container.selectAll(".sunburst-cv-label-metric").data(metrics),metricEntry=metricLabel.enter().append("div").classed("sunburst-cv-label-metric",true);marker=node&&node.children&&node.children.length&&this._lockedNode?marker:false;metricLabel.each(function(metric,i){var label=d3.select(this),value=self.getNodeValue(node,primary?i:i+1),total=self.getNodeValue(data,primary?i:i+1),isPercent="percent"===metric.format,isInvalid=adapter.isOther(node)&&!primary||0===total,percent=isPercent?value:value/self.getNodeValue(data,primary?i:i+1),activeLabel=primary||i+1===adapter.getSecondaryMetricIndex(),hasMarker=marker&&activeLabel,hasTotalPercent=null!==value&&!isPercent&&!isInvalid&&node!==data;label.classed("active",activeLabel);var icon=label.selectAll(".sunburst-cv-label-icon").data([metric]);icon.enter().append("i");icon.each(function(d){d3.select(this).attr("class","sunburst-cv-label-icon icon").classed(metric.icon||(primary?"donut":"stack"),true)});var number=label.selectAll(".sunburst-cv-label-number").data([metric]);number.enter().append("span").classed("sunburst-cv-label-number",true);number.html(isInvalid?"":self._formatValue(metric,value)).classed("hidden",isInvalid);var name=label.selectAll(".sunburst-cv-label-name").data([metric]);name.enter().append("span").classed("sunburst-cv-label-name",true).append("span");name.select("span").html(hasTotalPercent?l10n.percmetric.replace(/\{percent\}/i,self._formatNumber("percent",percent)).replace(/\{metric\}/i,metric.name):metric.name);var masknum=self.getMetricMaskNum(primary?i:i+1);var svg=name.selectAll(".sunburst-cv-label-marker").data([metric]);svg.enter().insert("svg",":first-child").classed("sunburst-cv-label-marker",true).append("rect").attr("width",12).attr("height",12);svg.classed("hidden",!hasMarker).select("rect").attr("style",null===masknum?"":"mask: url(#diagmask"+masknum+");");label.on("click",primary?null:function(){adapter.setSecondaryMetricIndex(i+1,true);self._secondaryMetricChanged()})});metricLabel.exit().remove()};sunburst._formatValue=function(metric,value,abbr){if("time"!==metric.format){return this._formatNumber(metric.format,value)}var v=value,adapter=this._dataAdapter,l10n=abbr?adapter.l10n.time.abbreviation:1===v?adapter.l10n.time.singular:adapter.l10n.time.plural,time=adapter.getTimeGranularity(v,true);return this._formatNumber(metric.format,v/time.divisor)+" "+l10n[time.gran]};sunburst._setNodeMetricChart=function(container,node){var self=this,adapter=this._dataAdapter,data=adapter.data(),hidden=self._getHiddenNodes(),children=node&&node.children||[],visible=children.filter(function(c){return hidden.indexOf(c)<0}),x=[],y=[],fill=[],metric=[],nodes=[],format=[],barData={x:x,y:y,fill:fill,metric:metric,format:format,node:nodes};function validMetric(m,i){return 0===i||i===adapter.getSecondaryMetricIndex()}var metrics=data.metrics.slice(),valid=metrics.filter(validMetric),uniqs=valid.map(function(m){return m.name});visible.reverse().forEach(function(n){var value;metrics.forEach(function(m,i){if(!validMetric(m,i)){return}if(null!==(value=self.getNodeValue(n,i))){y.push(value);x.push(n.name);fill.push(m.name);metric.push(m.name);format.push(m.format);nodes.push(n)}})});var hasContent=!!y.length;var paneSVG=container.selectAll(".info-pane-chart-svg").data([0]);paneSVG.enter().append("div").classed("info-pane-chart-svg",true);paneSVG.exit().remove();container.classed("hidden",!hasContent);if(hasContent){var barHeight=15,groupPadding=25,dodgeSpacing=.05,numInGroup=valid.length,numOfGroup=visible.length,groupHeight=numInGroup*barHeight+groupPadding,groupSpacing=groupPadding/groupHeight,chartHeight=Math.ceil(numInGroup*numOfGroup*barHeight/(1-groupSpacing));paneSVG.style("height",chartHeight+"px");var chart=dv.chart().layers([dv.geom.bar().map("group","fill").set("fill",function(d,i){return self.getNodeColor(d.data.node)}).each("start",function(d,i){var masknum=self.getMetricMaskNum(uniqs.indexOf(d.data.metric));d3.select(this).attr("mask",null===masknum?"":"url(#diagmask"+masknum+")")}).on("click",function(d){self._selectChildFromRanked(d)}).dodgePadding(dodgeSpacing),dv.geom.text().map("label","y").map("group","fill").set("fill","#4b4b4b").textFormat(function(d,i){return d?self._formatValue({format:this.__data__.data.format},d,true):""}).textAnchor("start").set("fill","#4b4b4b").dx(4).dy(5).on("click",function(d){self._selectChildFromRanked(d)})]).coord(dv.coord.cartesian().flip(true)).data(barData).position("dodge").guide("x",dv.guide.axis().tickDx(function(d,i){return d3.select(this).select("span").node().offsetWidth}).tickDy(function(d,i){return-numInGroup*barHeight/2-d3.select(this).select("span").node().offsetHeight/2}).tickSize(0).tickAnchor("end")).guide("y",dv.guide.axis().ticks(0).tickSize(0).tickFormat(function(d,i){return""})).map("x","x",dv.scale.ordinal().padding(groupSpacing)).width("100%").height(chartHeight).duration(400).padding({top:2,right:65}).parent(paneSVG.node());uniqs.forEach(function(g,index){var scale=dv.scale.linear().lowerLimit(0);scale.includeInDomain(function(d,i){return d.data["metric"]===uniqs[index]});chart.map("y","y",scale,index)});chart.render();var group=paneSVG.select("svg").selectAll("defs").data([0]);group.enter().append("defs");var patterns=[45];var pattern=group.selectAll("pattern").data(patterns);var patternEnter=pattern.enter().append("pattern").attr("id",function(d,i){return"diag"+i}).attr("patternUnits","userSpaceOnUse").attr("width","3").attr("height","3").attr("patternTransform",function(d,i){return"rotate("+d+" 2 2)"});patternEnter.append("rect").attr("x","0").attr("y","0").attr("width","3").attr("height","3").attr("style","fill:#fff;");patternEnter.append("path").attr("d","M -1,0 l 10,0").attr("style","stroke:#222; fill:none; stroke-width: 3px;");var mask=group.selectAll("mask").data(patterns);mask.enter().append("mask").attr("id",function(d,i){return"diagmask"+i}).attr("x","0").attr("y","0").append("rect").attr("x","0").attr("y","0").attr("width","100%").attr("height","1").attr("style",function(d,i){return"stroke:none; fill:url(#diag"+i+")"});group.selectAll("mask").selectAll("rect").attr("height",chartHeight)}else{paneSVG.style("height","0px")}};sunburst._selectChildFromRanked=function(d){var locked=this._lockedNode.data,name=d.data.x;if(!locked||!locked.children||!locked.children.length){return}var i,ii=locked.children.length,child,selected=null;for(i=0;i<ii;++i){if((child=locked.children[i]).name===name){selected=child;break}}if(selected){this._lockNode({data:selected,type:"path"})}};sunburst._createRingMarker=function(container,num,highlighted){var svg=container.append("svg").classed("category-ring",true),g=svg.append("g").attr("transform","translate(12,12)"),width=parseInt(svg.style("width"),10),radius=width/2,lineWidth=2,lineGap=1,center=radius-lineWidth*num-lineGap*(num-1),inner,outer,i;for(i=0;i<num;++i){inner=center+(lineWidth+lineGap)*i;outer=inner+lineWidth;g.append("path").classed("active",i===highlighted).attr("d",d3.svg.arc().innerRadius(inner).outerRadius(outer).startAngle(0).endAngle(2*Math.PI))}};sunburst._canZoomIn=function(d){var metric=this._dataAdapter.data(),zPath=this._zoomedPath;return d!==metric&&d!==zPath||d===metric&&metric!==zPath&&!!zPath};sunburst._canZoomOut=function(d){return d===this._zoomedPath};sunburst._getAncestorNodes=function(d){var path=[],current=d;if(!d){return path}while(current.parent){path.push(current);current=current.parent}if(!path.length){path=[d]}return path};sunburst._hasAncestorNode=function(d,node){if(!d||!node||d.depth<node.depth||d===node){return false}var current=d;while(current.parent){if(current.parent===node){return true}current=current.parent}return false};sunburst._getInfoPaneHeight=function(pane){var height=0,node;d3.selectAll(pane.node().childNodes).each(function(n,i){node=d3.select(this);height+=parseInt(node.style("height"),10)+parseInt(node.style("padding-bottom"),10)+parseInt(node.style("padding-top"),10)});return height};sunburst._updateZoomedState=function(d){this._dispatch.zoom.call(this,d,this._dataAdapter.data())};sunburst._updateLockedState=function(d){this._dispatch.select.call(this,d,this._dataAdapter.data())};sunburst._updateHiddenState=function(d){this._dispatch.hidden.call(this,d,this._dataAdapter.data())};sunburst._updateMetricState=function(){var adapter=this._dataAdapter;this._dispatch.metric.call(this,adapter.getSecondaryMetricIndex(),adapter.getSecondaryMetricType(),adapter.data())};sunburst.getNodeValue=function(n,i){if(!n){return 0}if(n.metrics&&n.metrics.length&&n.metrics[i]&&"undefined"!==typeof n.metrics[i].value){return n.metrics[i].value}if(i>0){return null}if("undefined"!==typeof n.size){return n.size}return n.value};sunburst.getMetricCategoryMinMax=function(mIndex,cIndex){var o,self=this,adapter=this._dataAdapter,data=adapter.data(),hidden=this._getHiddenNodes(),zoomed=this._zoomedPath;function getMinMax(d){if(zoomed&&zoomed.depth===d.depth&&zoomed!==d){return}if("undefined"===typeof cIndex||d.depth===cIndex+1){if(adapter.isOther(d)){return}if(hidden.indexOf(d)>=0){return}var val=self.getNodeValue(d,mIndex);if("undefined"===typeof o){o={min:val,max:val}}else{o.min=Math.min(o.min,val);o.max=Math.max(o.max,val)}if(cIndex){return}}if(!d.children||!d.children.length){return}d.children.forEach(function(c){getMinMax(c)})}getMinMax(data);return o||null};sunburst.getNodeColor=function(d,gray){var adapter=this._dataAdapter,scale=this.getColorScale(d),color;if(!d.depth){return adapter.metricColor()}if(adapter.isOther(d)){color=adapter.otherColor()}else if(adapter.getColorMetric()){color=this.isOutsideRange(d)?adapter.outRangeColor():scale(d.metrics[adapter.getColorMetricIndex()].value)}else{color=scale(d.name)}if(gray){color=this._grayColor(color,d)}return color};sunburst._grayColor=function(c,d){var adapter=this._dataAdapter;if(adapter.isOther(d)){return adapter.otherGrayColor()}var rhex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,match=c&&c.match(rhex);if(!match){return c}var rgb=[parseInt(match[1],16),parseInt(match[2],16),parseInt(match[3],16)],avg=Math.round(.21*rgb[0]+.71*rgb[1]+.07*rgb[2]);return"#"+((1<<24)+(avg<<16)+(avg<<8)+avg).toString(16).slice(1)};sunburst.getMetricMaskNum=function(i){return i===0?null:0};sunburst.isOutsideRange=function(d){var adapter=this._dataAdapter,metric=adapter.getColorMetric(),mIndex=adapter.getColorMetricIndex();if(!metric||!d||!d.metrics||"percent"!==metric.format){return false}var val=d.metrics[mIndex].value;return val>this._colorExtentMax||val<this._colorExtentMin};sunburst.getColorScale=function(d){var adapter=this._dataAdapter,metric;if(!(metric=adapter.getColorMetric())){return this._colorScale}if("percent"===metric.format){return this._colorScale}return this._categoryColorScales[d.depth-1]};sunburst._createColorScale=function(extent,max,min,rate){var adapter=this._dataAdapter,colors=adapter.seqColors(),extentMin=(max-min)*extent[0]+min,extentMax=(max-min)*extent[1]+min,dif=extentMax-extentMin,div=colors.length-1;if(rate){this._colorExtent=extent;this._colorExtentMin=extentMin;this._colorExtentMax=extentMax}var colorDomain=[extentMin];for(var i=1;i<div;++i){colorDomain.push(dif/div*i+extentMin)}colorDomain.push(extentMax);return d3.scale.linear().domain(colorDomain).range(colors).clamp(true)};sunburst.setColorScale=function(extent){extent=extent||[0,1];var self=this,adapter=this._dataAdapter,data=adapter.data(),metric;if(!(metric=adapter.getColorMetric())){this._colorScale=d3.scale.ordinal().domain(adapter.uniques()).range(adapter.colors());return}var index=adapter.getColorMetricIndex(),minMax;if("percent"===metric.format){minMax=self.getMetricCategoryMinMax(index);this._colorScale=this._createColorScale(extent,minMax.max,minMax.min,true);return}minMax=data.categories.map(function(c,i){return self.getMetricCategoryMinMax(index,i)});this._categoryColorScales=minMax.map(function(o,i){return self._createColorScale(extent,o.max,o.min,!i)});this._colorExtentMin=null;this._colorExtentMax=null};sunburst.getNodeForKey=function(key){return this._dataAdapter.getDataByPathKey()[key]};sunburst.getKeyForNode=function(data){return this._dataAdapter.getPathKey(data)};sunburst.setSelectActions=function(actions){this._customActions=actions;this._renderDetailsActions()};sunburst.getSelectActions=function(){return this._customActions};sunburst.setSecondaryMetricIndex=function(index){this._dataAdapter.setSecondaryMetricIndex(index);this._secondaryMetricChanged()};sunburst.getSecondaryMetricIndex=function(){return this._dataAdapter.getSecondaryMetricIndex()};sunburst.setSecondaryMetricType=function(index){this._dataAdapter.setSecondaryMetricType(index);this._secondaryMetricChanged()};sunburst.getSecondaryMetricType=function(){return this._dataAdapter.getSecondaryMetricType()};sunburst.setHiddenItems=function(nodes){this._setHiddenNodes(nodes);this._hidePathRender(this._hiddenNodes)};sunburst.getHiddenItems=function(){return this._hiddenNodes};sunburst.getHiddenItemsByKey=function(){var adapter=this._dataAdapter;return this._hiddenNodes.map(function(n){return adapter.getPathKey(n)})};sunburst.setZoomedItem=function(node){this._setZoomPath(node);this._zoomPathRender()};sunburst.getZoomedItem=function(){return this._zoomedPath};sunburst.getZoomedItemByKey=function(){return this._dataAdapter.getPathKey(this._zoomedPath)};sunburst.setSelectedItem=function(node){this._setSelectedNode(node,false)};sunburst.getSelectedItem=function(){return this._lockedNode};sunburst.getSelectedItemByKey=function(){var node=this._lockedNode;if(!node||!node.type||!node.data){return null}if(node.type==="path"){return this._dataAdapter.getPathKey(this._lockedNode.data)}else{return this._dataAdapter.getCategoryName(this._lockedNode.data)}};global.cloudViz.sunburst=cloudViz.util.createConstructor(sunburst)})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},flower=Object.create(core);flower.init=function(options){this._type="flower";this._initDefaultOptions();this.setOptions(options);this.colorScale=dv.scale.color()._d3Scale;this.selectionCache(new dv.util.SelectionCache);this.identifyBehavior=dv.behavior.identified("color-petal-");var self=this;if(options.enableSelection){this._selectionCache.on("selectionChanged",function(source,all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all,function(){return"rotate(0)"});self._onSelectionChanged(source,all,added,removed,0)});this.selectionCache().selectionKeymap(this.determineKeyModifiers)}return this};flower._initDefaultOptions=function(){var defaults={animationDuration:500,labelFormatter:null,clickHandler:null,onlyUseThreePetalLengths:true,isEmotionChart:true,mouseoverCallback:[null,null],horizontalPadding:70,verticalPadding:30,text_offset:5,onMouseOver:null,onMouseOut:null,onContextMenu:null,enableSelection:false};return Object.getPrototypeOf(flower)._initDefaultOptions.call(this,defaults)};flower._onAutoResize=function(){this._render()};flower.resize=function(){this._render()};flower.reset=function(){Object.getPrototypeOf(flower).reset.apply(this,arguments)};flower._preRender=function(){Object.getPrototypeOf(flower)._preRender.apply(this)};flower._setUpLayer=function(svg,key){this["layer"+key]=svg.selectAll(".flower-cv-svg-group-layer"+key).data([0]);this["layer"+key].enter().append("g").classed("flower-cv-svg-group-layer"+key,true)};flower.sprintf=function(s,d){return s.replace(/\{([\w]+)\}/gi,function(a,b){return d[b]})};flower._render=function(){Object.getPrototypeOf(flower)._render.apply(this);var that=this;this._parent=d3.select(this._options.parent);var cv_wrapper=this._parent.selectAll(".cv-wrapper.cv-flower").data([0]);cv_wrapper.enter().append("div").classed("cv-wrapper cv-flower",true);var svg=cv_wrapper.selectAll(".flower-cv-svg").data([0]);svg.enter().append("svg").classed("flower-cv-svg",true);var background=svg.selectAll(".flower-cv-background").data([0]).enter().append("rect").classed("flower-cv-background",true);this.selectionCache().setDeselector(background);this._svg_group=svg.selectAll(".flower-cv-svg-group").data([0]);this._svg_group.enter().append("g").classed("flower-cv-svg-group",true);this._setUpLayer(this._svg_group,1);this._setUpLayer(this._svg_group,2);this._setUpLayer(this._svg_group,3);this._setUpLayer(this._svg_group,4);this._setUpLayer(this._svg_group,5);this._setUpLayer(this._svg_group,6);var width=this._options.width||parseInt(this._parent.style("width"),10);var height=this._options.height||parseInt(this._parent.style("height"),10);cv_wrapper.style("width",width+"px").style("height",height+"px");var half_width=width/2;var half_height=height/2;this._svg_group.attr("transform",this.sprintf("translate({width},{height})",{width:half_width,height:half_height}));var data=that._dataAdapter.data();var possible_width=half_width-this._options.horizontalPadding;var possible_height=half_height-this._options.verticalPadding;var labelFormatter=this._options.labelFormatter||function(labels){labels.append("tspan").attr("class","flower-cv-petal-label").text(function(d){return d.label+" "});labels.append("tspan").attr("class","flower-cv-petal-label-value").text(function(d){return that._formatNumber("percent",d.value/that._total,0,{dataItem:d})})};var mouseoverCallback=this._options.mouseoverCallback[0]||function(){d3.select(this).attr("opacity",1)};var mouseoutCallback=this._options.mouseoverCallback[1]||function(d){d3.select(this).attr("opacity",d.petal_opacity).attr("fill",d.petal_color)};this._is_single_mode=this._options.onlyUseThreePetalLengths;this._petal_size=Math.min(possible_width,possible_height);this._circle_size=this._petal_size*.676/2;this._arc_thickness=this._petal_size*.027;this._arc_half_angle=360/data.length/2+.5;this._petal_count=data.length;var getTextSizeScale=d3.scale.linear().domain([55,185]).range([9,12]).clamp(true);this._font_size=getTextSizeScale(this._petal_size);var text_offsets=[{offset_y:1,fixed_offset_y:0,offset_x:0,location:"middle"},{offset_y:1,fixed_offset_y:0,offset_x:-1.5,location:"middle"},{offset_y:0,fixed_offset_y:-2.5,offset_x:-.8,location:"start"},{offset_y:-1,fixed_offset_y:-9,offset_x:-1.5,location:"middle"},{offset_y:-1,fixed_offset_y:-9,offset_x:0,location:"middle"},{offset_y:-1,fixed_offset_y:-9,offset_x:1.5,location:"middle"},{offset_y:0,fixed_offset_y:-2.5,offset_x:.8,location:"end"},{offset_y:1,fixed_offset_y:0,offset_x:1.5,location:"middle"}];this._total=d3.sum(data,function(d){return d.value});var getAngleScale=d3.scale.linear().domain([0,data.length]).range([0,360]);this._getTextOffsetIndex=d3.scale.linear().domain([0,360]).rangeRound([0,8]).clamp(true);this._getSizeZeroToThree=d3.scale.linear().domain([0,d3.max(data,function(d){return d.value})]).rangeRound([0,3]);this._getPetalSize=d3.scale.linear().domain([d3.min(data,function(d){return d.value}),d3.max(data,function(d){return d.value})]).rangeRound([this._circle_size+this._arc_thickness+10,this._petal_size]);dv.util.each(data,function(o,k){o.angle=getAngleScale(k);that._addPetalSizes(o)});this._getTextOffsetScale=function(angle){var index=this._getTextOffsetIndex(angle);if(index==8){index=0}return text_offsets[index]};var gray_bg_petals=this.layer1.selectAll(".flower-cv-gray-petals").data(data);gray_bg_petals.enter().append("path").attr("class","flower-cv-gray-petals").attr("transform",function(d){return"rotate("+d.angle+")"}).attr("d",that._makePetal(0,0,0,0)).attr("opacity",0);gray_bg_petals.transition().duration(that._options.animationDuration).attr("transform",function(d){return"rotate("+d.angle+")"}).attr("d",function(d){return that._makePetal(0,0,0,d.full_petal)}).attr("opacity",function(d){return d.petal_size_number==3?0:1});gray_bg_petals.exit().transition().duration(that._options.animationDuration).attr("d",that._makePetal(0,0,0,0)).attr("opacity",0).remove();var color_petals=this.layer2.selectAll(".flower-cv-color-petals").data(data);color_petals.enter().append("path").attr("id",function(d,i,j){return that.identifyBehavior.identify(d,i,j)}).attr("class","flower-cv-color-petals").attr("transform",function(d){return"rotate("+d.angle+")"}).attr("opacity",function(d){return d.petal_opacity}).attr("d",that._makePetal(0,0,0,0)).attr("fill",function(d){return d.petal_color}).on("mouseover",mouseoverCallback).on("mouseout",mouseoutCallback).on("click",function(d,i,j){if(that._options.clickHandler){that._options.clickHandler(d)}that._dispatch.click.call(this,d,i,j,d3.event)}).on("contextmenu",core.makeContextMenuHandler(that)).on("mousedown",that.makeSelectHandler());color_petals.transition().duration(that._options.animationDuration).attr("d",function(d){return that._makePetal(0,0,0,d.petal_size)}).attr("transform",function(d){return"rotate("+d.angle+")"}).attr("fill",function(d){return d.petal_color}).attr("opacity",function(d){return d.petal_opacity});color_petals.exit().transition().duration(that._options.animationDuration).attr("d",that._makePetal(0,0,0,0)).attr("opacity",0).remove();var white_arcs=this.layer3.selectAll(".flower-cv-white-arcs").data(data);var arc=d3.svg.arc().innerRadius(0).outerRadius(this._circle_size+this._arc_thickness+1).startAngle(-that._arc_half_angle*(Math.PI/180)).endAngle(that._arc_half_angle*(Math.PI/180));white_arcs.enter().append("path").attr("class","flower-cv-white-arcs").attr("transform",function(d){return"rotate("+d.angle+")"}).attr("fill","white");white_arcs.transition().duration(that._options.animationDuration).attr("d",arc).attr("transform",function(d){return"rotate("+d.angle+")"});white_arcs.exit().remove();arc=d3.svg.arc().innerRadius(0).outerRadius(this._circle_size+this._arc_thickness).startAngle(-(that._arc_half_angle-1)*(Math.PI/180)).endAngle((that._arc_half_angle-1)*(Math.PI/180));var color_arcs=this.layer4.selectAll(".flower-cv-color-arcs").data(data);color_arcs.enter().append("path").attr("class","flower-cv-color-arcs").attr("d",arc).attr("transform",function(d){return"rotate("+d.angle+")"}).attr("fill",function(d){return d.arc_color});color_arcs.transition().duration(that._options.animationDuration).attr("d",arc).attr("fill",function(d){return d.arc_color}).attr("transform",function(d){return"rotate("+d.angle+")"});color_arcs.exit().remove();var petal_labels=this.layer5.selectAll(".flower-cv-petal-labels").data(data);petal_labels.enter().append("text").attr("class","flower-cv-petal-labels").attr("x",0).attr("y",0).attr("text-anchor",function(d){return that._getTextOffsetScale(d.angle).location}).attr("dx",function(d){return that._getTextOffsetScale(d.angle).offset_x*-that._options.text_offset}).attr("dy",function(d){return that._getTextOffsetScale(d.angle).offset_y*-that._options.text_offset-that._getTextOffsetScale(d.angle).fixed_offset_y}).style("font-size",that._font_size).attr("transform",function(d){return"rotate("+d.angle+") rotate("+-d.angle+", 0, "+0+")"}).attr("opacity",0);petal_labels.style("font-size",that._font_size+"px").attr("text-anchor",function(d){return that._getTextOffsetScale(d.angle).location}).attr("dx",function(d){return that._getTextOffsetScale(d.angle).offset_x*-that._options.text_offset}).attr("dy",function(d){return that._getTextOffsetScale(d.angle).offset_y*-that._options.text_offset-that._getTextOffsetScale(d.angle).fixed_offset_y}).selectAll("*").remove();labelFormatter(petal_labels);petal_labels.transition().duration(that._options.animationDuration).attr("y",function(d){return d.petal_size}).attr("transform",function(d){return"rotate("+d.angle+") rotate("+-d.angle+", 0, "+d.petal_size+")"}).attr("opacity",function(d){return d.petal_number_size===0?0:1});petal_labels.exit().remove();var main_circle=this.layer6.selectAll(".flower-cv-main-circle").data([1]);main_circle.enter().append("circle").attr("class","flower-cv-main-circle").attr("cx",0).attr("cy",0);main_circle.transition().duration(that._options.animationDuration).attr("r",that._circle_size)};flower._postRender=function(){this._highlightedOverlay.setUpSelectedOverlay(this._svg_group)};flower._makePetal=function(x,y,x2,y2){var radius=this._circle_size+this._arc_thickness+1,half_width=radius*2*Math.PI/this._petal_count/2,degrees=half_width/(radius*2*Math.PI)*360,y3=Math.cos(degrees*Math.PI/180)*radius,x3=Math.sin(degrees*Math.PI/180)*radius;y=-y3;var start_x=x-x3,end_x=x+x3,bulge_vertical_location=(y2-y)*-1*.6,height=(y2-y)*-1,bulge_width=height*.2,result=["M",start_x,y,"C",start_x-bulge_width,y-bulge_vertical_location,x,y2,x2,y2,"C",x2,y2,end_x+bulge_width,y-bulge_vertical_location,end_x,y];return result.join(" ")};flower._addPetalSizes=function(o){if(!o.color){o.color=this.colorScale(o.label)}var size=this._getSizeZeroToThree(o.value);if(!this._is_single_mode){if(size===0){size=1}}if(o.value===0){size=0}var opacity=.9;var color=o.color;var arc_color=color;var petal_size=this._petal_size;var full_petal=petal_size*-1;switch(size){case 0:opacity=0;arc_color="#e6e6e6";petal_size=0;color=color;break;case 3:opacity=.9;break;case 2:opacity=.75;petal_size=petal_size*.795;break;case 1:opacity=.5;petal_size=petal_size*.6;break}if(!this._is_single_mode){petal_size=this._getPetalSize(o.value)}if(o.value===0){petal_size=0}petal_size*=-1;o.petal_opacity=opacity;o.petal_size=petal_size;o.petal_color=color;o.full_petal=full_petal;o.petal_number_size=size;o.arc_color=arc_color};global.cloudViz.flower=cloudViz.util.createConstructor(flower)})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},dvcore=cloudViz.dvcore||{},dv=global.dv||{},d3=global.d3||{},funnel=Object.create(dvcore);funnel.init=function(options){Object.getPrototypeOf(funnel).init.apply(this,arguments);this._type="funnel";this._chart=dv.chart();this._avgColor="#b1b1b1";return this};funnel._initDefaultOptions=function(){var defaults={averageSeries:null,averageSeriesLabel:null,disableAverage:false,normalized:true,formats:{x:"decimal",y:"decimal"},tooltipContent:null,enableSelection:false};return Object.getPrototypeOf(funnel)._initDefaultOptions.call(this,defaults)};funnel.reset=function(){Object.getPrototypeOf(funnel).reset.apply(this,arguments)};funnel._setChartTypeOptions=function(){var chart=this._chart,options=this._options,self=this,adapter=this._dataAdapter,seriesMap=this._getPropMapping("series"),minBarWidth=0,maxBarWidth=100,yAxisTitleWidth=28,padding=this._isNormalized()&&!adapter.isSingleSeries()?yAxisTitleWidth:30,chartWidth=this._getChartWidth()-padding*2,dodgeSpacing=.05,numInStep=adapter.getNumBarsPerStep(),numOfStep=adapter.getNumSteps(),numBars=numOfStep*(numInStep+1)-1,barWidth=Math.min(Math.max(minBarWidth,chartWidth/numBars),maxBarWidth),stepPadding=adapter.isSingleSeries()?barWidth/3:barWidth,barTextSize=barWidth>=36?12:barWidth>=28?10:0,stepWidth=numInStep*barWidth+stepPadding,stepSpacing=stepPadding/stepWidth,centerPadding=barWidth===maxBarWidth?(chartWidth-(stepWidth*numOfStep-stepPadding))/2/stepWidth:0;this._stepWidth=numInStep*barWidth;this._stepPadding=stepPadding;var layers=[dv.geom.bar().data(adapter.currentStepData()).dodgePadding(dodgeSpacing).each("start",function(d,i){d3.select(this).attr("legend-group",d["fill"])}),dv.geom.bar().data(adapter.previousStepData()).dodgePadding(dodgeSpacing).set("alpha",.15).each("start",function(d,i){d3.select(this).attr("legend-group",d["fill"])}),dv.geom.text().data(adapter.textStepData()).each("start",function(d,i){d3.select(this).attr("legend-group",d["group"]).classed("cv-funnel-text")}).map("label","cv_label").map("group",seriesMap).set("fill","#666").textAnchor("middle").dy(-5).textFormat(function(d){return self._formatNumber("percent",d,null,{dataItem:d})}).set("size",barTextSize)];if(adapter.isSingleSeries()){layers.splice(1,1)}if(!options.interactive&&adapter.averageStepData()&&(!adapter.isAvgCalculated()||!adapter.isSingleSeries())){var fakedata={x:[0],y:[0],cvfake:["cvfakeline"]};layers.push(dv.geom.line().data(fakedata).map("stroke","cvfake",dv.scale.color().values([this._avgColor])));var l=this._legend;chart.guide("stroke",this._buildStandardLegend([adapter.averageDataLabel()]));this._legend=l}chart.layers(layers).data({}).map("fill",seriesMap,dv.scale.color().values(options.colors)).map("x",this._getPropMapping("x"),dv.scale.ordinal().padding(stepSpacing).outerPadding(centerPadding).reverse(options.flip)).guide("fill",this._legend).position("dodge").padding(this._isNormalized()&&!adapter.isSingleSeries()?{left:padding-yAxisTitleWidth,right:padding}:{left:padding,right:padding});chart._layers[0].on("click",dvcore.makeClickHandler(this));chart._layers[0].on("contextmenu",dvcore.makeContextMenuHandler(this));this._addBehaviors(chart.layers()[adapter.isSingleSeries()?0:1],options);this._mapPositionScales(chart,options)};funnel._mapPositionScales=function(chart,options){var self=this,rangePadding=[0,25],scale=this._applyForceZero(this._constructScale("y")).rangePadding(rangePadding),fillMapping=this._getPropMapping("series"),yMapping=this._getPropMapping("y"),adapter=self._dataAdapter;if(adapter.useAvgMaxValue()){var avg=adapter.averageStepData(),amax=d3.extent(avg[self._getPropMapping("y")])[1];scale.upperLimit(function(min,max){var m=max>0?max:0;return amax>m?amax:m})}if(options.normalized){var uniqueGroups=self._dataAdapter.uniqueFillValues();uniqueGroups.forEach(function(g,index){var fillScale=0===index?scale:scale.copy();fillScale.includeInDomain(function(d,i){return d.data[fillMapping]===self._dataAdapter.uniqueFillValues()[index]});if(index>0){chart.map("y",yMapping,fillScale,index)}})}chart.map("y",yMapping,scale,0)};funnel._addBehaviors=function(geom,options){var d3Parent=d3.select(options.parent),timer,adapter=this._dataAdapter,self=this,l10n=adapter.l10n.labels.funnel;if(!this._isSmallChart()&&options.interactive){var selectionBehavior=dv.behavior.selection().on("selectionChanged",function(all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all);self._onSelectionChanged(this,all,added,removed,adapter.isSingleSeries()?0:1)});self.selectionCache(selectionBehavior._selectionCache);var behaviors=[dv.behavior.identified(),dv.behavior.rollover().orientation(options.flip?"top":"right").content(function(d,i,j){if(options.tooltipContent){return options.tooltipContent.call(this,d,i,j)}var seriesGroup=this.__geom.getExplicitScale("group"),y=d.panel.yScale(d),valueFormat=self._yLabelFormat(j),value=d.data["cv_tt_val"],pValue=d.data["cv_tt_pval"],xLabel=adapter.getStepName(d.x),avg=adapter.isSingleSeries()&&adapter.isAvgCalculated()?null:adapter.averageStepData(),stepDataIndex,stepValue,stepPrevValue,stepAvgTitle;if(avg){stepAvgTitle=adapter.averageDataLabel();stepDataIndex=avg[self._getPropMapping("x")].indexOf(d.x);stepValue=avg[self._getPropMapping("y")][stepDataIndex];stepPrevValue=avg[self._getPropMapping("y")][stepDataIndex>0?stepDataIndex-1:0]}var content='<span class="cv-tooltip-content">'+'<span class="cv-funnel-title">'+funnel.escapeHtml(l10n.step)+'</span><span class="cv-funnel-series-name">'+funnel.escapeHtml(xLabel)+'</span><span class="cv-funnel-title">'+funnel.escapeHtml(l10n.segment)+'</span><span class="cv-funnel-metric-name">'+funnel.escapeHtml(d.data[self._getPropMapping("seriesLabel")])+'</span><span class="cv-funnel-title">'+funnel.escapeHtml(l10n.conversion)+'</span><span class="cv-funnel-percent-value">'+funnel.escapeHtml(self._formatYValue(pValue?value/pValue:0,"percent"))+'</span><span class="cv-funnel-metric-value">'+funnel.escapeHtml(valueFormat(value))+"</span>";if(avg){content+='<span class="cv-funnel-sub-title">'+funnel.escapeHtml(stepAvgTitle)+'</span><span class="cv-funnel-percent-value">'+funnel.escapeHtml(self._formatYValue(stepPrevValue?stepValue/stepPrevValue:0,"percent"))+'</span><span class="cv-funnel-metric-value">'+funnel.escapeHtml(valueFormat(stepValue))+"</span>"}content+='<span class="cv-funnel-title">'+funnel.escapeHtml(l10n.fallout)+'</span><span class="cv-funnel-percent-value">'+funnel.escapeHtml(self._formatYValue(pValue?1-value/pValue:0,"percent"))+'</span><span class="cv-funnel-metric-value">'+funnel.escapeHtml(valueFormat(pValue-value))+"</span>";if(avg){content+='<span class="cv-funnel-sub-title">'+funnel.escapeHtml()+'</span><span class="cv-funnel-percent-value">'+funnel.escapeHtml(self._formatYValue(stepPrevValue?1-stepValue/stepPrevValue:0,"percent"))+'</span><span class="cv-funnel-metric-value">'+funnel.escapeHtml(valueFormat(stepPrevValue-stepValue))+"</span>"}return content+"</span>"}).showTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._showTip.call(this,d,i,j,behavior);clearTimeout(timer);d3Parent.selectAll(".bar-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(pointD){return d.x!==pointD.x||d.fill!==pointD.fill});d3Parent.selectAll(".text-geom").classed("cv-medium-duration",false).classed("cv-unselected",function(pointD){return d.x!==pointD.x||d.fill!==pointD.group});d3Parent.selectAll(".cv-legend-marker").classed("cv-unselected",function(legendD){return legendD.id!==d.fill}).classed("cv-medium-duration",false);d3Parent.selectAll(".avg-geom").classed("cv-unselected",true).classed("cv-medium-duration",false);self._dispatch.mouseover.call(this,d,i,j,ev)}}).hideTooltip(function(d,i,j,ev,behavior){var el=d3.select(this);if(!el.classed("path-inactive")){behavior._removeTip.call(this,d,i,j,behavior);timer=setTimeout(function(){d3Parent.selectAll(".bar-geom, .text-geom, .cv-legend-marker, .avg-geom").classed("cv-unselected",false).classed("cv-medium-duration",true);self._dispatch.mouseout.call(this,d,i,j,ev)},400)}})];if(this._options.enableSelection){behaviors.push(selectionBehavior)}geom.behaviors(behaviors)}};funnel._getStepLabel=function(d,i){var adapter=this._dataAdapter,value=adapter.getSingleSeriesStepValue(d,i),text=adapter.getStepName(d),html='<div class="cv-funnel-step-label" style="width: '+Math.floor(this._stepWidth)+'px">';if(typeof value!=="undefined"){html+='<span class="cv-funnel-step-label-value">'+funnel.escapeHtml(this._yLabelFormat(0)(value))+"</span>"}html+='<span class="cv-funnel-step-label-name">'+funnel.escapeHtml(text)+"</span>";return html+"</div>"};funnel._drawSmall=function(){this._drawLarge()};funnel._drawLarge=function(){var chart=this._chart,options=this._options,self=this,adapter=this._dataAdapter,xAxis=dv.guide.axis();xAxis.htmlLabels(true).tickSize(0).tickAnchor("middle").tickFormat(function(d,i){return self._getStepLabel(d,i)}).title(this._dataAdapter.xAxisTitle());chart.guide("x",xAxis).guide("y","none");if(!adapter.isSingleSeries()){var p=chart.padding();this._checkNormalized();chart.padding(p)}};funnel._renderChart=function(){Object.getPrototypeOf(funnel)._renderChart.call(this);this._drawAllLine()};funnel._drawAllLine=function(){var chart=this._chart,self=this,options=this._options,adapter=this._dataAdapter,normalized=this._isNormalized(),xscale=chart.getTrainedScale("x"),yscale=chart.getTrainedScale("y"),avgData=adapter.averageStepData(),mappings=adapter.mappings(),series=this._getPropMapping("series"),seriesLabel=this._getPropMapping("seriesLabel"),x=this._getPropMapping("x"),value=this._getPropMapping("y"),xAdjust=Math.min(this._stepPadding/2,5),data=[];if(avgData){var maxDataValue=adapter.getUniqueFillExtent(0)[1],maxAvgValue=d3.extent(avgData[value])[1],topRange=normalized?maxDataValue||maxAvgValue:Math.max(maxDataValue,maxAvgValue),convert=d3.scale.linear().domain([0,maxAvgValue]).range([0,topRange]);avgData[x].forEach(function(cat,i){var v=avgData[value][i],y=yscale.mapValue(normalized?convert(v):v);data.push({x:xscale.mapValue(cat)-xAdjust,y:y});data.push({x:xscale.mapValue(cat)+xscale.rangeBand()+xAdjust,y:y})})}var group=d3.select(chart.parent()).selectAll("svg").selectAll(".cv-funnel-avg-group").data([0]);group.enter().insert("g",".group").classed("cv-funnel-avg-group",true);var lineGroup=group.selectAll(".avg-group-line").data([0]);lineGroup.enter().append("g").classed("avg-group-line series",true);var pointGroup=group.selectAll(".avg-group-point").data([0]);pointGroup.enter().append("g").classed("avg-group-point series",true);var line=d3.svg.line().x(function(d){return d.x}).y(function(d){return d.y}),duration=chart.duration(),ease=chart.ease();var lineGeom=lineGroup.selectAll(".avg-line").data([data]);lineGeom.enter().append("path").classed("avg-line avg-geom",true);lineGeom.attr("legend-group",adapter.averageSeries()).transition().duration(duration).ease(ease).attr("d",line).style("stroke",this._avgColor);lineGeom.exit().remove();var pointGeoms=pointGroup.selectAll(".avg-dot").data(data);pointGeoms.enter().append("circle").classed("avg-dot avg-geom",true);pointGeoms.attr("legend-group",adapter.averageSeries()).style("stroke",this._avgColor).transition().duration(duration).ease(ease).attr("cx",line.x()).attr("cy",line.y()).attr("r",3);pointGeoms.exit().remove()};funnel._createSeriesStates=function(){Object.getPrototypeOf(funnel)._createSeriesStates.call(this);if("data"in this._changedOptions&&this._changedOptions.data){var adapter=this._dataAdapter;this._seriesState.removeStatesByType("funnel-average");if(adapter.averageStepData()){this._seriesState.insertState(adapter.averageDataLabel(),adapter.averageSeries(),"funnel-average")}}};funnel._updatePathStates=function(){Object.getPrototypeOf(funnel)._updatePathStates.call(this);var self=this,options=this._options,adapter=this._dataAdapter,avgSeries=adapter.averageSeries();d3.select(options.parent).selectAll(".cv-funnel-avg-group .series [legend-group]").classed("path-inactive",function(){if(!options.interactive){return false}var el=d3.select(this),seriesId=el.attr("legend-group");if(seriesId===avgSeries&&self._seriesState.doesSeriesStateExist(seriesId,"funnel-average")){return!self._seriesState.isSeriesEnabled(seriesId,"funnel-average")}return el.classed("path-inactive")})};funnel._isNormalized=function(){return this._options.normalized};global.cloudViz.funnel=cloudViz.util.createConstructor(funnel)})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},gauge=Object.create(core);var outerPadding=.05,needleThickness=.09,needleLengthRatio=1+outerPadding,tickThickness=.05,minorTickThickness=.025,tickPadding=2,tickLabelGap=14,minPercentOpen=.1,maxPercentOpen=.75,cvWrapper=null,d3Container=null;gauge.init=function(options){this._type="gauge";options=options||{};this._initDefaultOptions();this.setOptions(options);this.selectionCache(new dv.util.SelectionCache);this._idBehavior=dv.behavior.identified();var self=this;if(options.enableSelection){this._selectionCache.on("selectionChanged",function(source,all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all);self._onSelectionChanged(source,all,added,removed,0)});this._selectionCache.selectionKeymap(this.determineKeyModifiers)}return this};gauge._initDefaultOptions=function(options){var defaults={duration:750,percentOpen:minPercentOpen,showNeedle:true,showAxis:true,ticks:5,tickSubdivisions:0,ringThickness:.15,format:"decimal",fillColor:"#3284d4",minValue:0,maxValue:10,colors:[{color:"#ff3400",alpha:1,from:"0%",to:"33%"},{color:"#faca00",alpha:1,from:"33%",to:"66%"},{color:"#68b672",alpha:1,from:"66%",to:"100%"}],metric:"",value:0,enableSelection:false};this._margins={top:0,left:0,right:0,bottom:0};return Object.getPrototypeOf(gauge)._initDefaultOptions.call(this,defaults)};gauge.createDeselector=function(parent){var self=this;var background=parent.selectAll("g.interaction-group").data([0]).enter().append("g").classed("interaction-group",true);var r=background.selectAll("rect.interaction-canvas").data([0]).enter().append("rect").attr("width",this._size[0]+"px").attr("height",this._size[1]+"px").style("visibility","hidden").classed("interaction-canvas background",true);this.selectionCache().setDeselector(r)};gauge.render=function(){Object.getPrototypeOf(gauge).render.call(this,arguments);this._determineSize();this._initScales();this._draw();return this};gauge._onAutoResize=function(){this.render()};gauge._determineSize=function(options){var opts=this._options,parent=opts.parent,width=opts.width?opts.width:parent.offsetWidth,height=opts.height?opts.height:parent.offsetHeight,percentOpen=Math.max(minPercentOpen,Math.min(maxPercentOpen,opts.percentOpen));if(opts.showNeedle){this._margins.bottom=height*.05}this._maxAngle=(1-percentOpen)*180;this._minAngle=(1-percentOpen)*-180;width-=this._margins.left+this._margins.right;this._size=[width,height];this._radius=Math.min(width-this._margins.left-this._margins.right,height-this._margins.top-this._margins.bottom)/2};gauge._initScales=function(){var opts=this._options;if(opts.minValue>opts.maxValue){throw new Error("The minimum value is greater than the maximum value.")}this._scale=d3.scale.linear().domain([opts.minValue,opts.maxValue]).range([0,1])};gauge._draw=function(){this._initSVG();this._drawTrack();this._drawAxis();this._drawSelectedIndicator();this._drawLabels()};gauge._initSVG=function(){var opts=this._options,d3Parent=d3.select(opts.parent);cvWrapper=d3Parent.selectAll(".cv-wrapper.cv-gauge").data([0]);cvWrapper.enter().append("div").classed("cv-wrapper cv-gauge",true);cvWrapper.style("width",this._size[0]+"px").style("height",this._size[1]+"px");var chartContainer=cvWrapper.selectAll(".chart-wrapper").data([0]);chartContainer.enter().append("div").classed("chart-wrapper",true);var svg=chartContainer.selectAll("svg").data([0]);svg.enter().append("svg");this.createDeselector(svg);d3Container=svg.selectAll("g.plot").data([0]);d3Container.enter().append("g").classed("plot",true);d3Container.attr("transform","translate("+(this._size[0]-this._margins.left-this._margins.right)/2+","+(this._size[1]-this._margins.top-this._margins.bottom)/2+")")};gauge._drawTrack=function(){var self=this,opts=this._options;var arc=d3.svg.arc().innerRadius(this._radius*(1-outerPadding-opts.ringThickness)).outerRadius(this._radius*(1-outerPadding)).startAngle(function(d,i){var percentVal=dv.util.isPercentString(d.from)?parseInt(d.from,10)/100:self._scale(d.from),angle=(self._maxAngle-self._minAngle)*percentVal+self._minAngle;return deg2rad(angle)}).endAngle(function(d,i){var percentVal=dv.util.isPercentString(d.to)?parseInt(d.to,10)/100:self._scale(d.to),angle=(self._maxAngle-self._minAngle)*percentVal+self._minAngle;return deg2rad(angle)});var arcContainer=d3Container.selectAll(".arc").data([0]);arcContainer.enter().append("g").classed("arc",true);var arcs=arcContainer.selectAll("path").data(opts.colors);arcs.enter().append("path").attr("class",function(d,i,j){return"datum-"+i+" series-"+j}).on("contextmenu",self.makeContextMenuHandler(self)).on("click",self.makeClickHandler(self)).on("mouseover",self.makeMouseOverHandler(self)).on("mouseout",self.makeMouseOutHandler(self)).on("mousedown",self.makeSelectHandler()).attr("id",function(d,i,j){return self._idBehavior.identify(d,i,j)});arcs.exit().remove();arcs.attr("fill",function(d,i){return d.color}).attr("opacity",function(d,i){return d.hasOwnProperty("alpha")?d.alpha:1}).attr("d",arc);self._highlightedOverlay.setUpSelectedOverlay(arcContainer)};gauge._drawAxis=function(){var self=this,opts=this._options,tickData=this._scale.ticks(opts.ticks),tickDraw=function(scale,minAngle,maxAngle,thickness){return function(selection){selection.attr("x1",0).attr("y1",tickPadding).attr("x2",0).attr("y2",self._radius*thickness+tickPadding).attr("transform",function(d){var angle=val2deg(scale,d,minAngle,maxAngle);return"rotate("+val2deg(scale,d,minAngle,maxAngle)+") translate(0,"+(self._radius*(opts.ringThickness+outerPadding)-self._radius)+")"})}};var axisContainer=d3Container.selectAll(".axis").data(opts.showAxis?[0]:[]);axisContainer.enter().append("g").classed("axis",true);axisContainer.exit().remove();var ticks=axisContainer.selectAll(".tick").data(tickData);ticks.enter().append("line").classed("tick",true);ticks.exit().remove();ticks.call(tickDraw(this._scale,this._minAngle,this._maxAngle,tickThickness));var tickSubdivisionData=axisSubdivide(this._scale,tickData,opts.tickSubdivisions);var tickSubdivisions=axisContainer.selectAll(".minor-tick").data(tickSubdivisionData);tickSubdivisions.enter().append("line").classed("minor-tick",true);tickSubdivisions.exit().remove();tickSubdivisions.call(tickDraw(this._scale,self._minAngle,self._maxAngle,minorTickThickness));var labels=axisContainer.selectAll(".tick-label").data(tickData);labels.enter().append("text").classed("tick-label",true);labels.exit().remove();labels.attr("transform",function(d){var angle=val2deg(self._scale,d,self._minAngle,self._maxAngle),rads=val2rad(self._scale,d,self._minAngle,self._maxAngle),r=(self._radius-tickLabelGap)*(1-opts.ringThickness-outerPadding-tickThickness),x=Math.cos(rads)*r,y=Math.sin(rads)*r;if(angle<-10&&angle>-170){x-=3}if(angle>10&&angle<170){x+=3}return"translate("+x+","+y+")"}).attr("text-anchor",function(d){var angle=val2deg(self._scale,d,self._minAngle,self._maxAngle);if(angle>-10&&angle<10){return"middle"}if(angle<0){return null}return"end"}).attr("dy",".35em").style("font-size",clamp(self._radius*.05,8,14)+"px").text(function(d){return self._formatNumber(opts.format,d,null,{dataItem:d})})};gauge._drawSelectedIndicator=function(){var opts=this._options;this._drawNeedle(opts.showNeedle?[opts.value]:[]);this._drawProgressFill(opts.showNeedle?[]:[opts.value])};gauge._drawNeedle=function(values){var self=this,opts=this._options,cr=this._radius*needleThickness/2,needleLength=this._radius*needleLengthRatio;var needle=d3Container.selectAll(".needle").data(values);needle.enter().append("path").classed("needle",true).attr("transform","rotate("+self._minAngle+")");needle.exit().remove();needle.attr("d","M"+cr/2+"-"+cr+"L0-"+needleLength+"L-"+cr/2+"-"+cr+"C-"+cr*.8257+"-"+cr*.8212+"-"+cr*1.035+"-"+cr/2*.9448+"-"+cr*1.035+"-1"+"C-"+cr*1.035+","+cr/2*.9078+"-"+cr*.5796+","+cr*.9314+",0,"+cr*.9314+"S"+cr*1.035+","+cr/2*.9078+","+cr*1.035+"-1"+"C"+cr*1.035+"-"+cr/2*.9448+","+cr*.8257+"-"+cr*.8212+","+cr/2+"-"+cr+"z").transition().duration(opts.duration).ease("cubic-in-out").attrTween("transform",function(d){var el=this,val=Math.min(opts.maxValue,Math.max(opts.minValue,d)),angle=val2deg(self._scale,val,self._minAngle,self._maxAngle),previousAngle=this.__previousD__===undefined?self._minAngle:this.__previousD__,interpolate=d3.interpolate(previousAngle,angle);return function(t){el.__previousD__=interpolate(t);return"rotate("+el.__previousD__+")"}})};gauge._drawProgressFill=function(values){var self=this,opts=this._options,arc=d3.svg.arc().innerRadius(this._radius*(1-outerPadding-opts.ringThickness)).outerRadius(this._radius*(1-outerPadding)).startAngle(deg2rad(self._minAngle)).endAngle(function(d){return deg2rad(val2deg(self._scale,d,self._minAngle,self._maxAngle))});var progress=d3Container.selectAll(".progress").data(values);progress.enter().append("path").on("contextmenu",self.makeContextMenuHandler(self)).on("click",self.makeClickHandler(self)).on("mouseover",self.makeMouseOverHandler(self)).on("mouseout",self.makeMouseOutHandler(self)).on("mousedown",self.makeSelectHandler()).classed("progress",true);progress.exit().remove();progress.attr("fill",opts.fillColor).transition().duration(opts.duration).attrTween("d",function(d){var el=this,val=Math.min(opts.maxValue,Math.max(opts.minValue,d)),previousVal=this.__previousD__===undefined?opts.minValue:this.__previousD__,interpolate=d3.interpolate(previousVal,val);return function(t){el.__previousD__=interpolate(t);return arc(el.__previousD__)}})};gauge._drawLabels=function(){var self=this,opts=this._options,valueData=opts.value===undefined?[]:[opts.value],metricData=opts.metric===undefined?[]:[opts.metric],minRads=val2rad(this._scale,opts.minValue,this._minAngle,this._maxAngle),maxRads=val2rad(this._scale,opts.maxValue,this._minAngle,this._maxAngle),radiusToInnerArc=this._radius*(1-opts.ringThickness-outerPadding),radiusToInsideArc=(this._radius-tickLabelGap)*(1-opts.ringThickness-outerPadding-tickThickness),xLeftOpening=Math.cos(minRads)*radiusToInsideArc+this._radius,xRightOpening=Math.cos(maxRads)*radiusToInsideArc+this._radius,yInnerOpening=Math.sin(minRads)*radiusToInnerArc+this._radius;var labelContainer=cvWrapper.selectAll(".label-container").data([0]);labelContainer.enter().append("div").classed("label-container",true);labelContainer.style("left",this._size[0]/2-this._radius+"px");var metricLabel=labelContainer.selectAll(".label-title").data(metricData);metricLabel.enter().append("span").classed("label-title",true);metricLabel.exit().remove();metricLabel.style("font-size",clamp(this._radius*.1,11,18)+"px").classed("multiline-ellipsis",!opts.showNeedle).text(String);var valueLabel=labelContainer.selectAll(".label-number").data(valueData),valueLabelYPos=Math.max(yInnerOpening,this._radius*1.1);valueLabel.enter().append("span").classed("label-number",true).style("line-height",this._radius*opts.ringThickness+"px");valueLabel.exit().remove();valueLabel.style("left",xLeftOpening+"px").style("width",xRightOpening-xLeftOpening+"px").style("font-size",this._radius*opts.ringThickness+"px").text(function(d){return self._formatNumber(opts.format,d,{dataItem:d})});if(opts.showNeedle){metricLabel.style("top",valueLabelYPos+this._radius*.2+"px").style("left",0).style("width",this._radius*2+"px");valueLabel.style("top",valueLabelYPos+"px")}else{var metricLblHeight=clamp(this._radius*.1,11,20)*2.3,metricLblYPos=this._radius*(1-outerPadding);metricLabel.style("top",metricLblYPos+"px").style("left",this._radius*(opts.ringThickness+outerPadding+tickThickness+.3)+"px").style("width",this._radius*(1-opts.ringThickness-outerPadding-tickThickness-.3)*2+"px").style("height",metricLblHeight+"px");valueLabel.style("top",Math.max(metricLblYPos+metricLblHeight,valueLabelYPos)+"px")}};function val2rad(scale,val,minAngle,maxAngle){return deg2rad(val2deg(scale,val,minAngle,maxAngle))-deg2rad(minAngle)-deg2rad(maxAngle)-Math.PI/2}function val2deg(scale,val,minAngle,maxAngle){return minAngle+scale(val)*(maxAngle-minAngle)}function deg2rad(deg){return deg*Math.PI/180}function clamp(val,min,max){return Math.max(min,Math.min(max,val))}function axisSubdivide(scale,ticks,m){var subticks=[];if(m&&ticks.length>1){var extent=scaleExtent(scale.domain()),i=-1,n=ticks.length,d=(ticks[1]-ticks[0])/++m,j,v;while(++i<n){for(j=m;--j>0;){if((v=+ticks[i]-j*d)>=extent[0]){subticks.push(v)}}}for(--i,j=0;++j<m&&(v=+ticks[i]+j*d)<extent[1];){subticks.push(v)}}return subticks}function scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]}global.cloudViz.gauge=cloudViz.util.createConstructor(gauge)})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},core=cloudViz.core||{},dv=global.dv||{},d3=global.d3||{},treemap=Object.create(core);var width=0,height=0,top=0,headingHeight=25,leftMargin=0,rightMargin=0,bottomMargin=0,rgbaRegex=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?|\.[0-9]+)\s*\)/,rgbRegex=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,x=d3.scale.linear(),y=d3.scale.linear(),color=d3.scale.ordinal(),chartContainer,nodeContainer,firstLaunch=true,layout;treemap.init=function(options){this._type="treemap";options=options||{};this._initDefaultOptions();this.setOptions(options);if(options.enableSelection){this.selectionCache(new dv.util.SelectionCache);this._selectionCache.selectionKeymap(this.determineKeyModifiers);var self=this;this._selectionCache.on("selectionChanged",function(source,all,added,removed){self._highlightedOverlay.updateSelectedDisplay(all);self._onSelectionChanged(source,all,added,removed,0)})}return this};treemap._initDefaultOptions=function(options){var defaults={theme:"default",colors:[],layout:"squarify",duration:750,autoResize:false,tooltipContent:defaultTooltipContent,cellContent:null,enableSelection:false};return Object.getPrototypeOf(treemap)._initDefaultOptions.call(this,defaults)};treemap._onAutoResize=function(){this.render()};treemap.reset=function(){};treemap._preRender=function(){Object.getPrototypeOf(treemap)._preRender.call(this);this.setColors(this._options);this._determineSize();this._configureScales(this._options.data);this._configureLayout();this._highlightedOverlay=cloudViz.util.selectedOverlay(d3.select(this._options.parent))};treemap._render=function(){this._initContainer();this._draw(this._options.data);firstLaunch=false;return this};treemap._postRender=function(){Object.getPrototypeOf(treemap)._postRender.call(this)};treemap._determineSize=function(){width=this._getChartWidth();height=this._getChartHeight()};treemap._configureScales=function(data){var opts=this._options;color.domain(data.map(function(d){return d.name})).range(opts.colors);var xDomain=data.hasOwnProperty("dx")?[data.x,data.x+data.dx]:[0,width],yDomain=data.hasOwnProperty("dy")?[data.y,data.y+data.dy]:[0,height];x.domain(xDomain).range([1,width-2]);y.domain(yDomain).range([1,height-2])};treemap._configureLayout=function(){layout=d3.layout.treemap().sticky(true).value(function(d){return d.value||0}).sort(function(a,b){return a.value-b.value}).mode(this._options.layout).round(false)};treemap._initContainer=function(){var opts=this._options;function tmpData(){return throwawayArray}var throwawayArray=[0];var container=d3.select(opts.parent).selectAll(".cv-wrapper.cv-treemap").data(tmpData(),tmpData);container.enter().append("div").classed("cv-wrapper cv-treemap",true);chartContainer=container.selectAll(".chart-wrapper").data(tmpData(),tmpData);chartContainer.enter().append("div").classed("chart-wrapper",true).style("position","relative");chartContainer.style("width",width+"px").style("height",height+"px");nodeContainer=chartContainer.selectAll(".node-container").data(tmpData(),tmpData);nodeContainer.enter().append("div").classed("node-container",true).style("overflow","hidden");nodeContainer.style("width",width+"px").style("height",height+"px")};treemap._initNodeValues=function(curNode){var i,sum=0,ilen=typeof curNode.children!="undefined"?curNode.children.length:0;for(i=0;i<ilen;i++){sum+=this._initNodeValues(curNode.children[i])}if(typeof curNode.value=="undefined"){curNode.value=sum}return curNode.value};treemap._removeZeroNodes=function(layoutData){var i,j,ilen=layoutData.children.length,hasKids=false;for(i=0;i<ilen;i++){this._initNodeValues(layoutData.children[i]);var jlen=layoutData.children[i].children.length;for(j=0;j<jlen;j++){if(layoutData.children[i].children[j].value===0){layoutData.children[i].children.splice(j,1);j-=1;jlen-=1}}hasKids=hasKids||jlen>0}if(hasKids){for(i=0;i<ilen;i++){if(layoutData.children[i].children.length===0){layoutData.children.splice(i,1);i-=1;ilen-=1}}}else{for(i=0;i<ilen;i++){if(layoutData.children[i].value===0){layoutData.children.splice(i,1);i-=1;ilen-=1}}}return layoutData};treemap._draw=function(data){var self=this,opts=this._options,layoutData=this._removeZeroNodes({children:this._options.data}),nodes=layout.size([width,height+headingHeight]).padding([headingHeight,leftMargin,bottomMargin,rightMargin]).nodes(layoutData),children=nodes.filter(function(d){return!d.children}),parents=nodes.filter(function(d){return d.parent&&d.children}),childrenSelected;var container=d3.select(opts.parent).selectAll(".cv-wrapper.cv-treemap").data([0]);var currentChartContainer=container.selectAll(".chart-wrapper").data([0]);var node=nodeContainer.selectAll(".cv-node").data(nodes);var newNodes=node.enter().append("div").attr("class",function(d,i,j){return"datum-"+i+" series-"+j}).classed("cv-node",true).on("click",function(d,i,j){if(d.depth>0){var el=d3.select(this),selectedNodes=[];if(d.children){selectedNodes=nodeContainer.selectAll(".second-level").filter(function(cn){return d.children.indexOf(cn)>=0});selectedNodes[0].push(this);var previouslySelectedNodes=nodeContainer.selectAll(".cv-node.selected");var newSelectedNodes=[];if(previouslySelectedNodes[0].indexOf(this)>=0){newSelectedNodes=previouslySelectedNodes[0].filter(function(prevNode){var found=selectedNodes[0].indexOf(prevNode)>=0;return!found})}else{newSelectedNodes=selectedNodes[0].concat(previouslySelectedNodes[0])}selectedNodes[0]=newSelectedNodes;self._selectNodes(selectedNodes)}else{selectedNodes=nodeContainer.selectAll(".cv-node.selected");var thisIdx=selectedNodes[0].indexOf(this),parent;if(thisIdx>=0){selectedNodes[0].splice(thisIdx,1);parent=self._getParentNode(this);var parentSelectedIdx=selectedNodes[0].indexOf(parent);if(parentSelectedIdx>=0){childrenSelected=0;parent.__data__.children.forEach(function(child){selectedNodes.each(function(selectedChild){if(selectedChild==child){childrenSelected++}})});if(parent.__data__.children.length-1===childrenSelected){selectedNodes[0].splice(parentSelectedIdx,1)}}}else{selectedNodes[0].push(this);parent=self._getParentNode(this);childrenSelected=0;parent.__data__.children.forEach(function(child){selectedNodes.each(function(selectedChild){if(selectedChild==child){childrenSelected++}})});if(parent.__data__.children.length===childrenSelected){selectedNodes[0].push(parent)}}self._selectNodes(selectedNodes)}self._dispatch.click.call(this,d,i,j,d3.event)}}).on("mouseover",function(d,i,j){if(!d.children){var el=d3.select(this),bounds={x:d.x+d.dx/4,y:d.y+d.dy/2-headingHeight,width:d.dx/2,height:d.dy/2},container={x:0,y:0,width:currentChartContainer.node().getBoundingClientRect().width,height:currentChartContainer.node().getBoundingClientRect().height},content=null;el.classed("hovered",true);content=opts.tooltipContent.call(this,d,i);dv.showTooltip(bounds,container,content,"top",5,currentChartContainer);self._dispatch.mouseover.call(this,d,i,j,d3.event)}}).on("mouseout",function(d,i,j){if(!d.children){var el=d3.select(this);el.classed("hovered",false);dv.removeTooltip(currentChartContainer);self._dispatch.mouseout.call(this,d,i,j,d3.event)}}).on("contextmenu",self.makeContextMenuHandler(self)).on("mousedown",self.makeSelectHandler());newNodes.append("div");newNodes.call(position).call(paint);node.exit().remove();node.classed("root-level",function(d){return d.depth===layoutData.depth}).classed("first-level",function(d){return d.depth===layoutData.depth+1}).classed("second-level",function(d){return d.depth===layoutData.depth+2}).call(paint).call(position);node.select("div").html(function(d,i){var defaultLabel=d.hasOwnProperty("name")&d.parent===layoutData?treemap.escapeHtml(d.name):null;var label=d.hasOwnProperty("label")&&d.parent===layoutData?treemap.escapeHtml(d.label):null;var content=opts.cellContent?opts.cellContent.call(this,d,i):null;var width=d.dx,height=d.dy;if(width<100||height<14){content=null}return label||defaultLabel||content}).style("opacity",function(d){return d.dx<50||d.dy<25?0:1})};treemap._selectNodes=function(nodes){var selectedNodes=nodeContainer.selectAll(".cv-node.selected");selectedNodes.classed("selected",false);nodes.classed("selected",true)};treemap._getParentNode=function(node){var parentNode;var selectedNodes=d3.select(this._options.parent).selectAll(".first-level");selectedNodes[0].forEach(function(aParent){if(aParent.__data__.children.indexOf(node.__data__)>=0){parentNode=aParent}});return parentNode};treemap.setSelected=function(selectorFn){var self=this;var selectedNodes=d3.select(this._options.parent).selectAll(".second-level").filter(selectorFn);selectedNodes[0].forEach(function(node){var parent=self._getParentNode(node),childrenSelected=0;if(parent){parent.__data__.children.forEach(function(child){selectedNodes.each(function(selectedChild){if(selectedChild==child){childrenSelected++}})});if(parent.__data__.children.length===childrenSelected){selectedNodes[0].push(parent)}}});self._selectNodes(selectedNodes);return self};treemap.getSelected=function(){var selectedNodes=[];var selected=nodeContainer.selectAll(".second-level.cv-node.selected");if(selected){selected[0].forEach(function(node){selectedNodes.push(node.__data__)})}return selectedNodes};function defaultTooltipContent(d){return"<span class='series-name'>"+treemap.escapeHtml(d.parent.name)+"</span>"+"<span class='metric-value'>"+treemap.escapeHtml(d.value)+"</span>"+"<span class='metric-name'>"+treemap.escapeHtml(d.name)+"</span>"}function position(selection){var padding=function(d){if(d.depth===1){return 3}if(d.depth===2){return 1}return 0};selection.style("left",function(d){return x(d.x)+1+"px"}).style("top",function(d){if(d.children&&!d.parent){return 0}return y(d.y)+1-headingHeight+"px"}).style("width",function(d){return x(d.x+d.dx)-x(d.x)-2+"px"}).style("height",function(d){if(d.children){return null}return y(d.y+d.dy)-y(d.y)-2+"px"})}function paint(selection){selection.style("background-color",function(d){if(d.children||!d.parent){return null}return color(d.parent.name)})}global.cloudViz.treemap=cloudViz.util.createConstructor(treemap)})(this);(function(global){"use strict";d3.wordcloud=function(){var wordcloud={},data,size=[256,256],p,$p,$wrapper,$container,svg,zoomContainer,_selectionCache=new dv.util.SelectionCache,_coreChart,options,spiral,padding,rotateRange=[0,90],timeInterval=Infinity,event=d3.dispatch("word","end"),timer=null;wordcloud.selectionCache=function(){return _selectionCache};wordcloud.coreChart=function(val){if(val){_coreChart=val;this.makeContextMenuHandler=_coreChart.makeContextMenuHandler;this.__dispatch=_coreChart._dispatch}return _coreChart};wordcloud.draw=function(){$container=wordcloud.createSVGContainer();var wc=svg.append("g").attr("transform","translate("+[size[0]/2,size[1]/2]+")").selectAll("text").data(data);var colorSpread=options.colorSpread,colors=options["colors"],lumcolors=[],i,colorLen=colors.length,myData=options["data"],dataLen=myData.length,colorLoopSize=options.colorLoopSize>colorLen?colorLen:options.colorLoopSize;for(i=0;i<colorLen;i++){lumcolors.push(d3.hsl(colors[i]))}if(colorSpread=="gradient"){lumcolors.sort(function(a,b){return b.l-a.l})}else{lumcolors.sort(function(a,b){return a.l-b.l})}for(i=0;i<colorLen;i++){colors[i]=lumcolors[i].toString()}var idx,interpretedDomain=[],max=0,min=99999,colorGradient;if(colorSpread=="gradient"){for(i=0;i<dataLen;i++){max=myData[i].size>max?myData[i].size:max;min=myData[i].size<min?myData[i].size:min}interpretedDomain[0]=0;for(i=1;i<colorLen;i++){interpretedDomain[i]=i*(max-min)/(colorLen-1)}colorGradient=d3.scale.linear().domain(interpretedDomain).range(colors)}wc.enter().append("text").attr("transform",function(d){return"translate("+[d.x,d.y]+")rotate("+d.rotate+")"}).on("mousedown",_coreChart.makeSelectHandler()).style("fill",function(d,i){if(colorSpread=="truncate"){return colors[i%colorLen]}if(colorSpread=="gradient"){return colorGradient(d.size)}if(colorSpread=="loop"){if(i<colorLen){return colors[i]}else{var loopStart=colorLen-colorLoopSize;idx=(i-colorLen)%colorLoopSize+loopStart;return colors[idx]}}idx=Math.round(colorLen*i/dataLen);return colors[idx<colorLen?idx:colorLen-1]}).attr("text-anchor","middle").style("font-size",function(d){return d.size+"px"}).style("font-family",function(d){return d.font}).on("contextmenu",wordcloud.makeContextMenuHandler(wordcloud)).text(function(d,i){return d.text})};wordcloud.start=function(){function step(){var start=+new Date,d;while(+new Date-start<timeInterval&&++i<n&&timer){d=data[i];d.x=size[0]*(Math.random()+.5)>>1;d.y=size[1]*(Math.random()+.5)>>1;cloudSprite(d,data,i);if(d.hasText&&place(board,d,bounds)){tags.push(d);event.word(d);if(bounds){cloudBounds(bounds,d)}else{bounds=[{x:d.x+d.x0,y:d.y+d.y0},{x:d.x+d.x1,y:d.y+d.y1}]}d.x-=size[0]>>1;d.y-=size[1]>>1}}if(i>=n){wordcloud.stop();event.end(tags,bounds)}}var board=zeroArray((size[0]>>5)*size[1]),bounds=null,n=data.length,i=-1,tags=[];data.forEach(function(d,i){d.font=options["fontFamily"];d.style="normal";d.weight="normal";if(options["allowIntermediateAngles"]){d.rotate=Math.random()*(rotateRange[1]-rotateRange[0])+rotateRange[0]}else{d.rotate=~~(Math.random()*2)*(rotateRange[1]-rotateRange[0])-rotateRange[0]}d.padding=options["padding"]});data.sort(function(a,b){return b.size-a.size});if(options.colorSpread=="truncate"&&n>options.colors.length){n=data.length=options.colors.length}if(timer){clearInterval(timer)}timer=setInterval(step,0);step();return wordcloud};wordcloud.stop=function(){if(timer){clearInterval(timer);timer=null}return wordcloud};wordcloud.timeInterval=function(x){if(!arguments.length){return timeInterval}timeInterval=x==null?Infinity:x;return wordcloud};function place(board,tag,bounds){var perimeter=[{x:0,y:0},{x:size[0],y:size[1]}],startX=tag.x,startY=tag.y,maxDelta=Math.sqrt(size[0]*size[0]+size[1]*size[1]),s=spiral(size),dt=Math.random()<.5?1:-1,t=-dt,dxdy,dx,dy;while(dxdy=s(t+=dt)){dx=~~dxdy[0];dy=~~dxdy[1];if(Math.min(dx,dy)>maxDelta){break}tag.x=startX+dx;tag.y=startY+dy;if(tag.x+tag.x0<0||tag.y+tag.y0<0||tag.x+tag.x1>size[0]||tag.y+tag.y1>size[1]){continue}if(!bounds||!cloudCollide(tag,board,size[0])){if(!bounds||collideRects(tag,bounds)){var sprite=tag.sprite,w=tag.width>>5,sw=size[0]>>5,lx=tag.x-(w<<4),sx=lx&127,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){board[x+i]|=last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0)}x+=sw}delete tag.sprite;return true}}}return false}wordcloud.createSVGContainer=function(){$p=d3.select(p);$wrapper=$p.selectAll(".cv-wordcloud").data([data]);$wrapper.enter().append("div").classed("cv-wordcloud",true);$wrapper.style("width",size[0]+"px").style("height",size[1]+"px");svg=$wrapper.selectAll("svg").data([data]);svg.enter().append("svg").attr("width","100%").attr("height","100%");svg.exit().remove();var background=svg.selectAll(".wordcloud-bg").data([0]).enter().append("rect").classed("wordcloud-bg",true);_selectionCache.setDeselector(background);return svg};wordcloud.data=function(_){if(!arguments.length){return data}data=_;return wordcloud};wordcloud.parent=function(_){if(!arguments.length){return p}p=_;return wordcloud};wordcloud.size=function(x){if(!arguments.length){return size}size=[+x[0],+x[1]];return wordcloud};wordcloud.options=function(_){if(!arguments.length){return options}options=_;spiral=spirals[options["spiral"]+""]||options["spiral"];return wordcloud};wordcloud.rotateRange=function(_){if(!arguments.length){return rotateRange}rotateRange=_;return wordcloud};function EmptyDataException(){this.type="EmptyDataException";this.message="The data is empty or null";this.toString=function(){return this.type+" - "+this.message}}function ParentNotSpecifiedException(){this.type="ParentNotSpecifiedException";this.message="A parent was not specified for this visualization";this.toString=function(){return this.type+" - "+this.message}}wordcloud.setCallback=function(e,callback){wordcloud.on(e,callback);return wordcloud};return d3.rebind(wordcloud,event,"on")};function cloudSprite(d,data,di){if(d.sprite){return}c.clearRect(0,0,(cw<<5)/ratio,ch/ratio);var x=0,y=0,w=0,h=0,maxh=0,n=data.length;--di;while(++di<n){d=data[di];c.save();c.font=d.style+" "+d.weight+" "+~~((d.size+1)/ratio)+"px "+d.font;w=c.measureText(d.text+"m").width*ratio;h=d.size<<1;if(d.rotate){var sr=Math.sin(d.rotate*cloudRadians),cr=Math.cos(d.rotate*cloudRadians),wcr=w*cr,wsr=w*sr,hcr=h*cr,hsr=h*sr;w=Math.max(Math.abs(wcr+hsr),Math.abs(wcr-hsr))+31>>5<<5;h=~~Math.max(Math.abs(wsr+hcr),Math.abs(wsr-hcr))}else{w=w+31>>5<<5}if(h>maxh){maxh=h}if(x+w>=cw<<5){x=0;y+=maxh;maxh=0}if(y+h>=ch){break}c.translate((x+(w>>1))/ratio,(y+(h>>1))/ratio);if(d.rotate){c.rotate(d.rotate*cloudRadians)}c.fillText(d.text,0,0);if(d.padding){c.lineWidth=2*d.padding,c.strokeText(d.text,0,0)}c.restore();d.width=w;d.height=h;d.xoff=x;d.yoff=y;d.x1=w>>1;d.y1=h>>1;d.x0=-d.x1;d.y0=-d.y1;d.hasText=true;x+=w}var pixels=c.getImageData(0,0,(cw<<5)/ratio,ch/ratio).data,i=0,sprite=[];while(--di>=0){d=data[di];if(!d.hasText){continue}w=d.width;var w32=w>>5;h=d.y1-d.y0;for(i=0;i<h*w32;i++){sprite[i]=0}x=d.xoff;if(x==null){return}y=d.yoff;var seen=0,seenRow=-1;for(var j=0;j<h;j++){for(i=0;i<w;i++){var k=w32*j+(i>>5),m=pixels[(y+j)*(cw<<5)+(x+i)<<2]?1<<31-i%32:0;sprite[k]|=m;seen|=m}if(seen){seenRow=j}else{d.y0++;h--;j--;y++}}d.y1=d.y0+seenRow;d.sprite=sprite.slice(0,(d.y1-d.y0)*w32)}}function cloudCollide(tag,board,sw){sw>>=5;var sprite=tag.sprite,w=tag.width>>5,lx=tag.x-(w<<4),sx=lx&127,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){if((last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0))&board[x+i]){return true}}x+=sw}return false}function cloudBounds(bounds,d){var b0=bounds[0],b1=bounds[1];if(d.x+d.x0<b0.x){b0.x=d.x+d.x0}if(d.y+d.y0<b0.y){b0.y=d.y+d.y0}if(d.x+d.x1>b1.x){b1.x=d.x+d.x1}if(d.y+d.y1>b1.y){b1.y=d.y+d.y1}}function collideRects(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function archimedeanSpiral(size){var e=size[0]/size[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function rectangularSpiral(size){var dy=4,dx=dy*size[0]/size[1],x=0,y=0;return function(t){var sign=t<0?-1:1;switch(Math.sqrt(1+4*sign*t)-sign&3){case 0:x+=dx;break;case 1:y+=dy;break;case 2:x-=dx;break;default:y-=dy;break}return[x,y]}}function zeroArray(n){var a=[],i=-1;while(++i<n){a[i]=0}return a}var cloudRadians=Math.PI/180,cw=1<<11>>5,ch=1<<11,canvas,ratio=1;canvas=document.createElement("canvas");canvas.width=1;canvas.height=1;ratio=Math.sqrt(canvas.getContext("2d").getImageData(0,0,1,1).data.length>>2);canvas.width=(cw<<5)/ratio;canvas.height=ch/ratio;var c=canvas.getContext("2d");c.fillStyle=c.strokeStyle="red";c.textAlign="center";var spirals={archimedean:archimedeanSpiral,rectangular:rectangularSpiral};d3.wordcloud.gradIdCounter=0})(this);(function(global){"use strict";var cloudViz=global.cloudViz||{},dvcore=cloudViz.dvcore||{},dv=global.dv||{},d3=global.d3||{},wordcloud=Object.create(dvcore),timeoutId=-1;wordcloud.init=function(options){Object.getPrototypeOf(wordcloud).init.apply(this,arguments);this._type="wordcloud";this._chart=dv.chart();options=options||{};this._initDefaultOptions();this.setOptions(options);this._initWordcloud();return this};wordcloud._initDefaultOptions=function(){var defaults={fontFamily:"Impact",spiral:"archimedean",size:[800,400],rotateRange:[0,0],allowIntermediateAngles:false,colors:[],colorSpread:"stretch",colorLoopSize:1,theme:"default",padding:1,enableSelection:false};return Object.getPrototypeOf(wordcloud)._initDefaultOptions.call(this,defaults)};wordcloud._initWordcloud=function(){this._wordcloud=d3.wordcloud();this._wordcloud.coreChart(this);var self=this;if(this._options.enableSelection){this.selectionCache(this._wordcloud.selectionCache());this._wordcloud.selectionCache().on("selectionChanged",function(source,all,added,removed){self._onSelectionChanged(source,all,added,removed,0)})}};wordcloud._render=function(){this._configure()};wordcloud._configure=function(){var options=this._options;options.data=this._dataAdapter.data();this._wordcloud.data(options.data).parent(options.parent).options(options).size(options.size).rotateRange(options.rotateRange).setCallback("end",this._wordcloud.draw).start()};global.cloudViz.wordcloud=cloudViz.util.createConstructor(wordcloud)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,dv=global.dv,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard");var adapter={};adapter._isDataValid=null;adapter.process=function(options,changedOptions){this._options=options;this.l10n=cloudViz.util.deepExtend({},cloudViz.localeDefinition(options.locale),options.l10n||{});if(!("data"in changedOptions)&&!("mappings"in changedOptions)){return}if(!this._validateData(options.data,options.mappings)){return}this._processOptions(options,changedOptions)};adapter._processOptions=function(options,changedOptions){};adapter._determineOvertime=function(data){var mappings=this.mappings(),dates=data[mappings["x"]],shouldGuessOvertime=this._processedOptions?this._processedOptions.guessOvertimeForNonDateValues:true;if(!dates||!dates.length){return false}return dates.every(function(candidate){return dv.util.isDate(candidate)})||shouldGuessOvertime&&dates.every(function(candidate){return/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.test(candidate)})};adapter._calculateDateGranularity=function(data){var mappings=this.mappings(),dates=data[mappings["x"]];if(!dates||!dates.length){return"*"}dates=dates.map(function(d){return new Date(d)});var min=Math.min.apply(Math,dates),max=Math.max.apply(Math,dates),range=(max-min)/1e3,step=range/dates.length;return this.getTimeGranularity(step).gran};adapter.getTimeGranularity=function(step,total){var gran="second",divisor=1;if(!step){return{gran:gran,divisor:divisor}}if(total){if(step>=(divisor=60*60*24*365)){gran="year"}else if(step>=(divisor=60*60*24*31)){gran="month"}else if(step>=(divisor=60*60*24*7)){gran="week"}else if(step>=(divisor=60*60*24)){gran="day"}else if(step>=(divisor=60*60)){gran="hour"}else if(step>=(divisor=60)){gran="minute"}else{gran="second";divisor=1}}else{if(step<=(divisor=1)){gran="second"}else if(step<=(divisor=60)){gran="minute"}else if(step<=(divisor=60*60)){gran="hour"}else if(step<=(divisor=60*60*24)){gran="day"}else if(step<=(divisor=60*60*24*7)){gran="week"}else if(step<=(divisor=60*60*24*31)){gran="month"}else{gran="year";divisor=60*60*24*365}}return{gran:gran,divisor:divisor}};adapter._getYTitleFromLabels=function(labels){var uniqLabels=dv.util.uniq(labels);if(uniqLabels&&uniqLabels.length===1){return uniqLabels[0]}return null};adapter.data=function(){return this._options.data};adapter.mappings=function(){return this._options.mappings};adapter.formats=function(){return this._options.formats};adapter.xAxisTitle=function(){return this._options.xAxisTitle||null};adapter.yAxisTitle=function(){return this._options.yAxisTitle||null};adapter.dateGranularity=function(){return this._processedOptions.dateGranularity};adapter.colors=function(){return this._processedOptions.colors};adapter.isDataValid=function(){return this._validateData(this._options.data,this._options.mappings)};adapter._validateData=function(data,mappings){if(!data){return false}for(var key in data){if(data[key].length){return true}}return false};standardAdapters.baseObj=adapter;standardAdapters.base=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);var data=this.data(),mappings=this.mappings();if(processedOptions.isOvertime==null){processedOptions.isOvertime=this._determineOvertime(data);if(processedOptions.isOvertime){processedOptions.dateGranularity=processedOptions.dateGranularity||this._calculateDateGranularity(data)}}this._uniqueFillValues=this._processUniqueFillValues(data,mappings);this._uniqueFillExtents=this._processUniqueFillExtents(data,mappings,this._uniqueFillValues);this._uniqueXValues=this._processUniqueXValues(data,mappings,processedOptions.isOvertime);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter.isOvertime=function(){return this._processedOptions.isOvertime};adapter.uniqueFillValues=function(){return this._uniqueFillValues||[]};adapter.uniqueFillExtents=function(){return this._uniqueFillExtents};adapter.uniqueXValues=function(){return this._uniqueXValues||[]};adapter.getUniqueFillExtent=function(scaleIndex){var uniqueFillValue=this._uniqueFillValues[scaleIndex];if(uniqueFillValue){return this._uniqueFillExtents[uniqueFillValue]}return null};adapter.getUniqueFillExtentByFill=function(fill){return this._uniqueFillExtents[fill]};adapter._processUniqueFillValues=function(data,mappings){var tuple=data[mappings["series"]];return tuple?dv.util.uniq(tuple):[]};adapter._processUniqueFillExtents=function(data,mappings,uniqueFillValues){var fillTuple=data[mappings["series"]],yTuple=data[mappings["y"]],extents={};yTuple.map(function(d,i){var fillValue=fillTuple[i];if(!isFinite(d)||d===null){return}if(!extents[fillValue]){extents[fillValue]=[d,d]}extents[fillValue][0]=Math.min(d,extents[fillValue][0]);extents[fillValue][1]=Math.max(d,extents[fillValue][1])});return extents};adapter._processUniqueXValues=function(data,mappings,isOvertime){if(isOvertime){return[]}else{var tuple=data[mappings["x"]];return tuple?dv.util.uniq(tuple):[]}};standardAdapters.barObj=adapter;standardAdapters.bar=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj),d3=global.d3||{};adapter._processOptions=function(options,changedOptions){Object.getPrototypeOf(adapter)._processOptions.apply(this,arguments)};adapter._validateData=function(data,mappings){if(!data){return false}return true};adapter.data=function(){return this._options.data};adapter.metric=function(){return this._options.metric};adapter.format=function(){return this._options.format};standardAdapters.choroplethObj=adapter;standardAdapters.choropleth=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.barObj),maxFacets=3;adapter._processOptions=function(options,changedOptions){this._processCategories(options);Object.getPrototypeOf(adapter)._processOptions.call(this,this._processedOptions,changedOptions)};adapter._processCategories=function(options){var LEGEND_LABEL="legendLabel";var processedOptions=Object.create(options),data=Object.create(options.data),mappings=options.mappings,valKey=mappings["y"],catKey=mappings["sliceId"],catLabelKey=data[LEGEND_LABEL]&&mappings[LEGEND_LABEL]||mappings["x"],facetKey=mappings["series"],facetLabelKey=mappings["seriesLabel"]||facetKey,collection=[],i,ii=data[valKey].length,k,facets=[],facetLabels=[],facetsOrder={},value,categoryOrder=[],colorOrder=[],palette=processedOptions.colors,__other__="__other__";if(!catKey){catKey=catLabelKey}for(i=0;i<ii;++i){collection[i]={};for(k in data){value=data[k][i];if(k===facetKey){if(facets.length){if(value!==facets[facets.length-1]){if(facets.length===this.maxFacets){ii--;i--;collection.pop();break}facets[facets.length]=value;facetLabels[facetLabels.length]=data[facetLabelKey][i];facetsOrder[value]=facets.length}}else{facets=[value];facetLabels=[data[facetLabelKey][i]];facetsOrder[value]=facets.length}}if(k===catKey){if(categoryOrder.indexOf(value)===-1){categoryOrder.push(value)}}collection[i][k]=value}}this.numFacets=facets.length;var sort=processedOptions.sort;collection.sort(function(a,b){if(a[facetKey]===b[facetKey]){if(sort==="none"){return 0}if(sort==="ascending"){return a[valKey]-b[valKey]}return b[valKey]-a[valKey]}return facetsOrder[a[facetKey]]-facetsOrder[b[facetKey]]});for(k in data){data[k]=[]}data["cvdonutorder"]=[];var colors=[];var colorCount=0;var facetCount=0,lastFacet,facet,max=this._options.maxSlices,newCategoryOrder=[],category;this.otherIncluded=false;for(i=0,ii=collection.length;i<ii;++i){facet=collection[i][facetKey];category=collection[i][catKey];if(facet!==lastFacet){facetCount=0;lastFacet=facet}if(facetCount==max-1&&i+1<ii&&collection[i+1][facetKey]===facet){for(k in data){if(!data[k]){data[k]=[]}data[k][i]=collection[i][k]}this.otherIncluded=true;data[catKey][i]=__other__;data[catLabelKey][i]=__other__;++facetCount;data["cvdonutorder"][i]=i;continue}if(facetCount>=max){data[valKey][i-1]+=collection[i][valKey];collection.splice(i,1);ii=collection.length;--i;++facetCount;continue}++facetCount;for(k in data){data[k][i]=collection[i][k]}if(newCategoryOrder.indexOf(category)===-1){colors.push(palette[colorCount%palette.length]);newCategoryOrder.push(category)}else{colors.push(palette[colorCount%palette.length])}++colorCount;data["cvdonutorder"][i]=i}data.aggregateLabel=options.data[mappings["aggregateLabel"]];processedOptions.yAxisTitle=options.yAxisTitle||facetLabels;processedOptions.data=data;processedOptions.colors=colors;this._processedOptions=processedOptions};adapter.processLabelData=function(legend){var d=this.data(),mappings=this.mappings(),data=this._labelData=Object.create(d),numTotals={},visTotals={},facets=data[mappings["series"]],values=data[mappings["y"]],totals=data[mappings["totals"]],slices=data[mappings["x"]];facets.forEach(function(v,i){if(numTotals[v]===undefined){numTotals[v]=0}if(visTotals[v]===undefined){visTotals[v]=0}if(mappings["totals"]&&(!isNaN(parseFloat(totals[i]))||totals[i]>0)){numTotals[v]=numTotals[v]||totals[i];if(!legend.isSeriesEnabled||legend.isSeriesEnabled(slices[i])){visTotals[v]=visTotals[v]||totals[i]}}else{numTotals[v]+=values[i];if(!legend.isSeriesEnabled||legend.isSeriesEnabled(slices[i])){visTotals[v]+=values[i]}}});var textValue=data.cvtextvalue=[],textPercentLabel=data.cvtextperclabel=[],textValueLabel=data.cvtextvallabel=[],preValue={},facet,percent,visPercent,visible;values.forEach(function(v,i){facet=facets[i];percent=parseFloat(v)/numTotals[facet]*100;textValueLabel[i]=v;textPercentLabel[i]=(percent%1!==0?percent.toFixed(1):percent)+"%";visible=!legend.isSeriesEnabled||legend.isSeriesEnabled(slices[i]);visPercent=parseFloat(v)/visTotals[facet]*100;if(preValue[facet]===undefined){preValue[facet]=0}textValue[i]=visible?preValue[facet]+visPercent/2:0;preValue[facet]+=visible?visPercent:0})};adapter.data=function(){return this._processedOptions.data};adapter.labelData=function(){return this._labelData};adapter.yAxisTitle=function(facetIndex){var title=this._processedOptions.yAxisTitle;if(title instanceof Array&&title.length>facetIndex){title=title[facetIndex]}return title};adapter.showOtherCategory=function(){return this.otherIncluded};adapter.numberOfFacets=function(){return this.numFacets};standardAdapters.donutObj=adapter;standardAdapters.donut=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);var data=this.data(),mappings=this.mappings();this._forceZero=options.forceZero;this._uniqueStrokeValues=this._processUniqueStrokeValues(data,mappings);this._uniqueStrokeExtents=this._processUniqueStrokeExtents(data,mappings);if(processedOptions.isOvertime==null){processedOptions.isOvertime=this._determineOvertime(data);if(processedOptions.isOvertime){processedOptions.dateGranularity=processedOptions.dateGranularity||this._calculateDateGranularity(data)}}Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter.isOvertime=function(){return this._processedOptions.isOvertime};adapter.uniqueStrokeValues=function(){return this._uniqueStrokeValues||[]};adapter.uniqueStrokeExtents=function(){return this._uniqueStrokeExtents};adapter.getUniqueStrokeExtent=function(scaleIndex){var uniqueStrokeValue=this._uniqueStrokeValues[scaleIndex];if(uniqueStrokeValue){return this._uniqueStrokeExtents[uniqueStrokeValue]}return null};adapter.getUniqueStrokeExtentByStroke=function(stroke){return this._uniqueStrokeExtents[stroke]};adapter._processUniqueStrokeValues=function(data,mappings){var tuple=data[mappings["series"]];return tuple?dv.util.uniq(tuple):[]};adapter._processUniqueStrokeExtents=function(data,mappings){var strokeTuple=data[mappings["series"]],yTuple=data[mappings["y"]],extents={};yTuple.map(function(d,i){var strokeValue=strokeTuple[i];if(!isFinite(d)||d===null){return}if(!extents[strokeValue]){extents[strokeValue]=[d,d]}extents[strokeValue][0]=Math.min(d,extents[strokeValue][0]);extents[strokeValue][1]=Math.max(d,extents[strokeValue][1])});return extents};standardAdapters.lineObj=adapter;standardAdapters.line=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj);adapter._processOptions=function(options){this._forceZero=options.forceZero};adapter.sizeMetricName=function(){return this._options&&this._options.sizeTitle||null};adapter.isBubble=function(){var size=this.mappings()["size"];return size&&size.length};standardAdapters.pointObj=adapter;standardAdapters.point=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options),data=JSON.parse(JSON.stringify(options.data));data.nodesById=[];data.nodes.map(function(n,i){n._pid=i;data.nodesById[i]=n;return n});data.links=[];data.linksById=[];var src,target,val,id,link,adap=this;data.paths=data.paths.filter(function(p){if(!(p.values instanceof Array)){p.values=Array.apply(null,new Array(p.nodes.length-1)).map(function(){return p.values})}if(p.values.some(function(v){return v<=0})){return false}p.nodes.map(function(n){return n!==null?data.nodes[n]._pid:null});return true});data.paths.forEach(function(p,i){p.nodes.forEach(function(n,ni){if(!ni){src=p.nodes[ni];if(src!==null){data.nodesById[src].isPathStart=true;if(data.nodesById[src].isPathEnd){data.nodesById[src].isPivot=true}}return}src=p.nodes[ni-1];target=n;if(ni===p.nodes.length-1){if(target!==null){data.nodesById[target].isPathEnd=true;if(data.nodesById[target].isPathStart){data.nodesById[target].isPivot=true}}}val=p.values[ni-1];id=adap._generateLinkId(src,target);if(link=data.linksById[id]){link.value+=val;link.paths.push(i)}else{link={source:src,target:target,value:val,paths:[i]};data.linksById[id]=link;data.links.push(link)}})});processedOptions.data=data;Object.getPrototypeOf(adapter)._processOptions.apply(this,arguments)};adapter.data=function(){return this._processedOptions.data};adapter.nodeKey=function(){return function(d,i){return d.column+":"+d.row}};adapter.linkKey=function(){return function(d,i){var t=d.target,s=d.source,tid=t?t.column+":"+t.row:"null",sid=s?s.column+":"+s.row:"null";return sid+"-"+tid}};adapter.pathingTitle=function(){return""};adapter.getPathEnd=function(path){return null};adapter.getPathDirection=function(path){return 0};adapter.activePathsTitle=function(paths){return paths&&paths.length?this.l10n.labels.pathing["path2+"]:""};adapter.isValidPathingData=function(){var data=this.data();if(!data){return false}if(!data.nodes||!data.paths){return false}if(!data.nodes.length){return false}return true};adapter._generateLinkId=function(s,t){return s+"-"+t};adapter._sortPaths=function(node,dir){var data=this.data();return function sort(a,b){function checkNodes(aIndex,bIndex,mod){var aMod=aIndex+mod,bMod=bIndex+mod;var aValue=aMod<a.nodes.length&&aMod>=0?a.nodes[aMod]:-1,bValue=bMod<b.nodes.length&&bMod>=0?b.nodes[bMod]:-1;if(aValue!==-1&&aValue!==null){aValue=data.nodes.indexOf(data.nodesById[aValue])}if(bValue!==-1&&bValue!==null){bValue=data.nodes.indexOf(data.nodesById[bValue])}if(null===aValue&&null===bValue){return 0}if(null===aValue){return mod>0?1:-1}if(null===bValue){return mod>0?-1:1}if(-1===aValue&&-1===bValue){return 0}if(-1===aValue){return 1}if(-1===bValue){return-1}var dif=aValue-bValue;if(dif!==0){return dif}return checkNodes(aMod,bMod,mod)}var aIndex=a.nodes.indexOf(node._pid),bIndex=b.nodes.indexOf(node._pid),value=checkNodes(aIndex,bIndex,dir);if(0===value){value=checkNodes(aIndex,bIndex,-dir)}if(0!==value){return value}return b.nodes.length-a.nodes.length}};adapter._generatePathLinks=function(path,index,activeNode){var data=this.data(),adap=this,src,target,srcNode,targetNode,val,prevCombined,combined,height,links=[];if(!path||!path.nodes){return links}path.nodes.forEach(function(n,i,arr){if(!i){return}src=path.nodes[i-1];target=n;srcNode=data.nodesById[src]||null;targetNode=data.nodesById[target]||null;val=path.values[i-1];prevCombined=null;if(i>1){prevCombined=data.linksById[adap._generateLinkId(path.nodes[i-2],src)]}combined=data.linksById[adap._generateLinkId(src,target)];height=val/combined.value*combined.dy;if(srcNode){links.push({dy:height,sy:prevCombined?prevCombined.ty+prevCombined.offset-height:combined.sy+combined.offset,ty:!targetNode?srcNode.dy-height:combined.sy+combined.offset,source:{x:srcNode.x,y:srcNode.y,dx:0},target:{x:srcNode.x+srcNode.dx,y:srcNode.y},value:val,path:index,pivotStart:srcNode.isPivot})}links.push({dy:height,sy:combined.sy+combined.offset,ty:combined.ty+combined.offset,source:srcNode,target:targetNode,value:val,path:index});if(i+1===arr.length&&targetNode){links.push({dy:height,sy:combined.ty+combined.offset,ty:combined.ty+combined.offset,source:{x:targetNode.x,y:targetNode.y,dx:0},target:{x:targetNode.x+targetNode.dx,y:targetNode.y},value:val,path:index,pivotEnd:targetNode.isPivot})}combined.offset+=height});return links};adapter.nodePaths=function(node){var data=this.data(),paths=data.paths.filter(function(p){return p.nodes.indexOf(node._pid)!==-1});return paths};adapter.nodePathData=function(paths,node){var data=this.data(),adap=this,links=[],dlinks=data.links;dlinks.forEach(function(l){l.offset=0});paths.sort(adap._sortPaths(node,-1));paths.forEach(function(p,i){links=links.concat(adap._generatePathLinks(p,i,node))});return links};adapter.linkSortActivePaths=function(link){var data=this.data(),paths=data.paths,linkPaths,node=link.source?link.source:link.target;data.links.forEach(function(l){l.offset=0});linkPaths=link.paths.map(function(l){return paths[l]});linkPaths.sort(this._sortPaths(node,-1));return linkPaths};adapter.linkPathData=function(paths){var links=[],adap=this;paths.forEach(function(p,i){links=links.concat(adap._generatePathLinks(p,i))});return links};adapter.canExpandNode=function(nodeData){return true};adapter.canCollapseNode=function(nodeData){return true};adapter.canPivotNode=function(nodeData){return true};standardAdapters.pathingObj=adapter;standardAdapters.pathing=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj),d3=global.d3||{};adapter._processOptions=function(options,changedOptions,prevOptions){var oldOptions=prevOptions||this._processedOptions||{},processedOptions=this._processedOptions=Object.create(options);var data=JSON.parse(JSON.stringify(processedOptions.data)),sizeMetric=data.metrics[0]||{name:"",format:"int"};function getNodeSize(n){if(n.metrics&&n.metrics.length&&n.metrics[0]&&"undefined"!==typeof n.metrics[0].value){return n.metrics[0].value}if(!n.children||!n.children.length){return 0}return n.children.reduce(function(a,b){return a+getNodeSize(b)},0)}function sortChildren(a,b){return getNodeSize(b)-getNodeSize(a)}var otherLabel=this.l10n.labels.core.other;function processDataSort(node,level){node.size="undefined"===typeof node.size?getNodeSize(node):node.size;if(!node.children||!node.children.length){return}if(level<data.categories.length){var c=data.categories[level],num=node.children.length;c.top="undefined"!==typeof c.top?Math.max(c.top,num):num}if("undefined"!==typeof node.size&&sizeMetric.format!=="percent"){var sum=node.children.reduce(function(a,b){return a+getNodeSize(b)},0);if(node.size>sum){node.children.push({id:"cv-sb-other",name:otherLabel,size:node.size-sum})}}node.children.sort(sortChildren);node.children.forEach(function(d){processDataSort(d,level+1)})}processDataSort(data,0);var names=[];function processDataKeys(children,level,step){var ring=names[level]||(names[level]=[]),i,ii=children.length,item;for(i=0;i<ii;++i){item=children[i];item._sid=step+"s"+i;if(otherLabel===item.name){continue}if(item.name){ring[ring.length]=item.name}if(item.children&&item.children.length){processDataKeys(item.children,level+1,item._sid)}}}processDataKeys([data],0,"");data.name=sizeMetric.name;names.push([sizeMetric.name]);data.categories.forEach(function(c,i){c.index=i});processedOptions.uniques=names.reduce(function(a,b){var uniqs=b.reduce(function(x,y){return x.indexOf(y)<0?x.push(y)&&x:x},[]);return a.concat(uniqs)},[]);processedOptions.data=data;processedOptions.categories=data.categories;processedOptions.dataByPathKey=this._getDataByPathKey();processedOptions.colorMetricIndex=oldOptions.colorMetricIndex;processedOptions.stackedMetricIndex=oldOptions.stackedMetricIndex;processedOptions.secondaryMetricIndex=oldOptions.secondaryMetricIndex;processedOptions.secondaryMetricType=oldOptions.secondaryMetricType;processedOptions.seqColors=processedOptions.seqColors;Object.getPrototypeOf(adapter)._processOptions.apply(this,arguments)};adapter.data=function(){return this._processedOptions.data};adapter.categories=function(){return this._processedOptions.categories};adapter.uniques=function(){return this._processedOptions.uniques};adapter.colors=function(){return this._processedOptions.colors};adapter.seqColors=function(){return this._processedOptions.seqColors};adapter.metricColor=function(d){return this._processedOptions.metricColor};adapter.otherColor=function(d){return this._processedOptions.otherColor};adapter.otherGrayColor=function(d){return this._processedOptions.otherGrayColor};adapter.outRangeColor=function(d){return this._processedOptions.outRangeColor};adapter.isOther=function(d){return d.name===this.l10n.labels.core.other};adapter.isRoot=function(d){return!d.parent};adapter.isDataEmpty=function(){var d=this.data();return!(d&&d.children&&d.children.length)};adapter.isSizeEmpty=function(){return!this.data().size};adapter._validateData=function(data){if(!data||!data.children||!data.children.length){return false}return true};adapter.getPathKey=function(d,i){return d&&d._sid||i};adapter.getCategoryName=function(c){return c&&c.name||null};adapter.getCategoryByName=function(name){var cat=null;this.categories().some(function(c){if(name===c.name){cat=c;return true}return false});return cat};adapter._getDataByPathKey=function(){var data=this.data(),self=this,keys={},key;function getKey(child){if(!child){return}key=self.getPathKey(child,null);if(key){keys[key]=child}if(child.children){child.children.forEach(getKey)}}getKey(data);return keys};adapter.getDataByPathKey=function(){return this._processedOptions.dataByPathKey};adapter.getColorMetric=function(){var m=this._processedOptions.colorMetricIndex;return m?this.data().metrics[m]:null};adapter.getColorMetricIndex=function(){return this._processedOptions.colorMetricIndex};adapter.setColorMetricIndex=function(m){if(this._processedOptions.colorMetricIndex===m){m=null}this._processedOptions.secondaryMetricIndex=m;this.setSecondaryMetricType("color")};adapter.getStackedMetric=function(){var m=this._processedOptions.stackedMetricIndex;return m?this.data().metrics[m]:null};adapter.getStackedMetricIndex=function(){return this._processedOptions.stackedMetricIndex};adapter.setStackedMetricIndex=function(m){if(this._processedOptions.stackedMetricIndex===m){m=null}this._processedOptions.secondaryMetricIndex=m;this.setSecondaryMetricType("height")};adapter.getSecondaryMetricType=function(){return this._processedOptions.secondaryMetricType};adapter.setSecondaryMetricType=function(type){var mIndex=this.getSecondaryMetricIndex()||1,pOptions=this._processedOptions,self=this;pOptions.secondaryMetricIndex=mIndex;pOptions.secondaryMetricType=type;switch(type){case"color":pOptions.colorMetricIndex=mIndex;pOptions.stackedMetricIndex=null;break;case"height":pOptions.colorMetricIndex=null;pOptions.stackedMetricIndex=mIndex;break;case"both":pOptions.colorMetricIndex=mIndex;pOptions.stackedMetricIndex=mIndex;break;default:pOptions.colorMetricIndex=null;pOptions.stackedMetricIndex=null;pOptions.secondaryMetricIndex=null;pOptions.secondaryMetricType=null}};adapter.getSecondaryMetric=function(){var m=this._processedOptions.secondaryMetricIndex;return m?this.data().metrics[m]:null};adapter.getSecondaryMetricIndex=function(){return this._processedOptions.secondaryMetricIndex};adapter.setSecondaryMetricIndex=function(index,toggle){if(this._processedOptions.secondaryMetricIndex===index&&toggle){index=null}this._processedOptions.secondaryMetricIndex=index;this.setSecondaryMetricType(index?this.getSecondaryMetricType()||"height":null)};standardAdapters.sunburstObj=adapter;standardAdapters.sunburst=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj),d3=global.d3||{};adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);var data=options.data;if(options.isEmotionChart){data=this._getEmotionData(options.data)}processedOptions.data=data;Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter._getEmotionData=function(data){var l10n=this.l10n.labels.flower;var emotionTemplate=[{index:"joy",label:l10n.joy,color:"#e6b43c"},{index:"admiration",label:l10n.admiration,color:"#7daf4b"},{index:"fear",label:l10n.fear,color:"#50965a"},{index:"surprise",label:l10n.surprise,color:"#00a0be"},{index:"sadness",label:l10n.sadness,color:"#286eaf"},{index:"disgust",label:l10n.disgust,color:"#964196"},{index:"anger",label:l10n.anger,color:"#f04641"},{index:"anticipation",label:l10n.anticipation,color:"#dc5f00"}];var map={};dv.util.each(data,function(o){map[o.index]=o});dv.util.each(emotionTemplate,function(o){if(!map[o.index]){o.value=0}else{o.value=map[o.index].value||0}});return emotionTemplate};adapter._validateData=function(data,mappings){if(!data){return false}return true};adapter.data=function(){return this._processedOptions.data};standardAdapters.flowerObj=adapter;standardAdapters.flower=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.barObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);this._processStepData(processedOptions);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter.data=function(){return this._processedOptions.data};adapter.mappings=function(){return this._processedOptions.mappings};adapter.seriesLabelKey=function(){return"cv:fnl:seriesLabel"};adapter.averageStepData=function(){return this._processedOptions.avgStepData};adapter.averageDataLabel=function(){return this._processedOptions.avgStepLabel};adapter.averageSeries=function(){return this._processedOptions.averageSeries};adapter.previousStepData=function(){return this._processedOptions.prevStepData};adapter.currentStepData=function(){return this._processedOptions.curStepData};adapter.textStepData=function(){return this._processedOptions.txtStepData};adapter.getNumSteps=function(){return this._processedOptions.numSteps};adapter.getNumBarsPerStep=function(){return this._processedOptions.numBarsPerStep};adapter.useAvgMaxValue=function(){if(!this.averageStepData()){return false}var extents=this.uniqueFillExtents();var empty=!Object.keys(extents).some(function(c,i,a){return extents[c][0]!==0||extents[c][1]!==0});return empty||!this._processedOptions.normalized};adapter._stepDelimiter=":::";adapter.getStepName=function(d){return d&&d.slice(0,d.indexOf(this._stepDelimiter))||""};adapter.isSingleSeries=function(){return this.getNumBarsPerStep()===1};adapter.isAvgCalculated=function(){return this._processedOptions.avgStepDataCalc};adapter.getSingleSeriesStepValue=function(d,i){if(!this.isSingleSeries()){return}return this.currentStepData()[this.mappings()["y"]][i]};adapter._processStepData=function(processedOptions){var mappings=this.mappings(),self=this,data=processedOptions.data,series=mappings["series"],seriesLabel=mappings["seriesLabel"],fnSeriesLabel=this.seriesLabelKey(),x=mappings["x"],value=mappings["y"],avgSeries=processedOptions.averageSeries,validAvgSeries=avgSeries&&data[series].indexOf(avgSeries)>=0,calcAvg=processedOptions.avgStepDataCalc=!validAvgSeries,avg=processedOptions.avgStepData=!processedOptions.disableAverage&&(validAvgSeries||calcAvg)?{cv_tt_val:[],cv_tt_pval:[]}:null,prev=processedOptions.prevStepData={cv_tt_val:[],cv_tt_pval:[]},cur=processedOptions.data=processedOptions.curStepData={cv_tt_val:[],cv_tt_pval:[]},txt=processedOptions.txtStepData={cv_label:[]},old={},sum={};if(avg){avg[value]=[];avg[x]=[];avg[series]=[];avg[fnSeriesLabel]=[]}prev[value]=[];prev[x]=[];prev[series]=[];prev[fnSeriesLabel]=[];cur[value]=[];cur[x]=[];cur[series]=[];cur[fnSeriesLabel]=[];txt[value]=[];txt[x]=[];txt[series]=[];txt[fnSeriesLabel]=[];processedOptions.numBarsPerStep=data[series].reduce(function(p,c,i){if(p.indexOf(c)<0&&(processedOptions.disableAverage||c!==avgSeries)){p.push(c)}return p},[]).length;data[value].forEach(function(v,i){var seg=data[series][i],prevValue,prevValueArray=old[seg];if(typeof prevValueArray==="undefined"){old[seg]=prevValueArray=[];prevValue=v}else{prevValue=prevValueArray[prevValueArray.length-1]}var stepId=data[x][i]+self._stepDelimiter+prevValueArray.length;sum[stepId]=sum[stepId]?sum[stepId]+v:v;if(validAvgSeries&&avg&&seg===avgSeries){avg[value].push(v);avg[x].push(stepId);avg[series].push(data[series][i]);avg[fnSeriesLabel].push(processedOptions.avgStepLabel=processedOptions.averageSeriesLabel?processedOptions.averageSeriesLabel:data[seriesLabel][i]);avg["cv_tt_val"].push(v);avg["cv_tt_pval"].push(prevValue);prevValueArray.push(v);return}var g=cur[value].length;prev[value].push(prevValue);cur[value].push(v);txt[value].push(v);txt["cv_label"].push(prevValue?v/prevValue:0);cur["cv_tt_val"][g]=prev["cv_tt_val"][g]=v;cur["cv_tt_pval"][g]=prev["cv_tt_pval"][g]=prevValue;prev[x][g]=cur[x][g]=txt[x][g]=stepId;prev[series][g]=cur[series][g]=txt[series][g]=data[series][i];prev[fnSeriesLabel][g]=cur[fnSeriesLabel][g]=txt[fnSeriesLabel][g]=data[seriesLabel][i];prevValueArray.push(v)});var oldSum=null;if(avg&&calcAvg){processedOptions.averageSeries="cv:fnl:avg"}processedOptions.numSteps=cur[x].reduce(function(p,c,i){if(p.indexOf(c)<0){p.push(c);if(avg&&calcAvg){var v=sum[c]/processedOptions.numBarsPerStep;if(oldSum===null){oldSum=v}avg[value].push(v);avg[x].push(c);avg[series].push(processedOptions.averageSeries);avg[fnSeriesLabel].push(processedOptions.avgStepLabel=processedOptions.averageSeriesLabel?processedOptions.averageSeriesLabel:self.l10n.labels.funnel.average);avg["cv_tt_val"].push(v);avg["cv_tt_pval"].push(oldSum);oldSum=v}}return p},[]).length;var m=Object.create(processedOptions.mappings);m.seriesLabel=fnSeriesLabel;processedOptions.mappings=m};standardAdapters.funnelObj=adapter;standardAdapters.funnel=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,standardAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.standard"),adapter=Object.create(standardAdapters.baseObj),d3=global.d3||{};adapter._processOptions=function(options,changedOptions){Object.getPrototypeOf(adapter)._processOptions.apply(this,arguments)};adapter._validateData=function(data,mappings){if(!data){return false}return true};adapter.data=function(){return this._options.data};standardAdapters.wordcloudObj=adapter;standardAdapters.wordcloud=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.baseObj);adapter._getYFormats=function(data,mappings,values){var y=[];if(!data||!data.metric||!mappings||!mappings["series"]||!values){return y}var len=data.metric.length;for(var i=0;i<len;i++){var metric=data.metric[i],group=data[mappings["series"]],formatIndex=values.indexOf(group[i]);y[formatIndex]=metric.type}return y};adapter.mappings=function(){return this._processedOptions.mappings};adapter.formats=function(){return this._processedOptions.formats};rsAdapters.baseObj=adapter;rsAdapters.base=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.barObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);processedOptions.isOvertime=this._determineOvertime(processedOptions.data);processedOptions.yAxisTitle=options.yAxisTitle||this._getYAxisTitle(processedOptions.data);processedOptions.dateGranularity=this._getTimeGranularity(processedOptions.data);this._processData(processedOptions);this._updateMappings(processedOptions);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions);processedOptions.formats={x:options.formats.x,y:this._getYFormats(processedOptions.data,processedOptions.mappings,this.uniqueFillValues())}};adapter.isOvertime=function(){return this._processedOptions.isOvertime};adapter.xAxisTitle=function(){return null};adapter.yAxisTitle=function(){return this._processedOptions.yAxisTitle};adapter.dateGranularity=function(){return this._processedOptions.dateGranularity};adapter.data=function(){return this._processedOptions.data};adapter.mappings=function(){return this._processedOptions.mappings};adapter.formats=function(){return this._processedOptions.formats};adapter._determineOvertime=function(data){var date=data.date,histogram=data.metric&&data.metric.some(function(m){return m&&m.date_range&&m.date_range.gran!=="*"});return date&&date.length&&histogram};adapter._getYAxisTitle=function(data){return this._getYTitleFromLabels(data.label)};adapter._processData=function(processedOptions){if(processedOptions.isOvertime){return}var d=Object.create(processedOptions.data),i,ii=d.cell.length,cell=null,prev=null;d.group=[];for(i=0;i<ii;++i){prev=cell;cell=d.cell[i];d.group[i]=d.series[i];if(prev&&"incomplete"===cell.status&&"incomplete"!==prev.status){d.group[i]+="::incomplete::"}}processedOptions.data=d};adapter._updateMappings=function(processedOptions){var mappings=Object.create(processedOptions.mappings);if(processedOptions.isOvertime){mappings.x="date";mappings.y="value";mappings.group="group";mappings.series="series";mappings.seriesLabel="series_name"}else{mappings.x="category";mappings.y="value";mappings.series="metric_series";mappings.seriesLabel="metric_series_name"}processedOptions.mappings=mappings};adapter._getTimeGranularity=function(data){return data.metric[0]["date_range"].gran};var base=rsAdapters.baseObj;adapter._getYFormats=base._getYFormats;rsAdapters.bar=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.choroplethObj),d3=global.d3||{};adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);this._processData(processedOptions,options);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter._processData=function(processedOptions,options){var rsdata=options.data,data=rsdata.data,metrics=rsdata.metrics,filters=rsdata.filters,dates=rsdata.dates,filter_ref,date_ref,metric,filter,result={values:{}};for(var m=0,mm=metrics.length;m<mm;++m){metric=metrics[m];filter_ref=metric.filter_ref;date_ref=metric.date_ref;for(var f=0,ff=filter_ref.length;f<ff;++f){filter=filters[filter_ref[f]];for(var d=0,dd=date_ref.length;d<dd;++d){result.values[(filter.info||{}).geo_id]=data[filter_ref[f]][date_ref[d]][m].val}}}processedOptions.data=result;processedOptions.metric=metric.name;processedOptions.format=metric.type};adapter.data=function(){return this._processedOptions.data};adapter.metric=function(){return this._processedOptions.metric};adapter.format=function(){return this._processedOptions.format};adapter._validateData=function(data,mappings){if(!data){return false}return true};adapter.data=function(){return this._processedOptions.data};rsAdapters.choropleth=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.donutObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);this._updateMappings(processedOptions);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions);processedOptions.formats={x:options.formats.x,y:this._getYFormats(processedOptions.data,processedOptions.mappings,this.uniqueFillValues())}};adapter.mappings=function(){return this._processedOptions.mappings};adapter.formats=function(){return this._processedOptions.formats};adapter._updateMappings=function(processedOptions){var mappings=Object.create(processedOptions.mappings);mappings.x="category";mappings.y="value";mappings.series="metric_series";mappings.seriesLabel="metric_series_name";processedOptions.mappings=mappings};var base=rsAdapters.baseObj;adapter._getYFormats=base._getYFormats;rsAdapters.donut=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.lineObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);processedOptions.isOvertime=this._determineOvertime(processedOptions.data);processedOptions.yAxisTitle=options.yAxisTitle||this._getYAxisTitle(processedOptions.data);processedOptions.dateGranularity=this._getTimeGranularity(processedOptions.data);this._updateMappings(processedOptions);this._processMultiMetric(processedOptions);this._processIncompleteData(processedOptions);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions);processedOptions.formats={x:options.formats.x,y:processedOptions.isOvertime?this._getYFormats(processedOptions.data,processedOptions.mappings,this.uniqueStrokeValues()):options.formats.y}};adapter.data=function(){return this._processedOptions.data};adapter.mappings=function(){return this._processedOptions.mappings};adapter.formats=function(){return this._processedOptions.formats};adapter.xAxisTitle=function(){return this._processedOptions.xAxisTitle};adapter.yAxisTitle=function(){return this._processedOptions.yAxisTitle};adapter.isOvertime=function(){return this._processedOptions.isOvertime};adapter.dateGranularity=function(){return this._processedOptions.dateGranularity};adapter._determineOvertime=function(data){var date=data.date,timeSeries=data.metric&&data.metric.some(function(m){return m&&m.date_range&&m.date_range.gran!=="*"});return date&&date.length&&timeSeries};adapter._getYAxisTitle=function(data){return this._getYTitleFromLabels(data.label)};adapter._getTimeGranularity=function(data){return this.isOvertime()?data.metric[0].date_range.gran:"*"};adapter._processMultiMetric=function(processedOptions){if(processedOptions.isOvertime){return}var data=processedOptions.data,pData={series:[]},metrics=[],formats=[],i,ii,metric;for(i=0,ii=data.label.length;i<ii;++i){metric=data.label[i];if(!pData[metric]){metrics.push(metric);if(data.metric&&data.metric.length){formats.push(data.metric[i].type)}else{formats.push(null)}pData[metric]=[]}pData[metric].push(data.value[i]);pData.series[pData[metric].length-1]=data.category[i]}var m={x:metrics[0],y:metrics[1]};var f={x:formats[0],y:{0:formats[1]}};if(data.groups&&data.groups.length&&data.groups[0].length){var g,gg=data.groups.length,item,group=[];for(g=0;g<gg;++g){item=data.groups[g];group[g]=item.join("-")}pData.facet_group=group;m.series="facet_group"}if(metrics.length>2){m.size=metrics[2];f.size=formats[2];processedOptions.sizeMetricName=processedOptions.sizeTitle||metrics[2]}processedOptions.data=pData;processedOptions.mappings=m;processedOptions.formats=f;processedOptions.xAxisTitle=processedOptions.xAxisTitle||metrics[0];processedOptions.yAxisTitle=processedOptions.yAxisTitle||metrics[1]};adapter._updateMappings=function(processedOptions){var mappings=Object.create(processedOptions.mappings);mappings.x="date";mappings.y="value";mappings.group="series";mappings.series="series";mappings.seriesLabel="series_name";processedOptions.mappings=mappings};adapter._processIncompleteData=function(processedOptions){if(!processedOptions.isOvertime||!processedOptions.data.cell){return}if(processedOptions.position==="stack"||processedOptions.position==="fill"){return}var data=processedOptions.data,mappings=processedOptions.mappings,i,ii=data.cell.length,cell=null,prev=null,k,incompleteSeriesExists=false;data.cv_rs_group=data.cv_rs_group||[];for(i=0;i<ii;++i){prev=cell;cell=data.cell[i];data.cv_rs_group[i]=data.cv_rs_group[i]||data.series[i];if(data.cv_rs_group[i].indexOf("::incomplete::")>=0){continue}if(prev&&"incomplete"===cell.status&&"incomplete"!==prev.status){for(k in data){data[k].splice(i,0,data[k][i-1])}data.cv_rs_group[i]+="::incomplete::";++ii;++i}data.cv_rs_group[i]+="incomplete"===cell.status?"::incomplete::":""}mappings.group="cv_rs_group"};var base=rsAdapters.baseObj;adapter._getYFormats=base._getYFormats;rsAdapters.line=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.pointObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);var data=options.data,pData={series:[]},metrics=[],formats=[],i,ii,metric;for(i=0,ii=data.label.length;i<ii;++i){metric=data.label[i];if(!pData[metric]){metrics.push(metric);if(data.metric&&data.metric.length){formats.push(data.metric[i].type)}else{formats.push(null)}pData[metric]=[]}pData[metric].push(data.value[i]);pData.series[pData[metric].length-1]=data.category[i]}var m={x:metrics[0],y:metrics[1]};var f={x:formats[0],y:formats[1]};if(data.groups&&data.groups.length&&data.groups[0].length){var g,gg=data.groups.length,item,group=[];for(g=0;g<gg;++g){item=data.groups[g];group[g]=item.join("-")}pData.group=group;m.series="group"}else{m.series="series"}if(metrics.length>2){m.size=metrics[2];f.size=formats[2];processedOptions.sizeMetricName=options.sizeTitle||metrics[2]}processedOptions.data=pData;processedOptions.mappings=m;processedOptions.formats=f;processedOptions.xAxisTitle=options.xAxisTitle||metrics[0];processedOptions.yAxisTitle=options.yAxisTitle||metrics[1];Object.getPrototypeOf(adapter)._processOptions.apply(this,arguments)};adapter.data=function(){return this._processedOptions.data};adapter.mappings=function(){return this._processedOptions.mappings};adapter.formats=function(){return this._processedOptions.formats};adapter.xAxisTitle=function(){return this._processedOptions.xAxisTitle};adapter.yAxisTitle=function(){return this._processedOptions.yAxisTitle};adapter.sizeMetricName=function(){return this._processedOptions.sizeMetricName};rsAdapters.point=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.pathingObj),maxDepth=4;adapter._processOptions=function(options,changedOptions){var processedOptions=Object.create(options),rsdata=processedOptions.data,pathdata={},dnodes=pathdata.nodes=[],dpaths=pathdata.paths=[],nodesById={},l10n=this.l10n.labels.pathing;function detectEntry(f){return"E"===f}function detectExit(f){return"X"===f}var filter,filterIndex,filterId,filterName,filterChild,filterOp,filterValue,node,nodeId,nodeColumn,isBounce,minimumColumn=0;for(filterIndex in rsdata.filters){filter=rsdata.filters[filterIndex];filterId=this._getFilterId(filter);if(filterId){filterName=filter.info&&filter.info.name||"";filterChild=this._getFilterChild(filter);filterOp=filterChild&&filterChild.op||null;if(filterOp&&filterOp!=="previous"&&filterOp!=="next"){filterChild=filterOp=null}filterValue=filterChild&&filterChild.val?[].concat(filterChild.val):[];nodeColumn=0;if("previous"===filterOp){if(filterValue.some(detectEntry)){var entryId="E_0";if(!nodesById[entryId]){node={label:l10n.entry,id:entryId,column:nodeColumn,index:dnodes.length,filters:[]};dnodes[dnodes.length]=node;nodesById[entryId]=node}}nodeColumn=filterValue.length}if("next"===filterOp){if(filterValue.some(detectExit)){var exitId="X_0";if(!nodesById[exitId]){node={label:l10n.exit,id:exitId,column:nodeColumn,index:dnodes.length,filters:[]};dnodes[dnodes.length]=node;nodesById[exitId]=node}}nodeColumn=0-filterValue.length}nodeId=filterId+"_"+nodeColumn;if(nodesById[nodeId]){nodesById[nodeId].filters.push(filter);continue}isBounce="0"===String(filterId)&&(l10n.exit===String(filterName)||l10n.entry===String(filterName));if(isBounce){continue}else if("0"===String(filterId)){continue}node={label:filterName,id:nodeId,column:nodeColumn,index:dnodes.length,filters:[filter]};dnodes[dnodes.length]=node;minimumColumn=Math.min(minimumColumn,nodeColumn);nodesById[nodeId]=node}}if(0!==minimumColumn){for(var n in dnodes){node=dnodes[n];node.column-=minimumColumn}}var metric,filterRef,dateRef,dateIndex,m,mm,f,ff,d,dd,date,cell,nodes;for(m=0,mm=rsdata.metrics.length;m<mm;++m){metric=rsdata.metrics[m];filterRef=metric.filter_ref;dateRef=metric.date_ref;for(f=0,ff=filterRef.length;f<ff;++f){filterIndex=filterRef[f];filter=rsdata.filters[filterIndex];for(d=0,dd=dateRef.length;d<dd;++d){dateIndex=dateRef[d];date=rsdata.dates[dateIndex];cell=rsdata.data[filterIndex][dateIndex][m];if("invalid"===cell.status){continue}if(node=this._getSingleNode(filter,nodesById)){node.total=+cell.val;continue}nodes=this._createPath(filter,nodesById);if(!nodes||!nodes.length){continue}dpaths[dpaths.length]={nodes:nodes,values:+cell.val||0}}}}dpaths.sort(function(a,b){return b.nodes.length-a.nodes.length});var i,ii,j,jj,path,otherPath;for(i=0,ii=dpaths.length;i<ii;++i){path=dpaths[i];for(j=0,jj=dpaths.length;j<jj;++j){if(i===j){continue}otherPath=dpaths[j];if(otherPath.nodes.length===path.nodes.length){continue}if(-1!==this._getPathString(path.nodes).indexOf(this._getPathString(otherPath.nodes))){otherPath.values-=path.values}}}pathdata.paths=dpaths=dpaths.filter(function(p){return p.values});processedOptions.data=pathdata;var metrics=options.data.metrics;processedOptions.pathingTitle=metrics&&metrics.length&&metrics[0].name;Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter.nodeKey=function(){return function(d,i){return d.id}};adapter.linkKey=function(){return function(d,i){return(d.source?d.source.id:"null")+"-"+(d.target?d.target.id:"null")}};adapter.pathingTitle=function(){return this._processedOptions.pathingTitle};adapter.getPathEnd=function(path){if(!path||!path.nodes||!path.nodes.length){return null}if(path.nodes.length===1){return path.nodes[0]}var nodes=path.nodes,data=this._processedOptions.data,byId=data.nodesById,start=byId[nodes[0]],end=byId[nodes[nodes.length-1]];function isEnd(n){return n&&(n.isPivot||n.id==="E_0"||n.id==="X_0")}if(isEnd(start)){return start}if(isEnd(end)){return end}return null};adapter.getPathDirection=function(path){var end=this.getPathEnd(path);if(!end){return 0}return end._pid===path.nodes[0]?1:-1};adapter.activePathsTitle=function(paths){if(!paths||!paths.length){return""}var end=this.getPathEnd(paths[0]),l10n=this.l10n.labels.pathing;if(!end){return l10n["path2+"]}var pattern=this.getPathDirection(paths[0])===1?l10n.pathFromNode:l10n.pathToNode;return pattern.replace(/\{path\}/i,paths.length>1?l10n["path2+"]:l10n["path"]).replace(/\{label\}/i,end.label)};adapter._getSingleNode=function(filter,byId){var id=this._getFilterId(filter),def=filter.filter_def&&filter.filter_def.length&&filter.filter_def[0]||null,op=def&&def.op||null,child=this._getFilterChild(filter),childOp=child&&child.op||null;if("select"!==op&&"equals"!==op&&"id"!==op||"previous"===childOp||"next"===childOp){return false}return byId[id+"_0"]};adapter._getPathString=function(path){return path.map(function(p){return null===p?"null":p}).toString()};adapter._createPath=function(f,byId){var id=this._getFilterId(f),child=this._getFilterChild(f),op=child&&child.op||null;if(op&&op!=="previous"&&op!=="next"){return[]}var values=child&&child.val?[].concat(child.val):[];if(!values.length){return values}var prev="previous"===child.op,bounce="0"===id,c=prev?0:bounce?0-values.length+1:0-values.length,nodes=[];if(prev){values.push(id)}else{values.unshift(id)}return this._mapNodeIds(c,values,byId)};adapter._mapNodeIds=function(c,ids,byId){if(!isFinite(c)||!byId){return[]}c=+c;var validValue=false,missingValue=false,nodeId,mapped=ids&&ids.map&&ids.map(function(n){if("0"===n){return null}nodeId=n+"_"+c;if(!byId[nodeId]){missingValue=true;return null}++c;validValue=true;return+byId[nodeId].index});return validValue&&!missingValue?mapped:[]};adapter._getFilterId=function(filter){return filter.info&&(filter.info.id||filter.info.id===0)?filter.info.id+"":null};adapter._getFilterChild=function(filter){var def=filter.filter_def&&filter.filter_def.length&&filter.filter_def[0]||null;return def&&def.child&&def.child.length&&def.child[0]||null};adapter.canExpandNode=function(node){var enters=node.entryLinks.length+node.targetLinks.length,exits=node.exitLinks.length+node.sourceLinks.length,column=Math.abs(parseInt(node.id.split("_")[1],10));if(column>=maxDepth){return false}if(exits&&node.id==="E_0"){return false}if(enters&&node.id==="X_0"){return false}if(!enters||!exits){return true}return false};adapter.canCollapseNode=function(node){var enters=node.entryLinks.length+node.targetLinks.length,exits=node.exitLinks.length+node.sourceLinks.length,column=parseInt(node.id.split("_")[1],10);if(node.id==="E_0"||node.id==="X_0"){return false}return 0===column&&(exits||enters)||column>0&&exits||column<0&&enters};adapter.canPivotNode=function(node){var enters=node.entryLinks.length+node.targetLinks.length,exits=node.exitLinks.length+node.sourceLinks.length,column=Math.abs(parseInt(node.id.split("_")[1],10));if(column!==0){return true}var data=this.data(),columns=data.nodes.map(function(d){return parseInt(d.id.split("_")[1],10)}),zeroCount=0;if(columns.some(function(c){if(c===0){zeroCount++}return zeroCount>1?true:false})){return true}return false};rsAdapters.pathingObj=adapter;rsAdapters.pathing=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.sunburstObj);adapter._processOptions=function(options,changedOptions){var prevOptions=this._processedOptions,processedOptions=this._processedOptions=Object.create(options);function getPartitionFilters(def){var val=def&&def.op==="id"?[def.val]:[];if(def&&def.child&&def.child[0]){return getPartitionFilters(def.child[0]).concat(val)}return val}function filterDefHasChild(def){if(def&&def.child&&def.child[0]){return filterDefHasChild(def.child[0])+1}return 0}function getFilterDepth(filter){var def=filter&&filter.filter_def&&filter.filter_def[0]||null;return filterDefHasChild(def)}function sortPartitions(a,b){var aDepth=getFilterDepth(a.filter),bDepth=getFilterDepth(b.filter);if(aDepth===bDepth){return b.cell[0].val-a.cell[0].val}return aDepth-bDepth}var rsdata=options.data,metric,filterRef,dateRef,dateIndex,f,ff,d,dd,partition,partitions,date,cell,nodes,filter,filterIndex,data={children:[],categories:[],metrics:rsdata.metrics.map(function(m,i){return{id:m.id,icon:m.icon,name:m.name||m.id,format:m.type,categories:[]}})};if(metric=rsdata.metrics[0]){partitions=[];filterRef=metric.filter_ref;dateRef=metric.date_ref;for(f=0,ff=filterRef.length;f<ff;++f){filterIndex=filterRef[f];filter=rsdata.filters[filterIndex];for(d=0,dd=dateRef.length;d<dd;++d){dateIndex=dateRef[d];date=rsdata.dates[dateIndex];cell=rsdata.data[filterIndex][dateIndex];if(!cell[0]||"invalid"===cell[0].status){continue}if(filter.info&&filter.info.id===0){continue}partitions.push({filter:filter,cell:cell})}}partitions.sort(sortPartitions);var partitionById={},parent_pid,parent_partition,def,pFilters,level;partitions.forEach(function(partition){filter=partition.filter;cell=partition.cell;def=filter&&filter.filter_def&&filter.filter_def[0]||null;pFilters=getPartitionFilters(def),level=pFilters.length,parent_pid=pFilters.join("-");if(!parent_pid.length&&!filter.info){cell.forEach(function(c,i){data.metrics[i].value=+c.val});return}partition={id:filter.info.id,pid:parent_pid?parent_pid+"-"+filter.info.id:filter.info.id,name:filter.info.name,metrics:cell.map(function(c){return{value:+c.val}}),category:filter.info.category||def&&def["var"]||undefined,filtervar:def&&def["var"]||undefined,children:[]};if(filter.info.orig_name){partition.orig_name=filter.info.orig_name}cell.forEach(function(c,i){var m=data.metrics[i];m.min="undefined"!==typeof m.min?Math.min(m.min,+c.val):+c.val;m.max="undefined"!==typeof m.max?Math.max(m.max,+c.val):+c.val;var catLevel;if(!(catLevel=m.categories[level])){m.categories[level]={min:+c.val,max:+c.val}}else{catLevel.min=Math.min(catLevel.min,+c.val);catLevel.max=Math.max(catLevel.max,+c.val)}});if(parent_pid&&(parent_partition=partitionById[parent_pid])){parent_partition.children.push(partition)}else if(!pFilters.length){data.children.push(partition)}else{return}partitionById[partition.pid]=partition;data.categories[level]={name:filter.info.category||def&&def["var"]||data.categories[level]}})}processedOptions.data=data;Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions,prevOptions)};adapter._validateData=function(data){if(!data){return false}for(var key in data){if(data[key].length){return true}}return false};adapter.getPathKey=function(d,i){if(!d||!d._sid){return 0}if(!d.pid){return d._sid}return d.pid};rsAdapters.sunburst=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.flowerObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);processedOptions.data=this._parseData(options.data);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter._parseData=function(data){if(!data.metric.length){return[]}var result=[],metric_id=data.metric[0].id;dv.util.each(data.metric,function(o,k){if(o.id!=metric_id){return}var filter_name=data.filter[k].info.name;var value=data.value[k];result.push({index:filter_name.toLowerCase(),label:filter_name,value:value})});return result};adapter.formats=function(){return this._processedOptions.formats};rsAdapters.flower=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.funnelObj);adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);this._processData(processedOptions);this._updateMappings(processedOptions);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions);processedOptions.formats={x:options.formats.x,y:this._getYFormats(processedOptions.data,processedOptions.mappings,this.uniqueFillValues())}};adapter.data=function(){return this._processedOptions.data};adapter.mappings=function(){return this._processedOptions.mappings};adapter.formats=function(){return this._processedOptions.formats};adapter._processData=function(processedOptions){processedOptions.data=Object.create(processedOptions.data)};adapter._updateMappings=function(processedOptions){var mappings=Object.create(processedOptions.mappings);mappings.x="category";mappings.y="value";mappings.series="metric_series";mappings.seriesLabel="metric_series_name";processedOptions.mappings=mappings};var base=rsAdapters.baseObj;adapter._getYFormats=base._getYFormats;rsAdapters.funnel=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";var cloudViz=global.cloudViz,rsAdapters=cloudViz.util.namespace("cloudViz.dataAdapter.rs"),adapter=Object.create(cloudViz.dataAdapter.standard.wordcloudObj),d3=global.d3||{};adapter._processOptions=function(options,changedOptions){var processedOptions=this._processedOptions=Object.create(options);this._processData(processedOptions,options);Object.getPrototypeOf(adapter)._processOptions.call(this,processedOptions,changedOptions)};adapter._processData=function(processedOptions,options){processedOptions.data=options.data};adapter.data=function(){return this._processedOptions.data};adapter._validateData=function(data,mappings){if(!data){return false}return true};adapter.data=function(){return this._processedOptions.data};rsAdapters.wordcloud=cloudViz.util.createConstructor(adapter)})(this);(function(global){"use strict";global.cloudViz.localeDefinition("de-DE",{monthAbbreviations:["Jan","Feb","Mrz","Apr","Mai","Juni","Juli","Aug","Sep","Okt","Nov","Dez"],months:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],weekdayAbbreviations:["So","Mo","Di","Mi","Do","Fr","Sa"],weekdays:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],ampm:["AM","PM"]},"calendar");global.cloudViz.localeDefinition("de-DE",{core:{nodata:"Das Diagramm enthlt keine Daten.",erroronrender:"Hoppla! Ein Fehler ist aufgetreten und das Diagramm konnte nicht gerendert werden.",other:"Sonstige",normalized:"Normalisiert"},dvcore:{target:"Zielgruppe",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (in {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Gre"},pathing:{entry:"Einstieg",exit:"Ausstieg","entry2+":"Einstiege","exit2+":"Ausstiege",path:"Pfad","path2+":"Pfade",expand:"Erweitern",focus:"Fokus",collapse:"Reduzieren",title:"Pfaderstellungs-diagramm",nodeEntries:"Einstiege fr {label}",nodeExits:"Ausstiege fr {label}",nodeToNode:"{source}  {target}",percOfNode:"{perc} von {label}",pathToNode:"{path} zu {label}",pathFromNode:"{path} aus {label}",help1:"Dieses Diagramm stellt Pfade dar, die von einem Status in einen anderen bernommen wurden.",help2:"Jeder Knoten in Form eines Feldes reprsentiert einen Status im Pfad.",help3:"Durch Tippen oder Klicken auf einen Knoten werden zustzliche Optionen zum ndern des Diagramms angezeigt:",focusHelp:"Zeigt Pfade an, die am Knoten ein- oder ausgehen.",expandHelp:"Zeigt zustzliche Pfade an, die am Knoten ein- oder ausgehen.",collapseHelp:"Entfernt Pfade, die am Knoten ein- oder ausgehen."},sunburst:{audience:"Zielgruppe","audience2+":"Zielgruppen",category:"Kategorie","category2+":"Kategorien",metric:"Metrik","metric2+":"Metriken",primarymetric:"Primre Metrik",secondarymetric:"Sekundre Metrik","secondarymetric2+":"Sekundre Metriken",secondarymetrichelp:"Klicken Sie auf die Metrik, um die Hhe zu ndern.","secondarymetrichelp2+":"Klicken Sie auf die Metriken, um die Hhe zu ndern.",emptyFirstMetric:"Die erste Metrik enthlt keine Werte. Whlen Sie eine andere Metrik.",total:"Gesamt",zoomAction:"Doppelklicken, um zu vergrern.",moreAction:"Klicken Sie hier fr weitere Optionen.",zoomin:"Nahansicht",zoomout:"Weitansicht",hide:"Ausblenden",hideall:"Alles ausblenden",hideother:"Sonstige ausblenden",hidden:"{value} verborgenes Element","hidden2+":"{value} verborgene Elemente",topresults:"Top {value}",color:"Farbe",height:"Hhe",both:"Beide",none:"Keine",mapmetric:"{metric} anzeigen als:",percmetric:"{percent} der {metric}",mobilescroll:"&#x25BC  scrollen Sie, um Details anzuzeigen."},flower:{joy:"Freude",admiration:"Bewunderung",fear:"Angst",surprise:"berraschung",sadness:"Traurigkeit",disgust:"Emprung",anger:"Wut",anticipation:"Vorausschtzung"},venn:{definedAudience:"Definierte Zielgruppe"},donut:{precalculated:"Im Voraus berechnet"},bar:{max:"Max.",min:"Min.",mean:"Arithmetisches Mittel",median:"Median"},funnel:{step:"Schritt",segment:"Segment",conversion:"Konversion",fallout:"Trichteranalyse",average:"Durchschnitt"}},"labels");global.cloudViz.localeDefinition("de-DE",{shortFormat:{second:":%S",minute:"%H:%M",hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%H:%M",hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{second:"%M:%S",minute:"%H:%M",hour:"%H Uhr %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%H Uhr %a %e"},fullFormat:{second:"%H:%M:%S",minute:"%H:%M Uhr %a %e",hour:"%H Uhr %a %e",day:"%A, %e. %B",week:"%A, %e. %B",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b, %Y",condensed:"%d/%m/%Y",timestamp:"%d %m.%Y %H:%M:%S"}},"dateFormat");global.cloudViz.localeDefinition("de-DE",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");global.cloudViz.localeDefinition("de-DE",{singular:{second:"Sekunde",minute:"Minute",hour:"Stunde",day:"Tag",week:"Woche",month:"Monat",year:"Jahr"},plural:{second:"Sekunden",minute:"Minuten",hour:"Stunden",day:"Tagen",week:"Wochen",month:"Monate",year:"Jahre"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("it-IT",{monthAbbreviations:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],weekdayAbbreviations:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],weekdays:["Domenica","Luned","Marted","Mercoled","Gioved","Venerd","Sabato"],ampm:["AM","PM"]},"calendar");global.cloudViz.localeDefinition("it-IT",{core:{nodata:"Il grafico non contiene dati",erroronrender:"Si  verificato un errore, impossibile effettuare il rendering del grafico.",other:"Altro",normalized:"Normalizzato"},dvcore:{target:"Target",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (in {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Dimensione"},pathing:{entry:"Entrata",exit:"Uscita","entry2+":"Voci","exit2+":"Uscite",path:"Percorso","path2+":"Percorsi",expand:"Espandi",focus:"Focalizzazione",collapse:"Comprimi",title:"Grafico percorsi",nodeEntries:"{label} voci",nodeExits:"{label} uscite",nodeToNode:"{source}  {target}",percOfNode:"{perc} di {label}",pathToNode:"{path} a {label}",pathFromNode:"{path} da {label}",help1:"Questo grafico rappresenta i percorsi da uno stato a un altro.",help2:"Ogni nodo, a forma di casella, rappresenta uno stato all'interno del percorso.",help3:"Con un tocco o un clic su un nodo vengono visualizzate ulteriori opzioni per la modifica del grafico:",focusHelp:"Mostra i percorsi che entrano ed escono dal nodo",expandHelp:"Mostra ulteriori percorsi che arrivano al nodo o partono da esso",collapseHelp:"Rimuove i percorsi che arrivano al nodo o partono da esso"},sunburst:{audience:"Pubblico","audience2+":"Pubblico",category:"Categoria","category2+":"Categorie",metric:"Metrica","metric2+":"Metriche",primarymetric:"Metrica principale",secondarymetric:"Metrica secondaria","secondarymetric2+":"Metriche secondarie",secondarymetrichelp:"Fai clic sulla metrica per alternare l'altezza","secondarymetrichelp2+":"Fai clic sulla metrica per alternare l'altezza",emptyFirstMetric:"La prima metrica  priva di valori. Scegli una metrica diversa.",total:"Totale",zoomAction:"Fai doppio clic per ingrandire.",moreAction:"Fai clic per visualizzare altre opzioni.",zoomin:"Zoom avanti",zoomout:"Zoom indietro",hide:"Nascondi",hideall:"Nascondi tutto",hideother:"Nascondi altro",hidden:"{value} elemento nascosto","hidden2+":"{value} elementi nascosti",topresults:"primi {value}",color:"Colore",height:"Altezza",both:"Entrambi",none:"Nessuno",mapmetric:"Mostra {metric} come:",percmetric:"{percent} di {metric}",mobilescroll:"Scorri &#x25BC per visualizzare i dettagli"},flower:{joy:"Gioia",admiration:"Ammirazione",fear:"Timore",surprise:"Sorpresa",sadness:"Tristezza",disgust:"Disgusto",anger:"Rabbia",anticipation:"Attesa"},venn:{definedAudience:"Pubblico definito"},donut:{precalculated:"Precalcolato"},bar:{max:"Max.",min:"Min.",mean:"Media",median:"Mediana"},funnel:{step:"Incremento",segment:"Segmento",conversion:"Conversione",fallout:"Abbandono",average:"Media"}},"labels");global.cloudViz.localeDefinition("it-IT",{shortFormat:{second:":%S",minute:"%I:%M",hour:"%I %p",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%I:%M %p",hour:"%I %p",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{second:"%M:%S",minute:"%I:%M %p",hour:"%I %p %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%I %p %a %e"},fullFormat:{second:"%I:%M:%S %p",minute:"%I:%M %p %a %e",hour:"%I %p %a %e",day:"%A %e %B",week:"%A %e %B",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b %Y",condensed:"%d/%m/%Y",timestamp:"%d/%m/%Y %I:%M:%S %p"}},"dateFormat");global.cloudViz.localeDefinition("it-IT",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"$",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"}},"numberFormat");global.cloudViz.localeDefinition("it-IT",{singular:{second:"secondo",minute:"minuto",hour:"ora",day:"giorno",week:"settimana",month:"mese",year:"anno"},plural:{second:"secondi",minute:"minuti",hour:"ore",day:"giorni",week:"settimane",month:"mesi",year:"anni"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"s",month:"mese",year:"y"}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("en-US",{monthAbbreviations:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdayAbbreviations:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ampm:["AM","PM"]},"calendar");global.cloudViz.localeDefinition("en-US",{core:{nodata:"The chart has no data",erroronrender:"Oops! There was an error and the chart could not be rendered.",other:"Other",normalized:"Normalized"},dvcore:{target:"Target",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (in {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Size"},pathing:{entry:"Entry",exit:"Exit","entry2+":"Entries","exit2+":"Exits",path:"Path","path2+":"Paths",expand:"Expand",focus:"Focus",collapse:"Collapse",title:"Pathing Chart",nodeEntries:"{label} Entries",nodeExits:"{label} Exits",nodeToNode:"{source}  {target}",percOfNode:"{perc} of {label}",pathToNode:"{path} to {label}",pathFromNode:"{path} from {label}",help1:"This chart represents paths taken from one state to another.",help2:"Each node, shaped as a box, represents a state in the path.",help3:"Tapping or clicking a node will provide additional options to modify the chart:",focusHelp:"Shows paths coming into and going out of node",expandHelp:"Shows additional paths coming or going from the node",collapseHelp:"Removes paths coming or going from the node"},sunburst:{audience:"Audience","audience2+":"Audiences",category:"Category","category2+":"Categories",metric:"Metric","metric2+":"Metrics",primarymetric:"Primary Metric",secondarymetric:"Secondary Metric","secondarymetric2+":"Secondary Metrics",secondarymetrichelp:"Click metric to toggle height","secondarymetrichelp2+":"Click metrics to toggle height",emptyFirstMetric:"The first metric has no values. Please pick a different metric.",total:"Total",zoomAction:"Double-click to Zoom in.",moreAction:"Click for more options.",zoomin:"Zoom In",zoomout:"Zoom Out",hide:"Hide",hideall:"Hide All",hideother:"Hide Other",hidden:"{value} Hidden Item","hidden2+":"{value} Hidden Items",topresults:"top {value}",color:"Color",height:"Height",both:"Both",none:"None",mapmetric:"Show {metric} as:",percmetric:"{percent} of {metric}",mobilescroll:"&#x25BC scroll for details"},flower:{joy:"Joy",admiration:"Admiration",fear:"Fear",surprise:"Surprise",sadness:"Sadness",disgust:"Disgust",anger:"Anger",anticipation:"Anticipation"},venn:{definedAudience:"Defined Audience"},donut:{precalculated:"Precalculated"},bar:{max:"Max",min:"Min",mean:"Mean",median:"Median"},funnel:{step:"Step",segment:"Segment",conversion:"Conversion",fallout:"Fallout",average:"Average"}},"labels");global.cloudViz.localeDefinition("en-US",{shortFormat:{second:":%S",minute:"%I:%M",hour:"%I %p",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%I:%M %p",hour:"%I %p",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{second:"%M:%S",minute:"%I:%M %p",hour:"%I %p %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%I %p %a %e"},fullFormat:{second:"%I:%M:%S %p",minute:"%I:%M %p %a %e",hour:"%I %p %a %e",day:"%A %e %B",week:"%A %e %B",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%b %e, %Y",condensed:"%m/%d/%Y",timestamp:"%m/%d/%Y %I:%M:%S %p"}},"dateFormat");global.cloudViz.localeDefinition("en-US",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"$",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");global.cloudViz.localeDefinition("en-US",{singular:{second:"second",minute:"minute",hour:"hour",day:"day",week:"week",month:"month",year:"year"},plural:{second:"seconds",minute:"minutes",hour:"hours",day:"days",week:"weeks",month:"months",year:"years"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("es-ES",{monthAbbreviations:["en.","febr.","mzo.","abr.","my.","jun.","jul.","ag.","sept.","oct.","nov.","dic."],months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],weekdayAbbreviations:["dom.","lun.","mart.","mirc.","juev.","vier.","sb."],weekdays:["domingo","lunes","martes","mircoles","jueves","viernes","sbado"],ampm:["a. m.","p. m."]},"calendar");global.cloudViz.localeDefinition("es-ES",{core:{nodata:"El grfico no contiene datos",erroronrender:"Se ha producido un error y no se ha podido procesar el grfico.",other:"Otro",normalized:"Normalizado"},dvcore:{target:"Destino",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (en {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Tamao"},pathing:{entry:"Entrada",exit:"Salida","entry2+":"Entradas","exit2+":"Salidas",path:"Ruta","path2+":"Rutas",expand:"Expandir",focus:"Enfoque",collapse:"Contraer",title:"Grfico de ruta",nodeEntries:"Entradas de {label}",nodeExits:"Salidas de {label}",nodeToNode:"{source}  {target}",percOfNode:"{perc} de {label}",pathToNode:"{path} a {label}",pathFromNode:"{path} de {label}",help1:"Este grfico representa las rutas que se pueden tomar para ir de un estado a otro.",help2:"Los nodos, con forma de caja, representan un estado en la ruta.",help3:"Al hacer clic o tocar un nodo, se mostrarn opciones adicionales para modificar el grfico:",focusHelp:"Muestra las rutas de ida al nodo o de vuelta",expandHelp:"Muestra rutas adicionales de ida al nodo o de vuelta",collapseHelp:"Suprime las rutas de ida al nodo o de vuelta"},sunburst:{audience:"Audiencia","audience2+":"Audiencias",category:"Categora","category2+":"Categoras",metric:"Mtrica","metric2+":"Mtrica",primarymetric:"Mtrica principal",secondarymetric:"Mtrica secundaria","secondarymetric2+":"Mtricas secundarias",secondarymetrichelp:"Haga clic en la mtrica para alternar la altura","secondarymetrichelp2+":"Haga clic en las mtricas para alternar la altura",emptyFirstMetric:"La primera mtrica no contiene ningn valor. Elija otra mtrica.",total:"Total",zoomAction:"Doble clic para aumentar.",moreAction:"Haga clic para ver ms opciones.",zoomin:"Acercar",zoomout:"Alejar",hide:"Ocultar",hideall:"Ocultar todo",hideother:"Ocultar otro",hidden:"{value} elemento oculto","hidden2+":"{value} elementos ocultos",topresults:"{value} principales",color:"Color",height:"Altura",both:"Ambos",none:"Ninguno",mapmetric:"Mostrar {metric} como:",percmetric:"{percent} de {metric}",mobilescroll:"&#x25BC desplcese para ms detalles"},flower:{joy:"Alegra",admiration:"Admiracin",fear:"Miedo",surprise:"Sorpresa",sadness:"Tristeza",disgust:"Desagrado",anger:"Enfado",anticipation:"Expectacin"},venn:{definedAudience:"Audiencia definida"},donut:{precalculated:"Calculado previamente"},bar:{max:"Mx.",min:"Mn.",mean:"Promedio",median:"Mediana"},funnel:{step:"Paso",segment:"Segmento",conversion:"Conversin",fallout:"Visita en el orden previsto",average:"Promedio"}},"labels");global.cloudViz.localeDefinition("es-ES",{shortFormat:{second:":%S",minute:"%H:%M",hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%H:%M",hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{second:"%M:%S",minute:"%H:%M",hour:"%Hh %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%Hh %a %e"},fullFormat:{second:"%H:%M:%S",minute:"%H:%M %a %e",hour:"%Hh %I %p",day:"%A %e de %B",week:"%A %e de %B",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b, %Y",condensed:"%d/%m/%Y",timestamp:"%d/%m/%Y %H:%M:%S"}},"dateFormat");global.cloudViz.localeDefinition("es-ES",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");global.cloudViz.localeDefinition("es-ES",{singular:{second:"segundo",minute:"minuto",hour:"hora",day:"da",week:"semana",month:"mes",year:"ao"},plural:{second:"segundos",minute:"minutos",hour:"horas",day:"das",week:"semanas",month:"meses",year:"aos"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("fr-FR",{monthAbbreviations:["Janv.","Fvr.","Mars","Avr.","Mai","Juin","Juill.","Aot","Sept.","Oct.","Nov.","Dc."],months:["janvier","fvrier","mars","avril","mai","juin","juillet","aot","septembre","octobre","novembre","dcembre"],weekdayAbbreviations:["Dim.","Lun.","Mar.","Mer.","Jeu.","Ven.","Sam."],weekdays:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],ampm:["AM","PM"]},"calendar");global.cloudViz.localeDefinition("fr-FR",{core:{nodata:"Le graphique ne contient aucune donne",erroronrender:"Une erreur sest produite, impossible de restituer le graphique.",other:"Autre",normalized:"Normalis"},dvcore:{target:"Cible",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (en {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Taille"},pathing:{entry:"Entre",exit:"Sortie","entry2+":"Entres de","exit2+":"Sorties de",path:"Chemin daccs","path2+":"Chemins daccs",expand:"Dvelopper",focus:"Mise au point",collapse:"Rduire",title:"Graphique du cheminement",nodeEntries:"Entres {label}",nodeExits:"Sorties {label}",nodeToNode:"{source}  {target}",percOfNode:"{perc} de {label}",pathToNode:"{path}  {label}",pathFromNode:"{path} de {label}",help1:"Ce graphique reprsente les chemins daccs rcuprs dun tat  un autre.",help2:"Chaque nud, en forme de cadre, reprsente un tat dans le chemin daccs.",help3:"Le fait dappuyer ou de cliquer sur un nud fournit dautres options pour modifier le graphique:",focusHelp:"Prsente les chemins daccs issus du nud ou y parvenant",expandHelp:"Prsente des chemins daccs supplmentaires issus du nud ou y parvenant.",collapseHelp:"Supprime les chemins daccs supplmentaires issus du nud ou y parvenant."},sunburst:{audience:"Audience","audience2+":"Audiences",category:"Catgorie","category2+":"Catgories",metric:"Mesure","metric2+":"Mesures",primarymetric:"Mesure principale",secondarymetric:"Mesure secondaire","secondarymetric2+":"Mesures secondaires",secondarymetrichelp:"Cliquer sur une mesure pour activer/dsactiver la hauteur","secondarymetrichelp2+":"Cliquer sur des mesures pour activer/dsactiver la hauteur",emptyFirstMetric:"La premire mesure na aucune valeur. Slectionnez une autre mesure.",total:"Total",zoomAction:"Double-cliquez pour effectuer un zoom avant.",moreAction:"Cliquez pour plus doptions.",zoomin:"Zoom avant",zoomout:"Zoom arrire",hide:"Masquer",hideall:"Tout masquer",hideother:"Masquer autres",hidden:"{value} lment masqu","hidden2+":"{value} lments masqus",topresults:"{value} premiers",color:"Couleur",height:"Hauteur",both:"Les deux",none:"Nant",mapmetric:"Afficher {metric} comme:",percmetric:"{percent} des {metric}",mobilescroll:"Dfilement &#x25BC pour plus de dtails"},flower:{joy:"Joie",admiration:"Admiration",fear:"Peur",surprise:"Surprise",sadness:"Tristesse",disgust:"Dgot",anger:"Colre",anticipation:"Anticipation"},venn:{definedAudience:"Audience dfinie"},donut:{precalculated:"Prcalculs"},bar:{max:"Max.",min:"Min.",mean:"Moyenne",median:"Mdiane"},funnel:{step:"Etape",segment:"Segment",conversion:"Conversion",fallout:"Abandons",average:"Moyenne"}},"labels");global.cloudViz.localeDefinition("fr-FR",{shortFormat:{second:":%S",minute:"%H:%M",hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%H:%M",hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{second:"%M:%S",minute:"%H:%M",hour:"%H h %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%H h %a %e"},fullFormat:{second:"%H:%M:%S",minute:"%H:%M %a %e",hour:"%H h %a %e",day:"%A %e %B",week:"%A %e %B",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b %Y",condensed:"%d/%m/%Y",timestamp:"%d/%m/%Y %H:%M:%S"}},"dateFormat");global.cloudViz.localeDefinition("fr-FR",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");global.cloudViz.localeDefinition("fr-FR",{singular:{second:"seconde",minute:"minute",hour:"heure",day:"jour",week:"semaine",month:"mois",year:"anne"},plural:{second:"secondes",minute:"minutes",hour:"heures",day:"jours",week:"semaines",month:"mois",year:"annes"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("ja-JP",{monthAbbreviations:["1","2","3","4","5","6","7","8","9","10","11","12"],months:["1","2","3","4","5","6","7","8","9","10","11","12"],weekdayAbbreviations:["","","","","","",""],weekdays:["","","","","","",""],ampm:["",""]},"calendar");global.cloudViz.localeDefinition("ja-JP",{core:{nodata:"",erroronrender:"",other:"",normalized:""},dvcore:{target:"Target",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} ({time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Size"},pathing:{entry:"",exit:"","entry2+":"","exit2+":"",path:"","path2+":"",expand:"",focus:"",collapse:"",title:"",nodeEntries:"{label} ",nodeExits:"{label} ",nodeToNode:"{source}  {target}",percOfNode:"{label}{perc}",pathToNode:"{label}{path}",pathFromNode:"{label}{path}",help1:"",help2:"",help3:"",focusHelp:"",expandHelp:"",collapseHelp:""},sunburst:{audience:"","audience2+":"",category:"","category2+":"",metric:"","metric2+":"",primarymetric:"",secondarymetric:"","secondarymetric2+":"",secondarymetrichelp:"","secondarymetrichelp2+":"",emptyFirstMetric:"",total:"",zoomAction:"",moreAction:"",zoomin:"",zoomout:"",hide:"",hideall:"",hideother:"",hidden:"{value} ","hidden2+":"{value} ",topresults:"{value}",color:"",height:"",both:"",none:"",mapmetric:"{metric}:",percmetric:"{metric}{percent}",mobilescroll:"&#x25BC "},flower:{joy:"",admiration:"",fear:"",surprise:"",sadness:"",disgust:"",anger:"",anticipation:""},venn:{definedAudience:""},donut:{precalculated:""},bar:{max:"",min:"",mean:"",median:""},funnel:{step:"",segment:"",conversion:"",fallout:"",average:""}},"labels");global.cloudViz.localeDefinition("ja-JP",{shortFormat:{second:":%S",minute:"%I  %M ",hour:"%p %I ",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%p %I  %M ",hour:"%p %I ",day:"%e  (%a)",week:"%e  (%a)",month:"%b",quarter:"%b",year:"%Y",fallback:"%e  (%a)"},longFormat:{second:"%M:%S",minute:"%p %I  %M ",hour:"%e  (%a) %p %I ",day:"%e  (%a)",week:"%e  (%a)",month:"%B",quarter:"%B",year:"%Y",fallback:"%e  (%a) %p %I "},fullFormat:{second:"%p %I  %M  %S ",minute:"%e  (%a) %p %I  %M ",hour:"%e  (%a) %p %I ",day:"%B %e%A",week:"%B %e%A",month:"%Y  %B",quarter:"%Y  %B",year:"%Y",fallback:"%Y  %b %e ",condensed:"%Y/%m/%d",timestamp:"%Y  %m  %d %p %I  %M  %S "}},"dateFormat");global.cloudViz.localeDefinition("ja-JP",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");global.cloudViz.localeDefinition("ja-JP",{singular:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},plural:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},abbreviation:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("ko-KR",{monthAbbreviations:["1","2","3","4","5","6","7","8","9","10","11","12"],months:["1","2","3","4","5","6","7","8","9","10","11","12"],weekdayAbbreviations:["","","","","","",""],weekdays:["","","","","","",""],ampm:["",""]},"calendar");global.cloudViz.localeDefinition("ko-KR",{core:{nodata:"  .",erroronrender:"     .",other:"",normalized:""},dvcore:{target:"",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title}({time})",legendTime:"{value}{time}"},point:{xScale:"X",yScale:"Y",sizeScale:""},pathing:{entry:"",exit:"","entry2+":"","exit2+":"",path:"","path2+":"",expand:"",focus:"",collapse:"",title:"  ",nodeEntries:"{label} ",nodeExits:"{label} ",nodeToNode:"{source}  {target}",percOfNode:"{label} {perc}",pathToNode:"{label}  {path}",pathFromNode:"{label}  {path}",help1:"        .",help2:"       .",help3:"         .",focusHelp:"    ",expandHelp:"     ",collapseHelp:"    "},sunburst:{audience:"","audience2+":"",category:"","category2+":"",metric:"","metric2+":"",primarymetric:" ",secondarymetric:" ","secondarymetric2+":" ",secondarymetrichelp:"   ","secondarymetrichelp2+":"   ",emptyFirstMetric:"    .   .",total:"",zoomAction:"   .",moreAction:"   .",zoomin:"",zoomout:"",hide:"",hideall:" ",hideother:" ",hidden:"{value}  ","hidden2+":"{value}  ",topresults:" {value}",color:"",height:"",both:" ",none:"",mapmetric:"{metric}  :",percmetric:"{metric}  {percent} ",mobilescroll:"&#x25BC    ."},flower:{joy:"",admiration:"",fear:"",surprise:"",sadness:"",disgust:"",anger:"",anticipation:""},venn:{definedAudience:" "},donut:{precalculated:" "},bar:{max:"",min:"",mean:"",median:""},funnel:{step:"",segment:"",conversion:"",fallout:"",average:""}},"labels");global.cloudViz.localeDefinition("ko-KR",{shortFormat:{second:":%S",minute:"%I:%M",hour:"%p %I",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%p %I:%M",hour:"%p %I",day:"%e %a",week:"%e %a",month:"%b",quarter:"%b",year:"%Y",fallback:"%e %a"},longFormat:{second:"%M:%S",minute:"%p %I:%M",hour:"%e %a %p %I",day:"%e %A",week:"%e %A",month:"%B",quarter:"%B",year:"%Y",fallback:"%e %a %p %I"},fullFormat:{second:"%p %I:%M:%S",minute:"%e %a %p %I:%M",hour:"%e %a %p %I",day:"%B %e, %A",week:"%B %e, %A",month:"%Y  %B",quarter:"%Y %B",year:"%Y",fallback:"%Y %b %e",condensed:"%Y/%m/%d",timestamp:"%Y/%m/%d %p %I:%M:%S"}},"dateFormat");global.cloudViz.localeDefinition("ko-KR",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");global.cloudViz.localeDefinition("ko-KR",{singular:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},plural:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},abbreviation:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("pt-BR",{monthAbbreviations:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],months:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],weekdayAbbreviations:["Dom","Seg","Ter","Qua","Qui","Sex","Sb"],weekdays:["Domingo","Segunda-feira","Tera-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sbado"],ampm:["AM","PM"]},"calendar");global.cloudViz.localeDefinition("pt-BR",{core:{nodata:"O grfico no possui dados",erroronrender:"Ops! Houve um erro e o grfico no pde ser processado.",other:"Outro",normalized:"Normalizado"},dvcore:{target:"Meta",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} (em {time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:"Tamanho"},pathing:{entry:"Entrada",exit:"Sair","entry2+":"Entradas","exit2+":"Sadas",path:"Caminho","path2+":"Caminhos",expand:"Expandir",focus:"Foco",collapse:"Recolher",title:"Grfico de criao de caminho",nodeEntries:"{label} Entradas",nodeExits:"{label} Sadas",nodeToNode:"{source}  {target}",percOfNode:"{perc} de {label}",pathToNode:"{path} para {label}",pathFromNode:"{path} de {label}",help1:"Esse grfico representa os caminhos tomados de um estado para outro.",help2:"Cada n, formado como uma caixa representa um estado no caminho.",help3:"Tocar ou clicar em um n fornecer opes adicionais para modificar o grfico:",focusHelp:"Mostra os caminhos entrando ou saindo do n",expandHelp:"Mostra caminhos adicionais entrando ou saindo do n",collapseHelp:"Remove os caminhos saindo ou entrando no n"},sunburst:{audience:"Pblico-alvo","audience2+":"Pblicos-alvos",category:"Categoria","category2+":"Categorias",metric:"Mtrica","metric2+":"Mtricas",primarymetric:"Mtrica principal",secondarymetric:"Mtrica secundria","secondarymetric2+":"Mtricas secundrias",secondarymetrichelp:"Clique na mtrica para alternar a altura","secondarymetrichelp2+":"Clique nas mtricas para alternar a altura",emptyFirstMetric:"A primeira mtrica no tem valores. Esolha uma mtrica diferente.",total:"Total",zoomAction:"Clique duas vezes para aumentar o zoom.",moreAction:"Clique para ver mais opes.",zoomin:"Ampliar",zoomout:"Reduzir",hide:"Ocultar",hideall:"Ocultar tudo",hideother:"Ocultar outro",hidden:"{value} Item oculto","hidden2+":"{value} itens ocultos",topresults:"principais {value}",color:"Cor",height:"Altura",both:"Ambos",none:"Nenhum",mapmetric:"Mostrar {metric} como:",percmetric:"{percent} de {metric}",mobilescroll:"&#x25BC role para ver os detalhes"},flower:{joy:"Alegria",admiration:"Admirao",fear:"Medo",surprise:"Problemas",sadness:"Tristeza",disgust:"Repulsa",anger:"Raiva",anticipation:"Antecipao"},venn:{definedAudience:"Pblico-alvo definido"},donut:{precalculated:"Pr-calculado"},bar:{max:"Mx",min:"Mn",mean:"Mdia",median:"Mediana"},funnel:{step:"Etapa",segment:"Segmento",conversion:"Converso",fallout:"Fallout",average:"Mdia"}},"labels");global.cloudViz.localeDefinition("pt-BR",{shortFormat:{second:":%S",minute:"%H:%M",hour:"%H",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%H:%M",hour:"%H",day:"%a %e",week:"%a %e",month:"%b",quarter:"%b",year:"%Y",fallback:"%a %e"},longFormat:{second:"%M:%S",minute:"%H:%M",hour:"%Hh %a %e",day:"%A %e",week:"%A %e",month:"%B",quarter:"%B",year:"%Y",fallback:"%Hh %a %e"},fullFormat:{second:"%H:%M:%S",minute:"%H:%M %a %e",hour:"%Hh %a %e",day:"%A, %e de %B",week:"%A, %e de %B",month:"%B %Y",quarter:"%B %Y",year:"%Y",fallback:"%e %b, %Y",condensed:"%Y/%m/%d",timestamp:"%m/%d/%Y %H:%M:%S"}},"dateFormat");global.cloudViz.localeDefinition("pt-BR",{decimalSeparator:",",groupSeparator:" ",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"},currency:{symbol:"R$",positivePattern:"{number} {symbol}",negativePattern:"-{number} {symbol}"}},"numberFormat");global.cloudViz.localeDefinition("pt-BR",{singular:{second:"segundo",minute:"minuto",hour:"hora",day:"da",week:"semana",month:"ms",year:"ano"},plural:{second:"segundos",minute:"minutos",hour:"horas",day:"dias",week:"semanas",month:"meses",year:"anos"},abbreviation:{second:"s",minute:"min",hour:"h",day:"d",week:"w",month:"mon",year:"y"}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("zh-CN",{monthAbbreviations:["1 ","2 ","3 ","4 ","5 ","6 ","7 ","8 ","9 ","10 ","11 ","12 "],months:["1 ","2 ","3 ","4 ","5 ","6 ","7 ","8 ","9 ","10 ","11 ","12 "],weekdayAbbreviations:["","","","","","",""],weekdays:["","","","","","",""],ampm:["",""]},"calendar");global.cloudViz.localeDefinition("zh-CN",{core:{nodata:"",erroronrender:"",other:"",normalized:""},dvcore:{target:"",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title}{time}",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:""},pathing:{entry:"",exit:"","entry2+":"","exit2+":"",path:"","path2+":"",expand:"",focus:"",collapse:"",title:"",nodeEntries:"{label} ",nodeExits:"{label} ",nodeToNode:"{source}  {target}",percOfNode:"{perc}  {label}",pathToNode:" {label}  {path}",pathFromNode:" {label}  {path}",help1:"",help2:"",help3:"",focusHelp:"",expandHelp:"",collapseHelp:""},sunburst:{audience:"","audience2+":"",category:"","category2+":"",metric:"","metric2+":"",primarymetric:"",secondarymetric:"","secondarymetric2+":"",secondarymetrichelp:"","secondarymetrichelp2+":"",emptyFirstMetric:"",total:"",zoomAction:"",moreAction:"",zoomin:"",zoomout:"",hide:"",hideall:"",hideother:"",hidden:"{value} ","hidden2+":"{value} ",topresults:" {value}",color:"",height:"",both:"",none:"",mapmetric:"{metric} :",percmetric:"{percent}  {metric}",mobilescroll:"&#x25BC "},flower:{joy:"",admiration:"",fear:"",surprise:"",sadness:"",disgust:"",anger:"",anticipation:""},venn:{definedAudience:""},donut:{precalculated:""},bar:{max:"",min:"",mean:"",median:""},funnel:{step:"",segment:"",conversion:"",fallout:"",average:""}},"labels");global.cloudViz.localeDefinition("zh-CN",{shortFormat:{second:":%S",minute:"%I:%M",hour:"%p %I",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%p %I:%M",hour:"%p %I",day:"%e  %a",week:"%e  %a",month:"%b",quarter:"%b",year:"%Y",fallback:"%e  %a"},longFormat:{second:"%M:%S",minute:"%p %I:%M",hour:"%e  %a %p %I",day:"%e  %A",week:"%e  %A",month:"%B",quarter:"%B",year:"%Y",fallback:"%e  %a %p %I"},fullFormat:{second:"%p %I:%M:%S",minute:"%e  (%a) %p %I:%M",hour:"%e  %a %p %I",day:"%B %e %A",week:"%B %e %A",month:"%Y %B",quarter:"%Y %B",year:"%Y",fallback:"%Y %b %e ",condensed:"%Y/%m/%d",timestamp:"%Y/%m/%d %p %I:%M:%S"}},"dateFormat");global.cloudViz.localeDefinition("zh-CN",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");global.cloudViz.localeDefinition("zh-CN",{singular:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},plural:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},abbreviation:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("zh-TW",{monthAbbreviations:["1 ","2 ","3 ","4 ","5 ","6 ","7 ","8 ","9 ","10 ","11 ","12 "],months:["1 ","2 ","3 ","4 ","5 ","6 ","7 ","8 ","9 ","10 ","11 ","12 "],weekdayAbbreviations:["","","","","","",""],weekdays:["","","","","","",""],ampm:["",""]},"calendar");global.cloudViz.localeDefinition("zh-TW",{core:{nodata:"",erroronrender:"",other:"",normalized:""},dvcore:{target:"",yAxisTimeNoTitle:"{time}",yAxisTimeWithTitle:"{title} ({time})",legendTime:"{value} {time}"},point:{xScale:"X",yScale:"Y",sizeScale:""},pathing:{entry:"",exit:"","entry2+":"","exit2+":"",path:"","path2+":"",expand:"",focus:"",collapse:"",title:"",nodeEntries:"{label} ",nodeExits:"{label} ",nodeToNode:"{source}  {target}",percOfNode:"{perc}  {label}",pathToNode:" {label}  {path}",pathFromNode:" {label}  {path}",help1:"",help2:"",help3:":",focusHelp:"",expandHelp:"",collapseHelp:""},sunburst:{audience:"","audience2+":"",category:"","category2+":"",metric:"","metric2+":"",primarymetric:"",secondarymetric:"","secondarymetric2+":"",secondarymetrichelp:"","secondarymetrichelp2+":"",emptyFirstMetric:"",total:"",zoomAction:"",moreAction:"",zoomin:"",zoomout:"",hide:"",hideall:"",hideother:"",hidden:"{value} ","hidden2+":"{value} ",topresults:" {value} ",color:"",height:"",both:"",none:"",mapmetric:" {metric} :",percmetric:"{percent}  {metric}",mobilescroll:"&#x25BC "},flower:{joy:"",admiration:"",fear:"",surprise:"",sadness:"",disgust:"",anger:"",anticipation:""},venn:{definedAudience:""},donut:{precalculated:""},bar:{max:"",min:"",mean:"",median:""},funnel:{step:"",segment:"",conversion:"",fallout:"",average:""}},"labels");global.cloudViz.localeDefinition("zh-TW",{shortFormat:{second:":%S",minute:"%I:%M",hour:"%p %I",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"%Y",fallback:"%e"},mediumFormat:{second:"%M:%S",minute:"%p %I:%M",hour:"%p %I",day:"%e  %a",week:"%e  %a",month:"%b",quarter:"%b",year:"%Y",fallback:"%e  %a"},longFormat:{second:"%M:%S",minute:"%p %I:%M",hour:"%e  %a %p %I",day:"%e  %A",week:"%e  %A",month:"%B",quarter:"%B",year:"%Y",fallback:"%e  %a %p %I"},fullFormat:{second:"%p %I:%M:%S",minute:"%e  %a %p %I:%M",hour:"%e  %a %p %I",day:"%B %e %A",week:"%B %e %A",month:"%Y  %B",quarter:"%Y %B",year:"%Y",fallback:"%Y %b %e ",condensed:"%Y/%m/%d",timestamp:"%Y/%m/%d %p %I:%M:%S"}},"dateFormat");global.cloudViz.localeDefinition("zh-TW",{decimalSeparator:".",groupSeparator:",",negativePattern:"-{number}",percent:{symbol:"%",positivePattern:"{number}{symbol}",negativePattern:"-{number}{symbol}"},currency:{symbol:"NT$",positivePattern:"{symbol}{number}",negativePattern:"-{symbol}{number}"}},"numberFormat");global.cloudViz.localeDefinition("zh-TW",{singular:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},plural:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""},abbreviation:{second:"",minute:"",hour:"",day:"",week:"",month:"",year:""}},"time")})(this);(function(global){"use strict";global.cloudViz.localeDefinition("zz-ZZ",{monthAbbreviations:["_[g] Jan_","_[q] Feb_","_[r] Mar_","_[n] Apr_","_[p] May_","_[k] Jun_","_[l] Jul_","_[i] Aug_","_[j] Sep_","_[h] Oct_","_[o] Nov_","_[m] Dec_"],months:["_[1] January_","_[2] February_","_[3] March_","_[x] April_","_[y] May_","_[z] June_","_[0] July_","_[s] August_","_[t] September_","_[u] October_","_[v] November_","_[w] December_"],weekdayAbbreviations:["_[+] Sun_","_[4] Mon_","_[5] Tue_","_[6] Wed_","_[7] Thu_","_[8] Fri_","_[9] Sat_"],weekdays:["_[BB] Sunday_","_[BA] Monday_","_[/] Tuesday_","_[BC] Wednesday_","_[BD] Thursday_","_[BE] Friday_","_[BF] Saturday_"],ampm:["_[e] AM_","_[f] PM_"]},"calendar");global.cloudViz.localeDefinition("zz-ZZ",{core:{nodata:"_[BH] The chart has no data_",erroronrender:"_[BG] Oops! There was an error and the chart could not be rendered._",other:"_[BJ] Other_",normalized:"_[BI] Normalized_"},dvcore:{target:"_[BL] Target_",yAxisTimeNoTitle:"_[BK] {time}_",yAxisTimeWithTitle:"_[BN] {title} (in {time})_",legendTime:"_[BM] {value} {time}_"},point:{xScale:"_[Bp] X_",yScale:"_[Br] Y_",sizeScale:"_[Bq] Size_"},pathing:{entry:"_[Be] Entry_",exit:"_[Bg] Exit_","entry2+":"_[Bn] Entries_","exit2+":"_[Bb] Exits_",path:"_[BZ] Path_","path2+":"_[Bf] Paths_",expand:"_[BX] Expand_",focus:"_[BW] Focus_",collapse:"_[Bj] Collapse_",title:"_[Bc] Pathing Chart_",nodeEntries:"_[Cz] {label} Entries_",nodeExits:"_[C0] {label} Exits_",nodeToNode:"_[Cy] {source}  {target}_",percOfNode:"_[Ba] {perc} of {label}_",pathToNode:"_[Bo] {path} to {label}_",pathFromNode:"_[Bd] {path} from {label}_",help1:"_[BY] This chart represents paths taken from one state to another._",help2:"_[Bh] Each node, shaped as a box, represents a state in the path._",help3:"_[Bk] Tapping or clicking a node will provide additional options to modify the chart:_",focusHelp:"_[Bm] Shows paths coming into and going out of node_",expandHelp:"_[Bi] Shows additional paths coming or going from the node_",collapseHelp:"_[Bl] Removes paths coming or going from the node_"},sunburst:{audience:"_[Ci] Audience_","audience2+":"_[Ce] Audiences_",category:"_[Ch] Category_","category2+":"_[Cf] Categories_",metric:"_[Cd] Metric_","metric2+":"_[Cg] Metrics_",primarymetric:"_[Cj] Primary Metric_",secondarymetric:"_[Cl] Secondary Metric_","secondarymetric2+":"_[Ck] Secondary Metrics_",secondarymetrichelp:"_[Cm] Click metric to toggle height_","secondarymetrichelp2+":"_[Cn] Click metrics to toggle height_",emptyFirstMetric:"_[B2] The first metric has no values. Please pick a different metric._",total:"_[B7] Total_",zoomAction:"_[By] Double-click to Zoom in._",moreAction:"_[B5] Click for more options._",zoomin:"_[Bz] Zoom In_",zoomout:"_[Bs] Zoom Out_",hide:"_[Bt] Hide_",hideall:"_[Bw] Hide All_",hideother:"_[Bu] Hide Other_",hidden:"_[B4] {value} Hidden Item_","hidden2+":"_[B0] {value} Hidden Items_",topresults:"_[B8] top {value}_",color:"_[Bx] Color_",height:"_[Bv] Height_",both:"_[B6] Both_",none:"_[B3] None_",mapmetric:"_[B9] Show {metric} as:_",percmetric:"_[B1] {percent} of {metric}_",mobilescroll:"_[Co] &#x25BC scroll for details_"},flower:{joy:"_[BU] Joy_",admiration:"_[BT] Admiration_",fear:"_[BQ] Fear_",surprise:"_[BR] Surprise_",sadness:"_[BO] Sadness_",disgust:"_[BP] Disgust_",anger:"_[BV] Anger_",anticipation:"_[BS] Anticipation_"},venn:{definedAudience:"_[B+] Defined Audience_"},donut:{precalculated:"_[DD] Precalculated_"},bar:{max:"_[DH] Max_",min:"_[DG] Min_",mean:"_[DE] Mean_",median:"_[DF] Median_"},funnel:{step:"_[C3] Step_",segment:"_[C4] Segment_",conversion:"_[C1] Conversion_",fallout:"_[C5] Fallout_",average:"_[C2] Average_"}},"labels");global.cloudViz.localeDefinition("zz-ZZ",{shortFormat:{second:"_[DB] :%S_",minute:"_[DC] %I:%M_",hour:"_[Z] %I %p_",day:"%e",week:"%e",month:"%b",quarter:"%b",year:"_[d] %Y_",fallback:"%e"},mediumFormat:{second:"_[DA] %M:%S_",minute:"_[C/] %I:%M %p_",hour:"_[S] %I %p_",day:"_[Q] %a %e_",week:"_[T] %a %e_",month:"%b",quarter:"%b",year:"_[U] %Y_",fallback:"_[V] %a %e_"},longFormat:{second:"_[C+] %M:%S_",minute:"_[C9] %I:%M %p_",hour:"_[P] %I %p %a %e_",day:"_[M] %A %e_",week:"_[O] %A %e_",month:"_[L] %B_",quarter:"_[K] %B_",year:"_[J] %Y_",fallback:"_[N] %I %p %a %e_"},fullFormat:{second:"_[C6] %I:%M:%S %p_",minute:"_[C8] %I:%M %p %a %e_",hour:"_[D] %I %p %a %e_",day:"_[C] %A %e %B_",week:"_[B] %A %e %B_",month:"_[G] %B %Y_",quarter:"_[E] %B %Y_",year:"_[I] %Y_",fallback:"_[F] %b %e, %Y_",condensed:"_[H] %m/%d/%Y_",timestamp:"_[C7] %m/%d/%Y %I:%M:%S %p_"}},"dateFormat");global.cloudViz.localeDefinition("zz-ZZ",{decimalSeparator:"_[CC] ._",groupSeparator:"_[CD] ,_",negativePattern:"_[CE] -{number}_",percent:{symbol:"_[CF] %_",positivePattern:"_[CG] {number}{symbol}_",negativePattern:"_[CH] -{number}{symbol}_"},currency:{symbol:"_[B/] $_",positivePattern:"_[CA] {symbol}{number}_",negativePattern:"_[CB] -{symbol}{number}_"}},"numberFormat");global.cloudViz.localeDefinition("zz-ZZ",{singular:{second:"_[CX] second_",minute:"_[CY] minute_",hour:"_[CZ] hour_",day:"_[CV] day_",week:"_[Ca] week_",month:"_[Cb] month_",year:"_[CW] year_"},plural:{second:"_[CS] seconds_",minute:"_[CP] minutes_",hour:"_[Cc] hours_",day:"_[CR] days_",week:"_[CQ] weeks_",month:"_[CT] months_",year:"_[CU] years_"},abbreviation:{second:"_[CJ] s_",minute:"_[CO] min_",hour:"_[CK] h_",day:"_[CI] d_",week:"_[CL] w_",month:"_[CM] mon_",year:"_[CN] y_"}},"time")})(this);(function(e,undefined){var t,n,r=typeof undefined,i=e.location,o=e.document,s=o.documentElement,a=e.jQuery,u=e.$,l={},c=[],p="2.0.3",f=c.concat,h=c.push,d=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,x=function(e,n){return new x.fn.init(e,n,t)},b=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^-ms-/,N=/-([\da-z])/gi,E=function(e,t){return t.toUpperCase()},S=function(){o.removeEventListener("DOMContentLoaded",S,!1),e.removeEventListener("load",S,!1),x.ready()};x.fn=x.prototype={jquery:p,constructor:x,init:function(e,t,n){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:T.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof x?t[0]:t,x.merge(this,x.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:o,!0)),C.test(r[1])&&x.isPlainObject(t))for(r in t)x.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=o.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):x.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),x.makeArray(e,this))},selector:"",length:0,toArray:function(){return d.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return x.each(this,e,t)},ready:function(e){return x.ready.promise().done(e),this},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(x.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:[].sort,splice:[].splice},x.fn.init.prototype=x.fn,x.extend=x.fn.extend=function(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,u=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},a=2),"object"==typeof s||x.isFunction(s)||(s={}),u===a&&(s=this,--a);u>a;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],r=e[t],s!==r&&(l&&r&&(x.isPlainObject(r)||(i=x.isArray(r)))?(i?(i=!1,o=n&&x.isArray(n)?n:[]):o=n&&x.isPlainObject(n)?n:{},s[t]=x.extend(l,o,r)):r!==undefined&&(s[t]=r));return s},x.extend({expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===x&&(e.$=u),t&&e.jQuery===x&&(e.jQuery=a),x},isReady:!1,readyWait:1,holdReady:function(e){e?x.readyWait++:x.ready(!0)},ready:function(e){(e===!0?--x.readyWait:x.isReady)||(x.isReady=!0,e!==!0&&--x.readyWait>0||(n.resolveWith(o,[x]),x.fn.trigger&&x(o).trigger("ready").off("ready")))},isFunction:function(e){return"function"===x.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if("object"!==x.type(e)||e.nodeType||x.isWindow(e))return!1;try{if(e.constructor&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=x.buildFragment([e],t,i),i&&x(i).remove(),x.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||"string"!=typeof e)return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&x.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(e){var t,n=eval;e=x.trim(e),e&&(1===e.indexOf("use strict")?(t=o.createElement("script"),t.text=e,o.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(k,"ms-").replace(N,E)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,s=j(e);if(n){if(s){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(s){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":v.call(e)},makeArray:function(e,t){var n=t||[];return null!=e&&(j(Object(e))?x.merge(n,"string"==typeof e?[e]:e):h.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:g.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if("number"==typeof n)for(;n>i;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],o=0,s=e.length;for(n=!!n;s>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,s=j(e),a=[];if(s)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(a[a.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(a[a.length]=r);return f.apply([],a)},guid:1,proxy:function(e,t){var n,r,i;return"string"==typeof t&&(n=e[t],t=e,e=n),x.isFunction(e)?(r=d.call(arguments,2),i=function(){return e.apply(t||this,r.concat(d.call(arguments)))},i.guid=e.guid=e.guid||x.guid++,i):undefined},access:function(e,t,n,r,i,o,s){var a=0,u=e.length,l=null==n;if("object"===x.type(n)){i=!0;for(a in n)x.access(e,t,a,n[a],!0,o,s)}else if(r!==undefined&&(i=!0,x.isFunction(r)||(s=!0),l&&(s?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(x(e),n)})),t))for(;u>a;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return i?e:l?t.call(e):u?t(e[0],n):o},now:Date.now,swap:function(e,t,n,r){var i,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=s[o];return i}}),x.ready.promise=function(t){return n||(n=x.Deferred(),"complete"===o.readyState?setTimeout(x.ready):(o.addEventListener("DOMContentLoaded",S,!1),e.addEventListener("load",S,!1))),n.promise(t)},x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function j(e){var t=e.length,n=x.type(e);return x.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}t=x(o),function(e,undefined){var t,n,r,i,o,s,a,u,l,c,p,f,h,d,g,m,y,v="sizzle"+-new Date,b=e.document,w=0,T=0,C=st(),k=st(),N=st(),E=!1,S=function(e,t){return e===t?(E=!0,0):0},j=typeof undefined,D=1<<31,A={}.hasOwnProperty,L=[],q=L.pop,H=L.push,O=L.push,F=L.slice,P=L.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",W="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",$=W.replace("w","w#"),B="\\["+M+"*("+W+")"+M+"*(?:([*^$|!~]?=)"+M+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+$+")|)|)"+M+"*\\]",I=":("+W+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+B.replace(3,8)+")*)|.*)\\)|)",z=RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=RegExp("^"+M+"*,"+M+"*"),X=RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=RegExp(M+"*[+~]"),Y=RegExp("="+M+"*([^\\]'\"]*)"+M+"*\\]","g"),V=RegExp(I),G=RegExp("^"+$+"$"),J={ID:RegExp("^#("+W+")"),CLASS:RegExp("^\\.("+W+")"),TAG:RegExp("^("+W.replace("w","w*")+")"),ATTR:RegExp("^"+B),PSEUDO:RegExp("^"+I),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:RegExp("^(?:"+R+")$","i"),needsContext:RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Q=/^[^{]+\{\s*\[native \w/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{O.apply(L=F.call(b.childNodes),b.childNodes),L[b.childNodes.length].nodeType}catch(it){O={apply:L.length?function(e,t){H.apply(e,F.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function ot(e,t,r,i){var o,s,a,u,l,f,g,m,x,w;if((t?t.ownerDocument||t:b)!==p&&c(t),t=t||p,r=r||[],!e||"string"!=typeof e)return r;if(1!==(u=t.nodeType)&&9!==u)return[];if(h&&!i){if(o=K.exec(e))if(a=o[1]){if(9===u){if(s=t.getElementById(a),!s||!s.parentNode)return r;if(s.id===a)return r.push(s),r}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(a))&&y(t,s)&&s.id===a)return r.push(s),r}else{if(o[2])return O.apply(r,t.getElementsByTagName(e)),r;if((a=o[3])&&n.getElementsByClassName&&t.getElementsByClassName)return O.apply(r,t.getElementsByClassName(a)),r}if(n.qsa&&(!d||!d.test(e))){if(m=g=v,x=t,w=9===u&&e,1===u&&"object"!==t.nodeName.toLowerCase()){f=gt(e),(g=t.getAttribute("id"))?m=g.replace(tt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",l=f.length;while(l--)f[l]=m+mt(f[l]);x=U.test(e)&&t.parentNode||t,w=f.join(",")}if(w)try{return O.apply(r,x.querySelectorAll(w)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return kt(e.replace(z,"$1"),t,r,i)}function st(){var e=[];function t(n,r){return e.push(n+=" ")>i.cacheLength&&delete t[e.shift()],t[n]=r}return t}function at(e){return e[v]=!0,e}function ut(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t){var n=e.split("|"),r=e.length;while(r--)i.attrHandle[n[r]]=t}function ct(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||D)-(~e.sourceIndex||D);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ht(e){return at(function(t){return t=+t,at(function(n,r){var i,o=e([],n.length,t),s=o.length;while(s--)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))})})}s=ot.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},n=ot.support={},c=ot.setDocument=function(e){var t=e?e.ownerDocument||e:b,r=t.defaultView;return t!==p&&9===t.nodeType&&t.documentElement?(p=t,f=t.documentElement,h=!s(t),r&&r.attachEvent&&r!==r.top&&r.attachEvent("onbeforeunload",function(){c()}),n.attributes=ut(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ut(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=ut(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=ut(function(e){return f.appendChild(e).id=v,!t.getElementsByName||!t.getElementsByName(v).length}),n.getById?(i.find.ID=function(e,t){if(typeof t.getElementById!==j&&h){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete i.find.ID,i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==j&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==j?t.getElementsByTagName(e):undefined}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==j&&h?t.getElementsByClassName(e):undefined},g=[],d=[],(n.qsa=Q.test(t.querySelectorAll))&&(ut(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),ut(function(e){var n=t.createElement("input");n.setAttribute("type","hidden"),e.appendChild(n).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")})),(n.matchesSelector=Q.test(m=f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ut(function(e){n.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",I)}),d=d.length&&RegExp(d.join("|")),g=g.length&&RegExp(g.join("|")),y=Q.test(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},S=f.compareDocumentPosition?function(e,r){if(e===r)return E=!0,0;var i=r.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(r);return i?1&i||!n.sortDetached&&r.compareDocumentPosition(e)===i?e===t||y(b,e)?-1:r===t||y(b,r)?1:l?P.call(l,e)-P.call(l,r):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,o=e.parentNode,s=n.parentNode,a=[e],u=[n];if(e===n)return E=!0,0;if(!o||!s)return e===t?-1:n===t?1:o?-1:s?1:l?P.call(l,e)-P.call(l,n):0;if(o===s)return ct(e,n);r=e;while(r=r.parentNode)a.unshift(r);r=n;while(r=r.parentNode)u.unshift(r);while(a[i]===u[i])i++;return i?ct(a[i],u[i]):a[i]===b?-1:u[i]===b?1:0},t):p},ot.matches=function(e,t){return ot(e,null,null,t)},ot.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Y,"='$1']"),!(!n.matchesSelector||!h||g&&g.test(t)||d&&d.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return ot(t,p,null,[e]).length>0},ot.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},ot.attr=function(e,t){(e.ownerDocument||e)!==p&&c(e);var r=i.attrHandle[t.toLowerCase()],o=r&&A.call(i.attrHandle,t.toLowerCase())?r(e,t,!h):undefined;return o===undefined?n.attributes||!h?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null:o},ot.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},ot.uniqueSort=function(e){var t,r=[],i=0,o=0;if(E=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(S),E){while(t=e[o++])t===e[o]&&(i=r.push(o));while(i--)e.splice(r[i],1)}return e},o=ot.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=ot.selectors={cacheLength:50,createPseudo:at,match:J,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ot.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ot.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return J.CHILD.test(e[0])?null:(e[3]&&e[4]!==undefined?e[2]=e[4]:n&&V.test(n)&&(t=gt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=C[e+" "];return t||(t=RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&C(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==j&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ot.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,h,d,g=o!==s?"nextSibling":"previousSibling",m=t.parentNode,y=a&&t.nodeName.toLowerCase(),x=!u&&!a;if(m){if(o){while(g){p=t;while(p=p[g])if(a?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;d=g="only"===e&&!d&&"nextSibling"}return!0}if(d=[s?m.firstChild:m.lastChild],s&&x){c=m[v]||(m[v]={}),l=c[e]||[],h=l[0]===w&&l[1],f=l[0]===w&&l[2],p=h&&m.childNodes[h];while(p=++h&&p&&p[g]||(f=h=0)||d.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[w,h,f];break}}else if(x&&(l=(t[v]||(t[v]={}))[e])&&l[0]===w)f=l[1];else while(p=++h&&p&&p[g]||(f=h=0)||d.pop())if((a?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(x&&((p[v]||(p[v]={}))[e]=[w,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ot.error("unsupported pseudo: "+e);return r[v]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var i,o=r(e,t),s=o.length;while(s--)i=P.call(e,o[s]),e[i]=!(n[i]=o[s])}):function(e){return r(e,0,n)}):r}},pseudos:{not:at(function(e){var t=[],n=[],r=a(e.replace(z,"$1"));return r[v]?at(function(e,t,n,i){var o,s=r(e,null,i,[]),a=e.length;while(a--)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:at(function(e){return function(t){return ot(e,t).length>0}}),contains:at(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:at(function(e){return G.test(e||"")||ot.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do{if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ht(function(){return[0]}),last:ht(function(e,t){return[t-1]}),eq:ht(function(e,t,n){return[0>n?n+t:n]}),even:ht(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:ht(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:ht(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ht(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}},i.pseudos.nth=i.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[t]=pt(t);for(t in{submit:!0,reset:!0})i.pseudos[t]=ft(t);function dt(){}dt.prototype=i.filters=i.pseudos,i.setFilters=new dt;function gt(e,t){var n,r,o,s,a,u,l,c=k[e+" "];if(c)return t?0:c.slice(0);a=e,u=[],l=i.preFilter;while(a){(!n||(r=_.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),u.push(o=[])),n=!1,(r=X.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(z," ")}),a=a.slice(n.length));for(s in i.filter)!(r=J[s].exec(a))||l[s]&&!(r=l[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?ot.error(e):k(e,u).slice(0)}function mt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function yt(e,t,n){var i=t.dir,o=n&&"parentNode"===i,s=T++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,a){var u,l,c,p=w+" "+s;if(a){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,a))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[v]||(t[v]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,a)||r,l[1]===!0)return!0}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function xt(e,t,n,r,i){var o,s=[],a=0,u=e.length,l=null!=t;for(;u>a;a++)(o=e[a])&&(!n||n(o,r,i))&&(s.push(o),l&&t.push(a));return s}function bt(e,t,n,r,i,o){return r&&!r[v]&&(r=bt(r)),i&&!i[v]&&(i=bt(i,o)),at(function(o,s,a,u){var l,c,p,f=[],h=[],d=s.length,g=o||Ct(t||"*",a.nodeType?[a]:a,[]),m=!e||!o&&t?g:xt(g,f,e,a,u),y=n?i||(o?e:d||r)?[]:s:m;if(n&&n(m,y,a,u),r){l=xt(y,h),r(l,[],a,u),c=l.length;while(c--)(p=l[c])&&(y[h[c]]=!(m[h[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?P.call(o,p):f[c])>-1&&(o[l]=!(s[l]=p))}}else y=xt(y===s?y.splice(d,y.length):y),i?i(null,s,y,u):O.apply(s,y)})}function wt(e){var t,n,r,o=e.length,s=i.relative[e[0].type],a=s||i.relative[" "],l=s?1:0,c=yt(function(e){return e===t},a,!0),p=yt(function(e){return P.call(t,e)>-1},a,!0),f=[function(e,n,r){return!s&&(r||n!==u)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>l;l++)if(n=i.relative[e[l].type])f=[yt(vt(f),n)];else{if(n=i.filter[e[l].type].apply(null,e[l].matches),n[v]){for(r=++l;o>r;r++)if(i.relative[e[r].type])break;return bt(l>1&&vt(f),l>1&&mt(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(z,"$1"),n,r>l&&wt(e.slice(l,r)),o>r&&wt(e=e.slice(r)),o>r&&mt(e))}f.push(n)}return vt(f)}function Tt(e,t){var n=0,o=t.length>0,s=e.length>0,a=function(a,l,c,f,h){var d,g,m,y=[],v=0,x="0",b=a&&[],T=null!=h,C=u,k=a||s&&i.find.TAG("*",h&&l.parentNode||l),N=w+=null==C?1:Math.random()||.1;for(T&&(u=l!==p&&l,r=n);null!=(d=k[x]);x++){if(s&&d){g=0;while(m=e[g++])if(m(d,l,c)){f.push(d);break}T&&(w=N,r=++n)}o&&((d=!m&&d)&&v--,a&&b.push(d))}if(v+=x,o&&x!==v){g=0;while(m=t[g++])m(b,y,l,c);if(a){if(v>0)while(x--)b[x]||y[x]||(y[x]=q.call(f));y=xt(y)}O.apply(f,y),T&&!a&&y.length>0&&v+t.length>1&&ot.uniqueSort(f)}return T&&(w=N,u=C),b};return o?at(a):a}a=ot.compile=function(e,t){var n,r=[],i=[],o=N[e+" "];if(!o){t||(t=gt(e)),n=t.length;while(n--)o=wt(t[n]),o[v]?r.push(o):i.push(o);o=N(e,Tt(i,r))}return o};function Ct(e,t,n){var r=0,i=t.length;for(;i>r;r++)ot(e,t[r],n);return n}function kt(e,t,r,o){var s,u,l,c,p,f=gt(e);if(!o&&1===f.length){if(u=f[0]=f[0].slice(0),u.length>2&&"ID"===(l=u[0]).type&&n.getById&&9===t.nodeType&&h&&i.relative[u[1].type]){if(t=(i.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return r;e=e.slice(u.shift().value.length)}s=J.needsContext.test(e)?0:u.length;while(s--){if(l=u[s],i.relative[c=l.type])break;if((p=i.find[c])&&(o=p(l.matches[0].replace(nt,rt),U.test(u[0].type)&&t.parentNode||t))){if(u.splice(s,1),e=o.length&&mt(u),!e)return O.apply(r,o),r;break}}}return a(e,f)(o,t,!h,r,U.test(e)),r}n.sortStable=v.split("").sort(S).join("")===v,n.detectDuplicates=E,c(),n.sortDetached=ut(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),ut(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||lt("type|href|height|width",function(e,t,n){return n?undefined:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ut(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||lt("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?undefined:e.defaultValue}),ut(function(e){return null==e.getAttribute("disabled")})||lt(R,function(e,t,n){var r;return n?undefined:(r=e.getAttributeNode(t))&&r.specified?r.value:e[t]===!0?t.toLowerCase():null}),x.find=ot,x.expr=ot.selectors,x.expr[":"]=x.expr.pseudos,x.unique=ot.uniqueSort,x.text=ot.getText,x.isXMLDoc=ot.isXML,x.contains=ot.contains}(e);var D={};function A(e){var t=D[e]={};return x.each(e.match(w)||[],function(e,n){t[n]=!0}),t}x.Callbacks=function(e){e="string"==typeof e?D[e]||A(e):x.extend({},e);var t,n,r,i,o,s,a=[],u=!e.once&&[],l=function(p){for(t=e.memory&&p,n=!0,s=i||0,i=0,o=a.length,r=!0;a&&o>s;s++)if(a[s].apply(p[0],p[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,a&&(u?u.length&&l(u.shift()):t?a=[]:c.disable())},c={add:function(){if(a){var n=a.length;(function s(t){x.each(t,function(t,n){var r=x.type(n);"function"===r?e.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==r&&s(n)})})(arguments),r?o=a.length:t&&(i=n,l(t))}return this},remove:function(){return a&&x.each(arguments,function(e,t){var n;while((n=x.inArray(t,a,n))>-1)a.splice(n,1),r&&(o>=n&&o--,s>=n&&s--)}),this},has:function(e){return e?x.inArray(e,a)>-1:!(!a||!a.length)},empty:function(){return a=[],o=0,this},disable:function(){return a=u=t=undefined,this},disabled:function(){return!a},lock:function(){return u=undefined,t||c.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!a||n&&!u||(t=t||[],t=[e,t.slice?t.slice():t],r?u.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},x.extend({Deferred:function(e){var t=[["resolve","done",x.Callbacks("once memory"),"resolved"],["reject","fail",x.Callbacks("once memory"),"rejected"],["notify","progress",x.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return x.Deferred(function(n){x.each(t,function(t,o){var s=o[0],a=x.isFunction(e[t])&&e[t];i[o[1]](function(){var e=a&&a.apply(this,arguments);e&&x.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===r?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?x.extend(e,r):r}},i={};return r.pipe=r.then,x.each(t,function(e,o){var s=o[2],a=o[3];r[o[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=s.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=d.call(arguments),r=n.length,i=1!==r||e&&x.isFunction(e.promise)?r:0,o=1===i?e:x.Deferred(),s=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===a?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},a,u,l;if(r>1)for(a=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&x.isFunction(n[t].promise)?n[t].promise().done(s(t,l,n)).fail(o.reject).progress(s(t,u,a)):--i;return i||o.resolveWith(l,n),o.promise()}}),x.support=function(t){var n=o.createElement("input"),r=o.createDocumentFragment(),i=o.createElement("div"),s=o.createElement("select"),a=s.appendChild(o.createElement("option"));return n.type?(n.type="checkbox",t.checkOn=""!==n.value,t.optSelected=a.selected,t.reliableMarginRight=!0,t.boxSizingReliable=!0,t.pixelPosition=!1,n.checked=!0,t.noCloneChecked=n.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!a.disabled,n=o.createElement("input"),n.value="t",n.type="radio",t.radioValue="t"===n.value,n.setAttribute("checked","t"),n.setAttribute("name","t"),r.appendChild(n),t.checkClone=r.cloneNode(!0).cloneNode(!0).lastChild.checked,t.focusinBubbles="onfocusin"in e,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===i.style.backgroundClip,x(function(){var n,r,s="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",a=o.getElementsByTagName("body")[0];a&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(i),i.innerHTML="",i.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",x.swap(a,null!=a.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===i.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(i,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(i,null)||{width:"4px"}).width,r=i.appendChild(o.createElement("div")),r.style.cssText=i.style.cssText=s,r.style.marginRight=r.style.width="0",i.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),a.removeChild(n))}),t):t}({});var L,q,H=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,O=/([A-Z])/g;function F(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=x.expando+Math.random()}F.uid=1,F.accepts=function(e){return e.nodeType?1===e.nodeType||9===e.nodeType:!0},F.prototype={key:function(e){if(!F.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=F.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,x.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),o=this.cache[i];if("string"==typeof t)o[t]=n;else if(x.isEmptyObject(o))x.extend(this.cache[i],t);else for(r in t)o[r]=t[r];return o},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var r;return t===undefined||t&&"string"==typeof t&&n===undefined?(r=this.get(e,t),r!==undefined?r:this.get(e,x.camelCase(t))):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,o=this.key(e),s=this.cache[o];if(t===undefined)this.cache[o]={};else{x.isArray(t)?r=t.concat(t.map(x.camelCase)):(i=x.camelCase(t),t in s?r=[t,i]:(r=i,r=r in s?[r]:r.match(w)||[])),n=r.length;while(n--)delete s[r[n]]}},hasData:function(e){return!x.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},L=new F,q=new F,x.extend({acceptData:F.accepts,hasData:function(e){return L.hasData(e)||q.hasData(e)},data:function(e,t,n){return L.access(e,t,n)},removeData:function(e,t){L.remove(e,t)},_data:function(e,t,n){return q.access(e,t,n)},_removeData:function(e,t){q.remove(e,t)}}),x.fn.extend({data:function(e,t){var n,r,i=this[0],o=0,s=null;if(e===undefined){if(this.length&&(s=L.get(i),1===i.nodeType&&!q.get(i,"hasDataAttrs"))){for(n=i.attributes;n.length>o;o++)r=n[o].name,0===r.indexOf("data-")&&(r=x.camelCase(r.slice(5)),P(i,r,s[r]));q.set(i,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){L.set(this,e)}):x.access(this,function(t){var n,r=x.camelCase(e);if(i&&t===undefined){if(n=L.get(i,e),n!==undefined)return n;if(n=L.get(i,r),n!==undefined)return n;if(n=P(i,r,undefined),n!==undefined)return n}else this.each(function(){var n=L.get(this,r);L.set(this,r,t),-1!==e.indexOf("-")&&n!==undefined&&L.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){L.remove(this,e)})}});function P(e,t,n){var r;if(n===undefined&&1===e.nodeType)if(r="data-"+t.replace(O,"-$1").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:H.test(n)?JSON.parse(n):n}catch(i){}L.set(e,t,n)}else n=undefined;return n}x.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=q.get(e,t),n&&(!r||x.isArray(n)?r=q.access(e,t,x.makeArray(n)):r.push(n)),r||[]):undefined},dequeue:function(e,t){t=t||"fx";var n=x.queue(e,t),r=n.length,i=n.shift(),o=x._queueHooks(e,t),s=function(){x.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,s,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return q.get(e,n)||q.access(e,n,{empty:x.Callbacks("once memory").add(function(){q.remove(e,[t+"queue",n])})})}}),x.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),n>arguments.length?x.queue(this[0],e):t===undefined?this:this.each(function(){var n=x.queue(this,e,t);x._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&x.dequeue(this,e)})},dequeue:function(e){return this.each(function(){x.dequeue(this,e)})},delay:function(e,t){return e=x.fx?x.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=x.Deferred(),o=this,s=this.length,a=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=undefined),e=e||"fx";while(s--)n=q.get(o[s],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(a));return a(),i.promise(t)}});var R,M,W=/[\t\r\n\f]/g,$=/\r/g,B=/^(?:input|select|textarea|button)$/i;x.fn.extend({attr:function(e,t){return x.access(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){x.removeAttr(this,e)})},prop:function(e,t){return x.access(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[x.propFix[e]||e]})},addClass:function(e){var t,n,r,i,o,s=0,a=this.length,u="string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];a>s;s++)if(n=this[s],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(W," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=x.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,s=0,a=this.length,u=0===arguments.length||"string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];a>s;s++)if(n=this[s],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(W," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?x.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):x.isFunction(e)?this.each(function(n){x(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var t,i=0,o=x(this),s=e.match(w)||[];while(t=s[i++])o.hasClass(t)?o.removeClass(t):o.addClass(t)}else(n===r||"boolean"===n)&&(this.className&&q.set(this,"__className__",this.className),this.className=this.className||e===!1?"":q.get(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(W," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];{if(arguments.length)return r=x.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,x(this).val()):e,null==i?i="":"number"==typeof i?i+="":x.isArray(i)&&(i=x.map(i,function(e){return null==e?"":e+""})),t=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&t.set(this,i,"value")!==undefined||(this.value=i))});if(i)return t=x.valHooks[i.type]||x.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,"string"==typeof n?n.replace($,""):null==n?"":n)}}}),x.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,s=o?null:[],a=o?i+1:r.length,u=0>i?a:o?i:0;for(;a>u;u++)if(n=r[u],!(!n.selected&&u!==i||(x.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&x.nodeName(n.parentNode,"optgroup"))){if(t=x(n).val(),o)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=x.makeArray(t),s=i.length;while(s--)r=i[s],(r.selected=x.inArray(x(r).val(),o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}},attr:function(e,t,n){var i,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===r?x.prop(e,t,n):(1===s&&x.isXMLDoc(e)||(t=t.toLowerCase(),i=x.attrHooks[t]||(x.expr.match.bool.test(t)?M:R)),n===undefined?i&&"get"in i&&null!==(o=i.get(e,t))?o:(o=x.find.attr(e,t),null==o?undefined:o):null!==n?i&&"set"in i&&(o=i.set(e,n,t))!==undefined?o:(e.setAttribute(t,n+""),n):(x.removeAttr(e,t),undefined))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=x.propFix[n]||n,x.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!x.support.radioValue&&"radio"===t&&x.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{for:"htmlFor",class:"className"},prop:function(e,t,n){var r,i,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return o=1!==s||!x.isXMLDoc(e),o&&(t=x.propFix[t]||t,i=x.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||B.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),M={set:function(e,t,n){return t===!1?x.removeAttr(e,n):e.setAttribute(n,n),n}},x.each(x.expr.match.bool.source.match(/\w+/g),function(e,t){var n=x.expr.attrHandle[t]||x.find.attr;x.expr.attrHandle[t]=function(e,t,r){var i=x.expr.attrHandle[t],o=r?undefined:(x.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return x.expr.attrHandle[t]=i,o}}),x.support.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){x.propFix[this.toLowerCase()]=this}),x.each(["radio","checkbox"],function(){x.valHooks[this]={set:function(e,t){return x.isArray(t)?e.checked=x.inArray(x(e).val(),t)>=0:undefined}},x.support.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var I=/^key/,z=/^(?:mouse|contextmenu)|click/,_=/^(?:focusinfocus|focusoutblur)$/,X=/^([^.]*)(?:\.(.+)|)$/;function U(){return!0}function Y(){return!1}function V(){try{return o.activeElement}catch(e){}}x.event={global:{},add:function(e,t,n,i,o){var s,a,u,l,c,p,f,h,d,g,m,y=q.get(e);if(y){n.handler&&(s=n,n=s.handler,o=s.selector),n.guid||(n.guid=x.guid++),(l=y.events)||(l=y.events={}),(a=y.handle)||(a=y.handle=function(e){return typeof x===r||e&&x.event.triggered===e.type?undefined:x.event.dispatch.apply(a.elem,arguments)},a.elem=e),t=(t||"").match(w)||[""],c=t.length;while(c--)u=X.exec(t[c])||[],d=m=u[1],g=(u[2]||"").split(".").sort(),d&&(f=x.event.special[d]||{},d=(o?f.delegateType:f.bindType)||d,f=x.event.special[d]||{},p=x.extend({type:d,origType:m,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&x.expr.match.needsContext.test(o),namespace:g.join(".")},s),(h=l[d])||(h=l[d]=[],h.delegateCount=0,f.setup&&f.setup.call(e,i,g,a)!==!1||e.addEventListener&&e.addEventListener(d,a,!1)),f.add&&(f.add.call(e,p),p.handler.guid||(p.handler.guid=n.guid)),o?h.splice(h.delegateCount++,0,p):h.push(p),x.event.global[d]=!0);e=null}},remove:function(e,t,n,r,i){var o,s,a,u,l,c,p,f,h,d,g,m=q.hasData(e)&&q.get(e);if(m&&(u=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(a=X.exec(t[l])||[],h=g=a[1],d=(a[2]||"").split(".").sort(),h){p=x.event.special[h]||{},h=(r?p.delegateType:p.bindType)||h,f=u[h]||[],a=a[2]&&RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=f.length;while(o--)c=f[o],!i&&g!==c.origType||n&&n.guid!==c.guid||a&&!a.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,p.remove&&p.remove.call(e,c));s&&!f.length&&(p.teardown&&p.teardown.call(e,d,m.handle)!==!1||x.removeEvent(e,h,m.handle),delete u[h])}else for(h in u)x.event.remove(e,h+t[l],n,r,!0);x.isEmptyObject(u)&&(delete m.handle,q.remove(e,"events"))}},trigger:function(t,n,r,i){var s,a,u,l,c,p,f,h=[r||o],d=y.call(t,"type")?t.type:t,g=y.call(t,"namespace")?t.namespace.split("."):[];if(a=u=r=r||o,3!==r.nodeType&&8!==r.nodeType&&!_.test(d+x.event.triggered)&&(d.indexOf(".")>=0&&(g=d.split("."),d=g.shift(),g.sort()),c=0>d.indexOf(":")&&"on"+d,t=t[x.expando]?t:new x.Event(d,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=g.join("."),t.namespace_re=t.namespace?RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=undefined,t.target||(t.target=r),n=null==n?[t]:x.makeArray(n,[t]),f=x.event.special[d]||{},i||!f.trigger||f.trigger.apply(r,n)!==!1)){if(!i&&!f.noBubble&&!x.isWindow(r)){for(l=f.delegateType||d,_.test(l+d)||(a=a.parentNode);a;a=a.parentNode)h.push(a),u=a;u===(r.ownerDocument||o)&&h.push(u.defaultView||u.parentWindow||e)}s=0;while((a=h[s++])&&!t.isPropagationStopped())t.type=s>1?l:f.bindType||d,p=(q.get(a,"events")||{})[t.type]&&q.get(a,"handle"),p&&p.apply(a,n),p=c&&a[c],p&&x.acceptData(a)&&p.apply&&p.apply(a,n)===!1&&t.preventDefault();return t.type=d,i||t.isDefaultPrevented()||f._default&&f._default.apply(h.pop(),n)!==!1||!x.acceptData(r)||c&&x.isFunction(r[d])&&!x.isWindow(r)&&(u=r[c],u&&(r[c]=null),x.event.triggered=d,r[d](),x.event.triggered=undefined,u&&(r[c]=u)),t.result}},dispatch:function(e){e=x.event.fix(e);var t,n,r,i,o,s=[],a=d.call(arguments),u=(q.get(this,"events")||{})[e.type]||[],l=x.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){s=x.event.handlers.call(this,e,u),t=0;while((i=s[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,r=((x.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,a),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,o,s=[],a=t.delegateCount,u=e.target;if(a&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!==this;u=u.parentNode||this)if(u.disabled!==!0||"click"!==e.type){for(r=[],n=0;a>n;n++)o=t[n],i=o.selector+" ",r[i]===undefined&&(r[i]=o.needsContext?x(i,this).index(u)>=0:x.find(i,this,null,[u]).length),r[i]&&r.push(o);r.length&&s.push({elem:u,handlers:r})}return t.length>a&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||o,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||s===undefined||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[x.expando])return e;var t,n,r,i=e.type,s=e,a=this.fixHooks[i];a||(this.fixHooks[i]=a=z.test(i)?this.mouseHooks:I.test(i)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,e=new x.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=o),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==V()&&this.focus?(this.focus(),!1):undefined},delegateType:"focusin"},blur:{trigger:function(){return this===V()&&this.blur?(this.blur(),!1):undefined},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&x.nodeName(this,"input")?(this.click(),!1):undefined},_default:function(e){return x.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=x.extend(new x.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?x.event.trigger(i,null,t):x.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},x.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},x.Event=function(e,t){return this instanceof x.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?U:Y):this.type=e,t&&x.extend(this,t),this.timeStamp=e&&e.timeStamp||x.now(),this[x.expando]=!0,undefined):new x.Event(e,t)},x.Event.prototype={isDefaultPrevented:Y,isPropagationStopped:Y,isImmediatePropagationStopped:Y,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=U,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=U,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=U,this.stopPropagation()}},x.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!x.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),x.support.focusinBubbles||x.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){x.event.simulate(t,e.target,x.event.fix(e),!0)};x.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),x.fn.extend({on:function(e,t,n,r,i){var o,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=undefined);for(s in e)this.on(s,t,n,e[s],i);return this}if(null==n&&null==r?(r=t,n=t=undefined):null==r&&("string"==typeof t?(r=n,n=undefined):(r=n,n=t,t=undefined)),r===!1)r=Y;else if(!r)return this;return 1===i&&(o=r,r=function(e){return x().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=x.guid++)),this.each(function(){x.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,x(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=undefined),n===!1&&(n=Y),this.each(function(){x.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){x.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?x.event.trigger(e,t,n,!0):undefined}});var G=/^.[^:#\[\.,]*$/,J=/^(?:parents|prev(?:Until|All))/,Q=x.expr.match.needsContext,K={children:!0,contents:!0,next:!0,prev:!0};x.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(x(e).filter(function(){for(t=0;i>t;t++)if(x.contains(r[t],this))return!0}));for(t=0;i>t;t++)x.find(e,r[t],n);return n=this.pushStack(i>1?x.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t=x(e,this),n=t.length;return this.filter(function(){var e=0;for(;n>e;e++)if(x.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(et(this,e||[],!0))},filter:function(e){return this.pushStack(et(this,e||[],!1))},is:function(e){return!!et(this,"string"==typeof e&&Q.test(e)?x(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,o=[],s=Q.test(e)||"string"!=typeof e?x(e,t||this.context):0;for(;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(s?s.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){n=o.push(n);break}return this.pushStack(o.length>1?x.unique(o):o)},index:function(e){return e?"string"==typeof e?g.call(x(e),this[0]):g.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?x(e,t):x.makeArray(e&&e.nodeType?[e]:e),r=x.merge(this.get(),n);return this.pushStack(x.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function Z(e,t){while((e=e[t])&&1!==e.nodeType);return e}x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x.dir(e,"parentNode")},parentsUntil:function(e,t,n){return x.dir(e,"parentNode",n)},next:function(e){return Z(e,"nextSibling")},prev:function(e){return Z(e,"previousSibling")},nextAll:function(e){return x.dir(e,"nextSibling")},prevAll:function(e){return x.dir(e,"previousSibling")},nextUntil:function(e,t,n){return x.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return x.dir(e,"previousSibling",n)},siblings:function(e){return x.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return x.sibling(e.firstChild)},contents:function(e){return e.contentDocument||x.merge([],e.childNodes)}},function(e,t){x.fn[e]=function(n,r){var i=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=x.filter(r,i)),this.length>1&&(K[e]||x.unique(i),J.test(e)&&i.reverse()),this.pushStack(i)}}),x.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&x(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function et(e,t,n){if(x.isFunction(t))return x.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return x.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(G.test(t))return x.filter(t,e,n);t=x.filter(t,e)}return x.grep(e,function(e){return g.call(t,e)>=0!==n})}var tt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,nt=/<([\w:]+)/,rt=/<|&#?\w+;/,it=/<(?:script|style|link)/i,ot=/^(?:checkbox|radio)$/i,st=/checked\s*(?:[^=]|=\s*.checked.)/i,at=/^$|\/(?:java|ecma)script/i,ut=/^true\/(.*)/,lt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ct={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ct.optgroup=ct.option,ct.tbody=ct.tfoot=ct.colgroup=ct.caption=ct.thead,ct.th=ct.td,x.fn.extend({text:function(e){return x.access(this,function(e){return e===undefined?x.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=pt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=pt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?x.filter(e,this):this,i=0;for(;null!=(n=r[i]);i++)t||1!==n.nodeType||x.cleanData(mt(n)),n.parentNode&&(t&&x.contains(n.ownerDocument,n)&&dt(mt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++)1===e.nodeType&&(x.cleanData(mt(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return x.clone(this,e,t)})},html:function(e){return x.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!it.test(e)&&!ct[(nt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(tt,"<$1></$2>");try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(x.cleanData(mt(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=x.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),x(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=f.apply([],e);var r,i,o,s,a,u,l=0,c=this.length,p=this,h=c-1,d=e[0],g=x.isFunction(d);if(g||!(1>=c||"string"!=typeof d||x.support.checkClone)&&st.test(d))return this.each(function(r){var i=p.eq(r);g&&(e[0]=d.call(this,r,i.html())),i.domManip(e,t,n)});if(c&&(r=x.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,1===r.childNodes.length&&(r=i),i)){for(o=x.map(mt(r,"script"),ft),s=o.length;c>l;l++)a=r,l!==h&&(a=x.clone(a,!0,!0),s&&x.merge(o,mt(a,"script"))),t.call(this[l],a,l);if(s)for(u=o[o.length-1].ownerDocument,x.map(o,ht),l=0;s>l;l++)a=o[l],at.test(a.type||"")&&!q.access(a,"globalEval")&&x.contains(u,a)&&(a.src?x._evalUrl(a.src):x.globalEval(a.textContent.replace(lt,"")))}return this}}),x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){x.fn[e]=function(e){var n,r=[],i=x(e),o=i.length-1,s=0;for(;o>=s;s++)n=s===o?this:this.clone(!0),x(i[s])[t](n),h.apply(r,n.get());return this.pushStack(r)}}),x.extend({clone:function(e,t,n){var r,i,o,s,a=e.cloneNode(!0),u=x.contains(e.ownerDocument,e);if(!(x.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e)))for(s=mt(a),o=mt(e),r=0,i=o.length;i>r;r++)yt(o[r],s[r]);if(t)if(n)for(o=o||mt(e),s=s||mt(a),r=0,i=o.length;i>r;r++)gt(o[r],s[r]);else gt(e,a);return s=mt(a,"script"),s.length>0&&dt(s,!u&&mt(e,"script")),a},buildFragment:function(e,t,n,r){var i,o,s,a,u,l,c=0,p=e.length,f=t.createDocumentFragment(),h=[];for(;p>c;c++)if(i=e[c],i||0===i)if("object"===x.type(i))x.merge(h,i.nodeType?[i]:i);else if(rt.test(i)){o=o||f.appendChild(t.createElement("div")),s=(nt.exec(i)||["",""])[1].toLowerCase(),a=ct[s]||ct._default,o.innerHTML=a[1]+i.replace(tt,"<$1></$2>")+a[2],l=a[0];while(l--)o=o.lastChild;x.merge(h,o.childNodes),o=f.firstChild,o.textContent=""}else h.push(t.createTextNode(i));f.textContent="",c=0;while(i=h[c++])if((!r||-1===x.inArray(i,r))&&(u=x.contains(i.ownerDocument,i),o=mt(f.appendChild(i),"script"),u&&dt(o),n)){l=0;while(i=o[l++])at.test(i.type||"")&&n.push(i)}return f},cleanData:function(e){var t,n,r,i,o,s,a=x.event.special,u=0;for(;(n=e[u])!==undefined;u++){if(F.accepts(n)&&(o=n[q.expando],o&&(t=q.cache[o]))){if(r=Object.keys(t.events||{}),r.length)for(s=0;(i=r[s])!==undefined;s++)a[i]?x.event.remove(n,i):x.removeEvent(n,i,t.handle);q.cache[o]&&delete q.cache[o]}delete L.cache[n[L.expando]]}},_evalUrl:function(e){return x.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})}});function pt(e,t){return x.nodeName(e,"table")&&x.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function ht(e){var t=ut.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function dt(e,t){var n=e.length,r=0;for(;n>r;r++)q.set(e[r],"globalEval",!t||q.get(t[r],"globalEval"))}function gt(e,t){var n,r,i,o,s,a,u,l;if(1===t.nodeType){if(q.hasData(e)&&(o=q.access(e),s=q.set(t,o),l=o.events)){delete s.handle,s.events={};for(i in l)for(n=0,r=l[i].length;r>n;n++)x.event.add(t,i,l[i][n])}L.hasData(e)&&(a=L.access(e),u=x.extend({},a),L.set(t,u))}}function mt(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&x.nodeName(e,t)?x.merge([e],n):n}function yt(e,t){var n=t.nodeName.toLowerCase();"input"===n&&ot.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}x.fn.extend({wrapAll:function(e){var t;return x.isFunction(e)?this.each(function(t){x(this).wrapAll(e.call(this,t))}):(this[0]&&(t=x(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return x.isFunction(e)?this.each(function(t){x(this).wrapInner(e.call(this,t))}):this.each(function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=x.isFunction(e);return this.each(function(n){x(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){x.nodeName(this,"body")||x(this).replaceWith(this.childNodes)}).end()}});var vt,xt,bt=/^(none|table(?!-c[ea]).+)/,wt=/^margin/,Tt=RegExp("^("+b+")(.*)$","i"),Ct=RegExp("^("+b+")(?!px)[a-z%]+$","i"),kt=RegExp("^([+-])=("+b+")","i"),Nt={BODY:"block"},Et={position:"absolute",visibility:"hidden",display:"block"},St={letterSpacing:0,fontWeight:400},jt=["Top","Right","Bottom","Left"],Dt=["Webkit","O","Moz","ms"];function At(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Dt.length;while(i--)if(t=Dt[i]+n,t in e)return t;return r}function Lt(e,t){return e=t||e,"none"===x.css(e,"display")||!x.contains(e.ownerDocument,e)}function qt(t){return e.getComputedStyle(t,null)}function Ht(e,t){var n,r,i,o=[],s=0,a=e.length;for(;a>s;s++)r=e[s],r.style&&(o[s]=q.get(r,"olddisplay"),n=r.style.display,t?(o[s]||"none"!==n||(r.style.display=""),""===r.style.display&&Lt(r)&&(o[s]=q.access(r,"olddisplay",Rt(r.nodeName)))):o[s]||(i=Lt(r),(n&&"none"!==n||!i)&&q.set(r,"olddisplay",i?n:x.css(r,"display"))));for(s=0;a>s;s++)r=e[s],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[s]||"":"none"));return e}x.fn.extend({css:function(e,t){return x.access(this,function(e,t,n){var r,i,o={},s=0;if(x.isArray(t)){for(r=qt(e),i=t.length;i>s;s++)o[t[s]]=x.css(e,t[s],!1,r);return o}return n!==undefined?x.style(e,t,n):x.css(e,t)},e,t,arguments.length>1)},show:function(){return Ht(this,!0)},hide:function(){return Ht(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Lt(this)?x(this).show():x(this).hide()})}}),x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=vt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,s,a=x.camelCase(t),u=e.style;return t=x.cssProps[a]||(x.cssProps[a]=At(u,a)),s=x.cssHooks[t]||x.cssHooks[a],n===undefined?s&&"get"in s&&(i=s.get(e,!1,r))!==undefined?i:u[t]:(o=typeof n,"string"===o&&(i=kt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(x.css(e,t)),o="number"),null==n||"number"===o&&isNaN(n)||("number"!==o||x.cssNumber[a]||(n+="px"),x.support.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),s&&"set"in s&&(n=s.set(e,n,r))===undefined||(u[t]=n)),undefined)}},css:function(e,t,n,r){var i,o,s,a=x.camelCase(t);return t=x.cssProps[a]||(x.cssProps[a]=At(e.style,a)),s=x.cssHooks[t]||x.cssHooks[a],s&&"get"in s&&(i=s.get(e,!0,n)),i===undefined&&(i=vt(e,t,r)),"normal"===i&&t in St&&(i=St[t]),""===n||n?(o=parseFloat(i),n===!0||x.isNumeric(o)?o||0:i):i}}),vt=function(e,t,n){var r,i,o,s=n||qt(e),a=s?s.getPropertyValue(t)||s[t]:undefined,u=e.style;return s&&(""!==a||x.contains(e.ownerDocument,e)||(a=x.style(e,t)),Ct.test(a)&&wt.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=s.width,u.width=r,u.minWidth=i,u.maxWidth=o)),a};function Ot(e,t,n){var r=Tt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Ft(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,s=0;for(;4>o;o+=2)"margin"===n&&(s+=x.css(e,n+jt[o],!0,i)),r?("content"===n&&(s-=x.css(e,"padding"+jt[o],!0,i)),"margin"!==n&&(s-=x.css(e,"border"+jt[o]+"Width",!0,i))):(s+=x.css(e,"padding"+jt[o],!0,i),"padding"!==n&&(s+=x.css(e,"border"+jt[o]+"Width",!0,i)));return s}function Pt(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=qt(e),s=x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=vt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Ct.test(i))return i;r=s&&(x.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+Ft(e,t,n||(s?"border":"content"),r,o)+"px"}function Rt(e){var t=o,n=Nt[e];return n||(n=Mt(e,t),"none"!==n&&n||(xt=(xt||x("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(xt[0].contentWindow||xt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=Mt(e,t),xt.detach()),Nt[e]=n),n}function Mt(e,t){var n=x(t.createElement(e)).appendTo(t.body),r=x.css(n[0],"display");return n.remove(),r}x.each(["height","width"],function(e,t){x.cssHooks[t]={get:function(e,n,r){return n?0===e.offsetWidth&&bt.test(x.css(e,"display"))?x.swap(e,Et,function(){return Pt(e,t,r)}):Pt(e,t,r):undefined},set:function(e,n,r){var i=r&&qt(e);return Ot(e,n,r?Ft(e,t,r,x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,i),i):0)}}}),x(function(){x.support.reliableMarginRight||(x.cssHooks.marginRight={get:function(e,t){return t?x.swap(e,{display:"inline-block"},vt,[e,"marginRight"]):undefined}}),!x.support.pixelPosition&&x.fn.position&&x.each(["top","left"],function(e,t){x.cssHooks[t]={get:function(e,n){return n?(n=vt(e,t),Ct.test(n)?x(e).position()[t]+"px":n):undefined}}})}),x.expr&&x.expr.filters&&(x.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight},x.expr.filters.visible=function(e){return!x.expr.filters.hidden(e)}),x.each({margin:"",padding:"",border:"Width"},function(e,t){x.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+jt[r]+t]=o[r]||o[r-2]||o[0];return i}},wt.test(e)||(x.cssHooks[e+t].set=Ot)});var Wt=/%20/g,$t=/\[\]$/,Bt=/\r?\n/g,It=/^(?:submit|button|image|reset|file)$/i,zt=/^(?:input|select|textarea|keygen)/i;x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&zt.test(this.nodeName)&&!It.test(e)&&(this.checked||!ot.test(e))}).map(function(e,t){var n=x(this).val();return null==n?null:x.isArray(n)?x.map(n,function(e){return{name:t.name,value:e.replace(Bt,"\r\n")}}):{name:t.name,value:n.replace(Bt,"\r\n")}}).get()}}),x.param=function(e,t){var n,r=[],i=function(e,t){t=x.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(t===undefined&&(t=x.ajaxSettings&&x.ajaxSettings.traditional),x.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,function(){i(this.name,this.value)});else for(n in e)_t(n,e[n],t,i);return r.join("&").replace(Wt,"+")};function _t(e,t,n,r){var i;if(x.isArray(t))x.each(t,function(t,i){n||$t.test(e)?r(e,i):_t(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==x.type(t))r(e,t);else for(i in t)_t(e+"["+i+"]",t[i],n,r)}x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),x.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var Xt,Ut,Yt=x.now(),Vt=/\?/,Gt=/#.*$/,Jt=/([?&])_=[^&]*/,Qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Kt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Zt=/^(?:GET|HEAD)$/,en=/^\/\//,tn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,nn=x.fn.load,rn={},on={},sn="*/".concat("*");try{Ut=i.href}catch(an){Ut=o.createElement("a"),Ut.href="",Ut=Ut.href}Xt=tn.exec(Ut.toLowerCase())||[];function un(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(x.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function ln(e,t,n,r){var i={},o=e===on;function s(a){var u;return i[a]=!0,x.each(e[a]||[],function(e,a){var l=a(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):undefined:(t.dataTypes.unshift(l),s(l),!1)}),u}return s(t.dataTypes[0])||!i["*"]&&s("*")}function cn(e,t){var n,r,i=x.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&x.extend(!0,e,r),e}x.fn.load=function(e,t,n){if("string"!=typeof e&&nn)return nn.apply(this,arguments);var r,i,o,s=this,a=e.indexOf(" ");return a>=0&&(r=e.slice(a),e=e.slice(0,a)),x.isFunction(t)?(n=t,t=undefined):t&&"object"==typeof t&&(i="POST"),s.length>0&&x.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){o=arguments,s.html(r?x("<div>").append(x.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){s.each(n,o||[e.responseText,t,e])}),this},x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){x.fn[t]=function(e){return this.on(t,e)}}),x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ut,type:"GET",isLocal:Kt.test(Xt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":sn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":x.parseJSON,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?cn(cn(e,x.ajaxSettings),t):cn(x.ajaxSettings,e)},ajaxPrefilter:un(rn),ajaxTransport:un(on),ajax:function(e,t){"object"==typeof e&&(t=e,e=undefined),t=t||{};var n,r,i,o,s,a,u,l,c=x.ajaxSetup({},t),p=c.context||c,f=c.context&&(p.nodeType||p.jquery)?x(p):x.event,h=x.Deferred(),d=x.Callbacks("once memory"),g=c.statusCode||{},m={},y={},v=0,b="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(2===v){if(!o){o={};while(t=Qt.exec(i))o[t[1].toLowerCase()]=t[2]}t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===v?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return v||(e=y[n]=y[n]||e,m[e]=t),this},overrideMimeType:function(e){return v||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>v)for(t in e)g[t]=[g[t],e[t]];else T.always(e[T.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),k(0,t),this}};if(h.promise(T).complete=d.add,T.success=T.done,T.error=T.fail,c.url=((e||c.url||Ut)+"").replace(Gt,"").replace(en,Xt[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=x.trim(c.dataType||"*").toLowerCase().match(w)||[""],null==c.crossDomain&&(a=tn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===Xt[1]&&a[2]===Xt[2]&&(a[3]||("http:"===a[1]?"80":"443"))===(Xt[3]||("http:"===Xt[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=x.param(c.data,c.traditional)),ln(rn,c,t,T),2===v)return T;u=c.global,u&&0===x.active++&&x.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Zt.test(c.type),r=c.url,c.hasContent||(c.data&&(r=c.url+=(Vt.test(r)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=Jt.test(r)?r.replace(Jt,"$1_="+Yt++):r+(Vt.test(r)?"&":"?")+"_="+Yt++)),c.ifModified&&(x.lastModified[r]&&T.setRequestHeader("If-Modified-Since",x.lastModified[r]),x.etag[r]&&T.setRequestHeader("If-None-Match",x.etag[r])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&T.setRequestHeader("Content-Type",c.contentType),T.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+sn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)T.setRequestHeader(l,c.headers[l]);if(c.beforeSend&&(c.beforeSend.call(p,T,c)===!1||2===v))return T.abort();b="abort";for(l in{success:1,error:1,complete:1})T[l](c[l]);if(n=ln(on,c,t,T)){T.readyState=1,u&&f.trigger("ajaxSend",[T,c]),c.async&&c.timeout>0&&(s=setTimeout(function(){T.abort("timeout")},c.timeout));try{v=1,n.send(m,k)}catch(C){if(!(2>v))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,t,o,a){var l,m,y,b,w,C=t;2!==v&&(v=2,s&&clearTimeout(s),n=undefined,i=a||"",T.readyState=e>0?4:0,l=e>=200&&300>e||304===e,o&&(b=pn(c,T,o)),b=fn(c,b,T,l),l?(c.ifModified&&(w=T.getResponseHeader("Last-Modified"),w&&(x.lastModified[r]=w),w=T.getResponseHeader("etag"),w&&(x.etag[r]=w)),204===e||"HEAD"===c.type?C="nocontent":304===e?C="notmodified":(C=b.state,m=b.data,y=b.error,l=!y)):(y=C,(e||!C)&&(C="error",0>e&&(e=0))),T.status=e,T.statusText=(t||C)+"",l?h.resolveWith(p,[m,C,T]):h.rejectWith(p,[T,C,y]),T.statusCode(g),g=undefined,u&&f.trigger(l?"ajaxSuccess":"ajaxError",[T,c,l?m:y]),d.fireWith(p,[T,C]),u&&(f.trigger("ajaxComplete",[T,c]),--x.active||x.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,t){return x.get(e,undefined,t,"script")}}),x.each(["get","post"],function(e,t){x[t]=function(e,n,r,i){return x.isFunction(n)&&(i=i||r,r=n,n=undefined),x.ajax({url:e,type:t,dataType:i,data:n,success:r})}});function pn(e,t,n){var r,i,o,s,a=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in a)if(a[i]&&a[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}s||(s=i)}o=o||s}return o?(o!==u[0]&&u.unshift(o),n[o]):undefined}function fn(e,t,n,r){var i,o,s,a,u,l={},c=e.dataTypes.slice();if(c[1])for(s in e.converters)l[s.toLowerCase()]=e.converters[s];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(s=l[u+" "+o]||l["* "+o],!s)for(i in l)if(a=i.split(" "),a[1]===o&&(s=l[u+" "+a[0]]||l["* "+a[0]])){s===!0?s=l[i]:l[i]!==!0&&(o=a[0],c.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(p){return{state:"parsererror",error:s?p:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),x.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=x("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),o.head.appendChild(t[0])},abort:function(){n&&n()}}}});var hn=[],dn=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=hn.pop()||x.expando+"_"+Yt++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,s,a=t.jsonp!==!1&&(dn.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&dn.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=x.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(dn,"$1"+i):t.jsonp!==!1&&(t.url+=(Vt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return s||x.error(i+" was not called"),s[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){s=arguments},r.always(function(){e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,hn.push(i)),s&&x.isFunction(o)&&o(s[0]),s=o=undefined}),"script"):undefined}),x.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var gn=x.ajaxSettings.xhr(),mn={0:200,1223:204},yn=0,vn={};e.ActiveXObject&&x(e).on("unload",function(){for(var e in vn)vn[e]();vn=undefined}),x.support.cors=!!gn&&"withCredentials"in gn,x.support.ajax=gn=!!gn,x.ajaxTransport(function(e){var t;return x.support.cors||gn&&!e.crossDomain?{send:function(n,r){var i,o,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)s.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete vn[o],t=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status||404,s.statusText):r(mn[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:undefined,s.getAllResponseHeaders()))}},s.onload=t(),s.onerror=t("error"),t=vn[o=yn++]=t("abort"),s.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}:undefined});var xn,bn,wn=/^(?:toggle|show|hide)$/,Tn=RegExp("^(?:([+-])=|)("+b+")([a-z%]*)$","i"),Cn=/queueHooks$/,kn=[An],Nn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Tn.exec(t),o=i&&i[3]||(x.cssNumber[e]?"":"px"),s=(x.cssNumber[e]||"px"!==o&&+r)&&Tn.exec(x.css(n.elem,e)),a=1,u=20;if(s&&s[3]!==o){o=o||s[3],i=i||[],s=+r||1;do{a=a||".5",s/=a,x.style(n.elem,e,s+o)}while(a!==(a=n.cur()/r)&&1!==a&&--u)}return i&&(s=n.start=+s||+r||0,n.unit=o,n.end=i[1]?s+(i[1]+1)*i[2]:+i[2]),n}]};function En(){return setTimeout(function(){xn=undefined}),xn=x.now()}function Sn(e,t,n){var r,i=(Nn[t]||[]).concat(Nn["*"]),o=0,s=i.length;for(;s>o;o++)if(r=i[o].call(n,t,e))return r}function jn(e,t,n){var r,i,o=0,s=kn.length,a=x.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=xn||En(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,s=0,u=l.tweens.length;for(;u>s;s++)l.tweens[s].run(o);return a.notifyWith(e,[l,o,n]),1>o&&u?n:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:xn||En(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this}}),c=l.props;for(Dn(c,l.opts.specialEasing);s>o;o++)if(r=kn[o].call(l,e,c,l.opts))return r;return x.map(c,Sn,l),x.isFunction(l.opts.start)&&l.opts.start.call(e,l),x.fx.timer(x.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function Dn(e,t){var n,r,i,o,s;for(n in e)if(r=x.camelCase(n),i=t[r],o=e[n],x.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),s=x.cssHooks[r],s&&"expand"in s){o=s.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}x.Animation=x.extend(jn,{tweener:function(e,t){x.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Nn[n]=Nn[n]||[],Nn[n].unshift(t)},prefilter:function(e,t){t?kn.unshift(e):kn.push(e)}});function An(e,t,n){var r,i,o,s,a,u,l=this,c={},p=e.style,f=e.nodeType&&Lt(e),h=q.get(e,"fxshow");n.queue||(a=x._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,u=a.empty.fire,a.empty.fire=function(){a.unqueued||u()}),a.unqueued++,l.always(function(){l.always(function(){a.unqueued--,x.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===x.css(e,"display")&&"none"===x.css(e,"float")&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",l.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],wn.exec(i)){if(delete t[r],o=o||"toggle"===i,i===(f?"hide":"show")){if("show"!==i||!h||h[r]===undefined)continue;f=!0}c[r]=h&&h[r]||x.style(e,r)}if(!x.isEmptyObject(c)){h?"hidden"in h&&(f=h.hidden):h=q.access(e,"fxshow",{}),o&&(h.hidden=!f),f?x(e).show():l.done(function(){x(e).hide()}),l.done(function(){var t;q.remove(e,"fxshow");for(t in c)x.style(e,t,c[t])});for(r in c)s=Sn(f?h[r]:0,r,l),r in h||(h[r]=s.start,f&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}}function Ln(e,t,n,r,i){return new Ln.prototype.init(e,t,n,r,i)}x.Tween=Ln,Ln.prototype={constructor:Ln,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(x.cssNumber[n]?"":"px")},cur:function(){var e=Ln.propHooks[this.prop];return e&&e.get?e.get(this):Ln.propHooks._default.get(this)},run:function(e){var t,n=Ln.propHooks[this.prop];return this.pos=t=this.options.duration?x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ln.propHooks._default.set(this),this}},Ln.prototype.init.prototype=Ln.prototype,Ln.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=x.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[x.cssProps[e.prop]]||x.cssHooks[e.prop])?x.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Ln.propHooks.scrollTop=Ln.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.each(["toggle","show","hide"],function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(qn(t,!0),e,r,i)}}),x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Lt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=x.isEmptyObject(e),o=x.speed(t,n,r),s=function(){var t=jn(this,x.extend({},e),o);(i||q.get(this,"finish"))&&t.stop(!0)};return s.finish=s,i||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=x.timers,s=q.get(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&Cn.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));(t||!n)&&x.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=q.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=x.timers,s=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function qn(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=jt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}x.each({slideDown:qn("show"),slideUp:qn("hide"),slideToggle:qn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),x.speed=function(e,t,n){var r=e&&"object"==typeof e?x.extend({},e):{complete:n||!n&&t||x.isFunction(e)&&e,duration:e,easing:n&&t||t&&!x.isFunction(t)&&t};return r.duration=x.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in x.fx.speeds?x.fx.speeds[r.duration]:x.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){x.isFunction(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},x.timers=[],x.fx=Ln.prototype.init,x.fx.tick=function(){var e,t=x.timers,n=0;for(xn=x.now();t.length>n;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||x.fx.stop(),xn=undefined},x.fx.timer=function(e){e()&&x.timers.push(e)&&x.fx.start()},x.fx.interval=13,x.fx.start=function(){bn||(bn=setInterval(x.fx.tick,x.fx.interval))},x.fx.stop=function(){clearInterval(bn),bn=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fx.step={},x.expr&&x.expr.filters&&(x.expr.filters.animated=function(e){return x.grep(x.timers,function(t){return e===t.elem}).length}),x.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){x.offset.setOffset(this,e,t)});var t,n,i=this[0],o={top:0,left:0},s=i&&i.ownerDocument;if(s)return t=s.documentElement,x.contains(t,i)?(typeof i.getBoundingClientRect!==r&&(o=i.getBoundingClientRect()),n=Hn(s),{top:o.top+n.pageYOffset-t.clientTop,left:o.left+n.pageXOffset-t.clientLeft}):o},x.offset={setOffset:function(e,t,n){var r,i,o,s,a,u,l,c=x.css(e,"position"),p=x(e),f={};"static"===c&&(e.style.position="relative"),a=p.offset(),o=x.css(e,"top"),u=x.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1,l?(r=p.position(),s=r.top,i=r.left):(s=parseFloat(o)||0,i=parseFloat(u)||0),x.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(f.top=t.top-a.top+s),null!=t.left&&(f.left=t.left-a.left+i),"using"in t?t.using.call(e,f):p.css(f)}},x.fn.extend({position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===x.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),x.nodeName(e[0],"html")||(r=e.offset()),r.top+=x.css(e[0],"borderTopWidth",!0),r.left+=x.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-x.css(n,"marginTop",!0),left:t.left-r.left-x.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s;while(e&&!x.nodeName(e,"html")&&"static"===x.css(e,"position"))e=e.offsetParent;return e||s})}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var r="pageYOffset"===n;x.fn[t]=function(i){return x.access(this,function(t,i,o){var s=Hn(t);return o===undefined?s?s[n]:t[i]:(s?s.scrollTo(r?e.pageXOffset:o,r?o:e.pageYOffset):t[i]=o,undefined)},t,i,arguments.length,null)}});function Hn(e){return x.isWindow(e)?e:9===e.nodeType&&e.defaultView}x.each({Height:"height",Width:"width"},function(e,t){x.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){x.fn[r]=function(r,i){var o=arguments.length&&(n||"boolean"!=typeof r),s=n||(r===!0||i===!0?"margin":"border");return x.access(this,function(t,n,r){var i;return x.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?x.css(t,n,s):x.style(t,n,r,s)},t,o?r:undefined,o,null)}})}),x.fn.size=function(){return this.length},x.fn.andSelf=x.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:"function"==typeof define&&define.amd&&define("jquery",[],function(){return x}),"object"==typeof e&&"object"==typeof e.document&&(e.jQuery=e.$=x)})(window);(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(h=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n})),n?(a.isOver||(a.isOver=1,s._parent=i.helper.parent(),a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),n={},a=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable});var s_account="omniture.suiteall,omniture.scall";var s=s_gi(s_account);s.charSet="ISO-8859-1";s.currencyCode="USD";s.useForcedLinkTracking=false;s.trackDownloadLinks=true;s.trackExternalLinks=true;s.trackInlineStats=true;s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx";s.linkInternalFilters="javascript:,omniture.com";s.linkLeaveQueryString=false;s.linkTrackVars="None";s.linkTrackEvents="None";s.usePlugins=true;function s_doPlugins(s){s.prop18=s.getDaysSinceLastVisit("s_dslv");s.prop19=s.getVisitNum()}s.doPlugins=s_doPlugins;s.getVisitNum=new Function(""+"var s=this,e=new Date(),cval,cvisit,ct=e.getTime(),c='s_vnum',c2='s"+"_invisit';e.setTime(ct+30*24*60*60*1000);cval=s.c_r(c);if(cval){var"+" i=cval.indexOf('&vn='),str=cval.substring(i+4,cval.length),k;}cvis"+"it=s.c_r(c2);if(cvisit){if(str){e.setTime(ct+30*60*1000);s.c_w(c2,'"+"true',e);return str;}else return 'unknown visit number';}else{if(st"+"r){str++;k=cval.substring(0,i);e.setTime(k);s.c_w(c,k+'&vn='+str,e)"+";e.setTime(ct+30*60*1000);s.c_w(c2,'true',e);return str;}else{s.c_w"+"(c,ct+30*24*60*60*1000+'&vn=1',e);e.setTime(ct+30*60*1000);s.c_w(c2"+",'true',e);return 1;}}");s.getDaysSinceLastVisit=new Function("c",""+"var s=this,e=new Date(),es=new Date(),cval,cval_s,cval_ss,ct=e.getT"+"ime(),day=24*60*60*1000,f1,f2,f3,f4,f5;e.setTime(ct+3*365*day);es.s"+"etTime(ct+30*60*1000);f0='Cookies Not Supported';f1='First Visit';f"+"2='More than 30 days';f3='More than 7 days';f4='Less than 7 days';f"+"5='Less than 1 day';cval=s.c_r(c);if(cval.length==0){s.c_w(c,ct,e);"+"s.c_w(c+'_s',f1,es);}else{var d=ct-cval;if(d>30*60*1000){if(d>30*da"+"y){s.c_w(c,ct,e);s.c_w(c+'_s',f2,es);}else if(d<30*day+1 && d>7*day"+"){s.c_w(c,ct,e);s.c_w(c+'_s',f3,es);}else if(d<7*day+1 && d>day){s."+"c_w(c,ct,e);s.c_w(c+'_s',f4,es);}else if(d<day+1){s.c_w(c,ct,e);s.c"+"_w(c+'_s',f5,es);}}else{s.c_w(c,ct,e);cval_ss=s.c_r(c+'_s');s.c_w(c"+"+'_s',cval_ss,es);}}cval_s=s.c_r(c+'_s');if(cval_s.length==0) retur"+"n f0;else if(cval_s!=f1&&cval_s!=f2&&cval_s!=f3&&cval_s!=f4&&cval_s"+"!=f5) return '';else return cval_s;");s.visitorNamespace="omniture";s.trackingServer="metrics.omniture.com";s.trackingServerSecure="smetrics.omniture.com";var s_code="",s_objectID;function s_gi(un,pg,ss){var c="s.version='H.25.2';s.an=s_an;s.logDebug=function(m){var s=this,tcf=new Function('var e;try{console.log(\"'+s.rep(s.rep(s.rep(m,\"\\\\\",\"\\\\"+'\\\\"),"\\n","\\\\n"),"\\"","\\\\\\"")+\'");}catch(e){}\');tcf()};s.cls=function(x,c){var i,y=\'\';if(!c)c=this.an;for(i=0;i<x.length;i++){n=x.substring(i,i+1);if(c.indexOf(n)>=0)y+=n}retur'+"n y};s.fl=function(x,l){return x?(''+x).substring(0,l):x};s.co=function(o){return o};s.num=function(x){x=''+x;for(var p=0;p<x.length;p++)if(('0123456789').indexOf(x.substring(p,p+1))<0)return 0;ret"+"urn 1};s.rep=s_rep;s.sp=s_sp;s.jn=s_jn;s.ape=function(x){var s=this,h='0123456789ABCDEF',f=\"+~!*()'\",i,c=s.charSet,n,l,e,y='';c=c?c.toUpperCase():'';if(x){x=''+x;if(s.em==3){x=encodeURIComponent("+"x);for(i=0;i<f.length;i++) {n=f.substring(i,i+1);if(x.indexOf(n)>=0)x=s.rep(x,n,\"%\"+n.charCodeAt(0).toString(16).toUpperCase())}}else if(c=='AUTO'&&('').charCodeAt){for(i=0;i<x.length;i++){c=x.su"+"bstring(i,i+1);n=x.charCodeAt(i);if(n>127){l=0;e='';while(n||l<4){e=h.substring(n%16,n%16+1)+e;n=(n-n%16)/16;l++}y+='%u'+e}else if(c=='+')y+='%2B';else y+=escape(c)}x=y}else x=s.rep(escape(''+x),'+"+"','%2B');if(c&&c!='AUTO'&&s.em==1&&x.indexOf('%u')<0&&x.indexOf('%U')<0){i=x.indexOf('%');while(i>=0){i++;if(h.substring(8).indexOf(x.substring(i,i+1).toUpperCase())>=0)return x.substring(0,i)+'u00"+"'+x.substring(i);i=x.indexOf('%',i)}}}return x};s.epa=function(x){var s=this;if(x){x=s.rep(''+x,'+',' ');return s.em==3?decodeURIComponent(x):unescape(x)}return x};s.pt=function(x,d,f,a){var s=this"+",t=x,z=0,y,r;while(t){y=t.indexOf(d);y=y<0?t.length:y;t=t.substring(0,y);r=s[f](t,a);if(r)return r;z+=y+d.length;t=x.substring(z,x.length);t=z<x.length?t:''}return ''};s.isf=function(t,a){var c=a.i"+"ndexOf(':');if(c>=0)a=a.substring(0,c);c=a.indexOf('=');if(c>=0)a=a.substring(0,c);if(t.substring(0,2)=='s_')t=t.substring(2);return (t!=''&&t==a)};s.fsf=function(t,a){var s=this;if(s.pt(a,',','isf"+"',t))s.fsg+=(s.fsg!=''?',':'')+t;return 0};s.fs=function(x,f){var s=this;s.fsg='';s.pt(x,',','fsf',f);return s.fsg};s.mpc=function(m,a){var s=this,c,l,n,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVi"+"sibilityState;if(v&&v=='prerender'){if(!s.mpq){s.mpq=new Array;l=s.sp('webkitvisibilitychange,visibilitychange',',');for(n=0;n<l.length;n++){s.d.addEventListener(l[n],new Function('var s=s_c_il['+s"+"._in+'],c,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVisibilityState;if(s.mpq&&v==\"visible\"){while(s.mpq.length>0){c=s.mpq.shift();s[c.m].apply(s,c.a)}s.mpq=0}'),false)}}c=new Object;c.m=m;c.a=a;s"+".mpq.push(c);return 1}return 0};s.si=function(){var s=this,i,k,v,c=s_gi+'var s=s_gi(\"'+s.oun+'\");s.sa(\"'+s.un+'\");';for(i=0;i<s.va_g.length;i++){k=s.va_g[i];v=s[k];if(v!=undefined){if(typeof(v)"+"!='number')c+='s.'+k+'=\"'+s_fe(v)+'\";';else c+='s.'+k+'='+v+';'}}c+=\"s.lnk=s.eo=s.linkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';\";return c};s.c_d='';s.c_gdf=function(t,"+"a){var s=this;if(!s.num(t))return 1;return 0};s.c_gd=function(){var s=this,d=s.wd.location.hostname,n=s.fpCookieDomainPeriods,p;if(!n)n=s.cookieDomainPeriods;if(d&&!s.c_d){n=n?parseInt(n):2;n=n>2?n"+":2;p=d.lastIndexOf('.');if(p>=0){while(p>=0&&n>1){p=d.lastIndexOf('.',p-1);n--}s.c_d=p>0&&s.pt(d,'.','c_gdf',0)?d.substring(p):d}}return s.c_d};s.c_r=function(k){var s=this;k=s.ape(k);var c=' '+s.d"+".cookie,i=c.indexOf(' '+k+'='),e=i<0?i:c.indexOf(';',i),v=i<0?'':s.epa(c.substring(i+2+k.length,e<0?c.length:e));return v!='[[B]]'?v:''};s.c_w=function(k,v,e){var s=this,d=s.c_gd(),l=s.cookieLifeti"+"me,t;v=''+v;l=l?(''+l).toUpperCase():'';if(e&&l!='SESSION'&&l!='NONE'){t=(v!=''?parseInt(l?l:0):-60);if(t){e=new Date;e.setTime(e.getTime()+(t*1000))}}if(k&&l!='NONE'){s.d.cookie=k+'='+s.ape(v!=''?"+"v:'[[B]]')+'; path=/;'+(e&&l!='SESSION'?' expires='+e.toGMTString()+';':'')+(d?' domain='+d+';':'');return s.c_r(k)==v}return 0};s.eh=function(o,e,r,f){var s=this,b='s_'+e+'_'+s._in,n=-1,l,i,x;if(!"+"s.ehl)s.ehl=new Array;l=s.ehl;for(i=0;i<l.length&&n<0;i++){if(l[i].o==o&&l[i].e==e)n=i}if(n<0){n=i;l[n]=new Object}x=l[n];x.o=o;x.e=e;f=r?x.b:f;if(r||f){x.b=r?0:o[e];x.o[e]=f}if(x.b){x.o[b]=x.b;ret"+"urn b}return 0};s.cet=function(f,a,t,o,b){var s=this,r,tcf;if(s.apv>=5&&(!s.isopera||s.apv>=7)){tcf=new Function('s','f','a','t','var e,r;try{r=s[f](a)}catch(e){r=s[t](e)}return r');r=tcf(s,f,a,t)}"+"else{if(s.ismac&&s.u.indexOf('MSIE 4')>=0)r=s[b](a);else{s.eh(s.wd,'onerror',0,o);r=s[f](a);s.eh(s.wd,'onerror',1)}}return r};s.gtfset=function(e){var s=this;return s.tfs};s.gtfsoe=new Function('e'"+",'var s=s_c_il['+s._in+'],c;s.eh(window,\"onerror\",1);s.etfs=1;c=s.t();if(c)s.d.write(c);s.etfs=0;return true');s.gtfsfb=function(a){return window};s.gtfsf=function(w){var s=this,p=w.parent,l=w.lo"+"cation;s.tfs=w;if(p&&p.location!=l&&p.location.host==l.host){s.tfs=p;return s.gtfsf(s.tfs)}return s.tfs};s.gtfs=function(){var s=this;if(!s.tfs){s.tfs=s.wd;if(!s.etfs)s.tfs=s.cet('gtfsf',s.tfs,'gtf"+"set',s.gtfsoe,'gtfsfb')}return s.tfs};s.mrq=function(u){var s=this,l=s.rl[u],n,r;s.rl[u]=0;if(l)for(n=0;n<l.length;n++){r=l[n];s.mr(0,0,r.r,r.t,r.u)}};s.flushBufferedRequests=function(){};s.mr=func"+"tion(sess,q,rs,ta,u){var s=this,dc=s.dc,t1=s.trackingServer,t2=s.trackingServerSecure,tb=s.trackingServerBase,p='.sc',ns=s.visitorNamespace,un=s.cls(u?u:(ns?ns:s.fun)),r=new Object,l,imn='s_i_'+(un"+"),im,b,e;if(!rs){if(t1){if(t2&&s.ssl)t1=t2}else{if(!tb)tb='2o7.net';if(dc)dc=(''+dc).toLowerCase();else dc='d1';if(tb=='2o7.net'){if(dc=='d1')dc='112';else if(dc=='d2')dc='122';p=''}t1=un+'.'+dc+'."+"'+p+tb}rs='http'+(s.ssl?'s':'')+'://'+t1+'/b/ss/'+s.un+'/'+(s.mobile?'5.1':'1')+'/'+s.version+(s.tcn?'T':'')+'/'+sess+'?AQB=1&ndh=1'+(q?q:'')+'&AQE=1';if(s.isie&&!s.ismac)rs=s.fl(rs,2047)}if(s.d.im"+"ages&&s.apv>=3&&(!s.isopera||s.apv>=7)&&(s.ns6<0||s.apv>=6.1)){if(!s.rc)s.rc=new Object;if(!s.rc[un]){s.rc[un]=1;if(!s.rl)s.rl=new Object;s.rl[un]=new Array;setTimeout('if(window.s_c_il)window.s_c_"+"il['+s._in+'].mrq(\"'+un+'\")',750)}else{l=s.rl[un];if(l){r.t=ta;r.u=un;r.r=rs;l[l.length]=r;return ''}imn+='_'+s.rc[un];s.rc[un]++}if(s.debugTracking){var d='AppMeasurement Debug: '+rs,dl=s.sp(rs,"+"'&'),dln;for(dln=0;dln<dl.length;dln++)d+=\"\\n\\t\"+s.epa(dl[dln]);s.logDebug(d)}im=s.wd[imn];if(!im)im=s.wd[imn]=new Image;im.s_l=0;im.onload=new Function('e','this.s_l=1;var wd=window,s;if(wd.s_"+"c_il){s=wd.s_c_il['+s._in+'];s.bcr();s.mrq(\"'+un+'\");s.nrs--;if(!s.nrs)s.m_m(\"rr\")}');if(!s.nrs){s.nrs=1;s.m_m('rs')}else s.nrs++;im.src=rs;if(s.useForcedLinkTracking||s.bcf){if(!s.forcedLinkTr"+"ackingTimeout)s.forcedLinkTrackingTimeout=250;setTimeout('var wd=window,s;if(wd.s_c_il){s=wd.s_c_il['+s._in+'];s.bcr()}',s.forcedLinkTrackingTimeout);}else if((s.lnk||s.eo)&&(!ta||ta=='_self'||ta=="+"'_top'||(s.wd.name&&ta==s.wd.name))){b=e=new Date;while(!im.s_l&&e.getTime()-b.getTime()<500)e=new Date}return ''}return '<im'+'g sr'+'c=\"'+rs+'\" width=1 height=1 border=0 alt=\"\">'};s.gg=functi"+"on(v){var s=this;if(!s.wd['s_'+v])s.wd['s_'+v]='';return s.wd['s_'+v]};s.glf=function(t,a){if(t.substring(0,2)=='s_')t=t.substring(2);var s=this,v=s.gg(t);if(v)s[t]=v};s.gl=function(v){var s=this;i"+"f(s.pg)s.pt(v,',','glf',0)};s.rf=function(x){var s=this,y,i,j,h,p,l=0,q,a,b='',c='',t;if(x&&x.length>255){y=''+x;i=y.indexOf('?');if(i>0){q=y.substring(i+1);y=y.substring(0,i);h=y.toLowerCase();j=0"+";if(h.substring(0,7)=='http://')j+=7;else if(h.substring(0,8)=='https://')j+=8;i=h.indexOf(\"/\",j);if(i>0){h=h.substring(j,i);p=y.substring(i);y=y.substring(0,i);if(h.indexOf('google')>=0)l=',q,ie"+",start,search_key,word,kw,cd,';else if(h.indexOf('yahoo.co')>=0)l=',p,ei,';if(l&&q){a=s.sp(q,'&');if(a&&a.length>1){for(j=0;j<a.length;j++){t=a[j];i=t.indexOf('=');if(i>0&&l.indexOf(','+t.substring"+"(0,i)+',')>=0)b+=(b?'&':'')+t;else c+=(c?'&':'')+t}if(b&&c)q=b+'&'+c;else c=''}i=253-(q.length-c.length)-y.length;x=y+(i>0?p.substring(0,i):'')+'?'+q}}}}return x};s.s2q=function(k,v,vf,vfp,f){var s"+"=this,qs='',sk,sv,sp,ss,nke,nk,nf,nfl=0,nfn,nfm;if(k==\"contextData\")k=\"c\";if(v){for(sk in v)if((!f||sk.substring(0,f.length)==f)&&v[sk]&&(!vf||vf.indexOf(','+(vfp?vfp+'.':'')+sk+',')>=0)&&(!Obj"+"ect||!Object.prototype||!Object.prototype[sk])){nfm=0;if(nfl)for(nfn=0;nfn<nfl.length;nfn++)if(sk.substring(0,nfl[nfn].length)==nfl[nfn])nfm=1;if(!nfm){if(qs=='')qs+='&'+k+'.';sv=v[sk];if(f)sk=sk.s"+"ubstring(f.length);if(sk.length>0){nke=sk.indexOf('.');if(nke>0){nk=sk.substring(0,nke);nf=(f?f:'')+nk+'.';if(!nfl)nfl=new Array;nfl[nfl.length]=nf;qs+=s.s2q(nk,v,vf,vfp,nf)}else{if(typeof(sv)=='bo"+"olean'){if(sv)sv='true';else sv='false'}if(sv){if(vfp=='retrieveLightData'&&f.indexOf('.contextData.')<0){sp=sk.substring(0,4);ss=sk.substring(4);if(sk=='transactionID')sk='xact';else if(sk=='chann"+"el')sk='ch';else if(sk=='campaign')sk='v0';else if(s.num(ss)){if(sp=='prop')sk='c'+ss;else if(sp=='eVar')sk='v'+ss;else if(sp=='list')sk='l'+ss;else if(sp=='hier'){sk='h'+ss;sv=sv.substring(0,255)}"+"}}qs+='&'+s.ape(sk)+'='+s.ape(sv)}}}}}if(qs!='')qs+='&.'+k}return qs};s.hav=function(){var s=this,qs='',l,fv='',fe='',mn,i,e;if(s.lightProfileID){l=s.va_m;fv=s.lightTrackVars;if(fv)fv=','+fv+','+s."+"vl_mr+','}else{l=s.va_t;if(s.pe||s.linkType){fv=s.linkTrackVars;fe=s.linkTrackEvents;if(s.pe){mn=s.pe.substring(0,1).toUpperCase()+s.pe.substring(1);if(s[mn]){fv=s[mn].trackVars;fe=s[mn].trackEvent"+"s}}}if(fv)fv=','+fv+','+s.vl_l+','+s.vl_l2;if(fe){fe=','+fe+',';if(fv)fv+=',events,'}if (s.events2)e=(e?',':'')+s.events2}for(i=0;i<l.length;i++){var k=l[i],v=s[k],b=k.substring(0,4),x=k.substring("+"4),n=parseInt(x),q=k;if(!v)if(k=='events'&&e){v=e;e=''}if(v&&(!fv||fv.indexOf(','+k+',')>=0)&&k!='linkName'&&k!='linkType'){if(k=='timestamp')q='ts';else if(k=='dynamicVariablePrefix')q='D';else if"+"(k=='visitorID')q='vid';else if(k=='pageURL'){q='g';v=s.fl(v,255)}else if(k=='referrer'){q='r';v=s.fl(s.rf(v),255)}else if(k=='vmk'||k=='visitorMigrationKey')q='vmt';else if(k=='visitorMigrationSer"+"ver'){q='vmf';if(s.ssl&&s.visitorMigrationServerSecure)v=''}else if(k=='visitorMigrationServerSecure'){q='vmf';if(!s.ssl&&s.visitorMigrationServer)v=''}else if(k=='charSet'){q='ce';if(v.toUpperCase"+"()=='AUTO')v='ISO8859-1';else if(s.em==2||s.em==3)v='UTF-8'}else if(k=='visitorNamespace')q='ns';else if(k=='cookieDomainPeriods')q='cdp';else if(k=='cookieLifetime')q='cl';else if(k=='variableProv"+"ider')q='vvp';else if(k=='currencyCode')q='cc';else if(k=='channel')q='ch';else if(k=='transactionID')q='xact';else if(k=='campaign')q='v0';else if(k=='resolution')q='s';else if(k=='colorDepth')q='"+"c';else if(k=='javascriptVersion')q='j';else if(k=='javaEnabled')q='v';else if(k=='cookiesEnabled')q='k';else if(k=='browserWidth')q='bw';else if(k=='browserHeight')q='bh';else if(k=='connectionTyp"+"e')q='ct';else if(k=='homepage')q='hp';else if(k=='plugins')q='p';else if(k=='events'){if(e)v+=(v?',':'')+e;if(fe)v=s.fs(v,fe)}else if(k=='events2')v='';else if(k=='contextData'){qs+=s.s2q('c',s[k]"+",fv,k,0);v=''}else if(k=='lightProfileID')q='mtp';else if(k=='lightStoreForSeconds'){q='mtss';if(!s.lightProfileID)v=''}else if(k=='lightIncrementBy'){q='mti';if(!s.lightProfileID)v=''}else if(k=='"+"retrieveLightProfiles')q='mtsr';else if(k=='deleteLightProfiles')q='mtsd';else if(k=='retrieveLightData'){if(s.retrieveLightProfiles)qs+=s.s2q('mts',s[k],fv,k,0);v=''}else if(s.num(x)){if(b=='prop'"+")q='c'+n;else if(b=='eVar')q='v'+n;else if(b=='list')q='l'+n;else if(b=='hier'){q='h'+n;v=s.fl(v,255)}}if(v)qs+='&'+s.ape(q)+'='+(k.substring(0,3)!='pev'?s.ape(v):v)}}return qs};s.ltdf=function(t,h"+"){t=t?t.toLowerCase():'';h=h?h.toLowerCase():'';var qi=h.indexOf('?');h=qi>=0?h.substring(0,qi):h;if(t&&h.substring(h.length-(t.length+1))=='.'+t)return 1;return 0};s.ltef=function(t,h){t=t?t.toLow"+"erCase():'';h=h?h.toLowerCase():'';if(t&&h.indexOf(t)>=0)return 1;return 0};s.lt=function(h){var s=this,lft=s.linkDownloadFileTypes,lef=s.linkExternalFilters,lif=s.linkInternalFilters;lif=lif?lif:s"+".wd.location.hostname;h=h.toLowerCase();if(s.trackDownloadLinks&&lft&&s.pt(lft,',','ltdf',h))return 'd';if(s.trackExternalLinks&&h.substring(0,1)!='#'&&(lef||lif)&&(!lef||s.pt(lef,',','ltef',h))&&("+"!lif||!s.pt(lif,',','ltef',h)))return 'e';return ''};s.lc=new Function('e','var s=s_c_il['+s._in+'],b=s.eh(this,\"onclick\");s.lnk=this;s.t();s.lnk=0;if(b)return this[b](e);return true');s.bcr=func"+"tion(){var s=this;if(s.bct&&s.bce)s.bct.dispatchEvent(s.bce);if(s.bcf){if(typeof(s.bcf)=='function')s.bcf();else if(s.bct&&s.bct.href)s.d.location=s.bct.href}s.bct=s.bce=s.bcf=0};s.bc=new Function("+"'e','if(e&&e.s_fe)return;var s=s_c_il['+s._in+'],f,tcf,t,n;if(s.d&&s.d.all&&s.d.all.cppXYctnr)return;if(!s.bbc)s.useForcedLinkTracking=0;else if(!s.useForcedLinkTracking){s.b.removeEventListener(\""+'click",s.bc,true);s.bbc=s.useForcedLinkTracking=0;return}else s.b.removeEventListener("click",s.bc,false);s.eo=e.srcElement?e.srcElement:e.target;s.t();s.eo=0;if(s.nrs>0&&s.useForcedLinkTracking'+"&&e.target){t=e.target.target;if(e.target.dispatchEvent&&(!t||t==\\'_self\\'||t==\\'_top\\'||(s.wd.name&&t==s.wd.name))){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();n=s.d.cr"+'eateEvent("MouseEvents");n.initMouseEvent("click",e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget'+");n.s_fe=1;s.bct=e.target;s.bce=n;}}');s.oh=function(o){var s=this,l=s.wd.location,h=o.href?o.href:'',i,j,k,p;i=h.indexOf(':');j=h.indexOf('?');k=h.indexOf('/');if(h&&(i<0||(j>=0&&i>j)||(k>=0&&i>k)"+")){p=o.protocol&&o.protocol.length>1?o.protocol:(l.protocol?l.protocol:'');i=l.pathname.lastIndexOf('/');h=(p?p+'//':'')+(o.host?o.host:(l.host?l.host:''))+(h.substring(0,1)!='/'?l.pathname.substri"+"ng(0,i<0?0:i)+'/':'')+h}return h};s.ot=function(o){var t=o.tagName;if(o.tagUrn||(o.scopeName&&o.scopeName.toUpperCase()!='HTML'))return '';t=t&&t.toUpperCase?t.toUpperCase():'';if(t=='SHAPE')t='';i"+"f(t){if((t=='INPUT'||t=='BUTTON')&&o.type&&o.type.toUpperCase)t=o.type.toUpperCase();else if(!t&&o.href)t='A';}return t};s.oid=function(o){var s=this,t=s.ot(o),p,c,n='',x=0;if(t&&!o.s_oid){p=o.prot"+"ocol;c=o.onclick;if(o.href&&(t=='A'||t=='AREA')&&(!c||!p||p.toLowerCase().indexOf('javascript')<0))n=s.oh(o);else if(c){n=s.rep(s.rep(s.rep(s.rep(''+c,\"\\r\",''),\"\\n\",''),\"\\t\",''),' ','');x="+"2}else if(t=='INPUT'||t=='SUBMIT'){if(o.value)n=o.value;else if(o.innerText)n=o.innerText;else if(o.textContent)n=o.textContent;x=3}else if(o.src&&t=='IMAGE')n=o.src;if(n){o.s_oid=s.fl(n,100);o.s_o"+"idt=x}}return o.s_oid};s.rqf=function(t,un){var s=this,e=t.indexOf('='),u=e>=0?t.substring(0,e):'',q=e>=0?s.epa(t.substring(e+1)):'';if(u&&q&&(','+u+',').indexOf(','+un+',')>=0){if(u!=s.un&&s.un.in"+"dexOf(',')>=0)q='&u='+u+q+'&u=0';return q}return ''};s.rq=function(un){if(!un)un=this.un;var s=this,c=un.indexOf(','),v=s.c_r('s_sq'),q='';if(c<0)return s.pt(v,'&','rqf',un);return s.pt(un,',','rq'"+",0)};s.sqp=function(t,a){var s=this,e=t.indexOf('='),q=e<0?'':s.epa(t.substring(e+1));s.sqq[q]='';if(e>=0)s.pt(t.substring(0,e),',','sqs',q);return 0};s.sqs=function(un,q){var s=this;s.squ[un]=q;re"+"turn 0};s.sq=function(q){var s=this,k='s_sq',v=s.c_r(k),x,c=0;s.sqq=new Object;s.squ=new Object;s.sqq[q]='';s.pt(v,'&','sqp',0);s.pt(s.un,',','sqs',q);v='';for(x in s.squ)if(x&&(!Object||!Object.pr"+"ototype||!Object.prototype[x]))s.sqq[s.squ[x]]+=(s.sqq[s.squ[x]]?',':'')+x;for(x in s.sqq)if(x&&(!Object||!Object.prototype||!Object.prototype[x])&&s.sqq[x]&&(x==q||c<2)){v+=(v?'&':'')+s.sqq[x]+'='"+"+s.ape(x);c++}return s.c_w(k,v,0)};s.wdl=new Function('e','var s=s_c_il['+s._in+'],r=true,b=s.eh(s.wd,\"onload\"),i,o,oc;if(b)r=this[b](e);for(i=0;i<s.d.links.length;i++){o=s.d.links[i];oc=o.onclic"+'k?""+o.onclick:"";if((oc.indexOf("s_gs(")<0||oc.indexOf(".s_oc(")>=0)&&oc.indexOf(".tl(")<0)s.eh(o,"onclick",0,s.lc);}return r\');s.wds=function(){var s=this;if(s.apv>3&&(!s.isie||!s.ism'+"ac||s.apv>=5)){if(s.b&&s.b.attachEvent)s.b.attachEvent('onclick',s.bc);else if(s.b&&s.b.addEventListener){if(s.n&&s.n.userAgent.indexOf('WebKit')>=0&&s.d.createEvent){s.bbc=1;s.useForcedLinkTrackin"+"g=1;s.b.addEventListener('click',s.bc,true)}s.b.addEventListener('click',s.bc,false)}else s.eh(s.wd,'onload',0,s.wdl)}};s.vs=function(x){var s=this,v=s.visitorSampling,g=s.visitorSamplingGroup,k='s"+"_vsn_'+s.un+(g?'_'+g:''),n=s.c_r(k),e=new Date,y=e.getYear();e.setYear(y+10+(y<1900?1900:0));if(v){v*=100;if(!n){if(!s.c_w(k,x,e))return 0;n=x}if(n%10000>v)return 0}return 1};s.dyasmf=function(t,m)"+"{if(t&&m&&m.indexOf(t)>=0)return 1;return 0};s.dyasf=function(t,m){var s=this,i=t?t.indexOf('='):-1,n,x;if(i>=0&&m){var n=t.substring(0,i),x=t.substring(i+1);if(s.pt(x,',','dyasmf',m))return n}retu"+"rn 0};s.uns=function(){var s=this,x=s.dynamicAccountSelection,l=s.dynamicAccountList,m=s.dynamicAccountMatch,n,i;s.un=s.un.toLowerCase();if(x&&l){if(!m)m=s.wd.location.host;if(!m.toLowerCase)m=''+m"+";l=l.toLowerCase();m=m.toLowerCase();n=s.pt(l,';','dyasf',m);if(n)s.un=n}i=s.un.indexOf(',');s.fun=i<0?s.un:s.un.substring(0,i)};s.sa=function(un){var s=this;if(s.un&&s.mpc('sa',arguments))return;s"+".un=un;if(!s.oun)s.oun=un;else if((','+s.oun+',').indexOf(','+un+',')<0)s.oun+=','+un;s.uns()};s.m_i=function(n,a){var s=this,m,f=n.substring(0,1),r,l,i;if(!s.m_l)s.m_l=new Object;if(!s.m_nl)s.m_nl"+"=new Array;m=s.m_l[n];if(!a&&m&&m._e&&!m._i)s.m_a(n);if(!m){m=new Object,m._c='s_m';m._in=s.wd.s_c_in;m._il=s._il;m._il[m._in]=m;s.wd.s_c_in++;m.s=s;m._n=n;m._l=new Array('_c','_in','_il','_i','_e'"+",'_d','_dl','s','n','_r','_g','_g1','_t','_t1','_x','_x1','_rs','_rr','_l');s.m_l[n]=m;s.m_nl[s.m_nl.length]=n}else if(m._r&&!m._m){r=m._r;r._m=m;l=m._l;for(i=0;i<l.length;i++)if(m[l[i]])r[l[i]]=m["+"l[i]];r._il[r._in]=r;m=s.m_l[n]=r}if(f==f.toUpperCase())s[n]=m;return m};s.m_a=new Function('n','g','e','if(!g)g=\"m_\"+n;var s=s_c_il['+s._in+'],c=s[g+\"_c\"],m,x,f=0;if(s.mpc(\"m_a\",arguments))r"+'eturn;if(!c)c=s.wd["s_"+g+"_c"];if(c&&s_d)s[g]=new Function("s",s_ft(s_d(c)));x=s[g];if(!x)x=s.wd[\\\'s_\\\'+g];if(!x)x=s.wd[g];m=s.m_i(n,1);if(x&&(!m._i||g!="m_"+n)){m._i=f=1;if((""+x).ind'+"exOf(\"function\")>=0)x(s);else s.m_m(\"x\",n,x,e)}m=s.m_i(n,1);if(m._dl)m._dl=m._d=0;s.dlt();return f');s.m_m=function(t,n,d,e){t='_'+t;var s=this,i,x,m,f='_'+t,r=0,u;if(s.m_l&&s.m_nl)for(i=0;i<s."+"m_nl.length;i++){x=s.m_nl[i];if(!n||x==n){m=s.m_i(x);u=m[t];if(u){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t](d,e);else if(d)u=m[t](d);else u=m[t]()}}if(u)r=1;u=m[t+1];if(u&&!m[f]){if((''+u).i"+"ndexOf('function')>=0){if(d&&e)u=m[t+1](d,e);else if(d)u=m[t+1](d);else u=m[t+1]()}}m[f]=1;if(u)r=1}}return r};s.m_ll=function(){var s=this,g=s.m_dl,i,o;if(g)for(i=0;i<g.length;i++){o=g[i];if(o)s.l"+"oadModule(o.n,o.u,o.d,o.l,o.e,1);g[i]=0}};s.loadModule=function(n,u,d,l,e,ln){var s=this,m=0,i,g,o=0,f1,f2,c=s.h?s.h:s.b,b,tcf;if(n){i=n.indexOf(':');if(i>=0){g=n.substring(i+1);n=n.substring(0,i)}"+"else g=\"m_\"+n;m=s.m_i(n)}if((l||(n&&!s.m_a(n,g)))&&u&&s.d&&c&&s.d.createElement){if(d){m._d=1;m._dl=1}if(ln){if(s.ssl)u=s.rep(u,'http:','https:');i='s_s:'+s._in+':'+n+':'+g;b='var s=s_c_il['+s._i"+"n+'],o=s.d.getElementById(\"'+i+'\");if(s&&o){if(!o.l&&s.wd.'+g+'){o.l=1;if(o.i)clearTimeout(o.i);o.i=0;s.m_a(\"'+n+'\",\"'+g+'\"'+(e?',\"'+e+'\"':'')+')}';f2=b+'o.c++;if(!s.maxDelay)s.maxDelay=250"+";if(!o.l&&o.c<(s.maxDelay*2)/100)o.i=setTimeout(o.f2,100)}';f1=new Function('e',b+'}');tcf=new Function('s','c','i','u','f1','f2','var e,o=0;try{o=s.d.createElement(\"script\");if(o){o.type=\"text/"+"javascript\";'+(n?'o.id=i;o.defer=true;o.onload=o.onreadystatechange=f1;o.f2=f2;o.l=0;':'')+'o.src=u;c.appendChild(o);'+(n?'o.c=0;o.i=setTimeout(f2,100)':'')+'}}catch(e){o=0}return o');o=tcf(s,c,i,"+"u,f1,f2)}else{o=new Object;o.n=n+':'+g;o.u=u;o.d=d;o.l=l;o.e=e;g=s.m_dl;if(!g)g=s.m_dl=new Array;i=0;while(i<g.length&&g[i])i++;g[i]=o}}else if(n){m=s.m_i(n);m._e=1}return m};s.voa=function(vo,r){v"+'ar s=this,l=s.va_g,i,k,v,x;for(i=0;i<l.length;i++){k=l[i];v=vo[k];if(v||vo[\'!\'+k]){if(!r&&(k=="contextData"||k=="retrieveLightData")&&s[k])for(x in s[k])if(!v[x])v[x]=s[k][x];s[k]=v}}};s.vob=fu'+"nction(vo){var s=this,l=s.va_g,i,k;for(i=0;i<l.length;i++){k=l[i];vo[k]=s[k];if(!vo[k])vo['!'+k]=1}};s.dlt=new Function('var s=s_c_il['+s._in+'],d=new Date,i,vo,f=0;if(s.dll)for(i=0;i<s.dll.length;"+'i++){vo=s.dll[i];if(vo){if(!s.m_m("d")||d.getTime()-vo._t>=s.maxDelay){s.dll[i]=0;s.t(vo)}else f=1}}if(s.dli)clearTimeout(s.dli);s.dli=0;if(f){if(!s.dli)s.dli=setTimeout(s.dlt,s.maxDelay)}else s.'+"dll=0');s.dl=function(vo){var s=this,d=new Date;if(!vo)vo=new Object;s.vob(vo);vo._t=d.getTime();if(!s.dll)s.dll=new Array;s.dll[s.dll.length]=vo;if(!s.maxDelay)s.maxDelay=250;s.dlt()};s.track=s.t="+"function(vo){var s=this,trk=1,tm=new Date,sed=Math&&Math.random?Math.floor(Math.random()*10000000000000):tm.getTime(),sess='s'+Math.floor(tm.getTime()/10800000)%10+sed,y=tm.getYear(),vt=tm.getDate("+")+'/'+tm.getMonth()+'/'+(y<1900?y+1900:y)+' '+tm.getHours()+':'+tm.getMinutes()+':'+tm.getSeconds()+' '+tm.getDay()+' '+tm.getTimezoneOffset(),tcf,tfs=s.gtfs(),ta=-1,q='',qs='',code='',vb=new Objec"+"t;if(s.mpc('t',arguments))return;s.gl(s.vl_g);s.uns();s.m_ll();if(!s.td){var tl=tfs.location,a,o,i,x='',c='',v='',p='',bw='',bh='',j='1.0',k=s.c_w('s_cc','true',0)?'Y':'N',hp='',ct='',pn=0,ps;if(St"+"ring&&String.prototype){j='1.1';if(j.match){j='1.2';if(tm.setUTCDate){j='1.3';if(s.isie&&s.ismac&&s.apv>=5)j='1.4';if(pn.toPrecision){j='1.5';a=new Array;if(a.forEach){j='1.6';i=0;o=new Object;tcf="+"new Function('o','var e,i=0;try{i=new Iterator(o)}catch(e){}return i');i=tcf(o);if(i&&i.next){j='1.7';if(a.reduce){j='1.8';if(j.trim){j='1.8.1';if(Date.parse){j='1.8.2';if(Object.create)j='1.8.5'}}"+"}}}}}}}if(s.apv>=4)x=screen.width+'x'+screen.height;if(s.isns||s.isopera){if(s.apv>=3){v=s.n.javaEnabled()?'Y':'N';if(s.apv>=4){c=screen.pixelDepth;bw=s.wd.innerWidth;bh=s.wd.innerHeight}}s.pl=s.n."+"plugins}else if(s.isie){if(s.apv>=4){v=s.n.javaEnabled()?'Y':'N';c=screen.colorDepth;if(s.apv>=5){bw=s.d.documentElement.offsetWidth;bh=s.d.documentElement.offsetHeight;if(!s.ismac&&s.b){tcf=new Fu"+"nction('s','tl','var e,hp=0;try{s.b.addBehavior(\"#default#homePage\");hp=s.b.isHomePage(tl)?\"Y\":\"N\"}catch(e){}return hp');hp=tcf(s,tl);tcf=new Function('s','var e,ct=0;try{s.b.addBehavior(\"#d"+"efault#clientCaps\");ct=s.b.connectionType}catch(e){}return ct');ct=tcf(s)}}}else r=''}if(s.pl)while(pn<s.pl.length&&pn<30){ps=s.fl(s.pl[pn].name,100)+';';if(p.indexOf(ps)<0)p+=ps;pn++}s.resolution"+"=x;s.colorDepth=c;s.javascriptVersion=j;s.javaEnabled=v;s.cookiesEnabled=k;s.browserWidth=bw;s.browserHeight=bh;s.connectionType=ct;s.homepage=hp;s.plugins=p;s.td=1}if(vo){s.vob(vb);s.voa(vo)}if((v"+"o&&vo._t)||!s.m_m('d')){if(s.usePlugins)s.doPlugins(s);var l=s.wd.location,r=tfs.document.referrer;if(!s.pageURL)s.pageURL=l.href?l.href:l;if(!s.referrer&&!s._1_referrer){s.referrer=r;s._1_referrer"+"=1}s.m_m('g');if(s.lnk||s.eo){var o=s.eo?s.eo:s.lnk,p=s.pageName,w=1,t=s.ot(o),n=s.oid(o),x=o.s_oidt,h,l,i,oc;if(s.eo&&o==s.eo){while(o&&!n&&t!='BODY'){o=o.parentElement?o.parentElement:o.parentNod"+"e;if(o){t=s.ot(o);n=s.oid(o);x=o.s_oidt}}if(!n||t=='BODY')o='';if(o){oc=o.onclick?''+o.onclick:'';if((oc.indexOf('s_gs(')>=0&&oc.indexOf('.s_oc(')<0)||oc.indexOf('.tl(')>=0)o=0}}if(o){if(n)ta=o.tar"+"get;h=s.oh(o);i=h.indexOf('?');h=s.linkLeaveQueryString||i<0?h:h.substring(0,i);l=s.linkName;t=s.linkType?s.linkType.toLowerCase():s.lt(h);if(t&&(h||l)){s.pe='lnk_'+(t=='d'||t=='e'?t:'o');s.pev1=(h"+"?s.ape(h):'');s.pev2=(l?s.ape(l):'')}else trk=0;if(s.trackInlineStats){if(!p){p=s.pageURL;w=0}t=s.ot(o);i=o.sourceIndex;if(o.dataset&&o.dataset.sObjectId){s.wd.s_objectID=o.dataset.sObjectId;}else "+"if(o.getAttribute&&o.getAttribute('data-s-object-id')){s.wd.s_objectID=o.getAttribute('data-s-object-id');}else if(s.useForcedLinkTracking){s.wd.s_objectID='';oc=o.onclick?''+o.onclick:'';if(oc){va"+"r ocb=oc.indexOf('s_objectID'),oce,ocq,ocx;if(ocb>=0){ocb+=10;while(ocb<oc.length&&(\"= \\t\\r\\n\").indexOf(oc.charAt(ocb))>=0)ocb++;if(ocb<oc.length){oce=ocb;ocq=ocx=0;while(oce<oc.length&&(oc.ch"+"arAt(oce)!=';'||ocq)){if(ocq){if(oc.charAt(oce)==ocq&&!ocx)ocq=0;else if(oc.charAt(oce)==\"\\\\\")ocx=!ocx;else ocx=0;}else{ocq=oc.charAt(oce);if(ocq!='\"'&&ocq!=\"'\")ocq=0}oce++;}oc=oc.substring("+"ocb,oce);if(oc){o.s_soid=new Function('s','var e;try{s.wd.s_objectID='+oc+'}catch(e){}');o.s_soid(s)}}}}}if(s.gg('objectID')){n=s.gg('objectID');x=1;i=1}if(p&&n&&t)qs='&pid='+s.ape(s.fl(p,255))+(w?"+"'&pidt='+w:'')+'&oid='+s.ape(s.fl(n,100))+(x?'&oidt='+x:'')+'&ot='+s.ape(t)+(i?'&oi='+i:'')}}else trk=0}if(trk||qs){s.sampled=s.vs(sed);if(trk){if(s.sampled)code=s.mr(sess,(vt?'&t='+s.ape(vt):'')+s"+".hav()+q+(qs?qs:s.rq()),0,ta);qs='';s.m_m('t');if(s.p_r)s.p_r();s.referrer=s.lightProfileID=s.retrieveLightProfiles=s.deleteLightProfiles=''}s.sq(qs)}}else s.dl(vo);if(vo)s.voa(vb,1);s.lnk=s.eo=s.l"+"inkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';if(s.pg)s.wd.s_lnk=s.wd.s_eo=s.wd.s_linkName=s.wd.s_linkType='';return code};s.trackLink=s.tl=function(o,t,n,vo,f){var s=this;s"+".lnk=o;s.linkType=t;s.linkName=n;if(f){s.bct=o;s.bcf=f}s.t(vo)};s.trackLight=function(p,ss,i,vo){var s=this;s.lightProfileID=p;s.lightStoreForSeconds=ss;s.lightIncrementBy=i;s.t(vo)};s.setTagContai"+"ner=function(n){var s=this,l=s.wd.s_c_il,i,t,x,y;s.tcn=n;if(l)for(i=0;i<l.length;i++){t=l[i];if(t&&t._c=='s_l'&&t.tagContainerName==n){s.voa(t);if(t.lmq)for(i=0;i<t.lmq.length;i++){x=t.lmq[i];y='m_"+"'+x.n;if(!s[y]&&!s[y+'_c']){s[y]=t[y];s[y+'_c']=t[y+'_c']}s.loadModule(x.n,x.u,x.d)}if(t.ml)for(x in t.ml)if(s[x]){y=s[x];x=t.ml[x];for(i in x)if(!Object.prototype[i]){if(typeof(x[i])!='function'||"+"(''+x[i]).indexOf('s_c_il')<0)y[i]=x[i]}}if(t.mmq)for(i=0;i<t.mmq.length;i++){x=t.mmq[i];if(s[x.m]){y=s[x.m];if(y[x.f]&&typeof(y[x.f])=='function'){if(x.a)y[x.f].apply(y,x.a);else y[x.f].apply(y)}}"+"}if(t.tq)for(i=0;i<t.tq.length;i++)s.t(t.tq[i]);t.s=s;return}}};s.wd=window;s.ssl=(s.wd.location.protocol.toLowerCase().indexOf('https')>=0);s.d=document;s.b=s.d.body;if(s.d.getElementsByTagName){s"+".h=s.d.getElementsByTagName('HEAD');if(s.h)s.h=s.h[0]}s.n=navigator;s.u=s.n.userAgent;s.ns6=s.u.indexOf('Netscape6/');var apn=s.n.appName,v=s.n.appVersion,ie=v.indexOf('MSIE '),o=s.u.indexOf('Opera"+" '),i;if(v.indexOf('Opera')>=0||o>0)apn='Opera';s.isie=(apn=='Microsoft Internet Explorer');s.isns=(apn=='Netscape');s.isopera=(apn=='Opera');s.ismac=(s.u.indexOf('Mac')>=0);if(o>0)s.apv=parseFloat"+"(s.u.substring(o+6));else if(ie>0){s.apv=parseInt(i=v.substring(ie+5));if(s.apv>3)s.apv=parseFloat(i)}else if(s.ns6>0)s.apv=parseFloat(s.u.substring(s.ns6+10));else s.apv=parseFloat(v);s.em=0;if(s."+"em.toPrecision)s.em=3;else if(String.fromCharCode){i=escape(String.fromCharCode(256)).toUpperCase();s.em=(i=='%C4%80'?2:(i=='%U0100'?1:0))}if(s.oun)s.sa(s.oun);s.sa(un);s.vl_l='timestamp,dynamicVar"+"iablePrefix,visitorID,vmk,visitorMigrationKey,visitorMigrationServer,visitorMigrationServerSecure,ppu,charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,pageName,pageURL,referrer,contextDa"+"ta,currencyCode,lightProfileID,lightStoreForSeconds,lightIncrementBy,retrieveLightProfiles,deleteLightProfiles,retrieveLightData';s.va_l=s.sp(s.vl_l,',');s.vl_mr=s.vl_m='timestamp,charSet,visitorNa"+"mespace,cookieDomainPeriods,cookieLifetime,contextData,lightProfileID,lightStoreForSeconds,lightIncrementBy';s.vl_t=s.vl_l+',variableProvider,channel,server,pageType,transactionID,purchaseID,campai"+"gn,state,zip,events,events2,products,linkName,linkType';var n;for(n=1;n<=75;n++){s.vl_t+=',prop'+n+',eVar'+n;s.vl_m+=',prop'+n+',eVar'+n}for(n=1;n<=5;n++)s.vl_t+=',hier'+n;for(n=1;n<=3;n++)s.vl_t+="+"',list'+n;s.va_m=s.sp(s.vl_m,',');s.vl_l2=',tnt,pe,pev1,pev2,pev3,resolution,colorDepth,javascriptVersion,javaEnabled,cookiesEnabled,browserWidth,browserHeight,connectionType,homepage,plugins';s.vl"+"_t+=s.vl_l2;s.va_t=s.sp(s.vl_t,',');s.vl_g=s.vl_t+',trackingServer,trackingServerSecure,trackingServerBase,fpCookieDomainPeriods,disableBufferedRequests,mobile,visitorSampling,visitorSamplingGroup,"+"dynamicAccountSelection,dynamicAccountList,dynamicAccountMatch,trackDownloadLinks,trackExternalLinks,trackInlineStats,linkLeaveQueryString,linkDownloadFileTypes,linkExternalFilters,linkInternalFilt"+"ers,linkTrackVars,linkTrackEvents,linkNames,lnk,eo,lightTrackVars,_1_referrer,un';s.va_g=s.sp(s.vl_g,',');s.pg=pg;s.gl(s.vl_g);s.contextData=new Object;s.retrieveLightData=new Object;if(!ss)s.wds()"+";if(pg){s.wd.s_co=function(o){return o};s.wd.s_gs=function(un){s_gi(un,1,1).t()};s.wd.s_dc=function(un){s_gi(un,1).t()}}",w=window,l=w.s_c_il,n=navigator,u=n.userAgent,v=n.appVersion,e=v.indexOf("MSIE "),m=u.indexOf("Netscape6/"),a,i,j,x,s;if(un){un=un.toLowerCase();if(l)for(j=0;j<2;j++)for(i=0;i<l.length;i++){s=l[i];x=s._c;if((!x||x=="s_c"||j>0&&x=="s_l")&&(s.oun==un||s.fs&&s.sa&&s.fs(s.oun,un))){if(s.sa)s.sa(un);if(x=="s_c")return s}else s=0}}w.s_an="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";w.s_sp=new Function("x","d","var a=new Array,i=0,j;if(x){if(x.split)a=x.split(d);else if(!d)for(i=0;i<x.length;i++)a[a.length]=x.substring(i,i+1);else while(i>=0){j=x.indexOf(d,i);a[a.length]=x.subst"+"ring(i,j<0?x.length:j);i=j;if(i>=0)i+=d.length}}return a");w.s_jn=new Function("a","d","var x='',i,j=a.length;if(a&&j>0){x=a[0];if(j>1){if(a.join)x=a.join(d);else for(i=1;i<j;i++)x+=d+a[i]}}return x");w.s_rep=new Function("x","o","n","return s_jn(s_sp(x,o),n)");w.s_d=new Function("x","var t='`^@$#',l=s_an,l2=new Object,x2,d,b=0,k,i=x.lastIndexOf('~~'),j,v,w;if(i>0){d=x.substring(0,i);x=x.substring(i+2);l=s_sp(l,'');for(i=0;i<62;i++)l2[l[i]]=i;t=s_sp(t,'');d"+"=s_sp(d,'~');i=0;while(i<5){v=0;if(x.indexOf(t[i])>=0) {x2=s_sp(x,t[i]);for(j=1;j<x2.length;j++){k=x2[j].substring(0,1);w=t[i]+k;if(k!=' '){v=1;w=d[b+l2[k]]}x2[j]=w+x2[j].substring(1)}}if(v)x=s_jn("+"x2,'');else{w=t[i]+' ';if(x.indexOf(w)>=0)x=s_rep(x,w,t[i]);i++;b+=62}}}return x");w.s_fe=new Function("c","return s_rep(s_rep(s_rep(c,'\\\\','\\\\\\\\'),'\"','\\\\\"'),\"\\n\",\"\\\\n\")");w.s_fa=new Function("f","var s=f.indexOf('(')+1,e=f.indexOf(')'),a='',c;while(s>=0&&s<e){c=f.substring(s,s+1);if(c==',')a+='\",\"';else if((\"\\n\\r\\t \").indexOf(c)<0)a+=c;s++}return a?'\"'+a+'\"':"+"a");w.s_ft=new Function("c","c+='';var s,e,o,a,d,q,f,h,x;s=c.indexOf('=function(');while(s>=0){s++;d=1;q='';x=0;f=c.substring(s);a=s_fa(f);e=o=c.indexOf('{',s);e++;while(d>0){h=c.substring(e,e+1);if(q){i"+"f(h==q&&!x)q='';if(h=='\\\\')x=x?0:1;else x=0}else{if(h=='\"'||h==\"'\")q=h;if(h=='{')d++;if(h=='}')d--}if(d>0)e++}c=c.substring(0,s)+'new Function('+(a?a+',':'')+'\"'+s_fe(c.substring(o+1,e))+'\")"+"'+c.substring(e+1);s=c.indexOf('=function(')}return c;");c=s_d(c);if(e>0){a=parseInt(i=v.substring(e+5));if(a>3)a=parseFloat(i)}else if(m>0)a=parseFloat(u.substring(m+10));else a=parseFloat(v);if(a<5||v.indexOf("Opera")>=0||u.indexOf("Opera")>=0)c=s_ft(c);if(!s){s=new Object;if(!w.s_c_in){w.s_c_il=new Array;w.s_c_in=0}s._il=w.s_c_il;s._in=w.s_c_in;s._il[s._in]=s;w.s_c_in++}s._c="s_c";new Function("s","un","pg","ss",c)(s,un,pg,ss);return s}function s_giqf(){var w=window,q=w.s_giq,i,t,s;if(q)for(i=0;i<q.length;i++){t=q[i];s=s_gi(t.oun);s.sa(t.un);s.setTagContainer(t.tagContainerName)}w.s_giq=0}s_giqf();(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):(global=global||self,factory(global.vega={}))})(this,function(exports){"use strict";function accessor(fn,fields,name){fn.fields=fields||[];fn.fname=name;return fn}function accessorName(fn){return fn==null?null:fn.fname}function accessorFields(fn){return fn==null?null:fn.fields}function error(message){throw Error(message)}function splitAccessPath(p){var path=[],q=null,b=0,n=p.length,s="",i,j,c;p=p+"";function push(){path.push(s+p.substring(i,j));s="";i=j+1}for(i=j=0;j<n;++j){c=p[j];if(c==="\\"){s+=p.substring(i,j);i=++j}else if(c===q){push();q=null;b=-1}else if(q){continue}else if(i===b&&c==='"'){i=j+1;q=c}else if(i===b&&c==="'"){i=j+1;q=c}else if(c==="."&&!b){if(j>i){push()}else{i=j+1}}else if(c==="["){if(j>i)push();b=i=j+1}else if(c==="]"){if(!b)error("Access path missing open bracket: "+p);if(b>0)push();b=0;i=j+1}}if(b)error("Access path missing closing bracket: "+p);if(q)error("Access path missing closing quote: "+p);if(j>i){j++;push()}return path}var isArray=Array.isArray;function isObject(_){return _===Object(_)}function isString(_){return typeof _==="string"}function $(x){return isArray(x)?"["+x.map($)+"]":isObject(x)||isString(x)?JSON.stringify(x).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):x}function field(field,name){var path=splitAccessPath(field),code="return _["+path.map($).join("][")+"];";return accessor(Function("_",code),[field=path.length===1?path[0]:field],name||field)}var empty=[];var id=field("id");var identity=accessor(function(_){return _},empty,"identity");var zero=accessor(function(){return 0},empty,"zero");var one=accessor(function(){return 1},empty,"one");var truthy=accessor(function(){return true},empty,"true");var falsy=accessor(function(){return false},empty,"false");function log(method,level,input){var msg=[level].concat([].slice.call(input));console[method](...msg)}var None=0;var Error$1=1;var Warn=2;var Info=3;var Debug=4;function logger(_,method){var level=_||None;return{level:function(_){if(arguments.length){level=+_;return this}else{return level}},error:function(){if(level>=Error$1)log(method||"error","ERROR",arguments);return this},warn:function(){if(level>=Warn)log(method||"warn","WARN",arguments);return this},info:function(){if(level>=Info)log(method||"log","INFO",arguments);return this},debug:function(){if(level>=Debug)log(method||"log","DEBUG",arguments);return this}}}function peek(array){return array[array.length-1]}function toNumber(_){return _==null||_===""?null:+_}function exp(sign){return function(x){return sign*Math.exp(x)}}function log$1(sign){return function(x){return Math.log(sign*x)}}function symlog(c){return function(x){return Math.sign(x)*Math.log1p(Math.abs(x/c))}}function symexp(c){return function(x){return Math.sign(x)*Math.expm1(Math.abs(x))*c}}function pow(exponent){return function(x){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}}function pan(domain,delta,lift,ground){var d0=lift(domain[0]),d1=lift(peek(domain)),dd=(d1-d0)*delta;return[ground(d0-dd),ground(d1-dd)]}function panLinear(domain,delta){return pan(domain,delta,toNumber,identity)}function panLog(domain,delta){var sign=Math.sign(domain[0]);return pan(domain,delta,log$1(sign),exp(sign))}function panPow(domain,delta,exponent){return pan(domain,delta,pow(exponent),pow(1/exponent))}function panSymlog(domain,delta,constant){return pan(domain,delta,symlog(constant),symexp(constant))}function zoom(domain,anchor,scale,lift,ground){var d0=lift(domain[0]),d1=lift(peek(domain)),da=anchor!=null?lift(anchor):(d0+d1)/2;return[ground(da+(d0-da)*scale),ground(da+(d1-da)*scale)]}function zoomLinear(domain,anchor,scale){return zoom(domain,anchor,scale,toNumber,identity)}function zoomLog(domain,anchor,scale){var sign=Math.sign(domain[0]);return zoom(domain,anchor,scale,log$1(sign),exp(sign))}function zoomPow(domain,anchor,scale,exponent){return zoom(domain,anchor,scale,pow(exponent),pow(1/exponent))}function zoomSymlog(domain,anchor,scale,constant){return zoom(domain,anchor,scale,symlog(constant),symexp(constant))}function quarter(date){return 1+~~(new Date(date).getMonth()/3)}function utcquarter(date){return 1+~~(new Date(date).getUTCMonth()/3)}function array(_){return _!=null?isArray(_)?_:[_]:[]}function clampRange(range,min,max){var lo=range[0],hi=range[1],span;if(hi<lo){span=hi;hi=lo;lo=span}span=hi-lo;return span>=max-min?[min,max]:[lo=Math.min(Math.max(lo,min),max-span),lo+span]}function isFunction(_){return typeof _==="function"}function compare(fields,orders){var idx=[],cmp=(fields=array(fields)).map(function(f,i){if(f==null){return null}else{idx.push(i);return isFunction(f)?f:splitAccessPath(f).map($).join("][")}}),n=idx.length-1,ord=array(orders),code="var u,v;return ",i,j,f,u,v,d,t,lt,gt;if(n<0)return null;for(j=0;j<=n;++j){i=idx[j];f=cmp[i];if(isFunction(f)){d="f"+i;u="(u=this."+d+"(a))";v="(v=this."+d+"(b))";(t=t||{})[d]=f}else{u="(u=a["+f+"])";v="(v=b["+f+"])"}d="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))";if(ord[i]!=="descending"){gt=1;lt=-1}else{gt=-1;lt=1}code+="("+u+"<"+v+"||u==null)&&v!=null?"+lt+":(u>v||v==null)&&u!=null?"+gt+":"+d+"!==u&&v===v?"+lt+":v!==v&&u===u?"+gt+(i<n?":":":0")}f=Function("a","b",code+";");if(t)f=f.bind(t);fields=fields.reduce(function(map,field){if(isFunction(field)){(accessorFields(field)||[]).forEach(function(_){map[_]=1})}else if(field!=null){map[field+""]=1}return map},{});return accessor(f,Object.keys(fields))}function constant(_){return isFunction(_)?_:function(){return _}}function debounce(delay,handler){var tid,evt;function callback(){handler(evt);tid=evt=null}return function(e){evt=e;if(tid)clearTimeout(tid);tid=setTimeout(callback,delay)}}function extend(_){for(var x,k,i=1,len=arguments.length;i<len;++i){x=arguments[i];for(k in x){_[k]=x[k]}}return _}function extent(array,f){var i=0,n,v,min,max;if(array&&(n=array.length)){if(f==null){for(v=array[i];v==null||v!==v;v=array[++i]);min=max=v;for(;i<n;++i){v=array[i];if(v!=null){if(v<min)min=v;if(v>max)max=v}}}else{for(v=f(array[i]);v==null||v!==v;v=f(array[++i]));min=max=v;for(;i<n;++i){v=f(array[i]);if(v!=null){if(v<min)min=v;if(v>max)max=v}}}}return[min,max]}function extentIndex(array,f){var i=-1,n=array.length,a,b,c,u,v;if(f==null){while(++i<n){b=array[i];if(b!=null&&b>=b){a=c=b;break}}u=v=i;while(++i<n){b=array[i];if(b!=null){if(a>b){a=b;u=i}if(c<b){c=b;v=i}}}}else{while(++i<n){b=f(array[i],i,array);if(b!=null&&b>=b){a=c=b;break}}u=v=i;while(++i<n){b=f(array[i],i,array);if(b!=null){if(a>b){a=b;u=i}if(c<b){c=b;v=i}}}}return[u,v]}var NULL={};function fastmap(input){var obj={},map,test;function has(key){return obj.hasOwnProperty(key)&&obj[key]!==NULL}map={size:0,empty:0,object:obj,has:has,get:function(key){return has(key)?obj[key]:undefined},set:function(key,value){if(!has(key)){++map.size;if(obj[key]===NULL)--map.empty}obj[key]=value;return this},delete:function(key){if(has(key)){--map.size;++map.empty;obj[key]=NULL}return this},clear:function(){map.size=map.empty=0;map.object=obj={}},test:function(_){if(arguments.length){test=_;return map}else{return test}},clean:function(){var next={},size=0,key,value;for(key in obj){value=obj[key];if(value!==NULL&&(!test||!test(value))){next[key]=value;++size}}map.size=size;map.empty=0;map.object=obj=next}};if(input)Object.keys(input).forEach(function(key){map.set(key,input[key])});return map}function flush(range,value,threshold,left,right,center){if(!threshold&&threshold!==0)return center;var a=range[0],b=peek(range),t=+threshold,l,r;if(b<a){l=a;a=b;b=l}l=Math.abs(value-a);r=Math.abs(b-value);return l<r&&l<=t?left:r<=t?right:center}function inherits(child,parent){var proto=child.prototype=Object.create(parent.prototype);proto.constructor=child;return proto}function inrange(value,range,left,right){var r0=range[0],r1=range[range.length-1],t;if(r0>r1){t=r0;r0=r1;r1=t}left=left===undefined||left;right=right===undefined||right;return(left?r0<=value:r0<value)&&(right?value<=r1:value<r1)}function isBoolean(_){return typeof _==="boolean"}function isDate(_){return Object.prototype.toString.call(_)==="[object Date]"}function isNumber(_){return typeof _==="number"}function isRegExp(_){return Object.prototype.toString.call(_)==="[object RegExp]"}function key(fields,flat){if(fields){fields=flat?array(fields).map(function(f){return f.replace(/\\(.)/g,"$1")}):array(fields)}var fn=!(fields&&fields.length)?function(){return""}:Function("_","return ''+"+fields.map(function(f){return"_["+(flat?$(f):splitAccessPath(f).map($).join("]["))+"]"}).join("+'|'+")+";");return accessor(fn,fields,"key")}function lerp(array,frac){const lo=array[0],hi=peek(array),f=+frac;return!f?lo:f===1?hi:lo+f*(hi-lo)}function merge(compare,array0,array1,output){var n0=array0.length,n1=array1.length;if(!n1)return array0;if(!n0)return array1;var merged=output||new array0.constructor(n0+n1),i0=0,i1=0,i=0;for(;i0<n0&&i1<n1;++i){merged[i]=compare(array0[i0],array1[i1])>0?array1[i1++]:array0[i0++]}for(;i0<n0;++i0,++i){merged[i]=array0[i0]}for(;i1<n1;++i1,++i){merged[i]=array1[i1]}return merged}function repeat(str,reps){var s="";while(--reps>=0)s+=str;return s}function pad(str,length,padchar,align){var c=padchar||" ",s=str+"",n=length-s.length;return n<=0?s:align==="left"?repeat(c,n)+s:align==="center"?repeat(c,~~(n/2))+s+repeat(c,Math.ceil(n/2)):s+repeat(c,n)}function span(array){return peek(array)-array[0]||0}function toBoolean(_){return _==null||_===""?null:!_||_==="false"||_==="0"?false:!!_}function defaultParser(_){return isNumber(_)?_:isDate(_)?_:Date.parse(_)}function toDate(_,parser){parser=parser||defaultParser;return _==null||_===""?null:parser(_)}function toString(_){return _==null||_===""?null:_+""}function toSet(_){for(var s={},i=0,n=_.length;i<n;++i)s[_[i]]=true;return s}function truncate(str,length,align,ellipsis){var e=ellipsis!=null?ellipsis:"",s=str+"",n=s.length,l=Math.max(0,length-e.length);return n<=length?s:align==="left"?e+s.slice(n-l):align==="center"?s.slice(0,Math.ceil(l/2))+e+s.slice(n-~~(l/2)):s.slice(0,l)+e}function visitArray(array,filter,visitor){if(array){var i=0,n=array.length,t;if(filter){for(;i<n;++i){if(t=filter(array[i]))visitor(t,i,array)}}else{array.forEach(visitor)}}}function UniqueList(idFunc){var $=idFunc||identity,list=[],ids={};list.add=function(_){var id=$(_);if(!ids[id]){ids[id]=1;list.push(_)}return list};list.remove=function(_){var id=$(_),idx;if(ids[id]){ids[id]=0;if((idx=list.indexOf(_))>=0){list.splice(idx,1)}}return list};return list}async function asyncCallback(df,callback){try{await callback(df)}catch(err){df.error(err)}}var TUPLE_ID_KEY=Symbol("vega_id"),TUPLE_ID=1;function isTuple(t){return!!(t&&tupleid(t))}function tupleid(t){return t[TUPLE_ID_KEY]}function setid(t,id){t[TUPLE_ID_KEY]=id;return t}function ingest(datum){var t=datum===Object(datum)?datum:{data:datum};return tupleid(t)?t:setid(t,TUPLE_ID++)}function derive(t){return rederive(t,ingest({}))}function rederive(t,d){for(var k in t)d[k]=t[k];return d}function replace(t,d){return setid(d,tupleid(t))}function isChangeSet(v){return v&&v.constructor===changeset}function changeset(){var add=[],rem=[],mod=[],remp=[],modp=[],reflow=false;return{constructor:changeset,insert:function(t){var d=array(t),i=0,n=d.length;for(;i<n;++i)add.push(d[i]);return this},remove:function(t){var a=isFunction(t)?remp:rem,d=array(t),i=0,n=d.length;for(;i<n;++i)a.push(d[i]);return this},modify:function(t,field,value){var m={field:field,value:constant(value)};if(isFunction(t)){m.filter=t;modp.push(m)}else{m.tuple=t;mod.push(m)}return this},encode:function(t,set){if(isFunction(t))modp.push({filter:t,field:set});else mod.push({tuple:t,field:set});return this},reflow:function(){reflow=true;return this},pulse:function(pulse,tuples){var cur={},out={},i,n,m,f,t,id;for(i=0,n=tuples.length;i<n;++i){cur[tupleid(tuples[i])]=1}for(i=0,n=rem.length;i<n;++i){t=rem[i];cur[tupleid(t)]=-1}for(i=0,n=remp.length;i<n;++i){f=remp[i];tuples.forEach(function(t){if(f(t))cur[tupleid(t)]=-1})}for(i=0,n=add.length;i<n;++i){t=add[i];id=tupleid(t);if(cur[id]){cur[id]=1}else{pulse.add.push(ingest(add[i]))}}for(i=0,n=tuples.length;i<n;++i){t=tuples[i];if(cur[tupleid(t)]<0)pulse.rem.push(t)}function modify(t,f,v){if(v){t[f]=v(t)}else{pulse.encode=f}if(!reflow)out[tupleid(t)]=t}for(i=0,n=mod.length;i<n;++i){m=mod[i];t=m.tuple;f=m.field;id=cur[tupleid(t)];if(id>0){modify(t,f,m.value);pulse.modifies(f)}}for(i=0,n=modp.length;i<n;++i){m=modp[i];f=m.filter;tuples.forEach(function(t){if(f(t)&&cur[tupleid(t)]>0){modify(t,m.field,m.value)}});pulse.modifies(m.field)}if(reflow){pulse.mod=rem.length||remp.length?tuples.filter(function(t){return cur[tupleid(t)]>0}):tuples.slice()}else{for(id in out)pulse.mod.push(out[id])}return pulse}}}var CACHE="_:mod:_";function Parameters(){Object.defineProperty(this,CACHE,{writable:true,value:{}})}var prototype=Parameters.prototype;prototype.set=function(name,index,value,force){var o=this,v=o[name],mod=o[CACHE];if(index!=null&&index>=0){if(v[index]!==value||force){v[index]=value;mod[index+":"+name]=-1;mod[name]=-1}}else if(v!==value||force){o[name]=value;mod[name]=isArray(value)?1+value.length:-1}return o};prototype.modified=function(name,index){var mod=this[CACHE],k;if(!arguments.length){for(k in mod){if(mod[k])return true}return false}else if(isArray(name)){for(k=0;k<name.length;++k){if(mod[name[k]])return true}return false}return index!=null&&index>=0?index+1<mod[name]||!!mod[index+":"+name]:!!mod[name]};prototype.clear=function(){this[CACHE]={};return this};var OP_ID=0;var PULSE="pulse";var NO_PARAMS=new Parameters;var SKIP=1,MODIFIED=2;function Operator(init,update,params,react){this.id=++OP_ID;this.value=init;this.stamp=-1;this.rank=-1;this.qrank=-1;this.flags=0;if(update){this._update=update}if(params)this.parameters(params,react)}var prototype$1=Operator.prototype;prototype$1.targets=function(){return this._targets||(this._targets=UniqueList(id))};prototype$1.set=function(value){if(this.value!==value){this.value=value;return 1}else{return 0}};function flag(bit){return function(state){var f=this.flags;if(arguments.length===0)return!!(f&bit);this.flags=state?f|bit:f&~bit;return this}}prototype$1.skip=flag(SKIP);prototype$1.modified=flag(MODIFIED);prototype$1.parameters=function(params,react,initonly){react=react!==false;var self=this,argval=self._argval=self._argval||new Parameters,argops=self._argops=self._argops||[],deps=[],name,value,n,i;function add(name,index,value){if(value instanceof Operator){if(value!==self){if(react)value.targets().add(self);deps.push(value)}argops.push({op:value,name:name,index:index})}else{argval.set(name,index,value)}}for(name in params){value=params[name];if(name===PULSE){array(value).forEach(function(op){if(!(op instanceof Operator)){error("Pulse parameters must be operator instances.")}else if(op!==self){op.targets().add(self);deps.push(op)}});self.source=value}else if(isArray(value)){argval.set(name,-1,Array(n=value.length));for(i=0;i<n;++i)add(name,i,value[i])}else{add(name,-1,value)}}this.marshall().clear();if(initonly)argops.initonly=true;return deps};prototype$1.marshall=function(stamp){var argval=this._argval||NO_PARAMS,argops=this._argops,item,i,n,op,mod;if(argops){for(i=0,n=argops.length;i<n;++i){item=argops[i];op=item.op;mod=op.modified()&&op.stamp===stamp;argval.set(item.name,item.index,op.value,mod)}if(argops.initonly){for(i=0;i<n;++i){item=argops[i];item.op.targets().remove(this)}this._argops=null;this._update=null}}return argval};prototype$1.evaluate=function(pulse){var update=this._update;if(update){var params=this.marshall(pulse.stamp),v=update.call(this,params,pulse);params.clear();if(v!==this.value){this.value=v}else if(!this.modified()){return pulse.StopPropagation}}};prototype$1.run=function(pulse){if(pulse.stamp<=this.stamp)return pulse.StopPropagation;var rv;if(this.skip()){this.skip(false);rv=0}else{rv=this.evaluate(pulse)}this.stamp=pulse.stamp;return this.pulse=rv||pulse};function add(init,update,params,react){var shift=1,op;if(init instanceof Operator){op=init}else if(init&&init.prototype instanceof Operator){op=new init}else if(isFunction(init)){op=new Operator(null,init)}else{shift=0;op=new Operator(init,update)}this.rank(op);if(shift){react=params;params=update}if(params)this.connect(op,op.parameters(params,react));this.touch(op);return op}function connect(target,sources){var targetRank=target.rank,i,n;for(i=0,n=sources.length;i<n;++i){if(targetRank<sources[i].rank){this.rerank(target);return}}}var STREAM_ID=0;function EventStream(filter,apply,receive){this.id=++STREAM_ID;this.value=null;if(receive)this.receive=receive;if(filter)this._filter=filter;if(apply)this._apply=apply}function stream(filter,apply,receive){return new EventStream(filter,apply,receive)}var prototype$2=EventStream.prototype;prototype$2._filter=truthy;prototype$2._apply=identity;prototype$2.targets=function(){return this._targets||(this._targets=UniqueList(id))};prototype$2.consume=function(_){if(!arguments.length)return!!this._consume;this._consume=!!_;return this};prototype$2.receive=function(evt){if(this._filter(evt)){var val=this.value=this._apply(evt),trg=this._targets,n=trg?trg.length:0,i=0;for(;i<n;++i)trg[i].receive(val);if(this._consume){evt.preventDefault();evt.stopPropagation()}}};prototype$2.filter=function(filter){var s=stream(filter);this.targets().add(s);return s};prototype$2.apply=function(apply){var s=stream(null,apply);this.targets().add(s);return s};prototype$2.merge=function(){var s=stream();this.targets().add(s);for(var i=0,n=arguments.length;i<n;++i){arguments[i].targets().add(s)}return s};prototype$2.throttle=function(pause){var t=-1;return this.filter(function(){var now=Date.now();if(now-t>pause){t=now;return 1}else{return 0}})};prototype$2.debounce=function(delay){var s=stream();this.targets().add(stream(null,null,debounce(delay,function(e){var df=e.dataflow;s.receive(e);if(df&&df.run)df.run()})));return s};prototype$2.between=function(a,b){var active=false;a.targets().add(stream(null,null,function(){active=true}));b.targets().add(stream(null,null,function(){active=false}));return this.filter(function(){return active})};function events(source,type,filter,apply){var df=this,s=stream(filter,apply),send=function(e){e.dataflow=df;try{s.receive(e)}catch(error){df.error(error)}finally{df.run()}},sources;if(typeof source==="string"&&typeof document!=="undefined"){sources=document.querySelectorAll(source)}else{sources=array(source)}for(var i=0,n=sources.length;i<n;++i){sources[i].addEventListener(type,send)}return s}var protocol_re=/^([A-Za-z]+:)?\/\//;var fileProtocol="file://";function loaderFactory(fetch,fs){return function(options){return{options:options||{},sanitize:sanitize,load:load,fileAccess:!!fs,file:fileLoader(fs),http:httpLoader(fetch)}}}async function load(uri,options){const opt=await this.sanitize(uri,options),url=opt.href;return opt.localFile?this.file(url):this.http(url,options)}async function sanitize(uri,options){options=extend({},this.options,options);const fileAccess=this.fileAccess,result={href:null};let isFile,hasProtocol,loadFile,base;if(uri==null||typeof uri!=="string"){error("Sanitize failure, invalid URI: "+$(uri))}hasProtocol=protocol_re.test(uri);if((base=options.baseURL)&&!hasProtocol){if(!uri.startsWith("/")&&base[base.length-1]!=="/"){uri="/"+uri}uri=base+uri}loadFile=(isFile=uri.startsWith(fileProtocol))||options.mode==="file"||options.mode!=="http"&&!hasProtocol&&fileAccess;if(isFile){uri=uri.slice(fileProtocol.length)}else if(uri.startsWith("//")){if(options.defaultProtocol==="file"){uri=uri.slice(2);loadFile=true}else{uri=(options.defaultProtocol||"http")+":"+uri}}Object.defineProperty(result,"localFile",{value:!!loadFile});result.href=uri;if(options.target){result.target=options.target+""}if(options.rel){result.rel=options.rel+""}return result}function fileLoader(fs){return fs?function(filename){return new Promise(function(accept,reject){fs.readFile(filename,function(error,data){if(error)reject(error);else accept(data)})})}:fileReject}async function fileReject(){error("No file system access.")}function httpLoader(fetch){return fetch?async function(url,options){const opt=extend({},this.options.http,options),type=options&&options.response,response=await fetch(url,opt);return!response.ok?error(response.status+""+response.statusText):isFunction(response[type])?response[type]():response.text()}:httpReject}async function httpReject(){error("No HTTP fetch method available.")}var typeParsers={boolean:toBoolean,integer:toNumber,number:toNumber,date:toDate,string:toString,unknown:identity};var typeTests=[isBoolean$1,isInteger,isNumber$1,isDate$1];var typeList=["boolean","integer","number","date"];function inferType(values,field){if(!values||!values.length)return"unknown";var value,i,j,t=0,n=values.length,m=typeTests.length,a=typeTests.map(function(_,i){return i+1});for(i=0,n=values.length;i<n;++i){value=field?values[i][field]:values[i];for(j=0;j<m;++j){if(a[j]&&isValid(value)&&!typeTests[j](value)){a[j]=0;++t;if(t===typeTests.length)return"string"}}}t=a.reduce(function(u,v){return u===0?v:u},0)-1;return typeList[t]}function inferTypes(data,fields){return fields.reduce(function(types,field){types[field]=inferType(data,field);return types},{})}function isValid(_){return _!=null&&_===_}function isBoolean$1(_){return _==="true"||_==="false"||_===true||_===false}function isDate$1(_){return!isNaN(Date.parse(_))}function isNumber$1(_){return!isNaN(+_)&&!(_ instanceof Date)}function isInteger(_){return isNumber$1(_)&&(_=+_)===~~_}var EOL={},EOF={},QUOTE=34,NEWLINE=10,RETURN=13;function objectConverter(columns){return new Function("d","return {"+columns.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}")}function customConverter(columns,f){var object=objectConverter(columns);return function(row,i){return f(object(row),i,columns)}}function inferColumns(rows){var columnSet=Object.create(null),columns=[];rows.forEach(function(row){for(var column in row){if(!(column in columnSet)){columns.push(columnSet[column]=column)}}});return columns}function pad$1(value,width){var s=value+"",length=s.length;return length<width?new Array(width-length+1).join(0)+s:s}function formatYear(year){return year<0?"-"+pad$1(-year,6):year>9999?"+"+pad$1(year,6):pad$1(year,4)}function formatDate(date){var hours=date.getUTCHours(),minutes=date.getUTCMinutes(),seconds=date.getUTCSeconds(),milliseconds=date.getUTCMilliseconds();return isNaN(date)?"Invalid Date":formatYear(date.getUTCFullYear(),4)+"-"+pad$1(date.getUTCMonth()+1,2)+"-"+pad$1(date.getUTCDate(),2)+(milliseconds?"T"+pad$1(hours,2)+":"+pad$1(minutes,2)+":"+pad$1(seconds,2)+"."+pad$1(milliseconds,3)+"Z":seconds?"T"+pad$1(hours,2)+":"+pad$1(minutes,2)+":"+pad$1(seconds,2)+"Z":minutes||hours?"T"+pad$1(hours,2)+":"+pad$1(minutes,2)+"Z":"")}function dsvFormat(delimiter){var reFormat=new RegExp('["'+delimiter+"\n\r]"),DELIMITER=delimiter.charCodeAt(0);function parse(text,f){var convert,columns,rows=parseRows(text,function(row,i){if(convert)return convert(row,i-1);columns=row,convert=f?customConverter(row,f):objectConverter(row)});rows.columns=columns||[];return rows}function parseRows(text,f){var rows=[],N=text.length,I=0,n=0,t,eof=N<=0,eol=false;if(text.charCodeAt(N-1)===NEWLINE)--N;if(text.charCodeAt(N-1)===RETURN)--N;function token(){if(eof)return EOF;if(eol)return eol=false,EOL;var i,j=I,c;if(text.charCodeAt(j)===QUOTE){while(I++<N&&text.charCodeAt(I)!==QUOTE||text.charCodeAt(++I)===QUOTE);if((i=I)>=N)eof=true;else if((c=text.charCodeAt(I++))===NEWLINE)eol=true;else if(c===RETURN){eol=true;if(text.charCodeAt(I)===NEWLINE)++I}return text.slice(j+1,i-1).replace(/""/g,'"')}while(I<N){if((c=text.charCodeAt(i=I++))===NEWLINE)eol=true;else if(c===RETURN){eol=true;if(text.charCodeAt(I)===NEWLINE)++I}else if(c!==DELIMITER)continue;return text.slice(j,i)}return eof=true,text.slice(j,N)}while((t=token())!==EOF){var row=[];while(t!==EOL&&t!==EOF)row.push(t),t=token();if(f&&(row=f(row,n++))==null)continue;rows.push(row)}return rows}function preformatBody(rows,columns){return rows.map(function(row){return columns.map(function(column){return formatValue(row[column])}).join(delimiter)})}function format(rows,columns){if(columns==null)columns=inferColumns(rows);return[columns.map(formatValue).join(delimiter)].concat(preformatBody(rows,columns)).join("\n")}function formatBody(rows,columns){if(columns==null)columns=inferColumns(rows);return preformatBody(rows,columns).join("\n")}function formatRows(rows){return rows.map(formatRow).join("\n")}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(value){return value==null?"":value instanceof Date?formatDate(value):reFormat.test(value+="")?'"'+value.replace(/"/g,'""')+'"':value}return{parse:parse,parseRows:parseRows,format:format,formatBody:formatBody,formatRows:formatRows}}var csv=dsvFormat(",");var tsv=dsvFormat("\t");function delimitedFormat(delimiter){const parse=function(data,format){const delim={delimiter:delimiter};return dsv(data,format?extend(format,delim):delim)};parse.responseType="text";return parse}function dsv(data,format){if(format.header){data=format.header.map($).join(format.delimiter)+"\n"+data}return dsvFormat(format.delimiter).parse(data+"")}dsv.responseType="text";function isBuffer(_){return typeof Buffer==="function"&&isFunction(Buffer.isBuffer)?Buffer.isBuffer(_):false}function json(data,format){const prop=format&&format.property?field(format.property):identity;return isObject(data)&&!isBuffer(data)?parseJSON(prop(data)):prop(JSON.parse(data))}json.responseType="json";function parseJSON(data,format){return format&&format.copy?JSON.parse(JSON.stringify(data)):data}function identity$1(x){return x}function transform(transform){if(transform==null)return identity$1;var x0,y0,kx=transform.scale[0],ky=transform.scale[1],dx=transform.translate[0],dy=transform.translate[1];return function(input,i){if(!i)x0=y0=0;var j=2,n=input.length,output=new Array(n);output[0]=(x0+=input[0])*kx+dx;output[1]=(y0+=input[1])*ky+dy;while(j<n)output[j]=input[j],++j;return output}}function reverse(array,n){var t,j=array.length,i=j-n;while(i<--j)t=array[i],array[i++]=array[j],array[j]=t}function feature(topology,o){return o.type==="GeometryCollection"?{type:"FeatureCollection",features:o.geometries.map(function(o){return feature$1(topology,o)})}:feature$1(topology,o)}function feature$1(topology,o){var id=o.id,bbox=o.bbox,properties=o.properties==null?{}:o.properties,geometry=object(topology,o);return id==null&&bbox==null?{type:"Feature",properties:properties,geometry:geometry}:bbox==null?{type:"Feature",id:id,properties:properties,geometry:geometry}:{type:"Feature",id:id,bbox:bbox,properties:properties,geometry:geometry}}function object(topology,o){var transformPoint=transform(topology.transform),arcs=topology.arcs;function arc(i,points){if(points.length)points.pop();for(var a=arcs[i<0?~i:i],k=0,n=a.length;k<n;++k){points.push(transformPoint(a[k],k))}if(i<0)reverse(points,n)}function point(p){return transformPoint(p)}function line(arcs){var points=[];for(var i=0,n=arcs.length;i<n;++i)arc(arcs[i],points);if(points.length<2)points.push(points[0]);return points}function ring(arcs){var points=line(arcs);while(points.length<4)points.push(points[0]);return points}function polygon(arcs){return arcs.map(ring)}function geometry(o){var type=o.type,coordinates;switch(type){case"GeometryCollection":return{type:type,geometries:o.geometries.map(geometry)};case"Point":coordinates=point(o.coordinates);break;case"MultiPoint":coordinates=o.coordinates.map(point);break;case"LineString":coordinates=line(o.arcs);break;case"MultiLineString":coordinates=o.arcs.map(line);break;case"Polygon":coordinates=polygon(o.arcs);break;case"MultiPolygon":coordinates=o.arcs.map(polygon);break;default:return null}return{type:type,coordinates:coordinates}}return geometry(o)}function stitch(topology,arcs){var stitchedArcs={},fragmentByStart={},fragmentByEnd={},fragments=[],emptyIndex=-1;arcs.forEach(function(i,j){var arc=topology.arcs[i<0?~i:i],t;if(arc.length<3&&!arc[1][0]&&!arc[1][1]){t=arcs[++emptyIndex],arcs[emptyIndex]=i,arcs[j]=t}});arcs.forEach(function(i){var e=ends(i),start=e[0],end=e[1],f,g;if(f=fragmentByEnd[start]){delete fragmentByEnd[f.end];f.push(i);f.end=end;if(g=fragmentByStart[end]){delete fragmentByStart[g.start];var fg=g===f?f:f.concat(g);fragmentByStart[fg.start=f.start]=fragmentByEnd[fg.end=g.end]=fg}else{fragmentByStart[f.start]=fragmentByEnd[f.end]=f}}else if(f=fragmentByStart[end]){delete fragmentByStart[f.start];f.unshift(i);f.start=start;if(g=fragmentByEnd[start]){delete fragmentByEnd[g.end];var gf=g===f?f:g.concat(f);fragmentByStart[gf.start=g.start]=fragmentByEnd[gf.end=f.end]=gf}else{fragmentByStart[f.start]=fragmentByEnd[f.end]=f}}else{f=[i];fragmentByStart[f.start=start]=fragmentByEnd[f.end=end]=f}});function ends(i){var arc=topology.arcs[i<0?~i:i],p0=arc[0],p1;if(topology.transform)p1=[0,0],arc.forEach(function(dp){p1[0]+=dp[0],p1[1]+=dp[1]});else p1=arc[arc.length-1];return i<0?[p1,p0]:[p0,p1]}function flush(fragmentByEnd,fragmentByStart){for(var k in fragmentByEnd){var f=fragmentByEnd[k];delete fragmentByStart[f.start];delete f.start;delete f.end;f.forEach(function(i){stitchedArcs[i<0?~i:i]=1});fragments.push(f)}}flush(fragmentByEnd,fragmentByStart);flush(fragmentByStart,fragmentByEnd);arcs.forEach(function(i){if(!stitchedArcs[i<0?~i:i])fragments.push([i])});return fragments}function mesh(topology){return object(topology,meshArcs.apply(this,arguments))}function meshArcs(topology,object,filter){var arcs,i,n;if(arguments.length>1)arcs=extractArcs(topology,object,filter);else for(i=0,arcs=new Array(n=topology.arcs.length);i<n;++i)arcs[i]=i;return{type:"MultiLineString",arcs:stitch(topology,arcs)}}function extractArcs(topology,object,filter){var arcs=[],geomsByArc=[],geom;function extract0(i){var j=i<0?~i:i;(geomsByArc[j]||(geomsByArc[j]=[])).push({i:i,g:geom})}function extract1(arcs){arcs.forEach(extract0)}function extract2(arcs){arcs.forEach(extract1)}function extract3(arcs){arcs.forEach(extract2)}function geometry(o){switch(geom=o,o.type){case"GeometryCollection":o.geometries.forEach(geometry);break;case"LineString":extract1(o.arcs);break;case"MultiLineString":case"Polygon":extract2(o.arcs);break;case"MultiPolygon":extract3(o.arcs);break}}geometry(object);geomsByArc.forEach(filter==null?function(geoms){arcs.push(geoms[0].i)}:function(geoms){if(filter(geoms[0].g,geoms[geoms.length-1].g))arcs.push(geoms[0].i)});return arcs}function topojson(data,format){var method,object,property;data=json(data,format);method=format&&(property=format.feature)?feature:format&&(property=format.mesh)?mesh:error("Missing TopoJSON feature or mesh parameter.");object=(object=data.objects[property])?method(data,object):error("Invalid TopoJSON object: "+property);return object&&object.features||[object]}topojson.responseType="json";const format={dsv:dsv,csv:delimitedFormat(","),tsv:delimitedFormat("\t"),json:json,topojson:topojson};function formats(name,reader){if(arguments.length>1){format[name]=reader;return this}else{return format.hasOwnProperty(name)?format[name]:null}}function responseType(type){const f=formats(type);return f&&f.responseType||"text"}var t0=new Date,t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=new Date(+date)),date}interval.floor=interval;interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date};interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1};interval.offset=function(date,step){return offseti(date=new Date(+date),step==null?1:Math.floor(step)),date};interval.range=function(start,stop,step){var range=[],previous;start=interval.ceil(start);step=step==null?1:Math.floor(step);if(!(start<stop)||!(step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range};interval.filter=function(test){return newInterval(function(date){if(date>=date)while(floori(date),!test(date))date.setTime(date-1)},function(date,step){if(date>=date){if(step<0)while(++step<=0){while(offseti(date,-1),!test(date)){}}else while(--step>=0){while(offseti(date,+1),!test(date)){}}}})};if(count){interval.count=function(start,end){t0.setTime(+start),t1.setTime(+end);floori(t0),floori(t1);return Math.floor(count(t0,t1))};interval.every=function(step){step=Math.floor(step);return!isFinite(step)||!(step>0)?null:!(step>1)?interval:interval.filter(field?function(d){return field(d)%step===0}:function(d){return interval.count(0,d)%step===0})}}return interval}var millisecond=newInterval(function(){},function(date,step){date.setTime(+date+step)},function(start,end){return end-start});millisecond.every=function(k){k=Math.floor(k);if(!isFinite(k)||!(k>0))return null;if(!(k>1))return millisecond;return newInterval(function(date){date.setTime(Math.floor(date/k)*k)},function(date,step){date.setTime(+date+step*k)},function(start,end){return(end-start)/k})};var durationSecond=1e3;var durationMinute=6e4;var durationHour=36e5;var durationDay=864e5;var durationWeek=6048e5;var second=newInterval(function(date){date.setTime(date-date.getMilliseconds())},function(date,step){date.setTime(+date+step*durationSecond)},function(start,end){return(end-start)/durationSecond},function(date){return date.getUTCSeconds()});var minute=newInterval(function(date){date.setTime(date-date.getMilliseconds()-date.getSeconds()*durationSecond)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getMinutes()});var hour=newInterval(function(date){date.setTime(date-date.getMilliseconds()-date.getSeconds()*durationSecond-date.getMinutes()*durationMinute)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getHours()});var day=newInterval(function(date){date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationDay},function(date){return date.getDate()-1});function weekday(i){return newInterval(function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7);date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step*7)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationWeek})}var sunday=weekday(0);var monday=weekday(1);var tuesday=weekday(2);var wednesday=weekday(3);var thursday=weekday(4);var friday=weekday(5);var saturday=weekday(6);var month=newInterval(function(date){date.setDate(1);date.setHours(0,0,0,0)},function(date,step){date.setMonth(date.getMonth()+step)},function(start,end){return end.getMonth()-start.getMonth()+(end.getFullYear()-start.getFullYear())*12},function(date){return date.getMonth()});var year=newInterval(function(date){date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step)},function(start,end){return end.getFullYear()-start.getFullYear()},function(date){return date.getFullYear()});year.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k);date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step*k)})};var utcMinute=newInterval(function(date){date.setUTCSeconds(0,0)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getUTCMinutes()});var utcHour=newInterval(function(date){date.setUTCMinutes(0,0,0)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getUTCHours()});var utcDay=newInterval(function(date){date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step)},function(start,end){return(end-start)/durationDay},function(date){return date.getUTCDate()-1});function utcWeekday(i){return newInterval(function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step*7)},function(start,end){return(end-start)/durationWeek})}var utcSunday=utcWeekday(0);var utcMonday=utcWeekday(1);var utcTuesday=utcWeekday(2);var utcWednesday=utcWeekday(3);var utcThursday=utcWeekday(4);var utcFriday=utcWeekday(5);var utcSaturday=utcWeekday(6);var utcMonth=newInterval(function(date){date.setUTCDate(1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCMonth(date.getUTCMonth()+step)},function(start,end){return end.getUTCMonth()-start.getUTCMonth()+(end.getUTCFullYear()-start.getUTCFullYear())*12},function(date){return date.getUTCMonth()});var utcYear=newInterval(function(date){date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)},function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()},function(date){return date.getUTCFullYear()});utcYear.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k);date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})};function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);date.setFullYear(d.y);return date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));date.setUTCFullYear(d.y);return date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newYear(y){return{y:y,m:0,d:1,H:0,M:0,S:0,L:0}}function formatLocale(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;var periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths);var formats={a:formatShortWeekday,A:formatWeekday,b:formatShortMonth,B:formatMonth,c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:formatPeriod,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear$1,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent};var utcFormats={a:formatUTCShortWeekday,A:formatUTCWeekday,b:formatUTCShortMonth,B:formatUTCMonth,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:formatUTCPeriod,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent};var parses={a:parseShortWeekday,A:parseWeekday,b:parseShortMonth,B:parseMonth,c:parseLocaleDateTime,d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:parsePeriod,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:parseLocaleDate,X:parseLocaleTime,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};formats.x=newFormat(locale_date,formats);formats.X=newFormat(locale_time,formats);formats.c=newFormat(locale_dateTime,formats);utcFormats.x=newFormat(locale_date,utcFormats);utcFormats.X=newFormat(locale_time,utcFormats);utcFormats.c=newFormat(locale_dateTime,utcFormats);function newFormat(specifier,formats){return function(date){var string=[],i=-1,j=0,n=specifier.length,c,pad,format;if(!(date instanceof Date))date=new Date(+date);while(++i<n){if(specifier.charCodeAt(i)===37){string.push(specifier.slice(j,i));if((pad=pads[c=specifier.charAt(++i)])!=null)c=specifier.charAt(++i);else pad=c==="e"?" ":"0";if(format=formats[c])c=format(date,pad);string.push(c);j=i+1}}string.push(specifier.slice(j,i));return string.join("")}}function newParse(specifier,newDate){return function(string){var d=newYear(1900),i=parseSpecifier(d,specifier,string+="",0),week,day$1;if(i!=string.length)return null;if("Q"in d)return new Date(d.Q);if("p"in d)d.H=d.H%12+d.p*12;if("V"in d){if(d.V<1||d.V>53)return null;if(!("w"in d))d.w=1;if("Z"in d){week=utcDate(newYear(d.y)),day$1=week.getUTCDay();week=day$1>4||day$1===0?utcMonday.ceil(week):utcMonday(week);week=utcDay.offset(week,(d.V-1)*7);d.y=week.getUTCFullYear();d.m=week.getUTCMonth();d.d=week.getUTCDate()+(d.w+6)%7}else{week=newDate(newYear(d.y)),day$1=week.getDay();week=day$1>4||day$1===0?monday.ceil(week):monday(week);week=day.offset(week,(d.V-1)*7);d.y=week.getFullYear();d.m=week.getMonth();d.d=week.getDate()+(d.w+6)%7}}else if("W"in d||"U"in d){if(!("w"in d))d.w="u"in d?d.u%7:"W"in d?1:0;day$1="Z"in d?utcDate(newYear(d.y)).getUTCDay():newDate(newYear(d.y)).getDay();d.m=0;d.d="W"in d?(d.w+6)%7+d.W*7-(day$1+5)%7:d.w+d.U*7-(day$1+6)%7}if("Z"in d){d.H+=d.Z/100|0;d.M+=d.Z%100;return utcDate(d)}return newDate(d)}}function parseSpecifier(d,specifier,string,j){var i=0,n=specifier.length,m=string.length,c,parse;while(i<n){if(j>=m)return-1;c=specifier.charCodeAt(i++);if(c===37){c=specifier.charAt(i++);parse=parses[c in pads?specifier.charAt(i++):c];if(!parse||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}function parsePeriod(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortWeekday(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseWeekday(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortMonth(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseMonth(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseLocaleDateTime(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)}function parseLocaleDate(d,string,i){return parseSpecifier(d,locale_date,string,i)}function parseLocaleTime(d,string,i){return parseSpecifier(d,locale_time,string,i)}function formatShortWeekday(d){return locale_shortWeekdays[d.getDay()]}function formatWeekday(d){return locale_weekdays[d.getDay()]}function formatShortMonth(d){return locale_shortMonths[d.getMonth()]}function formatMonth(d){return locale_months[d.getMonth()]}function formatPeriod(d){return locale_periods[+(d.getHours()>=12)]}function formatUTCShortWeekday(d){return locale_shortWeekdays[d.getUTCDay()]}function formatUTCWeekday(d){return locale_weekdays[d.getUTCDay()]}function formatUTCShortMonth(d){return locale_shortMonths[d.getUTCMonth()]}function formatUTCMonth(d){return locale_months[d.getUTCMonth()]}function formatUTCPeriod(d){return locale_periods[+(d.getUTCHours()>=12)]}return{format:function(specifier){var f=newFormat(specifier+="",formats);f.toString=function(){return specifier};return f},parse:function(specifier){var p=newParse(specifier+="",localDate);p.toString=function(){return specifier};return p},utcFormat:function(specifier){var f=newFormat(specifier+="",utcFormats);f.toString=function(){return specifier};return f},utcParse:function(specifier){var p=newParse(specifier,utcDate);p.toString=function(){return specifier};return p}}}var pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad$2(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){var map={},i=-1,n=names.length;while(++i<n)map[names[i].toLowerCase()]=i;return map}function parseWeekdayNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekdayNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.u=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberISO(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.V=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseMicroseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+6));return n?(d.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function parseUnixTimestamp(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0],i+n[0].length):-1}function parseUnixTimestampSeconds(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0]*1e3,i+n[0].length):-1}function formatDayOfMonth(d,p){return pad$2(d.getDate(),p,2)}function formatHour24(d,p){return pad$2(d.getHours(),p,2)}function formatHour12(d,p){return pad$2(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad$2(1+day.count(year(d),d),p,3)}function formatMilliseconds(d,p){return pad$2(d.getMilliseconds(),p,3)}function formatMicroseconds(d,p){return formatMilliseconds(d,p)+"000"}function formatMonthNumber(d,p){return pad$2(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad$2(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad$2(d.getSeconds(),p,2)}function formatWeekdayNumberMonday(d){var day=d.getDay();return day===0?7:day}function formatWeekNumberSunday(d,p){return pad$2(sunday.count(year(d),d),p,2)}function formatWeekNumberISO(d,p){var day=d.getDay();d=day>=4||day===0?thursday(d):thursday.ceil(d);return pad$2(thursday.count(year(d),d)+(year(d).getDay()===4),p,2)}function formatWeekdayNumberSunday(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad$2(monday.count(year(d),d),p,2)}function formatYear$1(d,p){return pad$2(d.getFullYear()%100,p,2)}function formatFullYear(d,p){return pad$2(d.getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+pad$2(z/60|0,"0",2)+pad$2(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad$2(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad$2(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad$2(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad$2(1+utcDay.count(utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad$2(d.getUTCMilliseconds(),p,3)}function formatUTCMicroseconds(d,p){return formatUTCMilliseconds(d,p)+"000"}function formatUTCMonthNumber(d,p){return pad$2(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad$2(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad$2(d.getUTCSeconds(),p,2)}function formatUTCWeekdayNumberMonday(d){var dow=d.getUTCDay();return dow===0?7:dow}function formatUTCWeekNumberSunday(d,p){return pad$2(utcSunday.count(utcYear(d),d),p,2)}function formatUTCWeekNumberISO(d,p){var day=d.getUTCDay();d=day>=4||day===0?utcThursday(d):utcThursday.ceil(d);return pad$2(utcThursday.count(utcYear(d),d)+(utcYear(d).getUTCDay()===4),p,2)}function formatUTCWeekdayNumberSunday(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad$2(utcMonday.count(utcYear(d),d),p,2)}function formatUTCYear(d,p){return pad$2(d.getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad$2(d.getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(d){return+d}function formatUnixTimestampSeconds(d){return Math.floor(+d/1e3)}var locale;var timeFormat;var timeParse;var utcFormat;var utcParse;defaultLocale({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function defaultLocale(definition){locale=formatLocale(definition);timeFormat=locale.format;timeParse=locale.parse;utcFormat=locale.utcFormat;utcParse=locale.utcParse;return locale}var isoSpecifier="%Y-%m-%dT%H:%M:%S.%LZ";function formatIsoNative(date){return date.toISOString()}var formatIso=Date.prototype.toISOString?formatIsoNative:utcFormat(isoSpecifier);function parseIsoNative(string){var date=new Date(string);return isNaN(date)?null:date}var parseIso=+new Date("2000-01-01T00:00:00.000Z")?parseIsoNative:utcParse(isoSpecifier);function read(data,schema,dateParse){schema=schema||{};const reader=formats(schema.type||"json");if(!reader)error("Unknown data format type: "+schema.type);data=reader(data,schema);if(schema.parse)parse(data,schema.parse,dateParse);if(data.hasOwnProperty("columns"))delete data.columns;return data}function parse(data,types,dateParse){if(!data.length)return;dateParse=dateParse||timeParse;var fields=data.columns||Object.keys(data[0]),parsers,datum,field,i,j,n,m;if(types==="auto")types=inferTypes(data,fields);fields=Object.keys(types);parsers=fields.map(function(field){var type=types[field],parts,pattern;if(type&&(type.indexOf("date:")===0||type.indexOf("utc:")===0)){parts=type.split(/:(.+)?/,2);pattern=parts[1];if(pattern[0]==="'"&&pattern[pattern.length-1]==="'"||pattern[0]==='"'&&pattern[pattern.length-1]==='"'){pattern=pattern.slice(1,-1)}return parts[0]==="utc"?utcParse(pattern):dateParse(pattern)}if(!typeParsers[type]){throw Error("Illegal format pattern: "+field+":"+type)}return typeParsers[type]});for(i=0,n=data.length,m=fields.length;i<n;++i){datum=data[i];for(j=0;j<m;++j){field=fields[j];datum[field]=parsers[j](datum[field])}}}var loader=loaderFactory(typeof fetch!=="undefined"&&fetch,null);const parse$1=read;function ingest$1(target,data,format){return this.pulse(target,this.changeset().insert(parse$1(data,format)))}async function request(url,format){const df=this;let status=0,data;try{data=await df.loader().load(url,{context:"dataflow",response:responseType(format&&format.type)});try{data=parse$1(data,format)}catch(err){status=-2;df.warn("Data ingestion failed",url,err)}}catch(err){status=-1;df.warn("Loading failed",url,err)}return{data:data,status:status}}async function preload(target,url,format){const df=this,pending=df._pending||loadPending(df);pending.requests+=1;const res=await df.request(url,format);df.pulse(target,df.changeset().remove(truthy).insert(res.data||[]));pending.done();return res}function loadPending(df){var pending=new Promise(function(a){accept=a}),accept;pending.requests=0;pending.done=function(){if(--pending.requests===0){df._pending=null;accept(df)}};return df._pending=pending}var SKIP$1={skip:true};function on(source,target,update,params,options){var fn=source instanceof Operator?onOperator:onStream;fn(this,source,target,update,params,options);return this}function onStream(df,stream,target,update,params,options){var opt=extend({},options,SKIP$1),func,op;if(!isFunction(target))target=constant(target);if(update===undefined){func=(e=>df.touch(target(e)))}else if(isFunction(update)){op=new Operator(null,update,params,false);func=(e=>{op.evaluate(e);const t=target(e),v=op.value;isChangeSet(v)?df.pulse(t,v,options):df.update(t,v,opt)})}else{func=(e=>df.update(target(e),update,opt))}stream.apply(func)}function onOperator(df,source,target,update,params,options){if(update===undefined){source.targets().add(target)}else{const opt=options||{},op=new Operator(null,updater(target,update),params,false);op.modified(opt.force);op.rank=source.rank;source.targets().add(op);if(target){op.skip(true);op.value=target.value;op.targets().add(target);df.connect(target,[op])}}}function updater(target,update){update=isFunction(update)?update:constant(update);return target?function(_,pulse){const value=update(_,pulse);if(!target.skip()){target.skip(value!==this.value).value=value}return value}:update}function rank(op){op.rank=++this._rank}function rerank(op){var queue=[op],cur,list,i;while(queue.length){this.rank(cur=queue.pop());if(list=cur._targets){for(i=list.length;--i>=0;){queue.push(cur=list[i]);if(cur===op)error("Cycle detected in dataflow graph.")}}}}var StopPropagation={};var ADD=1<<0,REM=1<<1,MOD=1<<2,ADD_REM=ADD|REM,ADD_MOD=ADD|MOD,ALL=ADD|REM|MOD,REFLOW=1<<3,SOURCE=1<<4,NO_SOURCE=1<<5,NO_FIELDS=1<<6;function Pulse(dataflow,stamp,encode){this.dataflow=dataflow;this.stamp=stamp==null?-1:stamp;this.add=[];this.rem=[];this.mod=[];this.fields=null;this.encode=encode||null}var prototype$3=Pulse.prototype;prototype$3.StopPropagation=StopPropagation;prototype$3.ADD=ADD;prototype$3.REM=REM;prototype$3.MOD=MOD;prototype$3.ADD_REM=ADD_REM;prototype$3.ADD_MOD=ADD_MOD;prototype$3.ALL=ALL;prototype$3.REFLOW=REFLOW;prototype$3.SOURCE=SOURCE;prototype$3.NO_SOURCE=NO_SOURCE;prototype$3.NO_FIELDS=NO_FIELDS;prototype$3.fork=function(flags){return new Pulse(this.dataflow).init(this,flags)};prototype$3.clone=function(){var p=this.fork(ALL);p.add=p.add.slice();p.rem=p.rem.slice();p.mod=p.mod.slice();if(p.source)p.source=p.source.slice();return p.materialize(ALL|SOURCE)};prototype$3.addAll=function(){var p=this;if(!this.source||this.source.length===this.add.length){return p}else{p=new Pulse(this.dataflow).init(this);p.add=p.source;return p}};prototype$3.init=function(src,flags){var p=this;p.stamp=src.stamp;p.encode=src.encode;if(src.fields&&!(flags&NO_FIELDS)){p.fields=src.fields}if(flags&ADD){p.addF=src.addF;p.add=src.add}else{p.addF=null;p.add=[]}if(flags&REM){p.remF=src.remF;p.rem=src.rem}else{p.remF=null;p.rem=[]}if(flags&MOD){p.modF=src.modF;p.mod=src.mod}else{p.modF=null;p.mod=[]}if(flags&NO_SOURCE){p.srcF=null;p.source=null}else{p.srcF=src.srcF;p.source=src.source}return p};prototype$3.runAfter=function(func){this.dataflow.runAfter(func)};prototype$3.changed=function(flags){var f=flags||ALL;return f&ADD&&this.add.length||f&REM&&this.rem.length||f&MOD&&this.mod.length};prototype$3.reflow=function(fork){if(fork)return this.fork(ALL).reflow();var len=this.add.length,src=this.source&&this.source.length;if(src&&src!==len){this.mod=this.source;if(len)this.filter(MOD,filter(this,ADD))}return this};prototype$3.modifies=function(_){var fields=array(_),hash=this.fields||(this.fields={});fields.forEach(function(f){hash[f]=true});return this};prototype$3.modified=function(_){var fields=this.fields;return!(this.mod.length&&fields)?false:!arguments.length?!!fields:isArray(_)?_.some(function(f){return fields[f]}):fields[_]};prototype$3.filter=function(flags,filter){var p=this;if(flags&ADD)p.addF=addFilter(p.addF,filter);if(flags&REM)p.remF=addFilter(p.remF,filter);if(flags&MOD)p.modF=addFilter(p.modF,filter);if(flags&SOURCE)p.srcF=addFilter(p.srcF,filter);return p};function addFilter(a,b){return a?function(t,i){return a(t,i)&&b(t,i)}:b}prototype$3.materialize=function(flags){flags=flags||ALL;var p=this;if(flags&ADD&&p.addF){p.add=materialize(p.add,p.addF);p.addF=null}if(flags&REM&&p.remF){p.rem=materialize(p.rem,p.remF);p.remF=null}if(flags&MOD&&p.modF){p.mod=materialize(p.mod,p.modF);p.modF=null}if(flags&SOURCE&&p.srcF){p.source=p.source.filter(p.srcF);p.srcF=null}return p};function materialize(data,filter){var out=[];visitArray(data,filter,function(_){out.push(_)});return out}function filter(pulse,flags){var map={};pulse.visit(flags,function(t){map[tupleid(t)]=1});return function(t){return map[tupleid(t)]?null:t}}prototype$3.visit=function(flags,visitor){var p=this,v=visitor,src,sum;if(flags&SOURCE){visitArray(p.source,p.srcF,v);return p}if(flags&ADD)visitArray(p.add,p.addF,v);if(flags&REM)visitArray(p.rem,p.remF,v);if(flags&MOD)visitArray(p.mod,p.modF,v);if(flags&REFLOW&&(src=p.source)){sum=p.add.length+p.mod.length;if(sum===src.length);else if(sum){visitArray(src,filter(p,ADD_MOD),v)}else{visitArray(src,p.srcF,v)}}return p};function MultiPulse(dataflow,stamp,pulses,encode){var p=this,c=0,pulse,hash,i,n,f;this.dataflow=dataflow;this.stamp=stamp;this.fields=null;this.encode=encode||null;this.pulses=pulses;for(i=0,n=pulses.length;i<n;++i){pulse=pulses[i];if(pulse.stamp!==stamp)continue;if(pulse.fields){hash=p.fields||(p.fields={});for(f in pulse.fields){hash[f]=1}}if(pulse.changed(p.ADD))c|=p.ADD;if(pulse.changed(p.REM))c|=p.REM;if(pulse.changed(p.MOD))c|=p.MOD}this.changes=c}var prototype$4=inherits(MultiPulse,Pulse);prototype$4.fork=function(flags){var p=new Pulse(this.dataflow).init(this,flags&this.NO_FIELDS);if(flags!==undefined){if(flags&p.ADD){this.visit(p.ADD,function(t){return p.add.push(t)})}if(flags&p.REM){this.visit(p.REM,function(t){return p.rem.push(t)})}if(flags&p.MOD){this.visit(p.MOD,function(t){return p.mod.push(t)})}}return p};prototype$4.changed=function(flags){return this.changes&flags};prototype$4.modified=function(_){var p=this,fields=p.fields;return!(fields&&p.changes&p.MOD)?0:isArray(_)?_.some(function(f){return fields[f]}):fields[_]};prototype$4.filter=function(){error("MultiPulse does not support filtering.")};prototype$4.materialize=function(){error("MultiPulse does not support materialization.")};prototype$4.visit=function(flags,visitor){var p=this,pulses=p.pulses,n=pulses.length,i=0;if(flags&p.SOURCE){for(;i<n;++i){pulses[i].visit(flags,visitor)}}else{for(;i<n;++i){if(pulses[i].stamp===p.stamp){pulses[i].visit(flags,visitor)}}}return p};async function evaluate(encode,prerun,postrun){const df=this,level=df.logLevel();if(df._pulse)return reentrant(df);if(df._pending){await df._pending}if(prerun)await asyncCallback(df,prerun);if(!df._touched.length){df.info("Dataflow invoked, but nothing to do.");return df}let stamp=++df._clock,count=0,op,next,dt,error;df._pulse=new Pulse(df,stamp,encode);if(level>=Info){dt=Date.now();df.debug("-- START PROPAGATION ("+stamp+") -----")}df._touched.forEach(function(op){df._enqueue(op,true)});df._touched=UniqueList(id);try{while(df._heap.size()>0){op=df._heap.pop();if(op.rank!==op.qrank){df._enqueue(op,true);continue}next=op.run(df._getPulse(op,encode));if(next.then){next=await next}if(level>=Debug){df.debug(op.id,next===StopPropagation?"STOP":next,op)}if(next!==StopPropagation){df._pulse=next;if(op._targets)op._targets.forEach(op=>df._enqueue(op))}++count}}catch(err){error=err}df._pulses={};df._pulse=null;if(level>=Info){dt=Date.now()-dt;df.info("> Pulse "+stamp+": "+count+" operators; "+dt+"ms")}if(error){df._postrun=[];df.error(error)}if(df._postrun.length){const pr=df._postrun.sort((a,b)=>b.priority-a.priority);df._postrun=[];for(let i=0;i<pr.length;++i){await asyncCallback(df,pr[i].callback)}}if(postrun)await asyncCallback(df,postrun);return df}async function runAsync(encode,prerun,postrun){while(this._running)await this._running;const clear=()=>this._running=null;(this._running=this.evaluate(encode,prerun,postrun)).then(clear,clear);return this._running}function run(encode,prerun,postrun){return this._pulse?reentrant(this):(this.evaluate(encode,prerun,postrun),this)}function runAfter(callback,enqueue,priority){if(this._pulse||enqueue){this._postrun.push({priority:priority||0,callback:callback})}else{try{callback(this)}catch(err){this.error(err)}}}function reentrant(df){df.error("Dataflow already running. Use runAsync() to chain invocations.");return df}function enqueue(op,force){var p=!this._pulses[op.id];if(p)this._pulses[op.id]=this._pulse;if(p||force){op.qrank=op.rank;this._heap.push(op)}}function getPulse(op,encode){var s=op.source,stamp=this._clock,p;if(s&&isArray(s)){p=s.map(function(_){return _.pulse});return new MultiPulse(this,stamp,p,encode)}p=this._pulses[op.id];if(s){s=s.pulse;if(!s||s===StopPropagation){p.source=[]}else if(s.stamp===stamp&&p.target!==op){p=s}else{p.source=s.source}}return p}var NO_OPT={skip:false,force:false};function touch(op,options){var opt=options||NO_OPT;if(this._pulse){this._enqueue(op)}else{this._touched.add(op)}if(opt.skip)op.skip(true);return this}function update(op,value,options){var opt=options||NO_OPT;if(op.set(value)||opt.force){this.touch(op,opt)}return this}function pulse(op,changeset,options){this.touch(op,options||NO_OPT);var p=new Pulse(this,this._clock+(this._pulse?0:1)),t=op.pulse&&op.pulse.source||[];p.target=op;this._pulses[op.id]=changeset.pulse(p,t);return this}function Heap(cmp){var nodes=[];return{size:()=>nodes.length,peek:()=>nodes[0],push:x=>{nodes.push(x);return siftdown(nodes,0,nodes.length-1,cmp)},pop:()=>{var last=nodes.pop(),item;if(nodes.length){item=nodes[0];nodes[0]=last;siftup(nodes,0,cmp)}else{item=last}return item}}}function siftdown(array,start,idx,cmp){var item,parent,pidx;item=array[idx];while(idx>start){pidx=idx-1>>1;parent=array[pidx];if(cmp(item,parent)<0){array[idx]=parent;idx=pidx;continue}break}return array[idx]=item}function siftup(array,idx,cmp){var start=idx,end=array.length,item=array[idx],cidx=(idx<<1)+1,ridx;while(cidx<end){ridx=cidx+1;if(ridx<end&&cmp(array[cidx],array[ridx])>=0){cidx=ridx}array[idx]=array[cidx];idx=cidx;cidx=(idx<<1)+1}array[idx]=item;return siftdown(array,start,idx,cmp)}function Dataflow(){this.logger(logger());this.logLevel(Error$1);this._clock=0;this._rank=0;try{this._loader=loader()}catch(e){}this._touched=UniqueList(id);this._pulses={};this._pulse=null;this._heap=Heap((a,b)=>a.qrank-b.qrank);this._postrun=[]}var prototype$5=Dataflow.prototype;prototype$5.stamp=function(){return this._clock};prototype$5.loader=function(_){if(arguments.length){this._loader=_;return this}else{return this._loader}};prototype$5.cleanThreshold=1e4;prototype$5.add=add;prototype$5.connect=connect;prototype$5.rank=rank;prototype$5.rerank=rerank;prototype$5.pulse=pulse;prototype$5.touch=touch;prototype$5.update=update;prototype$5.changeset=changeset;prototype$5.ingest=ingest$1;prototype$5.parse=parse$1;prototype$5.preload=preload;prototype$5.request=request;prototype$5.events=events;prototype$5.on=on;prototype$5.evaluate=evaluate;prototype$5.run=run;prototype$5.runAsync=runAsync;prototype$5.runAfter=runAfter;prototype$5._enqueue=enqueue;prototype$5._getPulse=getPulse;function logMethod(method){return function(){return this._log[method].apply(this,arguments)}}prototype$5.logger=function(logger){if(arguments.length){this._log=logger;return this}else{return this._log}};prototype$5.error=logMethod("error");prototype$5.warn=logMethod("warn");prototype$5.info=logMethod("info");prototype$5.debug=logMethod("debug");prototype$5.logLevel=logMethod("level");function Transform(init,params){Operator.call(this,init,null,params)}var prototype$6=inherits(Transform,Operator);prototype$6.run=function(pulse){if(pulse.stamp<=this.stamp)return pulse.StopPropagation;var rv;if(this.skip()){this.skip(false)}else{rv=this.evaluate(pulse)}rv=rv||pulse;this.stamp=pulse.stamp;if(rv.then){rv=rv.then(_=>this.pulse=_)}else if(rv!==pulse.StopPropagation){this.pulse=rv}return rv};prototype$6.evaluate=function(pulse){var params=this.marshall(pulse.stamp),out=this.transform(params,pulse);params.clear();return out};prototype$6.transform=function(){};var transforms={};function definition(type){var t=transform$1(type);return t&&t.Definition||null}function transform$1(type){type=type&&type.toLowerCase();return transforms.hasOwnProperty(type)?transforms[type]:null}function multikey(f){return function(x){var n=f.length,i=1,k=String(f[0](x));for(;i<n;++i){k+="|"+f[i](x)}return k}}function groupkey(fields){return!fields||!fields.length?function(){return""}:fields.length===1?fields[0]:multikey(fields)}function measureName(op,field,as){return as||op+(!field?"":"_"+field)}var AggregateOps={values:measure({name:"values",init:"cell.store = true;",set:"cell.data.values()",idx:-1}),count:measure({name:"count",set:"cell.num"}),__count__:measure({name:"count",set:"this.missing + this.valid"}),missing:measure({name:"missing",set:"this.missing"}),valid:measure({name:"valid",set:"this.valid"}),sum:measure({name:"sum",init:"this.sum = 0;",add:"this.sum += +v;",rem:"this.sum -= v;",set:"this.sum"}),mean:measure({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.valid ? this.mean : undefined"}),average:measure({name:"average",set:"this.valid ? this.mean : undefined",req:["mean"],idx:1}),variance:measure({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : undefined",req:["mean"],idx:1}),variancep:measure({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : undefined",req:["variance"],idx:2}),stdev:measure({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : undefined",req:["variance"],idx:2}),stdevp:measure({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : undefined",req:["variance"],idx:2}),stderr:measure({name:"stderr",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid * (this.valid-1))) : undefined",req:["variance"],idx:2}),distinct:measure({name:"distinct",set:"cell.data.distinct(this.get)",req:["values"],idx:3}),ci0:measure({name:"ci0",set:"cell.data.ci0(this.get)",req:["values"],idx:3}),ci1:measure({name:"ci1",set:"cell.data.ci1(this.get)",req:["values"],idx:3}),median:measure({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:measure({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:measure({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),argmin:measure({name:"argmin",init:"this.argmin = undefined;",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = undefined;",set:"this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:measure({name:"argmax",init:"this.argmax = undefined;",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = undefined;",set:"this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:measure({name:"min",init:"this.min = undefined;",add:"if (v < this.min || this.min === undefined) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:measure({name:"max",init:"this.max = undefined;",add:"if (v > this.max || this.max === undefined) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4})};var ValidAggregateOps=Object.keys(AggregateOps);function createMeasure(op,name){return AggregateOps[op](name)}function measure(base){return function(out){var m=extend({init:"",add:"",rem:"",idx:0},base);m.out=out||base.name;return m}}function compareIndex(a,b){return a.idx-b.idx}function resolve(agg,stream){function collect(m,a){function helper(r){if(!m[r])collect(m,m[r]=AggregateOps[r]())}if(a.req)a.req.forEach(helper);if(stream&&a.str)a.str.forEach(helper);return m}var map=agg.reduce(collect,agg.reduce(function(m,a){m[a.name]=a;return m},{}));var values=[],key;for(key in map)values.push(map[key]);return values.sort(compareIndex)}function compileMeasures(agg,field){var get=field||identity,all=resolve(agg,true),init="var cell = this.cell; this.valid = 0; this.missing = 0;",ctr="this.cell = cell; this.init();",add="if(v==null){++this.missing; return;} if(v!==v) return; ++this.valid;",rem="if(v==null){--this.missing; return;} if(v!==v) return; --this.valid;",set="var cell = this.cell;";all.forEach(function(a){init+=a.init;add+=a.add;rem+=a.rem});agg.slice().sort(compareIndex).forEach(function(a){set+="t['"+a.out+"']="+a.set+";"});set+="return t;";ctr=Function("cell",ctr);ctr.prototype.init=Function(init);ctr.prototype.add=Function("v","t",add);ctr.prototype.rem=Function("v","t",rem);ctr.prototype.set=Function("t",set);ctr.prototype.get=get;ctr.fields=agg.map(function(_){return _.out});return ctr}function bin(_){var maxb=_.maxbins||20,base=_.base||10,logb=Math.log(base),div=_.divide||[5,2],min=_.extent[0],max=_.extent[1],span=max-min||Math.abs(min)||1,step,level,minstep,precision,v,i,n,eps;if(_.step){step=_.step}else if(_.steps){v=span/maxb;for(i=0,n=_.steps.length;i<n&&_.steps[i]<v;++i);step=_.steps[Math.max(0,i-1)]}else{level=Math.ceil(Math.log(maxb)/logb);minstep=_.minstep||0;step=Math.max(minstep,Math.pow(base,Math.round(Math.log(span)/logb)-level));while(Math.ceil(span/step)>maxb){step*=base}for(i=0,n=div.length;i<n;++i){v=step/div[i];if(v>=minstep&&span/v<=maxb)step=v}}v=Math.log(step);precision=v>=0?0:~~(-v/logb)+1;eps=Math.pow(base,-precision-1);if(_.nice||_.nice===undefined){v=Math.floor(min/step+eps)*step;min=min<v?v-step:v;max=Math.ceil(max/step)*step}return{start:min,stop:max===min?min+step:max,step:step}}function numbers(array,f){var numbers=[],n=array.length,i=-1,a;if(f==null){while(++i<n)if(!isNaN(a=number(array[i])))numbers.push(a)}else{while(++i<n)if(!isNaN(a=number(f(array[i],i,array))))numbers.push(a)}return numbers}function number(x){return x===null?NaN:+x}exports.random=Math.random;function setRandom(r){exports.random=r}function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(compare){if(compare.length===1)compare=ascendingComparator(compare);return{left:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}}function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}var ascendingBisect=bisector(ascending);var bisectRight=ascendingBisect.right;var bisectLeft=ascendingBisect.left;function variance(values,valueof){let count=0;let delta;let mean=0;let sum=0;if(valueof===undefined){for(let value of values){if(value!=null&&(value=+value)>=value){delta=value-mean;mean+=delta/++count;sum+=delta*(value-mean)}}}else{let index=-1;for(let value of values){if((value=valueof(value,++index,values))!=null&&(value=+value)>=value){delta=value-mean;mean+=delta/++count;sum+=delta*(value-mean)}}}if(count>1)return sum/(count-1)}function extent$1(values,valueof){let min;let max;if(valueof===undefined){for(let value of values){if(value!=null&&value>=value){if(min===undefined){min=max=value}else{if(min>value)min=value;if(max<value)max=value}}}}else{let index=-1;for(let value of values){if((value=valueof(value,++index,values))!=null&&value>=value){if(min===undefined){min=max=value}else{if(min>value)min=value;if(max<value)max=value}}}}return[min,max]}function sequence(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,i=-1,n,ticks,step;stop=+stop,start=+start,count=+count;if(start===stop&&count>0)return[start];if(reverse=stop<start)n=start,start=stop,stop=n;if((step=tickIncrement(start,stop,count))===0||!isFinite(step))return[];if(step>0){start=Math.ceil(start/step);stop=Math.floor(stop/step);ticks=new Array(n=Math.ceil(stop-start+1));while(++i<n)ticks[i]=(start+i)*step}else{start=Math.floor(start*step);stop=Math.ceil(stop*step);ticks=new Array(n=Math.ceil(start-stop+1));while(++i<n)ticks[i]=(start-i)/step}if(reverse)ticks.reverse();return ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;if(error>=e10)step1*=10;else if(error>=e5)step1*=5;else if(error>=e2)step1*=2;return stop<start?-step1:step1}function number$1(x){return x===null?NaN:+x}function quantile(values,p,valueof=number$1){if(!(n=values.length))return;if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values),value1=+valueof(values[i0+1],i0+1,values);return value0+(value1-value0)*(i-i0)}function max(values,valueof){let max;if(valueof===undefined){for(let value of values){if(value!=null&&value>=value&&(max===undefined||max<value)){max=value}}}else{let index=-1;for(let value of values){if((value=valueof(value,++index,values))!=null&&value>=value&&(max===undefined||max<value)){max=value}}}return max}function mean(values,valueof){let count=0;let sum=0;if(valueof===undefined){for(let value of values){if(value!=null&&(value=+value)>=value){++count,sum+=value}}}else{let index=-1;for(let value of values){if((value=valueof(value,++index,values))!=null&&(value=+value)>=value){++count,sum+=value}}}if(count)return sum/count}function quickselect(array,k,left=0,right=array.length-1,compare=ascending){while(right>left){if(right-left>600){const n=right-left+1;const m=k-left+1;const z=Math.log(n);const s=.5*Math.exp(2*z/3);const sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);const newLeft=Math.max(left,Math.floor(k-m*s/n+sd));const newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));quickselect(array,k,newLeft,newRight,compare)}const t=array[k];let i=left;let j=right;swap(array,left,k);if(compare(array[right],t)>0)swap(array,left,right);while(i<j){swap(array,i,j),++i,--j;while(compare(array[i],t)<0)++i;while(compare(array[j],t)>0)--j}if(compare(array[left],t)===0)swap(array,left,j);else++j,swap(array,j,right);if(j<=k)left=j+1;if(k<=j)right=j-1}return array}function swap(array,i,j){const t=array[i];array[i]=array[j];array[j]=t}function*numbers$1(values,valueof){if(valueof===undefined){for(let value of values){if(value!=null&&(value=+value)>=value){yield value}}}else{let index=-1;for(let value of values){if((value=valueof(value,++index,values))!=null&&(value=+value)>=value){yield value}}}}function median(values,valueof){values=Float64Array.from(numbers$1(values,valueof));if(!values.length)return;const n=values.length;const i=n>>1;quickselect(values,i-1,0);if((n&1)===0)quickselect(values,i,i);return quantile(values,.5)}function min(values,valueof){let min;if(valueof===undefined){for(let value of values){if(value!=null&&value>=value&&(min===undefined||min>value)){min=value}}}else{let index=-1;for(let value of values){if((value=valueof(value,++index,values))!=null&&value>=value&&(min===undefined||min>value)){min=value}}}return min}function permute(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes}function sum(values,valueof){let sum=0;if(valueof===undefined){for(let value of values){if(value=+value){sum+=value}}}else{let index=-1;for(let value of values){if(value=+valueof(value,++index,values)){sum+=value}}}return sum}function bootstrapCI(array,samples,alpha,f){if(!array.length)return[undefined,undefined];var values=numbers(array,f),n=values.length,m=samples,a,i,j,mu;for(j=0,mu=Array(m);j<m;++j){for(a=0,i=0;i<n;++i){a+=values[~~(exports.random()*n)]}mu[j]=a/n}return[quantile(mu.sort(ascending),alpha/2),quantile(mu,1-alpha/2)]}function quartiles(array,f){var values=numbers(array,f);return[quantile(values.sort(ascending),.25),quantile(values,.5),quantile(values,.75)]}function lcg(seed){return function(){seed=(1103515245*seed+12345)%2147483647;return seed/2147483647}}function integer(min,max){if(max==null){max=min;min=0}var dist={},a,b,d;dist.min=function(_){if(arguments.length){a=_||0;d=b-a;return dist}else{return a}};dist.max=function(_){if(arguments.length){b=_||0;d=b-a;return dist}else{return b}};dist.sample=function(){return a+Math.floor(d*exports.random())};dist.pdf=function(x){return x===Math.floor(x)&&x>=a&&x<b?1/d:0};dist.cdf=function(x){var v=Math.floor(x);return v<a?0:v>=b?1:(v-a+1)/d};dist.icdf=function(p){return p>=0&&p<=1?a-1+Math.floor(p*d):NaN};return dist.min(min).max(max)}function randomNormal(mean,stdev){var mu,sigma,next=NaN,dist={};dist.mean=function(_){if(arguments.length){mu=_||0;next=NaN;return dist}else{return mu}};dist.stdev=function(_){if(arguments.length){sigma=_==null?1:_;next=NaN;return dist}else{return sigma}};dist.sample=function(){var x=0,y=0,rds,c;if(next===next){x=next;next=NaN;return x}do{x=exports.random()*2-1;y=exports.random()*2-1;rds=x*x+y*y}while(rds===0||rds>1);c=Math.sqrt(-2*Math.log(rds)/rds);next=mu+y*c*sigma;return mu+x*c*sigma};dist.pdf=function(x){var exp=Math.exp(Math.pow(x-mu,2)/(-2*Math.pow(sigma,2)));return 1/(sigma*Math.sqrt(2*Math.PI))*exp};dist.cdf=function(x){var cd,z=(x-mu)/sigma,Z=Math.abs(z);if(Z>37){cd=0}else{var sum,exp=Math.exp(-Z*Z/2);if(Z<7.07106781186547){sum=.0352624965998911*Z+.700383064443688;sum=sum*Z+6.37396220353165;sum=sum*Z+33.912866078383;sum=sum*Z+112.079291497871;sum=sum*Z+221.213596169931;sum=sum*Z+220.206867912376;cd=exp*sum;sum=.0883883476483184*Z+1.75566716318264;sum=sum*Z+16.064177579207;sum=sum*Z+86.7807322029461;sum=sum*Z+296.564248779674;sum=sum*Z+637.333633378831;sum=sum*Z+793.826512519948;sum=sum*Z+440.413735824752;cd=cd/sum}else{sum=Z+.65;sum=Z+4/sum;sum=Z+3/sum;sum=Z+2/sum;sum=Z+1/sum;cd=exp/sum/2.506628274631}}return z>0?1-cd:cd};dist.icdf=function(p){if(p<=0||p>=1)return NaN;var x=2*p-1,v=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),a=2/(Math.PI*v)+Math.log(1-Math.pow(x,2))/2,b=Math.log(1-x*x)/v,s=(x>0?1:-1)*Math.sqrt(Math.sqrt(a*a-b)-a);return mu+sigma*Math.SQRT2*s};return dist.mean(mean).stdev(stdev)}function randomKDE(support,bandwidth){var kernel=randomNormal(),dist={},n=0;dist.data=function(_){if(arguments.length){support=_;n=_?_.length:0;return dist.bandwidth(bandwidth)}else{return support}};dist.bandwidth=function(_){if(!arguments.length)return bandwidth;bandwidth=_;if(!bandwidth&&support)bandwidth=estimateBandwidth(support);return dist};dist.sample=function(){return support[~~(exports.random()*n)]+bandwidth*kernel.sample()};dist.pdf=function(x){for(var y=0,i=0;i<n;++i){y+=kernel.pdf((x-support[i])/bandwidth)}return y/bandwidth/n};dist.cdf=function(x){for(var y=0,i=0;i<n;++i){y+=kernel.cdf((x-support[i])/bandwidth)}return y/n};dist.icdf=function(){throw Error("KDE icdf not supported.")};return dist.data(support)}function estimateBandwidth(array){var n=array.length,q=quartiles(array),h=(q[2]-q[0])/1.34;return 1.06*Math.min(Math.sqrt(variance(array)),h)*Math.pow(n,-.2)}function randomMixture(dists,weights){var dist={},m=0,w;function normalize(x){var w=[],sum=0,i;for(i=0;i<m;++i){sum+=w[i]=x[i]==null?1:+x[i]}for(i=0;i<m;++i){w[i]/=sum}return w}dist.weights=function(_){if(arguments.length){w=normalize(weights=_||[]);return dist}return weights};dist.distributions=function(_){if(arguments.length){if(_){m=_.length;dists=_}else{m=0;dists=[]}return dist.weights(weights)}return dists};dist.sample=function(){var r=exports.random(),d=dists[m-1],v=w[0],i=0;for(;i<m-1;v+=w[++i]){if(r<v){d=dists[i];break}}return d.sample()};dist.pdf=function(x){for(var p=0,i=0;i<m;++i){p+=w[i]*dists[i].pdf(x)}return p};dist.cdf=function(x){for(var p=0,i=0;i<m;++i){p+=w[i]*dists[i].cdf(x)}return p};dist.icdf=function(){throw Error("Mixture icdf not supported.")};return dist.distributions(dists).weights(weights)}function randomUniform(min,max){if(max==null){max=min==null?1:min;min=0}var dist={},a,b,d;dist.min=function(_){if(arguments.length){a=_||0;d=b-a;return dist}else{return a}};dist.max=function(_){if(arguments.length){b=_||0;d=b-a;return dist}else{return b}};dist.sample=function(){return a+d*exports.random()};dist.pdf=function(x){return x>=a&&x<=b?1/d:0};dist.cdf=function(x){return x<a?0:x>b?1:(x-a)/d};dist.icdf=function(p){return p>=0&&p<=1?a+p*d:NaN};return dist.min(min).max(max)}function TupleStore(key){this._key=key?field(key):tupleid;this.reset()}var prototype$7=TupleStore.prototype;prototype$7.reset=function(){this._add=[];this._rem=[];this._ext=null;this._get=null;this._q=null};prototype$7.add=function(v){this._add.push(v)};prototype$7.rem=function(v){this._rem.push(v)};prototype$7.values=function(){this._get=null;if(this._rem.length===0)return this._add;var a=this._add,r=this._rem,k=this._key,n=a.length,m=r.length,x=Array(n-m),map={},i,j,v;for(i=0;i<m;++i){map[k(r[i])]=1}for(i=0,j=0;i<n;++i){if(map[k(v=a[i])]){map[k(v)]=0}else{x[j++]=v}}this._rem=[];return this._add=x};prototype$7.distinct=function(get){var v=this.values(),n=v.length,map={},count=0,s;while(--n>=0){s=get(v[n])+"";if(!map.hasOwnProperty(s)){map[s]=1;++count}}return count};prototype$7.extent=function(get){if(this._get!==get||!this._ext){var v=this.values(),i=extentIndex(v,get);this._ext=[v[i[0]],v[i[1]]];this._get=get}return this._ext};prototype$7.argmin=function(get){return this.extent(get)[0]||{}};prototype$7.argmax=function(get){return this.extent(get)[1]||{}};prototype$7.min=function(get){var m=this.extent(get)[0];return m!=null?get(m):undefined};prototype$7.max=function(get){var m=this.extent(get)[1];return m!=null?get(m):undefined};prototype$7.quartile=function(get){if(this._get!==get||!this._q){this._q=quartiles(this.values(),get);this._get=get}return this._q};prototype$7.q1=function(get){return this.quartile(get)[0]};prototype$7.q2=function(get){return this.quartile(get)[1]};prototype$7.q3=function(get){return this.quartile(get)[2]};prototype$7.ci=function(get){if(this._get!==get||!this._ci){this._ci=bootstrapCI(this.values(),1e3,.05,get);this._get=get}return this._ci};prototype$7.ci0=function(get){return this.ci(get)[0]};prototype$7.ci1=function(get){return this.ci(get)[1]};function Aggregate(params){Transform.call(this,null,params);this._adds=[];this._mods=[];this._alen=0;this._mlen=0;this._drop=true;this._cross=false;this._dims=[];this._dnames=[];this._measures=[];this._countOnly=false;this._counts=null;this._prev=null;this._inputs=null;this._outputs=null}Aggregate.Definition={type:"Aggregate",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:ValidAggregateOps},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"drop",type:"boolean",default:true},{name:"cross",type:"boolean",default:false},{name:"key",type:"field"}]};var prototype$8=inherits(Aggregate,Transform);prototype$8.transform=function(_,pulse){var aggr=this,out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),mod;this.stamp=out.stamp;if(this.value&&((mod=_.modified())||pulse.modified(this._inputs))){this._prev=this.value;this.value=mod?this.init(_):{};pulse.visit(pulse.SOURCE,function(t){aggr.add(t)})}else{this.value=this.value||this.init(_);pulse.visit(pulse.REM,function(t){aggr.rem(t)});pulse.visit(pulse.ADD,function(t){aggr.add(t)})}out.modifies(this._outputs);aggr._drop=_.drop!==false;if(_.cross&&aggr._dims.length>1){aggr._drop=false;this.cross()}return aggr.changes(out)};prototype$8.cross=function(){var aggr=this,curr=aggr.value,dims=aggr._dnames,vals=dims.map(function(){return{}}),n=dims.length;function collect(cells){var key,i,t,v;for(key in cells){t=cells[key].tuple;for(i=0;i<n;++i){vals[i][v=t[dims[i]]]=v}}}collect(aggr._prev);collect(curr);function generate(base,tuple,index){var name=dims[index],v=vals[index++],k,key;for(k in v){tuple[name]=v[k];key=base?base+"|"+k:k;if(index<n)generate(key,tuple,index);else if(!curr[key])aggr.cell(key,tuple)}}generate("",{},0)};prototype$8.init=function(_){var inputs=this._inputs=[],outputs=this._outputs=[],inputMap={};function inputVisit(get){var fields=array(accessorFields(get)),i=0,n=fields.length,f;for(;i<n;++i){if(!inputMap[f=fields[i]]){inputMap[f]=1;inputs.push(f)}}}this._dims=array(_.groupby);this._dnames=this._dims.map(function(d){var dname=accessorName(d);inputVisit(d);outputs.push(dname);return dname});this.cellkey=_.key?_.key:groupkey(this._dims);this._countOnly=true;this._counts=[];this._measures=[];var fields=_.fields||[null],ops=_.ops||["count"],as=_.as||[],n=fields.length,map={},field,op,m,mname,outname,i;if(n!==ops.length){error("Unmatched number of fields and aggregate ops.")}for(i=0;i<n;++i){field=fields[i];op=ops[i];if(field==null&&op!=="count"){error("Null aggregate field specified.")}mname=accessorName(field);outname=measureName(op,mname,as[i]);outputs.push(outname);if(op==="count"){this._counts.push(outname);continue}m=map[mname];if(!m){inputVisit(field);m=map[mname]=[];m.field=field;this._measures.push(m)}if(op!=="count")this._countOnly=false;m.push(createMeasure(op,outname))}this._measures=this._measures.map(function(m){return compileMeasures(m,m.field)});return{}};prototype$8.cellkey=groupkey();prototype$8.cell=function(key,t){var cell=this.value[key];if(!cell){cell=this.value[key]=this.newcell(key,t);this._adds[this._alen++]=cell}else if(cell.num===0&&this._drop&&cell.stamp<this.stamp){cell.stamp=this.stamp;this._adds[this._alen++]=cell}else if(cell.stamp<this.stamp){cell.stamp=this.stamp;this._mods[this._mlen++]=cell}return cell};prototype$8.newcell=function(key,t){var cell={key:key,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[key]),stamp:this.stamp,store:false};if(!this._countOnly){var measures=this._measures,n=measures.length,i;cell.agg=Array(n);for(i=0;i<n;++i){cell.agg[i]=new measures[i](cell)}}if(cell.store){cell.data=new TupleStore}return cell};prototype$8.newtuple=function(t,p){var names=this._dnames,dims=this._dims,x={},i,n;for(i=0,n=dims.length;i<n;++i){x[names[i]]=dims[i](t)}return p?replace(p.tuple,x):ingest(x)};prototype$8.add=function(t){var key=this.cellkey(t),cell=this.cell(key,t),agg,i,n;cell.num+=1;if(this._countOnly)return;if(cell.store)cell.data.add(t);agg=cell.agg;for(i=0,n=agg.length;i<n;++i){agg[i].add(agg[i].get(t),t)}};prototype$8.rem=function(t){var key=this.cellkey(t),cell=this.cell(key,t),agg,i,n;cell.num-=1;if(this._countOnly)return;if(cell.store)cell.data.rem(t);agg=cell.agg;for(i=0,n=agg.length;i<n;++i){agg[i].rem(agg[i].get(t),t)}};prototype$8.celltuple=function(cell){var tuple=cell.tuple,counts=this._counts,agg,i,n;if(cell.store){cell.data.values()}for(i=0,n=counts.length;i<n;++i){tuple[counts[i]]=cell.num}if(!this._countOnly){agg=cell.agg;for(i=0,n=agg.length;i<n;++i){agg[i].set(tuple)}}return tuple};prototype$8.changes=function(out){var adds=this._adds,mods=this._mods,prev=this._prev,drop=this._drop,add=out.add,rem=out.rem,mod=out.mod,cell,key,i,n;if(prev)for(key in prev){cell=prev[key];if(!drop||cell.num)rem.push(cell.tuple)}for(i=0,n=this._alen;i<n;++i){add.push(this.celltuple(adds[i]));adds[i]=null}for(i=0,n=this._mlen;i<n;++i){cell=mods[i];(cell.num===0&&drop?rem:mod).push(this.celltuple(cell));mods[i]=null}this._alen=this._mlen=0;this._prev=null;return out};const EPSILON=1e-14;function Bin(params){Transform.call(this,null,params)}Bin.Definition={type:"Bin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:true,default:[5,2]},{name:"extent",type:"number",array:true,length:2,required:true},{name:"step",type:"number"},{name:"steps",type:"number",array:true},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:true},{name:"name",type:"string"},{name:"as",type:"string",array:true,length:2,default:["bin0","bin1"]}]};var prototype$9=inherits(Bin,Transform);prototype$9.transform=function(_,pulse){var bins=this._bins(_),start=bins.start,step=bins.step,as=_.as||["bin0","bin1"],b0=as[0],b1=as[1],flag;if(_.modified()){pulse=pulse.reflow(true);flag=pulse.SOURCE}else{flag=pulse.modified(accessorFields(_.field))?pulse.ADD_MOD:pulse.ADD}pulse.visit(flag,function(t){var v=bins(t);t[b0]=v;t[b1]=v==null?null:start+step*(1+(v-start)/step)});return pulse.modifies(as)};prototype$9._bins=function(_){if(this.value&&!_.modified()){return this.value}var field=_.field,bins=bin(_),start=bins.start,stop=bins.stop,step=bins.step,a,d;if((a=_.anchor)!=null){d=a-(start+step*Math.floor((a-start)/step));start+=d;stop+=d}var f=function(t){var v=field(t);if(v==null){return null}else{v=Math.max(start,Math.min(+v,stop-step));return start+step*Math.floor(EPSILON+(v-start)/step)}};f.start=start;f.stop=stop;f.step=step;return this.value=accessor(f,accessorFields(field),_.name||"bin_"+accessorName(field))};function SortedList(idFunc,source,input){var $=idFunc,data=source||[],add=input||[],rem={},cnt=0;return{add:function(t){add.push(t)},remove:function(t){rem[$(t)]=++cnt},size:function(){return data.length},data:function(compare,resort){if(cnt){data=data.filter(function(t){return!rem[$(t)]});rem={};cnt=0}if(resort&&compare){data.sort(compare)}if(add.length){data=compare?merge(compare,data,add.sort(compare)):data.concat(add);add=[]}return data}}}function Collect(params){Transform.call(this,[],params)}Collect.Definition={type:"Collect",metadata:{source:true},params:[{name:"sort",type:"compare"}]};var prototype$a=inherits(Collect,Transform);prototype$a.transform=function(_,pulse){var out=pulse.fork(pulse.ALL),list=SortedList(tupleid,this.value,out.materialize(out.ADD).add),sort=_.sort,mod=pulse.changed()||sort&&(_.modified("sort")||pulse.modified(sort.fields));out.visit(out.REM,list.remove);this.modified(mod);this.value=out.source=list.data(sort,mod);if(pulse.source&&pulse.source.root){this.value.root=pulse.source.root}return out};function Compare(params){Operator.call(this,null,update$1,params)}inherits(Compare,Operator);function update$1(_){return this.value&&!_.modified()?this.value:compare(_.fields,_.orders)}function CountPattern(params){Transform.call(this,null,params)}CountPattern.Definition={type:"CountPattern",metadata:{generates:true,changes:true},params:[{name:"field",type:"field",required:true},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:true,length:2,default:["text","count"]}]};function tokenize(text,tcase,match){switch(tcase){case"upper":text=text.toUpperCase();break;case"lower":text=text.toLowerCase();break}return text.match(match)}var prototype$b=inherits(CountPattern,Transform);prototype$b.transform=function(_,pulse){function process(update){return function(tuple){var tokens=tokenize(get(tuple),_.case,match)||[],t;for(var i=0,n=tokens.length;i<n;++i){if(!stop.test(t=tokens[i]))update(t)}}}var init=this._parameterCheck(_,pulse),counts=this._counts,match=this._match,stop=this._stop,get=_.field,as=_.as||["text","count"],add=process(function(t){counts[t]=1+(counts[t]||0)}),rem=process(function(t){counts[t]-=1});if(init){pulse.visit(pulse.SOURCE,add)}else{pulse.visit(pulse.ADD,add);pulse.visit(pulse.REM,rem)}return this._finish(pulse,as)};prototype$b._parameterCheck=function(_,pulse){var init=false;if(_.modified("stopwords")||!this._stop){this._stop=new RegExp("^"+(_.stopwords||"")+"$","i");init=true}if(_.modified("pattern")||!this._match){this._match=new RegExp(_.pattern||"[\\w']+","g");init=true}if(_.modified("field")||pulse.modified(_.field.fields)){init=true}if(init)this._counts={};return init};prototype$b._finish=function(pulse,as){var counts=this._counts,tuples=this._tuples||(this._tuples={}),text=as[0],count=as[1],out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),w,t,c;for(w in counts){t=tuples[w];c=counts[w]||0;if(!t&&c){tuples[w]=t=ingest({});t[text]=w;t[count]=c;out.add.push(t)}else if(c===0){if(t)out.rem.push(t);counts[w]=null;tuples[w]=null}else if(t[count]!==c){t[count]=c;out.mod.push(t)}}return out.modifies(as)};function Cross(params){Transform.call(this,null,params)}Cross.Definition={type:"Cross",metadata:{generates:true},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:true,length:2,default:["a","b"]}]};var prototype$c=inherits(Cross,Transform);prototype$c.transform=function(_,pulse){var out=pulse.fork(pulse.NO_SOURCE),data=this.value,as=_.as||["a","b"],a=as[0],b=as[1],reset=!data||pulse.changed(pulse.ADD_REM)||_.modified("as")||_.modified("filter");if(reset){if(data)out.rem=data;data=pulse.materialize(pulse.SOURCE).source;out.add=this.value=cross(data,a,b,_.filter||truthy)}else{out.mod=data}out.source=this.value;return out.modifies(as)};function cross(input,a,b,filter){var data=[],t={},n=input.length,i=0,j,left;for(;i<n;++i){t[a]=left=input[i];for(j=0;j<n;++j){t[b]=input[j];if(filter(t)){data.push(ingest(t));t={};t[a]=left}}}return data}var Distributions={kde:randomKDE,mixture:randomMixture,normal:randomNormal,uniform:randomUniform};var DISTRIBUTIONS="distributions",FUNCTION="function",FIELD="field";function parse$2(def,data){var func=def[FUNCTION];if(!Distributions.hasOwnProperty(func)){error("Unknown distribution function: "+func)}var d=Distributions[func]();for(var name in def){if(name===FIELD){d.data((def.from||data()).map(def[name]))}else if(name===DISTRIBUTIONS){d[name](def[name].map(function(_){return parse$2(_,data)}))}else if(typeof d[name]===FUNCTION){d[name](def[name])}}return d}function Density(params){Transform.call(this,null,params)}var distributions=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:true},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];var mixture={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:true,params:distributions},{name:"weights",type:"number",array:true}]};Density.Definition={type:"Density",metadata:{generates:true},params:[{name:"extent",type:"number",array:true,length:2},{name:"steps",type:"number",default:100},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:distributions.concat(mixture)},{name:"as",type:"string",array:true,default:["value","density"]}]};var prototype$d=inherits(Density,Transform);prototype$d.transform=function(_,pulse){var out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS);if(!this.value||pulse.changed()||_.modified()){var dist=parse$2(_.distribution,source(pulse)),method=_.method||"pdf";if(method!=="pdf"&&method!=="cdf"){error("Invalid density method: "+method)}if(!_.extent&&!dist.data){error("Missing density extent parameter.")}method=dist[method];var as=_.as||["value","density"],domain=_.extent||extent$1(dist.data()),step=(domain[1]-domain[0])/(_.steps||100),values=sequence(domain[0],domain[1]+step/2,step).map(function(v){var tuple={};tuple[as[0]]=v;tuple[as[1]]=method(v);return ingest(tuple)});if(this.value)out.rem=this.value;this.value=out.add=out.source=values}return out};function source(pulse){return function(){return pulse.materialize(pulse.SOURCE).source}}function Expression(params){Operator.call(this,null,update$2,params);this.modified(true)}inherits(Expression,Operator);function update$2(_){var expr=_.expr;return this.value&&!_.modified("expr")?this.value:accessor(function(datum){return expr(datum,_)},accessorFields(expr),accessorName(expr))}function Extent(params){Transform.call(this,[undefined,undefined],params)}Extent.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:true}]};var prototype$e=inherits(Extent,Transform);prototype$e.transform=function(_,pulse){var extent=this.value,field=_.field,min=extent[0],max=extent[1],mod;mod=pulse.changed()||pulse.modified(field.fields)||_.modified("field");if(mod||min==null){min=+Infinity;max=-Infinity}pulse.visit(mod?pulse.SOURCE:pulse.ADD,function(t){var v=field(t);if(v!=null){v=+v;if(v<min)min=v;if(v>max)max=v}});if(!isFinite(min)||!isFinite(max)){min=max=undefined}this.value=[min,max]};function Subflow(pulse,parent){Operator.call(this,pulse);this.parent=parent}var prototype$f=inherits(Subflow,Operator);prototype$f.connect=function(target){this.targets().add(target);return target.source=this};prototype$f.add=function(t){this.value.add.push(t)};prototype$f.rem=function(t){this.value.rem.push(t)};prototype$f.mod=function(t){this.value.mod.push(t)};prototype$f.init=function(pulse){this.value.init(pulse,pulse.NO_SOURCE)};prototype$f.evaluate=function(){return this.value};function Facet(params){Transform.call(this,{},params);this._keys=fastmap();var a=this._targets=[];a.active=0;a.forEach=function(f){for(var i=0,n=a.active;i<n;++i)f(a[i],i,a)}}var prototype$g=inherits(Facet,Transform);prototype$g.activate=function(flow){this._targets[this._targets.active++]=flow};prototype$g.subflow=function(key,flow,pulse,parent){var flows=this.value,sf=flows.hasOwnProperty(key)&&flows[key],df,p;if(!sf){p=parent||(p=this._group[key])&&p.tuple;df=pulse.dataflow;sf=df.add(new Subflow(pulse.fork(pulse.NO_SOURCE),this)).connect(flow(df,key,p));flows[key]=sf;this.activate(sf)}else if(sf.value.stamp<pulse.stamp){sf.init(pulse);this.activate(sf)}return sf};prototype$g.transform=function(_,pulse){var df=pulse.dataflow,self=this,key=_.key,flow=_.subflow,cache=this._keys,rekey=_.modified("key");function subflow(key){return self.subflow(key,flow,pulse)}this._group=_.group||{};this._targets.active=0;pulse.visit(pulse.REM,function(t){var id=tupleid(t),k=cache.get(id);if(k!==undefined){cache.delete(id);subflow(k).rem(t)}});pulse.visit(pulse.ADD,function(t){var k=key(t);cache.set(tupleid(t),k);subflow(k).add(t)});if(rekey||pulse.modified(key.fields)){pulse.visit(pulse.MOD,function(t){var id=tupleid(t),k0=cache.get(id),k1=key(t);if(k0===k1){subflow(k1).mod(t)}else{cache.set(id,k1);subflow(k0).rem(t);subflow(k1).add(t)}})}else if(pulse.changed(pulse.MOD)){pulse.visit(pulse.MOD,function(t){subflow(cache.get(tupleid(t))).mod(t)})}if(rekey){pulse.visit(pulse.REFLOW,function(t){var id=tupleid(t),k0=cache.get(id),k1=key(t);if(k0!==k1){cache.set(id,k1);subflow(k0).rem(t);subflow(k1).add(t)}})}if(cache.empty>df.cleanThreshold)df.runAfter(cache.clean);return pulse};function Field(params){Operator.call(this,null,update$3,params)}inherits(Field,Operator);function update$3(_){return this.value&&!_.modified()?this.value:isArray(_.name)?array(_.name).map(function(f){return field(f)}):field(_.name,_.as)}function Filter(params){Transform.call(this,fastmap(),params)}Filter.Definition={type:"Filter",metadata:{changes:true},params:[{name:"expr",type:"expr",required:true}]};var prototype$h=inherits(Filter,Transform);prototype$h.transform=function(_,pulse){var df=pulse.dataflow,cache=this.value,output=pulse.fork(),add=output.add,rem=output.rem,mod=output.mod,test=_.expr,isMod=true;pulse.visit(pulse.REM,function(t){var id=tupleid(t);if(!cache.has(id))rem.push(t);else cache.delete(id)});pulse.visit(pulse.ADD,function(t){if(test(t,_))add.push(t);else cache.set(tupleid(t),1)});function revisit(t){var id=tupleid(t),b=test(t,_),s=cache.get(id);if(b&&s){cache.delete(id);add.push(t)}else if(!b&&!s){cache.set(id,1);rem.push(t)}else if(isMod&&b&&!s){mod.push(t)}}pulse.visit(pulse.MOD,revisit);if(_.modified()){isMod=false;pulse.visit(pulse.REFLOW,revisit)}if(cache.empty>df.cleanThreshold)df.runAfter(cache.clean);return output};function fieldNames(fields,as){if(!fields)return null;return fields.map(function(f,i){return as[i]||accessorName(f)})}function Flatten(params){Transform.call(this,[],params)}Flatten.Definition={type:"Flatten",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true}]};var prototype$i=inherits(Flatten,Transform);prototype$i.transform=function(_,pulse){var out=pulse.fork(pulse.NO_SOURCE),fields=_.fields,as=fieldNames(fields,_.as||[]),m=as.length;out.rem=this.value;pulse.visit(pulse.SOURCE,function(t){var arrays=fields.map(function(f){return f(t)}),maxlen=arrays.reduce(function(l,a){return Math.max(l,a.length)},0),i=0,j,d,v;for(;i<maxlen;++i){d=derive(t);for(j=0;j<m;++j){d[as[j]]=(v=arrays[j][i])==null?null:v}out.add.push(d)}});this.value=out.source=out.add;return out.modifies(as)};function Fold(params){Transform.call(this,[],params)}Fold.Definition={type:"Fold",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true,length:2,default:["key","value"]}]};var prototype$j=inherits(Fold,Transform);prototype$j.transform=function(_,pulse){var out=pulse.fork(pulse.NO_SOURCE),fields=_.fields,fnames=fields.map(accessorName),as=_.as||["key","value"],k=as[0],v=as[1],n=fields.length;out.rem=this.value;pulse.visit(pulse.SOURCE,function(t){for(var i=0,d;i<n;++i){d=derive(t);d[k]=fnames[i];d[v]=fields[i](t);out.add.push(d)}});this.value=out.source=out.add;return out.modifies(as)};function Formula(params){Transform.call(this,null,params)}Formula.Definition={type:"Formula",metadata:{modifies:true},params:[{name:"expr",type:"expr",required:true},{name:"as",type:"string",required:true},{name:"initonly",type:"boolean"}]};var prototype$k=inherits(Formula,Transform);prototype$k.transform=function(_,pulse){var func=_.expr,as=_.as,mod=_.modified(),flag=_.initonly?pulse.ADD:mod?pulse.SOURCE:pulse.modified(func.fields)?pulse.ADD_MOD:pulse.ADD;function set(t){t[as]=func(t,_)}if(mod){pulse=pulse.materialize().reflow(true)}if(!_.initonly){pulse.modifies(as)}return pulse.visit(flag,set)};function Generate(params){Transform.call(this,[],params)}var prototype$l=inherits(Generate,Transform);prototype$l.transform=function(_,pulse){var data=this.value,out=pulse.fork(pulse.ALL),num=_.size-data.length,gen=_.generator,add,rem,t;if(num>0){for(add=[];--num>=0;){add.push(t=ingest(gen(_)));data.push(t)}out.add=out.add.length?out.materialize(out.ADD).add.concat(add):add}else{rem=data.slice(0,-num);out.rem=out.rem.length?out.materialize(out.REM).rem.concat(rem):rem;data=data.slice(-num)}out.source=this.value=data;return out};var Methods={value:"value",median:median,mean:mean,min:min,max:max};var Empty=[];function Impute(params){Transform.call(this,[],params)}Impute.Definition={type:"Impute",metadata:{changes:true},params:[{name:"field",type:"field",required:true},{name:"key",type:"field",required:true},{name:"keyvals",array:true},{name:"groupby",type:"field",array:true},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var prototype$m=inherits(Impute,Transform);function getValue(_){var m=_.method||Methods.value,v;if(Methods[m]==null){error("Unrecognized imputation method: "+m)}else if(m===Methods.value){v=_.value!==undefined?_.value:0;return function(){return v}}else{return Methods[m]}}function getField(_){var f=_.field;return function(t){return t?f(t):NaN}}prototype$m.transform=function(_,pulse){var out=pulse.fork(pulse.ALL),impute=getValue(_),field=getField(_),fName=accessorName(_.field),kName=accessorName(_.key),gNames=(_.groupby||[]).map(accessorName),groups=partition(pulse.source,_.groupby,_.key,_.keyvals),curr=[],prev=this.value,m=groups.domain.length,group,value,gVals,kVal,g,i,j,l,n,t;for(g=0,l=groups.length;g<l;++g){group=groups[g];gVals=group.values;value=NaN;for(j=0;j<m;++j){if(group[j]!=null)continue;kVal=groups.domain[j];t={_impute:true};for(i=0,n=gVals.length;i<n;++i)t[gNames[i]]=gVals[i];t[kName]=kVal;t[fName]=isNaN(value)?value=impute(group,field):value;curr.push(ingest(t))}}if(curr.length)out.add=out.materialize(out.ADD).add.concat(curr);if(prev.length)out.rem=out.materialize(out.REM).rem.concat(prev);this.value=curr;return out};function partition(data,groupby,key,keyvals){var get=function(f){return f(t)},groups=[],domain=keyvals?keyvals.slice():[],kMap={},gMap={},gVals,gKey,group,i,j,k,n,t;domain.forEach(function(k,i){kMap[k]=i+1});for(i=0,n=data.length;i<n;++i){t=data[i];k=key(t);j=kMap[k]||(kMap[k]=domain.push(k));gKey=(gVals=groupby?groupby.map(get):Empty)+"";if(!(group=gMap[gKey])){group=gMap[gKey]=[];groups.push(group);group.values=gVals}group[j-1]=t}groups.domain=domain;return groups}function JoinAggregate(params){Aggregate.call(this,params)}JoinAggregate.Definition={type:"JoinAggregate",metadata:{modifies:true},params:[{name:"groupby",type:"field",array:true},{name:"fields",type:"field",null:true,array:true},{name:"ops",type:"enum",array:true,values:ValidAggregateOps},{name:"as",type:"string",null:true,array:true},{name:"key",type:"field"}]};var prototype$n=inherits(JoinAggregate,Aggregate);prototype$n.transform=function(_,pulse){var aggr=this,mod=_.modified(),cells;if(aggr.value&&(mod||pulse.modified(aggr._inputs))){cells=aggr.value=mod?aggr.init(_):{};pulse.visit(pulse.SOURCE,function(t){aggr.add(t)})}else{cells=aggr.value=aggr.value||this.init(_);pulse.visit(pulse.REM,function(t){aggr.rem(t)});pulse.visit(pulse.ADD,function(t){aggr.add(t)})}aggr.changes();pulse.visit(pulse.SOURCE,function(t){extend(t,cells[aggr.cellkey(t)].tuple)});return pulse.reflow(mod).modifies(this._outputs)};prototype$n.changes=function(){var adds=this._adds,mods=this._mods,i,n;for(i=0,n=this._alen;i<n;++i){this.celltuple(adds[i]);adds[i]=null}for(i=0,n=this._mlen;i<n;++i){this.celltuple(mods[i]);mods[i]=null}this._alen=this._mlen=0};function Key(params){Operator.call(this,null,update$4,params)}inherits(Key,Operator);function update$4(_){return this.value&&!_.modified()?this.value:key(_.fields,_.flat)}function Load(params){Transform.call(this,[],params)}var prototype$o=inherits(Load,Transform);prototype$o.transform=function(_,pulse){const df=pulse.dataflow;if(_.values){return output(this,pulse,df.parse(_.values,_.format))}else{return df.request(_.url,_.format).then(res=>output(this,pulse,res.data||[]))}};function output(op,pulse,data){data.forEach(ingest);const out=pulse.fork(pulse.NO_FIELDS&pulse.NO_SOURCE);out.rem=op.value;op.value=out.add=out.source=data;return out}function Lookup(params){Transform.call(this,{},params)}Lookup.Definition={type:"Lookup",metadata:{modifies:true},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:true},{name:"key",type:"field",required:true}]},{name:"values",type:"field",array:true},{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true},{name:"default",default:null}]};var prototype$p=inherits(Lookup,Transform);prototype$p.transform=function(_,pulse){var out=pulse,as=_.as,keys=_.fields,index=_.index,values=_.values,defaultValue=_.default==null?null:_.default,reset=_.modified(),flag=reset?pulse.SOURCE:pulse.ADD,n=keys.length,set,m,mods;if(values){m=values.length;if(n>1&&!as){error('Multi-field lookup requires explicit "as" parameter.')}if(as&&as.length!==n*m){error('The "as" parameter has too few output field names.')}as=as||values.map(accessorName);set=function(t){for(var i=0,k=0,j,v;i<n;++i){v=index.get(keys[i](t));if(v==null)for(j=0;j<m;++j,++k)t[as[k]]=defaultValue;else for(j=0;j<m;++j,++k)t[as[k]]=values[j](v)}}}else{if(!as){error("Missing output field names.")}set=function(t){for(var i=0,v;i<n;++i){v=index.get(keys[i](t));t[as[i]]=v==null?defaultValue:v}}}if(reset){out=pulse.reflow(true)}else{mods=keys.some(function(k){return pulse.modified(k.fields)});flag|=mods?pulse.MOD:0}pulse.visit(flag,set);return out.modifies(as)};function MultiExtent(params){Operator.call(this,null,update$5,params)}inherits(MultiExtent,Operator);function update$5(_){if(this.value&&!_.modified()){return this.value}var min=+Infinity,max=-Infinity,ext=_.extents,i,n,e;for(i=0,n=ext.length;i<n;++i){e=ext[i];if(e[0]<min)min=e[0];if(e[1]>max)max=e[1]}return[min,max]}function MultiValues(params){Operator.call(this,null,update$6,params)}inherits(MultiValues,Operator);function update$6(_){return this.value&&!_.modified()?this.value:_.values.reduce(function(data,_){return data.concat(_)},[])}function Params(params){Transform.call(this,null,params)}inherits(Params,Transform);Params.prototype.transform=function(_,pulse){this.modified(_.modified());this.value=_;return pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS)};function Pivot(params){Aggregate.call(this,params)}Pivot.Definition={type:"Pivot",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"value",type:"field",required:true},{name:"op",type:"enum",values:ValidAggregateOps,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var prototype$q=inherits(Pivot,Aggregate);prototype$q._transform=prototype$q.transform;prototype$q.transform=function(_,pulse){return this._transform(aggregateParams(_,pulse),pulse)};function aggregateParams(_,pulse){var key=_.field,value=_.value,op=(_.op==="count"?"__count__":_.op)||"sum",fields=accessorFields(key).concat(accessorFields(value)),keys=pivotKeys(key,_.limit||0,pulse);return{key:_.key,groupby:_.groupby,ops:keys.map(function(){return op}),fields:keys.map(function(k){return get(k,key,value,fields)}),as:keys.map(function(k){return k+""}),modified:_.modified.bind(_)}}function get(k,key,value,fields){return accessor(function(d){return key(d)===k?value(d):NaN},fields,k+"")}function pivotKeys(key,limit,pulse){var map={},list=[];pulse.visit(pulse.SOURCE,function(t){var k=key(t);if(!map[k]){map[k]=1;list.push(k)}});list.sort(function(u,v){return(u<v||u==null)&&v!=null?-1:(u>v||v==null)&&u!=null?1:(v=v instanceof Date?+v:v,u=u instanceof Date?+u:u)!==u&&v===v?-1:v!==v&&u===u?1:0});return limit?list.slice(0,limit):list}function PreFacet(params){Facet.call(this,params)}var prototype$r=inherits(PreFacet,Facet);prototype$r.transform=function(_,pulse){var self=this,flow=_.subflow,field=_.field;if(_.modified("field")||field&&pulse.modified(accessorFields(field))){error("PreFacet does not support field modification.")}this._targets.active=0;pulse.visit(pulse.MOD,function(t){var sf=self.subflow(tupleid(t),flow,pulse,t);field?field(t).forEach(function(_){sf.mod(_)}):sf.mod(t)});pulse.visit(pulse.ADD,function(t){var sf=self.subflow(tupleid(t),flow,pulse,t);field?field(t).forEach(function(_){sf.add(ingest(_))}):sf.add(t)});pulse.visit(pulse.REM,function(t){var sf=self.subflow(tupleid(t),flow,pulse,t);field?field(t).forEach(function(_){sf.rem(_)}):sf.rem(t)});return pulse};function Project(params){Transform.call(this,null,params)}Project.Definition={type:"Project",metadata:{generates:true,changes:true},params:[{name:"fields",type:"field",array:true},{name:"as",type:"string",null:true,array:true}]};var prototype$s=inherits(Project,Transform);prototype$s.transform=function(_,pulse){var fields=_.fields,as=fieldNames(_.fields,_.as||[]),derive=fields?function(s,t){return project(s,t,fields,as)}:rederive,out,lut;if(this.value){lut=this.value}else{pulse=pulse.addAll();lut=this.value={}}out=pulse.fork(pulse.NO_SOURCE);pulse.visit(pulse.REM,function(t){var id=tupleid(t);out.rem.push(lut[id]);lut[id]=null});pulse.visit(pulse.ADD,function(t){var dt=derive(t,ingest({}));lut[tupleid(t)]=dt;out.add.push(dt)});pulse.visit(pulse.MOD,function(t){out.mod.push(derive(t,lut[tupleid(t)]))});return out};function project(s,t,fields,as){for(var i=0,n=fields.length;i<n;++i){t[as[i]]=fields[i](s)}return t}function Proxy(params){Transform.call(this,null,params)}var prototype$t=inherits(Proxy,Transform);prototype$t.transform=function(_,pulse){this.value=_.value;return _.modified("value")?pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS):pulse.StopPropagation};function Relay(params){Transform.call(this,null,params)}var prototype$u=inherits(Relay,Transform);prototype$u.transform=function(_,pulse){var out,lut;if(this.value){lut=this.value}else{out=pulse=pulse.addAll();lut=this.value={}}if(_.derive){out=pulse.fork(pulse.NO_SOURCE);pulse.visit(pulse.REM,function(t){var id=tupleid(t);out.rem.push(lut[id]);lut[id]=null});pulse.visit(pulse.ADD,function(t){var dt=derive(t);lut[tupleid(t)]=dt;out.add.push(dt)});pulse.visit(pulse.MOD,function(t){out.mod.push(rederive(t,lut[tupleid(t)]))})}return out};function Sample(params){Transform.call(this,[],params);this.count=0}Sample.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var prototype$v=inherits(Sample,Transform);prototype$v.transform=function(_,pulse){var out=pulse.fork(pulse.NO_SOURCE),mod=_.modified("size"),num=_.size,res=this.value,cnt=this.count,cap=0,map=res.reduce(function(m,t){m[tupleid(t)]=1;return m},{});function update(t){var p,idx;if(res.length<num){res.push(t)}else{idx=~~((cnt+1)*exports.random());if(idx<res.length&&idx>=cap){p=res[idx];if(map[tupleid(p)])out.rem.push(p);res[idx]=t}}++cnt}if(pulse.rem.length){pulse.visit(pulse.REM,function(t){var id=tupleid(t);if(map[id]){map[id]=-1;out.rem.push(t)}--cnt});res=res.filter(function(t){return map[tupleid(t)]!==-1})}if((pulse.rem.length||mod)&&res.length<num&&pulse.source){cap=cnt=res.length;pulse.visit(pulse.SOURCE,function(t){if(!map[tupleid(t)])update(t)});cap=-1}if(mod&&res.length>num){for(var i=0,n=res.length-num;i<n;++i){map[tupleid(res[i])]=-1;out.rem.push(res[i])}res=res.slice(n)}if(pulse.mod.length){pulse.visit(pulse.MOD,function(t){if(map[tupleid(t)])out.mod.push(t)})}if(pulse.add.length){pulse.visit(pulse.ADD,update)}if(pulse.add.length||cap<0){out.add=res.filter(function(t){return!map[tupleid(t)]})}this.count=cnt;this.value=out.source=res;return out};function Sequence(params){Transform.call(this,null,params)}Sequence.Definition={type:"Sequence",metadata:{changes:true},params:[{name:"start",type:"number",required:true},{name:"stop",type:"number",required:true},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var prototype$w=inherits(Sequence,Transform);prototype$w.transform=function(_,pulse){if(this.value&&!_.modified())return;var out=pulse.materialize().fork(pulse.MOD),as=_.as||"data";out.rem=this.value?pulse.rem.concat(this.value):pulse.rem;this.value=sequence(_.start,_.stop,_.step||1).map(function(v){var t={};t[as]=v;return ingest(t)});out.add=pulse.add.concat(this.value);return out};function Sieve(params){Transform.call(this,null,params);this.modified(true)}var prototype$x=inherits(Sieve,Transform);prototype$x.transform=function(_,pulse){this.value=pulse.source;return pulse.changed()?pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS):pulse.StopPropagation};function TupleIndex(params){Transform.call(this,fastmap(),params)}var prototype$y=inherits(TupleIndex,Transform);prototype$y.transform=function(_,pulse){var df=pulse.dataflow,field=_.field,index=this.value,mod=true;function set(t){index.set(field(t),t)}if(_.modified("field")||pulse.modified(field.fields)){index.clear();pulse.visit(pulse.SOURCE,set)}else if(pulse.changed()){pulse.visit(pulse.REM,function(t){index.delete(field(t))});pulse.visit(pulse.ADD,set)}else{mod=false}this.modified(mod);if(index.empty>df.cleanThreshold)df.runAfter(index.clean);return pulse.fork()};function Values(params){Transform.call(this,null,params)}var prototype$z=inherits(Values,Transform);prototype$z.transform=function(_,pulse){var run=!this.value||_.modified("field")||_.modified("sort")||pulse.changed()||_.sort&&pulse.modified(_.sort.fields);if(run){this.value=(_.sort?pulse.source.slice().sort(_.sort):pulse.source).map(_.field)}};function WindowOp(op,field,param,as){var fn=WindowOps[op](field,param);return{init:fn.init||zero,update:function(w,t){t[as]=fn.next(w)}}}var WindowOps={row_number:function(){return{next:function(w){return w.index+1}}},rank:function(){var rank;return{init:function(){rank=1},next:function(w){var i=w.index,data=w.data;return i&&w.compare(data[i-1],data[i])?rank=i+1:rank}}},dense_rank:function(){var drank;return{init:function(){drank=1},next:function(w){var i=w.index,d=w.data;return i&&w.compare(d[i-1],d[i])?++drank:drank}}},percent_rank:function(){var rank=WindowOps.rank(),next=rank.next;return{init:rank.init,next:function(w){return(next(w)-1)/(w.data.length-1)}}},cume_dist:function(){var cume;return{init:function(){cume=0},next:function(w){var i=w.index,d=w.data,c=w.compare;if(cume<i){while(i+1<d.length&&!c(d[i],d[i+1]))++i;cume=i}return(1+cume)/d.length}}},ntile:function(field,num){num=+num;if(!(num>0))error("ntile num must be greater than zero.");var cume=WindowOps.cume_dist(),next=cume.next;return{init:cume.init,next:function(w){return Math.ceil(num*next(w))}}},lag:function(field,offset){offset=+offset||1;return{next:function(w){var i=w.index-offset;return i>=0?field(w.data[i]):null}}},lead:function(field,offset){offset=+offset||1;return{next:function(w){var i=w.index+offset,d=w.data;return i<d.length?field(d[i]):null}}},first_value:function(field){return{next:function(w){return field(w.data[w.i0])}}},last_value:function(field){return{next:function(w){return field(w.data[w.i1-1])}}},nth_value:function(field,nth){nth=+nth;if(!(nth>0))error("nth_value nth must be greater than zero.");return{next:function(w){var i=w.i0+(nth-1);return i<w.i1?field(w.data[i]):null}}}};var ValidWindowOps=Object.keys(WindowOps);function WindowState(_){var self=this,ops=array(_.ops),fields=array(_.fields),params=array(_.params),as=array(_.as),outputs=self.outputs=[],windows=self.windows=[],inputs={},map={},countOnly=true,counts=[],measures=[];function visitInputs(f){array(accessorFields(f)).forEach(function(_){inputs[_]=1})}visitInputs(_.sort);ops.forEach(function(op,i){var field=fields[i],mname=accessorName(field),name=measureName(op,mname,as[i]);visitInputs(field);outputs.push(name);if(WindowOps.hasOwnProperty(op)){windows.push(WindowOp(op,fields[i],params[i],name))}else{if(field==null&&op!=="count"){error("Null aggregate field specified.")}if(op==="count"){counts.push(name);return}countOnly=false;var m=map[mname];if(!m){m=map[mname]=[];m.field=field;measures.push(m)}m.push(createMeasure(op,name))}});if(counts.length||measures.length){self.cell=cell(measures,counts,countOnly)}self.inputs=Object.keys(inputs)}var prototype$A=WindowState.prototype;prototype$A.init=function(){this.windows.forEach(function(_){_.init()});if(this.cell)this.cell.init()};prototype$A.update=function(w,t){var self=this,cell=self.cell,wind=self.windows,data=w.data,m=wind&&wind.length,j;if(cell){for(j=w.p0;j<w.i0;++j)cell.rem(data[j]);for(j=w.p1;j<w.i1;++j)cell.add(data[j]);cell.set(t)}for(j=0;j<m;++j)wind[j].update(w,t)};function cell(measures,counts,countOnly){measures=measures.map(function(m){return compileMeasures(m,m.field)});var cell={num:0,agg:null,store:false,count:counts};if(!countOnly){var n=measures.length,a=cell.agg=Array(n),i=0;for(;i<n;++i)a[i]=new measures[i](cell)}if(cell.store){var store=cell.data=new TupleStore}cell.add=function(t){cell.num+=1;if(countOnly)return;if(store)store.add(t);for(var i=0;i<n;++i){a[i].add(a[i].get(t),t)}};cell.rem=function(t){cell.num-=1;if(countOnly)return;if(store)store.rem(t);for(var i=0;i<n;++i){a[i].rem(a[i].get(t),t)}};cell.set=function(t){var i,n;if(store)store.values();for(i=0,n=counts.length;i<n;++i)t[counts[i]]=cell.num;if(!countOnly)for(i=0,n=a.length;i<n;++i)a[i].set(t)};cell.init=function(){cell.num=0;if(store)store.reset();for(var i=0;i<n;++i)a[i].init()};return cell}function Window(params){Transform.call(this,{},params);this._mlen=0;this._mods=[]}Window.Definition={type:"Window",metadata:{modifies:true},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:ValidWindowOps.concat(ValidAggregateOps)},{name:"params",type:"number",null:true,array:true},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"frame",type:"number",null:true,array:true,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:false}]};var prototype$B=inherits(Window,Transform);prototype$B.transform=function(_,pulse){var self=this,state=self.state,mod=_.modified(),i,n;this.stamp=pulse.stamp;if(!state||mod){state=self.state=new WindowState(_)}var key=groupkey(_.groupby);function group(t){return self.group(key(t))}if(mod||pulse.modified(state.inputs)){self.value={};pulse.visit(pulse.SOURCE,function(t){group(t).add(t)})}else{pulse.visit(pulse.REM,function(t){group(t).remove(t)});pulse.visit(pulse.ADD,function(t){group(t).add(t)})}for(i=0,n=self._mlen;i<n;++i){processPartition(self._mods[i],state,_)}self._mlen=0;self._mods=[];return pulse.reflow(mod).modifies(state.outputs)};prototype$B.group=function(key){var self=this,group=self.value[key];if(!group){group=self.value[key]=SortedList(tupleid);group.stamp=-1}if(group.stamp<self.stamp){group.stamp=self.stamp;self._mods[self._mlen++]=group}return group};function processPartition(list,state,_){var sort=_.sort,range=sort&&!_.ignorePeers,frame=_.frame||[null,0],data=list.data(sort),n=data.length,i=0,b=range?bisector(sort):null,w={i0:0,i1:0,p0:0,p1:0,index:0,data:data,compare:sort||constant(-1)};for(state.init();i<n;++i){setWindow(w,frame,i,n);if(range)adjustRange(w,b);state.update(w,data[i])}}function setWindow(w,f,i,n){w.p0=w.i0;w.p1=w.i1;w.i0=f[0]==null?0:Math.max(0,i-Math.abs(f[0]));w.i1=f[1]==null?n:Math.min(n,i+Math.abs(f[1])+1);w.index=i}function adjustRange(w,bisect){var r0=w.i0,r1=w.i1-1,c=w.compare,d=w.data,n=d.length-1;if(r0>0&&!c(d[r0],d[r0-1]))w.i0=bisect.left(d,d[r0]);if(r1<n&&!c(d[r1],d[r1+1]))w.i1=bisect.right(d,d[r1])}var tx=Object.freeze({aggregate:Aggregate,bin:Bin,collect:Collect,compare:Compare,countpattern:CountPattern,cross:Cross,density:Density,expression:Expression,extent:Extent,facet:Facet,field:Field,filter:Filter,flatten:Flatten,fold:Fold,formula:Formula,generate:Generate,impute:Impute,joinaggregate:JoinAggregate,key:Key,load:Load,lookup:Lookup,multiextent:MultiExtent,multivalues:MultiValues,params:Params,pivot:Pivot,prefacet:PreFacet,project:Project,proxy:Proxy,relay:Relay,sample:Sample,sequence:Sequence,sieve:Sieve,subflow:Subflow,tupleindex:TupleIndex,values:Values,window:Window});const Top="top";const Left="left";const Right="right";const Bottom="bottom";const TopLeft="top-left";const TopRight="top-right";const BottomLeft="bottom-left";const BottomRight="bottom-right";const Start="start";const Middle="middle";const End="end";const X="x";const Y="y";const Group="group";const AxisRole="axis";const TitleRole="title";const FrameRole="frame";const ScopeRole="scope";const LegendRole="legend";const RowHeader="row-header";const RowFooter="row-footer";const RowTitle="row-title";const ColHeader="column-header";const ColFooter="column-footer";const ColTitle="column-title";const Padding="padding";const Symbols="symbol";const Fit="fit";const FitX="fit-x";const FitY="fit-y";const Pad="pad";const None$1="none";const All="all";const Each="each";const Flush="flush";const Column="column";const Row="row";function Bounds(b){this.clear();if(b)this.union(b)}var prototype$C=Bounds.prototype;prototype$C.clone=function(){return new Bounds(this)};prototype$C.clear=function(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this};prototype$C.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE};prototype$C.equals=function(b){return this.x1===b.x1&&this.y1===b.y1&&this.x2===b.x2&&this.y2===b.y2};prototype$C.set=function(x1,y1,x2,y2){if(x2<x1){this.x2=x1;this.x1=x2}else{this.x1=x1;this.x2=x2}if(y2<y1){this.y2=y1;this.y1=y2}else{this.y1=y1;this.y2=y2}return this};prototype$C.add=function(x,y){if(x<this.x1)this.x1=x;if(y<this.y1)this.y1=y;if(x>this.x2)this.x2=x;if(y>this.y2)this.y2=y;return this};prototype$C.expand=function(d){this.x1-=d;this.y1-=d;this.x2+=d;this.y2+=d;return this};prototype$C.round=function(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this};prototype$C.translate=function(dx,dy){this.x1+=dx;this.x2+=dx;this.y1+=dy;this.y2+=dy;return this};prototype$C.rotate=function(angle,x,y){const p=this.rotatedPoints(angle,x,y);return this.clear().add(p[0],p[1]).add(p[2],p[3]).add(p[4],p[5]).add(p[6],p[7])};prototype$C.rotatedPoints=function(angle,x,y){var{x1:x1,y1:y1,x2:x2,y2:y2}=this,cos=Math.cos(angle),sin=Math.sin(angle),cx=x-x*cos+y*sin,cy=y-x*sin-y*cos;return[cos*x1-sin*y1+cx,sin*x1+cos*y1+cy,cos*x1-sin*y2+cx,sin*x1+cos*y2+cy,cos*x2-sin*y1+cx,sin*x2+cos*y1+cy,cos*x2-sin*y2+cx,sin*x2+cos*y2+cy]};prototype$C.union=function(b){if(b.x1<this.x1)this.x1=b.x1;if(b.y1<this.y1)this.y1=b.y1;if(b.x2>this.x2)this.x2=b.x2;if(b.y2>this.y2)this.y2=b.y2;return this};prototype$C.intersect=function(b){if(b.x1>this.x1)this.x1=b.x1;if(b.y1>this.y1)this.y1=b.y1;if(b.x2<this.x2)this.x2=b.x2;if(b.y2<this.y2)this.y2=b.y2;return this};prototype$C.encloses=function(b){return b&&(this.x1<=b.x1&&this.x2>=b.x2&&this.y1<=b.y1&&this.y2>=b.y2)};prototype$C.alignsWith=function(b){return b&&(this.x1==b.x1||this.x2==b.x2||this.y1==b.y1||this.y2==b.y2)};prototype$C.intersects=function(b){return b&&!(this.x2<b.x1||this.x1>b.x2||this.y2<b.y1||this.y1>b.y2)};prototype$C.contains=function(x,y){return!(x<this.x1||x>this.x2||y<this.y1||y>this.y2)};prototype$C.width=function(){return this.x2-this.x1};prototype$C.height=function(){return this.y2-this.y1};var gradient_id=0;function Gradient(p0,p1){var stops=[],gradient;return gradient={id:"gradient_"+gradient_id++,x1:p0?p0[0]:0,y1:p0?p0[1]:0,x2:p1?p1[0]:1,y2:p1?p1[1]:0,stops:stops,stop:function(offset,color){stops.push({offset:offset,color:color});return gradient}}}function Item(mark){this.mark=mark;this.bounds=this.bounds||new Bounds}function GroupItem(mark){Item.call(this,mark);this.items=this.items||[]}inherits(GroupItem,Item);function domCanvas(w,h){if(typeof document!=="undefined"&&document.createElement){var c=document.createElement("canvas");if(c&&c.getContext){c.width=w;c.height=h;return c}}return null}function domImage(){return typeof Image!=="undefined"?Image:null}function ResourceLoader(customLoader){this._pending=0;this._loader=customLoader||loader()}var prototype$D=ResourceLoader.prototype;prototype$D.pending=function(){return this._pending};function increment(loader){loader._pending+=1}function decrement(loader){loader._pending-=1}prototype$D.sanitizeURL=function(uri){var loader=this;increment(loader);return loader._loader.sanitize(uri,{context:"href"}).then(function(opt){decrement(loader);return opt}).catch(function(){decrement(loader);return null})};prototype$D.loadImage=function(uri){var loader=this,Image=domImage();increment(loader);return loader._loader.sanitize(uri,{context:"image"}).then(function(opt){var url=opt.href;if(!url||!Image)throw{url:url};var img=new Image;img.onload=function(){decrement(loader);img.loaded=true};img.onerror=function(){decrement(loader);img.loaded=false};img.src=url;return img}).catch(function(e){decrement(loader);return{loaded:false,width:0,height:0,src:e&&e.url||""}})};prototype$D.ready=function(){var loader=this;return new Promise(function(accept){function poll(value){if(!loader.pending())accept(value);else setTimeout(function(){poll(true)},10)}poll(false)})};var pi=Math.PI,tau=2*pi,epsilon=1e-6,tauEpsilon=tau-epsilon;function Path(){this._x0=this._y0=this._x1=this._y1=null;this._=""}function path(){return new Path}Path.prototype=path.prototype={constructor:Path,moveTo:function(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}},lineTo:function(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function(x1,y1,x2,y2,r){x1=+x1,y1=+y1,x2=+x2,y2=+y2,r=+r;var x0=this._x1,y0=this._y1,x21=x2-x1,y21=y2-y1,x01=x0-x1,y01=y0-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null){this._+="M"+(this._x1=x1)+","+(this._y1=y1)}else if(!(l01_2>epsilon));else if(!(Math.abs(y01*x21-y21*x01)>epsilon)||!r){this._+="L"+(this._x1=x1)+","+(this._y1=y1)}else{var x20=x2-x0,y20=y2-y0,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((pi-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;if(Math.abs(t01-1)>epsilon){this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)}this._+="A"+r+","+r+",0,0,"+ +(y01*x20>x01*y20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)}},arc:function(x,y,r,a0,a1,ccw){x=+x,y=+y,r=+r;var dx=r*Math.cos(a0),dy=r*Math.sin(a0),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null){this._+="M"+x0+","+y0}else if(Math.abs(this._x1-x0)>epsilon||Math.abs(this._y1-y0)>epsilon){this._+="L"+x0+","+y0}if(!r)return;if(da<0)da=da%tau+tau;if(da>tauEpsilon){this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0)}else if(da>epsilon){this._+="A"+r+","+r+",0,"+ +(da>=pi)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))}},rect:function(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function(){return this._}};function constant$1(x){return function constant(){return x}}var abs=Math.abs;var atan2=Math.atan2;var cos=Math.cos;var max$1=Math.max;var min$1=Math.min;var sin=Math.sin;var sqrt=Math.sqrt;var epsilon$1=1e-12;var pi$1=Math.PI;var halfPi=pi$1/2;var tau$1=2*pi$1;function acos(x){return x>1?0:x<-1?pi$1:Math.acos(x)}function asin(x){return x>=1?halfPi:x<=-1?-halfPi:Math.asin(x)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function intersect(x0,y0,x1,y1,x2,y2,x3,y3){var x10=x1-x0,y10=y1-y0,x32=x3-x2,y32=y3-y2,t=y32*x10-x32*y10;if(t*t<epsilon$1)return;t=(x32*(y0-y2)-y32*(x0-x2))/t;return[x0+t*x10,y0+t*y10]}function cornerTangents(x0,y0,x1,y1,r1,rc,cw){var x01=x0-x1,y01=y0-y1,lo=(cw?rc:-rc)/sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x0+ox,y11=y0+oy,x10=x1+ox,y10=y1+oy,x00=(x11+x10)/2,y00=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*sqrt(max$1(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x00,dy0=cy0-y00,dx1=cx1-x00,dy1=cy1-y00;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}function d3_arc(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=constant$1(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null;function arc(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi,a1=endAngle.apply(this,arguments)-halfPi,da=abs(a1-a0),cw=a1>a0;if(!context)context=buffer=path();if(r1<r0)r=r1,r1=r0,r0=r;if(!(r1>epsilon$1))context.moveTo(0,0);else if(da>tau$1-epsilon$1){context.moveTo(r1*cos(a0),r1*sin(a0));context.arc(0,0,r1,a0,a1,!cw);if(r0>epsilon$1){context.moveTo(r0*cos(a1),r0*sin(a1));context.arc(0,0,r0,a1,a0,cw)}}else{var a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>epsilon$1&&(padRadius?+padRadius.apply(this,arguments):sqrt(r0*r0+r1*r1)),rc=min$1(abs(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc,t0,t1;if(rp>epsilon$1){var p0=asin(rp/r0*sin(ap)),p1=asin(rp/r1*sin(ap));if((da0-=p0*2)>epsilon$1)p0*=cw?1:-1,a00+=p0,a10-=p0;else da0=0,a00=a10=(a0+a1)/2;if((da1-=p1*2)>epsilon$1)p1*=cw?1:-1,a01+=p1,a11-=p1;else da1=0,a01=a11=(a0+a1)/2}var x01=r1*cos(a01),y01=r1*sin(a01),x10=r0*cos(a10),y10=r0*sin(a10);if(rc>epsilon$1){var x11=r1*cos(a11),y11=r1*sin(a11),x00=r0*cos(a00),y00=r0*sin(a00),oc;if(da<pi$1&&(oc=intersect(x01,y01,x00,y00,x11,y11,x10,y10))){var ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin(acos((ax*bx+ay*by)/(sqrt(ax*ax+ay*ay)*sqrt(bx*bx+by*by)))/2),lc=sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=min$1(rc,(r0-lc)/(kc-1));rc1=min$1(rc,(r1-lc)/(kc+1))}}if(!(da1>epsilon$1))context.moveTo(x01,y01);else if(rc1>epsilon$1){t0=cornerTangents(x00,y00,x01,y01,r1,rc1,cw);t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw);context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc1<rc)context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw);context.arc(0,0,r1,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),!cw);context.arc(t1.cx,t1.cy,rc1,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw)}}else context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw);if(!(r0>epsilon$1)||!(da0>epsilon$1))context.lineTo(x10,y10);else if(rc0>epsilon$1){t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw);t1=cornerTangents(x01,y01,x00,y00,r0,-rc0,cw);context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc0<rc)context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw);context.arc(0,0,r0,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),cw);context.arc(t1.cx,t1.cy,rc0,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw)}}else context.arc(0,0,r0,a10,a00,cw)}context.closePath();if(buffer)return context=null,buffer+""||null}arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-pi$1/2;return[cos(a)*r,sin(a)*r]};arc.innerRadius=function(_){return arguments.length?(innerRadius=typeof _==="function"?_:constant$1(+_),arc):innerRadius};arc.outerRadius=function(_){return arguments.length?(outerRadius=typeof _==="function"?_:constant$1(+_),arc):outerRadius};arc.cornerRadius=function(_){return arguments.length?(cornerRadius=typeof _==="function"?_:constant$1(+_),arc):cornerRadius};arc.padRadius=function(_){return arguments.length?(padRadius=_==null?null:typeof _==="function"?_:constant$1(+_),arc):padRadius};arc.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant$1(+_),arc):startAngle};arc.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant$1(+_),arc):endAngle};arc.padAngle=function(_){return arguments.length?(padAngle=typeof _==="function"?_:constant$1(+_),arc):padAngle};arc.context=function(_){return arguments.length?(context=_==null?null:_,arc):context};return arc}function Linear(context){this._context=context}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y);break}}};function curveLinear(context){return new Linear(context)}function x(p){return p[0]}function y(p){return p[1]}function d3_line(){var x$1=x,y$1=y,defined=constant$1(true),context=null,curve=curveLinear,output=null;function line(data){var i,n=data.length,d,defined0=false,buffer;if(context==null)output=curve(buffer=path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0)output.lineStart();else output.lineEnd()}if(defined0)output.point(+x$1(d,i,data),+y$1(d,i,data))}if(buffer)return output=null,buffer+""||null}line.x=function(_){return arguments.length?(x$1=typeof _==="function"?_:constant$1(+_),line):x$1};line.y=function(_){return arguments.length?(y$1=typeof _==="function"?_:constant$1(+_),line):y$1};line.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant$1(!!_),line):defined};line.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),line):curve};line.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),line):context};return line}function d3_area(){var x0=x,x1=null,y0=constant$1(0),y1=y,defined=constant$1(true),context=null,curve=curveLinear,output=null;function area(data){var i,j,k,n=data.length,d,defined0=false,buffer,x0z=new Array(n),y0z=new Array(n);if(context==null)output=curve(buffer=path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0){j=i;output.areaStart();output.lineStart()}else{output.lineEnd();output.lineStart();for(k=i-1;k>=j;--k){output.point(x0z[k],y0z[k])}output.lineEnd();output.areaEnd()}}if(defined0){x0z[i]=+x0(d,i,data),y0z[i]=+y0(d,i,data);output.point(x1?+x1(d,i,data):x0z[i],y1?+y1(d,i,data):y0z[i])}}if(buffer)return output=null,buffer+""||null}function arealine(){return d3_line().defined(defined).curve(curve).context(context)}area.x=function(_){return arguments.length?(x0=typeof _==="function"?_:constant$1(+_),x1=null,area):x0};area.x0=function(_){return arguments.length?(x0=typeof _==="function"?_:constant$1(+_),area):x0};area.x1=function(_){return arguments.length?(x1=_==null?null:typeof _==="function"?_:constant$1(+_),area):x1};area.y=function(_){return arguments.length?(y0=typeof _==="function"?_:constant$1(+_),y1=null,area):y0};area.y0=function(_){return arguments.length?(y0=typeof _==="function"?_:constant$1(+_),area):y0};area.y1=function(_){return arguments.length?(y1=_==null?null:typeof _==="function"?_:constant$1(+_),area):y1};area.lineX0=area.lineY0=function(){return arealine().x(x0).y(y0)};area.lineY1=function(){return arealine().x(x0).y(y1)};area.lineX1=function(){return arealine().x(x1).y(y0)};area.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant$1(!!_),area):defined};area.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),area):curve};area.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),area):context};return area}var circle={draw:function(context,size){var r=Math.sqrt(size/pi$1);context.moveTo(r,0);context.arc(0,0,r,0,tau$1)}};function d3_symbol(){var type=constant$1(circle),size=constant$1(64),context=null;function symbol(){var buffer;if(!context)context=buffer=path();type.apply(this,arguments).draw(context,+size.apply(this,arguments));if(buffer)return context=null,buffer+""||null}symbol.type=function(_){return arguments.length?(type=typeof _==="function"?_:constant$1(_),symbol):type};symbol.size=function(_){return arguments.length?(size=typeof _==="function"?_:constant$1(+_),symbol):size};symbol.context=function(_){return arguments.length?(context=_==null?null:_,symbol):context};return symbol}function noop(){}function point(that,x,y){that._context.bezierCurveTo((2*that._x0+that._x1)/3,(2*that._y0+that._y1)/3,(that._x0+2*that._x1)/3,(that._y0+2*that._y1)/3,(that._x0+4*that._x1+x)/6,(that._y0+4*that._y1+y)/6)}function Basis(context){this._context=context}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){switch(this._point){case 3:point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function curveBasis(context){return new Basis(context)}function BasisClosed(context){this._context=context}BasisClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2);this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3);this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3);this._context.closePath();break}case 3:{this.point(this._x2,this._y2);this.point(this._x3,this._y3);this.point(this._x4,this._y4);break}}},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x2=x,this._y2=y;break;case 1:this._point=2;this._x3=x,this._y3=y;break;case 2:this._point=3;this._x4=x,this._y4=y;this._context.moveTo((this._x0+4*this._x1+x)/6,(this._y0+4*this._y1+y)/6);break;default:point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function curveBasisClosed(context){return new BasisClosed(context)}function BasisOpen(context){this._context=context}BasisOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var x0=(this._x0+4*this._x1+x)/6,y0=(this._y0+4*this._y1+y)/6;this._line?this._context.lineTo(x0,y0):this._context.moveTo(x0,y0);break;case 3:this._point=4;default:point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function curveBasisOpen(context){return new BasisOpen(context)}function Bundle(context,beta){this._basis=new Basis(context);this._beta=beta}Bundle.prototype={lineStart:function(){this._x=[];this._y=[];this._basis.lineStart()},lineEnd:function(){var x=this._x,y=this._y,j=x.length-1;if(j>0){var x0=x[0],y0=y[0],dx=x[j]-x0,dy=y[j]-y0,i=-1,t;while(++i<=j){t=i/j;this._basis.point(this._beta*x[i]+(1-this._beta)*(x0+t*dx),this._beta*y[i]+(1-this._beta)*(y0+t*dy))}}this._x=this._y=null;this._basis.lineEnd()},point:function(x,y){this._x.push(+x);this._y.push(+y)}};var curveBundle=function custom(beta){function bundle(context){return beta===1?new Basis(context):new Bundle(context,beta)}bundle.beta=function(beta){return custom(+beta)};return bundle}(.85);function point$1(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal(context,tension){this._context=context;this._k=(1-tension)/6}Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:point$1(this,this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;this._x1=x,this._y1=y;break;case 2:this._point=3;default:point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCardinal=function custom(tension){function cardinal(context){return new Cardinal(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalClosed(context,tension){this._context=context;this._k=(1-tension)/6}CardinalClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCardinalClosed=function custom(tension){function cardinal(context){return new CardinalClosed(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalOpen(context,tension){this._context=context;this._k=(1-tension)/6}CardinalOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCardinalOpen=function custom(tension){function cardinal(context){return new CardinalOpen(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function point$2(that,x,y){var x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;if(that._l01_a>epsilon$1){var a=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,n=3*that._l01_a*(that._l01_a+that._l12_a);x1=(x1*a-that._x0*that._l12_2a+that._x2*that._l01_2a)/n;y1=(y1*a-that._y0*that._l12_2a+that._y2*that._l01_2a)/n}if(that._l23_a>epsilon$1){var b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a);x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m;y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m}that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}function CatmullRom(context,alpha){this._context=context;this._alpha=alpha}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCatmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom(context,alpha):new Cardinal(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomClosed(context,alpha){this._context=context;this._alpha=alpha}CatmullRomClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCatmullRomClosed=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomClosed(context,alpha):new CardinalClosed(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomOpen(context,alpha){this._context=context;this._alpha=alpha}CatmullRomOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCatmullRomOpen=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomOpen(context,alpha):new CardinalOpen(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function LinearClosed(context){this._context=context}LinearClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._point=0},lineEnd:function(){if(this._point)this._context.closePath()},point:function(x,y){x=+x,y=+y;if(this._point)this._context.lineTo(x,y);else this._point=1,this._context.moveTo(x,y)}};function curveLinearClosed(context){return new LinearClosed(context)}function sign(x){return x<0?-1:1}function slope3(that,x2,y2){var h0=that._x1-that._x0,h1=x2-that._x1,s0=(that._y1-that._y0)/(h0||h1<0&&-0),s1=(y2-that._y1)/(h1||h0<0&&-0),p=(s0*h1+s1*h0)/(h0+h1);return(sign(s0)+sign(s1))*Math.min(Math.abs(s0),Math.abs(s1),.5*Math.abs(p))||0}function slope2(that,t){var h=that._x1-that._x0;return h?(3*(that._y1-that._y0)/h-t)/2:t}function point$3(that,t0,t1){var x0=that._x0,y0=that._y0,x1=that._x1,y1=that._y1,dx=(x1-x0)/3;that._context.bezierCurveTo(x0+dx,y0+dx*t0,x1-dx,y1-dx*t1,x1,y1)}function MonotoneX(context){this._context=context}MonotoneX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:point$3(this,this._t0,slope2(this,this._t0));break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){var t1=NaN;x=+x,y=+y;if(x===this._x1&&y===this._y1)return;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;point$3(this,slope2(this,t1=slope3(this,x,y)),t1);break;default:point$3(this,this._t0,t1=slope3(this,x,y));break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y;this._t0=t1}};function MonotoneY(context){this._context=new ReflectContext(context)}(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(x,y){MonotoneX.prototype.point.call(this,y,x)};function ReflectContext(context){this._context=context}ReflectContext.prototype={moveTo:function(x,y){this._context.moveTo(y,x)},closePath:function(){this._context.closePath()},lineTo:function(x,y){this._context.lineTo(y,x)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._context.bezierCurveTo(y1,x1,y2,x2,y,x)}};function monotoneX(context){return new MonotoneX(context)}function monotoneY(context){return new MonotoneY(context)}function Natural(context){this._context=context}Natural.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[];this._y=[]},lineEnd:function(){var x=this._x,y=this._y,n=x.length;if(n){this._line?this._context.lineTo(x[0],y[0]):this._context.moveTo(x[0],y[0]);if(n===2){this._context.lineTo(x[1],y[1])}else{var px=controlPoints(x),py=controlPoints(y);for(var i0=0,i1=1;i1<n;++i0,++i1){this._context.bezierCurveTo(px[0][i0],py[0][i0],px[1][i0],py[1][i0],x[i1],y[i1])}}}if(this._line||this._line!==0&&n===1)this._context.closePath();this._line=1-this._line;this._x=this._y=null},point:function(x,y){this._x.push(+x);this._y.push(+y)}};function controlPoints(x){var i,n=x.length-1,m,a=new Array(n),b=new Array(n),r=new Array(n);a[0]=0,b[0]=2,r[0]=x[0]+2*x[1];for(i=1;i<n-1;++i)a[i]=1,b[i]=4,r[i]=4*x[i]+2*x[i+1];a[n-1]=2,b[n-1]=7,r[n-1]=8*x[n-1]+x[n];for(i=1;i<n;++i)m=a[i]/b[i-1],b[i]-=m,r[i]-=m*r[i-1];a[n-1]=r[n-1]/b[n-1];for(i=n-2;i>=0;--i)a[i]=(r[i]-a[i+1])/b[i];b[n-1]=(x[n]+a[n-1])/2;for(i=0;i<n-1;++i)b[i]=2*x[i+1]-a[i+1];return[a,b]}function curveNatural(context){return new Natural(context)}function Step(context,t){this._context=context;this._t=t}Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN;this._point=0},lineEnd:function(){if(0<this._t&&this._t<1&&this._point===2)this._context.lineTo(this._x,this._y);if(this._line||this._line!==0&&this._point===1)this._context.closePath();if(this._line>=0)this._t=1-this._t,this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:{if(this._t<=0){this._context.lineTo(this._x,y);this._context.lineTo(x,y)}else{var x1=this._x*(1-this._t)+x*this._t;this._context.lineTo(x1,this._y);this._context.lineTo(x1,y)}break}}this._x=x,this._y=y}};function curveStep(context){return new Step(context,.5)}function stepBefore(context){return new Step(context,0)}function stepAfter(context){return new Step(context,1)}var lookup={basis:{curve:curveBasis},"basis-closed":{curve:curveBasisClosed},"basis-open":{curve:curveBasisOpen},bundle:{curve:curveBundle,tension:"beta",value:.85},cardinal:{curve:curveCardinal,tension:"tension",value:0},"cardinal-open":{curve:curveCardinalOpen,tension:"tension",value:0},"cardinal-closed":{curve:curveCardinalClosed,tension:"tension",value:0},"catmull-rom":{curve:curveCatmullRom,tension:"alpha",value:.5},"catmull-rom-closed":{curve:curveCatmullRomClosed,tension:"alpha",value:.5},"catmull-rom-open":{curve:curveCatmullRomOpen,tension:"alpha",value:.5},linear:{curve:curveLinear},"linear-closed":{curve:curveLinearClosed},monotone:{horizontal:monotoneY,vertical:monotoneX},natural:{curve:curveNatural},step:{curve:curveStep},"step-after":{curve:stepAfter},"step-before":{curve:stepBefore}};function curves(type,orientation,tension){var entry=lookup.hasOwnProperty(type)&&lookup[type],curve=null;if(entry){curve=entry.curve||entry[orientation||"vertical"];if(entry.tension&&tension!=null){curve=curve[entry.tension](tension)}}return curve}var cmdlen={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},regexp=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function pathParse(pathstr){var result=[],path,curr,chunks,parsed,param,cmd,len,i,j,n,m;path=pathstr.slice().replace(regexp[0],"###$1").split(regexp[1]).slice(1);for(i=0,n=path.length;i<n;++i){curr=path[i];chunks=curr.slice(1).trim().replace(regexp[2],"$1###$2").split(regexp[3]);cmd=curr.charAt(0);parsed=[cmd];for(j=0,m=chunks.length;j<m;++j){if((param=+chunks[j])===param){parsed.push(param)}}len=cmdlen[cmd.toLowerCase()];if(parsed.length-1>len){for(j=1,m=parsed.length;j<m;j+=len){result.push([cmd].concat(parsed.slice(j,j+len)))}}else{result.push(parsed)}}return result}var DegToRad=Math.PI/180;var HalfPi=Math.PI/2;var Tau=Math.PI*2;var HalfSqrt3=Math.sqrt(3)/2;var segmentCache={};var bezierCache={};var join=[].join;function segments(x,y,rx,ry,large,sweep,rotateX,ox,oy){var key=join.call(arguments);if(segmentCache[key]){return segmentCache[key]}var th=rotateX*DegToRad;var sin_th=Math.sin(th);var cos_th=Math.cos(th);rx=Math.abs(rx);ry=Math.abs(ry);var px=cos_th*(ox-x)*.5+sin_th*(oy-y)*.5;var py=cos_th*(oy-y)*.5-sin_th*(ox-x)*.5;var pl=px*px/(rx*rx)+py*py/(ry*ry);if(pl>1){pl=Math.sqrt(pl);rx*=pl;ry*=pl}var a00=cos_th/rx;var a01=sin_th/rx;var a10=-sin_th/ry;var a11=cos_th/ry;var x0=a00*ox+a01*oy;var y0=a10*ox+a11*oy;var x1=a00*x+a01*y;var y1=a10*x+a11*y;var d=(x1-x0)*(x1-x0)+(y1-y0)*(y1-y0);var sfactor_sq=1/d-.25;if(sfactor_sq<0)sfactor_sq=0;var sfactor=Math.sqrt(sfactor_sq);if(sweep==large)sfactor=-sfactor;var xc=.5*(x0+x1)-sfactor*(y1-y0);var yc=.5*(y0+y1)+sfactor*(x1-x0);var th0=Math.atan2(y0-yc,x0-xc);var th1=Math.atan2(y1-yc,x1-xc);var th_arc=th1-th0;if(th_arc<0&&sweep===1){th_arc+=Tau}else if(th_arc>0&&sweep===0){th_arc-=Tau}var segs=Math.ceil(Math.abs(th_arc/(HalfPi+.001)));var result=[];for(var i=0;i<segs;++i){var th2=th0+i*th_arc/segs;var th3=th0+(i+1)*th_arc/segs;result[i]=[xc,yc,th2,th3,rx,ry,sin_th,cos_th]}return segmentCache[key]=result}function bezier(params){var key=join.call(params);if(bezierCache[key]){return bezierCache[key]}var cx=params[0],cy=params[1],th0=params[2],th1=params[3],rx=params[4],ry=params[5],sin_th=params[6],cos_th=params[7];var a00=cos_th*rx;var a01=-sin_th*ry;var a10=sin_th*rx;var a11=cos_th*ry;var cos_th0=Math.cos(th0);var sin_th0=Math.sin(th0);var cos_th1=Math.cos(th1);var sin_th1=Math.sin(th1);var th_half=.5*(th1-th0);var sin_th_h2=Math.sin(th_half*.5);var t=8/3*sin_th_h2*sin_th_h2/Math.sin(th_half);var x1=cx+cos_th0-t*sin_th0;var y1=cy+sin_th0+t*cos_th0;var x3=cx+cos_th1;var y3=cy+sin_th1;var x2=x3+t*sin_th1;var y2=y3-t*cos_th1;return bezierCache[key]=[a00*x1+a01*y1,a10*x1+a11*y1,a00*x2+a01*y2,a10*x2+a11*y2,a00*x3+a01*y3,a10*x3+a11*y3]}var temp=["l",0,0,0,0,0,0,0];function scale(current,s){var c=temp[0]=current[0];if(c==="a"||c==="A"){temp[1]=s*current[1];temp[2]=s*current[2];temp[3]=current[3];temp[4]=current[4];temp[5]=current[5];temp[6]=s*current[6];temp[7]=s*current[7]}else{for(var i=1,n=current.length;i<n;++i){temp[i]=s*current[i]}}return temp}function pathRender(context,path,l,t,s){var current,previous=null,x=0,y=0,controlX=0,controlY=0,tempX,tempY,tempControlX,tempControlY;if(l==null)l=0;if(t==null)t=0;if(s==null)s=1;if(context.beginPath)context.beginPath();for(var i=0,len=path.length;i<len;++i){current=path[i];if(s!==1)current=scale(current,s);switch(current[0]){case"l":x+=current[1];y+=current[2];context.lineTo(x+l,y+t);break;case"L":x=current[1];y=current[2];context.lineTo(x+l,y+t);break;case"h":x+=current[1];context.lineTo(x+l,y+t);break;case"H":x=current[1];context.lineTo(x+l,y+t);break;case"v":y+=current[1];context.lineTo(x+l,y+t);break;case"V":y=current[1];context.lineTo(x+l,y+t);break;case"m":x+=current[1];y+=current[2];context.moveTo(x+l,y+t);break;case"M":x=current[1];y=current[2];context.moveTo(x+l,y+t);break;case"c":tempX=x+current[5];tempY=y+current[6];controlX=x+current[3];controlY=y+current[4];context.bezierCurveTo(x+current[1]+l,y+current[2]+t,controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case"C":x=current[5];y=current[6];controlX=current[3];controlY=current[4];context.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case"s":tempX=x+current[3];tempY=y+current[4];controlX=2*x-controlX;controlY=2*y-controlY;context.bezierCurveTo(controlX+l,controlY+t,x+current[1]+l,y+current[2]+t,tempX+l,tempY+t);controlX=x+current[1];controlY=y+current[2];x=tempX;y=tempY;break;case"S":tempX=current[3];tempY=current[4];controlX=2*x-controlX;controlY=2*y-controlY;context.bezierCurveTo(controlX+l,controlY+t,current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case"q":tempX=x+current[3];tempY=y+current[4];controlX=x+current[1];controlY=y+current[2];context.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case"Q":tempX=current[3];tempY=current[4];context.quadraticCurveTo(current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case"t":tempX=x+current[1];tempY=y+current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y}else if(previous[0]==="t"){controlX=2*x-tempControlX;controlY=2*y-tempControlY}else if(previous[0]==="q"){controlX=2*x-controlX;controlY=2*y-controlY}tempControlX=controlX;tempControlY=controlY;context.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=x+current[1];controlY=y+current[2];break;case"T":tempX=current[1];tempY=current[2];controlX=2*x-controlX;controlY=2*y-controlY;context.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case"a":drawArc(context,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+x+l,current[7]+y+t]);x+=current[6];y+=current[7];break;case"A":drawArc(context,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+l,current[7]+t]);x=current[6];y=current[7];break;case"z":case"Z":context.closePath();break}previous=current}}function drawArc(context,x,y,coords){var seg=segments(coords[5],coords[6],coords[0],coords[1],coords[3],coords[4],coords[2],x,y);for(var i=0;i<seg.length;++i){var bez=bezier(seg[i]);context.bezierCurveTo(bez[0],bez[1],bez[2],bez[3],bez[4],bez[5])}}var Tan30=.5773502691896257;var builtins={circle:{draw:function(context,size){var r=Math.sqrt(size)/2;context.moveTo(r,0);context.arc(0,0,r,0,Tau)}},cross:{draw:function(context,size){var r=Math.sqrt(size)/2,s=r/2.5;context.moveTo(-r,-s);context.lineTo(-r,s);context.lineTo(-s,s);context.lineTo(-s,r);context.lineTo(s,r);context.lineTo(s,s);context.lineTo(r,s);context.lineTo(r,-s);context.lineTo(s,-s);context.lineTo(s,-r);context.lineTo(-s,-r);context.lineTo(-s,-s);context.closePath()}},diamond:{draw:function(context,size){var r=Math.sqrt(size)/2;context.moveTo(-r,0);context.lineTo(0,-r);context.lineTo(r,0);context.lineTo(0,r);context.closePath()}},square:{draw:function(context,size){var w=Math.sqrt(size),x=-w/2;context.rect(x,x,w,w)}},arrow:{draw:function(context,size){var r=Math.sqrt(size)/2,s=r/7,t=r/2.5,v=r/8;context.moveTo(-s,r);context.lineTo(s,r);context.lineTo(s,-v);context.lineTo(t,-v);context.lineTo(0,-r);context.lineTo(-t,-v);context.lineTo(-s,-v);context.closePath()}},wedge:{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r,o=h-r*Tan30,b=r/4;context.moveTo(0,-h-o);context.lineTo(-b,h-o);context.lineTo(b,h-o);context.closePath()}},triangle:{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r,o=h-r*Tan30;context.moveTo(0,-h-o);context.lineTo(-r,h-o);context.lineTo(r,h-o);context.closePath()}},"triangle-up":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(0,-h);context.lineTo(-r,h);context.lineTo(r,h);context.closePath()}},"triangle-down":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(0,h);context.lineTo(-r,-h);context.lineTo(r,-h);context.closePath()}},"triangle-right":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(h,0);context.lineTo(-h,-r);context.lineTo(-h,r);context.closePath()}},"triangle-left":{draw:function(context,size){var r=Math.sqrt(size)/2,h=HalfSqrt3*r;context.moveTo(-h,0);context.lineTo(h,-r);context.lineTo(h,r);context.closePath()}},stroke:{draw:function(context,size){var r=Math.sqrt(size)/2;context.moveTo(-r,0);context.lineTo(r,0)}}};function symbols(_){return builtins.hasOwnProperty(_)?builtins[_]:customSymbol(_)}var custom={};function customSymbol(path){if(!custom.hasOwnProperty(path)){var parsed=pathParse(path);custom[path]={draw:function(context,size){pathRender(context,parsed,0,0,Math.sqrt(size)/2)}}}return custom[path]}function rectangleX(d){return d.x}function rectangleY(d){return d.y}function rectangleWidth(d){return d.width}function rectangleHeight(d){return d.height}function constant$2(_){return function(){return _}}function vg_rect(){var x=rectangleX,y=rectangleY,width=rectangleWidth,height=rectangleHeight,cornerRadius=constant$2(0),context=null;function rectangle(_,x0,y0){var buffer,x1=x0!=null?x0:+x.call(this,_),y1=y0!=null?y0:+y.call(this,_),w=+width.call(this,_),h=+height.call(this,_),cr=+cornerRadius.call(this,_);if(!context)context=buffer=path();if(cr<=0){context.rect(x1,y1,w,h)}else{var x2=x1+w,y2=y1+h;context.moveTo(x1+cr,y1);context.lineTo(x2-cr,y1);context.quadraticCurveTo(x2,y1,x2,y1+cr);context.lineTo(x2,y2-cr);context.quadraticCurveTo(x2,y2,x2-cr,y2);context.lineTo(x1+cr,y2);context.quadraticCurveTo(x1,y2,x1,y2-cr);context.lineTo(x1,y1+cr);context.quadraticCurveTo(x1,y1,x1+cr,y1);context.closePath()}if(buffer){context=null;return buffer+""||null}}rectangle.x=function(_){if(arguments.length){x=typeof _==="function"?_:constant$2(+_);return rectangle}else{return x}};rectangle.y=function(_){if(arguments.length){y=typeof _==="function"?_:constant$2(+_);return rectangle}else{return y}};rectangle.width=function(_){if(arguments.length){width=typeof _==="function"?_:constant$2(+_);return rectangle}else{return width}};rectangle.height=function(_){if(arguments.length){height=typeof _==="function"?_:constant$2(+_);return rectangle}else{return height}};rectangle.cornerRadius=function(_){if(arguments.length){cornerRadius=typeof _==="function"?_:constant$2(+_);return rectangle}else{return cornerRadius}};rectangle.context=function(_){if(arguments.length){context=_==null?null:_;return rectangle}else{return context}};return rectangle}function vg_trail(){var x,y,size,defined,context=null,ready,x1,y1,r1;function point(x2,y2,w2){var r2=w2/2;if(ready){var ux=y1-y2,uy=x2-x1;if(ux||uy){var ud=Math.sqrt(ux*ux+uy*uy),rx=(ux/=ud)*r1,ry=(uy/=ud)*r1,t=Math.atan2(uy,ux);context.moveTo(x1-rx,y1-ry);context.lineTo(x2-ux*r2,y2-uy*r2);context.arc(x2,y2,r2,t-Math.PI,t);context.lineTo(x1+rx,y1+ry);context.arc(x1,y1,r1,t,t+Math.PI)}else{context.arc(x2,y2,r2,0,Tau)}context.closePath()}else{ready=1}x1=x2;y1=y2;r1=r2}function trail(data){var i,n=data.length,d,defined0=false,buffer;if(context==null)context=buffer=path();for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0)ready=0}if(defined0)point(+x(d,i,data),+y(d,i,data),+size(d,i,data))}if(buffer){context=null;return buffer+""||null}}trail.x=function(_){if(arguments.length){x=_;return trail}else{return x}};trail.y=function(_){if(arguments.length){y=_;return trail}else{return y}};trail.size=function(_){if(arguments.length){size=_;return trail}else{return size}};trail.defined=function(_){if(arguments.length){defined=_;return trail}else{return defined}};trail.context=function(_){if(arguments.length){if(_==null){context=null}else{context=_}return trail}else{return context}};return trail}function x$1(item){return item.x||0}function y$1(item){return item.y||0}function w(item){return item.width||0}function ts(item){return item.size||1}function h(item){return item.height||0}function xw(item){return(item.x||0)+(item.width||0)}function yh(item){return(item.y||0)+(item.height||0)}function sa(item){return item.startAngle||0}function ea(item){return item.endAngle||0}function pa(item){return item.padAngle||0}function ir(item){return item.innerRadius||0}function or(item){return item.outerRadius||0}function cr(item){return item.cornerRadius||0}function def(item){return!(item.defined===false)}function size(item){return item.size==null?64:item.size}function type(item){return symbols(item.shape||"circle")}var arcShape=d3_arc().startAngle(sa).endAngle(ea).padAngle(pa).innerRadius(ir).outerRadius(or).cornerRadius(cr),areavShape=d3_area().x(x$1).y1(y$1).y0(yh).defined(def),areahShape=d3_area().y(y$1).x1(x$1).x0(xw).defined(def),lineShape=d3_line().x(x$1).y(y$1).defined(def),rectShape=vg_rect().x(x$1).y(y$1).width(w).height(h).cornerRadius(cr),symbolShape=d3_symbol().type(type).size(size),trailShape=vg_trail().x(x$1).y(y$1).defined(def).size(ts);function arc(context,item){return arcShape.context(context)(item)}function area(context,items){var item=items[0],interp=item.interpolate||"linear";return(item.orient==="horizontal"?areahShape:areavShape).curve(curves(interp,item.orient,item.tension)).context(context)(items)}function line(context,items){var item=items[0],interp=item.interpolate||"linear";return lineShape.curve(curves(interp,item.orient,item.tension)).context(context)(items)}function rectangle(context,item,x,y){return rectShape.context(context)(item,x,y)}function shape(context,item){return(item.mark.shape||item.shape).context(context)(item)}function symbol(context,item){return symbolShape.context(context)(item)}function trail(context,items){return trailShape.context(context)(items)}function boundStroke(bounds,item){if(item.stroke&&item.opacity!==0&&item.strokeOpacity!==0){bounds.expand(item.strokeWidth!=null?+item.strokeWidth:1)}return bounds}var bounds,circleThreshold=Tau-1e-8;function context(_){bounds=_;return context}function noop$1(){}function add$1(x,y){bounds.add(x,y)}context.beginPath=noop$1;context.closePath=noop$1;context.moveTo=add$1;context.lineTo=add$1;context.rect=function(x,y,w,h){add$1(x,y);add$1(x+w,y+h)};context.quadraticCurveTo=function(x1,y1,x2,y2){add$1(x1,y1);add$1(x2,y2)};context.bezierCurveTo=function(x1,y1,x2,y2,x3,y3){add$1(x1,y1);add$1(x2,y2);add$1(x3,y3)};context.arc=function(cx,cy,r,sa,ea,ccw){if(Math.abs(ea-sa)>circleThreshold){add$1(cx-r,cy-r);add$1(cx+r,cy+r);return}var xmin=Infinity,xmax=-Infinity,ymin=Infinity,ymax=-Infinity,s,i,x,y;function update(a){x=r*Math.cos(a);y=r*Math.sin(a);if(x<xmin)xmin=x;if(x>xmax)xmax=x;if(y<ymin)ymin=y;if(y>ymax)ymax=y}update(sa);update(ea);if(ea!==sa){sa=sa%Tau;if(sa<0)sa+=Tau;ea=ea%Tau;if(ea<0)ea+=Tau;if(ea<sa){ccw=!ccw;s=sa;sa=ea;ea=s}if(ccw){ea-=Tau;s=sa-sa%HalfPi;for(i=0;i<4&&s>ea;++i,s-=HalfPi)update(s)}else{s=sa-sa%HalfPi+HalfPi;for(i=0;i<4&&s<ea;++i,s=s+HalfPi)update(s)}}add$1(cx+xmin,cy+ymin);add$1(cx+xmax,cy+ymax)};var context$1=(context$1=domCanvas(1,1))?context$1.getContext("2d"):null;const b=new Bounds;function intersectPath(draw){return function(item,brush){if(!context$1)return true;draw(context$1,item);b.clear().union(item.bounds).intersect(brush).round();const{x1:x1,y1:y1,x2:x2,y2:y2}=b;for(let y=y1;y<=y2;++y){for(let x=x1;x<=x2;++x){if(context$1.isPointInPath(x,y)){return true}}}return false}}function intersectPoint(item,box){return box.contains(item.x||0,item.y||0)}function intersectRect(item,box){const x=item.x||0,y=item.y||0,w=item.width||0,h=item.height||0;return box.intersects(b.set(x,y,x+w,y+h))}function intersectRule(item,box){const x=item.x||0,y=item.y||0,x2=item.x2!=null?item.x2:x,y2=item.y2!=null?item.y2:y;return intersectBoxLine(box,x,y,x2,y2)}function intersectBoxLine(box,x,y,u,v){const{x1:x1,y1:y1,x2:x2,y2:y2}=box,dx=u-x,dy=v-y;let t0=0,t1=1,p,q,r,e;for(e=0;e<4;++e){if(e===0){p=-dx;q=-(x1-x)}if(e===1){p=dx;q=x2-x}if(e===2){p=-dy;q=-(y1-y)}if(e===3){p=dy;q=y2-y}if(Math.abs(p)<1e-10&&q<0)return false;r=q/p;if(p<0){if(r>t1)return false;else if(r>t0)t0=r}else if(p>0){if(r<t0)return false;else if(r<t1)t1=r}}return true}function gradient(context,gradient,bounds){var w=bounds.width(),h=bounds.height(),x1=bounds.x1+gradient.x1*w,y1=bounds.y1+gradient.y1*h,x2=bounds.x1+gradient.x2*w,y2=bounds.y1+gradient.y2*h,stop=gradient.stops,i=0,n=stop.length,linearGradient=context.createLinearGradient(x1,y1,x2,y2);for(;i<n;++i){linearGradient.addColorStop(stop[i].offset,stop[i].color)}return linearGradient}function color(context,item,value){return value.id?gradient(context,value,item.bounds):value}function fill(context,item,opacity){opacity*=item.fillOpacity==null?1:item.fillOpacity;if(opacity>0){context.globalAlpha=opacity;context.fillStyle=color(context,item,item.fill);return true}else{return false}}var Empty$1=[];function stroke(context,item,opacity){var lw=(lw=item.strokeWidth)!=null?lw:1;if(lw<=0)return false;opacity*=item.strokeOpacity==null?1:item.strokeOpacity;if(opacity>0){context.globalAlpha=opacity;context.strokeStyle=color(context,item,item.stroke);context.lineWidth=lw;context.lineCap=item.strokeCap||"butt";context.lineJoin=item.strokeJoin||"miter";context.miterLimit=item.strokeMiterLimit||10;if(context.setLineDash){context.setLineDash(item.strokeDash||Empty$1);context.lineDashOffset=item.strokeDashOffset||0}return true}else{return false}}function compare$1(a,b){return a.zindex-b.zindex||a.index-b.index}function zorder(scene){if(!scene.zdirty)return scene.zitems;var items=scene.items,output=[],item,i,n;for(i=0,n=items.length;i<n;++i){item=items[i];item.index=i;if(item.zindex)output.push(item)}scene.zdirty=false;return scene.zitems=output.sort(compare$1)}function visit(scene,visitor){var items=scene.items,i,n;if(!items||!items.length)return;var zitems=zorder(scene);if(zitems&&zitems.length){for(i=0,n=items.length;i<n;++i){if(!items[i].zindex)visitor(items[i])}items=zitems}for(i=0,n=items.length;i<n;++i){visitor(items[i])}}function pickVisit(scene,visitor){var items=scene.items,hit,i;if(!items||!items.length)return null;var zitems=zorder(scene);if(zitems&&zitems.length)items=zitems;for(i=items.length;--i>=0;){if(hit=visitor(items[i]))return hit}if(items===zitems){for(items=scene.items,i=items.length;--i>=0;){if(!items[i].zindex){if(hit=visitor(items[i]))return hit}}}return null}function drawAll(path){return function(context,scene,bounds){visit(scene,function(item){if(!bounds||bounds.intersects(item.bounds)){drawPath(path,context,item,item)}})}}function drawOne(path){return function(context,scene,bounds){if(scene.items.length&&(!bounds||bounds.intersects(scene.bounds))){drawPath(path,context,scene.items[0],scene.items)}}}function drawPath(path,context,item,items){var opacity=item.opacity==null?1:item.opacity;if(opacity===0)return;if(path(context,items))return;if(item.fill&&fill(context,item,opacity)){context.fill()}if(item.stroke&&stroke(context,item,opacity)){context.stroke()}}function pick(test){test=test||truthy;return function(context,scene,x,y,gx,gy){x*=context.pixelRatio;y*=context.pixelRatio;return pickVisit(scene,function(item){var b=item.bounds;if(b&&!b.contains(gx,gy)||!b)return;if(test(context,item,x,y,gx,gy))return item})}}function hitPath(path,filled){return function(context,o,x,y){var item=Array.isArray(o)?o[0]:o,fill=filled==null?item.fill:filled,stroke=item.stroke&&context.isPointInStroke,lw,lc;if(stroke){lw=item.strokeWidth;lc=item.strokeCap;context.lineWidth=lw!=null?lw:1;context.lineCap=lc!=null?lc:"butt"}return path(context,o)?false:fill&&context.isPointInPath(x,y)||stroke&&context.isPointInStroke(x,y)}}function pickPath(path){return pick(hitPath(path))}function translate(x,y){return"translate("+x+","+y+")"}function rotate(a){return"rotate("+a+")"}function translateItem(item){return translate(item.x||0,item.y||0)}function transformItem(item){return translate(item.x||0,item.y||0)+(item.angle?" "+rotate(item.angle):"")}function markItemPath(type,shape,isect){function attr(emit,item){emit("transform",transformItem(item));emit("d",shape(null,item))}function bound(bounds,item){var x=item.x||0,y=item.y||0;shape(context(bounds),item);boundStroke(bounds,item).translate(x,y);if(item.angle){bounds.rotate(item.angle*DegToRad,x,y)}return bounds}function draw(context,item){var x=item.x||0,y=item.y||0,a=item.angle||0;context.translate(x,y);if(a)context.rotate(a*=DegToRad);context.beginPath();shape(context,item);if(a)context.rotate(-a);context.translate(-x,-y)}return{type:type,tag:"path",nested:false,attr:attr,bound:bound,draw:drawAll(draw),pick:pickPath(draw),isect:isect||intersectPath(draw)}}var arc$1=markItemPath("arc",arc);function pickArea(a,p){var v=a[0].orient==="horizontal"?p[1]:p[0],z=a[0].orient==="horizontal"?"y":"x",i=a.length,min=+Infinity,hit,d;while(--i>=0){if(a[i].defined===false)continue;d=Math.abs(a[i][z]-v);if(d<min){min=d;hit=a[i]}}return hit}function pickLine(a,p){var t=Math.pow(a[0].strokeWidth||1,2),i=a.length,dx,dy,dd;while(--i>=0){if(a[i].defined===false)continue;dx=a[i].x-p[0];dy=a[i].y-p[1];dd=dx*dx+dy*dy;if(dd<t)return a[i]}return null}function pickTrail(a,p){var i=a.length,dx,dy,dd;while(--i>=0){if(a[i].defined===false)continue;dx=a[i].x-p[0];dy=a[i].y-p[1];dd=dx*dx+dy*dy;dx=a[i].size||1;if(dd<dx*dx)return a[i]}return null}function markMultiItemPath(type,shape,tip){function attr(emit,item){var items=item.mark.items;if(items.length)emit("d",shape(null,items))}function bound(bounds,mark){var items=mark.items;if(items.length===0){return bounds}else{shape(context(bounds),items);return boundStroke(bounds,items[0])}}function draw(context,items){context.beginPath();shape(context,items)}var hit=hitPath(draw);function pick(context,scene,x,y,gx,gy){var items=scene.items,b=scene.bounds;if(!items||!items.length||b&&!b.contains(gx,gy)){return null}x*=context.pixelRatio;y*=context.pixelRatio;return hit(context,items,x,y)?items[0]:null}return{type:type,tag:"path",nested:true,attr:attr,bound:bound,draw:drawOne(draw),pick:pick,isect:intersectPoint,tip:tip}}var area$1=markMultiItemPath("area",area,pickArea);var clip_id=1;function resetSVGClipId(){clip_id=1}function clip(renderer,item,size){var clip=item.clip,defs=renderer._defs,id=item.clip_id||(item.clip_id="clip"+clip_id++),c=defs.clipping[id]||(defs.clipping[id]={id:id});if(isFunction(clip)){c.path=clip(null)}else{c.width=size.width||0;c.height=size.height||0}return"url(#"+id+")"}var StrokeOffset=.5;function attr(emit,item){emit("transform",translateItem(item))}function background(emit,item){var offset=item.stroke?StrokeOffset:0;emit("class","background");emit("d",rectangle(null,item,offset,offset))}function foreground(emit,item,renderer){var url=item.clip?clip(renderer,item,item):null;emit("clip-path",url)}function bound(bounds,group){if(!group.clip&&group.items){var items=group.items;for(var j=0,m=items.length;j<m;++j){bounds.union(items[j].bounds)}}if((group.clip||group.width||group.height)&&!group.noBound){bounds.add(0,0).add(group.width||0,group.height||0)}boundStroke(bounds,group);return bounds.translate(group.x||0,group.y||0)}function backgroundPath(context,group){var offset=group.stroke?StrokeOffset:0;context.beginPath();rectangle(context,group,offset,offset)}var hitBackground=hitPath(backgroundPath);function draw(context,scene,bounds){var renderer=this;visit(scene,function(group){var gx=group.x||0,gy=group.y||0,w=group.width||0,h=group.height||0,opacity;context.save();context.translate(gx,gy);if(group.stroke||group.fill){opacity=group.opacity==null?1:group.opacity;if(opacity>0){backgroundPath(context,group);if(group.fill&&fill(context,group,opacity)){context.fill()}if(group.stroke&&stroke(context,group,opacity)){context.stroke()}}}if(group.clip){context.beginPath();context.rect(0,0,w,h);context.clip()}if(bounds)bounds.translate(-gx,-gy);visit(group,function(item){renderer.draw(context,item,bounds)});if(bounds)bounds.translate(gx,gy);context.restore()})}function pick$1(context,scene,x,y,gx,gy){if(scene.bounds&&!scene.bounds.contains(gx,gy)||!scene.items){return null}var handler=this,cx=x*context.pixelRatio,cy=y*context.pixelRatio;return pickVisit(scene,function(group){var hit,dx,dy,b;b=group.bounds;if(b&&!b.contains(gx,gy))return;dx=group.x||0;dy=group.y||0;context.save();context.translate(dx,dy);dx=gx-dx;dy=gy-dy;hit=pickVisit(group,function(mark){return pickMark(mark,dx,dy)?handler.pick(mark,x,y,dx,dy):null});if(!hit&&scene.interactive!==false&&(group.fill||group.stroke)&&hitBackground(context,group,cx,cy)){hit=group}context.restore();return hit||null})}function pickMark(mark,x,y){return(mark.interactive!==false||mark.marktype==="group")&&mark.bounds&&mark.bounds.contains(x,y)}var group={type:"group",tag:"g",nested:false,attr:attr,bound:bound,draw:draw,pick:pick$1,isect:intersectRect,background:background,foreground:foreground};function getImage(item,renderer){var image=item.image;if(!image||image.url!==item.url){image={loaded:false,width:0,height:0};renderer.loadImage(item.url).then(function(image){item.image=image;item.image.url=item.url})}return image}function imageXOffset(align,w){return align==="center"?w/2:align==="right"?w:0}function imageYOffset(baseline,h){return baseline==="middle"?h/2:baseline==="bottom"?h:0}function attr$1(emit,item,renderer){var image=getImage(item,renderer),x=item.x||0,y=item.y||0,w=(item.width!=null?item.width:image.width)||0,h=(item.height!=null?item.height:image.height)||0,a=item.aspect===false?"none":"xMidYMid";x-=imageXOffset(item.align,w);y-=imageYOffset(item.baseline,h);emit("href",image.src||"","http://www.w3.org/1999/xlink","xlink:href");emit("transform",translate(x,y));emit("width",w);emit("height",h);emit("preserveAspectRatio",a)}function bound$1(bounds,item){var image=item.image,x=item.x||0,y=item.y||0,w=(item.width!=null?item.width:image&&image.width)||0,h=(item.height!=null?item.height:image&&image.height)||0;x-=imageXOffset(item.align,w);y-=imageYOffset(item.baseline,h);return bounds.set(x,y,x+w,y+h)}function draw$1(context,scene,bounds){var renderer=this;visit(scene,function(item){if(bounds&&!bounds.intersects(item.bounds))return;var image=getImage(item,renderer),x=item.x||0,y=item.y||0,w=(item.width!=null?item.width:image.width)||0,h=(item.height!=null?item.height:image.height)||0,opacity,ar0,ar1,t;x-=imageXOffset(item.align,w);y-=imageYOffset(item.baseline,h);if(item.aspect!==false){ar0=image.width/image.height;ar1=item.width/item.height;if(ar0===ar0&&ar1===ar1&&ar0!==ar1){if(ar1<ar0){t=w/ar0;y+=(h-t)/2;h=t}else{t=h*ar0;x+=(w-t)/2;w=t}}}if(image.loaded){context.globalAlpha=(opacity=item.opacity)!=null?opacity:1;context.drawImage(image,x,y,w,h)}})}var image={type:"image",tag:"image",nested:false,attr:attr$1,bound:bound$1,draw:draw$1,pick:pick(),isect:truthy,get:getImage,xOffset:imageXOffset,yOffset:imageYOffset};var line$1=markMultiItemPath("line",line,pickLine);function attr$2(emit,item){emit("transform",translateItem(item));emit("d",item.path)}function path$1(context,item){var path=item.path;if(path==null)return true;var cache=item.pathCache;if(!cache||cache.path!==path){(item.pathCache=cache=pathParse(path)).path=path}pathRender(context,cache,item.x,item.y)}function bound$2(bounds,item){return path$1(context(bounds),item)?bounds.set(0,0,0,0):boundStroke(bounds,item)}var path$2={type:"path",tag:"path",nested:false,attr:attr$2,bound:bound$2,draw:drawAll(path$1),pick:pickPath(path$1),isect:intersectPath(path$1)};function attr$3(emit,item){emit("d",rectangle(null,item))}function bound$3(bounds,item){var x,y;return boundStroke(bounds.set(x=item.x||0,y=item.y||0,x+item.width||0,y+item.height||0),item)}function draw$2(context,item){context.beginPath();rectangle(context,item)}var rect={type:"rect",tag:"path",nested:false,attr:attr$3,bound:bound$3,draw:drawAll(draw$2),pick:pickPath(draw$2),isect:intersectRect};function attr$4(emit,item){emit("transform",translateItem(item));emit("x2",item.x2!=null?item.x2-(item.x||0):0);emit("y2",item.y2!=null?item.y2-(item.y||0):0)}function bound$4(bounds,item){var x1,y1;return boundStroke(bounds.set(x1=item.x||0,y1=item.y||0,item.x2!=null?item.x2:x1,item.y2!=null?item.y2:y1),item)}function path$3(context,item,opacity){var x1,y1,x2,y2;if(item.stroke&&stroke(context,item,opacity)){x1=item.x||0;y1=item.y||0;x2=item.x2!=null?item.x2:x1;y2=item.y2!=null?item.y2:y1;context.beginPath();context.moveTo(x1,y1);context.lineTo(x2,y2);return true}return false}function draw$3(context,scene,bounds){visit(scene,function(item){if(bounds&&!bounds.intersects(item.bounds))return;var opacity=item.opacity==null?1:item.opacity;if(opacity&&path$3(context,item,opacity)){context.stroke()}})}function hit(context,item,x,y){if(!context.isPointInStroke)return false;return path$3(context,item,1)&&context.isPointInStroke(x,y)}var rule={type:"rule",tag:"line",nested:false,attr:attr$4,bound:bound$4,draw:draw$3,pick:pick(hit),isect:intersectRule};var shape$1=markItemPath("shape",shape);var symbol$1=markItemPath("symbol",symbol,intersectPoint);var currFontHeight;var textMetrics={height:fontSize,measureWidth:measureWidth,estimateWidth:estimateWidth,width:estimateWidth,canvas:useCanvas};useCanvas(true);function estimateWidth(item){currFontHeight=fontSize(item);return estimate(textValue(item))}function estimate(text){return~~(.8*text.length*currFontHeight)}function measureWidth(item){return fontSize(item)<=0?0:(context$1.font=font(item),measure$1(textValue(item)))}function measure$1(text){return context$1.measureText(text).width}function fontSize(item){return item.fontSize!=null?item.fontSize:11}function useCanvas(use){textMetrics.width=use&&context$1?measureWidth:estimateWidth}function textValue(item){var s=item.text;if(s==null){return""}else{return item.limit>0?truncate$1(item):s+""}}function truncate$1(item){var limit=+item.limit,text=item.text+"",width;if(textMetrics.width===measureWidth){context$1.font=font(item);width=measure$1}else{currFontHeight=fontSize(item);width=estimate}if(width(text)<limit)return text;var ellipsis=item.ellipsis||"",rtl=item.dir==="rtl",lo=0,hi=text.length,mid;limit-=width(ellipsis);if(rtl){while(lo<hi){mid=lo+hi>>>1;if(width(text.slice(mid))>limit)lo=mid+1;else hi=mid}return ellipsis+text.slice(lo)}else{while(lo<hi){mid=1+(lo+hi>>>1);if(width(text.slice(0,mid))<limit)lo=mid;else hi=mid-1}return text.slice(0,lo)+ellipsis}}function fontFamily(item,quote){var font=item.font;return(quote&&font?String(font).replace(/"/g,"'"):font)||"sans-serif"}function font(item,quote){return""+(item.fontStyle?item.fontStyle+" ":"")+(item.fontVariant?item.fontVariant+" ":"")+(item.fontWeight?item.fontWeight+" ":"")+fontSize(item)+"px "+fontFamily(item,quote)}function offset(item){var baseline=item.baseline,h=fontSize(item);return Math.round(baseline==="top"?.79*h:baseline==="middle"?.3*h:baseline==="bottom"?-.21*h:0)}var textAlign={left:"start",center:"middle",right:"end"};var tempBounds=new Bounds;function anchorPoint(item){var x=item.x||0,y=item.y||0,r=item.radius||0,t;if(r){t=(item.theta||0)-HalfPi;x+=r*Math.cos(t);y+=r*Math.sin(t)}tempBounds.x1=x;tempBounds.y1=y;return tempBounds}function attr$5(emit,item){var dx=item.dx||0,dy=(item.dy||0)+offset(item),p=anchorPoint(item),x=p.x1,y=p.y1,a=item.angle||0,t;emit("text-anchor",textAlign[item.align]||"start");if(a){t=translate(x,y)+" "+rotate(a);if(dx||dy)t+=" "+translate(dx,dy)}else{t=translate(x+dx,y+dy)}emit("transform",t)}function bound$5(bounds,item,mode){var h=textMetrics.height(item),a=item.align,p=anchorPoint(item),x=p.x1,y=p.y1,dx=item.dx||0,dy=(item.dy||0)+offset(item)-Math.round(.8*h),w;w=textMetrics.width(item);if(a==="center"){dx-=w/2}else if(a==="right"){dx-=w}bounds.set(dx+=x,dy+=y,dx+w,dy+h);if(item.angle&&!mode){bounds.rotate(item.angle*DegToRad,x,y)}else if(mode===2){return bounds.rotatedPoints(item.angle*DegToRad,x,y)}return bounds}function draw$4(context,scene,bounds){visit(scene,function(item){var opacity,p,x,y,str;if(bounds&&!bounds.intersects(item.bounds))return;if(!(str=textValue(item)))return;opacity=item.opacity==null?1:item.opacity;if(opacity===0||item.fontSize<=0)return;context.font=font(item);context.textAlign=item.align||"left";p=anchorPoint(item);x=p.x1,y=p.y1;if(item.angle){context.save();context.translate(x,y);context.rotate(item.angle*DegToRad);x=y=0}x+=item.dx||0;y+=(item.dy||0)+offset(item);if(item.fill&&fill(context,item,opacity)){context.fillText(str,x,y)}if(item.stroke&&stroke(context,item,opacity)){context.strokeText(str,x,y)}if(item.angle)context.restore()})}function hit$1(context,item,x,y,gx,gy){if(item.fontSize<=0)return false;if(!item.angle)return true;var p=anchorPoint(item),ax=p.x1,ay=p.y1,b=bound$5(tempBounds,item,1),a=-item.angle*DegToRad,cos=Math.cos(a),sin=Math.sin(a),px=cos*gx-sin*gy+(ax-cos*ax+sin*ay),py=sin*gx+cos*gy+(ay-sin*ax-cos*ay);return b.contains(px,py)}function intersectText(item,box){var p=bound$5(tempBounds,item,2);return intersectBoxLine(box,p[0],p[1],p[2],p[3])||intersectBoxLine(box,p[0],p[1],p[4],p[5])||intersectBoxLine(box,p[4],p[5],p[6],p[7])||intersectBoxLine(box,p[2],p[3],p[6],p[7])}var text={type:"text",tag:"text",nested:false,attr:attr$5,bound:bound$5,draw:draw$4,pick:pick(hit$1),isect:intersectText};var trail$1=markMultiItemPath("trail",trail,pickTrail);var Marks={arc:arc$1,area:area$1,group:group,image:image,line:line$1,path:path$2,rect:rect,rule:rule,shape:shape$1,symbol:symbol$1,text:text,trail:trail$1};function boundItem(item,func,opt){var type=Marks[item.mark.marktype],bound=func||type.bound;if(type.nested)item=item.mark;return bound(item.bounds||(item.bounds=new Bounds),item,opt)}var DUMMY={mark:null};function boundMark(mark,bounds,opt){var type=Marks[mark.marktype],bound=type.bound,items=mark.items,hasItems=items&&items.length,i,n,item,b;if(type.nested){if(hasItems){item=items[0]}else{DUMMY.mark=mark;item=DUMMY}b=boundItem(item,bound,opt);bounds=bounds&&bounds.union(b)||b;return bounds}bounds=bounds||mark.bounds&&mark.bounds.clear()||new Bounds;if(hasItems){for(i=0,n=items.length;i<n;++i){bounds.union(boundItem(items[i],bound,opt))}}return mark.bounds=bounds}var keys=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"];function sceneToJSON(scene,indent){return JSON.stringify(scene,keys,indent)}function sceneFromJSON(json){var scene=typeof json==="string"?JSON.parse(json):json;return initialize(scene)}function initialize(scene){var type=scene.marktype,items=scene.items,parent,i,n;if(items){for(i=0,n=items.length;i<n;++i){parent=type?"mark":"group";items[i][parent]=scene;if(items[i].zindex)items[i][parent].zdirty=true;if("group"===(type||parent))initialize(items[i])}}if(type)boundMark(scene);return scene}function Scenegraph(scene){if(arguments.length){this.root=sceneFromJSON(scene)}else{this.root=createMark({marktype:"group",name:"root",role:"frame"});this.root.items=[new GroupItem(this.root)]}}var prototype$E=Scenegraph.prototype;prototype$E.toJSON=function(indent){return sceneToJSON(this.root,indent||0)};prototype$E.mark=function(markdef,group,index){group=group||this.root.items[0];var mark=createMark(markdef,group);group.items[index]=mark;if(mark.zindex)mark.group.zdirty=true;return mark};function createMark(def,group){return{bounds:new Bounds,clip:!!def.clip,group:group,interactive:def.interactive===false?false:true,items:[],marktype:def.marktype,name:def.name||undefined,role:def.role||undefined,zindex:def.zindex||0}}function domCreate(doc,tag,ns){if(!doc&&typeof document!=="undefined"&&document.createElement){doc=document}return doc?ns?doc.createElementNS(ns,tag):doc.createElement(tag):null}function domFind(el,tag){tag=tag.toLowerCase();var nodes=el.childNodes,i=0,n=nodes.length;for(;i<n;++i)if(nodes[i].tagName.toLowerCase()===tag){return nodes[i]}}function domChild(el,index,tag,ns){var a=el.childNodes[index],b;if(!a||a.tagName.toLowerCase()!==tag.toLowerCase()){b=a||null;a=domCreate(el.ownerDocument,tag,ns);el.insertBefore(a,b)}return a}function domClear(el,index){var nodes=el.childNodes,curr=nodes.length;while(curr>index)el.removeChild(nodes[--curr]);return el}function cssClass(mark){return"mark-"+mark.marktype+(mark.role?" role-"+mark.role:"")+(mark.name?" "+mark.name:"")}function point$4(event,el){var rect=el.getBoundingClientRect();return[event.clientX-rect.left-(el.clientLeft||0),event.clientY-rect.top-(el.clientTop||0)]}function resolveItem(item,event,el,origin){var mark=item&&item.mark,mdef,p;if(mark&&(mdef=Marks[mark.marktype]).tip){p=point$4(event,el);p[0]-=origin[0];p[1]-=origin[1];while(item=item.mark.group){p[0]-=item.x||0;p[1]-=item.y||0}item=mdef.tip(mark.items,p)}return item}function Handler(customLoader,customTooltip){this._active=null;this._handlers={};this._loader=customLoader||loader();this._tooltip=customTooltip||defaultTooltip}function defaultTooltip(handler,event,item,value){handler.element().setAttribute("title",value||"")}var prototype$F=Handler.prototype;prototype$F.initialize=function(el,origin,obj){this._el=el;this._obj=obj||null;return this.origin(origin)};prototype$F.element=function(){return this._el};prototype$F.canvas=function(){return this._el&&this._el.firstChild};prototype$F.origin=function(origin){if(arguments.length){this._origin=origin||[0,0];return this}else{return this._origin.slice()}};prototype$F.scene=function(scene){if(!arguments.length)return this._scene;this._scene=scene;return this};prototype$F.on=function(){};prototype$F.off=function(){};prototype$F._handlerIndex=function(h,type,handler){for(var i=h?h.length:0;--i>=0;){if(h[i].type===type&&(!handler||h[i].handler===handler)){return i}}return-1};prototype$F.handlers=function(type){var h=this._handlers,a=[],k;if(type){a.push.apply(a,h[this.eventName(type)])}else{for(k in h){a.push.apply(a,h[k])}}return a};prototype$F.eventName=function(name){var i=name.indexOf(".");return i<0?name:name.slice(0,i)};prototype$F.handleHref=function(event,item,href){this._loader.sanitize(href,{context:"href"}).then(function(opt){var e=new MouseEvent(event.type,event),a=domCreate(null,"a");for(var name in opt)a.setAttribute(name,opt[name]);a.dispatchEvent(e)}).catch(function(){})};prototype$F.handleTooltip=function(event,item,show){if(item&&item.tooltip!=null){item=resolveItem(item,event,this.canvas(),this._origin);var value=show&&item&&item.tooltip||null;this._tooltip.call(this._obj,this,event,item,value)}};prototype$F.getItemBoundingClientRect=function(item){if(!(el=this.canvas()))return;var el,rect=el.getBoundingClientRect(),origin=this._origin,itemBounds=item.bounds,x=itemBounds.x1+origin[0]+rect.left,y=itemBounds.y1+origin[1]+rect.top,w=itemBounds.width(),h=itemBounds.height();while(item.mark&&(item=item.mark.group)){x+=item.x||0;y+=item.y||0}return{x:x,y:y,width:w,height:h,left:x,top:y,right:x+w,bottom:y+h}};function Renderer(loader){this._el=null;this._bgcolor=null;this._loader=new ResourceLoader(loader)}var prototype$G=Renderer.prototype;prototype$G.initialize=function(el,width,height,origin,scaleFactor){this._el=el;return this.resize(width,height,origin,scaleFactor)};prototype$G.element=function(){return this._el};prototype$G.canvas=function(){return this._el&&this._el.firstChild};prototype$G.background=function(bgcolor){if(arguments.length===0)return this._bgcolor;this._bgcolor=bgcolor;return this};prototype$G.resize=function(width,height,origin,scaleFactor){this._width=width;this._height=height;this._origin=origin||[0,0];this._scale=scaleFactor||1;return this};prototype$G.dirty=function(){};prototype$G.render=function(scene){var r=this;r._call=function(){r._render(scene)};r._call();r._call=null;return r};prototype$G._render=function(){};prototype$G.renderAsync=function(scene){var r=this.render(scene);return this._ready?this._ready.then(function(){return r}):Promise.resolve(r)};prototype$G._load=function(method,uri){var r=this,p=r._loader[method](uri);if(!r._ready){var call=r._call;r._ready=r._loader.ready().then(function(redraw){if(redraw)call();r._ready=null})}return p};prototype$G.sanitizeURL=function(uri){return this._load("sanitizeURL",uri)};prototype$G.loadImage=function(uri){return this._load("loadImage",uri)};var Events=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"];var TooltipShowEvent="mousemove";var TooltipHideEvent="mouseout";var HrefEvent="click";function CanvasHandler(loader,tooltip){Handler.call(this,loader,tooltip);this._down=null;this._touch=null;this._first=true}var prototype$H=inherits(CanvasHandler,Handler);prototype$H.initialize=function(el,origin,obj){var canvas=this._canvas=el&&domFind(el,"canvas");if(canvas){var that=this;this.events.forEach(function(type){canvas.addEventListener(type,function(evt){if(prototype$H[type]){prototype$H[type].call(that,evt)}else{that.fire(type,evt)}})})}return Handler.prototype.initialize.call(this,el,origin,obj)};prototype$H.canvas=function(){return this._canvas};prototype$H.context=function(){return this._canvas.getContext("2d")};prototype$H.events=Events;prototype$H.DOMMouseScroll=function(evt){this.fire("mousewheel",evt)};function move(moveEvent,overEvent,outEvent){return function(evt){var a=this._active,p=this.pickEvent(evt);if(p===a){this.fire(moveEvent,evt)}else{if(!a||!a.exit){this.fire(outEvent,evt)}this._active=p;this.fire(overEvent,evt);this.fire(moveEvent,evt)}}}function inactive(type){return function(evt){this.fire(type,evt);this._active=null}}prototype$H.mousemove=move("mousemove","mouseover","mouseout");prototype$H.dragover=move("dragover","dragenter","dragleave");prototype$H.mouseout=inactive("mouseout");prototype$H.dragleave=inactive("dragleave");prototype$H.mousedown=function(evt){this._down=this._active;this.fire("mousedown",evt)};prototype$H.click=function(evt){if(this._down===this._active){this.fire("click",evt);this._down=null}};prototype$H.touchstart=function(evt){this._touch=this.pickEvent(evt.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire("touchstart",evt,true)};prototype$H.touchmove=function(evt){this.fire("touchmove",evt,true)};prototype$H.touchend=function(evt){this.fire("touchend",evt,true);this._touch=null};prototype$H.fire=function(type,evt,touch){var a=touch?this._touch:this._active,h=this._handlers[type],i,len;evt.vegaType=type;if(type===HrefEvent&&a&&a.href){this.handleHref(evt,a,a.href)}else if(type===TooltipShowEvent||type===TooltipHideEvent){this.handleTooltip(evt,a,type!==TooltipHideEvent)}if(h){for(i=0,len=h.length;i<len;++i){h[i].handler.call(this._obj,evt,a)}}};prototype$H.on=function(type,handler){var name=this.eventName(type),h=this._handlers,i=this._handlerIndex(h[name],type,handler);if(i<0){(h[name]||(h[name]=[])).push({type:type,handler:handler})}return this};prototype$H.off=function(type,handler){var name=this.eventName(type),h=this._handlers[name],i=this._handlerIndex(h,type,handler);if(i>=0){h.splice(i,1)}return this};prototype$H.pickEvent=function(evt){var p=point$4(evt,this._canvas),o=this._origin;return this.pick(this._scene,p[0],p[1],p[0]-o[0],p[1]-o[1])};prototype$H.pick=function(scene,x,y,gx,gy){var g=this.context(),mark=Marks[scene.marktype];return mark.pick.call(this,g,scene,x,y,gx,gy)};function clip$1(context,scene){var clip=scene.clip;context.save();context.beginPath();if(isFunction(clip)){clip(context)}else{var group=scene.group;context.rect(0,0,group.width||0,group.height||0)}context.clip()}function devicePixelRatio(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var pixelRatio=devicePixelRatio();function resize(canvas,width,height,origin,scaleFactor,opt){var inDOM=typeof HTMLElement!=="undefined"&&canvas instanceof HTMLElement&&canvas.parentNode!=null;var context=canvas.getContext("2d"),ratio=inDOM?pixelRatio:scaleFactor,key;canvas.width=width*ratio;canvas.height=height*ratio;for(key in opt){context[key]=opt[key]}if(inDOM&&ratio!==1){canvas.style.width=width+"px";canvas.style.height=height+"px"}context.pixelRatio=ratio;context.setTransform(ratio,0,0,ratio,ratio*origin[0],ratio*origin[1]);return canvas}function CanvasRenderer(loader){Renderer.call(this,loader);this._redraw=false;this._dirty=new Bounds}var prototype$I=inherits(CanvasRenderer,Renderer),base=Renderer.prototype,tempBounds$1=new Bounds;prototype$I.initialize=function(el,width,height,origin,scaleFactor,options){this._options=options;this._canvas=domCanvas(1,1,options&&options.type);if(el){domClear(el,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return base.initialize.call(this,el,width,height,origin,scaleFactor)};prototype$I.resize=function(width,height,origin,scaleFactor){base.resize.call(this,width,height,origin,scaleFactor);resize(this._canvas,this._width,this._height,this._origin,this._scale,this._options&&this._options.context);this._redraw=true;return this};prototype$I.canvas=function(){return this._canvas};prototype$I.context=function(){return this._canvas?this._canvas.getContext("2d"):null};prototype$I.dirty=function(item){var b=translate$1(item.bounds,item.mark.group);this._dirty.union(b)};function clipToBounds(g,b,origin){b.expand(1).round();b.translate(-(origin[0]%1),-(origin[1]%1));g.beginPath();g.rect(b.x1,b.y1,b.width(),b.height());g.clip();return b}function translate$1(bounds,group){if(group==null)return bounds;var b=tempBounds$1.clear().union(bounds);for(;group!=null;group=group.mark.group){b.translate(group.x||0,group.y||0)}return b}prototype$I._render=function(scene){var g=this.context(),o=this._origin,w=this._width,h=this._height,b=this._dirty;g.save();if(this._redraw||b.empty()){this._redraw=false;b=null}else{b=clipToBounds(g,b,o)}this.clear(-o[0],-o[1],w,h);this.draw(g,scene,b);g.restore();this._dirty.clear();return this};prototype$I.draw=function(ctx,scene,bounds){var mark=Marks[scene.marktype];if(scene.clip)clip$1(ctx,scene);mark.draw.call(this,ctx,scene,bounds);if(scene.clip)ctx.restore()};prototype$I.clear=function(x,y,w,h){var g=this.context();g.clearRect(x,y,w,h);if(this._bgcolor!=null){g.fillStyle=this._bgcolor;g.fillRect(x,y,w,h)}};function SVGHandler(loader,tooltip){Handler.call(this,loader,tooltip);var h=this;h._hrefHandler=listener(h,function(evt,item){if(item&&item.href)h.handleHref(evt,item,item.href)});h._tooltipHandler=listener(h,function(evt,item){h.handleTooltip(evt,item,evt.type!==TooltipHideEvent)})}var prototype$J=inherits(SVGHandler,Handler);prototype$J.initialize=function(el,origin,obj){var svg=this._svg;if(svg){svg.removeEventListener(HrefEvent,this._hrefHandler);svg.removeEventListener(TooltipShowEvent,this._tooltipHandler);svg.removeEventListener(TooltipHideEvent,this._tooltipHandler)}this._svg=svg=el&&domFind(el,"svg");if(svg){svg.addEventListener(HrefEvent,this._hrefHandler);svg.addEventListener(TooltipShowEvent,this._tooltipHandler);svg.addEventListener(TooltipHideEvent,this._tooltipHandler)}return Handler.prototype.initialize.call(this,el,origin,obj)};prototype$J.canvas=function(){return this._svg};function listener(context,handler){return function(evt){var target=evt.target,item=target.__data__;evt.vegaType=evt.type;item=Array.isArray(item)?item[0]:item;handler.call(context._obj,evt,item)}}prototype$J.on=function(type,handler){var name=this.eventName(type),h=this._handlers,i=this._handlerIndex(h[name],type,handler);if(i<0){var x={type:type,handler:handler,listener:listener(this,handler)};(h[name]||(h[name]=[])).push(x);if(this._svg){this._svg.addEventListener(name,x.listener)}}return this};prototype$J.off=function(type,handler){var name=this.eventName(type),h=this._handlers[name],i=this._handlerIndex(h,type,handler);if(i>=0){if(this._svg){this._svg.removeEventListener(name,h[i].listener)}h.splice(i,1)}return this};function openTag(tag,attr,raw){var s="<"+tag,key,val;if(attr){for(key in attr){val=attr[key];if(val!=null){s+=" "+key+'="'+val+'"'}}}if(raw)s+=" "+raw;return s+">"}function closeTag(tag){return"</"+tag+">"}var metadata={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};var styles={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"};var styleProperties=Object.keys(styles);var ns=metadata.xmlns;function SVGRenderer(loader){Renderer.call(this,loader);this._dirtyID=1;this._dirty=[];this._svg=null;this._root=null;this._defs=null}var prototype$K=inherits(SVGRenderer,Renderer);var base$1=Renderer.prototype;prototype$K.initialize=function(el,width,height,padding){if(el){this._svg=domChild(el,0,"svg",ns);this._svg.setAttribute("class","marks");domClear(el,1);this._root=domChild(this._svg,0,"g",ns);domClear(this._svg,1)}this._defs={gradient:{},clipping:{}};this.background(this._bgcolor);return base$1.initialize.call(this,el,width,height,padding)};prototype$K.background=function(bgcolor){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",bgcolor)}return base$1.background.apply(this,arguments)};prototype$K.resize=function(width,height,origin,scaleFactor){base$1.resize.call(this,width,height,origin,scaleFactor);if(this._svg){this._svg.setAttribute("width",this._width*this._scale);this._svg.setAttribute("height",this._height*this._scale);this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height);this._root.setAttribute("transform","translate("+this._origin+")")}this._dirty=[];return this};prototype$K.canvas=function(){return this._svg};prototype$K.svg=function(){if(!this._svg)return null;var attr={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var key in metadata){attr[key]=metadata[key]}var bg=!this._bgcolor?"":openTag("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+closeTag("rect");return openTag("svg",attr)+bg+this._svg.innerHTML+closeTag("svg")};prototype$K._render=function(scene){if(this._dirtyCheck()){if(this._dirtyAll)this._resetDefs();this.draw(this._root,scene);domClear(this._root,1)}this.updateDefs();this._dirty=[];++this._dirtyID;return this};prototype$K.updateDefs=function(){var svg=this._svg,defs=this._defs,el=defs.el,index=0,id;for(id in defs.gradient){if(!el)defs.el=el=domChild(svg,0,"defs",ns);updateGradient(el,defs.gradient[id],index++)}for(id in defs.clipping){if(!el)defs.el=el=domChild(svg,0,"defs",ns);updateClipping(el,defs.clipping[id],index++)}if(el){if(index===0){svg.removeChild(el);defs.el=null}else{domClear(el,index)}}};function updateGradient(el,grad,index){var i,n,stop;el=domChild(el,index,"linearGradient",ns);el.setAttribute("id",grad.id);el.setAttribute("x1",grad.x1);el.setAttribute("x2",grad.x2);el.setAttribute("y1",grad.y1);el.setAttribute("y2",grad.y2);for(i=0,n=grad.stops.length;i<n;++i){stop=domChild(el,i,"stop",ns);stop.setAttribute("offset",grad.stops[i].offset);stop.setAttribute("stop-color",grad.stops[i].color)}domClear(el,i)}function updateClipping(el,clip,index){var mask;el=domChild(el,index,"clipPath",ns);el.setAttribute("id",clip.id);if(clip.path){mask=domChild(el,0,"path",ns);mask.setAttribute("d",clip.path)}else{mask=domChild(el,0,"rect",ns);mask.setAttribute("x",0);mask.setAttribute("y",0);mask.setAttribute("width",clip.width);mask.setAttribute("height",clip.height)}}prototype$K._resetDefs=function(){var def=this._defs;def.gradient={};def.clipping={}};prototype$K.dirty=function(item){if(item.dirty!==this._dirtyID){item.dirty=this._dirtyID;this._dirty.push(item)}};prototype$K.isDirty=function(item){return this._dirtyAll||!item._svg||item.dirty===this._dirtyID};prototype$K._dirtyCheck=function(){this._dirtyAll=true;var items=this._dirty;if(!items.length)return true;var id=++this._dirtyID,item,mark,type,mdef,i,n,o;for(i=0,n=items.length;i<n;++i){item=items[i];mark=item.mark;if(mark.marktype!==type){type=mark.marktype;mdef=Marks[type]}if(mark.zdirty&&mark.dirty!==id){this._dirtyAll=false;dirtyParents(item,id);mark.items.forEach(function(i){i.dirty=id})}if(mark.zdirty)continue;if(item.exit){if(mdef.nested&&mark.items.length){o=mark.items[0];if(o._svg)this._update(mdef,o._svg,o)}else if(item._svg){o=item._svg.parentNode;if(o)o.removeChild(item._svg)}item._svg=null;continue}item=mdef.nested?mark.items[0]:item;if(item._update===id)continue;if(!item._svg||!item._svg.ownerSVGElement){this._dirtyAll=false;dirtyParents(item,id)}else{this._update(mdef,item._svg,item)}item._update=id}return!this._dirtyAll};function dirtyParents(item,id){for(;item&&item.dirty!==id;item=item.mark.group){item.dirty=id;if(item.mark&&item.mark.dirty!==id){item.mark.dirty=id}else return}}prototype$K.draw=function(el,scene,prev){if(!this.isDirty(scene))return scene._svg;var renderer=this,svg=this._svg,mdef=Marks[scene.marktype],events=scene.interactive===false?"none":null,isGroup=mdef.tag==="g",sibling=null,i=0,parent;parent=bind(scene,el,prev,"g",svg);parent.setAttribute("class",cssClass(scene));if(!isGroup){parent.style.setProperty("pointer-events",events)}if(scene.clip){parent.setAttribute("clip-path",clip(renderer,scene,scene.group))}else{parent.removeAttribute("clip-path")}function process(item){var dirty=renderer.isDirty(item),node=bind(item,parent,sibling,mdef.tag,svg);if(dirty){renderer._update(mdef,node,item);if(isGroup)recurse(renderer,node,item)}sibling=node;++i}if(mdef.nested){if(scene.items.length)process(scene.items[0])}else{visit(scene,process)}domClear(parent,i);return parent};function recurse(renderer,el,group){el=el.lastChild;var prev,idx=0;visit(group,function(item){prev=renderer.draw(el,item,prev);++idx});domClear(el,1+idx)}function bind(item,el,sibling,tag,svg){var node=item._svg,doc;if(!node){doc=el.ownerDocument;node=domCreate(doc,tag,ns);item._svg=node;if(item.mark){node.__data__=item;node.__values__={fill:"default"};if(tag==="g"){var bg=domCreate(doc,"path",ns);bg.setAttribute("class","background");node.appendChild(bg);bg.__data__=item;var fg=domCreate(doc,"g",ns);node.appendChild(fg);fg.__data__=item}}}if(node.ownerSVGElement!==svg||hasSiblings(item)&&node.previousSibling!==sibling){el.insertBefore(node,sibling?sibling.nextSibling:el.firstChild)}return node}function hasSiblings(item){var parent=item.mark||item.group;return parent&&parent.items.length>1}var element=null,values=null;var mark_extras={group:function(mdef,el,item){values=el.__values__;element=el.childNodes[1];mdef.foreground(emit,item,this);element=el.childNodes[0];mdef.background(emit,item,this);var value=item.mark.interactive===false?"none":null;if(value!==values.events){element.style.setProperty("pointer-events",value);values.events=value}},text:function(mdef,el,item){var value;value=textValue(item);if(value!==values.text){el.textContent=value;values.text=value}setStyle(el,"font-family",fontFamily(item));setStyle(el,"font-size",fontSize(item)+"px");setStyle(el,"font-style",item.fontStyle);setStyle(el,"font-variant",item.fontVariant);setStyle(el,"font-weight",item.fontWeight)}};function setStyle(el,name,value){if(value!==values[name]){if(value==null){el.style.removeProperty(name)}else{el.style.setProperty(name,value+"")}values[name]=value}}prototype$K._update=function(mdef,el,item){element=el;values=el.__values__;mdef.attr(emit,item,this);var extra=mark_extras[mdef.type];if(extra)extra.call(this,mdef,el,item);this.style(element,item)};function emit(name,value,ns){if(value===values[name])return;if(value!=null){if(ns){element.setAttributeNS(ns,name,value)}else{element.setAttribute(name,value)}}else{if(ns){element.removeAttributeNS(ns,name)}else{element.removeAttribute(name)}}values[name]=value}prototype$K.style=function(el,o){if(o==null)return;var i,n,prop,name,value;for(i=0,n=styleProperties.length;i<n;++i){prop=styleProperties[i];value=o[prop];if(prop==="font"){value=fontFamily(o)}if(value===values[prop])continue;name=styles[prop];if(value==null){if(name==="fill"){el.style.setProperty(name,"none")}else{el.style.removeProperty(name)}}else{if(value.id){this._defs.gradient[value.id]=value;value="url("+href()+"#"+value.id+")"}el.style.setProperty(name,value+"")}values[prop]=value}};function href(){var loc;return typeof window==="undefined"?"":(loc=window.location).hash?loc.href.slice(0,-loc.hash.length):loc.href}function SVGStringRenderer(loader){Renderer.call(this,loader);this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""};this._defs={gradient:{},clipping:{}}}var prototype$L=inherits(SVGStringRenderer,Renderer);var base$2=Renderer.prototype;prototype$L.resize=function(width,height,origin,scaleFactor){base$2.resize.call(this,width,height,origin,scaleFactor);var o=this._origin,t=this._text;var attr={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var key in metadata){attr[key]=metadata[key]}t.head=openTag("svg",attr);var bg=this._bgcolor;if(bg==="transparent"||bg==="none")bg=null;if(bg){t.bg=openTag("rect",{width:this._width,height:this._height,style:"fill: "+bg+";"})+closeTag("rect")}else{t.bg=""}t.root=openTag("g",{transform:"translate("+o+")"});t.foot=closeTag("g")+closeTag("svg");return this};prototype$L.background=function(){var rv=base$2.background.apply(this,arguments);if(arguments.length&&this._text.head){this.resize(this._width,this._height,this._origin,this._scale)}return rv};prototype$L.svg=function(){var t=this._text;return t.head+t.bg+t.defs+t.root+t.body+t.foot};prototype$L._render=function(scene){this._text.body=this.mark(scene);this._text.defs=this.buildDefs();return this};prototype$L.buildDefs=function(){var all=this._defs,defs="",i,id,def,stops;for(id in all.gradient){def=all.gradient[id];stops=def.stops;defs+=openTag("linearGradient",{id:id,x1:def.x1,x2:def.x2,y1:def.y1,y2:def.y2});for(i=0;i<stops.length;++i){defs+=openTag("stop",{offset:stops[i].offset,"stop-color":stops[i].color})+closeTag("stop")}defs+=closeTag("linearGradient")}for(id in all.clipping){def=all.clipping[id];defs+=openTag("clipPath",{id:id});if(def.path){defs+=openTag("path",{d:def.path})+closeTag("path")}else{defs+=openTag("rect",{x:0,y:0,width:def.width,height:def.height})+closeTag("rect")}defs+=closeTag("clipPath")}return defs.length>0?openTag("defs")+defs+closeTag("defs"):""};var object$1;function emit$1(name,value,ns,prefixed){object$1[prefixed||name]=value}prototype$L.attributes=function(attr,item){object$1={};attr(emit$1,item,this);return object$1};prototype$L.href=function(item){var that=this,href=item.href,attr;if(href){if(attr=that._hrefs&&that._hrefs[href]){return attr}else{that.sanitizeURL(href).then(function(attr){attr["xlink:href"]=attr.href;attr.href=null;(that._hrefs||(that._hrefs={}))[href]=attr})}}return null};prototype$L.mark=function(scene){var renderer=this,mdef=Marks[scene.marktype],tag=mdef.tag,defs=this._defs,str="",style;if(tag!=="g"&&scene.interactive===false){style='style="pointer-events: none;"'}str+=openTag("g",{class:cssClass(scene),"clip-path":scene.clip?clip(renderer,scene,scene.group):null},style);function process(item){var href=renderer.href(item);if(href)str+=openTag("a",href);style=tag!=="g"?applyStyles(item,scene,tag,defs):null;str+=openTag(tag,renderer.attributes(mdef.attr,item),style);if(tag==="text"){str+=escape_text(textValue(item))}else if(tag==="g"){str+=openTag("path",renderer.attributes(mdef.background,item),applyStyles(item,scene,"bgrect",defs))+closeTag("path");str+=openTag("g",renderer.attributes(mdef.foreground,item))+renderer.markGroup(item)+closeTag("g")}str+=closeTag(tag);if(href)str+=closeTag("a")}if(mdef.nested){if(scene.items&&scene.items.length)process(scene.items[0])}else{visit(scene,process)}return str+closeTag("g")};prototype$L.markGroup=function(scene){var renderer=this,str="";visit(scene,function(item){str+=renderer.mark(item)});return str};function applyStyles(o,mark,tag,defs){if(o==null)return"";var i,n,prop,name,value,s="";if(tag==="bgrect"&&mark.interactive===false){s+="pointer-events: none; "}if(tag==="text"){s+="font-family: "+fontFamily(o)+"; ";s+="font-size: "+fontSize(o)+"px; ";if(o.fontStyle)s+="font-style: "+o.fontStyle+"; ";if(o.fontVariant)s+="font-variant: "+o.fontVariant+"; ";if(o.fontWeight)s+="font-weight: "+o.fontWeight+"; "}for(i=0,n=styleProperties.length;i<n;++i){prop=styleProperties[i];name=styles[prop];value=o[prop];if(value==null){if(name==="fill"){s+="fill: none; "}}else if(value==="transparent"&&(name==="fill"||name==="stroke")){s+=name+": none; "}else{if(value.id){defs.gradient[value.id]=value;value="url(#"+value.id+")"}s+=name+": "+value+"; "}}return s?'style="'+s.trim()+'"':null}function escape_text(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Canvas="canvas";var PNG="png";var SVG="svg";var None$2="none";var RenderType={Canvas:Canvas,PNG:PNG,SVG:SVG,None:None$2};var modules={};modules[Canvas]=modules[PNG]={renderer:CanvasRenderer,headless:CanvasRenderer,handler:CanvasHandler};modules[SVG]={renderer:SVGRenderer,headless:SVGStringRenderer,handler:SVGHandler};modules[None$2]={};function renderModule(name,_){name=String(name||"").toLowerCase();if(arguments.length>1){modules[name]=_;return this}else{return modules[name]}}function intersect$1(scene,bounds,filter){const hits=[],box=(new Bounds).union(bounds),type=scene.marktype;return type?intersectMark(scene,box,filter,hits):type==="group"?intersectGroup(scene,box,filter,hits):error("Intersect scene must be mark node or group item.")}function intersectMark(mark,box,filter,hits){if(visitMark(mark,box,filter)){const items=mark.items,type=mark.marktype,n=items.length;let i=0;if(type==="group"){for(;i<n;++i){intersectGroup(items[i],box,filter,hits)}}else{for(const test=Marks[type].isect;i<n;++i){let item=items[i];if(intersectItem(item,box,test))hits.push(item)}}}return hits}function visitMark(mark,box,filter){return mark.bounds&&box.intersects(mark.bounds)&&(mark.marktype==="group"||mark.interactive!==false&&(!filter||filter(mark)))}function intersectGroup(group,box,filter,hits){if(filter&&filter(group.mark)&&intersectItem(group,box,Marks.group.isect)){hits.push(group)}const marks=group.items,n=marks&&marks.length;if(n){const x=group.x||0,y=group.y||0;box.translate(-x,-y);for(let i=0;i<n;++i){intersectMark(marks[i],box,filter,hits)}box.translate(x,y)}return hits}function intersectItem(item,box,test){const bounds=item.bounds;return box.encloses(bounds)||box.intersects(bounds)&&test(item,box)}var clipBounds=new Bounds;function boundClip(mark){var clip=mark.clip;if(isFunction(clip)){clip(context(clipBounds.clear()))}else if(clip){clipBounds.set(0,0,mark.group.width,mark.group.height)}else return;mark.bounds.intersect(clipBounds)}var TOLERANCE=1e-9;function sceneEqual(a,b,key){return a===b?true:key==="path"?pathEqual(a,b):a instanceof Date&&b instanceof Date?+a===+b:isNumber(a)&&isNumber(b)?Math.abs(a-b)<=TOLERANCE:!a||!b||!isObject(a)&&!isObject(b)?a==b:a==null||b==null?false:objectEqual(a,b)}function pathEqual(a,b){return sceneEqual(pathParse(a),pathParse(b))}function objectEqual(a,b){var ka=Object.keys(a),kb=Object.keys(b),key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!sceneEqual(a[key],b[key],key))return false}return typeof a===typeof b}function Bound(params){Transform.call(this,null,params)}var prototype$M=inherits(Bound,Transform);prototype$M.transform=function(_,pulse){var view=pulse.dataflow,mark=_.mark,type=mark.marktype,entry=Marks[type],bound=entry.bound,markBounds=mark.bounds,rebound;if(entry.nested){if(mark.items.length)view.dirty(mark.items[0]);markBounds=boundItem$1(mark,bound);mark.items.forEach(function(item){item.bounds.clear().union(markBounds)})}else if(type===Group||_.modified()){pulse.visit(pulse.MOD,function(item){view.dirty(item)});markBounds.clear();mark.items.forEach(function(item){markBounds.union(boundItem$1(item,bound))});if(mark.role===LegendRole)pulse.reflow()}else{rebound=pulse.changed(pulse.REM);pulse.visit(pulse.ADD,function(item){markBounds.union(boundItem$1(item,bound))});pulse.visit(pulse.MOD,function(item){rebound=rebound||markBounds.alignsWith(item.bounds);view.dirty(item);markBounds.union(boundItem$1(item,bound))});if(rebound){markBounds.clear();mark.items.forEach(function(item){markBounds.union(item.bounds)})}}boundClip(mark);return pulse.modifies("bounds")};function boundItem$1(item,bound,opt){return bound(item.bounds.clear(),item,opt)}var COUNTER_NAME=":vega_identifier:";function Identifier(params){Transform.call(this,0,params)}Identifier.Definition={type:"Identifier",metadata:{modifies:true},params:[{name:"as",type:"string",required:true}]};var prototype$N=inherits(Identifier,Transform);prototype$N.transform=function(_,pulse){var counter=getCounter(pulse.dataflow),id=counter.value,as=_.as;pulse.visit(pulse.ADD,function(t){if(!t[as])t[as]=++id});counter.set(this.value=id);return pulse};function getCounter(view){var counter=view._signals[COUNTER_NAME];if(!counter){view._signals[COUNTER_NAME]=counter=view.add(0)}return counter}function Mark(params){Transform.call(this,null,params)}var prototype$O=inherits(Mark,Transform);prototype$O.transform=function(_,pulse){var mark=this.value;if(!mark){mark=pulse.dataflow.scenegraph().mark(_.markdef,lookup$1(_),_.index);mark.group.context=_.context;if(!_.context.group)_.context.group=mark.group;mark.source=this;mark.clip=_.clip;mark.interactive=_.interactive;this.value=mark}var Init=mark.marktype===Group?GroupItem:Item;pulse.visit(pulse.ADD,function(item){Init.call(item,mark)});if(_.modified("clip")||_.modified("interactive")){mark.clip=_.clip;mark.interactive=!!_.interactive;mark.zdirty=true;pulse.reflow()}mark.items=pulse.source;return pulse};function lookup$1(_){var g=_.groups,p=_.parent;return g&&g.size===1?g.get(Object.keys(g.object)[0]):g&&p?g.lookup(p):null}function Overlap(params){Transform.call(this,null,params)}var prototype$P=inherits(Overlap,Transform);var methods={parity:function(items){return items.filter((item,i)=>i%2?item.opacity=0:1)},greedy:function(items,sep){var a;return items.filter((b,i)=>{if(!i||!intersect$2(a.bounds,b.bounds,sep)){a=b;return 1}else{return b.opacity=0}})}};function intersect$2(a,b,sep){return sep>Math.max(b.x1-a.x2,a.x1-b.x2,b.y1-a.y2,a.y1-b.y2)}function hasOverlap(items,pad){for(var i=1,n=items.length,a=items[0].bounds,b;i<n;a=b,++i){if(intersect$2(a,b=items[i].bounds,pad))return true}}function hasBounds(item){var b=item.bounds;return b.width()>1&&b.height()>1}function boundTest(scale,orient,tolerance){var range=scale.range(),b=new Bounds;if(orient===Top||orient===Bottom){b.set(range[0],-Infinity,range[1],+Infinity)}else{b.set(-Infinity,range[0],+Infinity,range[1])}b.expand(tolerance||1);return item=>b.encloses(item.bounds)}function reset(source){source.forEach(item=>item.opacity=1);return source}function reflow(pulse,_){return pulse.reflow(_.modified()).modifies("opacity")}prototype$P.transform=function(_,pulse){var reduce=methods[_.method]||methods.parity,source=pulse.materialize(pulse.SOURCE).source,sep=_.separation||0,items,test,bounds;if(!source||!source.length)return;if(!_.method){if(_.modified("method")){reset(source);pulse=reflow(pulse,_)}return pulse}if(_.sort){source=source.slice().sort(_.sort)}source=source.filter(hasBounds);items=reset(source);pulse=reflow(pulse,_);if(items.length>=3&&hasOverlap(items,sep)){do{items=reduce(items,sep)}while(items.length>=3&&hasOverlap(items,sep));if(items.length<3&&!peek(source).opacity){if(items.length>1)peek(items).opacity=0;peek(source).opacity=1}}if(_.boundScale&&_.boundTolerance>=0){test=boundTest(_.boundScale,_.boundOrient,+_.boundTolerance);source.forEach(item=>{if(!test(item))item.opacity=0})}bounds=items[0].mark.bounds.clear();source.forEach(item=>{if(item.opacity)bounds.union(item.bounds)});return pulse};function Render(params){Transform.call(this,null,params)}var prototype$Q=inherits(Render,Transform);prototype$Q.transform=function(_,pulse){var view=pulse.dataflow;pulse.visit(pulse.ALL,function(item){view.dirty(item)});if(pulse.fields&&pulse.fields["zindex"]){var item=pulse.source&&pulse.source[0];if(item)item.mark.zdirty=true}};const tempBounds$2=new Bounds;function set(item,property,value){return item[property]===value?0:(item[property]=value,1)}const AxisOffset=.5;function isYAxis(mark){var orient=mark.items[0].datum.orient;return orient===Left||orient===Right}function axisIndices(datum){var index=+datum.grid;return[datum.ticks?index++:-1,datum.labels?index++:-1,index+ +datum.domain]}function axisLayout(view,axis,width,height){var item=axis.items[0],datum=item.datum,orient=datum.orient,indices=axisIndices(datum),range=item.range,offset=item.offset,position=item.position,minExtent=item.minExtent,maxExtent=item.maxExtent,title=datum.title&&item.items[indices[2]].items[0],titlePadding=item.titlePadding,bounds=item.bounds,x=0,y=0,i,s;tempBounds$2.clear().union(bounds);bounds.clear();if((i=indices[0])>-1)bounds.union(item.items[i].bounds);if((i=indices[1])>-1)bounds.union(item.items[i].bounds);switch(orient){case Top:x=position||0;y=-offset;s=Math.max(minExtent,Math.min(maxExtent,-bounds.y1));if(title)s=axisTitleLayout(title,s,titlePadding,0,-1,bounds);bounds.add(0,-s).add(range,0);break;case Left:x=-offset;y=position||0;s=Math.max(minExtent,Math.min(maxExtent,-bounds.x1));if(title)s=axisTitleLayout(title,s,titlePadding,1,-1,bounds);bounds.add(-s,0).add(0,range);break;case Right:x=width+offset;y=position||0;s=Math.max(minExtent,Math.min(maxExtent,bounds.x2));if(title)s=axisTitleLayout(title,s,titlePadding,1,1,bounds);bounds.add(0,0).add(s,range);break;case Bottom:x=position||0;y=height+offset;s=Math.max(minExtent,Math.min(maxExtent,bounds.y2));if(title)s=axisTitleLayout(title,s,titlePadding,0,1,bounds);bounds.add(0,0).add(range,s);break;default:x=item.x;y=item.y}boundStroke(bounds.translate(x,y),item);if(set(item,"x",x+AxisOffset)|set(item,"y",y+AxisOffset)){item.bounds=tempBounds$2;view.dirty(item);item.bounds=bounds;view.dirty(item)}return item.mark.bounds.clear().union(bounds)}function axisTitleLayout(title,offset,pad,isYAxis,sign,bounds){var b=title.bounds,dx=0,dy=0;if(title.auto){offset+=pad;isYAxis?dx=(title.x||0)-(title.x=sign*offset):dy=(title.y||0)-(title.y=sign*offset);b.translate(-dx,-dy);title.mark.bounds.set(b.x1,b.y1,b.x2,b.y2);if(isYAxis){bounds.add(0,b.y1).add(0,b.y2);offset+=b.width()}else{bounds.add(b.x1,0).add(b.x2,0);offset+=b.height()}}else{bounds.union(b)}return offset}function gridLayoutGroups(group){var groups=group.items,n=groups.length,i=0,mark,items;var views={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i){mark=groups[i];items=mark.items;if(mark.marktype===Group){switch(mark.role){case AxisRole:case LegendRole:break;case RowHeader:views.rowheaders.push(...items);break;case RowFooter:views.rowfooters.push(...items);break;case ColHeader:views.colheaders.push(...items);break;case ColFooter:views.colfooters.push(...items);break;case RowTitle:views.rowtitle=items[0];break;case ColTitle:views.coltitle=items[0];break;default:views.marks.push(...items)}}}return views}function bboxFlush(item){return(new Bounds).set(0,0,item.width||0,item.height||0)}function bboxFull(item){var b=item.bounds.clone();return b.empty()?b.set(0,0,0,0):b.translate(-(item.x||0),-(item.y||0))}function get$1(opt,key,d){var v=isObject(opt)?opt[key]:opt;return v!=null?v:d!==undefined?d:0}function offsetValue(v){return v<0?Math.ceil(-v):0}function gridLayout(view,groups,opt){var dirty=!opt.nodirty,bbox=opt.bounds===Flush?bboxFlush:bboxFull,bounds=tempBounds$2.set(0,0,0,0),alignCol=get$1(opt.align,Column),alignRow=get$1(opt.align,Row),padCol=get$1(opt.padding,Column),padRow=get$1(opt.padding,Row),ncols=opt.columns||groups.length,nrows=ncols<0?1:Math.ceil(groups.length/ncols),n=groups.length,xOffset=Array(n),xExtent=Array(ncols),xMax=0,yOffset=Array(n),yExtent=Array(nrows),yMax=0,dx=Array(n),dy=Array(n),boxes=Array(n),m,i,c,r,b,g,px,py,x,y,offset;for(i=0;i<ncols;++i)xExtent[i]=0;for(i=0;i<nrows;++i)yExtent[i]=0;for(i=0;i<n;++i){g=groups[i];b=boxes[i]=bbox(g);g.x=g.x||0;dx[i]=0;g.y=g.y||0;dy[i]=0;c=i%ncols;r=~~(i/ncols);xMax=Math.max(xMax,px=Math.ceil(b.x2));yMax=Math.max(yMax,py=Math.ceil(b.y2));xExtent[c]=Math.max(xExtent[c],px);yExtent[r]=Math.max(yExtent[r],py);xOffset[i]=padCol+offsetValue(b.x1);yOffset[i]=padRow+offsetValue(b.y1);if(dirty)view.dirty(groups[i])}for(i=0;i<n;++i){if(i%ncols===0)xOffset[i]=0;if(i<ncols)yOffset[i]=0}if(alignCol===Each){for(c=1;c<ncols;++c){for(offset=0,i=c;i<n;i+=ncols){if(offset<xOffset[i])offset=xOffset[i]}for(i=c;i<n;i+=ncols){xOffset[i]=offset+xExtent[c-1]}}}else if(alignCol===All){for(offset=0,i=0;i<n;++i){if(i%ncols&&offset<xOffset[i])offset=xOffset[i]}for(i=0;i<n;++i){if(i%ncols)xOffset[i]=offset+xMax}}else{for(alignCol=false,c=1;c<ncols;++c){for(i=c;i<n;i+=ncols){xOffset[i]+=xExtent[c-1]}}}if(alignRow===Each){for(r=1;r<nrows;++r){for(offset=0,i=r*ncols,m=i+ncols;i<m;++i){if(offset<yOffset[i])offset=yOffset[i]}for(i=r*ncols;i<m;++i){yOffset[i]=offset+yExtent[r-1]}}}else if(alignRow===All){for(offset=0,i=ncols;i<n;++i){if(offset<yOffset[i])offset=yOffset[i]}for(i=ncols;i<n;++i){yOffset[i]=offset+yMax}}else{for(alignRow=false,r=1;r<nrows;++r){for(i=r*ncols,m=i+ncols;i<m;++i){yOffset[i]+=yExtent[r-1]}}}for(x=0,i=0;i<n;++i){x=xOffset[i]+(i%ncols?x:0);dx[i]+=x-groups[i].x}for(c=0;c<ncols;++c){for(y=0,i=c;i<n;i+=ncols){y+=yOffset[i];dy[i]+=y-groups[i].y}}if(alignCol&&get$1(opt.center,Column)&&nrows>1){for(i=0;i<n;++i){b=alignCol===All?xMax:xExtent[i%ncols];x=b-boxes[i].x2-groups[i].x-dx[i];if(x>0)dx[i]+=x/2}}if(alignRow&&get$1(opt.center,Row)&&ncols!==1){for(i=0;i<n;++i){b=alignRow===All?yMax:yExtent[~~(i/ncols)];y=b-boxes[i].y2-groups[i].y-dy[i];if(y>0)dy[i]+=y/2}}for(i=0;i<n;++i){bounds.union(boxes[i].translate(dx[i],dy[i]))}x=get$1(opt.anchor,X);y=get$1(opt.anchor,Y);switch(get$1(opt.anchor,Column)){case End:x-=bounds.width();break;case Middle:x-=bounds.width()/2}switch(get$1(opt.anchor,Row)){case End:y-=bounds.height();break;case Middle:y-=bounds.height()/2}x=Math.round(x);y=Math.round(y);bounds.clear();for(i=0;i<n;++i){groups[i].mark.bounds.clear()}for(i=0;i<n;++i){g=groups[i];g.x+=dx[i]+=x;g.y+=dy[i]+=y;bounds.union(g.mark.bounds.union(g.bounds.translate(dx[i],dy[i])));if(dirty)view.dirty(g)}return bounds}function trellisLayout(view,group,opt){var views=gridLayoutGroups(group),groups=views.marks,bbox=opt.bounds===Flush?boundFlush:boundFull,off=opt.offset,ncols=opt.columns||groups.length,nrows=ncols<0?1:Math.ceil(groups.length/ncols),cells=nrows*ncols,x,y,x2,y2,anchor,band,offset;const bounds=gridLayout(view,groups,opt);if(views.rowheaders){band=get$1(opt.headerBand,Row,null);x=layoutHeaders(view,views.rowheaders,groups,ncols,nrows,-get$1(off,"rowHeader"),min$2,0,bbox,"x1",0,ncols,1,band)}if(views.colheaders){band=get$1(opt.headerBand,Column,null);y=layoutHeaders(view,views.colheaders,groups,ncols,ncols,-get$1(off,"columnHeader"),min$2,1,bbox,"y1",0,1,ncols,band)}if(views.rowfooters){band=get$1(opt.footerBand,Row,null);x2=layoutHeaders(view,views.rowfooters,groups,ncols,nrows,get$1(off,"rowFooter"),max$2,0,bbox,"x2",ncols-1,ncols,1,band)}if(views.colfooters){band=get$1(opt.footerBand,Column,null);y2=layoutHeaders(view,views.colfooters,groups,ncols,ncols,get$1(off,"columnFooter"),max$2,1,bbox,"y2",cells-ncols,1,ncols,band)}if(views.rowtitle){anchor=get$1(opt.titleAnchor,Row);offset=get$1(off,"rowTitle");offset=anchor===End?x2+offset:x-offset;band=get$1(opt.titleBand,Row,.5);layoutTitle(view,views.rowtitle,offset,0,bounds,band)}if(views.coltitle){anchor=get$1(opt.titleAnchor,Column);offset=get$1(off,"columnTitle");offset=anchor===End?y2+offset:y-offset;band=get$1(opt.titleBand,Column,.5);layoutTitle(view,views.coltitle,offset,1,bounds,band)}}function boundFlush(item,field){return field==="x1"?item.x||0:field==="y1"?item.y||0:field==="x2"?(item.x||0)+(item.width||0):field==="y2"?(item.y||0)+(item.height||0):undefined}function boundFull(item,field){return item.bounds[field]}function min$2(a,b){return Math.floor(Math.min(a,b))}function max$2(a,b){return Math.ceil(Math.max(a,b))}function layoutHeaders(view,headers,groups,ncols,limit,offset,agg,isX,bound,bf,start,stride,back,band){var n=groups.length,init=0,edge=0,i,j,k,m,b,h,g,x,y;if(!n)return init;for(i=start;i<n;i+=stride){if(groups[i])init=agg(init,bound(groups[i],bf))}if(!headers.length)return init;if(headers.length>limit){view.warn("Grid headers exceed limit: "+limit);headers=headers.slice(0,limit)}init+=offset;for(j=0,m=headers.length;j<m;++j){view.dirty(headers[j]);headers[j].mark.bounds.clear()}for(i=start,j=0,m=headers.length;j<m;++j,i+=stride){h=headers[j];b=h.mark.bounds;for(k=i;k>=0&&(g=groups[k])==null;k-=back);if(isX){x=band==null?g.x:Math.round(g.bounds.x1+band*g.bounds.width());y=init}else{x=init;y=band==null?g.y:Math.round(g.bounds.y1+band*g.bounds.height())}b.union(h.bounds.translate(x-(h.x||0),y-(h.y||0)));h.x=x;h.y=y;view.dirty(h);edge=agg(edge,b[bf])}return edge}function layoutTitle(view,g,offset,isX,bounds,band){if(!g)return;view.dirty(g);var x=offset,y=offset;isX?x=Math.round(bounds.x1+band*bounds.width()):y=Math.round(bounds.y1+band*bounds.height());g.bounds.translate(x-(g.x||0),y-(g.y||0));g.mark.bounds.clear().union(g.bounds);g.x=x;g.y=y;view.dirty(g)}function lookup$2(config,orient){const opt=config[orient]||{};return(key,d)=>opt[key]!=null?opt[key]:config[key]!=null?config[key]:d}function offsets(legends,value){var max=-Infinity;legends.forEach(item=>{if(item.offset!=null)max=Math.max(max,item.offset)});return max>-Infinity?max:value}function legendParams(g,orient,config,xb,yb,w,h){const _=lookup$2(config,orient),offset=offsets(g,_("offset",0)),anchor=_("anchor",Start),mult=anchor===End?1:anchor===Middle?.5:0;const p={align:Each,bounds:_("bounds",Flush),columns:_("direction")==="vertical"?1:g.length,padding:_("margin",8),center:_("center"),nodirty:true};switch(orient){case Left:p.anchor={x:Math.floor(xb.x1)-offset,column:End,y:mult*(h||xb.height()+2*xb.y1),row:anchor};break;case Right:p.anchor={x:Math.ceil(xb.x2)+offset,y:mult*(h||xb.height()+2*xb.y1),row:anchor};break;case Top:p.anchor={y:Math.floor(yb.y1)-offset,row:End,x:mult*(w||yb.width()+2*yb.x1),column:anchor};break;case Bottom:p.anchor={y:Math.ceil(yb.y2)+offset,x:mult*(w||yb.width()+2*yb.x1),column:anchor};break;case TopLeft:p.anchor={x:offset,y:offset};break;case TopRight:p.anchor={x:w-offset,y:offset,column:End};break;case BottomLeft:p.anchor={x:offset,y:h-offset,row:End};break;case BottomRight:p.anchor={x:w-offset,y:h-offset,column:End,row:End};break}return p}function legendLayout(view,legend){var item=legend.items[0],datum=item.datum,orient=item.orient,bounds=item.bounds,x=item.x,y=item.y,w,h;item._bounds?item._bounds.clear().union(bounds):item._bounds=bounds.clone();bounds.clear();legendGroupLayout(view,item,item.items[0].items[0]);bounds=legendBounds(item,bounds);w=2*item.padding;h=2*item.padding;if(!bounds.empty()){w=Math.ceil(bounds.width()+w);h=Math.ceil(bounds.height()+h)}if(datum.type===Symbols){legendEntryLayout(item.items[0].items[0].items[0].items)}if(orient!==None$1){item.x=x=0;item.y=y=0}item.width=w;item.height=h;boundStroke(bounds.set(x,y,x+w,y+h),item);item.mark.bounds.clear().union(bounds);return item}function legendBounds(item,b){item.items.forEach(_=>b.union(_.bounds));b.x1=item.padding;b.y1=item.padding;return b}function legendGroupLayout(view,item,entry){var pad=item.padding,ex=pad-entry.x,ey=pad-entry.y;if(!item.datum.title){if(ex||ey)translate$2(view,entry,ex,ey)}else{var title=item.items[1].items[0],anchor=title.anchor,tpad=item.titlePadding||0,tx=pad-title.x,ty=pad-title.y;switch(title.orient){case Left:ex+=Math.ceil(title.bounds.width())+tpad;break;case Right:case Bottom:break;default:ey+=title.fontSize+tpad}if(ex||ey)translate$2(view,entry,ex,ey);switch(title.orient){case Left:ty+=legendTitleOffset(item,entry,title,anchor,0,1);break;case Right:tx+=legendTitleOffset(item,entry,title,End,1,0)+tpad;ty+=legendTitleOffset(item,entry,title,anchor,0,1);break;case Bottom:tx+=legendTitleOffset(item,entry,title,anchor,1,0);ty+=legendTitleOffset(item,entry,title,End,0,0,1)+tpad;break;default:tx+=legendTitleOffset(item,entry,title,anchor,1,0)}if(tx||ty)translate$2(view,title,tx,ty);if((tx=Math.round(title.bounds.x1-pad))<0){translate$2(view,entry,-tx,0);translate$2(view,title,-tx,0)}}}function legendTitleOffset(item,entry,title,anchor,x,lr,noBar){const grad=item.datum.type!=="symbol",vgrad=title.datum.vgrad,e=grad&&(lr||!vgrad)&&!noBar?entry.items[0]:entry,s=e.bounds[x?"x2":"y2"]-item.padding,u=vgrad&&lr?s:0,v=vgrad&&lr?0:s;return Math.round(anchor===Start?u:anchor===End?v:.5*s)}function translate$2(view,item,dx,dy){item.x+=dx;item.y+=dy;item.bounds.translate(dx,dy);item.mark.bounds.translate(dx,dy);view.dirty(item)}function legendEntryLayout(entries){var widths=entries.reduce(function(w,g){w[g.column]=Math.max(g.bounds.x2-g.x,w[g.column]||0);return w},{});entries.forEach(function(g){g.width=widths[g.column];g.height=g.bounds.y2-g.y})}function titleLayout(view,title,width,height,viewBounds){var item=title.items[0],frame=item.frame,orient=item.orient,anchor=item.anchor,offset=item.offset,bounds=item.bounds,vertical=orient===Left||orient===Right,start=0,end=vertical?height:width,x=0,y=0,pos;if(frame!==Group){orient===Left?(start=viewBounds.y2,end=viewBounds.y1):orient===Right?(start=viewBounds.y1,end=viewBounds.y2):(start=viewBounds.x1,end=viewBounds.x2)}else if(orient===Left){start=height,end=0}pos=anchor===Start?start:anchor===End?end:(start+end)/2;tempBounds$2.clear().union(bounds);switch(orient){case Top:x=pos;y=viewBounds.y1-offset;break;case Left:x=viewBounds.x1-offset;y=pos;break;case Right:x=viewBounds.x2+offset;y=pos;break;case Bottom:x=pos;y=viewBounds.y2+offset;break;default:x=item.x;y=item.y}bounds.translate(x-(item.x||0),y-(item.y||0));if(set(item,"x",x)|set(item,"y",y)){item.bounds=tempBounds$2;view.dirty(item);item.bounds=bounds;view.dirty(item)}return title.bounds.clear().union(bounds)}function ViewLayout(params){Transform.call(this,null,params)}var prototype$R=inherits(ViewLayout,Transform);prototype$R.transform=function(_,pulse){var view=pulse.dataflow;_.mark.items.forEach(function(group){if(_.layout)trellisLayout(view,group,_.layout);layoutGroup(view,group,_)});if(_.modified())pulse.reflow();return pulse};function layoutGroup(view,group,_){var items=group.items,width=Math.max(0,group.width||0),height=Math.max(0,group.height||0),viewBounds=(new Bounds).set(0,0,width,height),xBounds=viewBounds.clone(),yBounds=viewBounds.clone(),legends=[],title,mark,orient,b,i,n;for(i=0,n=items.length;i<n;++i){mark=items[i];switch(mark.role){case AxisRole:b=isYAxis(mark)?xBounds:yBounds;b.union(axisLayout(view,mark,width,height));break;case TitleRole:title=mark;break;case LegendRole:legends.push(legendLayout(view,mark));break;case FrameRole:case ScopeRole:case RowHeader:case RowFooter:case RowTitle:case ColHeader:case ColFooter:case ColTitle:xBounds.union(mark.bounds);yBounds.union(mark.bounds);break;default:viewBounds.union(mark.bounds)}}if(legends.length){const l={};legends.forEach(item=>{orient=item.orient||Right;if(orient!==None$1)(l[orient]||(l[orient]=[])).push(item)});for(let orient in l){const g=l[orient];gridLayout(view,g,legendParams(g,orient,_.legends,xBounds,yBounds,width,height))}legends.forEach(item=>{const b=item.bounds;if(!b.equals(item._bounds)){item.bounds=item._bounds;view.dirty(item);item.bounds=b;view.dirty(item)}if(_.autosize&&_.autosize.type===Fit){switch(item.orient){case Left:case Right:viewBounds.add(b.x1,0).add(b.x2,0);break;case Top:case Bottom:viewBounds.add(0,b.y1).add(0,b.y2)}}else{viewBounds.union(b)}})}viewBounds.union(xBounds).union(yBounds);if(title){viewBounds.union(titleLayout(view,title,width,height,viewBounds))}viewSizeLayout(view,group,viewBounds,_)}function viewSizeLayout(view,group,viewBounds,_){var auto=_.autosize||{},type=auto.type,viewWidth=view._width,viewHeight=view._height,padding=view.padding();if(view._autosize<1||!type)return;var width=Math.max(0,group.width||0),left=Math.max(0,Math.ceil(-viewBounds.x1)),right=Math.max(0,Math.ceil(viewBounds.x2-width)),height=Math.max(0,group.height||0),top=Math.max(0,Math.ceil(-viewBounds.y1)),bottom=Math.max(0,Math.ceil(viewBounds.y2-height));if(auto.contains===Padding){viewWidth-=padding.left+padding.right;viewHeight-=padding.top+padding.bottom}if(type===None$1){left=0;top=0;width=viewWidth;height=viewHeight}else if(type===Fit){width=Math.max(0,viewWidth-left-right);height=Math.max(0,viewHeight-top-bottom)}else if(type===FitX){width=Math.max(0,viewWidth-left-right);viewHeight=height+top+bottom}else if(type===FitY){viewWidth=width+left+right;height=Math.max(0,viewHeight-top-bottom)}else if(type===Pad){viewWidth=width+left+right;viewHeight=height+top+bottom}view._resizeView(viewWidth,viewHeight,width,height,[left,top],auto.resize)}var vtx=Object.freeze({bound:Bound,identifier:Identifier,mark:Mark,overlap:Overlap,render:Render,viewlayout:ViewLayout});function bandSpace(count,paddingInner,paddingOuter){var space=count-paddingInner+paddingOuter*2;return count?space>0?space:1:0}const Identity="identity";const Linear$1="linear";const Log="log";const Pow="pow";const Sqrt="sqrt";const Symlog="symlog";const Time="time";const UTC="utc";const Sequential="sequential";const Diverging="diverging";const Quantile="quantile";const Quantize="quantize";const Threshold="threshold";const Ordinal="ordinal";const Point="point";const Band="band";const BinOrdinal="bin-ordinal";function isValidScaleType(type){switch(type){case Identity:case Linear$1:case Log:case Pow:case Sqrt:case Symlog:case Time:case UTC:case Sequential:case Quantile:case Quantize:case Threshold:case Ordinal:case Point:case Band:case BinOrdinal:return true}return false}function isQuantile(key){return key===Quantile}function isSequential(key){return key&&key.startsWith(Sequential)}function isDiverging(key){return key&&key.startsWith(Diverging)}function isInterpolating(key){return isSequential(key)||isDiverging(key)}function isLogarithmic(key){return key===Log||key.endsWith("-log")}function isContinuous(key){switch(key){case Linear$1:case Log:case Pow:case Sqrt:case Symlog:case Time:case UTC:case Sequential:return true}return false}function isDiscrete(key){return key===BinOrdinal||key===Ordinal||key===Band||key===Point}function isDiscretizing(key){return key===BinOrdinal||key===Quantile||key===Quantize||key===Threshold}var time={millisecond:millisecond,second:second,minute:minute,hour:hour,day:day,week:sunday,month:month,year:year};var utc={millisecond:millisecond,second:second,minute:utcMinute,hour:utcHour,day:utcDay,week:utcSunday,month:utcMonth,year:utcYear};function timeInterval(unit,type){const t=type===UTC?utc:time;return t.hasOwnProperty(unit)&&t[unit]}function invertRange(scale){return function(_){var lo=_[0],hi=_[1],t;if(hi<lo){t=lo;lo=hi;hi=t}return[scale.invert(lo),scale.invert(hi)]}}function invertRangeExtent(scale){return function(_){var range=scale.range(),lo=_[0],hi=_[1],min=-1,max,t,i,n;if(hi<lo){t=lo;lo=hi;hi=t}for(i=0,n=range.length;i<n;++i){if(range[i]>=lo&&range[i]<=hi){if(min<0)min=i;max=i}}if(min<0)return undefined;lo=scale.invertExtent(range[min]);hi=scale.invertExtent(range[max]);return[lo[0]===undefined?lo[1]:lo[0],hi[1]===undefined?hi[0]:hi[1]]}}function initRange(domain,range){switch(arguments.length){case 0:break;case 1:this.range(domain);break;default:this.range(range).domain(domain);break}return this}function initInterpolator(domain,interpolator){switch(arguments.length){case 0:break;case 1:this.interpolator(domain);break;default:this.interpolator(interpolator).domain(domain);break}return this}const implicit=Symbol("implicit");function ordinal(){var index=new Map,domain=[],range=[],unknown=implicit;function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range[(i-1)%range.length]}scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=new Map;for(const value of _){const key=value+"";if(index.has(key))continue;index.set(key,domain.push(value))}return scale};scale.range=function(_){return arguments.length?(range=Array.from(_),scale):range.slice()};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.copy=function(){return ordinal(domain,range).unknown(unknown)};initRange.apply(scale,arguments);return scale}function define(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype;prototype.constructor=constructor}function extend$1(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var darker=.7;var brighter=1/darker;var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex3=/^#([0-9a-f]{3})$/,reHex6=/^#([0-9a-f]{6})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$");var named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color$1,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}});function color$1(format){var m;format=(format+"").trim().toLowerCase();return(m=reHex3.exec(format))?(m=parseInt(m[1],16),new Rgb(m>>8&15|m>>4&240,m>>4&15|m&240,(m&15)<<4|m&15,1)):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(m[1]*255/100,m[2]*255/100,m[3]*255/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(m[1]*255/100,m[2]*255/100,m[3]*255/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):format==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,n&255,1)}function rgba(r,g,b,a){if(a<=0)r=g=b=NaN;return new Rgb(r,g,b,a)}function rgbConvert(o){if(!(o instanceof Color))o=color$1(o);if(!o)return new Rgb;o=o.rgb();return new Rgb(o.r,o.g,o.b,o.opacity)}function rgb(r,g,b,opacity){return arguments.length===1?rgbConvert(r):new Rgb(r,g,b,opacity==null?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r;this.g=+g;this.b=+b;this.opacity=+opacity}define(Rgb,rgb,extend$1(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&(0<=this.g&&this.g<=255)&&(0<=this.b&&this.b<=255)&&(0<=this.opacity&&this.opacity<=1)},hex:function(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)},toString:function(){var a=this.opacity;a=isNaN(a)?1:Math.max(0,Math.min(1,a));return(a===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(a===1?")":", "+a+")")}}));function hex(value){value=Math.max(0,Math.min(255,Math.round(value)||0));return(value<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){if(a<=0)h=s=l=NaN;else if(l<=0||l>=1)h=s=NaN;else if(s<=0)h=NaN;return new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(!(o instanceof Color))o=color$1(o);if(!o)return new Hsl;if(o instanceof Hsl)return o;o=o.rgb();var r=o.r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;if(s){if(r===max)h=(g-b)/s+(g<b)*6;else if(g===max)h=(b-r)/s+2;else h=(r-g)/s+4;s/=l<.5?max+min:2-max-min;h*=60}else{s=l>0&&l<1?0:h}return new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return arguments.length===1?hslConvert(h):new Hsl(h,s,l,opacity==null?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Hsl,hsl,extend$1(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+(this.h<0)*360,s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)&&(0<=this.opacity&&this.opacity<=1)}}));function hsl2rgb(h,m1,m2){return(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)*255}var deg2rad=Math.PI/180;var rad2deg=180/Math.PI;var K=18,Xn=.96422,Yn=1,Zn=.82521,t0$1=4/29,t1$1=6/29,t2=3*t1$1*t1$1,t3=t1$1*t1$1*t1$1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}if(!(o instanceof Rgb))o=rgbConvert(o);var r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/Yn),x,z;if(r===g&&g===b)x=z=y;else{x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/Xn);z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/Zn)}return new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return arguments.length===1?labConvert(l):new Lab(l,a,b,opacity==null?1:opacity)}function Lab(l,a,b,opacity){this.l=+l;this.a=+a;this.b=+b;this.opacity=+opacity}define(Lab,lab,extend$1(Color,{brighter:function(k){return new Lab(this.l+K*(k==null?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-K*(k==null?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;x=Xn*lab2xyz(x);y=Yn*lab2xyz(y);z=Zn*lab2xyz(z);return new Rgb(lrgb2rgb(3.1338561*x-1.6168667*y-.4906146*z),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}}));function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0$1}function lab2xyz(t){return t>t1$1?t*t*t:t2*(t-t0$1)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(!(o instanceof Lab))o=labConvert(o);if(o.a===0&&o.b===0)return new Hcl(NaN,0,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return arguments.length===1?hclConvert(h):new Hcl(h,c,l,opacity==null?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h;this.c=+c;this.l=+l;this.opacity=+opacity}define(Hcl,hcl,extend$1(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+K*(k==null?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-K*(k==null?1:k),this.opacity)},rgb:function(){return labConvert(this).rgb()}}));var A=-.14861,B=+1.78277,C=-.29227,D=-.90649,E=+1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);if(!(o instanceof Rgb))o=rgbConvert(o);var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix(h,s,l,opacity){return arguments.length===1?cubehelixConvert(h):new Cubehelix(h,s,l,opacity==null?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Cubehelix,cubehelix,extend$1(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}}));function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}function basis$1(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}}function basisClosed(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}}function constant$3(x){return function(){return x}}function linear(a,d){return function(t){return a+t*d}}function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant$3(isNaN(a)?b:a)}function gamma(y){return(y=+y)===1?nogamma:function(a,b){return b-a?exponential(a,b,y):constant$3(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant$3(isNaN(a)?b:a)}var rgb$1=function rgbGamma(y){var color=gamma(y);function rgb$1(start,end){var r=color((start=rgb(start)).r,(end=rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.r=r(t);start.g=g(t);start.b=b(t);start.opacity=opacity(t);return start+""}}rgb$1.gamma=rgbGamma;return rgb$1}(1);function rgbSpline(spline){return function(colors){var n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n),i,color;for(i=0;i<n;++i){color=rgb(colors[i]);r[i]=color.r||0;g[i]=color.g||0;b[i]=color.b||0}r=spline(r);g=spline(g);b=spline(b);color.opacity=1;return function(t){color.r=r(t);color.g=g(t);color.b=b(t);return color+""}}}var rgbBasis=rgbSpline(basis$1);var rgbBasisClosed=rgbSpline(basisClosed);function array$1(a,b){var nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb),i;for(i=0;i<na;++i)x[i]=interpolate(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}}function date(a,b){var d=new Date;return a=+a,b-=a,function(t){return d.setTime(a+b*t),d}}function interpolateNumber(a,b){return a=+a,b-=a,function(t){return a+b*t}}function object$2(a,b){var i={},c={},k;if(a===null||typeof a!=="object")a={};if(b===null||typeof b!=="object")b={};for(k in b){if(k in a){i[k]=interpolate(a[k],b[k])}else{c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero$1(b){return function(){return b}}function one$1(b){return function(t){return b(t)+""}}function string(a,b){var bi=reA.lastIndex=reB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=reA.exec(a))&&(bm=reB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:interpolateNumber(am,bm)})}bi=reB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?one$1(q[0].x):zero$1(b):(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}function interpolate(a,b){var t=typeof b,c;return b==null||t==="boolean"?constant$3(b):(t==="number"?interpolateNumber:t==="string"?(c=color$1(b))?(b=c,rgb$1):string:b instanceof color$1?rgb$1:b instanceof Date?date:Array.isArray(b)?array$1:typeof b.valueOf!=="function"&&typeof b.toString!=="function"||isNaN(b)?object$2:interpolateNumber)(a,b)}function discrete(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}function hue$1(a,b){var i=hue(+a,+b);return function(t){var x=i(t);return x-360*Math.floor(x/360)}}function interpolateRound(a,b){return a=+a,b-=a,function(t){return Math.round(a+b*t)}}var degrees=180/Math.PI;var identity$2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a,b,c,d,e,f){var scaleX,scaleY,skewX;if(scaleX=Math.sqrt(a*a+b*b))a/=scaleX,b/=scaleX;if(skewX=a*c+b*d)c-=a*skewX,d-=b*skewX;if(scaleY=Math.sqrt(c*c+d*d))c/=scaleY,d/=scaleY,skewX/=scaleY;if(a*d<b*c)a=-a,b=-b,skewX=-skewX,scaleX=-scaleX;return{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}}var cssNode,cssRoot,cssView,svgNode;function parseCss(value){if(value==="none")return identity$2;if(!cssNode)cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView;cssNode.style.transform=value;value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform");cssRoot.removeChild(cssNode);value=value.slice(7,-1).split(",");return decompose(+value[0],+value[1],+value[2],+value[3],+value[4],+value[5])}function parseSvg(value){if(value==null)return identity$2;if(!svgNode)svgNode=document.createElementNS("http://www.w3.org/2000/svg","g");svgNode.setAttribute("transform",value);if(!(value=svgNode.transform.baseVal.consolidate()))return identity$2;value=value.matrix;return decompose(value.a,value.b,value.c,value.d,value.e,value.f)}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})}else if(xb||yb){s.push("translate("+xb+pxComma+yb+pxParen)}}function rotate(a,b,s,q){if(a!==b){if(a-b>180)b+=360;else if(b-a>180)a+=360;q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:interpolateNumber(a,b)})}else if(b){s.push(pop(s)+"rotate("+b+degParen)}}function skewX(a,b,s,q){if(a!==b){q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:interpolateNumber(a,b)})}else if(b){s.push(pop(s)+"skewX("+b+degParen)}}function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})}else if(xb!==1||yb!==1){s.push(pop(s)+"scale("+xb+","+yb+")")}}return function(a,b){var s=[],q=[];a=parse(a),b=parse(b);translate(a.translateX,a.translateY,b.translateX,b.translateY,s,q);rotate(a.rotate,b.rotate,s,q);skewX(a.skewX,b.skewX,s,q);scale(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)");var interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");var rho=Math.SQRT2,rho2=2,rho4=4,epsilon2=1e-12;function cosh(x){return((x=Math.exp(x))+1/x)/2}function sinh(x){return((x=Math.exp(x))-1/x)/2}function tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}function zoom$1(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,i,S;if(d2<epsilon2){S=Math.log(w1/w0)/rho;i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]}}else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho;i=function(t){var s=t*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*tanh(rho*s+r0)-sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}i.duration=S*1e3;return i}function hsl$1(hue){return function(start,end){var h=hue((start=hsl(start)).h,(end=hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var hsl$2=hsl$1(hue);var hslLong=hsl$1(nogamma);function lab$1(start,end){var l=nogamma((start=lab(start)).l,(end=lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.l=l(t);start.a=a(t);start.b=b(t);start.opacity=opacity(t);return start+""}}function hcl$1(hue){return function(start,end){var h=hue((start=hcl(start)).h,(end=hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.c=c(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var hcl$2=hcl$1(hue);var hclLong=hcl$1(nogamma);function cubehelix$1(hue){return function cubehelixGamma(y){y=+y;function cubehelix$1(start,end){var h=hue((start=cubehelix(start)).h,(end=cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(Math.pow(t,y));start.opacity=opacity(t);return start+""}}cubehelix$1.gamma=cubehelixGamma;return cubehelix$1}(1)}var cubehelix$2=cubehelix$1(hue);var cubehelixLong=cubehelix$1(nogamma);function piecewise(interpolate,values){var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);while(i<n)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}}function quantize(interpolator,n){var samples=new Array(n);for(var i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples}var $$1=Object.freeze({interpolate:interpolate,interpolateArray:array$1,interpolateBasis:basis$1,interpolateBasisClosed:basisClosed,interpolateDate:date,interpolateDiscrete:discrete,interpolateHue:hue$1,interpolateNumber:interpolateNumber,interpolateObject:object$2,interpolateRound:interpolateRound,interpolateString:string,interpolateTransformCss:interpolateTransformCss,interpolateTransformSvg:interpolateTransformSvg,interpolateZoom:zoom$1,interpolateRgb:rgb$1,interpolateRgbBasis:rgbBasis,interpolateRgbBasisClosed:rgbBasisClosed,interpolateHsl:hsl$2,interpolateHslLong:hslLong,interpolateLab:lab$1,interpolateHcl:hcl$2,interpolateHclLong:hclLong,interpolateCubehelix:cubehelix$2,interpolateCubehelixLong:cubehelixLong,piecewise:piecewise,quantize:quantize});function constant$4(x){return function(){return x}}function number$2(x){return+x}var unit=[0,1];function identity$3(x){return x}function normalize(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:constant$4(isNaN(b)?NaN:.5)}function clamper(domain){var a=domain[0],b=domain[domain.length-1],t;if(a>b)t=a,a=b,b=t;return function(x){return Math.max(a,Math.min(b,x))}}function bimap(domain,range,interpolate){var d0=domain[0],d1=domain[1],r0=range[0],r1=range[1];if(d1<d0)d0=normalize(d1,d0),r0=interpolate(r1,r0);else d0=normalize(d0,d1),r0=interpolate(r0,r1);return function(x){return r0(d0(x))}}function polymap(domain,range,interpolate){var j=Math.min(domain.length,range.length)-1,d=new Array(j),r=new Array(j),i=-1;if(domain[j]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse()}while(++i<j){d[i]=normalize(domain[i],domain[i+1]);r[i]=interpolate(range[i],range[i+1])}return function(x){var i=bisectRight(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp()).unknown(source.unknown())}function transformer(){var domain=unit,range=unit,interpolate$1=interpolate,transform,untransform,unknown,clamp=identity$3,piecewise,output,input;function rescale(){piecewise=Math.min(domain.length,range.length)>2?polymap:bimap;output=input=null;return scale}function scale(x){return isNaN(x=+x)?unknown:(output||(output=piecewise(domain.map(transform),range,interpolate$1)))(transform(clamp(x)))}scale.invert=function(y){return clamp(untransform((input||(input=piecewise(range,domain.map(transform),interpolateNumber)))(y)))};scale.domain=function(_){return arguments.length?(domain=Array.from(_,number$2),clamp===identity$3||(clamp=clamper(domain)),rescale()):domain.slice()};scale.range=function(_){return arguments.length?(range=Array.from(_),rescale()):range.slice()};scale.rangeRound=function(_){return range=Array.from(_),interpolate$1=interpolateRound,rescale()};scale.clamp=function(_){return arguments.length?(clamp=_?clamper(domain):identity$3,scale):clamp!==identity$3};scale.interpolate=function(_){return arguments.length?(interpolate$1=_,rescale()):interpolate$1};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};return function(t,u){transform=t,untransform=u;return rescale()}}function continuous(transform,untransform){return transformer()(transform,untransform)}function formatDecimal(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]}function exponent(x){return x=formatDecimal(Math.abs(x)),x?x[1]:NaN}function formatGroup(grouping,thousands){return function(value,width){var i=value.length,t=[],j=0,g=grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=grouping[j=(j+1)%grouping.length]}return t.reverse().join(thousands)}}function formatNumerals(numerals){return function(value){return value.replace(/[0-9]/g,function(i){return numerals[+i]})}}var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){return new FormatSpecifier(specifier)}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;this.fill=match[1]||" ";this.align=match[2]||">";this.sign=match[3]||"-";this.symbol=match[4]||"";this.zero=!!match[5];this.width=match[6]&&+match[6];this.comma=!!match[7];this.precision=match[8]&&+match[8].slice(1);this.trim=!!match[9];this.type=match[10]||""}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function formatTrim(s){out:for(var n=s.length,i=1,i0=-1,i1;i<n;++i){switch(s[i]){case".":i0=i1=i;break;case"0":if(i0===0)i0=i;i1=i;break;default:if(i0>0){if(!+s[i])break out;i0=0}break}}return i0>0?s.slice(0,i0)+s.slice(i1+1):s}var prefixExponent;function formatPrefixAuto(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(exponent/3)))*3)+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]}function formatRounded(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")}var formatTypes={"%":function(x,p){return(x*100).toFixed(p)},b:function(x){return Math.round(x).toString(2)},c:function(x){return x+""},d:function(x){return Math.round(x).toString(10)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},g:function(x,p){return x.toPrecision(p)},o:function(x){return Math.round(x).toString(8)},p:function(x,p){return formatRounded(x*100,p)},r:formatRounded,s:formatPrefixAuto,X:function(x){return Math.round(x).toString(16).toUpperCase()},x:function(x){return Math.round(x).toString(16)}};function identity$4(x){return x}var prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function formatLocale$1(locale){var group=locale.grouping&&locale.thousands?formatGroup(locale.grouping,locale.thousands):identity$4,currency=locale.currency,decimal=locale.decimal,numerals=locale.numerals?formatNumerals(locale.numerals):identity$4,percent=locale.percent||"%";function newFormat(specifier){specifier=formatSpecifier(specifier);var fill=specifier.fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;if(type==="n")comma=true,type="g";else if(!formatTypes[type])precision==null&&(precision=12),trim=true,type="g";if(zero||fill==="0"&&align==="=")zero=true,fill="0",align="=";var prefix=symbol==="$"?currency[0]:symbol==="#"&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix=symbol==="$"?currency[1]:/[%p]/.test(type)?percent:"";var formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);precision=precision==null?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision));function format(value){var valuePrefix=prefix,valueSuffix=suffix,i,n,c;if(type==="c"){valueSuffix=formatType(value)+valueSuffix;value=""}else{value=+value;var valueNegative=value<0;value=formatType(Math.abs(value),precision);if(trim)value=formatTrim(value);if(valueNegative&&+value===0)valueNegative=false;valuePrefix=(valueNegative?sign==="("?sign:"-":sign==="-"||sign==="("?"":sign)+valuePrefix;valueSuffix=(type==="s"?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&sign==="("?")":"");if(maybeSuffix){i=-1,n=value.length;while(++i<n){if(c=value.charCodeAt(i),48>c||c>57){valueSuffix=(c===46?decimal+value.slice(i+1):value.slice(i))+valueSuffix;value=value.slice(0,i);break}}}}if(comma&&!zero)value=group(value,Infinity);var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";if(comma&&zero)value=group(padding+value,padding.length?width-valueSuffix.length:Infinity),padding="";switch(align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix;break}return numerals(value)}format.toString=function(){return specifier+""};return format}function formatPrefix(specifier,value){var f=newFormat((specifier=formatSpecifier(specifier),specifier.type="f",specifier)),e=Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3,k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}return{format:newFormat,formatPrefix:formatPrefix}}var locale$1;var format$1;var formatPrefix;defaultLocale$1({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function defaultLocale$1(definition){locale$1=formatLocale$1(definition);format$1=locale$1.format;formatPrefix=locale$1.formatPrefix;return locale$1}function precisionFixed(step){return Math.max(0,-exponent(Math.abs(step)))}function precisionPrefix(step,value){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3-exponent(Math.abs(step)))}function precisionRound(step,max){step=Math.abs(step),max=Math.abs(max)-step;return Math.max(0,exponent(max)-exponent(step))+1}function spanFormat(start,stop,count,specifier){var step=tickStep(start,stop,count),precision;specifier=formatSpecifier(specifier==null?",f":specifier);switch(specifier.type){case"s":{var value=Math.max(Math.abs(start),Math.abs(stop));if(specifier.precision==null&&!isNaN(precision=precisionPrefix(step,value)))specifier.precision=precision;return formatPrefix(specifier,value)}case"":case"e":case"g":case"p":case"r":{if(specifier.precision==null&&!isNaN(precision=precisionRound(step,Math.max(Math.abs(start),Math.abs(stop)))))specifier.precision=precision-(specifier.type==="e");break}case"f":case"%":{if(specifier.precision==null&&!isNaN(precision=precisionFixed(step)))specifier.precision=precision-(specifier.type==="%")*2;break}}return format$1(specifier)}function linearish(scale){var domain=scale.domain;scale.ticks=function(count){var d=domain();return ticks(d[0],d[d.length-1],count==null?10:count)};scale.tickFormat=function(count,specifier){var d=domain();return spanFormat(d[0],d[d.length-1],count==null?10:count,specifier)};scale.nice=function(count){if(count==null)count=10;var d=domain(),i0=0,i1=d.length-1,start=d[i0],stop=d[i1],step;if(stop<start){step=start,start=stop,stop=step;step=i0,i0=i1,i1=step}step=tickIncrement(start,stop,count);if(step>0){start=Math.floor(start/step)*step;stop=Math.ceil(stop/step)*step;step=tickIncrement(start,stop,count)}else if(step<0){start=Math.ceil(start*step)/step;stop=Math.floor(stop*step)/step;step=tickIncrement(start,stop,count)}if(step>0){d[i0]=Math.floor(start/step)*step;d[i1]=Math.ceil(stop/step)*step;domain(d)}else if(step<0){d[i0]=Math.ceil(start*step)/step;d[i1]=Math.floor(stop*step)/step;domain(d)}return scale};return scale}function linear$1(){var scale=continuous(identity$3,identity$3);scale.copy=function(){return copy(scale,linear$1())};initRange.apply(scale,arguments);return linearish(scale)}function identity$5(domain){var unknown;function scale(x){return isNaN(x=+x)?unknown:x}scale.invert=scale;scale.domain=scale.range=function(_){return arguments.length?(domain=Array.from(_,number$2),scale):domain.slice()};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.copy=function(){return identity$5(domain).unknown(unknown)};domain=arguments.length?Array.from(domain,number$2):[0,1];return linearish(scale)}function nice(domain,interval){domain=domain.slice();var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],t;if(x1<x0){t=i0,i0=i1,i1=t;t=x0,x0=x1,x1=t}domain[i0]=interval.floor(x0);domain[i1]=interval.ceil(x1);return domain}function transformLog(x){return Math.log(x)}function transformExp(x){return Math.exp(x)}function transformLogn(x){return-Math.log(-x)}function transformExpn(x){return-Math.exp(-x)}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function powp(base){return base===10?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}function logp(base){return base===Math.E?Math.log:base===10&&Math.log10||base===2&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}function reflect(f){return function(x){return-f(-x)}}function loggish(transform){var scale=transform(transformLog,transformExp),domain=scale.domain,base=10,logs,pows;function rescale(){logs=logp(base),pows=powp(base);if(domain()[0]<0){logs=reflect(logs),pows=reflect(pows);transform(transformLogn,transformExpn)}else{transform(transformLog,transformExp)}return scale}scale.base=function(_){return arguments.length?(base=+_,rescale()):base};scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.ticks=function(count){var d=domain(),u=d[0],v=d[d.length-1],r;if(r=v<u)i=u,u=v,v=i;var i=logs(u),j=logs(v),p,k,t,n=count==null?10:+count,z=[];if(!(base%1)&&j-i<n){i=Math.round(i)-1,j=Math.round(j)+1;if(u>0)for(;i<j;++i){for(k=1,p=pows(i);k<base;++k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}else for(;i<j;++i){for(k=base-1,p=pows(i);k>=1;--k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}}else{z=ticks(i,j,Math.min(j-i,n)).map(pows)}return r?z.reverse():z};scale.tickFormat=function(count,specifier){if(specifier==null)specifier=base===10?".0e":",";if(typeof specifier!=="function")specifier=format$1(specifier);if(count===Infinity)return specifier;if(count==null)count=10;var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));if(i*base<base-.5)i*=base;return i<=k?specifier(d):""}};scale.nice=function(){return domain(nice(domain(),{floor:function(x){return pows(Math.floor(logs(x)))},ceil:function(x){return pows(Math.ceil(logs(x)))}}))};return scale}function log$2(){var scale=loggish(transformer()).domain([1,10]);scale.copy=function(){return copy(scale,log$2()).base(scale.base())};initRange.apply(scale,arguments);return scale}function transformSymlog(c){return function(x){return Math.sign(x)*Math.log1p(Math.abs(x/c))}}function transformSymexp(c){return function(x){return Math.sign(x)*Math.expm1(Math.abs(x))*c}}function symlogish(transform){var c=1,scale=transform(transformSymlog(c),transformSymexp(c));scale.constant=function(_){return arguments.length?transform(transformSymlog(c=+_),transformSymexp(c)):c};return linearish(scale)}function symlog$1(){var scale=symlogish(transformer());scale.copy=function(){return copy(scale,symlog$1()).constant(scale.constant())};return initRange.apply(scale,arguments)}function transformPow(exponent){return function(x){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}}function transformSqrt(x){return x<0?-Math.sqrt(-x):Math.sqrt(x)}function transformSquare(x){return x<0?-x*x:x*x}function powish(transform){var scale=transform(identity$3,identity$3),exponent=1;function rescale(){return exponent===1?transform(identity$3,identity$3):exponent===.5?transform(transformSqrt,transformSquare):transform(transformPow(exponent),transformPow(1/exponent))}scale.exponent=function(_){return arguments.length?(exponent=+_,rescale()):exponent};return linearish(scale)}function pow$1(){var scale=powish(transformer());scale.copy=function(){return copy(scale,pow$1()).exponent(scale.exponent())};initRange.apply(scale,arguments);return scale}function sqrt$1(){return pow$1.apply(null,arguments).exponent(.5)}function quantile$1(){var domain=[],range=[],thresholds=[],unknown;function rescale(){var i=0,n=Math.max(1,range.length);thresholds=new Array(n-1);while(++i<n)thresholds[i-1]=quantile(domain,i/n);return scale}function scale(x){return isNaN(x=+x)?unknown:range[bisectRight(thresholds,x)]}scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:[i>0?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]};scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(let d of _)if(d!=null&&!isNaN(d=+d))domain.push(d);domain.sort(ascending);return rescale()};scale.range=function(_){return arguments.length?(range=Array.from(_),rescale()):range.slice()};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.quantiles=function(){return thresholds.slice()};scale.copy=function(){return quantile$1().domain(domain).range(range).unknown(unknown)};return initRange.apply(scale,arguments)}function quantize$1(){var x0=0,x1=1,n=1,domain=[.5],range=[0,1],unknown;function scale(x){return x<=x?range[bisectRight(domain,x,0,n)]:unknown}function rescale(){var i=-1;domain=new Array(n);while(++i<n)domain[i]=((i+1)*x1-(i-n)*x0)/(n+1);return scale}scale.domain=function(_){return arguments.length?([x0,x1]=_,x0=+x0,x1=+x1,rescale()):[x0,x1]};scale.range=function(_){return arguments.length?(n=(range=Array.from(_)).length-1,rescale()):range.slice()};scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:i<1?[x0,domain[0]]:i>=n?[domain[n-1],x1]:[domain[i-1],domain[i]]};scale.unknown=function(_){return arguments.length?(unknown=_,scale):scale};scale.thresholds=function(){return domain.slice()};scale.copy=function(){return quantize$1().domain([x0,x1]).range(range).unknown(unknown)};return initRange.apply(linearish(scale),arguments)}function threshold(){var domain=[.5],range=[0,1],unknown,n=1;function scale(x){return x<=x?range[bisectRight(domain,x,0,n)]:unknown}scale.domain=function(_){return arguments.length?(domain=Array.from(_),n=Math.min(domain.length,range.length-1),scale):domain.slice()};scale.range=function(_){return arguments.length?(range=Array.from(_),n=Math.min(domain.length,range.length-1),scale):range.slice()};scale.invertExtent=function(y){var i=range.indexOf(y);return[domain[i-1],domain[i]]};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.copy=function(){return threshold().domain(domain).range(range).unknown(unknown)};return initRange.apply(scale,arguments)}var durationSecond$1=1e3,durationMinute$1=durationSecond$1*60,durationHour$1=durationMinute$1*60,durationDay$1=durationHour$1*24,durationWeek$1=durationDay$1*7,durationMonth=durationDay$1*30,durationYear=durationDay$1*365;function date$1(t){return new Date(t)}function number$3(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format){var scale=continuous(identity$3,identity$3),invert=scale.invert,domain=scale.domain;var formatMillisecond=format(".%L"),formatSecond=format(":%S"),formatMinute=format("%I:%M"),formatHour=format("%I %p"),formatDay=format("%a %d"),formatWeek=format("%b %d"),formatMonth=format("%B"),formatYear=format("%Y");var tickIntervals=[[second,1,durationSecond$1],[second,5,5*durationSecond$1],[second,15,15*durationSecond$1],[second,30,30*durationSecond$1],[minute,1,durationMinute$1],[minute,5,5*durationMinute$1],[minute,15,15*durationMinute$1],[minute,30,30*durationMinute$1],[hour,1,durationHour$1],[hour,3,3*durationHour$1],[hour,6,6*durationHour$1],[hour,12,12*durationHour$1],[day,1,durationDay$1],[day,2,2*durationDay$1],[week,1,durationWeek$1],[month,1,durationMonth],[month,3,3*durationMonth],[year,1,durationYear]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop,step){if(interval==null)interval=10;if(typeof interval==="number"){var target=Math.abs(stop-start)/interval,i=bisector(function(i){return i[2]}).right(tickIntervals,target);if(i===tickIntervals.length){step=tickStep(start/durationYear,stop/durationYear,interval);interval=year}else if(i){i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i];step=i[1];interval=i[0]}else{step=Math.max(tickStep(start,stop,interval),1);interval=millisecond}}return step==null?interval:interval.every(step)}scale.invert=function(y){return new Date(invert(y))};scale.domain=function(_){return arguments.length?domain(Array.from(_,number$3)):domain().map(date$1)};scale.ticks=function(interval,step){var d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0,t;if(r)t=t0,t0=t1,t1=t;t=tickInterval(interval,t0,t1,step);t=t?t.range(t0,t1+1):[];return r?t.reverse():t};scale.tickFormat=function(count,specifier){return specifier==null?tickFormat:format(specifier)};scale.nice=function(interval,step){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1],step))?domain(nice(d,interval)):scale};scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format))};return scale}function time$1(){return initRange.apply(calendar(year,month,sunday,day,hour,minute,second,millisecond,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function utcTime(){return initRange.apply(calendar(utcYear,utcMonth,utcSunday,utcDay,utcHour,utcMinute,second,millisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function transformer$1(){var x0=0,x1=1,t0,t1,k10,transform,interpolator=identity$3,clamp=false,unknown;function scale(x){return isNaN(x=+x)?unknown:interpolator(k10===0?.5:(x=(transform(x)-t0)*k10,clamp?Math.max(0,Math.min(1,x)):x))}scale.domain=function(_){return arguments.length?([x0,x1]=_,t0=transform(x0=+x0),t1=transform(x1=+x1),k10=t0===t1?0:1/(t1-t0),scale):[x0,x1]};scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp};scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};return function(t){transform=t,t0=t(x0),t1=t(x1),k10=t0===t1?0:1/(t1-t0);return scale}}function copy$1(source,target){return target.domain(source.domain()).interpolator(source.interpolator()).clamp(source.clamp()).unknown(source.unknown())}function sequential(){var scale=linearish(transformer$1()(identity$3));scale.copy=function(){return copy$1(scale,sequential())};return initInterpolator.apply(scale,arguments)}function sequentialLog(){var scale=loggish(transformer$1()).domain([1,10]);scale.copy=function(){return copy$1(scale,sequentialLog()).base(scale.base())};return initInterpolator.apply(scale,arguments)}function sequentialSymlog(){var scale=symlogish(transformer$1());scale.copy=function(){return copy$1(scale,sequentialSymlog()).constant(scale.constant())};return initInterpolator.apply(scale,arguments)}function sequentialPow(){var scale=powish(transformer$1());scale.copy=function(){return copy$1(scale,sequentialPow()).exponent(scale.exponent())};return initInterpolator.apply(scale,arguments)}function sequentialSqrt(){return sequentialPow.apply(null,arguments).exponent(.5)}function transformer$2(){var x0=0,x1=.5,x2=1,t0,t1,t2,k10,k21,interpolator=identity$3,transform,clamp=false,unknown;function scale(x){return isNaN(x=+x)?unknown:(x=.5+((x=+transform(x))-t1)*(x<t1?k10:k21),interpolator(clamp?Math.max(0,Math.min(1,x)):x))}scale.domain=function(_){return arguments.length?([x0,x1,x2]=_,t0=transform(x0=+x0),t1=transform(x1=+x1),t2=transform(x2=+x2),k10=t0===t1?0:.5/(t1-t0),k21=t1===t2?0:.5/(t2-t1),scale):[x0,x1,x2]};scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp};scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};return function(t){transform=t,t0=t(x0),t1=t(x1),t2=t(x2),k10=t0===t1?0:.5/(t1-t0),k21=t1===t2?0:.5/(t2-t1);return scale}}function diverging(){var scale=linearish(transformer$2()(identity$3));scale.copy=function(){return copy$1(scale,diverging())};return initInterpolator.apply(scale,arguments)}function divergingLog(){var scale=loggish(transformer$2()).domain([.1,1,10]);scale.copy=function(){return copy$1(scale,divergingLog()).base(scale.base())};return initInterpolator.apply(scale,arguments)}function divergingSymlog(){var scale=symlogish(transformer$2());scale.copy=function(){return copy$1(scale,divergingSymlog()).constant(scale.constant())};return initInterpolator.apply(scale,arguments)}function divergingPow(){var scale=powish(transformer$2());scale.copy=function(){return copy$1(scale,divergingPow()).exponent(scale.exponent())};return initInterpolator.apply(scale,arguments)}function divergingSqrt(){return divergingPow.apply(null,arguments).exponent(.5)}function band(){var scale=ordinal().unknown(undefined),domain=scale.domain,ordinalRange=scale.range,range=[0,1],step,bandwidth,round=false,paddingInner=0,paddingOuter=0,align=.5;delete scale.unknown;function rescale(){var n=domain().length,reverse=range[1]<range[0],start=range[reverse-0],stop=range[1-reverse],space=bandSpace(n,paddingInner,paddingOuter);step=(stop-start)/(space||1);if(round){step=Math.floor(step)}start+=(stop-start-step*(n-paddingInner))*align;bandwidth=step*(1-paddingInner);if(round){start=Math.round(start);bandwidth=Math.round(bandwidth)}var values=sequence(n).map(function(i){return start+step*i});return ordinalRange(reverse?values.reverse():values)}scale.domain=function(_){if(arguments.length){domain(_);return rescale()}else{return domain()}};scale.range=function(_){if(arguments.length){range=[+_[0],+_[1]];return rescale()}else{return range.slice()}};scale.rangeRound=function(_){range=[+_[0],+_[1]];round=true;return rescale()};scale.bandwidth=function(){return bandwidth};scale.step=function(){return step};scale.round=function(_){if(arguments.length){round=!!_;return rescale()}else{return round}};scale.padding=function(_){if(arguments.length){paddingOuter=Math.max(0,Math.min(1,_));paddingInner=paddingOuter;return rescale()}else{return paddingInner}};scale.paddingInner=function(_){if(arguments.length){paddingInner=Math.max(0,Math.min(1,_));return rescale()}else{return paddingInner}};scale.paddingOuter=function(_){if(arguments.length){paddingOuter=Math.max(0,Math.min(1,_));return rescale()}else{return paddingOuter}};scale.align=function(_){if(arguments.length){align=Math.max(0,Math.min(1,_));return rescale()}else{return align}};scale.invertRange=function(_){if(_[0]==null||_[1]==null)return;var lo=+_[0],hi=+_[1],reverse=range[1]<range[0],values=reverse?ordinalRange().reverse():ordinalRange(),n=values.length-1,a,b,t;if(lo!==lo||hi!==hi)return;if(hi<lo){t=lo;lo=hi;hi=t}if(hi<values[0]||lo>range[1-reverse])return;a=Math.max(0,bisectRight(values,lo)-1);b=lo===hi?a:bisectRight(values,hi)-1;if(lo-values[a]>bandwidth+1e-10)++a;if(reverse){t=a;a=n-b;b=n-t}return a>b?undefined:domain().slice(a,b+1)};scale.invert=function(_){var value=scale.invertRange([_,_]);return value?value[0]:value};scale.copy=function(){return band().domain(domain()).range(range).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)};return rescale()}function pointish(scale){var copy=scale.copy;scale.padding=scale.paddingOuter;delete scale.paddingInner;scale.copy=function(){return pointish(copy())};return scale}function point$5(){return pointish(band().paddingInner(1))}var map=Array.prototype.map;function numbers$2(_){return map.call(_,function(x){return+x})}var slice=Array.prototype.slice;function scaleBinOrdinal(){var domain=[],range=[];function scale(x){return x==null||x!==x?undefined:range[(bisectRight(domain,x)-1)%range.length]}scale.domain=function(_){if(arguments.length){domain=numbers$2(_);return scale}else{return domain.slice()}};scale.range=function(_){if(arguments.length){range=slice.call(_);return scale}else{return range.slice()}};scale.tickFormat=function(count,specifier){return spanFormat(domain[0],peek(domain),count==null?10:count,specifier)};scale.copy=function(){return scaleBinOrdinal().domain(scale.domain()).range(scale.range())};return scale}function create(type,constructor){return function scale(){var s=constructor();if(!s.invertRange){s.invertRange=s.invert?invertRange(s):s.invertExtent?invertRangeExtent(s):undefined}s.type=type;return s}}function scale$1(type,scale){if(arguments.length>1){scales[type]=create(type,scale);return this}else{return scales.hasOwnProperty(type)?scales[type]:undefined}}var scales={[Identity]:identity$5,[Linear$1]:linear$1,[Log]:log$2,[Pow]:pow$1,[Sqrt]:sqrt$1,[Symlog]:symlog$1,[Time]:time$1,[UTC]:utcTime,[Sequential]:sequential,[Sequential+"-"+Linear$1]:sequential,[Sequential+"-"+Log]:sequentialLog,[Sequential+"-"+Pow]:sequentialPow,[Sequential+"-"+Sqrt]:sequentialSqrt,[Sequential+"-"+Symlog]:sequentialSymlog,[Diverging+"-"+Linear$1]:diverging,[Diverging+"-"+Log]:divergingLog,[Diverging+"-"+Pow]:divergingPow,[Diverging+"-"+Sqrt]:divergingSqrt,[Diverging+"-"+Symlog]:divergingSymlog,[Quantile]:quantile$1,[Quantize]:quantize$1,[Threshold]:threshold,[BinOrdinal]:scaleBinOrdinal,[Ordinal]:ordinal,[Band]:band,[Point]:point$5};for(var key$1 in scales){scale$1(key$1,scales[key$1])}const scaleProps=["clamp","base","constant","exponent"];function interpolateRange(interpolator,range){var start=range[0],span=peek(range)-start;return function(i){return interpolator(start+i*span)}}function interpolateColors(colors,type,gamma){return piecewise(interpolate$1(type||"rgb",gamma),colors)}function quantizeInterpolator(interpolator,count){var samples=new Array(count),n=count+1;for(var i=0;i<count;)samples[i]=interpolator(++i/n);return samples}function scaleFraction(scale,min,max){var delta=max-min,i,t,s;if(!delta||!isFinite(delta)){return constant(.5)}else{i=(t=scale.type).indexOf("-");t=i<0?t:t.slice(i+1);s=scale$1(t)().domain([min,max]).range([0,1]);scaleProps.forEach(m=>scale[m]?s[m](scale[m]()):0);return s}}function interpolate$1(type,gamma){var interp=$$1[method(type)];return gamma!=null&&interp&&interp.gamma?interp.gamma(gamma):interp}function method(type){return"interpolate"+type.toLowerCase().split("-").map(function(s){return s[0].toUpperCase()+s.slice(1)}).join("")}const continuous$1={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"};const discrete$1={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function colors(palette){var n=palette.length/6|0,c=new Array(n),i=0;while(i<n)c[i]="#"+palette.slice(i*6,++i*6);return c}function apply(_,f){for(let k in _)scheme(k,f(_[k]))}const schemes={};apply(discrete$1,colors);apply(continuous$1,_=>interpolateColors(colors(_)));function scheme(name,scheme){name=name&&name.toLowerCase();if(arguments.length>1){schemes[name]=scheme;return this}else{return schemes[name]}}function tickCount(scale,count,minStep){var step;if(isNumber(count)&&minStep!=null){count=Math.min(count,~~(span(scale.domain())/minStep)||1)}if(isObject(count)){step=count.step;count=count.interval}if(isString(count)){count=timeInterval(count,scale.type)||error("Only time and utc scales accept interval strings.");if(step)count=count.every(step)}return count}function validTicks(scale,ticks,count){var range=scale.range(),lo=Math.floor(range[0]),hi=Math.ceil(peek(range));if(lo>hi){range=hi;hi=lo;lo=range}ticks=ticks.filter(function(v){v=scale(v);return lo<=v&&v<=hi});if(count>0&&ticks.length>1){var endpoints=[ticks[0],peek(ticks)];while(ticks.length>count&&ticks.length>=3){ticks=ticks.filter(function(_,i){return!(i%2)})}if(ticks.length<3){ticks=endpoints}}return ticks}function tickValues(scale,count){return scale.bins?validTicks(scale,binValues(scale.bins,count)):scale.ticks?scale.ticks(count):scale.domain()}function binValues(bins,count){var n=bins.length,stride=~~(n/(count||n));return stride<2?bins.slice():bins.filter(function(x,i){return!(i%stride)})}function tickFormat(scale,count,specifier,formatType){var format=scale.tickFormat?scale.tickFormat(count,specifier):specifier&&formatType===Time?timeFormat(specifier):specifier?format$1(specifier):String;if(isLogarithmic(scale.type)){var logfmt=variablePrecision(specifier);format=scale.bins?logfmt:filter$1(format,logfmt)}return format}function filter$1(sourceFormat,targetFormat){return function(_){return sourceFormat(_)?targetFormat(_):""}}function variablePrecision(specifier){var s=formatSpecifier(specifier||",");if(s.precision==null){s.precision=12;switch(s.type){case"%":s.precision-=2;break;case"e":s.precision-=1;break}return trimZeroes(format$1(s),format$1(".1f")(1)[1])}else{return format$1(s)}}function trimZeroes(format,decimalChar){return function(x){var str=format(x),dec=str.indexOf(decimalChar),idx,end;if(dec<0)return str;idx=rightmostDigit(str,dec);end=idx<str.length?str.slice(idx):"";while(--idx>dec)if(str[idx]!=="0"){++idx;break}return str.slice(0,idx)+end}}function rightmostDigit(str,dec){var i=str.lastIndexOf("e"),c;if(i>0)return i;for(i=str.length;--i>dec;){c=str.charCodeAt(i);if(c>=48&&c<=57)return i+1}}function AxisTicks(params){Transform.call(this,null,params)}var prototype$S=inherits(AxisTicks,Transform);prototype$S.transform=function(_,pulse){if(this.value&&!_.modified()){return pulse.StopPropagation}var out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),ticks=this.value,scale=_.scale,tally=_.count==null?_.values?_.values.length:10:_.count,count=tickCount(scale,tally,_.minstep),format=_.format||tickFormat(scale,count,_.formatSpecifier,_.formatType),values=_.values?validTicks(scale,_.values,count):tickValues(scale,count);if(ticks)out.rem=ticks;ticks=values.map(function(value,i){return ingest({index:i/(values.length-1||1),value:value,label:format(value)})});if(_.extra&&ticks.length){ticks.push(ingest({index:-1,extra:{value:ticks[0].value},label:""}))}out.source=ticks;out.add=ticks;this.value=ticks;return out};function DataJoin(params){Transform.call(this,null,params)}var prototype$T=inherits(DataJoin,Transform);function defaultItemCreate(){return ingest({})}function isExit(t){return t.exit}prototype$T.transform=function(_,pulse){var df=pulse.dataflow,out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),item=_.item||defaultItemCreate,key=_.key||tupleid,map=this.value;if(isArray(out.encode)){out.encode=null}if(map&&(_.modified("key")||pulse.modified(key))){error("DataJoin does not support modified key function or fields.")}if(!map){pulse=pulse.addAll();this.value=map=fastmap().test(isExit);map.lookup=function(t){return map.get(key(t))}}pulse.visit(pulse.ADD,function(t){var k=key(t),x=map.get(k);if(x){if(x.exit){map.empty--;out.add.push(x)}else{out.mod.push(x)}}else{map.set(k,x=item(t));out.add.push(x)}x.datum=t;x.exit=false});pulse.visit(pulse.MOD,function(t){var k=key(t),x=map.get(k);if(x){x.datum=t;out.mod.push(x)}});pulse.visit(pulse.REM,function(t){var k=key(t),x=map.get(k);if(t===x.datum&&!x.exit){out.rem.push(x);x.exit=true;++map.empty}});if(pulse.changed(pulse.ADD_MOD))out.modifies("datum");if(_.clean&&map.empty>df.cleanThreshold)df.runAfter(map.clean);return out};function Encode(params){Transform.call(this,null,params)}var prototype$U=inherits(Encode,Transform);prototype$U.transform=function(_,pulse){var out=pulse.fork(pulse.ADD_REM),encoders=_.encoders,encode=pulse.encode;if(isArray(encode)){if(out.changed()||encode.every(function(e){return encoders[e]})){encode=encode[0];out.encode=null}else{return pulse.StopPropagation}}var reenter=encode==="enter",update=encoders.update||falsy,enter=encoders.enter||falsy,exit=encoders.exit||falsy,set=(encode&&!reenter?encoders[encode]:update)||falsy;if(pulse.changed(pulse.ADD)){pulse.visit(pulse.ADD,function(t){enter(t,_);update(t,_);if(set!==falsy&&set!==update)set(t,_)});out.modifies(enter.output);out.modifies(update.output);if(set!==falsy&&set!==update)out.modifies(set.output)}if(pulse.changed(pulse.REM)&&exit!==falsy){pulse.visit(pulse.REM,function(t){exit(t,_)});out.modifies(exit.output)}if(reenter||set!==falsy){var flag=pulse.MOD|(_.modified()?pulse.REFLOW:0);if(reenter){pulse.visit(flag,function(t){var mod=enter(t,_);if(set(t,_)||mod)out.mod.push(t)});if(out.mod.length)out.modifies(enter.output)}else{pulse.visit(flag,function(t){if(set(t,_))out.mod.push(t)})}if(out.mod.length)out.modifies(set.output)}return out.changed()?out:pulse.StopPropagation};var Symbols$1="symbol";var Discrete="discrete";var Gradient$1="gradient";const symbols$1={[Quantile]:"quantiles",[Quantize]:"thresholds",[Threshold]:"domain"};const formats$1={[Quantile]:"quantiles",[Quantize]:"domain"};function labelValues(scale,count){return scale.bins?binValues$1(scale.bins):symbols$1[scale.type]?thresholdValues(scale[symbols$1[scale.type]]()):tickValues(scale,count)}function thresholdFormat(scale,specifier){var _=scale[formats$1[scale.type]](),n=_.length,d=n>1?_[1]-_[0]:_[0],i;for(i=1;i<n;++i){d=Math.min(d,_[i]-_[i-1])}return spanFormat(0,d,3*10,specifier)}function thresholdValues(thresholds){const values=[-Infinity].concat(thresholds);values.max=+Infinity;return values}function binValues$1(bins){const values=bins.slice(0,-1);values.max=peek(bins);return values}function isDiscreteRange(scale){return symbols$1[scale.type]||scale.bins}function labelFormat(scale,count,type,specifier,formatType){const format=formats$1[scale.type]&&formatType!==Time?thresholdFormat(scale,specifier):tickFormat(scale,count,specifier,formatType);return type===Symbols$1&&isDiscreteRange(scale)?formatRange(format):type===Discrete?formatDiscrete(format):formatPoint(format)}function formatRange(format){return function(value,index,array){var limit=array[index+1]||array.max||+Infinity,lo=formatValue(value,format),hi=formatValue(limit,format);return lo&&hi?lo+""+hi:hi?"< "+hi:" "+lo}}function formatDiscrete(format){return function(value,index){return index?format(value):null}}function formatPoint(format){return function(value){return format(value)}}function formatValue(value,format){return isFinite(value)?format(value):null}function labelFraction(scale){var domain=scale.domain(),count=domain.length-1,lo=+domain[0],hi=+peek(domain),span=hi-lo;if(scale.type===Threshold){var adjust=count?span/count:.1;lo-=adjust;hi+=adjust;span=hi-lo}return function(value){return(value-lo)/span}}function LegendEntries(params){Transform.call(this,[],params)}var prototype$V=inherits(LegendEntries,Transform);prototype$V.transform=function(_,pulse){if(this.value!=null&&!_.modified()){return pulse.StopPropagation}var out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),items=this.value,type=_.type||Symbols$1,scale=_.scale,count=tickCount(scale,_.count==null?5:_.count,_.minstep),format=_.format||labelFormat(scale,count,type,_.formatSpecifier,_.formatType),values=_.values||labelValues(scale,count,type),domain,fraction,size,offset;if(items)out.rem=items;if(type===Symbols$1){if(isFunction(size=_.size)){if(!_.values&&scale(values[0])===0){values=values.slice(1)}offset=values.reduce(function(max,value){return Math.max(max,size(value,_))},0)}else{size=constant(offset=size||8)}items=values.map(function(value,index){return ingest({index:index,label:format(value,index,values),value:value,offset:offset,size:size(value,_)})})}else if(type===Gradient$1){domain=scale.domain(),fraction=scaleFraction(scale,domain[0],peek(domain));if(values.length<3&&!_.values&&domain[0]!==peek(domain)){values=[domain[0],peek(domain)]}items=values.map(function(value,index){return ingest({index:index,label:format(value,index,values),value:value,perc:fraction(value)})})}else{size=values.length-1;fraction=labelFraction(scale);items=values.map(function(value,index){return ingest({index:index,label:format(value,index,values),value:value,perc:index?fraction(value):0,perc2:index===size?1:fraction(values[index+1])})})}out.source=items;out.add=items;this.value=items;return out};var Paths=fastmap({line:line$2,"line-radial":lineR,arc:arc$2,"arc-radial":arcR,curve:curve,"curve-radial":curveR,"orthogonal-horizontal":orthoX,"orthogonal-vertical":orthoY,"orthogonal-radial":orthoR,"diagonal-horizontal":diagonalX,"diagonal-vertical":diagonalY,"diagonal-radial":diagonalR});function sourceX(t){return t.source.x}function sourceY(t){return t.source.y}function targetX(t){return t.target.x}function targetY(t){return t.target.y}function LinkPath(params){Transform.call(this,{},params)}LinkPath.Definition={type:"LinkPath",metadata:{modifies:true},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};var prototype$W=inherits(LinkPath,Transform);prototype$W.transform=function(_,pulse){var sx=_.sourceX||sourceX,sy=_.sourceY||sourceY,tx=_.targetX||targetX,ty=_.targetY||targetY,as=_.as||"path",orient=_.orient||"vertical",shape=_.shape||"line",path=Paths.get(shape+"-"+orient)||Paths.get(shape);if(!path){error("LinkPath unsupported type: "+_.shape+(_.orient?"-"+_.orient:""))}pulse.visit(pulse.SOURCE,function(t){t[as]=path(sx(t),sy(t),tx(t),ty(t))});return pulse.reflow(_.modified()).modifies(as)};function line$2(sx,sy,tx,ty){return"M"+sx+","+sy+"L"+tx+","+ty}function lineR(sa,sr,ta,tr){return line$2(sr*Math.cos(sa),sr*Math.sin(sa),tr*Math.cos(ta),tr*Math.sin(ta))}function arc$2(sx,sy,tx,ty){var dx=tx-sx,dy=ty-sy,rr=Math.sqrt(dx*dx+dy*dy)/2,ra=180*Math.atan2(dy,dx)/Math.PI;return"M"+sx+","+sy+"A"+rr+","+rr+" "+ra+" 0 1"+" "+tx+","+ty}function arcR(sa,sr,ta,tr){return arc$2(sr*Math.cos(sa),sr*Math.sin(sa),tr*Math.cos(ta),tr*Math.sin(ta))}function curve(sx,sy,tx,ty){var dx=tx-sx,dy=ty-sy,ix=.2*(dx+dy),iy=.2*(dy-dx);return"M"+sx+","+sy+"C"+(sx+ix)+","+(sy+iy)+" "+(tx+iy)+","+(ty-ix)+" "+tx+","+ty}function curveR(sa,sr,ta,tr){return curve(sr*Math.cos(sa),sr*Math.sin(sa),tr*Math.cos(ta),tr*Math.sin(ta))}function orthoX(sx,sy,tx,ty){return"M"+sx+","+sy+"V"+ty+"H"+tx}function orthoY(sx,sy,tx,ty){return"M"+sx+","+sy+"H"+tx+"V"+ty}function orthoR(sa,sr,ta,tr){var sc=Math.cos(sa),ss=Math.sin(sa),tc=Math.cos(ta),ts=Math.sin(ta),sf=Math.abs(ta-sa)>Math.PI?ta<=sa:ta>sa;return"M"+sr*sc+","+sr*ss+"A"+sr+","+sr+" 0 0,"+(sf?1:0)+" "+sr*tc+","+sr*ts+"L"+tr*tc+","+tr*ts}function diagonalX(sx,sy,tx,ty){var m=(sx+tx)/2;return"M"+sx+","+sy+"C"+m+","+sy+" "+m+","+ty+" "+tx+","+ty}function diagonalY(sx,sy,tx,ty){var m=(sy+ty)/2;return"M"+sx+","+sy+"C"+sx+","+m+" "+tx+","+m+" "+tx+","+ty}function diagonalR(sa,sr,ta,tr){var sc=Math.cos(sa),ss=Math.sin(sa),tc=Math.cos(ta),ts=Math.sin(ta),mr=(sr+tr)/2;return"M"+sr*sc+","+sr*ss+"C"+mr*sc+","+mr*ss+" "+mr*tc+","+mr*ts+" "+tr*tc+","+tr*ts}function Pie(params){Transform.call(this,null,params)}Pie.Definition={type:"Pie",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:false},{name:"as",type:"string",array:true,length:2,default:["startAngle","endAngle"]}]};var prototype$X=inherits(Pie,Transform);prototype$X.transform=function(_,pulse){var as=_.as||["startAngle","endAngle"],startAngle=as[0],endAngle=as[1],field=_.field||one,start=_.startAngle||0,stop=_.endAngle!=null?_.endAngle:2*Math.PI,data=pulse.source,values=data.map(field),n=values.length,a=start,k=(stop-start)/sum(values),index=sequence(n),i,t,v;if(_.sort){index.sort(function(a,b){return values[a]-values[b]})}for(i=0;i<n;++i){v=values[index[i]];t=data[index[i]];t[startAngle]=a;t[endAngle]=a+=v*k}this.value=values;return pulse.reflow(_.modified()).modifies(as)};var DEFAULT_COUNT=5;function includeZero(scale){const type=scale.type;return!scale.bins&&(type===Linear$1||type===Pow||type===Sqrt)}function includePad(type){return isContinuous(type)&&type!==Sequential}var SKIP$2=toSet(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Scale(params){Transform.call(this,null,params);this.modified(true)}var prototype$Y=inherits(Scale,Transform);prototype$Y.transform=function(_,pulse){var df=pulse.dataflow,scale=this.value,key=scaleKey(_);if(!scale||key!==scale.type){this.value=scale=scale$1(key)()}for(key in _)if(!SKIP$2[key]){if(key==="padding"&&includePad(scale.type))continue;isFunction(scale[key])?scale[key](_[key]):df.warn("Unsupported scale property: "+key)}configureRange(scale,_,configureBins(scale,_,configureDomain(scale,_,df)));return pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS)};function scaleKey(_){var t=_.type,d="",n;if(t===Sequential)return Sequential+"-"+Linear$1;if(isContinuousColor(_)){n=_.rawDomain?_.rawDomain.length:_.domain?_.domain.length+ +(_.domainMid!=null):0;d=n===2?Sequential+"-":n===3?Diverging+"-":""}return(d+t||Linear$1).toLowerCase()}function isContinuousColor(_){const t=_.type;return isContinuous(t)&&t!==Time&&t!==UTC&&(_.scheme||_.range&&_.range.length&&_.range.every(isString))}function configureDomain(scale,_,df){var raw=rawDomain(scale,_.domainRaw,df);if(raw>-1)return raw;var domain=_.domain,type=scale.type,zero=_.zero||_.zero===undefined&&includeZero(scale),n,mid;if(!domain)return 0;if(includePad(type)&&_.padding&&domain[0]!==peek(domain)){domain=padDomain(type,domain,_.range,_.padding,_.exponent,_.constant)}if(zero||_.domainMin!=null||_.domainMax!=null||_.domainMid!=null){n=(domain=domain.slice()).length-1||1;if(zero){if(domain[0]>0)domain[0]=0;if(domain[n]<0)domain[n]=0}if(_.domainMin!=null)domain[0]=_.domainMin;if(_.domainMax!=null)domain[n]=_.domainMax;if(_.domainMid!=null){mid=_.domainMid;if(mid<domain[0]||mid>domain[n]){df.warn("Scale domainMid exceeds domain min or max.",mid)}domain.splice(n,0,mid)}}scale.domain(domainCheck(type,domain,df));if(type===Ordinal){scale.unknown(_.domainImplicit?implicit:undefined)}if(_.nice&&scale.nice){scale.nice(_.nice!==true&&tickCount(scale,_.nice)||null)}return domain.length}function rawDomain(scale,raw,df){if(raw){scale.domain(domainCheck(scale.type,raw,df));return raw.length}else{return-1}}function padDomain(type,domain,range,pad,exponent,constant){var span=Math.abs(peek(range)-range[0]),frac=span/(span-2*pad),d=type===Log?zoomLog(domain,null,frac):type===Sqrt?zoomPow(domain,null,frac,.5):type===Pow?zoomPow(domain,null,frac,exponent||1):type===Symlog?zoomSymlog(domain,null,frac,constant||1):zoomLinear(domain,null,frac);domain=domain.slice();domain[0]=d[0];domain[domain.length-1]=d[1];return domain}function domainCheck(type,domain,df){if(isLogarithmic(type)){var s=Math.abs(domain.reduce(function(s,v){return s+(v<0?-1:v>0?1:0)},0));if(s!==domain.length){df.warn("Log scale domain includes zero: "+$(domain))}}return domain}function configureBins(scale,_,count){let bins=_.bins;if(bins&&!isArray(bins)){const domain=(bins.start==null||bins.stop==null)&&scale.domain(),start=bins.start==null?domain[0]:bins.start,stop=bins.stop==null?peek(domain):bins.stop,step=bins.step;if(!step)error("Scale bins parameter missing step property.");bins=sequence(start,stop+step,step)}if(bins){scale.bins=bins}else if(scale.bins){delete scale.bins}if(scale.type===BinOrdinal){if(!bins){scale.bins=scale.domain()}else if(!_.domain&&!_.domainRaw){scale.domain(bins);count=bins.length}}return count}function configureRange(scale,_,count){var round=_.round||false,range=_.range;if(_.rangeStep!=null){range=configureRangeStep(scale.type,_,count)}else if(_.scheme){range=configureScheme(scale.type,_,count);if(isFunction(range))return scale.interpolator(range)}else if(range&&isInterpolating(scale.type)){return scale.interpolator(interpolateColors(flip(range,_.reverse),_.interpolate,_.interpolateGamma))}if(range&&_.interpolate&&scale.interpolate){scale.interpolate(interpolate$1(_.interpolate,_.interpolateGamma))}else if(isFunction(scale.round)){scale.round(round)}else if(isFunction(scale.rangeRound)){scale.interpolate(round?interpolateRound:interpolate)}if(range)scale.range(flip(range,_.reverse))}function configureRangeStep(type,_,count){if(type!==Band&&type!==Point){error("Only band and point scales support rangeStep.")}var outer=(_.paddingOuter!=null?_.paddingOuter:_.padding)||0,inner=type===Point?1:(_.paddingInner!=null?_.paddingInner:_.padding)||0;return[0,_.rangeStep*bandSpace(count,inner,outer)]}function configureScheme(type,_,count){var extent=_.schemeExtent,name,scheme$1;if(isArray(_.scheme)){scheme$1=interpolateColors(_.scheme,_.interpolate,_.interpolateGamma)}else{name=_.scheme.toLowerCase();scheme$1=scheme(name);if(!scheme$1)error("Unrecognized scheme name: "+_.scheme)}count=type===Threshold?count+1:type===BinOrdinal?count-1:type===Quantile||type===Quantize?+_.schemeCount||DEFAULT_COUNT:count;return isInterpolating(type)?adjustScheme(scheme$1,extent,_.reverse):isFunction(scheme$1)?quantizeInterpolator(adjustScheme(scheme$1,extent),count):type===Ordinal?scheme$1:scheme$1.slice(0,count)}function adjustScheme(scheme,extent,reverse){return isFunction(scheme)&&(extent||reverse)?interpolateRange(scheme,flip(extent||[0,1],reverse)):scheme}function flip(array,reverse){return reverse?array.slice().reverse():array}function SortItems(params){Transform.call(this,null,params)}var prototype$Z=inherits(SortItems,Transform);prototype$Z.transform=function(_,pulse){var mod=_.modified("sort")||pulse.changed(pulse.ADD)||pulse.modified(_.sort.fields)||pulse.modified("datum");if(mod)pulse.source.sort(_.sort);this.modified(mod);return pulse};var Zero="zero",Center="center",Normalize="normalize",DefOutput=["y0","y1"];function Stack(params){Transform.call(this,null,params)}Stack.Definition={type:"Stack",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:true},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Zero,values:[Zero,Center,Normalize]},{name:"as",type:"string",array:true,length:2,default:DefOutput}]};var prototype$_=inherits(Stack,Transform);prototype$_.transform=function(_,pulse){var as=_.as||DefOutput,y0=as[0],y1=as[1],field=_.field||one,stack=_.offset===Center?stackCenter:_.offset===Normalize?stackNormalize:stackZero,groups,i,n,max;groups=partition$1(pulse.source,_.groupby,_.sort,field);for(i=0,n=groups.length,max=groups.max;i<n;++i){stack(groups[i],max,field,y0,y1)}return pulse.reflow(_.modified()).modifies(as)};function stackCenter(group,max,field,y0,y1){var last=(max-group.sum)/2,m=group.length,j=0,t;for(;j<m;++j){t=group[j];t[y0]=last;t[y1]=last+=Math.abs(field(t))}}function stackNormalize(group,max,field,y0,y1){var scale=1/group.sum,last=0,m=group.length,j=0,v=0,t;for(;j<m;++j){t=group[j];t[y0]=last;t[y1]=last=scale*(v+=Math.abs(field(t)))}}function stackZero(group,max,field,y0,y1){var lastPos=0,lastNeg=0,m=group.length,j=0,v,t;for(;j<m;++j){t=group[j];v=+field(t);if(v<0){t[y0]=lastNeg;t[y1]=lastNeg+=v}else{t[y0]=lastPos;t[y1]=lastPos+=v}}}function partition$1(data,groupby,sort,field){var groups=[],get=function(f){return f(t)},map,i,n,m,t,k,g,s,max;if(groupby==null){groups.push(data.slice())}else{for(map={},i=0,n=data.length;i<n;++i){t=data[i];k=groupby.map(get);g=map[k];if(!g){map[k]=g=[];groups.push(g)}g.push(t)}}for(k=0,max=0,m=groups.length;k<m;++k){g=groups[k];for(i=0,s=0,n=g.length;i<n;++i){s+=Math.abs(field(g[i]))}g.sum=s;if(s>max)max=s;if(sort)g.sort(sort)}groups.max=max;return groups}var encode=Object.freeze({axisticks:AxisTicks,datajoin:DataJoin,encode:Encode,legendentries:LegendEntries,linkpath:LinkPath,pie:Pie,scale:Scale,sortitems:SortItems,stack:Stack,validTicks:validTicks});function ascending$1(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector$1(compare){if(compare.length===1)compare=ascendingComparator$1(compare);return{left:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}}function ascendingComparator$1(f){return function(d,x){return ascending$1(f(d),x)}}var ascendingBisect$1=bisector$1(ascending$1);function extent$2(values,valueof){var n=values.length,i=-1,value,min,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){min=max=value;while(++i<n){if((value=values[i])!=null){if(min>value)min=value;if(max<value)max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){min=max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null){if(min>value)min=value;if(max<value)max=value}}}}}return[min,max]}function range(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range}var e10$1=Math.sqrt(50),e5$1=Math.sqrt(10),e2$1=Math.sqrt(2);function tickStep$1(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;if(error>=e10$1)step1*=10;else if(error>=e5$1)step1*=5;else if(error>=e2$1)step1*=2;return stop<start?-step1:step1}function thresholdSturges(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1}function max$3(values,valueof){var n=values.length,i=-1,value,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){max=value;while(++i<n){if((value=values[i])!=null&&value>max){max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>max){max=value}}}}}return max}var array$2=Array.prototype;var slice$1=array$2.slice;function ascending$2(a,b){return a-b}function area$2(ring){var i=0,n=ring.length,area=ring[n-1][1]*ring[0][0]-ring[n-1][0]*ring[0][1];while(++i<n)area+=ring[i-1][1]*ring[i][0]-ring[i-1][0]*ring[i][1];return area}function constant$5(x){return function(){return x}}function contains(ring,hole){var i=-1,n=hole.length,c;while(++i<n)if(c=ringContains(ring,hole[i]))return c;return 0}function ringContains(ring,point){var x=point[0],y=point[1],contains=-1;for(var i=0,n=ring.length,j=n-1;i<n;j=i++){var pi=ring[i],xi=pi[0],yi=pi[1],pj=ring[j],xj=pj[0],yj=pj[1];if(segmentContains(pi,pj,point))return 0;if(yi>y!==yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi)contains=-contains}return contains}function segmentContains(a,b,c){var i;return collinear(a,b,c)&&within(a[i=+(a[0]===b[0])],c[i],b[i])}function collinear(a,b,c){return(b[0]-a[0])*(c[1]-a[1])===(c[0]-a[0])*(b[1]-a[1])}function within(p,q,r){return p<=q&&q<=r||r<=q&&q<=p}function noop$2(){}var cases=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function contours(){var dx=1,dy=1,threshold=thresholdSturges,smooth=smoothLinear;function contours(values){var tz=threshold(values);if(!Array.isArray(tz)){var domain=extent$2(values),start=domain[0],stop=domain[1];tz=tickStep$1(start,stop,tz);tz=range(Math.floor(start/tz)*tz,Math.floor(stop/tz)*tz,tz)}else{tz=tz.slice().sort(ascending$2)}return tz.map(function(value){return contour(values,value)})}function contour(values,value){var polygons=[],holes=[];isorings(values,value,function(ring){smooth(ring,values,value);if(area$2(ring)>0)polygons.push([ring]);else holes.push(ring)});holes.forEach(function(hole){for(var i=0,n=polygons.length,polygon;i<n;++i){if(contains((polygon=polygons[i])[0],hole)!==-1){polygon.push(hole);return}}});return{type:"MultiPolygon",value:value,coordinates:polygons}}function isorings(values,value,callback){var fragmentByStart=new Array,fragmentByEnd=new Array,x,y,t0,t1,t2,t3;x=y=-1;t1=values[0]>=value;cases[t1<<1].forEach(stitch);while(++x<dx-1){t0=t1,t1=values[x+1]>=value;cases[t0|t1<<1].forEach(stitch)}cases[t1<<0].forEach(stitch);while(++y<dy-1){x=-1;t1=values[y*dx+dx]>=value;t2=values[y*dx]>=value;cases[t1<<1|t2<<2].forEach(stitch);while(++x<dx-1){t0=t1,t1=values[y*dx+dx+x+1]>=value;t3=t2,t2=values[y*dx+x+1]>=value;cases[t0|t1<<1|t2<<2|t3<<3].forEach(stitch)}cases[t1|t2<<3].forEach(stitch)}x=-1;t2=values[y*dx]>=value;cases[t2<<2].forEach(stitch);while(++x<dx-1){t3=t2,t2=values[y*dx+x+1]>=value;cases[t2<<2|t3<<3].forEach(stitch)}cases[t2<<3].forEach(stitch);function stitch(line){var start=[line[0][0]+x,line[0][1]+y],end=[line[1][0]+x,line[1][1]+y],startIndex=index(start),endIndex=index(end),f,g;if(f=fragmentByEnd[startIndex]){if(g=fragmentByStart[endIndex]){delete fragmentByEnd[f.end];delete fragmentByStart[g.start];if(f===g){f.ring.push(end);callback(f.ring)}else{fragmentByStart[f.start]=fragmentByEnd[g.end]={start:f.start,end:g.end,ring:f.ring.concat(g.ring)}}}else{delete fragmentByEnd[f.end];f.ring.push(end);fragmentByEnd[f.end=endIndex]=f}}else if(f=fragmentByStart[endIndex]){if(g=fragmentByEnd[startIndex]){delete fragmentByStart[f.start];delete fragmentByEnd[g.end];if(f===g){f.ring.push(end);callback(f.ring)}else{fragmentByStart[g.start]=fragmentByEnd[f.end]={start:g.start,end:f.end,ring:g.ring.concat(f.ring)}}}else{delete fragmentByStart[f.start];f.ring.unshift(start);fragmentByStart[f.start=startIndex]=f}}else{fragmentByStart[startIndex]=fragmentByEnd[endIndex]={start:startIndex,end:endIndex,ring:[start,end]}}}}function index(point){return point[0]*2+point[1]*(dx+1)*4}function smoothLinear(ring,values,value){ring.forEach(function(point){var x=point[0],y=point[1],xt=x|0,yt=y|0,v0,v1=values[yt*dx+xt];if(x>0&&x<dx&&xt===x){v0=values[yt*dx+xt-1];point[0]=x+(value-v0)/(v1-v0)-.5}if(y>0&&y<dy&&yt===y){v0=values[(yt-1)*dx+xt];point[1]=y+(value-v0)/(v1-v0)-.5}})}contours.contour=contour;contours.size=function(_){if(!arguments.length)return[dx,dy];var _0=Math.ceil(_[0]),_1=Math.ceil(_[1]);if(!(_0>0)||!(_1>0))throw new Error("invalid size");return dx=_0,dy=_1,contours};contours.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?constant$5(slice$1.call(_)):constant$5(_),contours):threshold};contours.smooth=function(_){return arguments.length?(smooth=_?smoothLinear:noop$2,contours):smooth===smoothLinear};return contours}function blurX(source,target,r){var n=source.width,m=source.height,w=(r<<1)+1;for(var j=0;j<m;++j){for(var i=0,sr=0;i<n+r;++i){if(i<n){sr+=source.data[i+j*n]}if(i>=r){if(i>=w){sr-=source.data[i-w+j*n]}target.data[i-r+j*n]=sr/Math.min(i+1,n-1+w-i,w)}}}}function blurY(source,target,r){var n=source.width,m=source.height,w=(r<<1)+1;for(var i=0;i<n;++i){for(var j=0,sr=0;j<m+r;++j){if(j<m){sr+=source.data[i+j*n]}if(j>=r){if(j>=w){sr-=source.data[i+(j-w)*n]}target.data[i+(j-r)*n]=sr/Math.min(j+1,m-1+w-j,w)}}}}function defaultX(d){return d[0]}function defaultY(d){return d[1]}function defaultWeight(){return 1}function contourDensity(){var x=defaultX,y=defaultY,weight=defaultWeight,dx=960,dy=500,r=20,k=2,o=r*3,n=dx+o*2>>k,m=dy+o*2>>k,threshold=constant$5(20);function density(data){var values0=new Float32Array(n*m),values1=new Float32Array(n*m);data.forEach(function(d,i,data){var xi=+x(d,i,data)+o>>k,yi=+y(d,i,data)+o>>k,wi=+weight(d,i,data);if(xi>=0&&xi<n&&yi>=0&&yi<m){values0[xi+yi*n]+=wi}});blurX({width:n,height:m,data:values0},{width:n,height:m,data:values1},r>>k);blurY({width:n,height:m,data:values1},{width:n,height:m,data:values0},r>>k);blurX({width:n,height:m,data:values0},{width:n,height:m,data:values1},r>>k);blurY({width:n,height:m,data:values1},{width:n,height:m,data:values0},r>>k);blurX({width:n,height:m,data:values0},{width:n,height:m,data:values1},r>>k);blurY({width:n,height:m,data:values1},{width:n,height:m,data:values0},r>>k);var tz=threshold(values0);if(!Array.isArray(tz)){var stop=max$3(values0);tz=tickStep$1(0,stop,tz);tz=range(0,Math.floor(stop/tz)*tz,tz);tz.shift()}return contours().thresholds(tz).size([n,m])(values0).map(transform)}function transform(geometry){geometry.value*=Math.pow(2,-2*k);geometry.coordinates.forEach(transformPolygon);return geometry}function transformPolygon(coordinates){coordinates.forEach(transformRing)}function transformRing(coordinates){coordinates.forEach(transformPoint)}function transformPoint(coordinates){coordinates[0]=coordinates[0]*Math.pow(2,k)-o;coordinates[1]=coordinates[1]*Math.pow(2,k)-o}function resize(){o=r*3;n=dx+o*2>>k;m=dy+o*2>>k;return density}density.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$5(+_),density):x};density.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$5(+_),density):y};density.weight=function(_){return arguments.length?(weight=typeof _==="function"?_:constant$5(+_),density):weight};density.size=function(_){if(!arguments.length)return[dx,dy];var _0=Math.ceil(_[0]),_1=Math.ceil(_[1]);if(!(_0>=0)&&!(_0>=0))throw new Error("invalid size");return dx=_0,dy=_1,resize()};density.cellSize=function(_){if(!arguments.length)return 1<<k;if(!((_=+_)>=1))throw new Error("invalid cell size");return k=Math.floor(Math.log(_)/Math.LN2),resize()};density.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?constant$5(slice$1.call(_)):constant$5(_),density):threshold};density.bandwidth=function(_){if(!arguments.length)return Math.sqrt(r*(r+1));if(!((_=+_)>=0))throw new Error("invalid bandwidth");return r=Math.round((Math.sqrt(4*_*_+1)-1)/2),resize()};return density}var CONTOUR_PARAMS=["size","smooth"];var DENSITY_PARAMS=["x","y","weight","size","cellSize","bandwidth"];function Contour(params){Transform.call(this,null,params)}Contour.Definition={type:"Contour",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"values",type:"number",array:true},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"smooth",type:"boolean"},{name:"nice",type:"boolean",default:false},{name:"thresholds",type:"number",array:true}]};var prototype$$=inherits(Contour,Transform);prototype$$.transform=function(_,pulse){if(this.value&&!pulse.changed()&&!_.modified())return pulse.StopPropagation;var out=pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS),count=_.count||10,contour,params,values;if(_.values){contour=contours();params=CONTOUR_PARAMS;values=_.values}else{contour=contourDensity();params=DENSITY_PARAMS;values=pulse.materialize(pulse.SOURCE).source}contour.thresholds(_.thresholds||(_.nice?count:quantize$2(count)));params.forEach(function(param){if(_[param]!=null)contour[param](_[param])});if(this.value)out.rem=this.value;values=values&&values.length?contour(values).map(ingest):[];this.value=out.source=out.add=values;return out};function quantize$2(k){return function(values){var ex=extent$1(values),x0=ex[0],dx=ex[1]-x0,t=[],i=1;for(;i<=k;++i)t.push(x0+dx*i/(k+1));return t}}var Feature="Feature";var FeatureCollection="FeatureCollection";var MultiPoint="MultiPoint";function GeoJSON(params){Transform.call(this,null,params)}GeoJSON.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:true,length:2},{name:"geojson",type:"field"}]};var prototype$10=inherits(GeoJSON,Transform);prototype$10.transform=function(_,pulse){var features=this._features,points=this._points,fields=_.fields,lon=fields&&fields[0],lat=fields&&fields[1],geojson=_.geojson,flag=pulse.ADD,mod;mod=_.modified()||pulse.changed(pulse.REM)||pulse.modified(accessorFields(geojson))||lon&&pulse.modified(accessorFields(lon))||lat&&pulse.modified(accessorFields(lat));if(!this.value||mod){flag=pulse.SOURCE;this._features=features=[];this._points=points=[]}if(geojson){pulse.visit(flag,function(t){features.push(geojson(t))})}if(lon&&lat){pulse.visit(flag,function(t){var x=lon(t),y=lat(t);if(x!=null&&y!=null&&(x=+x)===x&&(y=+y)===y){points.push([x,y])}});features=features.concat({type:Feature,geometry:{type:MultiPoint,coordinates:points}})}this.value={type:FeatureCollection,features:features}};function adder(){return new Adder}function Adder(){this.reset()}Adder.prototype={constructor:Adder,reset:function(){this.s=this.t=0},add:function(y){add$2(temp$1,y,this.t);add$2(this,temp$1.s,this.s);if(this.s)this.t+=temp$1.t;else this.s=temp$1.t},valueOf:function(){return this.s}};var temp$1=new Adder;function add$2(adder,a,b){var x=adder.s=a+b,bv=x-a,av=x-bv;adder.t=a-av+(b-bv)}var epsilon$2=1e-6;var epsilon2$1=1e-12;var pi$2=Math.PI;var halfPi$1=pi$2/2;var quarterPi=pi$2/4;var tau$2=pi$2*2;var degrees$1=180/pi$2;var radians=pi$2/180;var abs$1=Math.abs;var atan=Math.atan;var atan2$1=Math.atan2;var cos$1=Math.cos;var ceil=Math.ceil;var exp$1=Math.exp;var log$3=Math.log;var pow$2=Math.pow;var sin$1=Math.sin;var sign$1=Math.sign||function(x){return x>0?1:x<0?-1:0};var sqrt$2=Math.sqrt;var tan=Math.tan;function acos$1(x){return x>1?0:x<-1?pi$2:Math.acos(x)}function asin$1(x){return x>1?halfPi$1:x<-1?-halfPi$1:Math.asin(x)}function noop$3(){}function streamGeometry(geometry,stream){if(geometry&&streamGeometryType.hasOwnProperty(geometry.type)){streamGeometryType[geometry.type](geometry,stream)}}var streamObjectType={Feature:function(object,stream){streamGeometry(object.geometry,stream)},FeatureCollection:function(object,stream){var features=object.features,i=-1,n=features.length;while(++i<n)streamGeometry(features[i].geometry,stream)}};var streamGeometryType={Sphere:function(object,stream){stream.sphere()},Point:function(object,stream){object=object.coordinates;stream.point(object[0],object[1],object[2])},MultiPoint:function(object,stream){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],stream.point(object[0],object[1],object[2])},LineString:function(object,stream){streamLine(object.coordinates,stream,0)},MultiLineString:function(object,stream){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)streamLine(coordinates[i],stream,0)},Polygon:function(object,stream){streamPolygon(object.coordinates,stream)},MultiPolygon:function(object,stream){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)streamPolygon(coordinates[i],stream)},GeometryCollection:function(object,stream){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)streamGeometry(geometries[i],stream)}};function streamLine(coordinates,stream,closed){var i=-1,n=coordinates.length-closed,coordinate;stream.lineStart();while(++i<n)coordinate=coordinates[i],stream.point(coordinate[0],coordinate[1],coordinate[2]);stream.lineEnd()}function streamPolygon(coordinates,stream){var i=-1,n=coordinates.length;stream.polygonStart();while(++i<n)streamLine(coordinates[i],stream,1);stream.polygonEnd()}function geoStream(object,stream){if(object&&streamObjectType.hasOwnProperty(object.type)){streamObjectType[object.type](object,stream)}else{streamGeometry(object,stream)}}var areaRingSum=adder();var areaSum=adder(),lambda00,phi00,lambda0,cosPhi0,sinPhi0;var areaStream={point:noop$3,lineStart:noop$3,lineEnd:noop$3,polygonStart:function(){areaRingSum.reset();areaStream.lineStart=areaRingStart;areaStream.lineEnd=areaRingEnd},polygonEnd:function(){var areaRing=+areaRingSum;areaSum.add(areaRing<0?tau$2+areaRing:areaRing);this.lineStart=this.lineEnd=this.point=noop$3},sphere:function(){areaSum.add(tau$2)}};function areaRingStart(){areaStream.point=areaPointFirst}function areaRingEnd(){areaPoint(lambda00,phi00)}function areaPointFirst(lambda,phi){areaStream.point=areaPoint;lambda00=lambda,phi00=phi;lambda*=radians,phi*=radians;lambda0=lambda,cosPhi0=cos$1(phi=phi/2+quarterPi),sinPhi0=sin$1(phi)}function areaPoint(lambda,phi){lambda*=radians,phi*=radians;phi=phi/2+quarterPi;var dLambda=lambda-lambda0,sdLambda=dLambda>=0?1:-1,adLambda=sdLambda*dLambda,cosPhi=cos$1(phi),sinPhi=sin$1(phi),k=sinPhi0*sinPhi,u=cosPhi0*cosPhi+k*cos$1(adLambda),v=k*sdLambda*sin$1(adLambda);areaRingSum.add(atan2$1(v,u));lambda0=lambda,cosPhi0=cosPhi,sinPhi0=sinPhi}function area$3(object){areaSum.reset();geoStream(object,areaStream);return areaSum*2}function spherical(cartesian){return[atan2$1(cartesian[1],cartesian[0]),asin$1(cartesian[2])]}function cartesian(spherical){var lambda=spherical[0],phi=spherical[1],cosPhi=cos$1(phi);return[cosPhi*cos$1(lambda),cosPhi*sin$1(lambda),sin$1(phi)]}function cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function cartesianAddInPlace(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function cartesianNormalizeInPlace(d){var l=sqrt$2(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}var lambda0$1,phi0,lambda1,phi1,lambda2,lambda00$1,phi00$1,p0,deltaSum=adder(),ranges,range$1;var boundsStream={point:boundsPoint,lineStart:boundsLineStart,lineEnd:boundsLineEnd,polygonStart:function(){boundsStream.point=boundsRingPoint;boundsStream.lineStart=boundsRingStart;boundsStream.lineEnd=boundsRingEnd;deltaSum.reset();areaStream.polygonStart()},polygonEnd:function(){areaStream.polygonEnd();boundsStream.point=boundsPoint;boundsStream.lineStart=boundsLineStart;boundsStream.lineEnd=boundsLineEnd;if(areaRingSum<0)lambda0$1=-(lambda1=180),phi0=-(phi1=90);else if(deltaSum>epsilon$2)phi1=90;else if(deltaSum<-epsilon$2)phi0=-90;range$1[0]=lambda0$1,range$1[1]=lambda1}};function boundsPoint(lambda,phi){ranges.push(range$1=[lambda0$1=lambda,lambda1=lambda]);if(phi<phi0)phi0=phi;if(phi>phi1)phi1=phi}function linePoint(lambda,phi){var p=cartesian([lambda*radians,phi*radians]);if(p0){var normal=cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=cartesianCross(equatorial,normal);cartesianNormalizeInPlace(inflection);inflection=spherical(inflection);var delta=lambda-lambda2,sign=delta>0?1:-1,lambdai=inflection[0]*degrees$1*sign,phii,antimeridian=abs$1(delta)>180;if(antimeridian^(sign*lambda2<lambdai&&lambdai<sign*lambda)){phii=inflection[1]*degrees$1;if(phii>phi1)phi1=phii}else if(lambdai=(lambdai+360)%360-180,antimeridian^(sign*lambda2<lambdai&&lambdai<sign*lambda)){phii=-inflection[1]*degrees$1;if(phii<phi0)phi0=phii}else{if(phi<phi0)phi0=phi;if(phi>phi1)phi1=phi}if(antimeridian){if(lambda<lambda2){if(angle(lambda0$1,lambda)>angle(lambda0$1,lambda1))lambda1=lambda}else{if(angle(lambda,lambda1)>angle(lambda0$1,lambda1))lambda0$1=lambda}}else{if(lambda1>=lambda0$1){if(lambda<lambda0$1)lambda0$1=lambda;if(lambda>lambda1)lambda1=lambda}else{if(lambda>lambda2){if(angle(lambda0$1,lambda)>angle(lambda0$1,lambda1))lambda1=lambda}else{if(angle(lambda,lambda1)>angle(lambda0$1,lambda1))lambda0$1=lambda}}}}else{ranges.push(range$1=[lambda0$1=lambda,lambda1=lambda])}if(phi<phi0)phi0=phi;if(phi>phi1)phi1=phi;p0=p,lambda2=lambda}function boundsLineStart(){boundsStream.point=linePoint}function boundsLineEnd(){range$1[0]=lambda0$1,range$1[1]=lambda1;boundsStream.point=boundsPoint;p0=null}function boundsRingPoint(lambda,phi){if(p0){var delta=lambda-lambda2;deltaSum.add(abs$1(delta)>180?delta+(delta>0?360:-360):delta)}else{lambda00$1=lambda,phi00$1=phi}areaStream.point(lambda,phi);linePoint(lambda,phi)}function boundsRingStart(){areaStream.lineStart()}function boundsRingEnd(){boundsRingPoint(lambda00$1,phi00$1);areaStream.lineEnd();if(abs$1(deltaSum)>epsilon$2)lambda0$1=-(lambda1=180);range$1[0]=lambda0$1,range$1[1]=lambda1;p0=null}function angle(lambda0,lambda1){return(lambda1-=lambda0)<0?lambda1+360:lambda1}function rangeCompare(a,b){return a[0]-b[0]}function rangeContains(range,x){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}function bounds$1(feature){var i,n,a,b,merged,deltaMax,delta;phi1=lambda1=-(lambda0$1=phi0=Infinity);ranges=[];geoStream(feature,boundsStream);if(n=ranges.length){ranges.sort(rangeCompare);for(i=1,a=ranges[0],merged=[a];i<n;++i){b=ranges[i];if(rangeContains(a,b[0])||rangeContains(a,b[1])){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0]}else{merged.push(a=b)}}for(deltaMax=-Infinity,n=merged.length-1,i=0,a=merged[n];i<=n;a=b,++i){b=merged[i];if((delta=angle(a[1],b[0]))>deltaMax)deltaMax=delta,lambda0$1=b[0],lambda1=a[1]}}ranges=range$1=null;return lambda0$1===Infinity||phi0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[lambda0$1,phi0],[lambda1,phi1]]}var W0,W1,X0,Y0,Z0,X1,Y1,Z1,X2,Y2,Z2,lambda00$2,phi00$2,x0,y0,z0;var centroidStream={sphere:noop$3,point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart;centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.lineStart=centroidLineStart;centroidStream.lineEnd=centroidLineEnd}};function centroidPoint(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos$1(phi);centroidPointCartesian(cosPhi*cos$1(lambda),cosPhi*sin$1(lambda),sin$1(phi))}function centroidPointCartesian(x,y,z){++W0;X0+=(x-X0)/W0;Y0+=(y-Y0)/W0;Z0+=(z-Z0)/W0}function centroidLineStart(){centroidStream.point=centroidLinePointFirst}function centroidLinePointFirst(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos$1(phi);x0=cosPhi*cos$1(lambda);y0=cosPhi*sin$1(lambda);z0=sin$1(phi);centroidStream.point=centroidLinePoint;centroidPointCartesian(x0,y0,z0)}function centroidLinePoint(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos$1(phi),x=cosPhi*cos$1(lambda),y=cosPhi*sin$1(lambda),z=sin$1(phi),w=atan2$1(sqrt$2((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);W1+=w;X1+=w*(x0+(x0=x));Y1+=w*(y0+(y0=y));Z1+=w*(z0+(z0=z));centroidPointCartesian(x0,y0,z0)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidRingPointFirst}function centroidRingEnd(){centroidRingPoint(lambda00$2,phi00$2);centroidStream.point=centroidPoint}function centroidRingPointFirst(lambda,phi){lambda00$2=lambda,phi00$2=phi;lambda*=radians,phi*=radians;centroidStream.point=centroidRingPoint;var cosPhi=cos$1(phi);x0=cosPhi*cos$1(lambda);y0=cosPhi*sin$1(lambda);z0=sin$1(phi);centroidPointCartesian(x0,y0,z0)}function centroidRingPoint(lambda,phi){lambda*=radians,phi*=radians;var cosPhi=cos$1(phi),x=cosPhi*cos$1(lambda),y=cosPhi*sin$1(lambda),z=sin$1(phi),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=sqrt$2(cx*cx+cy*cy+cz*cz),w=asin$1(m),v=m&&-w/m;X2+=v*cx;Y2+=v*cy;Z2+=v*cz;W1+=w;X1+=w*(x0+(x0=x));Y1+=w*(y0+(y0=y));Z1+=w*(z0+(z0=z));centroidPointCartesian(x0,y0,z0)}function centroid(object){W0=W1=X0=Y0=Z0=X1=Y1=Z1=X2=Y2=Z2=0;geoStream(object,centroidStream);var x=X2,y=Y2,z=Z2,m=x*x+y*y+z*z;if(m<epsilon2$1){x=X1,y=Y1,z=Z1;if(W1<epsilon$2)x=X0,y=Y0,z=Z0;m=x*x+y*y+z*z;if(m<epsilon2$1)return[NaN,NaN]}return[atan2$1(y,x)*degrees$1,asin$1(z/sqrt$2(m))*degrees$1]}function compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1])};return compose}function rotationIdentity(lambda,phi){return[abs$1(lambda)>pi$2?lambda+Math.round(-lambda/tau$2)*tau$2:lambda,phi]}rotationIdentity.invert=rotationIdentity;function rotateRadians(deltaLambda,deltaPhi,deltaGamma){return(deltaLambda%=tau$2)?deltaPhi||deltaGamma?compose(rotationLambda(deltaLambda),rotationPhiGamma(deltaPhi,deltaGamma)):rotationLambda(deltaLambda):deltaPhi||deltaGamma?rotationPhiGamma(deltaPhi,deltaGamma):rotationIdentity}function forwardRotationLambda(deltaLambda){return function(lambda,phi){return lambda+=deltaLambda,[lambda>pi$2?lambda-tau$2:lambda<-pi$2?lambda+tau$2:lambda,phi]}}function rotationLambda(deltaLambda){var rotation=forwardRotationLambda(deltaLambda);rotation.invert=forwardRotationLambda(-deltaLambda);return rotation}function rotationPhiGamma(deltaPhi,deltaGamma){var cosDeltaPhi=cos$1(deltaPhi),sinDeltaPhi=sin$1(deltaPhi),cosDeltaGamma=cos$1(deltaGamma),sinDeltaGamma=sin$1(deltaGamma);function rotation(lambda,phi){var cosPhi=cos$1(phi),x=cos$1(lambda)*cosPhi,y=sin$1(lambda)*cosPhi,z=sin$1(phi),k=z*cosDeltaPhi+x*sinDeltaPhi;return[atan2$1(y*cosDeltaGamma-k*sinDeltaGamma,x*cosDeltaPhi-z*sinDeltaPhi),asin$1(k*cosDeltaGamma+y*sinDeltaGamma)]}rotation.invert=function(lambda,phi){var cosPhi=cos$1(phi),x=cos$1(lambda)*cosPhi,y=sin$1(lambda)*cosPhi,z=sin$1(phi),k=z*cosDeltaGamma-y*sinDeltaGamma;return[atan2$1(y*cosDeltaGamma+z*sinDeltaGamma,x*cosDeltaPhi+k*sinDeltaPhi),asin$1(k*cosDeltaPhi-x*sinDeltaPhi)]};return rotation}function rotation(rotate){rotate=rotateRadians(rotate[0]*radians,rotate[1]*radians,rotate.length>2?rotate[2]*radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*radians,coordinates[1]*radians);return coordinates[0]*=degrees$1,coordinates[1]*=degrees$1,coordinates}forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*radians,coordinates[1]*radians);return coordinates[0]*=degrees$1,coordinates[1]*=degrees$1,coordinates};return forward}function circleStream(stream,radius,delta,direction,t0,t1){if(!delta)return;var cosRadius=cos$1(radius),sinRadius=sin$1(radius),step=direction*delta;if(t0==null){t0=radius+direction*tau$2;t1=radius-step/2}else{t0=circleRadius(cosRadius,t0);t1=circleRadius(cosRadius,t1);if(direction>0?t0<t1:t0>t1)t0+=direction*tau$2}for(var point,t=t0;direction>0?t>t1:t<t1;t-=step){point=spherical([cosRadius,-sinRadius*cos$1(t),-sinRadius*sin$1(t)]);stream.point(point[0],point[1])}}function circleRadius(cosRadius,point){point=cartesian(point),point[0]-=cosRadius;cartesianNormalizeInPlace(point);var radius=acos$1(-point[1]);return((-point[2]<0?-radius:radius)+tau$2-epsilon$2)%tau$2}function clipBuffer(){var lines=[],line;return{point:function(x,y){line.push([x,y])},lineStart:function(){lines.push(line=[])},lineEnd:noop$3,rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()))},result:function(){var result=lines;lines=[];line=null;return result}}}function pointEqual(a,b){return abs$1(a[0]-b[0])<epsilon$2&&abs$1(a[1]-b[1])<epsilon$2}function Intersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null}function clipRejoin(segments,compareIntersection,startInside,interpolate,stream){var subject=[],clip=[],i,n;segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n],x;if(pointEqual(p0,p1)){stream.lineStart();for(i=0;i<n;++i)stream.point((p0=segment[i])[0],p0[1]);stream.lineEnd();return}subject.push(x=new Intersection(p0,segment,null,true));clip.push(x.o=new Intersection(p0,null,x,false));subject.push(x=new Intersection(p1,segment,null,false));clip.push(x.o=new Intersection(p1,null,x,true))});if(!subject.length)return;clip.sort(compareIntersection);link(subject);link(clip);for(i=0,n=clip.length;i<n;++i){clip[i].e=startInside=!startInside}var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;stream.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(i=0,n=points.length;i<n;++i)stream.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.n.x,1,stream)}current=current.n}else{if(isSubject){points=current.p.z;for(i=points.length-1;i>=0;--i)stream.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.p.x,-1,stream)}current=current.p}current=current.o;points=current.z;isSubject=!isSubject}while(!current.v);stream.lineEnd()}}function link(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b}a.n=b=array[0];b.p=a}var sum$1=adder();function polygonContains(polygon,point){var lambda=point[0],phi=point[1],sinPhi=sin$1(phi),normal=[sin$1(lambda),-cos$1(lambda),0],angle=0,winding=0;sum$1.reset();if(sinPhi===1)phi=halfPi$1+epsilon$2;else if(sinPhi===-1)phi=-halfPi$1-epsilon$2;for(var i=0,n=polygon.length;i<n;++i){if(!(m=(ring=polygon[i]).length))continue;var ring,m,point0=ring[m-1],lambda0=point0[0],phi0=point0[1]/2+quarterPi,sinPhi0=sin$1(phi0),cosPhi0=cos$1(phi0);for(var j=0;j<m;++j,lambda0=lambda1,sinPhi0=sinPhi1,cosPhi0=cosPhi1,point0=point1){var point1=ring[j],lambda1=point1[0],phi1=point1[1]/2+quarterPi,sinPhi1=sin$1(phi1),cosPhi1=cos$1(phi1),delta=lambda1-lambda0,sign=delta>=0?1:-1,absDelta=sign*delta,antimeridian=absDelta>pi$2,k=sinPhi0*sinPhi1;sum$1.add(atan2$1(k*sign*sin$1(absDelta),cosPhi0*cosPhi1+k*cos$1(absDelta)));angle+=antimeridian?delta+sign*tau$2:delta;if(antimeridian^lambda0>=lambda^lambda1>=lambda){var arc=cartesianCross(cartesian(point0),cartesian(point1));cartesianNormalizeInPlace(arc);var intersection=cartesianCross(normal,arc);cartesianNormalizeInPlace(intersection);var phiArc=(antimeridian^delta>=0?-1:1)*asin$1(intersection[2]);if(phi>phiArc||phi===phiArc&&(arc[0]||arc[1])){winding+=antimeridian^delta>=0?1:-1}}}}return(angle<-epsilon$2||angle<epsilon$2&&sum$1<-epsilon$2)^winding&1}function ascending$3(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector$2(compare){if(compare.length===1)compare=ascendingComparator$2(compare);return{left:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}}function ascendingComparator$2(f){return function(d,x){return ascending$3(f(d),x)}}var ascendingBisect$2=bisector$2(ascending$3);function range$2(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range}function merge$1(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged}function clip$2(pointVisible,clipLine,interpolate,start){return function(sink){var line=clipLine(sink),ringBuffer=clipBuffer(),ringSink=clipLine(ringBuffer),polygonStarted=false,polygon,segments,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[]},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=merge$1(segments);var startInside=polygonContains(polygon,start);if(segments.length){if(!polygonStarted)sink.polygonStart(),polygonStarted=true;clipRejoin(segments,compareIntersection,startInside,interpolate,sink)}else if(startInside){if(!polygonStarted)sink.polygonStart(),polygonStarted=true;sink.lineStart();interpolate(null,null,1,sink);sink.lineEnd()}if(polygonStarted)sink.polygonEnd(),polygonStarted=false;segments=polygon=null},sphere:function(){sink.polygonStart();sink.lineStart();interpolate(null,null,1,sink);sink.lineEnd();sink.polygonEnd()}};function point(lambda,phi){if(pointVisible(lambda,phi))sink.point(lambda,phi)}function pointLine(lambda,phi){line.point(lambda,phi)}function lineStart(){clip.point=pointLine;line.lineStart()}function lineEnd(){clip.point=point;line.lineEnd()}function pointRing(lambda,phi){ring.push([lambda,phi]);ringSink.point(lambda,phi)}function ringStart(){ringSink.lineStart();ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringSink.lineEnd();var clean=ringSink.clean(),ringSegments=ringBuffer.result(),i,n=ringSegments.length,m,segment,point;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];if((m=segment.length-1)>0){if(!polygonStarted)sink.polygonStart(),polygonStarted=true;sink.lineStart();for(i=0;i<m;++i)sink.point((point=segment[i])[0],point[1]);sink.lineEnd()}return}if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(validSegment))}return clip}}function validSegment(segment){return segment.length>1}function compareIntersection(a,b){return((a=a.x)[0]<0?a[1]-halfPi$1-epsilon$2:halfPi$1-a[1])-((b=b.x)[0]<0?b[1]-halfPi$1-epsilon$2:halfPi$1-b[1])}var clipAntimeridian=clip$2(function(){return true},clipAntimeridianLine,clipAntimeridianInterpolate,[-pi$2,-halfPi$1]);function clipAntimeridianLine(stream){var lambda0=NaN,phi0=NaN,sign0=NaN,clean;return{lineStart:function(){stream.lineStart();clean=1},point:function(lambda1,phi1){var sign1=lambda1>0?pi$2:-pi$2,delta=abs$1(lambda1-lambda0);if(abs$1(delta-pi$2)<epsilon$2){stream.point(lambda0,phi0=(phi0+phi1)/2>0?halfPi$1:-halfPi$1);stream.point(sign0,phi0);stream.lineEnd();stream.lineStart();stream.point(sign1,phi0);stream.point(lambda1,phi0);clean=0}else if(sign0!==sign1&&delta>=pi$2){if(abs$1(lambda0-sign0)<epsilon$2)lambda0-=sign0*epsilon$2;if(abs$1(lambda1-sign1)<epsilon$2)lambda1-=sign1*epsilon$2;phi0=clipAntimeridianIntersect(lambda0,phi0,lambda1,phi1);stream.point(sign0,phi0);stream.lineEnd();stream.lineStart();stream.point(sign1,phi0);clean=0}stream.point(lambda0=lambda1,phi0=phi1);sign0=sign1},lineEnd:function(){stream.lineEnd();lambda0=phi0=NaN},clean:function(){return 2-clean}}}function clipAntimeridianIntersect(lambda0,phi0,lambda1,phi1){var cosPhi0,cosPhi1,sinLambda0Lambda1=sin$1(lambda0-lambda1);return abs$1(sinLambda0Lambda1)>epsilon$2?atan((sin$1(phi0)*(cosPhi1=cos$1(phi1))*sin$1(lambda1)-sin$1(phi1)*(cosPhi0=cos$1(phi0))*sin$1(lambda0))/(cosPhi0*cosPhi1*sinLambda0Lambda1)):(phi0+phi1)/2}function clipAntimeridianInterpolate(from,to,direction,stream){var phi;if(from==null){phi=direction*halfPi$1;stream.point(-pi$2,phi);stream.point(0,phi);stream.point(pi$2,phi);stream.point(pi$2,0);stream.point(pi$2,-phi);stream.point(0,-phi);stream.point(-pi$2,-phi);stream.point(-pi$2,0);stream.point(-pi$2,phi)}else if(abs$1(from[0]-to[0])>epsilon$2){var lambda=from[0]<to[0]?pi$2:-pi$2;phi=direction*lambda/2;stream.point(-lambda,phi);stream.point(0,phi);stream.point(lambda,phi)}else{stream.point(to[0],to[1])}}function clipCircle(radius){var cr=cos$1(radius),delta=6*radians,smallRadius=cr>0,notHemisphere=abs$1(cr)>epsilon$2;function interpolate(from,to,direction,stream){circleStream(stream,radius,delta,direction,from,to)}function visible(lambda,phi){return cos$1(lambda)*cos$1(phi)>cr}function clipLine(stream){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1},point:function(lambda,phi){var point1=[lambda,phi],point2,v=visible(lambda,phi),c=smallRadius?v?0:code(lambda,phi):v?code(lambda+(lambda<0?pi$2:-pi$2),phi):0;if(!point0&&(v00=v0=v))stream.lineStart();if(v!==v0){point2=intersect(point0,point1);if(!point2||pointEqual(point0,point2)||pointEqual(point1,point2)){point1[0]+=epsilon$2;point1[1]+=epsilon$2;v=visible(point1[0],point1[1])}}if(v!==v0){clean=0;if(v){stream.lineStart();point2=intersect(point1,point0);stream.point(point2[0],point2[1])}else{point2=intersect(point0,point1);stream.point(point2[0],point2[1]);stream.lineEnd()}point0=point2}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){stream.lineStart();stream.point(t[0][0],t[0][1]);stream.point(t[1][0],t[1][1]);stream.lineEnd()}else{stream.point(t[1][0],t[1][1]);stream.lineEnd();stream.lineStart();stream.point(t[0][0],t[0][1])}}}if(v&&(!point0||!pointEqual(point0,point1))){stream.point(point1[0],point1[1])}point0=point1,v0=v,c0=c},lineEnd:function(){if(v0)stream.lineEnd();point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=cartesian(a),pb=cartesian(b);var n1=[1,0,0],n2=cartesianCross(pa,pb),n2n2=cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=cartesianCross(n1,n2),A=cartesianScale(n1,c1),B=cartesianScale(n2,c2);cartesianAddInPlace(A,B);var u=n1xn2,w=cartesianDot(A,u),uu=cartesianDot(u,u),t2=w*w-uu*(cartesianDot(A,A)-1);if(t2<0)return;var t=sqrt$2(t2),q=cartesianScale(u,(-w-t)/uu);cartesianAddInPlace(q,A);q=spherical(q);if(!two)return q;var lambda0=a[0],lambda1=b[0],phi0=a[1],phi1=b[1],z;if(lambda1<lambda0)z=lambda0,lambda0=lambda1,lambda1=z;var delta=lambda1-lambda0,polar=abs$1(delta-pi$2)<epsilon$2,meridian=polar||delta<epsilon$2;if(!polar&&phi1<phi0)z=phi0,phi0=phi1,phi1=z;if(meridian?polar?phi0+phi1>0^q[1]<(abs$1(q[0]-lambda0)<epsilon$2?phi0:phi1):phi0<=q[1]&&q[1]<=phi1:delta>pi$2^(lambda0<=q[0]&&q[0]<=lambda1)){var q1=cartesianScale(u,(-w+t)/uu);cartesianAddInPlace(q1,A);return[q,spherical(q1)]}}function code(lambda,phi){var r=smallRadius?radius:pi$2-radius,code=0;if(lambda<-r)code|=1;else if(lambda>r)code|=2;if(phi<-r)code|=4;else if(phi>r)code|=8;return code}return clip$2(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-pi$2,radius-pi$2])}function clipLine(a,b,x0,y0,x1,y1){var ax=a[0],ay=a[1],bx=b[0],by=b[1],t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(t0>0)a[0]=ax+t0*dx,a[1]=ay+t0*dy;if(t1<1)b[0]=ax+t1*dx,b[1]=ay+t1*dy;return true}var clipMax=1e9,clipMin=-clipMax;function clipRectangle(x0,y0,x1,y1){function visible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function interpolate(from,to,direction,stream){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoint(from,to)<0^direction>0){do{stream.point(a===0||a===3?x0:x1,a>1?y1:y0)}while((a=(a+direction+4)%4)!==a1)}else{stream.point(to[0],to[1])}}function corner(p,direction){return abs$1(p[0]-x0)<epsilon$2?direction>0?0:3:abs$1(p[0]-x1)<epsilon$2?direction>0?2:1:abs$1(p[1]-y0)<epsilon$2?direction>0?1:0:direction>0?3:2}function compareIntersection(a,b){return comparePoint(a.x,b.x)}function comparePoint(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0]}return function(stream){var activeStream=stream,bufferStream=clipBuffer(),segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean;var clipStream={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:polygonStart,polygonEnd:polygonEnd};function point(x,y){if(visible(x,y))activeStream.point(x,y)}function polygonInside(){var winding=0;for(var i=0,n=polygon.length;i<n;++i){for(var ring=polygon[i],j=1,m=ring.length,point=ring[0],a0,a1,b0=point[0],b1=point[1];j<m;++j){a0=b0,a1=b1,point=ring[j],b0=point[0],b1=point[1];if(a1<=y1){if(b1>y1&&(b0-a0)*(y1-a1)>(b1-a1)*(x0-a0))++winding}else{if(b1<=y1&&(b0-a0)*(y1-a1)<(b1-a1)*(x0-a0))--winding}}}return winding}function polygonStart(){activeStream=bufferStream,segments=[],polygon=[],clean=true}function polygonEnd(){var startInside=polygonInside(),cleanInside=clean&&startInside,visible=(segments=merge$1(segments)).length;if(cleanInside||visible){stream.polygonStart();if(cleanInside){stream.lineStart();interpolate(null,null,1,stream);stream.lineEnd()}if(visible){clipRejoin(segments,compareIntersection,startInside,interpolate,stream)}stream.polygonEnd()}activeStream=stream,segments=polygon=ring=null}function lineStart(){clipStream.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN}function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferStream.rejoin();segments.push(bufferStream.result())}clipStream.point=point;if(v_)activeStream.lineEnd()}function linePoint(x,y){var v=visible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){activeStream.lineStart();activeStream.point(x,y)}}else{if(v&&v_)activeStream.point(x,y);else{var a=[x_=Math.max(clipMin,Math.min(clipMax,x_)),y_=Math.max(clipMin,Math.min(clipMax,y_))],b=[x=Math.max(clipMin,Math.min(clipMax,x)),y=Math.max(clipMin,Math.min(clipMax,y))];if(clipLine(a,b,x0,y0,x1,y1)){if(!v_){activeStream.lineStart();activeStream.point(a[0],a[1])}activeStream.point(b[0],b[1]);if(!v)activeStream.lineEnd();clean=false}else if(v){activeStream.lineStart();activeStream.point(x,y);clean=false}}}x_=x,y_=y,v_=v}return clipStream}}var lengthSum=adder();function graticuleX(y0,y1,dy){var y=range$2(y0,y1-epsilon$2,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function graticuleY(x0,x1,dx){var x=range$2(x0,x1-epsilon$2,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function graticule(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return range$2(ceil(X0/DX)*DX,X1,DX).map(X).concat(range$2(ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(range$2(ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs$1(x%DX)>epsilon$2}).map(x)).concat(range$2(ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs$1(y%DY)>epsilon$2}).map(y))}graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}};graticule.extent=function(_){if(!arguments.length)return graticule.extentMinor();return graticule.extentMajor(_).extentMinor(_)};graticule.extentMajor=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision)};graticule.extentMinor=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision)};graticule.step=function(_){if(!arguments.length)return graticule.stepMinor();return graticule.stepMajor(_).stepMinor(_)};graticule.stepMajor=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule};graticule.stepMinor=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=graticuleX(y0,y1,90);y=graticuleY(x0,x1,precision);X=graticuleX(Y0,Y1,90);Y=graticuleY(X0,X1,precision);return graticule};return graticule.extentMajor([[-180,-90+epsilon$2],[180,90-epsilon$2]]).extentMinor([[-180,-80-epsilon$2],[180,80+epsilon$2]])}function identity$6(x){return x}var areaSum$1=adder(),areaRingSum$1=adder(),x00,y00,x0$1,y0$1;var areaStream$1={point:noop$3,lineStart:noop$3,lineEnd:noop$3,polygonStart:function(){areaStream$1.lineStart=areaRingStart$1;areaStream$1.lineEnd=areaRingEnd$1},polygonEnd:function(){areaStream$1.lineStart=areaStream$1.lineEnd=areaStream$1.point=noop$3;areaSum$1.add(abs$1(areaRingSum$1));areaRingSum$1.reset()},result:function(){var area=areaSum$1/2;areaSum$1.reset();return area}};function areaRingStart$1(){areaStream$1.point=areaPointFirst$1}function areaPointFirst$1(x,y){areaStream$1.point=areaPoint$1;x00=x0$1=x,y00=y0$1=y}function areaPoint$1(x,y){areaRingSum$1.add(y0$1*x-x0$1*y);x0$1=x,y0$1=y}function areaRingEnd$1(){areaPoint$1(x00,y00)}var x0$2=Infinity,y0$2=x0$2,x1=-x0$2,y1=x1;var boundsStream$1={point:boundsPoint$1,lineStart:noop$3,lineEnd:noop$3,polygonStart:noop$3,polygonEnd:noop$3,result:function(){var bounds=[[x0$2,y0$2],[x1,y1]];x1=y1=-(y0$2=x0$2=Infinity);return bounds}};function boundsPoint$1(x,y){if(x<x0$2)x0$2=x;if(x>x1)x1=x;if(y<y0$2)y0$2=y;if(y>y1)y1=y}var X0$1=0,Y0$1=0,Z0$1=0,X1$1=0,Y1$1=0,Z1$1=0,X2$1=0,Y2$1=0,Z2$1=0,x00$1,y00$1,x0$3,y0$3;var centroidStream$1={point:centroidPoint$1,lineStart:centroidLineStart$1,lineEnd:centroidLineEnd$1,polygonStart:function(){centroidStream$1.lineStart=centroidRingStart$1;centroidStream$1.lineEnd=centroidRingEnd$1},polygonEnd:function(){centroidStream$1.point=centroidPoint$1;centroidStream$1.lineStart=centroidLineStart$1;centroidStream$1.lineEnd=centroidLineEnd$1},result:function(){var centroid=Z2$1?[X2$1/Z2$1,Y2$1/Z2$1]:Z1$1?[X1$1/Z1$1,Y1$1/Z1$1]:Z0$1?[X0$1/Z0$1,Y0$1/Z0$1]:[NaN,NaN];X0$1=Y0$1=Z0$1=X1$1=Y1$1=Z1$1=X2$1=Y2$1=Z2$1=0;return centroid}};function centroidPoint$1(x,y){X0$1+=x;Y0$1+=y;++Z0$1}function centroidLineStart$1(){centroidStream$1.point=centroidPointFirstLine}function centroidPointFirstLine(x,y){centroidStream$1.point=centroidPointLine;centroidPoint$1(x0$3=x,y0$3=y)}function centroidPointLine(x,y){var dx=x-x0$3,dy=y-y0$3,z=sqrt$2(dx*dx+dy*dy);X1$1+=z*(x0$3+x)/2;Y1$1+=z*(y0$3+y)/2;Z1$1+=z;centroidPoint$1(x0$3=x,y0$3=y)}function centroidLineEnd$1(){centroidStream$1.point=centroidPoint$1}function centroidRingStart$1(){centroidStream$1.point=centroidPointFirstRing}function centroidRingEnd$1(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(x,y){centroidStream$1.point=centroidPointRing;centroidPoint$1(x00$1=x0$3=x,y00$1=y0$3=y)}function centroidPointRing(x,y){var dx=x-x0$3,dy=y-y0$3,z=sqrt$2(dx*dx+dy*dy);X1$1+=z*(x0$3+x)/2;Y1$1+=z*(y0$3+y)/2;Z1$1+=z;z=y0$3*x-x0$3*y;X2$1+=z*(x0$3+x);Y2$1+=z*(y0$3+y);Z2$1+=z*3;centroidPoint$1(x0$3=x,y0$3=y)}function PathContext(context){this._context=context}PathContext.prototype={_radius:4.5,pointRadius:function(_){return this._radius=_,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._context.closePath();this._point=NaN},point:function(x,y){switch(this._point){case 0:{this._context.moveTo(x,y);this._point=1;break}case 1:{this._context.lineTo(x,y);break}default:{this._context.moveTo(x+this._radius,y);this._context.arc(x,y,this._radius,0,tau$2);break}}},result:noop$3};var lengthSum$1=adder(),lengthRing,x00$2,y00$2,x0$4,y0$4;var lengthStream={point:noop$3,lineStart:function(){lengthStream.point=lengthPointFirst},lineEnd:function(){if(lengthRing)lengthPoint(x00$2,y00$2);lengthStream.point=noop$3},polygonStart:function(){lengthRing=true},polygonEnd:function(){lengthRing=null},result:function(){var length=+lengthSum$1;lengthSum$1.reset();return length}};function lengthPointFirst(x,y){lengthStream.point=lengthPoint;x00$2=x0$4=x,y00$2=y0$4=y}function lengthPoint(x,y){x0$4-=x,y0$4-=y;lengthSum$1.add(sqrt$2(x0$4*x0$4+y0$4*y0$4));x0$4=x,y0$4=y}function PathString(){this._string=[]}PathString.prototype={_radius:4.5,_circle:circle$1(4.5),pointRadius:function(_){if((_=+_)!==this._radius)this._radius=_,this._circle=null;return this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._string.push("Z");this._point=NaN},point:function(x,y){switch(this._point){case 0:{this._string.push("M",x,",",y);this._point=1;break}case 1:{this._string.push("L",x,",",y);break}default:{if(this._circle==null)this._circle=circle$1(this._radius);this._string.push("M",x,",",y,this._circle);break}}},result:function(){if(this._string.length){var result=this._string.join("");this._string=[];return result}else{return null}}};function circle$1(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}function geoPath(projection,context){var pointRadius=4.5,projectionStream,contextStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));geoStream(object,projectionStream(contextStream))}return contextStream.result()}path.area=function(object){geoStream(object,projectionStream(areaStream$1));return areaStream$1.result()};path.measure=function(object){geoStream(object,projectionStream(lengthStream));return lengthStream.result()};path.bounds=function(object){geoStream(object,projectionStream(boundsStream$1));return boundsStream$1.result()};path.centroid=function(object){geoStream(object,projectionStream(centroidStream$1));return centroidStream$1.result()};path.projection=function(_){return arguments.length?(projectionStream=_==null?(projection=null,identity$6):(projection=_).stream,path):projection};path.context=function(_){if(!arguments.length)return context;contextStream=_==null?(context=null,new PathString):new PathContext(context=_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return path};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path};return path.projection(projection).context(context)}function transformer$3(methods){return function(stream){var s=new TransformStream;for(var key in methods)s[key]=methods[key];s.stream=stream;return s}}function TransformStream(){}TransformStream.prototype={constructor:TransformStream,point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function fit(projection,fitBounds,object){var clip=projection.clipExtent&&projection.clipExtent();projection.scale(150).translate([0,0]);if(clip!=null)projection.clipExtent(null);geoStream(object,projection.stream(boundsStream$1));fitBounds(boundsStream$1.result());if(clip!=null)projection.clipExtent(clip);return projection}function fitExtent(projection,extent,object){return fit(projection,function(b){var w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],k=Math.min(w/(b[1][0]-b[0][0]),h/(b[1][1]-b[0][1])),x=+extent[0][0]+(w-k*(b[1][0]+b[0][0]))/2,y=+extent[0][1]+(h-k*(b[1][1]+b[0][1]))/2;projection.scale(150*k).translate([x,y])},object)}function fitSize(projection,size,object){return fitExtent(projection,[[0,0],size],object)}function fitWidth(projection,width,object){return fit(projection,function(b){var w=+width,k=w/(b[1][0]-b[0][0]),x=(w-k*(b[1][0]+b[0][0]))/2,y=-k*b[0][1];projection.scale(150*k).translate([x,y])},object)}function fitHeight(projection,height,object){return fit(projection,function(b){var h=+height,k=h/(b[1][1]-b[0][1]),x=-k*b[0][0],y=(h-k*(b[1][1]+b[0][1]))/2;projection.scale(150*k).translate([x,y])},object)}var maxDepth=16,cosMinDistance=cos$1(30*radians);function resample(project,delta2){return+delta2?resample$1(project,delta2):resampleNone(project)}function resampleNone(project){return transformer$3({point:function(x,y){x=project(x,y);this.stream.point(x[0],x[1])}})}function resample$1(project,delta2){function resampleLineTo(x0,y0,lambda0,a0,b0,c0,x1,y1,lambda1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*delta2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=sqrt$2(a*a+b*b+c*c),phi2=asin$1(c/=m),lambda2=abs$1(abs$1(c)-1)<epsilon$2||abs$1(lambda0-lambda1)<epsilon$2?(lambda0+lambda1)/2:atan2$1(b,a),p=project(lambda2,phi2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>delta2||abs$1((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,lambda0,a0,b0,c0,x2,y2,lambda2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,lambda2,a,b,c,x1,y1,lambda1,a1,b1,c1,depth,stream)}}}return function(stream){var lambda00,x00,y00,a00,b00,c00,lambda0,x0,y0,a0,b0,c0;var resampleStream={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resampleStream.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd();resampleStream.lineStart=lineStart}};function point(x,y){x=project(x,y);stream.point(x[0],x[1])}function lineStart(){x0=NaN;resampleStream.point=linePoint;stream.lineStart()}function linePoint(lambda,phi){var c=cartesian([lambda,phi]),p=project(lambda,phi);resampleLineTo(x0,y0,lambda0,a0,b0,c0,x0=p[0],y0=p[1],lambda0=lambda,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0)}function lineEnd(){resampleStream.point=point;stream.lineEnd()}function ringStart(){lineStart();resampleStream.point=ringPoint;resampleStream.lineEnd=ringEnd}function ringPoint(lambda,phi){linePoint(lambda00=lambda,phi),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resampleStream.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,lambda0,a0,b0,c0,x00,y00,lambda00,a00,b00,c00,maxDepth,stream);resampleStream.lineEnd=lineEnd;lineEnd()}return resampleStream}}var transformRadians=transformer$3({point:function(x,y){this.stream.point(x*radians,y*radians)}});function transformRotate(rotate){return transformer$3({point:function(x,y){var r=rotate(x,y);return this.stream.point(r[0],r[1])}})}function scaleTranslate(k,dx,dy){function transform(x,y){return[dx+k*x,dy-k*y]}transform.invert=function(x,y){return[(x-dx)/k,(dy-y)/k]};return transform}function scaleTranslateRotate(k,dx,dy,alpha){var cosAlpha=cos$1(alpha),sinAlpha=sin$1(alpha),a=cosAlpha*k,b=sinAlpha*k,ai=cosAlpha/k,bi=sinAlpha/k,ci=(sinAlpha*dy-cosAlpha*dx)/k,fi=(sinAlpha*dx+cosAlpha*dy)/k;function transform(x,y){return[a*x-b*y+dx,dy-b*x-a*y]}transform.invert=function(x,y){return[ai*x-bi*y+ci,fi-bi*x-ai*y]};return transform}function projection(project){return projectionMutator(function(){return project})()}function projectionMutator(projectAt){var project,k=150,x=480,y=250,lambda=0,phi=0,deltaLambda=0,deltaPhi=0,deltaGamma=0,rotate,alpha=0,theta=null,preclip=clipAntimeridian,x0=null,y0,x1,y1,postclip=identity$6,delta2=.5,projectResample,projectTransform,projectRotateTransform,cache,cacheStream;function projection(point){return projectRotateTransform(point[0]*radians,point[1]*radians)}function invert(point){point=projectRotateTransform.invert(point[0],point[1]);return point&&[point[0]*degrees$1,point[1]*degrees$1]}projection.stream=function(stream){return cache&&cacheStream===stream?cache:cache=transformRadians(transformRotate(rotate)(preclip(projectResample(postclip(cacheStream=stream)))))};projection.preclip=function(_){return arguments.length?(preclip=_,theta=undefined,reset()):preclip};projection.postclip=function(_){return arguments.length?(postclip=_,x0=y0=x1=y1=null,reset()):postclip};projection.clipAngle=function(_){return arguments.length?(preclip=+_?clipCircle(theta=_*radians):(theta=null,clipAntimeridian),reset()):theta*degrees$1};projection.clipExtent=function(_){return arguments.length?(postclip=_==null?(x0=y0=x1=y1=null,identity$6):clipRectangle(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):x0==null?null:[[x0,y0],[x1,y1]]};projection.scale=function(_){return arguments.length?(k=+_,recenter()):k};projection.translate=function(_){return arguments.length?(x=+_[0],y=+_[1],recenter()):[x,y]};projection.center=function(_){return arguments.length?(lambda=_[0]%360*radians,phi=_[1]%360*radians,recenter()):[lambda*degrees$1,phi*degrees$1]};projection.rotate=function(_){return arguments.length?(deltaLambda=_[0]%360*radians,deltaPhi=_[1]%360*radians,deltaGamma=_.length>2?_[2]%360*radians:0,recenter()):[deltaLambda*degrees$1,deltaPhi*degrees$1,deltaGamma*degrees$1]};projection.angle=function(_){return arguments.length?(alpha=_%360*radians,recenter()):alpha*degrees$1};projection.precision=function(_){return arguments.length?(projectResample=resample(projectTransform,delta2=_*_),reset()):sqrt$2(delta2)};projection.fitExtent=function(extent,object){return fitExtent(projection,extent,object)};projection.fitSize=function(size,object){return fitSize(projection,size,object)};projection.fitWidth=function(width,object){return fitWidth(projection,width,object)};projection.fitHeight=function(height,object){return fitHeight(projection,height,object)};function recenter(){var center=scaleTranslateRotate(k,0,0,alpha).apply(null,project(lambda,phi)),transform=(alpha?scaleTranslateRotate:scaleTranslate)(k,x-center[0],y-center[1],alpha);rotate=rotateRadians(deltaLambda,deltaPhi,deltaGamma);projectTransform=compose(project,transform);projectRotateTransform=compose(rotate,projectTransform);projectResample=resample(projectTransform,delta2);return reset()}function reset(){cache=cacheStream=null;return projection}return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return recenter()}}function conicProjection(projectAt){var phi0=0,phi1=pi$2/3,m=projectionMutator(projectAt),p=m(phi0,phi1);p.parallels=function(_){return arguments.length?m(phi0=_[0]*radians,phi1=_[1]*radians):[phi0*degrees$1,phi1*degrees$1]};return p}function cylindricalEqualAreaRaw(phi0){var cosPhi0=cos$1(phi0);function forward(lambda,phi){return[lambda*cosPhi0,sin$1(phi)/cosPhi0]}forward.invert=function(x,y){return[x/cosPhi0,asin$1(y*cosPhi0)]};return forward}function conicEqualAreaRaw(y0,y1){var sy0=sin$1(y0),n=(sy0+sin$1(y1))/2;if(abs$1(n)<epsilon$2)return cylindricalEqualAreaRaw(y0);var c=1+sy0*(2*n-sy0),r0=sqrt$2(c)/n;function project(x,y){var r=sqrt$2(c-2*n*sin$1(y))/n;return[r*sin$1(x*=n),r0-r*cos$1(x)]}project.invert=function(x,y){var r0y=r0-y;return[atan2$1(x,abs$1(r0y))/n*sign$1(r0y),asin$1((c-(x*x+r0y*r0y)*n*n)/(2*n))]};return project}function geoConicEqualArea(){return conicProjection(conicEqualAreaRaw).scale(155.424).center([0,33.6442])}function geoAlbers(){return geoConicEqualArea().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function multiplex(streams){var n=streams.length;return{point:function(x,y){var i=-1;while(++i<n)streams[i].point(x,y)},sphere:function(){var i=-1;while(++i<n)streams[i].sphere()},lineStart:function(){var i=-1;while(++i<n)streams[i].lineStart()},lineEnd:function(){var i=-1;while(++i<n)streams[i].lineEnd()},polygonStart:function(){var i=-1;while(++i<n)streams[i].polygonStart()},polygonEnd:function(){var i=-1;while(++i<n)streams[i].polygonEnd()}}}function geoAlbersUsa(){var cache,cacheStream,lower48=geoAlbers(),lower48Point,alaska=geoConicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),alaskaPoint,hawaii=geoConicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),hawaiiPoint,point,pointStream={point:function(x,y){point=[x,y]}};function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];return point=null,(lower48Point.point(x,y),point)||(alaskaPoint.point(x,y),point)||(hawaiiPoint.point(x,y),point)}albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)};albersUsa.stream=function(stream){return cache&&cacheStream===stream?cache:cache=multiplex([lower48.stream(cacheStream=stream),alaska.stream(stream),hawaii.stream(stream)])};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_),alaska.precision(_),hawaii.precision(_);return reset()};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_),alaska.scale(_*.35),hawaii.scale(_);return albersUsa.translate(lower48.translate())};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream);alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+epsilon$2,y+.12*k+epsilon$2],[x-.214*k-epsilon$2,y+.234*k-epsilon$2]]).stream(pointStream);hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+epsilon$2,y+.166*k+epsilon$2],[x-.115*k-epsilon$2,y+.234*k-epsilon$2]]).stream(pointStream);return reset()};albersUsa.fitExtent=function(extent,object){return fitExtent(albersUsa,extent,object)};albersUsa.fitSize=function(size,object){return fitSize(albersUsa,size,object)};albersUsa.fitWidth=function(width,object){return fitWidth(albersUsa,width,object)};albersUsa.fitHeight=function(height,object){return fitHeight(albersUsa,height,object)};function reset(){cache=cacheStream=null;return albersUsa}return albersUsa.scale(1070)}function azimuthalRaw(scale){return function(x,y){var cx=cos$1(x),cy=cos$1(y),k=scale(cx*cy);return[k*cy*sin$1(x),k*sin$1(y)]}}function azimuthalInvert(angle){return function(x,y){var z=sqrt$2(x*x+y*y),c=angle(z),sc=sin$1(c),cc=cos$1(c);return[atan2$1(x*sc,z*cc),asin$1(z&&y*sc/z)]}}var azimuthalEqualAreaRaw=azimuthalRaw(function(cxcy){return sqrt$2(2/(1+cxcy))});azimuthalEqualAreaRaw.invert=azimuthalInvert(function(z){return 2*asin$1(z/2)});function geoAzimuthalEqualArea(){return projection(azimuthalEqualAreaRaw).scale(124.75).clipAngle(180-.001)}var azimuthalEquidistantRaw=azimuthalRaw(function(c){return(c=acos$1(c))&&c/sin$1(c)});azimuthalEquidistantRaw.invert=azimuthalInvert(function(z){return z});function geoAzimuthalEquidistant(){return projection(azimuthalEquidistantRaw).scale(79.4188).clipAngle(180-.001)}function mercatorRaw(lambda,phi){return[lambda,log$3(tan((halfPi$1+phi)/2))]}mercatorRaw.invert=function(x,y){return[x,2*atan(exp$1(y))-halfPi$1]};function geoMercator(){return mercatorProjection(mercatorRaw).scale(961/tau$2)}function mercatorProjection(project){var m=projection(project),center=m.center,scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,x0=null,y0,x1,y1;m.scale=function(_){return arguments.length?(scale(_),reclip()):scale()};m.translate=function(_){return arguments.length?(translate(_),reclip()):translate()};m.center=function(_){return arguments.length?(center(_),reclip()):center()};m.clipExtent=function(_){return arguments.length?(_==null?x0=y0=x1=y1=null:(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reclip()):x0==null?null:[[x0,y0],[x1,y1]]};function reclip(){var k=pi$2*scale(),t=m(rotation(m.rotate()).invert([0,0]));return clipExtent(x0==null?[[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]:project===mercatorRaw?[[Math.max(t[0]-k,x0),y0],[Math.min(t[0]+k,x1),y1]]:[[x0,Math.max(t[1]-k,y0)],[x1,Math.min(t[1]+k,y1)]])}return reclip()}function tany(y){return tan((halfPi$1+y)/2)}function conicConformalRaw(y0,y1){var cy0=cos$1(y0),n=y0===y1?sin$1(y0):log$3(cy0/cos$1(y1))/log$3(tany(y1)/tany(y0)),f=cy0*pow$2(tany(y0),n)/n;if(!n)return mercatorRaw;function project(x,y){if(f>0){if(y<-halfPi$1+epsilon$2)y=-halfPi$1+epsilon$2}else{if(y>halfPi$1-epsilon$2)y=halfPi$1-epsilon$2}var r=f/pow$2(tany(y),n);return[r*sin$1(n*x),f-r*cos$1(n*x)]}project.invert=function(x,y){var fy=f-y,r=sign$1(n)*sqrt$2(x*x+fy*fy);return[atan2$1(x,abs$1(fy))/n*sign$1(fy),2*atan(pow$2(f/r,1/n))-halfPi$1]};return project}function geoConicConformal(){return conicProjection(conicConformalRaw).scale(109.5).parallels([30,30])}function equirectangularRaw(lambda,phi){return[lambda,phi]}equirectangularRaw.invert=equirectangularRaw;function geoEquirectangular(){return projection(equirectangularRaw).scale(152.63)}function conicEquidistantRaw(y0,y1){var cy0=cos$1(y0),n=y0===y1?sin$1(y0):(cy0-cos$1(y1))/(y1-y0),g=cy0/n+y0;if(abs$1(n)<epsilon$2)return equirectangularRaw;function project(x,y){var gy=g-y,nx=n*x;return[gy*sin$1(nx),g-gy*cos$1(nx)]}project.invert=function(x,y){var gy=g-y;return[atan2$1(x,abs$1(gy))/n*sign$1(gy),g-sign$1(n)*sqrt$2(x*x+gy*gy)]};return project}function geoConicEquidistant(){return conicProjection(conicEquidistantRaw).scale(131.154).center([0,13.9389])}function gnomonicRaw(x,y){var cy=cos$1(y),k=cos$1(x)*cy;return[cy*sin$1(x)/k,sin$1(y)/k]}gnomonicRaw.invert=azimuthalInvert(atan);function geoGnomonic(){return projection(gnomonicRaw).scale(144.049).clipAngle(60)}function scaleTranslate$1(kx,ky,tx,ty){return kx===1&&ky===1&&tx===0&&ty===0?identity$6:transformer$3({point:function(x,y){this.stream.point(x*kx+tx,y*ky+ty)}})}function geoIdentity(){var k=1,tx=0,ty=0,sx=1,sy=1,transform=identity$6,x0=null,y0,x1,y1,postclip=identity$6,cache,cacheStream,projection;function reset(){cache=cacheStream=null;return projection}return projection={stream:function(stream){return cache&&cacheStream===stream?cache:cache=transform(postclip(cacheStream=stream))},postclip:function(_){return arguments.length?(postclip=_,x0=y0=x1=y1=null,reset()):postclip},clipExtent:function(_){return arguments.length?(postclip=_==null?(x0=y0=x1=y1=null,identity$6):clipRectangle(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):x0==null?null:[[x0,y0],[x1,y1]]},scale:function(_){return arguments.length?(transform=scaleTranslate$1((k=+_)*sx,k*sy,tx,ty),reset()):k},translate:function(_){return arguments.length?(transform=scaleTranslate$1(k*sx,k*sy,tx=+_[0],ty=+_[1]),reset()):[tx,ty]},reflectX:function(_){return arguments.length?(transform=scaleTranslate$1(k*(sx=_?-1:1),k*sy,tx,ty),reset()):sx<0},reflectY:function(_){return arguments.length?(transform=scaleTranslate$1(k*sx,k*(sy=_?-1:1),tx,ty),reset()):sy<0},fitExtent:function(extent,object){return fitExtent(projection,extent,object)},fitSize:function(size,object){return fitSize(projection,size,object)},fitWidth:function(width,object){return fitWidth(projection,width,object)},fitHeight:function(height,object){return fitHeight(projection,height,object)}}}function naturalEarth1Raw(lambda,phi){var phi2=phi*phi,phi4=phi2*phi2;return[lambda*(.8707-.131979*phi2+phi4*(-.013791+phi4*(.003971*phi2-.001529*phi4))),phi*(1.007226+phi2*(.015085+phi4*(-.044475+.028874*phi2-.005916*phi4)))]}naturalEarth1Raw.invert=function(x,y){var phi=y,i=25,delta;do{var phi2=phi*phi,phi4=phi2*phi2;phi-=delta=(phi*(1.007226+phi2*(.015085+phi4*(-.044475+.028874*phi2-.005916*phi4)))-y)/(1.007226+phi2*(.015085*3+phi4*(-.044475*7+.028874*9*phi2-.005916*11*phi4)))}while(abs$1(delta)>epsilon$2&&--i>0);return[x/(.8707+(phi2=phi*phi)*(-.131979+phi2*(-.013791+phi2*phi2*phi2*(.003971-.001529*phi2)))),phi]};function geoNaturalEarth1(){return projection(naturalEarth1Raw).scale(175.295)}function orthographicRaw(x,y){return[cos$1(y)*sin$1(x),sin$1(y)]}orthographicRaw.invert=azimuthalInvert(asin$1);function geoOrthographic(){return projection(orthographicRaw).scale(249.5).clipAngle(90+epsilon$2)}function stereographicRaw(x,y){var cy=cos$1(y),k=1+cos$1(x)*cy;return[cy*sin$1(x)/k,sin$1(y)/k]}stereographicRaw.invert=azimuthalInvert(function(z){return 2*atan(z)});function geoStereographic(){return projection(stereographicRaw).scale(250).clipAngle(142)}function transverseMercatorRaw(lambda,phi){return[log$3(tan((halfPi$1+phi)/2)),-lambda]}transverseMercatorRaw.invert=function(x,y){return[-y,2*atan(exp$1(x))-halfPi$1]};function geoTransverseMercator(){var m=mercatorProjection(transverseMercatorRaw),center=m.center,rotate=m.rotate;m.center=function(_){return arguments.length?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]])};m.rotate=function(_){return arguments.length?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90])};return rotate([0,0,90]).scale(159.155)}var defaultPath=geoPath();var projectionProperties=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function create$1(type,constructor){return function projection(){var p=constructor();p.type=type;p.path=geoPath().projection(p);p.copy=p.copy||function(){var c=projection();projectionProperties.forEach(function(prop){if(p.hasOwnProperty(prop))c[prop](p[prop]())});c.path.pointRadius(p.path.pointRadius());return c};return p}}function projection$1(type,proj){if(!type||typeof type!=="string"){throw new Error("Projection type must be a name string.")}type=type.toLowerCase();if(arguments.length>1){projections[type]=create$1(type,proj);return this}else{return projections.hasOwnProperty(type)?projections[type]:null}}function getProjectionPath(proj){return proj&&proj.path||defaultPath}var projections={albers:geoAlbers,albersusa:geoAlbersUsa,azimuthalequalarea:geoAzimuthalEqualArea,azimuthalequidistant:geoAzimuthalEquidistant,conicconformal:geoConicConformal,conicequalarea:geoConicEqualArea,conicequidistant:geoConicEquidistant,equirectangular:geoEquirectangular,gnomonic:geoGnomonic,identity:geoIdentity,mercator:geoMercator,naturalEarth1:geoNaturalEarth1,orthographic:geoOrthographic,stereographic:geoStereographic,transversemercator:geoTransverseMercator};for(var key$2 in projections){projection$1(key$2,projections[key$2])}function GeoPath(params){Transform.call(this,null,params)}GeoPath.Definition={type:"GeoPath",metadata:{modifies:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"path"}]};var prototype$11=inherits(GeoPath,Transform);prototype$11.transform=function(_,pulse){var out=pulse.fork(pulse.ALL),path=this.value,field=_.field||identity,as=_.as||"path",flag=out.SOURCE;function set(t){t[as]=path(field(t))}if(!path||_.modified()){this.value=path=getProjectionPath(_.projection);out.materialize().reflow()}else{flag=field===identity||pulse.modified(field.fields)?out.ADD_MOD:out.ADD}var prev=initPath(path,_.pointRadius);out.visit(flag,set);path.pointRadius(prev);return out.modifies(as)};function initPath(path,pointRadius){var prev=path.pointRadius();path.context(null);if(pointRadius!=null){path.pointRadius(pointRadius)}return prev}function GeoPoint(params){Transform.call(this,null,params)}GeoPoint.Definition={type:"GeoPoint",metadata:{modifies:true},params:[{name:"projection",type:"projection",required:true},{name:"fields",type:"field",array:true,required:true,length:2},{name:"as",type:"string",array:true,length:2,default:["x","y"]}]};var prototype$12=inherits(GeoPoint,Transform);prototype$12.transform=function(_,pulse){var proj=_.projection,lon=_.fields[0],lat=_.fields[1],as=_.as||["x","y"],x=as[0],y=as[1],mod;function set(t){var xy=proj([lon(t),lat(t)]);if(xy){t[x]=xy[0];t[y]=xy[1]}else{t[x]=undefined;t[y]=undefined}}if(_.modified()){pulse=pulse.materialize().reflow(true).visit(pulse.SOURCE,set)}else{mod=pulse.modified(lon.fields)||pulse.modified(lat.fields);pulse.visit(mod?pulse.ADD_MOD:pulse.ADD,set)}return pulse.modifies(as)};function GeoShape(params){Transform.call(this,null,params)}GeoShape.Definition={type:"GeoShape",metadata:{modifies:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"shape"}]};var prototype$13=inherits(GeoShape,Transform);prototype$13.transform=function(_,pulse){var out=pulse.fork(pulse.ALL),shape=this.value,datum=_.field||field("datum"),as=_.as||"shape",flag=out.ADD_MOD;if(!shape||_.modified()){this.value=shape=shapeGenerator(getProjectionPath(_.projection),datum,_.pointRadius);out.materialize().reflow();flag=out.SOURCE}out.visit(flag,function(t){t[as]=shape});return out.modifies(as)};function shapeGenerator(path,field,pointRadius){var shape=pointRadius==null?function(_){return path(field(_))}:function(_){var prev=path.pointRadius(),value=path.pointRadius(pointRadius)(field(_));path.pointRadius(prev);return value};shape.context=function(_){path.context(_);return shape};return shape}function Graticule(params){Transform.call(this,[],params);this.generator=graticule()}Graticule.Definition={type:"Graticule",metadata:{changes:true},params:[{name:"extent",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMajor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMinor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"step",type:"number",array:true,length:2},{name:"stepMajor",type:"number",array:true,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:true,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var prototype$14=inherits(Graticule,Transform);prototype$14.transform=function(_,pulse){var src=this.value,gen=this.generator,t;if(!src.length||_.modified()){for(var prop in _){if(isFunction(gen[prop])){gen[prop](_[prop])}}}t=gen();if(src.length){pulse.mod.push(replace(src[0],t))}else{pulse.add.push(ingest(t))}src[0]=t;return pulse};function Projection(params){Transform.call(this,null,params);this.modified(true)}var prototype$15=inherits(Projection,Transform);prototype$15.transform=function(_,pulse){var proj=this.value;if(!proj||_.modified("type")){this.value=proj=create$2(_.type);projectionProperties.forEach(function(prop){if(_[prop]!=null)set$1(proj,prop,_[prop])})}else{projectionProperties.forEach(function(prop){if(_.modified(prop))set$1(proj,prop,_[prop])})}if(_.pointRadius!=null)proj.path.pointRadius(_.pointRadius);if(_.fit)fit$1(proj,_);return pulse.fork(pulse.NO_SOURCE|pulse.NO_FIELDS)};function fit$1(proj,_){var data=collectGeoJSON(_.fit);_.extent?proj.fitExtent(_.extent,data):_.size?proj.fitSize(_.size,data):0}function create$2(type){var constructor=projection$1((type||"mercator").toLowerCase());if(!constructor)error("Unrecognized projection type: "+type);return constructor()}function set$1(proj,key,value){if(isFunction(proj[key]))proj[key](value)}function collectGeoJSON(data){data=array(data);return data.length===1?data[0]:{type:FeatureCollection,features:data.reduce((a,f)=>a.concat(featurize(f)),[])}}function featurize(f){return f.type===FeatureCollection?f.features:array(f).map(d=>d.type===Feature?d:{type:Feature,geometry:d})}var geo=Object.freeze({contour:Contour,geojson:GeoJSON,geopath:GeoPath,geopoint:GeoPoint,geoshape:GeoShape,graticule:Graticule,projection:Projection});function forceCenter(x,y){var nodes;if(x==null)x=0;if(y==null)y=0;function force(){var i,n=nodes.length,node,sx=0,sy=0;for(i=0;i<n;++i){node=nodes[i],sx+=node.x,sy+=node.y}for(sx=sx/n-x,sy=sy/n-y,i=0;i<n;++i){node=nodes[i],node.x-=sx,node.y-=sy}}force.initialize=function(_){nodes=_};force.x=function(_){return arguments.length?(x=+_,force):x};force.y=function(_){return arguments.length?(y=+_,force):y};return force}function tree_add(d){var x=+this._x.call(null,d),y=+this._y.call(null,d);return add$3(this.cover(x,y),x,y,d)}function add$3(tree,x,y,d){if(isNaN(x)||isNaN(y))return tree;var parent,node=tree._root,leaf={data:d},x0=tree._x0,y0=tree._y0,x1=tree._x1,y1=tree._y1,xm,ym,xp,yp,right,bottom,i,j;if(!node)return tree._root=leaf,tree;while(node.length){if(right=x>=(xm=(x0+x1)/2))x0=xm;else x1=xm;if(bottom=y>=(ym=(y0+y1)/2))y0=ym;else y1=ym;if(parent=node,!(node=node[i=bottom<<1|right]))return parent[i]=leaf,tree}xp=+tree._x.call(null,node.data);yp=+tree._y.call(null,node.data);if(x===xp&&y===yp)return leaf.next=node,parent?parent[i]=leaf:tree._root=leaf,tree;do{parent=parent?parent[i]=new Array(4):tree._root=new Array(4);if(right=x>=(xm=(x0+x1)/2))x0=xm;else x1=xm;if(bottom=y>=(ym=(y0+y1)/2))y0=ym;else y1=ym}while((i=bottom<<1|right)===(j=(yp>=ym)<<1|xp>=xm));return parent[j]=node,parent[i]=leaf,tree}function addAll(data){var d,i,n=data.length,x,y,xz=new Array(n),yz=new Array(n),x0=Infinity,y0=Infinity,x1=-Infinity,y1=-Infinity;for(i=0;i<n;++i){if(isNaN(x=+this._x.call(null,d=data[i]))||isNaN(y=+this._y.call(null,d)))continue;xz[i]=x;yz[i]=y;if(x<x0)x0=x;if(x>x1)x1=x;if(y<y0)y0=y;if(y>y1)y1=y}if(x0>x1||y0>y1)return this;this.cover(x0,y0).cover(x1,y1);for(i=0;i<n;++i){add$3(this,xz[i],yz[i],data[i])}return this}function tree_cover(x,y){if(isNaN(x=+x)||isNaN(y=+y))return this;var x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(isNaN(x0)){x1=(x0=Math.floor(x))+1;y1=(y0=Math.floor(y))+1}else{var z=x1-x0,node=this._root,parent,i;while(x0>x||x>=x1||y0>y||y>=y1){i=(y<y0)<<1|x<x0;parent=new Array(4),parent[i]=node,node=parent,z*=2;switch(i){case 0:x1=x0+z,y1=y0+z;break;case 1:x0=x1-z,y1=y0+z;break;case 2:x1=x0+z,y0=y1-z;break;case 3:x0=x1-z,y0=y1-z;break}}if(this._root&&this._root.length)this._root=node}this._x0=x0;this._y0=y0;this._x1=x1;this._y1=y1;return this}function tree_data(){var data=[];this.visit(function(node){if(!node.length)do{data.push(node.data)}while(node=node.next)});return data}function tree_extent(_){return arguments.length?this.cover(+_[0][0],+_[0][1]).cover(+_[1][0],+_[1][1]):isNaN(this._x0)?undefined:[[this._x0,this._y0],[this._x1,this._y1]]}function Quad(node,x0,y0,x1,y1){this.node=node;this.x0=x0;this.y0=y0;this.x1=x1;this.y1=y1}function tree_find(x,y,radius){var data,x0=this._x0,y0=this._y0,x1,y1,x2,y2,x3=this._x1,y3=this._y1,quads=[],node=this._root,q,i;if(node)quads.push(new Quad(node,x0,y0,x3,y3));if(radius==null)radius=Infinity;else{x0=x-radius,y0=y-radius;x3=x+radius,y3=y+radius;radius*=radius}while(q=quads.pop()){if(!(node=q.node)||(x1=q.x0)>x3||(y1=q.y0)>y3||(x2=q.x1)<x0||(y2=q.y1)<y0)continue;if(node.length){var xm=(x1+x2)/2,ym=(y1+y2)/2;quads.push(new Quad(node[3],xm,ym,x2,y2),new Quad(node[2],x1,ym,xm,y2),new Quad(node[1],xm,y1,x2,ym),new Quad(node[0],x1,y1,xm,ym));if(i=(y>=ym)<<1|x>=xm){q=quads[quads.length-1];quads[quads.length-1]=quads[quads.length-1-i];quads[quads.length-1-i]=q}}else{var dx=x-+this._x.call(null,node.data),dy=y-+this._y.call(null,node.data),d2=dx*dx+dy*dy;if(d2<radius){var d=Math.sqrt(radius=d2);x0=x-d,y0=y-d;x3=x+d,y3=y+d;data=node.data}}}return data}function tree_remove(d){if(isNaN(x=+this._x.call(null,d))||isNaN(y=+this._y.call(null,d)))return this;var parent,node=this._root,retainer,previous,next,x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1,x,y,xm,ym,right,bottom,i,j;if(!node)return this;if(node.length)while(true){if(right=x>=(xm=(x0+x1)/2))x0=xm;else x1=xm;if(bottom=y>=(ym=(y0+y1)/2))y0=ym;else y1=ym;if(!(parent=node,node=node[i=bottom<<1|right]))return this;if(!node.length)break;if(parent[i+1&3]||parent[i+2&3]||parent[i+3&3])retainer=parent,j=i}while(node.data!==d)if(!(previous=node,node=node.next))return this;if(next=node.next)delete node.next;if(previous)return next?previous.next=next:delete previous.next,this;if(!parent)return this._root=next,this;next?parent[i]=next:delete parent[i];if((node=parent[0]||parent[1]||parent[2]||parent[3])&&node===(parent[3]||parent[2]||parent[1]||parent[0])&&!node.length){if(retainer)retainer[j]=node;else this._root=node}return this}function removeAll(data){for(var i=0,n=data.length;i<n;++i)this.remove(data[i]);return this}function tree_root(){return this._root}function tree_size(){var size=0;this.visit(function(node){if(!node.length)do{++size}while(node=node.next)});return size}function tree_visit(callback){var quads=[],q,node=this._root,child,x0,y0,x1,y1;if(node)quads.push(new Quad(node,this._x0,this._y0,this._x1,this._y1));while(q=quads.pop()){if(!callback(node=q.node,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1)&&node.length){var xm=(x0+x1)/2,ym=(y0+y1)/2;if(child=node[3])quads.push(new Quad(child,xm,ym,x1,y1));if(child=node[2])quads.push(new Quad(child,x0,ym,xm,y1));if(child=node[1])quads.push(new Quad(child,xm,y0,x1,ym));if(child=node[0])quads.push(new Quad(child,x0,y0,xm,ym))}}return this}function tree_visitAfter(callback){var quads=[],next=[],q;if(this._root)quads.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));while(q=quads.pop()){var node=q.node;if(node.length){var child,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1,xm=(x0+x1)/2,ym=(y0+y1)/2;if(child=node[0])quads.push(new Quad(child,x0,y0,xm,ym));if(child=node[1])quads.push(new Quad(child,xm,y0,x1,ym));if(child=node[2])quads.push(new Quad(child,x0,ym,xm,y1));if(child=node[3])quads.push(new Quad(child,xm,ym,x1,y1))}next.push(q)}while(q=next.pop()){callback(q.node,q.x0,q.y0,q.x1,q.y1)}return this}function defaultX$1(d){return d[0]}function tree_x(_){return arguments.length?(this._x=_,this):this._x}function defaultY$1(d){return d[1]}function tree_y(_){return arguments.length?(this._y=_,this):this._y}function quadtree(nodes,x,y){var tree=new Quadtree(x==null?defaultX$1:x,y==null?defaultY$1:y,NaN,NaN,NaN,NaN);return nodes==null?tree:tree.addAll(nodes)}function Quadtree(x,y,x0,y0,x1,y1){this._x=x;this._y=y;this._x0=x0;this._y0=y0;this._x1=x1;this._y1=y1;this._root=undefined}function leaf_copy(leaf){var copy={data:leaf.data},next=copy;while(leaf=leaf.next)next=next.next={data:leaf.data};return copy}var treeProto=quadtree.prototype=Quadtree.prototype;treeProto.copy=function(){var copy=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),node=this._root,nodes,child;if(!node)return copy;if(!node.length)return copy._root=leaf_copy(node),copy;nodes=[{source:node,target:copy._root=new Array(4)}];while(node=nodes.pop()){for(var i=0;i<4;++i){if(child=node.source[i]){if(child.length)nodes.push({source:child,target:node.target[i]=new Array(4)});else node.target[i]=leaf_copy(child)}}}return copy};treeProto.add=tree_add;treeProto.addAll=addAll;treeProto.cover=tree_cover;treeProto.data=tree_data;treeProto.extent=tree_extent;treeProto.find=tree_find;treeProto.remove=tree_remove;treeProto.removeAll=removeAll;treeProto.root=tree_root;treeProto.size=tree_size;treeProto.visit=tree_visit;treeProto.visitAfter=tree_visitAfter;treeProto.x=tree_x;treeProto.y=tree_y;function constant$6(x){return function(){return x}}function jiggle(){return(Math.random()-.5)*1e-6}function x$2(d){return d.x+d.vx}function y$2(d){return d.y+d.vy}function forceCollide(radius){var nodes,radii,strength=1,iterations=1;if(typeof radius!=="function")radius=constant$6(radius==null?1:+radius);function force(){var i,n=nodes.length,tree,node,xi,yi,ri,ri2;for(var k=0;k<iterations;++k){tree=quadtree(nodes,x$2,y$2).visitAfter(prepare);for(i=0;i<n;++i){node=nodes[i];ri=radii[node.index],ri2=ri*ri;xi=node.x+node.vx;yi=node.y+node.vy;tree.visit(apply)}}function apply(quad,x0,y0,x1,y1){var data=quad.data,rj=quad.r,r=ri+rj;if(data){if(data.index>node.index){var x=xi-data.x-data.vx,y=yi-data.y-data.vy,l=x*x+y*y;if(l<r*r){if(x===0)x=jiggle(),l+=x*x;if(y===0)y=jiggle(),l+=y*y;l=(r-(l=Math.sqrt(l)))/l*strength;node.vx+=(x*=l)*(r=(rj*=rj)/(ri2+rj));node.vy+=(y*=l)*r;data.vx-=x*(r=1-r);data.vy-=y*r}}return}return x0>xi+r||x1<xi-r||y0>yi+r||y1<yi-r}}function prepare(quad){if(quad.data)return quad.r=radii[quad.data.index];for(var i=quad.r=0;i<4;++i){if(quad[i]&&quad[i].r>quad.r){quad.r=quad[i].r}}}function initialize(){if(!nodes)return;var i,n=nodes.length,node;radii=new Array(n);for(i=0;i<n;++i)node=nodes[i],radii[node.index]=+radius(node,i,nodes)}force.initialize=function(_){nodes=_;initialize()};force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations};force.strength=function(_){return arguments.length?(strength=+_,force):strength};force.radius=function(_){return arguments.length?(radius=typeof _==="function"?_:constant$6(+_),initialize(),force):radius};return force}function index(d){return d.index}function find(nodeById,nodeId){var node=nodeById.get(nodeId);if(!node)throw new Error("missing: "+nodeId);return node}function forceLink(links){var id=index,strength=defaultStrength,strengths,distance=constant$6(30),distances,nodes,count,bias,iterations=1;if(links==null)links=[];function defaultStrength(link){return 1/Math.min(count[link.source.index],count[link.target.index])}function force(alpha){for(var k=0,n=links.length;k<iterations;++k){for(var i=0,link,source,target,x,y,l,b;i<n;++i){link=links[i],source=link.source,target=link.target;x=target.x+target.vx-source.x-source.vx||jiggle();y=target.y+target.vy-source.y-source.vy||jiggle();l=Math.sqrt(x*x+y*y);l=(l-distances[i])/l*alpha*strengths[i];x*=l,y*=l;target.vx-=x*(b=bias[i]);target.vy-=y*b;source.vx+=x*(b=1-b);source.vy+=y*b}}}function initialize(){if(!nodes)return;var i,n=nodes.length,m=links.length,nodeById=new Map(nodes.map((d,i)=>[id(d,i,nodes),d])),link;for(i=0,count=new Array(n);i<m;++i){link=links[i],link.index=i;if(typeof link.source!=="object")link.source=find(nodeById,link.source);if(typeof link.target!=="object")link.target=find(nodeById,link.target);count[link.source.index]=(count[link.source.index]||0)+1;count[link.target.index]=(count[link.target.index]||0)+1}for(i=0,bias=new Array(m);i<m;++i){link=links[i],bias[i]=count[link.source.index]/(count[link.source.index]+count[link.target.index])}strengths=new Array(m),initializeStrength();distances=new Array(m),initializeDistance()}function initializeStrength(){if(!nodes)return;for(var i=0,n=links.length;i<n;++i){strengths[i]=+strength(links[i],i,links)}}function initializeDistance(){if(!nodes)return;for(var i=0,n=links.length;i<n;++i){distances[i]=+distance(links[i],i,links)}}force.initialize=function(_){nodes=_;initialize()};force.links=function(_){return arguments.length?(links=_,initialize(),force):links};force.id=function(_){return arguments.length?(id=_,force):id};force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$6(+_),initializeStrength(),force):strength};force.distance=function(_){return arguments.length?(distance=typeof _==="function"?_:constant$6(+_),initializeDistance(),force):distance};return force}var noop$4={value:function(){}};function dispatch(){for(var i=0,n=arguments.length,_={},t;i<n;++i){if(!(t=arguments[i]+"")||t in _)throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function parseTypenames(typenames,types){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0)name=t.slice(i+1),t=t.slice(0,i);if(t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:name}})}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(typename,callback){var _=this._,T=parseTypenames(typename+"",_),t,i=-1,n=T.length;if(arguments.length<2){while(++i<n)if((t=(typename=T[i]).type)&&(t=get$2(_[t],typename.name)))return t;return}if(callback!=null&&typeof callback!=="function")throw new Error("invalid callback: "+callback);while(++i<n){if(t=(typename=T[i]).type)_[t]=set$2(_[t],typename.name,callback);else if(callback==null)for(t in _)_[t]=set$2(_[t],typename.name,null)}return this},copy:function(){var copy={},_=this._;for(var t in _)copy[t]=_[t].slice();return new Dispatch(copy)},call:function(type,that){if((n=arguments.length-2)>0)for(var args=new Array(n),i=0,n,t;i<n;++i)args[i]=arguments[i+2];if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)},apply:function(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)}};function get$2(type,name){for(var i=0,n=type.length,c;i<n;++i){if((c=type[i]).name===name){return c.value}}}function set$2(type,name,callback){for(var i=0,n=type.length;i<n;++i){if(type[i].name===name){type[i]=noop$4,type=type.slice(0,i).concat(type.slice(i+1));break}}if(callback!=null)type.push({name:name,value:callback});return type}var frame=0,timeout=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance==="object"&&performance.now?performance:Date,setFrame=typeof window==="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}Timer.prototype=timer.prototype={constructor:Timer,restart:function(callback,delay,time){if(typeof callback!=="function")throw new TypeError("callback is not a function");time=(time==null?now():+time)+(delay==null?0:+delay);if(!this._next&&taskTail!==this){if(taskTail)taskTail._next=this;else taskHead=this;taskTail=this}this._call=callback;this._time=time;sleep()},stop:function(){if(this._call){this._call=null;this._time=Infinity;sleep()}}};function timer(callback,delay,time){var t=new Timer;t.restart(callback,delay,time);return t}function timerFlush(){now();++frame;var t=taskHead,e;while(t){if((e=clockNow-t._time)>=0)t._call.call(null,e);t=t._next}--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew;frame=timeout=0;try{timerFlush()}finally{frame=0;nap();clockNow=0}}function poke(){var now=clock.now(),delay=now-clockLast;if(delay>pokeDelay)clockSkew-=delay,clockLast=now}function nap(){var t0,t1=taskHead,t2,time=Infinity;while(t1){if(t1._call){if(time>t1._time)time=t1._time;t0=t1,t1=t1._next}else{t2=t1._next,t1._next=null;t1=t0?t0._next=t2:taskHead=t2}}taskTail=t0;sleep(time)}function sleep(time){if(frame)return;if(timeout)timeout=clearTimeout(timeout);var delay=time-clockNow;if(delay>24){if(time<Infinity)timeout=setTimeout(wake,time-clock.now()-clockSkew);if(interval)interval=clearInterval(interval)}else{if(!interval)clockLast=clock.now(),interval=setInterval(poke,pokeDelay);frame=1,setFrame(wake)}}function interval$1(callback,delay,time){var t=new Timer,total=delay;if(delay==null)return t.restart(callback,delay,time),t;delay=+delay,time=time==null?now():+time;t.restart(function tick(elapsed){elapsed+=total;t.restart(tick,total+=delay,time);callback(elapsed)},delay,time);return t}function x$3(d){return d.x}function y$3(d){return d.y}var initialRadius=10,initialAngle=Math.PI*(3-Math.sqrt(5));function forceSimulation(nodes){var simulation,alpha=1,alphaMin=.001,alphaDecay=1-Math.pow(alphaMin,1/300),alphaTarget=0,velocityDecay=.6,forces=new Map,stepper=timer(step),event=dispatch("tick","end");if(nodes==null)nodes=[];function step(){tick();event.call("tick",simulation);if(alpha<alphaMin){stepper.stop();event.call("end",simulation)}}function tick(iterations){var i,n=nodes.length,node;if(iterations===undefined)iterations=1;for(var k=0;k<iterations;++k){alpha+=(alphaTarget-alpha)*alphaDecay;forces.forEach(function(force){force(alpha)});for(i=0;i<n;++i){node=nodes[i];if(node.fx==null)node.x+=node.vx*=velocityDecay;else node.x=node.fx,node.vx=0;if(node.fy==null)node.y+=node.vy*=velocityDecay;else node.y=node.fy,node.vy=0}}return simulation}function initializeNodes(){for(var i=0,n=nodes.length,node;i<n;++i){node=nodes[i],node.index=i;if(node.fx!=null)node.x=node.fx;if(node.fy!=null)node.y=node.fy;if(isNaN(node.x)||isNaN(node.y)){var radius=initialRadius*Math.sqrt(i),angle=i*initialAngle;node.x=radius*Math.cos(angle);node.y=radius*Math.sin(angle)}if(isNaN(node.vx)||isNaN(node.vy)){node.vx=node.vy=0}}}function initializeForce(force){if(force.initialize)force.initialize(nodes);return force}initializeNodes();return simulation={tick:tick,restart:function(){return stepper.restart(step),simulation},stop:function(){return stepper.stop(),simulation},nodes:function(_){return arguments.length?(nodes=_,initializeNodes(),forces.forEach(initializeForce),simulation):nodes},alpha:function(_){return arguments.length?(alpha=+_,simulation):alpha},alphaMin:function(_){return arguments.length?(alphaMin=+_,simulation):alphaMin},alphaDecay:function(_){return arguments.length?(alphaDecay=+_,simulation):+alphaDecay},alphaTarget:function(_){return arguments.length?(alphaTarget=+_,simulation):alphaTarget},velocityDecay:function(_){return arguments.length?(velocityDecay=1-_,simulation):1-velocityDecay},force:function(name,_){return arguments.length>1?(_==null?forces.delete(name):forces.set(name,initializeForce(_)),simulation):forces.get(name)},find:function(x,y,radius){var i=0,n=nodes.length,dx,dy,d2,node,closest;if(radius==null)radius=Infinity;else radius*=radius;for(i=0;i<n;++i){node=nodes[i];dx=x-node.x;dy=y-node.y;d2=dx*dx+dy*dy;if(d2<radius)closest=node,radius=d2}return closest},on:function(name,_){return arguments.length>1?(event.on(name,_),simulation):event.on(name)}}}function forceManyBody(){var nodes,node,alpha,strength=constant$6(-30),strengths,distanceMin2=1,distanceMax2=Infinity,theta2=.81;function force(_){var i,n=nodes.length,tree=quadtree(nodes,x$3,y$3).visitAfter(accumulate);for(alpha=_,i=0;i<n;++i)node=nodes[i],tree.visit(apply)}function initialize(){if(!nodes)return;var i,n=nodes.length,node;strengths=new Array(n);for(i=0;i<n;++i)node=nodes[i],strengths[node.index]=+strength(node,i,nodes)}function accumulate(quad){var strength=0,q,c,weight=0,x,y,i;if(quad.length){for(x=y=i=0;i<4;++i){if((q=quad[i])&&(c=Math.abs(q.value))){strength+=q.value,weight+=c,x+=c*q.x,y+=c*q.y}}quad.x=x/weight;quad.y=y/weight}else{q=quad;q.x=q.data.x;q.y=q.data.y;do{strength+=strengths[q.data.index]}while(q=q.next)}quad.value=strength}function apply(quad,x1,_,x2){if(!quad.value)return true;var x=quad.x-node.x,y=quad.y-node.y,w=x2-x1,l=x*x+y*y;if(w*w/theta2<l){if(l<distanceMax2){if(x===0)x=jiggle(),l+=x*x;if(y===0)y=jiggle(),l+=y*y;if(l<distanceMin2)l=Math.sqrt(distanceMin2*l);node.vx+=x*quad.value*alpha/l;node.vy+=y*quad.value*alpha/l}return true}else if(quad.length||l>=distanceMax2)return;if(quad.data!==node||quad.next){if(x===0)x=jiggle(),l+=x*x;if(y===0)y=jiggle(),l+=y*y;if(l<distanceMin2)l=Math.sqrt(distanceMin2*l)}do{if(quad.data!==node){w=strengths[quad.data.index]*alpha/l;node.vx+=x*w;node.vy+=y*w}}while(quad=quad.next)}force.initialize=function(_){nodes=_;initialize()};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$6(+_),initialize(),force):strength};force.distanceMin=function(_){return arguments.length?(distanceMin2=_*_,force):Math.sqrt(distanceMin2)};force.distanceMax=function(_){return arguments.length?(distanceMax2=_*_,force):Math.sqrt(distanceMax2)};force.theta=function(_){return arguments.length?(theta2=_*_,force):Math.sqrt(theta2)};return force}function forceX(x){var strength=constant$6(.1),nodes,strengths,xz;if(typeof x!=="function")x=constant$6(x==null?0:+x);function force(alpha){for(var i=0,n=nodes.length,node;i<n;++i){node=nodes[i],node.vx+=(xz[i]-node.x)*strengths[i]*alpha}}function initialize(){if(!nodes)return;var i,n=nodes.length;strengths=new Array(n);xz=new Array(n);for(i=0;i<n;++i){strengths[i]=isNaN(xz[i]=+x(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}force.initialize=function(_){nodes=_;initialize()};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$6(+_),initialize(),force):strength};force.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$6(+_),initialize(),force):x};return force}function forceY(y){var strength=constant$6(.1),nodes,strengths,yz;if(typeof y!=="function")y=constant$6(y==null?0:+y);function force(alpha){for(var i=0,n=nodes.length,node;i<n;++i){node=nodes[i],node.vy+=(yz[i]-node.y)*strengths[i]*alpha}}function initialize(){if(!nodes)return;var i,n=nodes.length;strengths=new Array(n);yz=new Array(n);for(i=0;i<n;++i){strengths[i]=isNaN(yz[i]=+y(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}force.initialize=function(_){nodes=_;initialize()};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$6(+_),initialize(),force):strength};force.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$6(+_),initialize(),force):y};return force}var ForceMap={center:forceCenter,collide:forceCollide,nbody:forceManyBody,link:forceLink,x:forceX,y:forceY};var Forces="forces",ForceParams=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],ForceConfig=["static","iterations"],ForceOutput=["x","y","vx","vy"];function Force(params){Transform.call(this,null,params)}Force.Definition={type:"Force",metadata:{modifies:true},params:[{name:"static",type:"boolean",default:false},{name:"restart",type:"boolean",default:false},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:true,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:true},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:true},{name:"strength",type:"number",expr:true},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:true,modify:false,default:ForceOutput}]};var prototype$16=inherits(Force,Transform);prototype$16.transform=function(_,pulse){var sim=this.value,change=pulse.changed(pulse.ADD_REM),params=_.modified(ForceParams),iters=_.iterations||300;if(!sim){this.value=sim=simulation(pulse.source,_);sim.on("tick",rerun(pulse.dataflow,this));if(!_.static){change=true;sim.tick()}pulse.modifies("index")}else{if(change){pulse.modifies("index");sim.nodes(pulse.source)}if(params||pulse.changed(pulse.MOD)){setup(sim,_,0,pulse)}}if(params||change||_.modified(ForceConfig)||pulse.changed()&&_.restart){sim.alpha(Math.max(sim.alpha(),_.alpha||1)).alphaDecay(1-Math.pow(sim.alphaMin(),1/iters));if(_.static){for(sim.stop();--iters>=0;)sim.tick()}else{if(sim.stopped())sim.restart();if(!change)return pulse.StopPropagation}}return this.finish(_,pulse)};prototype$16.finish=function(_,pulse){var dataflow=pulse.dataflow;for(var args=this._argops,j=0,m=args.length,arg;j<m;++j){arg=args[j];if(arg.name!==Forces||arg.op._argval.force!=="link"){continue}for(var ops=arg.op._argops,i=0,n=ops.length,op;i<n;++i){if(ops[i].name==="links"&&(op=ops[i].op.source)){dataflow.pulse(op,dataflow.changeset().reflow());break}}}return pulse.reflow(_.modified()).modifies(ForceOutput)};function rerun(df,op){return function(){df.touch(op).run()}}function simulation(nodes,_){var sim=forceSimulation(nodes),stopped=false,stop=sim.stop,restart=sim.restart;sim.stopped=function(){return stopped};sim.restart=function(){stopped=false;return restart()};sim.stop=function(){stopped=true;return stop()};return setup(sim,_,true).on("end",function(){stopped=true})}function setup(sim,_,init,pulse){var f=array(_.forces),i,n,p,name;for(i=0,n=ForceParams.length;i<n;++i){p=ForceParams[i];if(p!==Forces&&_.modified(p))sim[p](_[p])}for(i=0,n=f.length;i<n;++i){name=Forces+i;p=init||_.modified(Forces,i)?getForce(f[i]):pulse&&modified(f[i],pulse)?sim.force(name):null;if(p)sim.force(name,p)}for(n=sim.numForces||0;i<n;++i){sim.force(Forces+i,null)}sim.numForces=f.length;return sim}function modified(f,pulse){var k,v;for(k in f){if(isFunction(v=f[k])&&pulse.modified(accessorFields(v)))return 1}return 0}function getForce(_){var f,p;if(!ForceMap.hasOwnProperty(_.force)){error("Unrecognized force: "+_.force)}f=ForceMap[_.force]();for(p in _){if(isFunction(f[p]))setForceParam(f[p],_[p],_)}return f}function setForceParam(f,v,_){f(isFunction(v)?function(d){return v(d,_)}:v)}var force=Object.freeze({force:Force});function lookup$3(tree,key,filter){var map={};tree.each(function(node){var t=node.data;if(filter(t))map[key(t)]=node});tree.lookup=map;return tree}function defaultSeparation(a,b){return a.parent===b.parent?1:2}function meanX(children){return children.reduce(meanXReduce,0)/children.length}function meanXReduce(x,c){return x+c.x}function maxY(children){return 1+children.reduce(maxYReduce,0)}function maxYReduce(y,c){return Math.max(y,c.y)}function leafLeft(node){var children;while(children=node.children)node=children[0];return node}function leafRight(node){var children;while(children=node.children)node=children[children.length-1];return node}function cluster(){var separation=defaultSeparation,dx=1,dy=1,nodeSize=false;function cluster(root){var previousNode,x=0;root.eachAfter(function(node){var children=node.children;if(children){node.x=meanX(children);node.y=maxY(children)}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node}});var left=leafLeft(root),right=leafRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return root.eachAfter(nodeSize?function(node){node.x=(node.x-root.x)*dx;node.y=(root.y-node.y)*dy}:function(node){node.x=(node.x-x0)/(x1-x0)*dx;node.y=(1-(root.y?node.y/root.y:1))*dy})}cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation};cluster.size=function(x){return arguments.length?(nodeSize=false,dx=+x[0],dy=+x[1],cluster):nodeSize?null:[dx,dy]};cluster.nodeSize=function(x){return arguments.length?(nodeSize=true,dx=+x[0],dy=+x[1],cluster):nodeSize?[dx,dy]:null};return cluster}function count(node){var sum=0,children=node.children,i=children&&children.length;if(!i)sum=1;else while(--i>=0)sum+=children[i].value;node.value=sum}function node_count(){return this.eachAfter(count)}function node_each(callback){var node=this,current,next=[node],children,i,n;do{current=next.reverse(),next=[];while(node=current.pop()){callback(node),children=node.children;if(children)for(i=0,n=children.length;i<n;++i){next.push(children[i])}}}while(next.length);return this}function node_eachBefore(callback){var node=this,nodes=[node],children,i;while(node=nodes.pop()){callback(node),children=node.children;if(children)for(i=children.length-1;i>=0;--i){nodes.push(children[i])}}return this}function node_eachAfter(callback){var node=this,nodes=[node],next=[],children,i,n;while(node=nodes.pop()){next.push(node),children=node.children;if(children)for(i=0,n=children.length;i<n;++i){nodes.push(children[i])}}while(node=next.pop()){callback(node)}return this}function node_sum(value){return this.eachAfter(function(node){var sum=+value(node.data)||0,children=node.children,i=children&&children.length;while(--i>=0)sum+=children[i].value;node.value=sum})}function node_sort(compare){return this.eachBefore(function(node){if(node.children){node.children.sort(compare)}})}function node_path(end){var start=this,ancestor=leastCommonAncestor(start,end),nodes=[start];while(start!==ancestor){start=start.parent;nodes.push(start)}var k=nodes.length;while(end!==ancestor){nodes.splice(k,0,end);end=end.parent}return nodes}function leastCommonAncestor(a,b){if(a===b)return a;var aNodes=a.ancestors(),bNodes=b.ancestors(),c=null;a=aNodes.pop();b=bNodes.pop();while(a===b){c=a;a=aNodes.pop();b=bNodes.pop()}return c}function node_ancestors(){var node=this,nodes=[node];while(node=node.parent){nodes.push(node)}return nodes}function node_descendants(){var nodes=[];this.each(function(node){nodes.push(node)});return nodes}function node_leaves(){var leaves=[];this.eachBefore(function(node){if(!node.children){leaves.push(node)}});return leaves}function node_links(){var root=this,links=[];root.each(function(node){if(node!==root){links.push({source:node.parent,target:node})}});return links}function hierarchy(data,children){var root=new Node(data),valued=+data.value&&(root.value=data.value),node,nodes=[root],child,childs,i,n;if(children==null)children=defaultChildren;while(node=nodes.pop()){if(valued)node.value=+node.data.value;if((childs=children(node.data))&&(n=childs.length)){node.children=new Array(n);for(i=n-1;i>=0;--i){nodes.push(child=node.children[i]=new Node(childs[i]));child.parent=node;child.depth=node.depth+1}}}return root.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function defaultChildren(d){return d.children}function copyData(node){node.data=node.data.data}function computeHeight(node){var height=0;do{node.height=height}while((node=node.parent)&&node.height<++height)}function Node(data){this.data=data;this.depth=this.height=0;this.parent=null}Node.prototype=hierarchy.prototype={constructor:Node,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy};var slice$2=Array.prototype.slice;function shuffle(array){var m=array.length,t,i;while(m){i=Math.random()*m--|0;t=array[m];array[m]=array[i];array[i]=t}return array}function enclose(circles){var i=0,n=(circles=shuffle(slice$2.call(circles))).length,B=[],p,e;while(i<n){p=circles[i];if(e&&enclosesWeak(e,p))++i;else e=encloseBasis(B=extendBasis(B,p)),i=0}return e}function extendBasis(B,p){var i,j;if(enclosesWeakAll(p,B))return[p];for(i=0;i<B.length;++i){if(enclosesNot(p,B[i])&&enclosesWeakAll(encloseBasis2(B[i],p),B)){return[B[i],p]}}for(i=0;i<B.length-1;++i){for(j=i+1;j<B.length;++j){if(enclosesNot(encloseBasis2(B[i],B[j]),p)&&enclosesNot(encloseBasis2(B[i],p),B[j])&&enclosesNot(encloseBasis2(B[j],p),B[i])&&enclosesWeakAll(encloseBasis3(B[i],B[j],p),B)){return[B[i],B[j],p]}}}throw new Error}function enclosesNot(a,b){var dr=a.r-b.r,dx=b.x-a.x,dy=b.y-a.y;return dr<0||dr*dr<dx*dx+dy*dy}function enclosesWeak(a,b){var dr=a.r-b.r+1e-6,dx=b.x-a.x,dy=b.y-a.y;return dr>0&&dr*dr>dx*dx+dy*dy}function enclosesWeakAll(a,B){for(var i=0;i<B.length;++i){if(!enclosesWeak(a,B[i])){return false}}return true}function encloseBasis(B){switch(B.length){case 1:return encloseBasis1(B[0]);case 2:return encloseBasis2(B[0],B[1]);case 3:return encloseBasis3(B[0],B[1],B[2])}}function encloseBasis1(a){return{x:a.x,y:a.y,r:a.r}}function encloseBasis2(a,b){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x21=x2-x1,y21=y2-y1,r21=r2-r1,l=Math.sqrt(x21*x21+y21*y21);return{x:(x1+x2+x21/l*r21)/2,y:(y1+y2+y21/l*r21)/2,r:(l+r1+r2)/2}}function encloseBasis3(a,b,c){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x3=c.x,y3=c.y,r3=c.r,a2=x1-x2,a3=x1-x3,b2=y1-y2,b3=y1-y3,c2=r2-r1,c3=r3-r1,d1=x1*x1+y1*y1-r1*r1,d2=d1-x2*x2-y2*y2+r2*r2,d3=d1-x3*x3-y3*y3+r3*r3,ab=a3*b2-a2*b3,xa=(b2*d3-b3*d2)/(ab*2)-x1,xb=(b3*c2-b2*c3)/ab,ya=(a3*d2-a2*d3)/(ab*2)-y1,yb=(a2*c3-a3*c2)/ab,A=xb*xb+yb*yb-1,B=2*(r1+xa*xb+ya*yb),C=xa*xa+ya*ya-r1*r1,r=-(A?(B+Math.sqrt(B*B-4*A*C))/(2*A):C/B);return{x:x1+xa+xb*r,y:y1+ya+yb*r,r:r}}function place(b,a,c){var dx=b.x-a.x,x,a2,dy=b.y-a.y,y,b2,d2=dx*dx+dy*dy;if(d2){a2=a.r+c.r,a2*=a2;b2=b.r+c.r,b2*=b2;if(a2>b2){x=(d2+b2-a2)/(2*d2);y=Math.sqrt(Math.max(0,b2/d2-x*x));c.x=b.x-x*dx-y*dy;c.y=b.y-x*dy+y*dx}else{x=(d2+a2-b2)/(2*d2);y=Math.sqrt(Math.max(0,a2/d2-x*x));c.x=a.x+x*dx-y*dy;c.y=a.y+x*dy+y*dx}}else{c.x=a.x+c.r;c.y=a.y}}function intersects(a,b){var dr=a.r+b.r-1e-6,dx=b.x-a.x,dy=b.y-a.y;return dr>0&&dr*dr>dx*dx+dy*dy}function score(node){var a=node._,b=node.next._,ab=a.r+b.r,dx=(a.x*b.r+b.x*a.r)/ab,dy=(a.y*b.r+b.y*a.r)/ab;return dx*dx+dy*dy}function Node$1(circle){this._=circle;this.next=null;this.previous=null}function packEnclose(circles){if(!(n=circles.length))return 0;var a,b,c,n,aa,ca,i,j,k,sj,sk;a=circles[0],a.x=0,a.y=0;if(!(n>1))return a.r;b=circles[1],a.x=-b.r,b.x=a.r,b.y=0;if(!(n>2))return a.r+b.r;place(b,a,c=circles[2]);a=new Node$1(a),b=new Node$1(b),c=new Node$1(c);a.next=c.previous=b;b.next=a.previous=c;c.next=b.previous=a;pack:for(i=3;i<n;++i){place(a._,b._,c=circles[i]),c=new Node$1(c);j=b.next,k=a.previous,sj=b._.r,sk=a._.r;do{if(sj<=sk){if(intersects(j._,c._)){b=j,a.next=b,b.previous=a,--i;continue pack}sj+=j._.r,j=j.next}else{if(intersects(k._,c._)){a=k,a.next=b,b.previous=a,--i;continue pack}sk+=k._.r,k=k.previous}}while(j!==k.next);c.previous=a,c.next=b,a.next=b.previous=b=c;aa=score(a);while((c=c.next)!==b){if((ca=score(c))<aa){a=c,aa=ca}}b=a.next}a=[b._],c=b;while((c=c.next)!==b)a.push(c._);c=enclose(a);for(i=0;i<n;++i)a=circles[i],a.x-=c.x,a.y-=c.y;return c.r}function optional(f){return f==null?null:required(f)}function required(f){if(typeof f!=="function")throw new Error;return f}function constantZero(){return 0}function constant$7(x){return function(){return x}}function defaultRadius(d){return Math.sqrt(d.value)}function pack(){var radius=null,dx=1,dy=1,padding=constantZero;function pack(root){root.x=dx/2,root.y=dy/2;if(radius){root.eachBefore(radiusLeaf(radius)).eachAfter(packChildren(padding,.5)).eachBefore(translateChild(1))}else{root.eachBefore(radiusLeaf(defaultRadius)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(padding,root.r/Math.min(dx,dy))).eachBefore(translateChild(Math.min(dx,dy)/(2*root.r)))}return root}pack.radius=function(x){return arguments.length?(radius=optional(x),pack):radius};pack.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],pack):[dx,dy]};pack.padding=function(x){return arguments.length?(padding=typeof x==="function"?x:constant$7(+x),pack):padding};return pack}function radiusLeaf(radius){return function(node){if(!node.children){node.r=Math.max(0,+radius(node)||0)}}}function packChildren(padding,k){return function(node){if(children=node.children){var children,i,n=children.length,r=padding(node)*k||0,e;if(r)for(i=0;i<n;++i)children[i].r+=r;e=packEnclose(children);if(r)for(i=0;i<n;++i)children[i].r-=r;node.r=e+r}}}function translateChild(k){return function(node){var parent=node.parent;node.r*=k;if(parent){node.x=parent.x+k*node.x;node.y=parent.y+k*node.y}}}function roundNode(node){node.x0=Math.round(node.x0);node.y0=Math.round(node.y0);node.x1=Math.round(node.x1);node.y1=Math.round(node.y1)}function treemapDice(parent,x0,y0,x1,y1){var nodes=parent.children,node,i=-1,n=nodes.length,k=parent.value&&(x1-x0)/parent.value;while(++i<n){node=nodes[i],node.y0=y0,node.y1=y1;node.x0=x0,node.x1=x0+=node.value*k}}function partition$2(){var dx=1,dy=1,padding=0,round=false;function partition(root){var n=root.height+1;root.x0=root.y0=padding;root.x1=dx;root.y1=dy/n;root.eachBefore(positionNode(dy,n));if(round)root.eachBefore(roundNode);return root}function positionNode(dy,n){return function(node){if(node.children){treemapDice(node,node.x0,dy*(node.depth+1)/n,node.x1,dy*(node.depth+2)/n)}var x0=node.x0,y0=node.y0,x1=node.x1-padding,y1=node.y1-padding;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;node.x0=x0;node.y0=y0;node.x1=x1;node.y1=y1}}partition.round=function(x){return arguments.length?(round=!!x,partition):round};partition.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],partition):[dx,dy]};partition.padding=function(x){return arguments.length?(padding=+x,partition):padding};return partition}var keyPrefix="$",preroot={depth:-1},ambiguous={};function defaultId(d){return d.id}function defaultParentId(d){return d.parentId}function stratify(){var id=defaultId,parentId=defaultParentId;function stratify(data){var d,i,n=data.length,root,parent,node,nodes=new Array(n),nodeId,nodeKey,nodeByKey={};for(i=0;i<n;++i){d=data[i],node=nodes[i]=new Node(d);if((nodeId=id(d,i,data))!=null&&(nodeId+="")){nodeKey=keyPrefix+(node.id=nodeId);nodeByKey[nodeKey]=nodeKey in nodeByKey?ambiguous:node}}for(i=0;i<n;++i){node=nodes[i],nodeId=parentId(data[i],i,data);if(nodeId==null||!(nodeId+="")){if(root)throw new Error("multiple roots");root=node}else{parent=nodeByKey[keyPrefix+nodeId];if(!parent)throw new Error("missing: "+nodeId);if(parent===ambiguous)throw new Error("ambiguous: "+nodeId);if(parent.children)parent.children.push(node);else parent.children=[node];node.parent=parent}}if(!root)throw new Error("no root");root.parent=preroot;root.eachBefore(function(node){node.depth=node.parent.depth+1;--n}).eachBefore(computeHeight);root.parent=null;if(n>0)throw new Error("cycle");return root}stratify.id=function(x){return arguments.length?(id=required(x),stratify):id};stratify.parentId=function(x){return arguments.length?(parentId=required(x),stratify):parentId};return stratify}function defaultSeparation$1(a,b){return a.parent===b.parent?1:2}function nextLeft(v){var children=v.children;return children?children[0]:v.t}function nextRight(v){var children=v.children;return children?children[children.length-1]:v.t}function moveSubtree(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift}function executeShifts(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c)}}function nextAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}function TreeNode(node,i){this._=node;this.parent=null;this.children=null;this.A=null;this.a=this;this.z=0;this.m=0;this.c=0;this.s=0;this.t=null;this.i=i}TreeNode.prototype=Object.create(Node.prototype);function treeRoot(root){var tree=new TreeNode(root,0),node,nodes=[tree],child,children,i,n;while(node=nodes.pop()){if(children=node._.children){node.children=new Array(n=children.length);for(i=n-1;i>=0;--i){nodes.push(child=node.children[i]=new TreeNode(children[i],i));child.parent=node}}}(tree.parent=new TreeNode(null,0)).children=[tree];return tree}function tree(){var separation=defaultSeparation$1,dx=1,dy=1,nodeSize=null;function tree(root){var t=treeRoot(root);t.eachAfter(firstWalk),t.parent.m=-t.z;t.eachBefore(secondWalk);if(nodeSize)root.eachBefore(sizeNode);else{var left=root,right=root,bottom=root;root.eachBefore(function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node});var s=left===right?1:separation(left,right)/2,tx=s-left.x,kx=dx/(right.x+s+tx),ky=dy/(bottom.depth||1);root.eachBefore(function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky})}return root}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children){executeShifts(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint}else{v.z=midpoint}}else if(w){v.z=w.z+separation(v._,w._)}v.parent.A=apportion(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m}function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=nextRight(vim),vip=nextLeft(vip),vim&&vip){vom=nextLeft(vom);vop=nextRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){moveSubtree(nextAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift}sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m}if(vim&&!nextRight(vop)){vop.t=vim;vop.m+=sim-sop}if(vip&&!nextLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v}}return ancestor}function sizeNode(node){node.x*=dx;node.y=node.depth*dy}tree.separation=function(x){return arguments.length?(separation=x,tree):separation};tree.size=function(x){return arguments.length?(nodeSize=false,dx=+x[0],dy=+x[1],tree):nodeSize?null:[dx,dy]};tree.nodeSize=function(x){return arguments.length?(nodeSize=true,dx=+x[0],dy=+x[1],tree):nodeSize?[dx,dy]:null};return tree}function treemapSlice(parent,x0,y0,x1,y1){var nodes=parent.children,node,i=-1,n=nodes.length,k=parent.value&&(y1-y0)/parent.value;while(++i<n){node=nodes[i],node.x0=x0,node.x1=x1;node.y0=y0,node.y1=y0+=node.value*k}}var phi=(1+Math.sqrt(5))/2;function squarifyRatio(ratio,parent,x0,y0,x1,y1){var rows=[],nodes=parent.children,row,nodeValue,i0=0,i1=0,n=nodes.length,dx,dy,value=parent.value,sumValue,minValue,maxValue,newRatio,minRatio,alpha,beta;while(i0<n){dx=x1-x0,dy=y1-y0;do{sumValue=nodes[i1++].value}while(!sumValue&&i1<n);minValue=maxValue=sumValue;alpha=Math.max(dy/dx,dx/dy)/(value*ratio);beta=sumValue*sumValue*alpha;minRatio=Math.max(maxValue/beta,beta/minValue);for(;i1<n;++i1){sumValue+=nodeValue=nodes[i1].value;if(nodeValue<minValue)minValue=nodeValue;if(nodeValue>maxValue)maxValue=nodeValue;beta=sumValue*sumValue*alpha;newRatio=Math.max(maxValue/beta,beta/minValue);if(newRatio>minRatio){sumValue-=nodeValue;break}minRatio=newRatio}rows.push(row={value:sumValue,dice:dx<dy,children:nodes.slice(i0,i1)});if(row.dice)treemapDice(row,x0,y0,x1,value?y0+=dy*sumValue/value:y1);else treemapSlice(row,x0,y0,value?x0+=dx*sumValue/value:x1,y1);value-=sumValue,i0=i1}return rows}var treemapSquarify=function custom(ratio){function squarify(parent,x0,y0,x1,y1){squarifyRatio(ratio,parent,x0,y0,x1,y1)}squarify.ratio=function(x){return custom((x=+x)>1?x:1)};return squarify}(phi);function treemap(){var tile=treemapSquarify,round=false,dx=1,dy=1,paddingStack=[0],paddingInner=constantZero,paddingTop=constantZero,paddingRight=constantZero,paddingBottom=constantZero,paddingLeft=constantZero;function treemap(root){root.x0=root.y0=0;root.x1=dx;root.y1=dy;root.eachBefore(positionNode);paddingStack=[0];if(round)root.eachBefore(roundNode);return root}function positionNode(node){var p=paddingStack[node.depth],x0=node.x0+p,y0=node.y0+p,x1=node.x1-p,y1=node.y1-p;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;node.x0=x0;node.y0=y0;node.x1=x1;node.y1=y1;if(node.children){p=paddingStack[node.depth+1]=paddingInner(node)/2;x0+=paddingLeft(node)-p;y0+=paddingTop(node)-p;x1-=paddingRight(node)-p;y1-=paddingBottom(node)-p;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;tile(node,x0,y0,x1,y1)}}treemap.round=function(x){return arguments.length?(round=!!x,treemap):round};treemap.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],treemap):[dx,dy]};treemap.tile=function(x){return arguments.length?(tile=required(x),treemap):tile};treemap.padding=function(x){return arguments.length?treemap.paddingInner(x).paddingOuter(x):treemap.paddingInner()};treemap.paddingInner=function(x){return arguments.length?(paddingInner=typeof x==="function"?x:constant$7(+x),treemap):paddingInner};treemap.paddingOuter=function(x){return arguments.length?treemap.paddingTop(x).paddingRight(x).paddingBottom(x).paddingLeft(x):treemap.paddingTop()};treemap.paddingTop=function(x){return arguments.length?(paddingTop=typeof x==="function"?x:constant$7(+x),treemap):paddingTop};treemap.paddingRight=function(x){return arguments.length?(paddingRight=typeof x==="function"?x:constant$7(+x),treemap):paddingRight};treemap.paddingBottom=function(x){return arguments.length?(paddingBottom=typeof x==="function"?x:constant$7(+x),treemap):paddingBottom};treemap.paddingLeft=function(x){return arguments.length?(paddingLeft=typeof x==="function"?x:constant$7(+x),treemap):paddingLeft};return treemap}function treemapBinary(parent,x0,y0,x1,y1){var nodes=parent.children,i,n=nodes.length,sum,sums=new Array(n+1);for(sums[0]=sum=i=0;i<n;++i){sums[i+1]=sum+=nodes[i].value}partition(0,n,parent.value,x0,y0,x1,y1);function partition(i,j,value,x0,y0,x1,y1){if(i>=j-1){var node=nodes[i];node.x0=x0,node.y0=y0;node.x1=x1,node.y1=y1;return}var valueOffset=sums[i],valueTarget=value/2+valueOffset,k=i+1,hi=j-1;while(k<hi){var mid=k+hi>>>1;if(sums[mid]<valueTarget)k=mid+1;else hi=mid}if(valueTarget-sums[k-1]<sums[k]-valueTarget&&i+1<k)--k;var valueLeft=sums[k]-valueOffset,valueRight=value-valueLeft;if(x1-x0>y1-y0){var xk=(x0*valueRight+x1*valueLeft)/value;partition(i,k,valueLeft,x0,y0,xk,y1);partition(k,j,valueRight,xk,y0,x1,y1)}else{var yk=(y0*valueRight+y1*valueLeft)/value;partition(i,k,valueLeft,x0,y0,x1,yk);partition(k,j,valueRight,x0,yk,x1,y1)}}}function treemapSliceDice(parent,x0,y0,x1,y1){(parent.depth&1?treemapSlice:treemapDice)(parent,x0,y0,x1,y1)}var treemapResquarify=function custom(ratio){function resquarify(parent,x0,y0,x1,y1){if((rows=parent._squarify)&&rows.ratio===ratio){var rows,row,nodes,i,j=-1,n,m=rows.length,value=parent.value;while(++j<m){row=rows[j],nodes=row.children;for(i=row.value=0,n=nodes.length;i<n;++i)row.value+=nodes[i].value;if(row.dice)treemapDice(row,x0,y0,x1,y0+=(y1-y0)*row.value/value);else treemapSlice(row,x0,y0,x0+=(x1-x0)*row.value/value,y1);value-=row.value}}else{parent._squarify=rows=squarifyRatio(ratio,parent,x0,y0,x1,y1);rows.ratio=ratio}}resquarify.ratio=function(x){return custom((x=+x)>1?x:1)};return resquarify}(phi);function Nest(params){Transform.call(this,null,params)}Nest.Definition={type:"Nest",metadata:{treesource:true,changes:true},params:[{name:"keys",type:"field",array:true},{name:"generate",type:"boolean"}]};var prototype$17=inherits(Nest,Transform);function children(n){return n.values}prototype$17.transform=function(_,pulse){if(!pulse.source){error("Nest transform requires an upstream data source.")}var gen=_.generate,mod=_.modified(),out=pulse.clone(),tree=this.value;if(!tree||mod||pulse.changed()){if(tree){tree.each(function(node){if(node.children&&isTuple(node.data)){out.rem.push(node.data)}})}this.value=tree=hierarchy({values:array(_.keys).reduce(function(n,k){n.key(k);return n},nest()).entries(out.source)},children);if(gen){tree.each(function(node){if(node.children){node=ingest(node.data);out.add.push(node);out.source.push(node)}})}lookup$3(tree,tupleid,tupleid)}out.source.root=tree;return out};function nest(){var keys=[],nest;function apply(array,depth){if(depth>=keys.length){return array}var i=-1,n=array.length,key=keys[depth++],keyValue,value,valuesByKey={},values,result={};while(++i<n){keyValue=key(value=array[i])+"";if(values=valuesByKey[keyValue]){values.push(value)}else{valuesByKey[keyValue]=[value]}}for(keyValue in valuesByKey){result[keyValue]=apply(valuesByKey[keyValue],depth)}return result}function entries(map,depth){if(++depth>keys.length)return map;var array=[],k;for(k in map){array.push({key:k,values:entries(map[k],depth)})}return array}return nest={entries:function(array){return entries(apply(array,0),0)},key:function(d){keys.push(d);return nest}}}function HierarchyLayout(params){Transform.call(this,null,params)}var prototype$18=inherits(HierarchyLayout,Transform);prototype$18.transform=function(_,pulse){if(!pulse.source||!pulse.source.root){error(this.constructor.name+" transform requires a backing tree data source.")}var layout=this.layout(_.method),fields=this.fields,root=pulse.source.root,as=_.as||fields;if(_.field)root.sum(_.field);if(_.sort)root.sort(_.sort);setParams(layout,this.params,_);if(layout.separation){layout.separation(_.separation!==false?defaultSeparation$2:one)}try{this.value=layout(root)}catch(err){error(err)}root.each(function(node){setFields(node,fields,as)});return pulse.reflow(_.modified()).modifies(as).modifies("leaf")};function setParams(layout,params,_){for(var p,i=0,n=params.length;i<n;++i){p=params[i];if(p in _)layout[p](_[p])}}function setFields(node,fields,as){var t=node.data;for(var i=0,n=fields.length-1;i<n;++i){t[as[i]]=node[fields[i]]}t[as[n]]=node.children?node.children.length:0}function defaultSeparation$2(a,b){return a.parent===b.parent?1:2}var Output=["x","y","r","depth","children"];function Pack(params){HierarchyLayout.call(this,params)}Pack.Definition={type:"Pack",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Output.length,default:Output}]};var prototype$19=inherits(Pack,HierarchyLayout);prototype$19.layout=pack;prototype$19.params=["size","padding"];prototype$19.fields=Output;var Output$1=["x0","y0","x1","y1","depth","children"];function Partition(params){HierarchyLayout.call(this,params)}Partition.Definition={type:"Partition",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Output$1.length,default:Output$1}]};var prototype$1a=inherits(Partition,HierarchyLayout);prototype$1a.layout=partition$2;prototype$1a.params=["size","round","padding"];prototype$1a.fields=Output$1;function Stratify(params){Transform.call(this,null,params)}Stratify.Definition={type:"Stratify",metadata:{treesource:true},params:[{name:"key",type:"field",required:true},{name:"parentKey",type:"field",required:true}]};var prototype$1b=inherits(Stratify,Transform);prototype$1b.transform=function(_,pulse){if(!pulse.source){error("Stratify transform requires an upstream data source.")}var tree=this.value,mod=_.modified(),out=pulse.fork(pulse.ALL).materialize(pulse.SOURCE),run=!this.value||mod||pulse.changed(pulse.ADD_REM)||pulse.modified(_.key.fields)||pulse.modified(_.parentKey.fields);out.source=out.source.slice();if(run){if(out.source.length){tree=lookup$3(stratify().id(_.key).parentId(_.parentKey)(out.source),_.key,truthy)}else{tree=lookup$3(stratify()([{}]),_.key,_.key)}}out.source.root=this.value=tree;return out};var Layouts={tidy:tree,cluster:cluster};var Output$2=["x","y","depth","children"];function Tree(params){HierarchyLayout.call(this,params)}Tree.Definition={type:"Tree",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:true,length:2},{name:"nodeSize",type:"number",array:true,length:2},{name:"separation",type:"boolean",default:true},{name:"as",type:"string",array:true,length:Output$2.length,default:Output$2}]};var prototype$1c=inherits(Tree,HierarchyLayout);prototype$1c.layout=function(method){var m=method||"tidy";if(Layouts.hasOwnProperty(m))return Layouts[m]();else error("Unrecognized Tree layout method: "+m)};prototype$1c.params=["size","nodeSize"];prototype$1c.fields=Output$2;function TreeLinks(params){Transform.call(this,[],params)}TreeLinks.Definition={type:"TreeLinks",metadata:{tree:true,generates:true,changes:true},params:[]};var prototype$1d=inherits(TreeLinks,Transform);prototype$1d.transform=function(_,pulse){var links=this.value,tree=pulse.source&&pulse.source.root,out=pulse.fork(pulse.NO_SOURCE),lut={};if(!tree)error("TreeLinks transform requires a tree data source.");if(pulse.changed(pulse.ADD_REM)){out.rem=links;pulse.visit(pulse.SOURCE,function(t){lut[tupleid(t)]=1});tree.each(function(node){var t=node.data,p=node.parent&&node.parent.data;if(p&&lut[tupleid(t)]&&lut[tupleid(p)]){out.add.push(ingest({source:p,target:t}))}});this.value=out.add}else if(pulse.changed(pulse.MOD)){pulse.visit(pulse.MOD,function(t){lut[tupleid(t)]=1});links.forEach(function(link){if(lut[tupleid(link.source)]||lut[tupleid(link.target)]){out.mod.push(link)}})}return out};var Tiles={binary:treemapBinary,dice:treemapDice,slice:treemapSlice,slicedice:treemapSliceDice,squarify:treemapSquarify,resquarify:treemapResquarify};var Output$3=["x0","y0","x1","y1","depth","children"];function Treemap(params){HierarchyLayout.call(this,params)}Treemap.Definition={type:"Treemap",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:Output$3.length,default:Output$3}]};var prototype$1e=inherits(Treemap,HierarchyLayout);prototype$1e.layout=function(){var x=treemap();x.ratio=function(_){var t=x.tile();if(t.ratio)x.tile(t.ratio(_))};x.method=function(_){if(Tiles.hasOwnProperty(_))x.tile(Tiles[_]);else error("Unrecognized Treemap layout method: "+_)};return x};prototype$1e.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"];prototype$1e.fields=Output$3;var tree$1=Object.freeze({nest:Nest,pack:Pack,partition:Partition,stratify:Stratify,tree:Tree,treelinks:TreeLinks,treemap:Treemap});function constant$8(x){return function(){return x}}function x$4(d){return d[0]}function y$4(d){return d[1]}function RedBlackTree(){this._=null}function RedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}RedBlackTree.prototype={constructor:RedBlackTree,insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node}else{after.R=node}parent=after}else if(this._){after=RedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after}else{node.P=node.N=null;this._=node;parent=null}node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.R){RedBlackRotateLeft(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;RedBlackRotateRight(this,grandpa)}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.L){RedBlackRotateRight(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;RedBlackRotateLeft(this,grandpa)}}parent=after.U}this._.C=false},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=RedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next}else{this._=next}if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next}else{next.U=parent;parent=next;node=next.R}}else{red=node.C;node=next}if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return}do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;RedBlackRotateLeft(this,parent);sibling=parent.R}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;RedBlackRotateRight(this,sibling);sibling=parent.R}sibling.C=parent.C;parent.C=sibling.R.C=false;RedBlackRotateLeft(this,parent);node=this._;break}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;RedBlackRotateRight(this,parent);sibling=parent.L}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;RedBlackRotateLeft(this,sibling);sibling=parent.L}sibling.C=parent.C;parent.C=sibling.L.C=false;RedBlackRotateRight(this,parent);node=this._;break}}sibling.C=true;node=parent;parent=parent.U}while(!node.C);if(node)node.C=false}};function RedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p}function RedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p}function RedBlackFirst(node){while(node.L)node=node.L;return node}function createEdge(left,right,v0,v1){var edge=[null,null],index=edges.push(edge)-1;edge.left=left;edge.right=right;if(v0)setEdgeEnd(edge,left,right,v0);if(v1)setEdgeEnd(edge,right,left,v1);cells[left.index].halfedges.push(index);cells[right.index].halfedges.push(index);return edge}function createBorderEdge(left,v0,v1){var edge=[v0,v1];edge.left=left;return edge}function setEdgeEnd(edge,left,right,vertex){if(!edge[0]&&!edge[1]){edge[0]=vertex;edge.left=left;edge.right=right}else if(edge.left===right){edge[1]=vertex}else{edge[0]=vertex}}function clipEdge(edge,x0,y0,x1,y1){var a=edge[0],b=edge[1],ax=a[0],ay=a[1],bx=b[0],by=b[1],t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(!(t0>0)&&!(t1<1))return true;if(t0>0)edge[0]=[ax+t0*dx,ay+t0*dy];if(t1<1)edge[1]=[ax+t1*dx,ay+t1*dy];return true}function connectEdge(edge,x0,y0,x1,y1){var v1=edge[1];if(v1)return true;var v0=edge[0],left=edge.left,right=edge.right,lx=left[0],ly=left[1],rx=right[0],ry=right[1],fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!v0)v0=[fx,y0];else if(v0[1]>=y1)return;v1=[fx,y1]}else{if(!v0)v0=[fx,y1];else if(v0[1]<y0)return;v1=[fx,y0]}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!v0)v0=[(y0-fb)/fm,y0];else if(v0[1]>=y1)return;v1=[(y1-fb)/fm,y1]}else{if(!v0)v0=[(y1-fb)/fm,y1];else if(v0[1]<y0)return;v1=[(y0-fb)/fm,y0]}}else{if(ly<ry){if(!v0)v0=[x0,fm*x0+fb];else if(v0[0]>=x1)return;v1=[x1,fm*x1+fb]}else{if(!v0)v0=[x1,fm*x1+fb];else if(v0[0]<x0)return;v1=[x0,fm*x0+fb]}}}edge[0]=v0;edge[1]=v1;return true}function clipEdges(x0,y0,x1,y1){var i=edges.length,edge;while(i--){if(!connectEdge(edge=edges[i],x0,y0,x1,y1)||!clipEdge(edge,x0,y0,x1,y1)||!(Math.abs(edge[0][0]-edge[1][0])>epsilon$3||Math.abs(edge[0][1]-edge[1][1])>epsilon$3)){delete edges[i]}}}function createCell(site){return cells[site.index]={site:site,halfedges:[]}}function cellHalfedgeAngle(cell,edge){var site=cell.site,va=edge.left,vb=edge.right;if(site===vb)vb=va,va=site;if(vb)return Math.atan2(vb[1]-va[1],vb[0]-va[0]);if(site===va)va=edge[1],vb=edge[0];else va=edge[0],vb=edge[1];return Math.atan2(va[0]-vb[0],vb[1]-va[1])}function cellHalfedgeStart(cell,edge){return edge[+(edge.left!==cell.site)]}function cellHalfedgeEnd(cell,edge){return edge[+(edge.left===cell.site)]}function sortCellHalfedges(){for(var i=0,n=cells.length,cell,halfedges,j,m;i<n;++i){if((cell=cells[i])&&(m=(halfedges=cell.halfedges).length)){var index=new Array(m),array=new Array(m);for(j=0;j<m;++j)index[j]=j,array[j]=cellHalfedgeAngle(cell,edges[halfedges[j]]);index.sort(function(i,j){return array[j]-array[i]});for(j=0;j<m;++j)array[j]=halfedges[index[j]];for(j=0;j<m;++j)halfedges[j]=array[j]}}}function clipCells(x0,y0,x1,y1){var nCells=cells.length,iCell,cell,site,iHalfedge,halfedges,nHalfedges,start,startX,startY,end,endX,endY,cover=true;for(iCell=0;iCell<nCells;++iCell){if(cell=cells[iCell]){site=cell.site;halfedges=cell.halfedges;iHalfedge=halfedges.length;while(iHalfedge--){if(!edges[halfedges[iHalfedge]]){halfedges.splice(iHalfedge,1)}}iHalfedge=0,nHalfedges=halfedges.length;while(iHalfedge<nHalfedges){end=cellHalfedgeEnd(cell,edges[halfedges[iHalfedge]]),endX=end[0],endY=end[1];start=cellHalfedgeStart(cell,edges[halfedges[++iHalfedge%nHalfedges]]),startX=start[0],startY=start[1];if(Math.abs(endX-startX)>epsilon$3||Math.abs(endY-startY)>epsilon$3){halfedges.splice(iHalfedge,0,edges.push(createBorderEdge(site,end,Math.abs(endX-x0)<epsilon$3&&y1-endY>epsilon$3?[x0,Math.abs(startX-x0)<epsilon$3?startY:y1]:Math.abs(endY-y1)<epsilon$3&&x1-endX>epsilon$3?[Math.abs(startY-y1)<epsilon$3?startX:x1,y1]:Math.abs(endX-x1)<epsilon$3&&endY-y0>epsilon$3?[x1,Math.abs(startX-x1)<epsilon$3?startY:y0]:Math.abs(endY-y0)<epsilon$3&&endX-x0>epsilon$3?[Math.abs(startY-y0)<epsilon$3?startX:x0,y0]:null))-1);++nHalfedges}}if(nHalfedges)cover=false}}if(cover){var dx,dy,d2,dc=Infinity;for(iCell=0,cover=null;iCell<nCells;++iCell){if(cell=cells[iCell]){site=cell.site;dx=site[0]-x0;dy=site[1]-y0;d2=dx*dx+dy*dy;if(d2<dc)dc=d2,cover=cell}}if(cover){var v00=[x0,y0],v01=[x0,y1],v11=[x1,y1],v10=[x1,y0];cover.halfedges.push(edges.push(createBorderEdge(site=cover.site,v00,v01))-1,edges.push(createBorderEdge(site,v01,v11))-1,edges.push(createBorderEdge(site,v11,v10))-1,edges.push(createBorderEdge(site,v10,v00))-1)}}for(iCell=0;iCell<nCells;++iCell){if(cell=cells[iCell]){if(!cell.halfedges.length){delete cells[iCell]}}}}var circlePool=[];var firstCircle;function Circle(){RedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null}function attachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite[0],by=cSite[1],ax=lSite[0]-bx,ay=lSite[1]-by,cx=rSite[0]-bx,cy=rSite[1]-by;var d=2*(ax*cy-ay*cx);if(d>=-epsilon2$2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d;var circle=circlePool.pop()||new Circle;circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=(circle.cy=y+by)+Math.sqrt(x*x+y*y);arc.circle=circle;var before=null,node=circles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break}}else{if(node.R)node=node.R;else{before=node;break}}}circles.insert(before,circle);if(!before)firstCircle=circle}function detachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)firstCircle=circle.N;circles.remove(circle);circlePool.push(circle);RedBlackNode(circle);arc.circle=null}}var beachPool=[];function Beach(){RedBlackNode(this);this.edge=this.site=this.circle=null}function createBeach(site){var beach=beachPool.pop()||new Beach;beach.site=site;return beach}function detachBeach(beach){detachCircle(beach);beaches.remove(beach);beachPool.push(beach);RedBlackNode(beach)}function removeBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex=[x,y],previous=beach.P,next=beach.N,disappearing=[beach];detachBeach(beach);var lArc=previous;while(lArc.circle&&Math.abs(x-lArc.circle.x)<epsilon$3&&Math.abs(y-lArc.circle.cy)<epsilon$3){previous=lArc.P;disappearing.unshift(lArc);detachBeach(lArc);lArc=previous}disappearing.unshift(lArc);detachCircle(lArc);var rArc=next;while(rArc.circle&&Math.abs(x-rArc.circle.x)<epsilon$3&&Math.abs(y-rArc.circle.cy)<epsilon$3){next=rArc.N;disappearing.push(rArc);detachBeach(rArc);rArc=next}disappearing.push(rArc);detachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];setEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex)}lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=createEdge(lArc.site,rArc.site,null,vertex);attachCircle(lArc);attachCircle(rArc)}function addBeach(site){var x=site[0],directrix=site[1],lArc,rArc,dxl,dxr,node=beaches._;while(node){dxl=leftBreakPoint(node,directrix)-x;if(dxl>epsilon$3)node=node.L;else{dxr=x-rightBreakPoint(node,directrix);if(dxr>epsilon$3){if(!node.R){lArc=node;break}node=node.R}else{if(dxl>-epsilon$3){lArc=node.P;rArc=node}else if(dxr>-epsilon$3){lArc=node;rArc=node.N}else{lArc=rArc=node}break}}}createCell(site);var newArc=createBeach(site);beaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){detachCircle(lArc);rArc=createBeach(lArc.site);beaches.insert(newArc,rArc);newArc.edge=rArc.edge=createEdge(lArc.site,newArc.site);attachCircle(lArc);attachCircle(rArc);return}if(!rArc){newArc.edge=createEdge(lArc.site,newArc.site);return}detachCircle(lArc);detachCircle(rArc);var lSite=lArc.site,ax=lSite[0],ay=lSite[1],bx=site[0]-ax,by=site[1]-ay,rSite=rArc.site,cx=rSite[0]-ax,cy=rSite[1]-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex=[(cy*hb-by*hc)/d+ax,(bx*hc-cx*hb)/d+ay];setEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=createEdge(lSite,site,null,vertex);rArc.edge=createEdge(site,rSite,null,vertex);attachCircle(lArc);attachCircle(rArc)}function leftBreakPoint(arc,directrix){var site=arc.site,rfocx=site[0],rfocy=site[1],pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site[0],lfocy=site[1],plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2}function rightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return leftBreakPoint(rArc,directrix);var site=arc.site;return site[1]===directrix?site[0]:Infinity}var epsilon$3=1e-6;var epsilon2$2=1e-12;var beaches;var cells;var circles;var edges;function triangleArea(a,b,c){return(a[0]-c[0])*(b[1]-a[1])-(a[0]-b[0])*(c[1]-a[1])}function lexicographic(a,b){return b[1]-a[1]||b[0]-a[0]}function Diagram(sites,extent){var site=sites.sort(lexicographic).pop(),x,y,circle;edges=[];cells=new Array(sites.length);beaches=new RedBlackTree;circles=new RedBlackTree;while(true){circle=firstCircle;if(site&&(!circle||site[1]<circle.y||site[1]===circle.y&&site[0]<circle.x)){if(site[0]!==x||site[1]!==y){addBeach(site);x=site[0],y=site[1]}site=sites.pop()}else if(circle){removeBeach(circle.arc)}else{break}}sortCellHalfedges();if(extent){var x0=+extent[0][0],y0=+extent[0][1],x1=+extent[1][0],y1=+extent[1][1];clipEdges(x0,y0,x1,y1);clipCells(x0,y0,x1,y1)}this.edges=edges;this.cells=cells;beaches=circles=edges=cells=null}Diagram.prototype={constructor:Diagram,polygons:function(){var edges=this.edges;return this.cells.map(function(cell){var polygon=cell.halfedges.map(function(i){return cellHalfedgeStart(cell,edges[i])});polygon.data=cell.site.data;return polygon})},triangles:function(){var triangles=[],edges=this.edges;this.cells.forEach(function(cell,i){if(!(m=(halfedges=cell.halfedges).length))return;var site=cell.site,halfedges,j=-1,m,s0,e1=edges[halfedges[m-1]],s1=e1.left===site?e1.right:e1.left;while(++j<m){s0=s1;e1=edges[halfedges[j]];s1=e1.left===site?e1.right:e1.left;if(s0&&s1&&i<s0.index&&i<s1.index&&triangleArea(site,s0,s1)<0){triangles.push([site.data,s0.data,s1.data])}}});return triangles},links:function(){return this.edges.filter(function(edge){return edge.right}).map(function(edge){return{source:edge.left.data,target:edge.right.data}})},find:function(x,y,radius){var that=this,i0,i1=that._found||0,n=that.cells.length,cell;while(!(cell=that.cells[i1]))if(++i1>=n)return null;var dx=x-cell.site[0],dy=y-cell.site[1],d2=dx*dx+dy*dy;do{cell=that.cells[i0=i1],i1=null;cell.halfedges.forEach(function(e){var edge=that.edges[e],v=edge.left;if((v===cell.site||!v)&&!(v=edge.right))return;var vx=x-v[0],vy=y-v[1],v2=vx*vx+vy*vy;if(v2<d2)d2=v2,i1=v.index})}while(i1!==null);that._found=i0;return radius==null||d2<=radius*radius?cell.site:null}};function voronoi(){var x=x$4,y=y$4,extent=null;function voronoi(data){return new Diagram(data.map(function(d,i){var s=[Math.round(x(d,i,data)/epsilon$3)*epsilon$3,Math.round(y(d,i,data)/epsilon$3)*epsilon$3];s.index=i;s.data=d;return s}),extent)}voronoi.polygons=function(data){return voronoi(data).polygons()};voronoi.links=function(data){return voronoi(data).links()};voronoi.triangles=function(data){return voronoi(data).triangles()};voronoi.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$8(+_),voronoi):x};voronoi.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$8(+_),voronoi):y};voronoi.extent=function(_){return arguments.length?(extent=_==null?null:[[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]],voronoi):extent&&[[extent[0][0],extent[0][1]],[extent[1][0],extent[1][1]]]};voronoi.size=function(_){return arguments.length?(extent=_==null?null:[[0,0],[+_[0],+_[1]]],voronoi):extent&&[extent[1][0]-extent[0][0],extent[1][1]-extent[0][1]]};return voronoi}function Voronoi(params){Transform.call(this,null,params)}Voronoi.Definition={type:"Voronoi",metadata:{modifies:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"size",type:"number",array:true,length:2},{name:"extent",type:"array",array:true,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:true,length:2}},{name:"as",type:"string",default:"path"}]};var prototype$1f=inherits(Voronoi,Transform);var defaultExtent=[[-1e5,-1e5],[1e5,1e5]];prototype$1f.transform=function(_,pulse){var as=_.as||"path",data=pulse.source,diagram,polygons,i,n;diagram=voronoi().x(_.x).y(_.y);if(_.size)diagram.size(_.size);else diagram.extent(_.extent||defaultExtent);this.value=diagram=diagram(data);polygons=diagram.polygons();for(i=0,n=data.length;i<n;++i){data[i][as]=polygons[i]?"M"+polygons[i].join("L")+"Z":null}return pulse.reflow(_.modified()).modifies(as)};var voronoi$1=Object.freeze({voronoi:Voronoi});var cloudRadians=Math.PI/180,cw=1<<11>>5,ch=1<<11;function cloud(){var size=[256,256],text,font,fontSize,fontStyle,fontWeight,rotate,padding,spiral=archimedeanSpiral,words=[],random=Math.random,cloud={};cloud.layout=function(){var contextAndRatio=getContext(domCanvas()),board=zeroArray((size[0]>>5)*size[1]),bounds=null,n=words.length,i=-1,tags=[],data=words.map(function(d){return{text:text(d),font:font(d),style:fontStyle(d),weight:fontWeight(d),rotate:rotate(d),size:~~fontSize(d),padding:padding(d),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:false,sprite:null,datum:d}}).sort(function(a,b){return b.size-a.size});while(++i<n){var d=data[i];d.x=size[0]*(random()+.5)>>1;d.y=size[1]*(random()+.5)>>1;cloudSprite(contextAndRatio,d,data,i);if(d.hasText&&place(board,d,bounds)){tags.push(d);if(bounds)cloudBounds(bounds,d);else bounds=[{x:d.x+d.x0,y:d.y+d.y0},{x:d.x+d.x1,y:d.y+d.y1}];d.x-=size[0]>>1;d.y-=size[1]>>1}}return tags};function getContext(canvas){canvas.width=canvas.height=1;var ratio=Math.sqrt(canvas.getContext("2d").getImageData(0,0,1,1).data.length>>2);canvas.width=(cw<<5)/ratio;canvas.height=ch/ratio;var context=canvas.getContext("2d");context.fillStyle=context.strokeStyle="red";context.textAlign="center";return{context:context,ratio:ratio}}function place(board,tag,bounds){var startX=tag.x,startY=tag.y,maxDelta=Math.sqrt(size[0]*size[0]+size[1]*size[1]),s=spiral(size),dt=random()<.5?1:-1,t=-dt,dxdy,dx,dy;while(dxdy=s(t+=dt)){dx=~~dxdy[0];dy=~~dxdy[1];if(Math.min(Math.abs(dx),Math.abs(dy))>=maxDelta)break;tag.x=startX+dx;tag.y=startY+dy;if(tag.x+tag.x0<0||tag.y+tag.y0<0||tag.x+tag.x1>size[0]||tag.y+tag.y1>size[1])continue;if(!bounds||!cloudCollide(tag,board,size[0])){if(!bounds||collideRects(tag,bounds)){var sprite=tag.sprite,w=tag.width>>5,sw=size[0]>>5,lx=tag.x-(w<<4),sx=lx&127,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){board[x+i]|=last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0)}x+=sw}tag.sprite=null;return true}}}return false}cloud.words=function(_){if(arguments.length){words=_;return cloud}else{return words}};cloud.size=function(_){if(arguments.length){size=[+_[0],+_[1]];return cloud}else{return size}};cloud.font=function(_){if(arguments.length){font=functor(_);return cloud}else{return font}};cloud.fontStyle=function(_){if(arguments.length){fontStyle=functor(_);return cloud}else{return fontStyle}};cloud.fontWeight=function(_){if(arguments.length){fontWeight=functor(_);return cloud}else{return fontWeight}};cloud.rotate=function(_){if(arguments.length){rotate=functor(_);return cloud}else{return rotate}};cloud.text=function(_){if(arguments.length){text=functor(_);return cloud}else{return text}};cloud.spiral=function(_){if(arguments.length){spiral=spirals[_]||_;return cloud}else{return spiral}};cloud.fontSize=function(_){if(arguments.length){fontSize=functor(_);return cloud}else{return fontSize}};cloud.padding=function(_){if(arguments.length){padding=functor(_);return cloud}else{return padding}};cloud.random=function(_){if(arguments.length){random=_;return cloud}else{return random}};return cloud}function cloudSprite(contextAndRatio,d,data,di){if(d.sprite)return;var c=contextAndRatio.context,ratio=contextAndRatio.ratio;c.clearRect(0,0,(cw<<5)/ratio,ch/ratio);var x=0,y=0,maxh=0,n=data.length,w,w32,h,i,j;--di;while(++di<n){d=data[di];c.save();c.font=d.style+" "+d.weight+" "+~~((d.size+1)/ratio)+"px "+d.font;w=c.measureText(d.text+"m").width*ratio;h=d.size<<1;if(d.rotate){var sr=Math.sin(d.rotate*cloudRadians),cr=Math.cos(d.rotate*cloudRadians),wcr=w*cr,wsr=w*sr,hcr=h*cr,hsr=h*sr;w=Math.max(Math.abs(wcr+hsr),Math.abs(wcr-hsr))+31>>5<<5;h=~~Math.max(Math.abs(wsr+hcr),Math.abs(wsr-hcr))}else{w=w+31>>5<<5}if(h>maxh)maxh=h;if(x+w>=cw<<5){x=0;y+=maxh;maxh=0}if(y+h>=ch)break;c.translate((x+(w>>1))/ratio,(y+(h>>1))/ratio);if(d.rotate)c.rotate(d.rotate*cloudRadians);c.fillText(d.text,0,0);if(d.padding){c.lineWidth=2*d.padding;c.strokeText(d.text,0,0)}c.restore();d.width=w;d.height=h;d.xoff=x;d.yoff=y;d.x1=w>>1;d.y1=h>>1;d.x0=-d.x1;d.y0=-d.y1;d.hasText=true;x+=w}var pixels=c.getImageData(0,0,(cw<<5)/ratio,ch/ratio).data,sprite=[];while(--di>=0){d=data[di];if(!d.hasText)continue;w=d.width;w32=w>>5;h=d.y1-d.y0;for(i=0;i<h*w32;i++)sprite[i]=0;x=d.xoff;if(x==null)return;y=d.yoff;var seen=0,seenRow=-1;for(j=0;j<h;j++){for(i=0;i<w;i++){var k=w32*j+(i>>5),m=pixels[(y+j)*(cw<<5)+(x+i)<<2]?1<<31-i%32:0;sprite[k]|=m;seen|=m}if(seen)seenRow=j;else{d.y0++;h--;j--;y++}}d.y1=d.y0+seenRow;d.sprite=sprite.slice(0,(d.y1-d.y0)*w32)}}function cloudCollide(tag,board,sw){sw>>=5;var sprite=tag.sprite,w=tag.width>>5,lx=tag.x-(w<<4),sx=lx&127,msx=32-sx,h=tag.y1-tag.y0,x=(tag.y+tag.y0)*sw+(lx>>5),last;for(var j=0;j<h;j++){last=0;for(var i=0;i<=w;i++){if((last<<msx|(i<w?(last=sprite[j*w+i])>>>sx:0))&board[x+i])return true}x+=sw}return false}function cloudBounds(bounds,d){var b0=bounds[0],b1=bounds[1];if(d.x+d.x0<b0.x)b0.x=d.x+d.x0;if(d.y+d.y0<b0.y)b0.y=d.y+d.y0;if(d.x+d.x1>b1.x)b1.x=d.x+d.x1;if(d.y+d.y1>b1.y)b1.y=d.y+d.y1}function collideRects(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function archimedeanSpiral(size){var e=size[0]/size[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function rectangularSpiral(size){var dy=4,dx=dy*size[0]/size[1],x=0,y=0;return function(t){var sign=t<0?-1:1;switch(Math.sqrt(1+4*sign*t)-sign&3){case 0:x+=dx;break;case 1:y+=dy;break;case 2:x-=dx;break;default:y-=dy;break}return[x,y]}}function zeroArray(n){var a=[],i=-1;while(++i<n)a[i]=0;return a}function functor(d){return typeof d==="function"?d:function(){return d}}var spirals={archimedean:archimedeanSpiral,rectangular:rectangularSpiral};var Output$4=["x","y","font","fontSize","fontStyle","fontWeight","angle"];var Params$1=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Wordcloud(params){Transform.call(this,cloud(),params)}Wordcloud.Definition={type:"Wordcloud",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2},{name:"font",type:"string",expr:true,default:"sans-serif"},{name:"fontStyle",type:"string",expr:true,default:"normal"},{name:"fontWeight",type:"string",expr:true,default:"normal"},{name:"fontSize",type:"number",expr:true,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:true,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:true},{name:"as",type:"string",array:true,length:7,default:Output$4}]};var prototype$1g=inherits(Wordcloud,Transform);prototype$1g.transform=function(_,pulse){if(_.size&&!(_.size[0]&&_.size[1])){error("Wordcloud size dimensions must be non-zero.")}function modp(param){var p=_[param];return isFunction(p)&&pulse.modified(p.fields)}var mod=_.modified();if(!(mod||pulse.changed(pulse.ADD_REM)||Params$1.some(modp)))return;var data=pulse.materialize(pulse.SOURCE).source,layout=this.value,as=_.as||Output$4,fontSize=_.fontSize||14,range;isFunction(fontSize)?range=_.fontSizeRange:fontSize=constant(fontSize);if(range){var fsize=fontSize,sizeScale=scale$1("sqrt")().domain(extent$3(fsize,data)).range(range);fontSize=function(x){return sizeScale(fsize(x))}}data.forEach(function(t){t[as[0]]=NaN;t[as[1]]=NaN;t[as[3]]=0});var words=layout.words(data).text(_.text).size(_.size||[500,500]).padding(_.padding||1).spiral(_.spiral||"archimedean").rotate(_.rotate||0).font(_.font||"sans-serif").fontStyle(_.fontStyle||"normal").fontWeight(_.fontWeight||"normal").fontSize(fontSize).random(exports.random).layout();var size=layout.size(),dx=size[0]>>1,dy=size[1]>>1,i=0,n=words.length,w,t;for(;i<n;++i){w=words[i];t=w.datum;t[as[0]]=w.x+dx;t[as[1]]=w.y+dy;t[as[2]]=w.font;t[as[3]]=w.size;t[as[4]]=w.style;t[as[5]]=w.weight;t[as[6]]=w.rotate}return pulse.reflow(mod).modifies(as)};function extent$3(field,data){var min=+Infinity,max=-Infinity,i=0,n=data.length,v;for(;i<n;++i){v=field(data[i]);if(v<min)min=v;if(v>max)max=v}return[min,max]}var wordcloud=Object.freeze({wordcloud:Wordcloud});function array8(n){return new Uint8Array(n)}function array16(n){return new Uint16Array(n)}function array32(n){return new Uint32Array(n)}function Bitmaps(){var width=8,data=[],seen=array32(0),curr=array$3(0,width),prev=array$3(0,width);return{data:function(){return data},seen:function(){return seen=lengthen(seen,data.length)},add:function(array){for(var i=0,j=data.length,n=array.length,t;i<n;++i){t=array[i];t._index=j++;data.push(t)}},remove:function(num,map){var n=data.length,copy=Array(n-num),reindex=data,t,i,j;for(i=0;!map[i]&&i<n;++i){copy[i]=data[i];reindex[i]=i}for(j=i;i<n;++i){t=data[i];if(!map[i]){reindex[i]=j;curr[j]=curr[i];prev[j]=prev[i];copy[j]=t;t._index=j++}else{reindex[i]=-1}curr[i]=0}data=copy;return reindex},size:function(){return data.length},curr:function(){return curr},prev:function(){return prev},reset:function(k){prev[k]=curr[k]},all:function(){return width<257?255:width<65537?65535:4294967295},set:function(k,one){curr[k]|=one},clear:function(k,one){curr[k]&=~one},resize:function(n,m){var k=curr.length;if(n>k||m>width){width=Math.max(m,width);curr=array$3(n,width,curr);prev=array$3(n,width)}}}}function lengthen(array,length,copy){if(array.length>=length)return array;copy=copy||new array.constructor(length);copy.set(array);return copy}function array$3(n,m,array){var copy=(m<257?array8:m<65537?array16:array32)(n);if(array)copy.set(array);return copy}function Dimension(index,i,query){var bit=1<<i;return{one:bit,zero:~bit,range:query.slice(),bisect:index.bisect,index:index.index,size:index.size,onAdd:function(added,curr){var dim=this,range=dim.bisect(dim.range,added.value),idx=added.index,lo=range[0],hi=range[1],n1=idx.length,i;for(i=0;i<lo;++i)curr[idx[i]]|=bit;for(i=hi;i<n1;++i)curr[idx[i]]|=bit;return dim}}}function SortedIndex(){var index=array32(0),value=[],size=0;function insert(key,data,base){if(!data.length)return[];var n0=size,n1=data.length,addv=Array(n1),addi=array32(n1),oldv,oldi,i;for(i=0;i<n1;++i){addv[i]=key(data[i]);addi[i]=i}addv=sort(addv,addi);if(n0){oldv=value;oldi=index;value=Array(n0+n1);index=array32(n0+n1);merge$2(base,oldv,oldi,n0,addv,addi,n1,value,index)}else{if(base>0)for(i=0;i<n1;++i){addi[i]+=base}value=addv;index=addi}size=n0+n1;return{index:addi,value:addv}}function remove(num,map){var n=size,idx,i,j;for(i=0;!map[index[i]]&&i<n;++i);for(j=i;i<n;++i){if(!map[idx=index[i]]){index[j]=idx;value[j]=value[i];++j}}size=n-num}function reindex(map){for(var i=0,n=size;i<n;++i){index[i]=map[index[i]]}}function bisect(range,array){var n;if(array){n=array.length}else{array=value;n=size}return[bisectLeft(array,range[0],0,n),bisectRight(array,range[1],0,n)]}return{insert:insert,remove:remove,bisect:bisect,reindex:reindex,index:function(){return index},size:function(){return size}}}function sort(values,index){values.sort.call(index,function(a,b){var x=values[a],y=values[b];return x<y?-1:x>y?1:0});return permute(values,index)}function merge$2(base,value0,index0,n0,value1,index1,n1,value,index){var i0=0,i1=0,i;for(i=0;i0<n0&&i1<n1;++i){if(value0[i0]<value1[i1]){value[i]=value0[i0];index[i]=index0[i0++]}else{value[i]=value1[i1];index[i]=index1[i1++]+base}}for(;i0<n0;++i0,++i){value[i]=value0[i0];index[i]=index0[i0]}for(;i1<n1;++i1,++i){value[i]=value1[i1];index[i]=index1[i1]+base}}function CrossFilter(params){Transform.call(this,Bitmaps(),params);this._indices=null;this._dims=null}CrossFilter.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:true,required:true},{name:"query",type:"array",array:true,required:true,content:{type:"number",array:true,length:2}}]};var prototype$1h=inherits(CrossFilter,Transform);prototype$1h.transform=function(_,pulse){if(!this._dims){return this.init(_,pulse)}else{var init=_.modified("fields")||_.fields.some(function(f){return pulse.modified(f.fields)});return init?this.reinit(_,pulse):this.eval(_,pulse)}};prototype$1h.init=function(_,pulse){var fields=_.fields,query=_.query,indices=this._indices={},dims=this._dims=[],m=query.length,i=0,key,index;for(;i<m;++i){key=fields[i].fname;index=indices[key]||(indices[key]=SortedIndex());dims.push(Dimension(index,i,query[i]))}return this.eval(_,pulse)};prototype$1h.reinit=function(_,pulse){var output=pulse.materialize().fork(),fields=_.fields,query=_.query,indices=this._indices,dims=this._dims,bits=this.value,curr=bits.curr(),prev=bits.prev(),all=bits.all(),out=output.rem=output.add,mod=output.mod,m=query.length,adds={},add,index,key,mods,remMap,modMap,i,n,f;prev.set(curr);if(pulse.rem.length){remMap=this.remove(_,pulse,output)}if(pulse.add.length){bits.add(pulse.add)}if(pulse.mod.length){modMap={};for(mods=pulse.mod,i=0,n=mods.length;i<n;++i){modMap[mods[i]._index]=1}}for(i=0;i<m;++i){f=fields[i];if(!dims[i]||_.modified("fields",i)||pulse.modified(f.fields)){key=f.fname;if(!(add=adds[key])){indices[key]=index=SortedIndex();adds[key]=add=index.insert(f,pulse.source,0)}dims[i]=Dimension(index,i,query[i]).onAdd(add,curr)}}for(i=0,n=bits.data().length;i<n;++i){if(remMap[i]){continue}else if(prev[i]!==curr[i]){out.push(i)}else if(modMap[i]&&curr[i]!==all){mod.push(i)}}bits.mask=(1<<m)-1;return output};prototype$1h.eval=function(_,pulse){var output=pulse.materialize().fork(),m=this._dims.length,mask=0;if(pulse.rem.length){this.remove(_,pulse,output);mask|=(1<<m)-1}if(_.modified("query")&&!_.modified("fields")){mask|=this.update(_,pulse,output)}if(pulse.add.length){this.insert(_,pulse,output);mask|=(1<<m)-1}if(pulse.mod.length){this.modify(pulse,output);mask|=(1<<m)-1}this.value.mask=mask;return output};prototype$1h.insert=function(_,pulse,output){var tuples=pulse.add,bits=this.value,dims=this._dims,indices=this._indices,fields=_.fields,adds={},out=output.add,k=bits.size(),n=k+tuples.length,m=dims.length,j,key,add;bits.resize(n,m);bits.add(tuples);var curr=bits.curr(),prev=bits.prev(),all=bits.all();for(j=0;j<m;++j){key=fields[j].fname;add=adds[key]||(adds[key]=indices[key].insert(fields[j],tuples,k));dims[j].onAdd(add,curr)}for(;k<n;++k){prev[k]=all;if(curr[k]!==all)out.push(k)}};prototype$1h.modify=function(pulse,output){var out=output.mod,bits=this.value,curr=bits.curr(),all=bits.all(),tuples=pulse.mod,i,n,k;for(i=0,n=tuples.length;i<n;++i){k=tuples[i]._index;if(curr[k]!==all)out.push(k)}};prototype$1h.remove=function(_,pulse,output){var indices=this._indices,bits=this.value,curr=bits.curr(),prev=bits.prev(),all=bits.all(),map={},out=output.rem,tuples=pulse.rem,i,n,k,f;for(i=0,n=tuples.length;i<n;++i){k=tuples[i]._index;map[k]=1;prev[k]=f=curr[k];curr[k]=all;if(f!==all)out.push(k)}for(k in indices){indices[k].remove(n,map)}this.reindex(pulse,n,map);return map};prototype$1h.reindex=function(pulse,num,map){var indices=this._indices,bits=this.value;pulse.runAfter(function(){var indexMap=bits.remove(num,map);for(var key in indices)indices[key].reindex(indexMap)})};prototype$1h.update=function(_,pulse,output){var dims=this._dims,query=_.query,stamp=pulse.stamp,m=dims.length,mask=0,i,q;output.filters=0;for(q=0;q<m;++q){if(_.modified("query",q)){i=q;++mask}}if(mask===1){mask=dims[i].one;this.incrementOne(dims[i],query[i],output.add,output.rem)}else{for(q=0,mask=0;q<m;++q){if(!_.modified("query",q))continue;mask|=dims[q].one;this.incrementAll(dims[q],query[q],stamp,output.add);output.rem=output.add}}return mask};prototype$1h.incrementAll=function(dim,query,stamp,out){var bits=this.value,seen=bits.seen(),curr=bits.curr(),prev=bits.prev(),index=dim.index(),old=dim.bisect(dim.range),range=dim.bisect(query),lo1=range[0],hi1=range[1],lo0=old[0],hi0=old[1],one=dim.one,i,j,k;if(lo1<lo0){for(i=lo1,j=Math.min(lo0,hi1);i<j;++i){k=index[i];if(seen[k]!==stamp){prev[k]=curr[k];seen[k]=stamp;out.push(k)}curr[k]^=one}}else if(lo1>lo0){for(i=lo0,j=Math.min(lo1,hi0);i<j;++i){k=index[i];if(seen[k]!==stamp){prev[k]=curr[k];seen[k]=stamp;out.push(k)}curr[k]^=one}}if(hi1>hi0){for(i=Math.max(lo1,hi0),j=hi1;i<j;++i){k=index[i];if(seen[k]!==stamp){prev[k]=curr[k];seen[k]=stamp;out.push(k)}curr[k]^=one}}else if(hi1<hi0){for(i=Math.max(lo0,hi1),j=hi0;i<j;++i){k=index[i];if(seen[k]!==stamp){prev[k]=curr[k];seen[k]=stamp;out.push(k)}curr[k]^=one}}dim.range=query.slice()};prototype$1h.incrementOne=function(dim,query,add,rem){var bits=this.value,curr=bits.curr(),index=dim.index(),old=dim.bisect(dim.range),range=dim.bisect(query),lo1=range[0],hi1=range[1],lo0=old[0],hi0=old[1],one=dim.one,i,j,k;if(lo1<lo0){for(i=lo1,j=Math.min(lo0,hi1);i<j;++i){k=index[i];curr[k]^=one;add.push(k)}}else if(lo1>lo0){for(i=lo0,j=Math.min(lo1,hi0);i<j;++i){k=index[i];curr[k]^=one;rem.push(k)}}if(hi1>hi0){for(i=Math.max(lo1,hi0),j=hi1;i<j;++i){k=index[i];curr[k]^=one;add.push(k)}}else if(hi1<hi0){for(i=Math.max(lo0,hi1),j=hi0;i<j;++i){k=index[i];curr[k]^=one;rem.push(k)}}dim.range=query.slice()};function ResolveFilter(params){Transform.call(this,null,params)}ResolveFilter.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:true,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:true,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var prototype$1i=inherits(ResolveFilter,Transform);prototype$1i.transform=function(_,pulse){var ignore=~(_.ignore||0),bitmap=_.filter,mask=bitmap.mask;if((mask&ignore)===0)return pulse.StopPropagation;var output=pulse.fork(pulse.ALL),data=bitmap.data(),curr=bitmap.curr(),prev=bitmap.prev(),pass=function(k){return!(curr[k]&ignore)?data[k]:null};output.filter(output.MOD,pass);if(!(mask&mask-1)){output.filter(output.ADD,pass);output.filter(output.REM,function(k){return(curr[k]&ignore)===mask?data[k]:null})}else{output.filter(output.ADD,function(k){var c=curr[k]&ignore,f=!c&&c^prev[k]&ignore;return f?data[k]:null});output.filter(output.REM,function(k){var c=curr[k]&ignore,f=c&&!(c^(c^prev[k]&ignore));return f?data[k]:null})}return output.filter(output.SOURCE,function(t){return pass(t._index)})};var xf=Object.freeze({crossfilter:CrossFilter,resolvefilter:ResolveFilter});var version="5.3.5";var Default="default";function cursor(view){var cursor=view._signals.cursor;if(!cursor){view._signals.cursor=cursor=view.add({user:Default,item:null})}view.on(view.events("view","mousemove"),cursor,function(_,event){var value=cursor.value,user=value?isString(value)?value:value.user:Default,item=event.item&&event.item.cursor||null;return value&&user===value.user&&item==value.item?value:{user:user,item:item}});view.add(null,function(_){var user=_.cursor,item=this.value;if(!isString(user)){item=user.item;user=user.user}setCursor(user&&user!==Default?user:item||user);return item},{cursor:cursor})}function setCursor(cursor){if(typeof document!=="undefined"&&document.body){document.body.style.cursor=cursor}}function dataref(view,name){var data=view._runtime.data;if(!data.hasOwnProperty(name)){error("Unrecognized data set: "+name)}return data[name]}function data(name){return dataref(this,name).values.value}function change(name,changes){if(!isChangeSet(changes)){error("Second argument to changes must be a changeset.")}var dataset=dataref(this,name);dataset.modified=true;return this.pulse(dataset.input,changes)}function insert(name,_){return change.call(this,name,changeset().insert(_))}function remove(name,_){return change.call(this,name,changeset().remove(_))}function width(view){var padding=view.padding();return Math.max(0,view._viewWidth+padding.left+padding.right)}function height(view){var padding=view.padding();return Math.max(0,view._viewHeight+padding.top+padding.bottom)}function offset$1(view){var padding=view.padding(),origin=view._origin;return[padding.left+origin[0],padding.top+origin[1]]}function resizeRenderer(view){var origin=offset$1(view),w=width(view),h=height(view);view._renderer.background(view._background);view._renderer.resize(w,h,origin);view._handler.origin(origin);view._resizeListeners.forEach(function(handler){try{handler(w,h)}catch(error){view.error(error)}})}function eventExtend(view,event,item){var r=view._renderer,el=r&&r.canvas(),p,e,translate;if(el){translate=offset$1(view);e=event.changedTouches?event.changedTouches[0]:event;p=point$4(e,el);p[0]-=translate[0];p[1]-=translate[1]}event.dataflow=view;event.item=item;event.vega=extension(view,item,p);return event}function extension(view,item,point){var itemGroup=item?item.mark.marktype==="group"?item:item.mark.group:null;function group(name){var g=itemGroup,i;if(name)for(i=item;i;i=i.mark.group){if(i.mark.name===name){g=i;break}}return g&&g.mark&&g.mark.interactive?g:{}}function xy(item){if(!item)return point;if(isString(item))item=group(item);var p=point.slice();while(item){p[0]-=item.x||0;p[1]-=item.y||0;item=item.mark&&item.mark.group}return p}return{view:constant(view),item:constant(item||{}),group:group,xy:xy,x:function(item){return xy(item)[0]},y:function(item){return xy(item)[1]}}}var VIEW="view",TIMER="timer",WINDOW="window",NO_TRAP={trap:false};function initializeEventConfig(config){config=extend({},config);var def=config.defaults;if(def){if(isArray(def.prevent)){def.prevent=toSet(def.prevent)}if(isArray(def.allow)){def.allow=toSet(def.allow)}}return config}function prevent(view,type){var def=view._eventConfig.defaults,prevent=def&&def.prevent,allow=def&&def.allow;return prevent===false||allow===true?false:prevent===true||allow===false?true:prevent?prevent[type]:allow?!allow[type]:view.preventDefault()}function events$1(source,type,filter){var view=this,s=new EventStream(filter),send=function(e,item){view.runAsync(null,()=>{if(source===VIEW&&prevent(view,type)){e.preventDefault()}s.receive(eventExtend(view,e,item))})},sources;if(source===TIMER){view.timer(send,type)}else if(source===VIEW){view.addEventListener(type,send,NO_TRAP)}else{if(source===WINDOW){if(typeof window!=="undefined")sources=[window]}else if(typeof document!=="undefined"){sources=document.querySelectorAll(source)}if(!sources){view.warn("Can not resolve event source: "+source)}else{for(var i=0,n=sources.length;i<n;++i){sources[i].addEventListener(type,send)}view._eventListeners.push({type:type,sources:sources,handler:send})}}return s}function itemFilter(event){return event.item}function markTarget(event){var source=event.item.mark.source;return source.source||source}function invoke(name){return function(_,event){return event.vega.view().changeset().encode(event.item,name)}}function hover(hoverSet,leaveSet){hoverSet=[hoverSet||"hover"];leaveSet=[leaveSet||"update",hoverSet[0]];this.on(this.events("view","mouseover",itemFilter),markTarget,invoke(hoverSet));this.on(this.events("view","mouseout",itemFilter),markTarget,invoke(leaveSet));return this}function finalize(){var tooltip=this._tooltip,timers=this._timers,listeners=this._eventListeners,n,m,e;n=timers.length;while(--n>=0){timers[n].stop()}n=listeners.length;while(--n>=0){e=listeners[n];m=e.sources.length;while(--m>=0){e.sources[m].removeEventListener(e.type,e.handler)}}if(tooltip){tooltip.call(this,this._handler,null,null,null)}return this}function element$1(tag,attr,text){var el=document.createElement(tag);for(var key in attr)el.setAttribute(key,attr[key]);if(text!=null)el.textContent=text;return el}var BindClass="vega-bind",NameClass="vega-bind-name",RadioClass="vega-bind-radio",OptionClass="vega-option-";function bind$1(view,el,binding){if(!el)return;var param=binding.param,bind=binding.state;if(!bind){bind=binding.state={elements:null,active:false,set:null,update:function(value){if(value!==view.signal(param.signal)){view.runAsync(null,function(){bind.source=true;view.signal(param.signal,value)})}}};if(param.debounce){bind.update=debounce(param.debounce,bind.update)}}generate(bind,el,param,view.signal(param.signal));if(!bind.active){view.on(view._signals[param.signal],null,function(){bind.source?bind.source=false:bind.set(view.signal(param.signal))});bind.active=true}return bind}function generate(bind,el,param,value){var div=element$1("div",{class:BindClass});div.appendChild(element$1("span",{class:NameClass},param.name||param.signal));el.appendChild(div);var input=form;switch(param.input){case"checkbox":input=checkbox;break;case"select":input=select;break;case"radio":input=radio;break;case"range":input=range$3;break}input(bind,div,param,value)}function form(bind,el,param,value){var node=element$1("input");for(var key in param){if(key!=="signal"&&key!=="element"){node.setAttribute(key==="input"?"type":key,param[key])}}node.setAttribute("name",param.signal);node.value=value;el.appendChild(node);node.addEventListener("input",function(){bind.update(node.value)});bind.elements=[node];bind.set=function(value){node.value=value}}function checkbox(bind,el,param,value){var attr={type:"checkbox",name:param.signal};if(value)attr.checked=true;var node=element$1("input",attr);el.appendChild(node);node.addEventListener("change",function(){bind.update(node.checked)});bind.elements=[node];bind.set=function(value){node.checked=!!value||null}}function select(bind,el,param,value){var node=element$1("select",{name:param.signal});param.options.forEach(function(option){var attr={value:option};if(valuesEqual(option,value))attr.selected=true;node.appendChild(element$1("option",attr,option+""))});el.appendChild(node);node.addEventListener("change",function(){bind.update(param.options[node.selectedIndex])});bind.elements=[node];bind.set=function(value){for(var i=0,n=param.options.length;i<n;++i){if(valuesEqual(param.options[i],value)){node.selectedIndex=i;return}}}}function radio(bind,el,param,value){var group=element$1("span",{class:RadioClass});el.appendChild(group);bind.elements=param.options.map(function(option){var id=OptionClass+param.signal+"-"+option;var attr={id:id,type:"radio",name:param.signal,value:option};if(valuesEqual(option,value))attr.checked=true;var input=element$1("input",attr);input.addEventListener("change",function(){bind.update(option)});group.appendChild(input);group.appendChild(element$1("label",{for:id},option+""));return input});bind.set=function(value){var nodes=bind.elements,i=0,n=nodes.length;for(;i<n;++i){if(valuesEqual(nodes[i].value,value))nodes[i].checked=true}}}function range$3(bind,el,param,value){value=value!==undefined?value:(+param.max+ +param.min)/2;var min=param.min||Math.min(0,+value)||0,max=param.max||Math.max(100,+value)||100,step=param.step||tickStep(min,max,100);var node=element$1("input",{type:"range",name:param.signal,min:min,max:max,step:step});node.value=value;var label=element$1("label",{},+value);el.appendChild(node);el.appendChild(label);function update(){label.textContent=node.value;bind.update(+node.value)}node.addEventListener("input",update);node.addEventListener("change",update);bind.elements=[node];bind.set=function(value){node.value=value;label.textContent=value}}function valuesEqual(a,b){return a===b||a+""===b+""}function initializeRenderer(view,r,el,constructor,scaleFactor,opt){r=r||new constructor(view.loader());return r.initialize(el,width(view),height(view),offset$1(view),scaleFactor,opt).background(view._background)}function trap(view,fn){return!fn?null:function(){try{fn.apply(this,arguments)}catch(error){view.error(error)}}}function initializeHandler(view,prevHandler,el,constructor){var handler=new constructor(view.loader(),trap(view,view.tooltip())).scene(view.scenegraph().root).initialize(el,offset$1(view),view);if(prevHandler){prevHandler.handlers().forEach(function(h){handler.on(h.type,h.handler)})}return handler}function initialize$1(el,elBind){var view=this,type=view._renderType,module=renderModule(type),Handler,Renderer;el=view._el=el?lookup$4(view,el):null;if(!module)view.error("Unrecognized renderer type: "+type);Handler=module.handler||CanvasHandler;Renderer=el?module.renderer:module.headless;view._renderer=!Renderer?null:initializeRenderer(view,view._renderer,el,Renderer);view._handler=initializeHandler(view,view._handler,el,Handler);view._redraw=true;if(el){elBind=elBind?view._elBind=lookup$4(view,elBind):el.appendChild(element$1("div",{class:"vega-bindings"}));view._bind.forEach(function(_){if(_.param.element){_.element=lookup$4(view,_.param.element)}});view._bind.forEach(function(_){bind$1(view,_.element||elBind,_)})}return view}function lookup$4(view,el){if(typeof el==="string"){if(typeof document!=="undefined"){el=document.querySelector(el);if(!el){view.error("Signal bind element not found: "+el);return null}}else{view.error("DOM document instance not found.");return null}}if(el){try{el.innerHTML=""}catch(e){el=null;view.error(e)}}return el}async function renderHeadless(view,type,scaleFactor,opt){const module=renderModule(type),ctr=module&&module.headless;if(!ctr)error("Unrecognized renderer type: "+type);await view.runAsync();return initializeRenderer(view,null,null,ctr,scaleFactor,opt).renderAsync(view._scenegraph.root)}async function renderToImageURL(type,scaleFactor){if(type!==RenderType.Canvas&&type!==RenderType.SVG&&type!==RenderType.PNG){error("Unrecognized image type: "+type)}const r=await renderHeadless(this,type,scaleFactor);return type===RenderType.SVG?toBlobURL(r.svg(),"image/svg+xml"):r.canvas().toDataURL("image/png")}function toBlobURL(data,mime){var blob=new Blob([data],{type:mime});return window.URL.createObjectURL(blob)}async function renderToCanvas(scaleFactor,opt){const r=await renderHeadless(this,RenderType.Canvas,scaleFactor,opt);return r.canvas()}async function renderToSVG(scaleFactor){const r=await renderHeadless(this,RenderType.SVG,scaleFactor);return r.svg()}var RawCode="RawCode";var Literal="Literal";var Property="Property";var Identifier$1="Identifier";var ArrayExpression="ArrayExpression";var BinaryExpression="BinaryExpression";var CallExpression="CallExpression";var ConditionalExpression="ConditionalExpression";var LogicalExpression="LogicalExpression";var MemberExpression="MemberExpression";var ObjectExpression="ObjectExpression";var UnaryExpression="UnaryExpression";function ASTNode(type){this.type=type}ASTNode.prototype.visit=function(visitor){var node=this,c,i,n;if(visitor(node))return 1;for(c=children$1(node),i=0,n=c.length;i<n;++i){if(c[i].visit(visitor))return 1}};function children$1(node){switch(node.type){case ArrayExpression:return node.elements;case BinaryExpression:case LogicalExpression:return[node.left,node.right];case CallExpression:var args=node.arguments.slice();args.unshift(node.callee);return args;case ConditionalExpression:return[node.test,node.consequent,node.alternate];case MemberExpression:return[node.object,node.property];case ObjectExpression:return node.properties;case Property:return[node.key,node.value];case UnaryExpression:return[node.argument];case Identifier$1:case Literal:case RawCode:default:return[]}}var TokenName,source$1,index$1,length,lookahead;var TokenBooleanLiteral=1,TokenEOF=2,TokenIdentifier=3,TokenKeyword=4,TokenNullLiteral=5,TokenNumericLiteral=6,TokenPunctuator=7,TokenStringLiteral=8,TokenRegularExpression=9;TokenName={};TokenName[TokenBooleanLiteral]="Boolean";TokenName[TokenEOF]="<end>";TokenName[TokenIdentifier]="Identifier";TokenName[TokenKeyword]="Keyword";TokenName[TokenNullLiteral]="Null";TokenName[TokenNumericLiteral]="Numeric";TokenName[TokenPunctuator]="Punctuator";TokenName[TokenStringLiteral]="String";TokenName[TokenRegularExpression]="RegularExpression";var SyntaxArrayExpression="ArrayExpression",SyntaxBinaryExpression="BinaryExpression",SyntaxCallExpression="CallExpression",SyntaxConditionalExpression="ConditionalExpression",SyntaxIdentifier="Identifier",SyntaxLiteral="Literal",SyntaxLogicalExpression="LogicalExpression",SyntaxMemberExpression="MemberExpression",SyntaxObjectExpression="ObjectExpression",SyntaxProperty="Property",SyntaxUnaryExpression="UnaryExpression";var MessageUnexpectedToken="Unexpected token %0",MessageUnexpectedNumber="Unexpected number",MessageUnexpectedString="Unexpected string",MessageUnexpectedIdentifier="Unexpected identifier",MessageUnexpectedReserved="Unexpected reserved word",MessageUnexpectedEOS="Unexpected end of input",MessageInvalidRegExp="Invalid regular expression",MessageUnterminatedRegExp="Invalid regular expression: missing /",MessageStrictOctalLiteral="Octal literals are not allowed in strict mode.",MessageStrictDuplicateProperty="Duplicate data property in object literal not allowed in strict mode";var ILLEGAL="ILLEGAL",DISABLED="Disabled.";var RegexNonAsciiIdentifierStart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),RegexNonAsciiIdentifierPart=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&RegexNonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&RegexNonAsciiIdentifierPart.test(String.fromCharCode(ch))}var keywords={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function skipComment(){var ch;while(index$1<length){ch=source$1.charCodeAt(index$1);if(isWhiteSpace(ch)||isLineTerminator(ch)){++index$1}else{break}}}function scanHexEscape(prefix){var i,len,ch,code=0;len=prefix==="u"?4:2;for(i=0;i<len;++i){if(index$1<length&&isHexDigit(source$1[index$1])){ch=source$1[index$1++];code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}else{throwError({},MessageUnexpectedToken,ILLEGAL)}}return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code,cu1,cu2;ch=source$1[index$1];code=0;if(ch==="}"){throwError({},MessageUnexpectedToken,ILLEGAL)}while(index$1<length){ch=source$1[index$1++];if(!isHexDigit(ch)){break}code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}if(code>1114111||ch!=="}"){throwError({},MessageUnexpectedToken,ILLEGAL)}if(code<=65535){return String.fromCharCode(code)}cu1=(code-65536>>10)+55296;cu2=(code-65536&1023)+56320;return String.fromCharCode(cu1,cu2)}function getEscapedIdentifier(){var ch,id;ch=source$1.charCodeAt(index$1++);id=String.fromCharCode(ch);if(ch===92){if(source$1.charCodeAt(index$1)!==117){throwError({},MessageUnexpectedToken,ILLEGAL)}++index$1;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierStart(ch.charCodeAt(0))){throwError({},MessageUnexpectedToken,ILLEGAL)}id=ch}while(index$1<length){ch=source$1.charCodeAt(index$1);if(!isIdentifierPart(ch)){break}++index$1;id+=String.fromCharCode(ch);if(ch===92){id=id.substr(0,id.length-1);if(source$1.charCodeAt(index$1)!==117){throwError({},MessageUnexpectedToken,ILLEGAL)}++index$1;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierPart(ch.charCodeAt(0))){throwError({},MessageUnexpectedToken,ILLEGAL)}id+=ch}}return id}function getIdentifier(){var start,ch;start=index$1++;while(index$1<length){ch=source$1.charCodeAt(index$1);if(ch===92){index$1=start;return getEscapedIdentifier()}if(isIdentifierPart(ch)){++index$1}else{break}}return source$1.slice(start,index$1)}function scanIdentifier(){var start,id,type;start=index$1;id=source$1.charCodeAt(index$1)===92?getEscapedIdentifier():getIdentifier();if(id.length===1){type=TokenIdentifier}else if(keywords.hasOwnProperty(id)){type=TokenKeyword}else if(id==="null"){type=TokenNullLiteral}else if(id==="true"||id==="false"){type=TokenBooleanLiteral}else{type=TokenIdentifier}return{type:type,value:id,start:start,end:index$1}}function scanPunctuator(){var start=index$1,code=source$1.charCodeAt(index$1),code2,ch1=source$1[index$1],ch2,ch3,ch4;switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++index$1;return{type:TokenPunctuator,value:String.fromCharCode(code),start:start,end:index$1};default:code2=source$1.charCodeAt(index$1+1);if(code2===61){switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:index$1+=2;return{type:TokenPunctuator,value:String.fromCharCode(code)+String.fromCharCode(code2),start:start,end:index$1};case 33:case 61:index$1+=2;if(source$1.charCodeAt(index$1)===61){++index$1}return{type:TokenPunctuator,value:source$1.slice(start,index$1),start:start,end:index$1}}}}ch4=source$1.substr(index$1,4);if(ch4===">>>="){index$1+=4;return{type:TokenPunctuator,value:ch4,start:start,end:index$1}}ch3=ch4.substr(0,3);if(ch3===">>>"||ch3==="<<="||ch3===">>="){index$1+=3;return{type:TokenPunctuator,value:ch3,start:start,end:index$1}}ch2=ch3.substr(0,2);if(ch1===ch2[1]&&"+-<>&|".indexOf(ch1)>=0||ch2==="=>"){index$1+=2;return{type:TokenPunctuator,value:ch2,start:start,end:index$1}}if("<>=!+-*%&|^/".indexOf(ch1)>=0){++index$1;return{type:TokenPunctuator,value:ch1,start:start,end:index$1}}throwError({},MessageUnexpectedToken,ILLEGAL)}function scanHexLiteral(start){var number="";while(index$1<length){if(!isHexDigit(source$1[index$1])){break}number+=source$1[index$1++]}if(number.length===0){throwError({},MessageUnexpectedToken,ILLEGAL)}if(isIdentifierStart(source$1.charCodeAt(index$1))){throwError({},MessageUnexpectedToken,ILLEGAL)}return{type:TokenNumericLiteral,value:parseInt("0x"+number,16),start:start,end:index$1}}function scanOctalLiteral(start){var number="0"+source$1[index$1++];while(index$1<length){if(!isOctalDigit(source$1[index$1])){break}number+=source$1[index$1++]}if(isIdentifierStart(source$1.charCodeAt(index$1))||isDecimalDigit(source$1.charCodeAt(index$1))){throwError({},MessageUnexpectedToken,ILLEGAL)}return{type:TokenNumericLiteral,value:parseInt(number,8),octal:true,start:start,end:index$1}}function scanNumericLiteral(){var number,start,ch;ch=source$1[index$1];assert(isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");start=index$1;number="";if(ch!=="."){number=source$1[index$1++];ch=source$1[index$1];if(number==="0"){if(ch==="x"||ch==="X"){++index$1;return scanHexLiteral(start)}if(isOctalDigit(ch)){return scanOctalLiteral(start)}if(ch&&isDecimalDigit(ch.charCodeAt(0))){throwError({},MessageUnexpectedToken,ILLEGAL)}}while(isDecimalDigit(source$1.charCodeAt(index$1))){number+=source$1[index$1++]}ch=source$1[index$1]}if(ch==="."){number+=source$1[index$1++];while(isDecimalDigit(source$1.charCodeAt(index$1))){number+=source$1[index$1++]}ch=source$1[index$1]}if(ch==="e"||ch==="E"){number+=source$1[index$1++];ch=source$1[index$1];if(ch==="+"||ch==="-"){number+=source$1[index$1++]}if(isDecimalDigit(source$1.charCodeAt(index$1))){while(isDecimalDigit(source$1.charCodeAt(index$1))){number+=source$1[index$1++]}}else{throwError({},MessageUnexpectedToken,ILLEGAL)}}if(isIdentifierStart(source$1.charCodeAt(index$1))){throwError({},MessageUnexpectedToken,ILLEGAL)}return{type:TokenNumericLiteral,value:parseFloat(number),start:start,end:index$1}}function scanStringLiteral(){var str="",quote,start,ch,code,octal=false;quote=source$1[index$1];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index$1;++index$1;while(index$1<length){ch=source$1[index$1++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=source$1[index$1++];if(!ch||!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"u":case"x":if(source$1[index$1]==="{"){++index$1;str+=scanUnicodeCodePointEscape()}else{str+=scanHexEscape(ch)}break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\v";break;default:if(isOctalDigit(ch)){code="01234567".indexOf(ch);if(code!==0){octal=true}if(index$1<length&&isOctalDigit(source$1[index$1])){octal=true;code=code*8+"01234567".indexOf(source$1[index$1++]);if("0123".indexOf(ch)>=0&&index$1<length&&isOctalDigit(source$1[index$1])){code=code*8+"01234567".indexOf(source$1[index$1++])}}str+=String.fromCharCode(code)}else{str+=ch}break}}else{if(ch==="\r"&&source$1[index$1]==="\n"){++index$1}}}else if(isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){throwError({},MessageUnexpectedToken,ILLEGAL)}return{type:TokenStringLiteral,value:str,octal:octal,start:start,end:index$1}}function testRegExp(pattern,flags){var tmp=pattern;if(flags.indexOf("u")>=0){tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}/g,function($0,$1){if(parseInt($1,16)<=1114111){return"x"}throwError({},MessageInvalidRegExp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x")}try{}catch(e){throwError({},MessageInvalidRegExp)}try{return new RegExp(pattern,flags)}catch(exception){return null}}function scanRegExpBody(){var ch,str,classMarker,terminated,body;ch=source$1[index$1];assert(ch==="/","Regular expression literal must start with a slash");str=source$1[index$1++];classMarker=false;terminated=false;while(index$1<length){ch=source$1[index$1++];str+=ch;if(ch==="\\"){ch=source$1[index$1++];if(isLineTerminator(ch.charCodeAt(0))){throwError({},MessageUnterminatedRegExp)}str+=ch}else if(isLineTerminator(ch.charCodeAt(0))){throwError({},MessageUnterminatedRegExp)}else if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}}}if(!terminated){throwError({},MessageUnterminatedRegExp)}body=str.substr(1,str.length-2);return{value:body,literal:str}}function scanRegExpFlags(){var ch,str,flags;str="";flags="";while(index$1<length){ch=source$1[index$1];if(!isIdentifierPart(ch.charCodeAt(0))){break}++index$1;if(ch==="\\"&&index$1<length){throwError({},MessageUnexpectedToken,ILLEGAL)}else{flags+=ch;str+=ch}}if(flags.search(/[^gimuy]/g)>=0){throwError({},MessageInvalidRegExp,flags)}return{value:flags,literal:str}}function scanRegExp(){var start,body,flags,value;lookahead=null;skipComment();start=index$1;body=scanRegExpBody();flags=scanRegExpFlags();value=testRegExp(body.value,flags.value);return{literal:body.literal+flags.literal,value:value,regex:{pattern:body.value,flags:flags.value},start:start,end:index$1}}function isIdentifierName(token){return token.type===TokenIdentifier||token.type===TokenKeyword||token.type===TokenBooleanLiteral||token.type===TokenNullLiteral}function advance(){var ch;skipComment();if(index$1>=length){return{type:TokenEOF,start:index$1,end:index$1}}ch=source$1.charCodeAt(index$1);if(isIdentifierStart(ch)){return scanIdentifier()}if(ch===40||ch===41||ch===59){return scanPunctuator()}if(ch===39||ch===34){return scanStringLiteral()}if(ch===46){if(isDecimalDigit(source$1.charCodeAt(index$1+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(ch)){return scanNumericLiteral()}return scanPunctuator()}function lex(){var token;token=lookahead;index$1=token.end;lookahead=advance();index$1=token.end;return token}function peek$1(){var pos;pos=index$1;lookahead=advance();index$1=pos}function finishArrayExpression(elements){var node=new ASTNode(SyntaxArrayExpression);node.elements=elements;return node}function finishBinaryExpression(operator,left,right){var node=new ASTNode(operator==="||"||operator==="&&"?SyntaxLogicalExpression:SyntaxBinaryExpression);node.operator=operator;node.left=left;node.right=right;return node}function finishCallExpression(callee,args){var node=new ASTNode(SyntaxCallExpression);node.callee=callee;node.arguments=args;return node}function finishConditionalExpression(test,consequent,alternate){var node=new ASTNode(SyntaxConditionalExpression);node.test=test;node.consequent=consequent;node.alternate=alternate;return node}function finishIdentifier(name){var node=new ASTNode(SyntaxIdentifier);node.name=name;return node}function finishLiteral(token){var node=new ASTNode(SyntaxLiteral);node.value=token.value;node.raw=source$1.slice(token.start,token.end);if(token.regex){if(node.raw==="//"){node.raw="/(?:)/"}node.regex=token.regex}return node}function finishMemberExpression(accessor,object,property){var node=new ASTNode(SyntaxMemberExpression);node.computed=accessor==="[";node.object=object;node.property=property;if(!node.computed)property.member=true;return node}function finishObjectExpression(properties){var node=new ASTNode(SyntaxObjectExpression);node.properties=properties;return node}function finishProperty(kind,key,value){var node=new ASTNode(SyntaxProperty);node.key=key;node.value=value;node.kind=kind;return node}function finishUnaryExpression(operator,argument){var node=new ASTNode(SyntaxUnaryExpression);node.operator=operator;node.argument=argument;node.prefix=true;return node}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){assert(index<args.length,"Message reference must be in range");return args[index]});error=new Error(msg);error.index=index$1;error.description=msg;throw error}function throwUnexpected(token){if(token.type===TokenEOF){throwError(token,MessageUnexpectedEOS)}if(token.type===TokenNumericLiteral){throwError(token,MessageUnexpectedNumber)}if(token.type===TokenStringLiteral){throwError(token,MessageUnexpectedString)}if(token.type===TokenIdentifier){throwError(token,MessageUnexpectedIdentifier)}if(token.type===TokenKeyword){throwError(token,MessageUnexpectedReserved)}throwError(token,MessageUnexpectedToken,token.value)}function expect(value){var token=lex();if(token.type!==TokenPunctuator||token.value!==value){throwUnexpected(token)}}function match(value){return lookahead.type===TokenPunctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===TokenKeyword&&lookahead.value===keyword}function parseArrayInitialiser(){var elements=[];index$1=lookahead.start;expect("[");while(!match("]")){if(match(",")){lex();elements.push(null)}else{elements.push(parseConditionalExpression());if(!match("]")){expect(",")}}}lex();return finishArrayExpression(elements)}function parseObjectPropertyKey(){var token;index$1=lookahead.start;token=lex();if(token.type===TokenStringLiteral||token.type===TokenNumericLiteral){if(token.octal){throwError(token,MessageStrictOctalLiteral)}return finishLiteral(token)}return finishIdentifier(token.value)}function parseObjectProperty(){var token,key,id,value;index$1=lookahead.start;token=lookahead;if(token.type===TokenIdentifier){id=parseObjectPropertyKey();expect(":");value=parseConditionalExpression();return finishProperty("init",id,value)}if(token.type===TokenEOF||token.type===TokenPunctuator){throwUnexpected(token)}else{key=parseObjectPropertyKey();expect(":");value=parseConditionalExpression();return finishProperty("init",key,value)}}function parseObjectInitialiser(){var properties=[],property,name,key,map={},toString=String;index$1=lookahead.start;expect("{");while(!match("}")){property=parseObjectProperty();if(property.key.type===SyntaxIdentifier){name=property.key.name}else{name=toString(property.key.value)}key="$"+name;if(Object.prototype.hasOwnProperty.call(map,key)){throwError({},MessageStrictDuplicateProperty)}else{map[key]=true}properties.push(property);if(!match("}")){expect(",")}}expect("}");return finishObjectExpression(properties)}function parseGroupExpression(){var expr;expect("(");expr=parseExpression();expect(")");return expr}var legalKeywords={if:1,this:1};function parsePrimaryExpression(){var type,token,expr;if(match("(")){return parseGroupExpression()}if(match("[")){return parseArrayInitialiser()}if(match("{")){return parseObjectInitialiser()}type=lookahead.type;index$1=lookahead.start;if(type===TokenIdentifier||legalKeywords[lookahead.value]){expr=finishIdentifier(lex().value)}else if(type===TokenStringLiteral||type===TokenNumericLiteral){if(lookahead.octal){throwError(lookahead,MessageStrictOctalLiteral)}expr=finishLiteral(lex())}else if(type===TokenKeyword){throw new Error(DISABLED)}else if(type===TokenBooleanLiteral){token=lex();token.value=token.value==="true";expr=finishLiteral(token)}else if(type===TokenNullLiteral){token=lex();token.value=null;expr=finishLiteral(token)}else if(match("/")||match("/=")){expr=finishLiteral(scanRegExp());peek$1()}else{throwUnexpected(lex())}return expr}function parseArguments(){var args=[];expect("(");if(!match(")")){while(index$1<length){args.push(parseConditionalExpression());if(match(")")){break}expect(",")}}expect(")");return args}function parseNonComputedProperty(){var token;index$1=lookahead.start;token=lex();if(!isIdentifierName(token)){throwUnexpected(token)}return finishIdentifier(token.value)}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){var expr;expect("[");expr=parseExpression();expect("]");return expr}function parseLeftHandSideExpressionAllowCall(){var expr,args,property;expr=parsePrimaryExpression();for(;;){if(match(".")){property=parseNonComputedMember();expr=finishMemberExpression(".",expr,property)}else if(match("(")){args=parseArguments();expr=finishCallExpression(expr,args)}else if(match("[")){property=parseComputedMember();expr=finishMemberExpression("[",expr,property)}else{break}}return expr}function parsePostfixExpression(){var expr=parseLeftHandSideExpressionAllowCall();if(lookahead.type===TokenPunctuator){if(match("++")||match("--")){throw new Error(DISABLED)}}return expr}function parseUnaryExpression(){var token,expr;if(lookahead.type!==TokenPunctuator&&lookahead.type!==TokenKeyword){expr=parsePostfixExpression()}else if(match("++")||match("--")){throw new Error(DISABLED)}else if(match("+")||match("-")||match("~")||match("!")){token=lex();expr=parseUnaryExpression();expr=finishUnaryExpression(token.value,expr)}else if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){throw new Error(DISABLED)}else{expr=parsePostfixExpression()}return expr}function binaryPrecedence(token){var prec=0;if(token.type!==TokenPunctuator&&token.type!==TokenKeyword){return 0}switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":prec=7;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11;break;default:break}return prec}function parseBinaryExpression(){var marker,markers,expr,token,prec,stack,right,operator,left,i;marker=lookahead;left=parseUnaryExpression();token=lookahead;prec=binaryPrecedence(token);if(prec===0){return left}token.prec=prec;lex();markers=[marker,lookahead];right=parseUnaryExpression();stack=[left,token,right];while((prec=binaryPrecedence(lookahead))>0){while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();operator=stack.pop().value;left=stack.pop();markers.pop();expr=finishBinaryExpression(operator,left,right);stack.push(expr)}token=lex();token.prec=prec;stack.push(token);markers.push(lookahead);expr=parseUnaryExpression();stack.push(expr)}i=stack.length-1;expr=stack[i];markers.pop();while(i>1){markers.pop();expr=finishBinaryExpression(stack[i-1].value,stack[i-2],expr);i-=2}return expr}function parseConditionalExpression(){var expr,consequent,alternate;expr=parseBinaryExpression();if(match("?")){lex();consequent=parseConditionalExpression();expect(":");alternate=parseConditionalExpression();expr=finishConditionalExpression(expr,consequent,alternate)}return expr}function parseExpression(){var expr=parseConditionalExpression();if(match(",")){throw new Error(DISABLED)}return expr}function parse$3(code){source$1=code;index$1=0;length=source$1.length;lookahead=null;peek$1();var expr=parseExpression();if(lookahead.type!==TokenEOF){throw new Error("Unexpect token after expression.")}return expr}var constants={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function functions(codegen){function fncall(name,args,cast,type){var obj=codegen(args[0]);if(cast){obj=cast+"("+obj+")";if(cast.lastIndexOf("new ",0)===0)obj="("+obj+")"}return obj+"."+name+(type<0?"":type===0?"()":"("+args.slice(1).map(codegen).join(",")+")")}function fn(name,cast,type){return function(args){return fncall(name,args,cast,type)}}var DATE="new Date",STRING="String",REGEXP="RegExp";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(args){if(args.length<3)error("Missing arguments to clamp function.");if(args.length>3)error("Too many arguments to clamp function.");var a=args.map(codegen);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:DATE,date:fn("getDate",DATE,0),day:fn("getDay",DATE,0),year:fn("getFullYear",DATE,0),month:fn("getMonth",DATE,0),hours:fn("getHours",DATE,0),minutes:fn("getMinutes",DATE,0),seconds:fn("getSeconds",DATE,0),milliseconds:fn("getMilliseconds",DATE,0),time:fn("getTime",DATE,0),timezoneoffset:fn("getTimezoneOffset",DATE,0),utcdate:fn("getUTCDate",DATE,0),utcday:fn("getUTCDay",DATE,0),utcyear:fn("getUTCFullYear",DATE,0),utcmonth:fn("getUTCMonth",DATE,0),utchours:fn("getUTCHours",DATE,0),utcminutes:fn("getUTCMinutes",DATE,0),utcseconds:fn("getUTCSeconds",DATE,0),utcmilliseconds:fn("getUTCMilliseconds",DATE,0),length:fn("length",null,-1),join:fn("join",null),indexof:fn("indexOf",null),lastindexof:fn("lastIndexOf",null),slice:fn("slice",null),reverse:function(args){return"("+codegen(args[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:fn("toUpperCase",STRING,0),lower:fn("toLowerCase",STRING,0),substring:fn("substring",STRING),split:fn("split",STRING),replace:fn("replace",STRING),trim:fn("trim",STRING,0),regexp:REGEXP,test:fn("test",REGEXP),if:function(args){if(args.length<3)error("Missing arguments to if function.");if(args.length>3)error("Too many arguments to if function.");var a=args.map(codegen);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function stripQuotes(s){var n=s&&s.length-1;return n&&(s[0]==='"'&&s[n]==='"'||s[0]==="'"&&s[n]==="'")?s.slice(1,-1):s}function codegen(opt){opt=opt||{};var whitelist=opt.whitelist?toSet(opt.whitelist):{},blacklist=opt.blacklist?toSet(opt.blacklist):{},constants$1=opt.constants||constants,functions$1=(opt.functions||functions)(visit),globalvar=opt.globalvar,fieldvar=opt.fieldvar,globals={},fields={},memberDepth=0;var outputGlobal=isFunction(globalvar)?globalvar:function(id){return globalvar+'["'+id+'"]'};function visit(ast){if(isString(ast))return ast;var generator=Generators[ast.type];if(generator==null)error("Unsupported type: "+ast.type);return generator(ast)}var Generators={Literal:function(n){return n.raw},Identifier:function(n){var id=n.name;if(memberDepth>0){return id}else if(blacklist.hasOwnProperty(id)){return error("Illegal identifier: "+id)}else if(constants$1.hasOwnProperty(id)){return constants$1[id]}else if(whitelist.hasOwnProperty(id)){return id}else{globals[id]=1;return outputGlobal(id)}},MemberExpression:function(n){var d=!n.computed;var o=visit(n.object);if(d)memberDepth+=1;var p=visit(n.property);if(o===fieldvar){fields[stripQuotes(p)]=1}if(d)memberDepth-=1;return o+(d?"."+p:"["+p+"]")},CallExpression:function(n){if(n.callee.type!=="Identifier"){error("Illegal callee type: "+n.callee.type)}var callee=n.callee.name;var args=n.arguments;var fn=functions$1.hasOwnProperty(callee)&&functions$1[callee];if(!fn)error("Unrecognized function: "+callee);return isFunction(fn)?fn(args):fn+"("+args.map(visit).join(",")+")"},ArrayExpression:function(n){return"["+n.elements.map(visit).join(",")+"]"},BinaryExpression:function(n){return"("+visit(n.left)+n.operator+visit(n.right)+")"},UnaryExpression:function(n){return"("+n.operator+visit(n.argument)+")"},ConditionalExpression:function(n){return"("+visit(n.test)+"?"+visit(n.consequent)+":"+visit(n.alternate)+")"},LogicalExpression:function(n){return"("+visit(n.left)+n.operator+visit(n.right)+")"},ObjectExpression:function(n){return"{"+n.properties.map(visit).join(",")+"}"},Property:function(n){memberDepth+=1;var k=visit(n.key);memberDepth-=1;return k+":"+visit(n.value)}};function codegen(ast){var result={code:visit(ast),globals:Object.keys(globals),fields:Object.keys(fields)};globals={};fields={};return result}codegen.functions=functions$1;codegen.constants=constants$1;return codegen}const Intersect="intersect";const Union="union";var TYPE_ENUM="E",TYPE_RANGE_INC="R",TYPE_RANGE_EXC="R-E",TYPE_RANGE_LE="R-LE",TYPE_RANGE_RE="R-RE",UNIT_INDEX="index:unit";function testPoint(datum,entry){var fields=entry.fields,values=entry.values,n=fields.length,i=0,dval,f;for(;i<n;++i){f=fields[i];f.getter=field.getter||field(f.field);dval=f.getter(datum);if(isDate(dval))dval=toNumber(dval);if(isDate(values[i]))values[i]=toNumber(values[i]);if(isDate(values[i][0]))values[i]=values[i].map(toNumber);if(f.type===TYPE_ENUM){if(isArray(values[i])?values[i].indexOf(dval)<0:dval!==values[i]){return false}}else{if(f.type===TYPE_RANGE_INC){if(!inrange(dval,values[i]))return false}else if(f.type===TYPE_RANGE_RE){if(!inrange(dval,values[i],true,false))return false}else if(f.type===TYPE_RANGE_EXC){if(!inrange(dval,values[i],false,false))return false}else if(f.type===TYPE_RANGE_LE){if(!inrange(dval,values[i],false,true))return false}}}return true}function selectionTest(name,datum,op){var data=this.context.data[name],entries=data?data.values.value:[],unitIdx=data?data[UNIT_INDEX]&&data[UNIT_INDEX].value:undefined,intersect=op===Intersect,n=entries.length,i=0,entry,miss,count,unit,b;for(;i<n;++i){entry=entries[i];if(unitIdx&&intersect){miss=miss||{};count=miss[unit=entry.unit]||0;if(count===-1)continue;b=testPoint(datum,entry);miss[unit]=b?-1:++count;if(b&&unitIdx.size===1)return true;if(!b&&count===unitIdx.get(unit).count)return false}else{b=testPoint(datum,entry);if(intersect^b)return b}}return n&&intersect}function selectionResolve(name,op){var data=this.context.data[name],entries=data?data.values.value:[],resolved={},types={},entry,fields,values,unit,field,res,resUnit,type,union,n=entries.length,i=0,j,m;for(;i<n;++i){entry=entries[i];unit=entry.unit;fields=entry.fields;values=entry.values;for(j=0,m=fields.length;j<m;++j){field=fields[j];res=resolved[field.field]||(resolved[field.field]={});resUnit=res[unit]||(res[unit]=[]);types[field.field]=type=field.type.charAt(0);union=ops[type+"_union"];res[unit]=union(resUnit,array(values[j]))}}op=op||Union;Object.keys(resolved).forEach(function(field){resolved[field]=Object.keys(resolved[field]).map(function(unit){return resolved[field][unit]}).reduce(function(acc,curr){return acc===undefined?curr:ops[types[field]+"_"+op](acc,curr)})});return resolved}var ops={E_union:function(base,value){if(!base.length)return value;var i=0,n=value.length;for(;i<n;++i)if(base.indexOf(value[i])<0)base.push(value[i]);return base},E_intersect:function(base,value){return!base.length?value:base.filter(function(v){return value.indexOf(v)>=0})},R_union:function(base,value){var lo=toNumber(value[0]),hi=toNumber(value[1]);if(lo>hi){lo=value[1];hi=value[0]}if(!base.length)return[lo,hi];if(base[0]>lo)base[0]=lo;if(base[1]<hi)base[1]=hi;return base},R_intersect:function(base,value){var lo=toNumber(value[0]),hi=toNumber(value[1]);if(lo>hi){lo=value[1];hi=value[0]}if(!base.length)return[lo,hi];if(hi<base[0]||base[1]<lo){return[]}else{if(base[0]<lo)base[0]=lo;if(base[1]>hi)base[1]=hi}return base}};const DataPrefix=":",IndexPrefix="@";function selectionVisitor(name,args,scope,params){if(args[0].type!==Literal)error("First argument to selection functions must be a string literal.");const data=args[0].value,op=args.length>=2&&peek(args).value,field="unit",indexName=IndexPrefix+field,dataName=DataPrefix+data;if(op===Intersect&&!params.hasOwnProperty(indexName)){params[indexName]=scope.getData(data).indataRef(scope,field)}if(!params.hasOwnProperty(dataName)){params[dataName]=scope.getData(data).tuplesRef()}}function data$1(name){const data=this.context.data[name];return data?data.values.value:[]}function indata(name,field,value){const index=this.context.data[name]["index:"+field],entry=index?index.value.get(value):undefined;return entry?entry.count:entry}function setdata(name,tuples){const df=this.context.dataflow,data=this.context.data[name],input=data.input;df.pulse(input,df.changeset().remove(truthy).insert(tuples));return 1}function encode$1(item,name,retval){if(item){const df=this.context.dataflow,target=item.mark.source;df.pulse(target,df.changeset().encode(item,name))}return retval!==undefined?retval:item}const formatCache={};function formatter(type,method,specifier){let k=type+":"+specifier,e=formatCache[k];if(!e||e[0]!==method){formatCache[k]=e=[method,method(specifier)]}return e[1]}function format$2(_,specifier){return formatter("format",format$1,specifier)(_)}function timeFormat$1(_,specifier){return formatter("timeFormat",timeFormat,specifier)(_)}function utcFormat$1(_,specifier){return formatter("utcFormat",utcFormat,specifier)(_)}function timeParse$1(_,specifier){return formatter("timeParse",timeParse,specifier)(_)}function utcParse$1(_,specifier){return formatter("utcParse",utcParse,specifier)(_)}var dateObj=new Date(2e3,0,1);function time$2(month,day,specifier){dateObj.setMonth(month);dateObj.setDate(day);return timeFormat$1(dateObj,specifier)}function monthFormat(month){return time$2(month,1,"%B")}function monthAbbrevFormat(month){return time$2(month,1,"%b")}function dayFormat(day){return time$2(0,2+day,"%A")}function dayAbbrevFormat(day){return time$2(0,2+day,"%a")}function getScale(name,ctx){let s;return isFunction(name)?name:isString(name)?(s=ctx.scales[name])&&s.value:undefined}function range$4(name,group){const s=getScale(name,(group||this).context);return s&&s.range?s.range():[]}function domain(name,group){const s=getScale(name,(group||this).context);return s?s.domain():[]}function bandwidth(name,group){const s=getScale(name,(group||this).context);return s&&s.bandwidth?s.bandwidth():0}function bandspace(count,paddingInner,paddingOuter){return bandSpace(count||0,paddingInner||0,paddingOuter||0)}function copy$2(name,group){const s=getScale(name,(group||this).context);return s?s.copy():undefined}function scale$2(name,value,group){const s=getScale(name,(group||this).context);return s&&value!==undefined?s(value):undefined}function invert(name,range,group){const s=getScale(name,(group||this).context);return!s?undefined:isArray(range)?(s.invertRange||s.invert)(range):(s.invert||s.invertExtent)(range)}function geoMethod(methodName,globalMethod){return function(projection,geojson,group){if(projection){const p=getScale(projection,(group||this).context);return p&&p.path[methodName](geojson)}else{return globalMethod(geojson)}}}const geoArea=geoMethod("area",area$3);const geoBounds=geoMethod("bounds",bounds$1);const geoCentroid=geoMethod("centroid",centroid);function inScope(item){let group=this.context.group,value=false;if(group)while(item){if(item===group){value=true;break}item=item.mark.group}return value}function intersect$3(b,opt,group){if(!b)return[];const[u,v]=b,box=(new Bounds).set(u[0],u[1],v[0],v[1]),scene=group||this.context.dataflow.scenegraph().root;return intersect$1(scene,box,filter$2(opt))}function filter$2(opt){let p=null;if(opt){const types=array(opt.marktype),names=array(opt.markname);p=(_=>(!types.length||types.some(t=>_.marktype===t))&&(!names.length||names.some(s=>_.name===s)))}return p}function log$4(df,method,args){try{df[method].apply(df,["EXPRESSION"].concat([].slice.call(args)))}catch(err){df.warn(err)}return args[args.length-1]}function warn(){return log$4(this.context.dataflow,"warn",arguments)}function info(){return log$4(this.context.dataflow,"info",arguments)}function debug(){return log$4(this.context.dataflow,"debug",arguments)}function merge$3(){var args=[].slice.call(arguments);args.unshift({});return extend.apply(null,args)}function equal(a,b){return a===b||a!==a&&b!==b?true:isArray(a)&&isArray(b)&&a.length===b.length?equalArray(a,b):false}function equalArray(a,b){for(let i=0,n=a.length;i<n;++i){if(!equal(a[i],b[i]))return false}return true}function removePredicate(props){return function(_){for(let key in props){if(!equal(_[key],props[key]))return false}return true}}function modify(name,insert,remove,toggle,modify,values){let df=this.context.dataflow,data=this.context.data[name],input=data.input,changes=data.changes,stamp=df.stamp(),predicate,key;if(df._trigger===false||!(input.value.length||insert||toggle)){return 0}if(!changes||changes.stamp<stamp){data.changes=changes=df.changeset();changes.stamp=stamp;df.runAfter(function(){data.modified=true;df.pulse(input,changes).run()},true,1)}if(remove){predicate=remove===true?truthy:isArray(remove)||isTuple(remove)?remove:removePredicate(remove);changes.remove(predicate)}if(insert){changes.insert(insert)}if(toggle){predicate=removePredicate(toggle);if(input.value.some(predicate)){changes.remove(predicate)}else{changes.insert(toggle)}}if(modify){for(key in values){changes.modify(modify,key,values[key])}}return 1}function pinchDistance(event){const t=event.touches,dx=t[0].clientX-t[1].clientX,dy=t[0].clientY-t[1].clientY;return Math.sqrt(dx*dx+dy*dy)}function pinchAngle(event){const t=event.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}function scaleGradient(scale,p0,p1,count,group){scale=getScale(scale,(group||this).context);const gradient=Gradient(p0,p1);let stops=scale.domain(),min=stops[0],max=peek(stops),fraction=identity;if(!(max-min)){scale=(scale.interpolator?scale$1("sequential")().interpolator(scale.interpolator()):scale$1("linear")().interpolate(scale.interpolate()).range(scale.range())).domain([min=0,max=1])}else{fraction=scaleFraction(scale,min,max)}if(scale.ticks){stops=scale.ticks(+count||15);if(min!==stops[0])stops.unshift(min);if(max!==peek(stops))stops.push(max)}stops.forEach(_=>gradient.stop(fraction(_),scale(_)));return gradient}function geoShape(projection,geojson,group){const p=getScale(projection,(group||this).context);return function(context){return p?p.path.context(context)(geojson):""}}function pathShape(path){let p=null;return function(context){return context?pathRender(context,p=p||pathParse(path)):path}}const EMPTY={};function datum(d){return d.data}function treeNodes(name,context){const tree=data$1.call(context,name);return tree.root&&tree.root.lookup||EMPTY}function treePath(name,source,target){const nodes=treeNodes(name,this),s=nodes[source],t=nodes[target];return s&&t?s.path(t).map(datum):undefined}function treeAncestors(name,node){const n=treeNodes(name,this)[node];return n?n.ancestors().map(datum):undefined}const _window=typeof window!=="undefined"&&window||null;function screen(){return _window?_window.screen:{}}function windowSize(){return _window?[_window.innerWidth,_window.innerHeight]:[undefined,undefined]}function containerSize(){const view=this.context.dataflow,el=view.container&&view.container();return el?[el.clientWidth,el.clientHeight]:[undefined,undefined]}const DataPrefix$1=":";const IndexPrefix$1="@";const ScalePrefix="%";const SignalPrefix="$";function dataVisitor(name,args,scope,params){if(args[0].type!==Literal){error("First argument to data functions must be a string literal.")}const data=args[0].value,dataName=DataPrefix$1+data;if(!params.hasOwnProperty(dataName)){params[dataName]=scope.getData(data).tuplesRef()}}function indataVisitor(name,args,scope,params){if(args[0].type!==Literal)error("First argument to indata must be a string literal.");if(args[1].type!==Literal)error("Second argument to indata must be a string literal.");const data=args[0].value,field=args[1].value,indexName=IndexPrefix$1+field;if(!params.hasOwnProperty(indexName)){params[indexName]=scope.getData(data).indataRef(scope,field)}}function scaleVisitor(name,args,scope,params){if(args[0].type===Literal){addScaleDependency(scope,params,args[0].value)}else if(args[0].type===Identifier$1){for(name in scope.scales){addScaleDependency(scope,params,name)}}}function addScaleDependency(scope,params,name){const scaleName=ScalePrefix+name;if(!params.hasOwnProperty(scaleName)){try{params[scaleName]=scope.scaleRef(name)}catch(err){}}}const functionContext={random:function(){return exports.random()},isArray:isArray,isBoolean:isBoolean,isDate:isDate,isNumber:isNumber,isObject:isObject,isRegExp:isRegExp,isString:isString,isTuple:isTuple,toBoolean:toBoolean,toDate:toDate,toNumber:toNumber,toString:toString,flush:flush,lerp:lerp,merge:merge$3,pad:pad,peek:peek,span:span,inrange:inrange,truncate:truncate,rgb:rgb,lab:lab,hcl:hcl,hsl:hsl,sequence:sequence,format:format$2,utcFormat:utcFormat$1,utcParse:utcParse$1,timeFormat:timeFormat$1,timeParse:timeParse$1,monthFormat:monthFormat,monthAbbrevFormat:monthAbbrevFormat,dayFormat:dayFormat,dayAbbrevFormat:dayAbbrevFormat,quarter:quarter,utcquarter:utcquarter,warn:warn,info:info,debug:debug,extent:extent,inScope:inScope,intersect:intersect$3,clampRange:clampRange,pinchDistance:pinchDistance,pinchAngle:pinchAngle,screen:screen,containerSize:containerSize,windowSize:windowSize,bandspace:bandspace,setdata:setdata,pathShape:pathShape,panLinear:panLinear,panLog:panLog,panPow:panPow,panSymlog:panSymlog,zoomLinear:zoomLinear,zoomLog:zoomLog,zoomPow:zoomPow,zoomSymlog:zoomSymlog,encode:encode$1,modify:modify};const eventFunctions=["view","item","group","xy","x","y"],eventPrefix="event.vega.",thisPrefix="this.",astVisitors={};function buildFunctions(codegen){const fn=functions(codegen);eventFunctions.forEach(name=>fn[name]=eventPrefix+name);for(let name in functionContext){fn[name]=thisPrefix+name}return fn}function expressionFunction(name,fn,visitor){if(arguments.length===1){return functionContext[name]}functionContext[name]=fn;if(visitor)astVisitors[name]=visitor;if(codeGenerator)codeGenerator.functions[name]=thisPrefix+name;return this}expressionFunction("bandwidth",bandwidth,scaleVisitor);expressionFunction("copy",copy$2,scaleVisitor);expressionFunction("domain",domain,scaleVisitor);expressionFunction("range",range$4,scaleVisitor);expressionFunction("invert",invert,scaleVisitor);expressionFunction("scale",scale$2,scaleVisitor);expressionFunction("gradient",scaleGradient,scaleVisitor);expressionFunction("geoArea",geoArea,scaleVisitor);expressionFunction("geoBounds",geoBounds,scaleVisitor);expressionFunction("geoCentroid",geoCentroid,scaleVisitor);expressionFunction("geoShape",geoShape,scaleVisitor);expressionFunction("indata",indata,indataVisitor);expressionFunction("data",data$1,dataVisitor);expressionFunction("treePath",treePath,dataVisitor);expressionFunction("treeAncestors",treeAncestors,dataVisitor);expressionFunction("vlSelectionTest",selectionTest,selectionVisitor);expressionFunction("vlSelectionResolve",selectionResolve,selectionVisitor);const codegenParams={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(id){return"_["+$(SignalPrefix+id)+"]"},functions:buildFunctions,constants:constants,visitors:astVisitors};var codeGenerator=codegen(codegenParams);function expression(args,code,ctx){if(code[code.length-1]!==";"){code="return("+code+");"}var fn=Function.apply(null,args.concat(code));return ctx&&ctx.functions?fn.bind(ctx.functions):fn}function operatorExpression(code,ctx){return expression(["_"],code,ctx)}function parameterExpression(code,ctx){return expression(["datum","_"],code,ctx)}function eventExpression(code,ctx){return expression(["event"],code,ctx)}function handlerExpression(code,ctx){return expression(["_","event"],code,ctx)}function encodeExpression(code,ctx){return expression(["item","_"],code,ctx)}function parseParameters(spec,ctx,params){params=params||{};var key,value;for(key in spec){value=spec[key];params[key]=isArray(value)?value.map(function(v){return parseParameter(v,ctx,params)}):parseParameter(value,ctx,params)}return params}function parseParameter(spec,ctx,params){if(!spec||!isObject(spec))return spec;for(var i=0,n=PARSERS.length,p;i<n;++i){p=PARSERS[i];if(spec.hasOwnProperty(p.key)){return p.parse(spec,ctx,params)}}return spec}var PARSERS=[{key:"$ref",parse:getOperator},{key:"$key",parse:getKey},{key:"$expr",parse:getExpression},{key:"$field",parse:getField$1},{key:"$encode",parse:getEncode},{key:"$compare",parse:getCompare},{key:"$context",parse:getContext},{key:"$subflow",parse:getSubflow},{key:"$tupleid",parse:getTupleId}];function getOperator(_,ctx){return ctx.get(_.$ref)||error("Operator not defined: "+_.$ref)}function getExpression(_,ctx,params){if(_.$params){parseParameters(_.$params,ctx,params)}var k="e:"+_.$expr+"_"+_.$name;return ctx.fn[k]||(ctx.fn[k]=accessor(parameterExpression(_.$expr,ctx),_.$fields,_.$name))}function getKey(_,ctx){var k="k:"+_.$key+"_"+!!_.$flat;return ctx.fn[k]||(ctx.fn[k]=key(_.$key,_.$flat))}function getField$1(_,ctx){if(!_.$field)return null;var k="f:"+_.$field+"_"+_.$name;return ctx.fn[k]||(ctx.fn[k]=field(_.$field,_.$name))}function getCompare(_,ctx){var k="c:"+_.$compare+"_"+_.$order,c=array(_.$compare).map(function(_){return _&&_.$tupleid?tupleid:_});return ctx.fn[k]||(ctx.fn[k]=compare(c,_.$order))}function getEncode(_,ctx){var spec=_.$encode,encode={},name,enc;for(name in spec){enc=spec[name];encode[name]=accessor(encodeExpression(enc.$expr,ctx),enc.$fields);encode[name].output=enc.$output}return encode}function getContext(_,ctx){return ctx}function getSubflow(_,ctx){var spec=_.$subflow;return function(dataflow,key,parent){var subctx=parse$4(spec,ctx.fork()),op=subctx.get(spec.operators[0].id),p=subctx.signals.parent;if(p)p.set(parent);return op}}function getTupleId(){return tupleid}function canonicalType(type){return(type+"").toLowerCase()}function isOperator(type){return canonicalType(type)==="operator"}function isCollect(type){return canonicalType(type)==="collect"}function parseOperator(spec,ctx){if(isOperator(spec.type)||!spec.type){ctx.operator(spec,spec.update?operatorExpression(spec.update,ctx):null)}else{ctx.transform(spec,spec.type)}}function parseOperatorParameters(spec,ctx){if(spec.params){var op=ctx.get(spec.id);if(!op)error("Invalid operator id: "+spec.id);ctx.dataflow.connect(op,op.parameters(parseParameters(spec.params,ctx),spec.react,spec.initonly))}}function parseStream(spec,ctx){var filter=spec.filter!=null?eventExpression(spec.filter,ctx):undefined,stream=spec.stream!=null?ctx.get(spec.stream):undefined,args;if(spec.source){stream=ctx.events(spec.source,spec.type,filter)}else if(spec.merge){args=spec.merge.map(ctx.get.bind(ctx));stream=args[0].merge.apply(args[0],args.slice(1))}if(spec.between){args=spec.between.map(ctx.get.bind(ctx));stream=stream.between(args[0],args[1])}if(spec.filter){stream=stream.filter(filter)}if(spec.throttle!=null){stream=stream.throttle(+spec.throttle)}if(spec.debounce!=null){stream=stream.debounce(+spec.debounce)}if(stream==null){error("Invalid stream definition: "+JSON.stringify(spec))}if(spec.consume)stream.consume(true);ctx.stream(spec,stream)}function parseUpdate(spec,ctx){var srcid=isObject(srcid=spec.source)?srcid.$ref:srcid,source=ctx.get(srcid),target=null,update=spec.update,params=undefined;if(!source)error("Source not defined: "+spec.source);if(spec.target&&spec.target.$expr){target=eventExpression(spec.target.$expr,ctx)}else{target=ctx.get(spec.target)}if(update&&update.$expr){if(update.$params){params=parseParameters(update.$params,ctx)}update=handlerExpression(update.$expr,ctx)}ctx.update(spec,source,target,update,params)}function parse$4(spec,ctx){var operators=spec.operators||[];if(spec.background){ctx.background=spec.background}if(spec.eventConfig){ctx.eventConfig=spec.eventConfig}operators.forEach(function(entry){parseOperator(entry,ctx)});operators.forEach(function(entry){parseOperatorParameters(entry,ctx)});(spec.streams||[]).forEach(function(entry){parseStream(entry,ctx)});(spec.updates||[]).forEach(function(entry){parseUpdate(entry,ctx)});return ctx.resolve()}var SKIP$3={skip:true};function getState(options){var ctx=this,state={};if(options.signals){var signals=state.signals={};Object.keys(ctx.signals).forEach(function(key){var op=ctx.signals[key];if(options.signals(key,op)){signals[key]=op.value}})}if(options.data){var data=state.data={};Object.keys(ctx.data).forEach(function(key){var dataset=ctx.data[key];if(options.data(key,dataset)){data[key]=dataset.input.value}})}if(ctx.subcontext&&options.recurse!==false){state.subcontext=ctx.subcontext.map(function(ctx){return ctx.getState(options)})}return state}function setState(state){var ctx=this,df=ctx.dataflow,data=state.data,signals=state.signals;Object.keys(signals||{}).forEach(function(key){df.update(ctx.signals[key],signals[key],SKIP$3)});Object.keys(data||{}).forEach(function(key){df.pulse(ctx.data[key].input,df.changeset().remove(truthy).insert(data[key]))});(state.subcontext||[]).forEach(function(substate,i){var subctx=ctx.subcontext[i];if(subctx)subctx.setState(substate)})}function context$2(df,transforms,functions){return new Context(df,transforms,functions)}function Context(df,transforms,functions){this.dataflow=df;this.transforms=transforms;this.events=df.events.bind(df);this.signals={};this.scales={};this.nodes={};this.data={};this.fn={};if(functions){this.functions=Object.create(functions);this.functions.context=this}}function ContextFork(ctx){this.dataflow=ctx.dataflow;this.transforms=ctx.transforms;this.functions=ctx.functions;this.events=ctx.events;this.signals=Object.create(ctx.signals);this.scales=Object.create(ctx.scales);this.nodes=Object.create(ctx.nodes);this.data=Object.create(ctx.data);this.fn=Object.create(ctx.fn);if(ctx.functions){this.functions=Object.create(ctx.functions);this.functions.context=this}}Context.prototype=ContextFork.prototype={fork:function(){var ctx=new ContextFork(this);(this.subcontext||(this.subcontext=[])).push(ctx);return ctx},get:function(id){return this.nodes[id]},set:function(id,node){return this.nodes[id]=node},add:function(spec,op){var ctx=this,df=ctx.dataflow,data;ctx.set(spec.id,op);if(isCollect(spec.type)&&(data=spec.value)){if(data.$ingest){df.ingest(op,data.$ingest,data.$format)}else if(data.$request){df.preload(op,data.$request,data.$format)}else{df.pulse(op,df.changeset().insert(data))}}if(spec.root){ctx.root=op}if(spec.parent){var p=ctx.get(spec.parent.$ref);if(p){df.connect(p,[op]);op.targets().add(p)}else{(ctx.unresolved=ctx.unresolved||[]).push(function(){p=ctx.get(spec.parent.$ref);df.connect(p,[op]);op.targets().add(p)})}}if(spec.signal){ctx.signals[spec.signal]=op}if(spec.scale){ctx.scales[spec.scale]=op}if(spec.data){for(var name in spec.data){data=ctx.data[name]||(ctx.data[name]={});spec.data[name].forEach(function(role){data[role]=op})}}},resolve:function(){(this.unresolved||[]).forEach(function(fn){fn()});delete this.unresolved;return this},operator:function(spec,update){this.add(spec,this.dataflow.add(spec.value,update))},transform:function(spec,type){this.add(spec,this.dataflow.add(this.transforms[canonicalType(type)]))},stream:function(spec,stream){this.set(spec.id,stream)},update:function(spec,stream,target,update,params){this.dataflow.on(stream,target,update,params,spec.options)},getState:getState,setState:setState};function runtime(view,spec,functions){var fn=functions||functionContext;return parse$4(spec,context$2(view,transforms,fn))}function scale$3(name){var scales=this._runtime.scales;if(!scales.hasOwnProperty(name)){error("Unrecognized scale or projection: "+name)}return scales[name].value}var Width="width",Height="height",Padding$1="padding",Skip={skip:true};function viewWidth(view,width){var a=view.autosize(),p=view.padding();return width-(a&&a.contains===Padding$1?p.left+p.right:0)}function viewHeight(view,height){var a=view.autosize(),p=view.padding();return height-(a&&a.contains===Padding$1?p.top+p.bottom:0)}function initializeResize(view){var s=view._signals,w=s[Width],h=s[Height],p=s[Padding$1];function resetSize(){view._autosize=view._resize=1}view._resizeWidth=view.add(null,function(_){view._width=_.size;view._viewWidth=viewWidth(view,_.size);resetSize()},{size:w});view._resizeHeight=view.add(null,function(_){view._height=_.size;view._viewHeight=viewHeight(view,_.size);resetSize()},{size:h});var resizePadding=view.add(null,resetSize,{pad:p});view._resizeWidth.rank=w.rank+1;view._resizeHeight.rank=h.rank+1;resizePadding.rank=p.rank+1}function resizeView(viewWidth,viewHeight,width,height,origin,auto){this.runAfter(function(view){var rerun=0;view._autosize=0;if(view.width()!==width){rerun=1;view.signal(Width,width,Skip);view._resizeWidth.skip(true)}if(view.height()!==height){rerun=1;view.signal(Height,height,Skip);view._resizeHeight.skip(true)}if(view._viewWidth!==viewWidth){view._resize=1;view._viewWidth=viewWidth}if(view._viewHeight!==viewHeight){view._resize=1;view._viewHeight=viewHeight}if(view._origin[0]!==origin[0]||view._origin[1]!==origin[1]){view._resize=1;view._origin=origin}if(rerun)view.run("enter");if(auto)view.runAfter(v=>v.resize())},false,1)}function getState$1(options){return this._runtime.getState(options||{data:dataTest,signals:signalTest,recurse:true})}function dataTest(name,data){return data.modified&&isArray(data.input.value)&&name.indexOf("_:vega:_")}function signalTest(name,op){return!(name==="parent"||op instanceof transforms.proxy)}function setState$1(state){this.runAsync(null,v=>{v._trigger=false;v._runtime.setState(state)},v=>{v._trigger=true});return this}function timer$1(callback,delay){function tick(elapsed){callback({timestamp:Date.now(),elapsed:elapsed})}this._timers.push(interval$1(tick,delay))}function defaultTooltip$1(handler,event,item,value){var el=handler.element();if(el)el.setAttribute("title",formatTooltip(value))}function formatTooltip(value){return value==null?"":isArray(value)?formatArray(value):isObject(value)&&!isDate(value)?formatObject(value):value+""}function formatObject(obj){return Object.keys(obj).map(function(key){var v=obj[key];return key+": "+(isArray(v)?formatArray(v):formatValue$1(v))}).join("\n")}function formatArray(value){return"["+value.map(formatValue$1).join(", ")+"]"}function formatValue$1(value){return isArray(value)?"[]":isObject(value)&&!isDate(value)?"{}":value}function View(spec,options){var view=this;options=options||{};Dataflow.call(view);if(options.loader)view.loader(options.loader);if(options.logger)view.logger(options.logger);if(options.logLevel!=null)view.logLevel(options.logLevel);view._el=null;view._elBind=null;view._renderType=options.renderer||RenderType.Canvas;view._scenegraph=new Scenegraph;var root=view._scenegraph.root;view._renderer=null;view._tooltip=options.tooltip||defaultTooltip$1,view._redraw=true;view._handler=(new CanvasHandler).scene(root);view._preventDefault=false;view._timers=[];view._eventListeners=[];view._resizeListeners=[];var ctx=runtime(view,spec,options.functions);view._runtime=ctx;view._signals=ctx.signals;view._bind=(spec.bindings||[]).map(function(_){return{state:null,param:extend({},_)}});if(ctx.root)ctx.root.set(root);root.source=ctx.data.root.input;view.pulse(ctx.data.root.input,view.changeset().insert(root.items));view._background=options.background||ctx.background||null;view._eventConfig=initializeEventConfig(ctx.eventConfig);view._width=view.width();view._height=view.height();view._viewWidth=viewWidth(view,view._width);view._viewHeight=viewHeight(view,view._height);view._origin=[0,0];view._resize=0;view._autosize=1;initializeResize(view);cursor(view);if(options.hover)view.hover();if(options.container)view.initialize(options.container,options.bind)}var prototype$1j=inherits(View,Dataflow);prototype$1j.evaluate=async function(encode,prerun,postrun){await Dataflow.prototype.evaluate.call(this,encode,prerun);if(this._redraw||this._resize){try{if(this._renderer){if(this._resize){this._resize=0;resizeRenderer(this)}await this._renderer.renderAsync(this._scenegraph.root)}this._redraw=false}catch(e){this.error(e)}}if(postrun)asyncCallback(this,postrun);return this};prototype$1j.dirty=function(item){this._redraw=true;this._renderer&&this._renderer.dirty(item)};prototype$1j.container=function(){return this._el};prototype$1j.scenegraph=function(){return this._scenegraph};prototype$1j.origin=function(){return this._origin.slice()};function lookupSignal(view,name){return view._signals.hasOwnProperty(name)?view._signals[name]:error("Unrecognized signal name: "+$(name))}prototype$1j.signal=function(name,value,options){var op=lookupSignal(this,name);return arguments.length===1?op.value:this.update(op,value,options)};prototype$1j.background=function(_){if(arguments.length){this._background=_;this._resize=1;return this}else{return this._background}};prototype$1j.width=function(_){return arguments.length?this.signal("width",_):this.signal("width")};prototype$1j.height=function(_){return arguments.length?this.signal("height",_):this.signal("height")};prototype$1j.padding=function(_){return arguments.length?this.signal("padding",_):this.signal("padding")};prototype$1j.autosize=function(_){return arguments.length?this.signal("autosize",_):this.signal("autosize")};prototype$1j.renderer=function(type){if(!arguments.length)return this._renderType;if(!renderModule(type))error("Unrecognized renderer type: "+type);if(type!==this._renderType){this._renderType=type;this._resetRenderer()}return this};prototype$1j.tooltip=function(handler){if(!arguments.length)return this._tooltip;if(handler!==this._tooltip){this._tooltip=handler;this._resetRenderer()}return this};prototype$1j.loader=function(loader){if(!arguments.length)return this._loader;if(loader!==this._loader){Dataflow.prototype.loader.call(this,loader);this._resetRenderer()}return this};prototype$1j.resize=function(){this._autosize=1;return this.touch(lookupSignal(this,"autosize"))};prototype$1j._resetRenderer=function(){if(this._renderer){this._renderer=null;this.initialize(this._el,this._elBind)}};prototype$1j._resizeView=resizeView;prototype$1j.addEventListener=function(type,handler,options){var callback=handler;if(!(options&&options.trap===false)){callback=trap(this,handler);callback.raw=handler}this._handler.on(type,callback);return this};prototype$1j.removeEventListener=function(type,handler){var handlers=this._handler.handlers(type),i=handlers.length,h,t;while(--i>=0){t=handlers[i].type;h=handlers[i].handler;if(type===t&&(handler===h||handler===h.raw)){this._handler.off(t,h);break}}return this};prototype$1j.addResizeListener=function(handler){var l=this._resizeListeners;if(l.indexOf(handler)<0){l.push(handler)}return this};prototype$1j.removeResizeListener=function(handler){var l=this._resizeListeners,i=l.indexOf(handler);if(i>=0){l.splice(i,1)}return this};function findOperatorHandler(op,handler){var t=op._targets||[],h=t.filter(function(op){var u=op._update;return u&&u.handler===handler});return h.length?h[0]:null}function addOperatorListener(view,name,op,handler){var h=findOperatorHandler(op,handler);if(!h){h=trap(this,function(){handler(name,op.value)});h.handler=handler;view.on(op,null,h)}return view}function removeOperatorListener(view,op,handler){var h=findOperatorHandler(op,handler);if(h)op._targets.remove(h);return view}prototype$1j.addSignalListener=function(name,handler){return addOperatorListener(this,name,lookupSignal(this,name),handler)};prototype$1j.removeSignalListener=function(name,handler){return removeOperatorListener(this,lookupSignal(this,name),handler)};prototype$1j.addDataListener=function(name,handler){return addOperatorListener(this,name,dataref(this,name).values,handler)};prototype$1j.removeDataListener=function(name,handler){return removeOperatorListener(this,dataref(this,name).values,handler)};prototype$1j.preventDefault=function(_){if(arguments.length){this._preventDefault=_;return this}else{return this._preventDefault}};prototype$1j.timer=timer$1;prototype$1j.events=events$1;prototype$1j.finalize=finalize;prototype$1j.hover=hover;prototype$1j.data=data;prototype$1j.change=change;prototype$1j.insert=insert;prototype$1j.remove=remove;prototype$1j.scale=scale$3;prototype$1j.initialize=initialize$1;prototype$1j.toImageURL=renderToImageURL;prototype$1j.toCanvas=renderToCanvas;prototype$1j.toSVG=renderToSVG;prototype$1j.getState=getState$1;prototype$1j.setState=setState$1;function parseAutosize(spec,config){spec=spec||config.autosize;return isObject(spec)?spec:{type:spec||"pad"}}function parsePadding(spec,config){spec=spec||config.padding;return isObject(spec)?{top:number$4(spec.top),bottom:number$4(spec.bottom),left:number$4(spec.left),right:number$4(spec.right)}:paddingObject(number$4(spec))}function number$4(_){return+_||0}function paddingObject(_){return{top:_,bottom:_,left:_,right:_}}var OUTER="outer",OUTER_INVALID=["value","update","init","react","bind"];function outerError(prefix,name){error(prefix+' for "outer" push: '+$(name))}function parseSignal(signal,scope){var name=signal.name;if(signal.push===OUTER){if(!scope.signals[name])outerError("No prior signal definition",name);OUTER_INVALID.forEach(function(prop){if(signal[prop]!==undefined)outerError("Invalid property ",prop)})}else{var op=scope.addSignal(name,signal.value);if(signal.react===false)op.react=false;if(signal.bind)scope.addBinding(name,signal.bind)}}function parseExpression$1(expr,scope,preamble){var params={},ast,gen;try{expr=isString(expr)?expr:$(expr)+"";ast=parse$3(expr)}catch(err){error("Expression parse error: "+expr)}ast.visit(function visitor(node){if(node.type!==CallExpression)return;var name=node.callee.name,visit=codegenParams.visitors[name];if(visit)visit(name,node.arguments,scope,params)});gen=codeGenerator(ast);gen.globals.forEach(function(name){var signalName=SignalPrefix+name;if(!params.hasOwnProperty(signalName)&&scope.getSignal(name)){params[signalName]=scope.signalRef(name)}});return{$expr:preamble?preamble+"return("+gen.code+");":gen.code,$fields:gen.fields,$params:params}}function Entry(type,value,params,parent){this.id=-1;this.type=type;this.value=value;this.params=params;if(parent)this.parent=parent}function entry(type,value,params,parent){return new Entry(type,value,params,parent)}function operator(value,params){return entry("operator",value,params)}function ref(op){var ref={$ref:op.id};if(op.id<0)(op.refs=op.refs||[]).push(ref);return ref}var tupleidRef={$tupleid:1,toString:function(){return":_tupleid_:"}};function fieldRef(field,name){return name?{$field:field,$name:name}:{$field:field}}var keyFieldRef=fieldRef("key");function compareRef(fields,orders){return{$compare:fields,$order:orders}}function keyRef(fields,flat){var ref={$key:fields};if(flat)ref.$flat=true;return ref}var Ascending="ascending";var Descending="descending";function sortKey(sort){return!isObject(sort)?"":(sort.order===Descending?"-":"+")+aggrField(sort.op,sort.field)}function aggrField(op,field){return(op&&op.signal?"$"+op.signal:op||"")+(op&&field?"_":"")+(field&&field.signal?"$"+field.signal:field||"")}var Scope="scope";var View$1="view";function isSignal(_){return _&&_.signal}function hasSignal(_){if(isSignal(_))return true;if(isObject(_))for(var key in _){if(hasSignal(_[key]))return true}return false}function value(specValue,defaultValue){return specValue!=null?specValue:defaultValue}function deref(v){return v&&v.signal||v}var Timer$1="timer";function parseStream$1(stream,scope){var method=stream.merge?mergeStream:stream.stream?nestedStream:stream.type?eventStream:error("Invalid stream specification: "+$(stream));return method(stream,scope)}function eventSource(source){return source===Scope?View$1:source||View$1}function mergeStream(stream,scope){var list=stream.merge.map(s=>parseStream$1(s,scope)),entry=streamParameters({merge:list},stream,scope);return scope.addStream(entry).id}function nestedStream(stream,scope){var id=parseStream$1(stream.stream,scope),entry=streamParameters({stream:id},stream,scope);return scope.addStream(entry).id}function eventStream(stream,scope){var id,entry;if(stream.type===Timer$1){id=scope.event(Timer$1,stream.throttle);stream={between:stream.between,filter:stream.filter}}else{id=scope.event(eventSource(stream.source),stream.type)}entry=streamParameters({stream:id},stream,scope);return Object.keys(entry).length===1?id:scope.addStream(entry).id}function streamParameters(entry,stream,scope){var param=stream.between;if(param){if(param.length!==2){error('Stream "between" parameter must have 2 entries: '+$(stream))}entry.between=[parseStream$1(param[0],scope),parseStream$1(param[1],scope)]}param=stream.filter?[].concat(stream.filter):[];if(stream.marktype||stream.markname||stream.markrole){param.push(filterMark(stream.marktype,stream.markname,stream.markrole))}if(stream.source===Scope){param.push("inScope(event.item)")}if(param.length){entry.filter=parseExpression$1("("+param.join(")&&(")+")").$expr}if((param=stream.throttle)!=null){entry.throttle=+param}if((param=stream.debounce)!=null){entry.debounce=+param}if(stream.consume){entry.consume=true}return entry}function filterMark(type,name,role){var item="event.item";return item+(type&&type!=="*"?"&&"+item+".mark.marktype==='"+type+"'":"")+(role?"&&"+item+".mark.role==='"+role+"'":"")+(name?"&&"+item+".mark.name==='"+name+"'":"")}function selector(selector,source,marks){DEFAULT_SOURCE=source||VIEW$1;MARKS=marks||DEFAULT_MARKS;return parseMerge(selector.trim()).map(parseSelector)}var VIEW$1="view",LBRACK="[",RBRACK="]",LBRACE="{",RBRACE="}",COLON=":",COMMA=",",NAME="@",GT=">",ILLEGAL$1=/[[\]{}]/,DEFAULT_SOURCE,MARKS,DEFAULT_MARKS={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function isMarkType(type){return MARKS.hasOwnProperty(type)}function find$1(s,i,endChar,pushChar,popChar){var count=0,n=s.length,c;for(;i<n;++i){c=s[i];if(!count&&c===endChar)return i;else if(popChar&&popChar.indexOf(c)>=0)--count;else if(pushChar&&pushChar.indexOf(c)>=0)++count}return i}function parseMerge(s){var output=[],start=0,n=s.length,i=0;while(i<n){i=find$1(s,i,COMMA,LBRACK+LBRACE,RBRACK+RBRACE);output.push(s.substring(start,i).trim());start=++i}if(output.length===0){throw"Empty event selector: "+s}return output}function parseSelector(s){return s[0]==="["?parseBetween(s):parseStream$2(s)}function parseBetween(s){var n=s.length,i=1,b,stream;i=find$1(s,i,RBRACK,LBRACK,RBRACK);if(i===n){throw"Empty between selector: "+s}b=parseMerge(s.substring(1,i));if(b.length!==2){throw"Between selector must have two elements: "+s}s=s.slice(i+1).trim();if(s[0]!==GT){throw"Expected '>' after between selector: "+s}b=b.map(parseSelector);stream=parseSelector(s.slice(1).trim());if(stream.between){return{between:b,stream:stream}}else{stream.between=b}return stream}function parseStream$2(s){var stream={source:DEFAULT_SOURCE},source=[],throttle=[0,0],markname=0,start=0,n=s.length,i=0,j,filter;if(s[n-1]===RBRACE){i=s.lastIndexOf(LBRACE);if(i>=0){try{throttle=parseThrottle(s.substring(i+1,n-1))}catch(e){throw"Invalid throttle specification: "+s}s=s.slice(0,i).trim();n=s.length}else throw"Unmatched right brace: "+s;i=0}if(!n)throw s;if(s[0]===NAME)markname=++i;j=find$1(s,i,COLON);if(j<n){source.push(s.substring(start,j).trim());start=i=++j}i=find$1(s,i,LBRACK);if(i===n){source.push(s.substring(start,n).trim())}else{source.push(s.substring(start,i).trim());filter=[];start=++i;if(start===n)throw"Unmatched left bracket: "+s}while(i<n){i=find$1(s,i,RBRACK);if(i===n)throw"Unmatched left bracket: "+s;filter.push(s.substring(start,i).trim());if(i<n-1&&s[++i]!==LBRACK)throw"Expected left bracket: "+s;start=++i}if(!(n=source.length)||ILLEGAL$1.test(source[n-1])){throw"Invalid event selector: "+s}if(n>1){stream.type=source[1];if(markname){stream.markname=source[0].slice(1)}else if(isMarkType(source[0])){stream.marktype=source[0]}else{stream.source=source[0]}}else{stream.type=source[0]}if(stream.type.slice(-1)==="!"){stream.consume=true;stream.type=stream.type.slice(0,-1)}if(filter!=null)stream.filter=filter;if(throttle[0])stream.throttle=throttle[0];if(throttle[1])stream.debounce=throttle[1];return stream}function parseThrottle(s){var a=s.split(COMMA);if(!s.length||a.length>2)throw s;return a.map(function(_){var x=+_;if(x!==x)throw s;return x})}var preamble="var datum=event.item&&event.item.datum;";function parseUpdate$1(spec,scope,target){var events=spec.events,update=spec.update,encode=spec.encode,sources=[],entry={target:target};if(!events){error("Signal update missing events specification.")}if(isString(events)){events=selector(events,scope.isSubscope()?Scope:View$1)}events=array(events).filter(s=>s.signal||s.scale?(sources.push(s),0):1);if(sources.length>1){sources=[mergeSources(sources)]}if(events.length){sources.push(events.length>1?{merge:events}:events[0])}if(encode!=null){if(update)error("Signal encode and update are mutually exclusive.");update="encode(item(),"+$(encode)+")"}entry.update=isString(update)?parseExpression$1(update,scope,preamble):update.expr!=null?parseExpression$1(update.expr,scope,preamble):update.value!=null?update.value:update.signal!=null?{$expr:"_.value",$params:{value:scope.signalRef(update.signal)}}:error("Invalid signal update specification.");if(spec.force){entry.options={force:true}}sources.forEach(function(source){scope.addUpdate(extend(streamSource(source,scope),entry))})}function streamSource(stream,scope){return{source:stream.signal?scope.signalRef(stream.signal):stream.scale?scope.scaleRef(stream.scale):parseStream$1(stream,scope)}}function mergeSources(sources){return{signal:"["+sources.map(s=>s.scale?'scale("'+s.scale+'")':s.signal)+"]"}}function parseSignalUpdates(signal,scope){var op=scope.getSignal(signal.name),expr=signal.update;if(signal.init){if(expr){error("Signals can not include both init and update expressions.")}else{expr=signal.init;op.initonly=true}}if(expr){expr=parseExpression$1(expr,scope);op.update=expr.$expr;op.params=expr.$params}if(signal.on){signal.on.forEach(function(_){parseUpdate$1(_,scope,op.id)})}}function transform$2(name){return function(params,value,parent){return entry(name,value,params||undefined,parent)}}var Aggregate$1=transform$2("aggregate");var AxisTicks$1=transform$2("axisticks");var Bound$1=transform$2("bound");var Collect$1=transform$2("collect");var Compare$1=transform$2("compare");var DataJoin$1=transform$2("datajoin");var Encode$1=transform$2("encode");var Expression$1=transform$2("expression");var Facet$1=transform$2("facet");var Field$1=transform$2("field");var Key$1=transform$2("key");var LegendEntries$1=transform$2("legendentries");var Load$1=transform$2("load");var Mark$1=transform$2("mark");var MultiExtent$1=transform$2("multiextent");var MultiValues$1=transform$2("multivalues");var Overlap$1=transform$2("overlap");var Params$2=transform$2("params");var PreFacet$1=transform$2("prefacet");var Projection$1=transform$2("projection");var Proxy$1=transform$2("proxy");var Relay$1=transform$2("relay");var Render$1=transform$2("render");var Scale$1=transform$2("scale");var Sieve$1=transform$2("sieve");var SortItems$1=transform$2("sortitems");var ViewLayout$1=transform$2("viewlayout");var Values$1=transform$2("values");var FIELD_REF_ID=0;function initScale(spec,scope){var type=spec.type||"linear";if(!isValidScaleType(type)){error("Unrecognized scale type: "+$(type))}scope.addScale(spec.name,{type:type,domain:undefined})}function parseScale(spec,scope){var params=scope.getScale(spec.name).params,key;params.domain=parseScaleDomain(spec.domain,spec,scope);if(spec.range!=null){params.range=parseScaleRange(spec,scope,params)}if(spec.interpolate!=null){parseScaleInterpolate(spec.interpolate,params)}if(spec.nice!=null){params.nice=parseScaleNice(spec.nice)}if(spec.bins!=null){params.bins=parseScaleBins(spec.bins,scope)}for(key in spec){if(params.hasOwnProperty(key)||key==="name")continue;params[key]=parseLiteral(spec[key],scope)}}function parseLiteral(v,scope){return!isObject(v)?v:v.signal?scope.signalRef(v.signal):error("Unsupported object: "+$(v))}function parseArray(v,scope){return v.signal?scope.signalRef(v.signal):v.map(v=>parseLiteral(v,scope))}function dataLookupError(name){error("Can not find data set: "+$(name))}function parseScaleDomain(domain,spec,scope){if(!domain){if(spec.domainMin!=null||spec.domainMax!=null){error("No scale domain defined for domainMin/domainMax to override.")}return}return domain.signal?scope.signalRef(domain.signal):(isArray(domain)?explicitDomain:domain.fields?multipleDomain:singularDomain)(domain,spec,scope)}function explicitDomain(domain,spec,scope){return domain.map(function(v){return parseLiteral(v,scope)})}function singularDomain(domain,spec,scope){var data=scope.getData(domain.data);if(!data)dataLookupError(domain.data);return isDiscrete(spec.type)?data.valuesRef(scope,domain.field,parseSort(domain.sort,false)):isQuantile(spec.type)?data.domainRef(scope,domain.field):data.extentRef(scope,domain.field)}function multipleDomain(domain,spec,scope){var data=domain.data,fields=domain.fields.reduce(function(dom,d){d=isString(d)?{data:data,field:d}:isArray(d)||d.signal?fieldRef$1(d,scope):d;dom.push(d);return dom},[]);return(isDiscrete(spec.type)?ordinalMultipleDomain:isQuantile(spec.type)?quantileMultipleDomain:numericMultipleDomain)(domain,scope,fields)}function fieldRef$1(data,scope){var name="_:vega:_"+FIELD_REF_ID++,coll=Collect$1({});if(isArray(data)){coll.value={$ingest:data}}else if(data.signal){var code="setdata("+$(name)+","+data.signal+")";coll.params.input=scope.signalRef(code)}scope.addDataPipeline(name,[coll,Sieve$1({})]);return{data:name,field:"data"}}function ordinalMultipleDomain(domain,scope,fields){var counts,a,c,v;counts=fields.map(function(f){var data=scope.getData(f.data);if(!data)dataLookupError(f.data);return data.countsRef(scope,f.field)});a=scope.add(Aggregate$1({groupby:keyFieldRef,ops:["sum"],fields:[scope.fieldRef("count")],as:["count"],pulse:counts}));c=scope.add(Collect$1({pulse:ref(a)}));v=scope.add(Values$1({field:keyFieldRef,sort:scope.sortRef(parseSort(domain.sort,true)),pulse:ref(c)}));return ref(v)}function parseSort(sort,multidomain){if(sort){if(!sort.field&&!sort.op){if(isObject(sort))sort.field="key";else sort={field:"key"}}else if(!sort.field&&sort.op!=="count"){error("No field provided for sort aggregate op: "+sort.op)}else if(multidomain&&sort.field){error("Multiple domain scales can not sort by field.")}else if(multidomain&&sort.op&&sort.op!=="count"){error("Multiple domain scales support op count only.")}}return sort}function quantileMultipleDomain(domain,scope,fields){var values=fields.map(function(f){var data=scope.getData(f.data);if(!data)dataLookupError(f.data);return data.domainRef(scope,f.field)});return ref(scope.add(MultiValues$1({values:values})))}function numericMultipleDomain(domain,scope,fields){var extents=fields.map(function(f){var data=scope.getData(f.data);if(!data)dataLookupError(f.data);return data.extentRef(scope,f.field)});return ref(scope.add(MultiExtent$1({extents:extents})))}function parseScaleBins(v,scope){return v.signal||isArray(v)?parseArray(v,scope):scope.objectProperty(v)}function parseScaleNice(nice){return isObject(nice)?{interval:parseLiteral(nice.interval),step:parseLiteral(nice.step)}:parseLiteral(nice)}function parseScaleInterpolate(interpolate,params){params.interpolate=parseLiteral(interpolate.type||interpolate);if(interpolate.gamma!=null){params.interpolateGamma=parseLiteral(interpolate.gamma)}}function parseScaleRange(spec,scope,params){var range=spec.range,config=scope.config.range;if(range.signal){return scope.signalRef(range.signal)}else if(isString(range)){if(config&&config.hasOwnProperty(range)){spec=extend({},spec,{range:config[range]});return parseScaleRange(spec,scope,params)}else if(range==="width"){range=[0,{signal:"width"}]}else if(range==="height"){range=isDiscrete(spec.type)?[0,{signal:"height"}]:[{signal:"height"},0]}else{error("Unrecognized scale range value: "+$(range))}}else if(range.scheme){params.scheme=isArray(range.scheme)?parseArray(range.scheme,scope):parseLiteral(range.scheme,scope);if(range.extent)params.schemeExtent=parseArray(range.extent,scope);if(range.count)params.schemeCount=parseLiteral(range.count,scope);return}else if(range.step){params.rangeStep=parseLiteral(range.step,scope);return}else if(isDiscrete(spec.type)&&!isArray(range)){return parseScaleDomain(range,spec,scope)}else if(!isArray(range)){error("Unsupported range type: "+$(range))}return range.map(v=>(isArray(v)?parseArray:parseLiteral)(v,scope))}function parseProjection(proj,scope){var params={};for(var name in proj){if(name==="name")continue;params[name]=parseParameter$1(proj[name],name,scope)}scope.addProjection(proj.name,params)}function parseParameter$1(_,name,scope){return isArray(_)?_.map(function(_){return parseParameter$1(_,name,scope)}):!isObject(_)?_:_.signal?scope.signalRef(_.signal):name==="fit"?_:error("Unsupported parameter object: "+$(_))}const Top$1="top";const Left$1="left";const Right$1="right";const Bottom$1="bottom";const Center$1="center";const Vertical="vertical";const Start$1="start";const Middle$1="middle";const End$1="end";const Index="index";const Label="label";const Offset="offset";const Perc="perc";const Perc2="perc2";const Size="size";const Value="value";const GuideLabelStyle="guide-label";const GuideTitleStyle="guide-title";const GroupTitleStyle="group-title";const Symbols$2="symbol";const Gradient$2="gradient";const Discrete$1="discrete";const LegendScales=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"];const Skip$1={name:1,interactive:1};const zero$2={value:0};const one$2={value:1};var Skip$2=toSet(["rule"]),Swap=toSet(["group","image","rect"]);function adjustSpatial(encode,marktype){var code="";if(Skip$2[marktype])return code;if(encode.x2){if(encode.x){if(Swap[marktype]){code+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"}code+="o.width=o.x2-o.x;"}else{code+="o.x=o.x2-(o.width||0);"}}if(encode.xc){code+="o.x=o.xc-(o.width||0)/2;"}if(encode.y2){if(encode.y){if(Swap[marktype]){code+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"}code+="o.height=o.y2-o.y;"}else{code+="o.y=o.y2-(o.height||0);"}}if(encode.yc){code+="o.y=o.yc-(o.height||0)/2;"}return code}function color$2(enc,scope,params,fields){function color(type,x,y,z){var a=entry$1(null,x,scope,params,fields),b=entry$1(null,y,scope,params,fields),c=entry$1(null,z,scope,params,fields);return"this."+type+"("+[a,b,c].join(",")+").toString()"}return enc.c?color("hcl",enc.h,enc.c,enc.l):enc.h||enc.s?color("hsl",enc.h,enc.s,enc.l):enc.l||enc.a?color("lab",enc.l,enc.a,enc.b):enc.r||enc.g||enc.b?color("rgb",enc.r,enc.g,enc.b):null}function expression$1(code,scope,params,fields){var expr=parseExpression$1(code,scope);expr.$fields.forEach(function(name){fields[name]=1});extend(params,expr.$params);return expr.$expr}function field$1(ref,scope,params,fields){return resolve$1(isObject(ref)?ref:{datum:ref},scope,params,fields)}function resolve$1(ref,scope,params,fields){var object,level,field;if(ref.signal){object="datum";field=expression$1(ref.signal,scope,params,fields)}else if(ref.group||ref.parent){level=Math.max(1,ref.level||1);object="item";while(level-- >0){object+=".mark.group"}if(ref.parent){field=ref.parent;object+=".datum"}else{field=ref.group}}else if(ref.datum){object="datum";field=ref.datum}else{error("Invalid field reference: "+$(ref))}if(!ref.signal){if(isString(field)){fields[field]=1;field=splitAccessPath(field).map($).join("][")}else{field=resolve$1(field,scope,params,fields)}}return object+"["+field+"]"}function scale$4(enc,value,scope,params,fields){var scale=getScale$1(enc.scale,scope,params,fields),interp,func,flag;if(enc.range!=null){interp=+enc.range;func=scale+".range()";value=interp===0?func+"[0]":"($="+func+","+(interp===1?"$[$.length-1]":"$[0]+"+interp+"*($[$.length-1]-$[0])")+")"}else{if(value!==undefined)value=scale+"("+value+")";if(enc.band&&(flag=hasBandwidth(enc.scale,scope))){func=scale+".bandwidth";interp=+enc.band;interp=func+"()"+(interp===1?"":"*"+interp);if(flag<0)interp="("+func+"?"+interp+":0)";value=(value?value+"+":"")+interp;if(enc.extra){value="(datum.extra?"+scale+"(datum.extra.value):"+value+")"}}if(value==null)value="0"}return value}function hasBandwidth(name,scope){if(!isString(name))return-1;var type=scope.scaleType(name);return type==="band"||type==="point"?1:0}function getScale$1(name,scope,params,fields){var scaleName;if(isString(name)){scaleName=ScalePrefix+name;if(!params.hasOwnProperty(scaleName)){params[scaleName]=scope.scaleRef(name)}scaleName=$(scaleName)}else{for(scaleName in scope.scales){params[ScalePrefix+scaleName]=scope.scaleRef(scaleName)}scaleName=$(ScalePrefix)+"+"+(name.signal?"("+expression$1(name.signal,scope,params,fields)+")":field$1(name,scope,params,fields))}return"_["+scaleName+"]"}function gradient$1(enc,scope,params,fields){return"this.gradient("+getScale$1(enc.gradient,scope,params,fields)+","+$(enc.start)+","+$(enc.stop)+","+$(enc.count)+")"}function property(property,scope,params,fields){return isObject(property)?"("+entry$1(null,property,scope,params,fields)+")":property}function entry$1(channel,enc,scope,params,fields){if(enc.gradient!=null){return gradient$1(enc,scope,params,fields)}var value=enc.signal?expression$1(enc.signal,scope,params,fields):enc.color?color$2(enc.color,scope,params,fields):enc.field!=null?field$1(enc.field,scope,params,fields):enc.value!==undefined?$(enc.value):undefined;if(enc.scale!=null){value=scale$4(enc,value,scope,params,fields)}if(value===undefined){value=null}if(enc.exponent!=null){value="Math.pow("+value+","+property(enc.exponent,scope,params,fields)+")"}if(enc.mult!=null){value+="*"+property(enc.mult,scope,params,fields)}if(enc.offset!=null){value+="+"+property(enc.offset,scope,params,fields)}if(enc.round){value="Math.round("+value+")"}return value}function set$3(obj,key,value){return obj+"["+$(key)+"]="+value+";"}function rule$1(channel,rules,scope,params,fields){var code="";rules.forEach(function(rule){var value=entry$1(channel,rule,scope,params,fields);code+=rule.test?expression$1(rule.test,scope,params,fields)+"?"+value+":":value});if(peek(code)===":"){code+="null"}return set$3("o",channel,code)}function parseEncode(encode,marktype,params,scope){var fields={},code="var o=item,datum=o.datum,$;",channel,enc,value;for(channel in encode){enc=encode[channel];if(isArray(enc)){code+=rule$1(channel,enc,scope,params,fields)}else{value=entry$1(channel,enc,scope,params,fields);code+=set$3("o",channel,value)}}code+=adjustSpatial(encode,marktype);code+="return 1;";return{$expr:code,$fields:Object.keys(fields),$output:Object.keys(encode)}}var MarkRole="mark";var FrameRole$1="frame";var ScopeRole$1="scope";var AxisRole$1="axis";var AxisDomainRole="axis-domain";var AxisGridRole="axis-grid";var AxisLabelRole="axis-label";var AxisTickRole="axis-tick";var AxisTitleRole="axis-title";var LegendRole$1="legend";var LegendBandRole="legend-band";var LegendEntryRole="legend-entry";var LegendGradientRole="legend-gradient";var LegendLabelRole="legend-label";var LegendSymbolRole="legend-symbol";var LegendTitleRole="legend-title";var TitleRole$1="title";function encoder(_){return isObject(_)?extend({},_):{value:_}}function addEncode(object,name,value,set){if(value!=null){if(isObject(value)&&!isArray(value)){object.update[name]=value}else{object[set||"enter"][name]={value:value}}return 1}else{return 0}}function addEncoders(object,enter,update){for(let name in enter){addEncode(object,name,enter[name])}for(let name in update){addEncode(object,name,update[name],"update")}}function extendEncode(encode,extra,skip){for(var name in extra){if(skip&&skip.hasOwnProperty(name))continue;encode[name]=extend(encode[name]||{},extra[name])}return encode}function encoders(encode,type,role,style,scope,params){var enc,key;params=params||{};params.encoders={$encode:enc={}};encode=applyDefaults(encode,type,role,style,scope.config);for(key in encode){enc[key]=parseEncode(encode[key],type,params,scope)}return params}function applyDefaults(encode,type,role,style,config){var enter={},key,skip,props;if(role=="legend"||String(role).indexOf("axis")===0){role=null}props=role===FrameRole$1?config.group:role===MarkRole?extend({},config.mark,config[type]):null;for(key in props){skip=has(key,encode)||(key==="fill"||key==="stroke")&&(has("fill",encode)||has("stroke",encode));if(!skip)enter[key]=defaultEncode(props[key])}array(style).forEach(function(name){var props=config.style&&config.style[name];for(var key in props){if(!has(key,encode)){enter[key]=defaultEncode(props[key])}}});encode=extend({},encode);encode.enter=extend(enter,encode.enter);return encode}function defaultEncode(value){return value&&value.signal?{signal:value.signal}:{value:value}}function has(key,encode){return encode&&(encode.enter&&encode.enter[key]||encode.update&&encode.update[key])}function guideMark(type,role,style,key,dataRef,encode,extras){return{type:type,name:extras?extras.name:undefined,role:role,style:extras&&extras.style||style,key:key,from:dataRef,interactive:!!(extras&&extras.interactive),encode:extendEncode(encode,extras,Skip$1)}}function lookup$5(spec,config){const _=name=>value(spec[name],config[name]);_.isVertical=(s=>Vertical===value(spec.direction,config.direction||(s?config.symbolDirection:config.gradientDirection)));_.gradientLength=(()=>value(spec.gradientLength,config.gradientLength||config.gradientWidth));_.gradientThickness=(()=>value(spec.gradientThickness,config.gradientThickness||config.gradientHeight));_.entryColumns=(()=>value(spec.columns,value(config.columns,+_.isVertical(true))));return _}function getEncoding(name,encode){var v=encode&&(encode.update&&encode.update[name]||encode.enter&&encode.enter[name]);return v&&v.signal?v:v?v.value:null}function getStyle(name,scope,style){var s=scope.config.style[style];return s&&s[name]}function anchorExpr(s,e,m){return`item.anchor === "${Start$1}" ? ${s} : item.anchor === "${End$1}" ? ${e} : ${m}`}const alignExpr=anchorExpr($(Left$1),$(Right$1),$(Center$1));var GroupMark="group";var RectMark="rect";var RuleMark="rule";var SymbolMark="symbol";var TextMark="text";function legendGradient(spec,scale,config,userEncode){var _=lookup$5(spec,config),vertical=_.isVertical(),thickness=_.gradientThickness(),length=_.gradientLength(),encode,enter,start,stop,width,height;if(vertical){start=[0,1];stop=[0,0];width=thickness;height=length}else{start=[0,0];stop=[1,0];width=length;height=thickness}encode={enter:enter={opacity:zero$2,x:zero$2,y:zero$2,width:encoder(width),height:encoder(height)},update:extend({},enter,{opacity:one$2,fill:{gradient:scale,start:start,stop:stop}}),exit:{opacity:zero$2}};addEncoders(encode,{stroke:_("gradientStrokeColor"),strokeWidth:_("gradientStrokeWidth")},{opacity:_("gradientOpacity")});return guideMark(RectMark,LegendGradientRole,null,undefined,undefined,encode,userEncode)}function legendGradientDiscrete(spec,scale,config,userEncode,dataRef){var _=lookup$5(spec,config),vertical=_.isVertical(),thickness=_.gradientThickness(),length=_.gradientLength(),encode,enter,u,v,uu,vv,adjust="";vertical?(u="y",uu="y2",v="x",vv="width",adjust="1-"):(u="x",uu="x2",v="y",vv="height");enter={opacity:zero$2,fill:{scale:scale,field:Value}};enter[u]={signal:adjust+"datum."+Perc,mult:length};enter[v]=zero$2;enter[uu]={signal:adjust+"datum."+Perc2,mult:length};enter[vv]=encoder(thickness);encode={enter:enter,update:extend({},enter,{opacity:one$2}),exit:{opacity:zero$2}};addEncoders(encode,{stroke:_("gradientStrokeColor"),strokeWidth:_("gradientStrokeWidth")},{opacity:_("gradientOpacity")});return guideMark(RectMark,LegendBandRole,null,Value,dataRef,encode,userEncode)}const alignExpr$1=`datum.${Perc}<=0?"${Left$1}":datum.${Perc}>=1?"${Right$1}":"${Center$1}"`,baselineExpr=`datum.${Perc}<=0?"${Bottom$1}":datum.${Perc}>=1?"${Top$1}":"${Middle$1}"`;function legendGradientLabels(spec,config,userEncode,dataRef){var _=lookup$5(spec,config),vertical=_.isVertical(),thickness=encoder(_.gradientThickness()),length=_.gradientLength(),overlap=_("labelOverlap"),separation=_("labelSeparation"),encode,enter,update,u,v,adjust="";encode={enter:enter={opacity:zero$2},update:update={opacity:one$2,text:{field:Label}},exit:{opacity:zero$2}};addEncoders(encode,{fill:_("labelColor"),fillOpacity:_("labelOpacity"),font:_("labelFont"),fontSize:_("labelFontSize"),fontStyle:_("labelFontStyle"),fontWeight:_("labelFontWeight"),limit:value(spec.labelLimit,config.gradientLabelLimit)});if(vertical){enter.align={value:"left"};enter.baseline=update.baseline={signal:baselineExpr};u="y";v="x";adjust="1-"}else{enter.align=update.align={signal:alignExpr$1};enter.baseline={value:"top"};u="x";v="y"}enter[u]=update[u]={signal:adjust+"datum."+Perc,mult:length};enter[v]=update[v]=thickness;thickness.offset=value(spec.labelOffset,config.gradientLabelOffset)||0;spec=guideMark(TextMark,LegendLabelRole,GuideLabelStyle,Value,dataRef,encode,userEncode);if(overlap){spec.overlap={separation:separation,method:overlap,order:"datum."+Index}}return spec}function guideGroup(role,style,name,dataRef,interactive,encode,marks,layout){return{type:GroupMark,name:name,role:role,style:style,from:dataRef,interactive:interactive||false,encode:encode,marks:marks,layout:layout}}function legendSymbolGroups(spec,config,userEncode,dataRef,columns){var _=lookup$5(spec,config),entries=userEncode.entries,interactive=!!(entries&&entries.interactive),name=entries?entries.name:undefined,height=_("clipHeight"),symbolOffset=_("symbolOffset"),valueRef={data:"value"},encode={},xSignal=`${columns} ? datum.${Offset} : datum.${Size}`,yEncode=height?encoder(height):{field:Size},index=`datum.${Index}`,ncols=`max(1, ${columns})`,enter,update,labelOffset,symbols,labels,nrows,sort;yEncode.mult=.5;encode={enter:enter={opacity:zero$2,x:{signal:xSignal,mult:.5,offset:symbolOffset},y:yEncode},update:update={opacity:one$2,x:enter.x,y:enter.y},exit:{opacity:zero$2}};if(!spec.fill){addEncoders(encode,{fill:config.symbolBaseFillColor,stroke:config.symbolBaseStrokeColor})}addEncoders(encode,{fill:_("symbolFillColor"),shape:_("symbolType"),size:_("symbolSize"),stroke:_("symbolStrokeColor"),strokeDash:_("symbolDash"),strokeDashOffset:_("symbolDashOffset"),strokeWidth:_("symbolStrokeWidth")},{opacity:_("symbolOpacity")});LegendScales.forEach(function(scale){if(spec[scale]){update[scale]=enter[scale]={scale:spec[scale],field:Value}}});symbols=guideMark(SymbolMark,LegendSymbolRole,null,Value,valueRef,encode,userEncode.symbols);if(height)symbols.clip=true;labelOffset=encoder(symbolOffset);labelOffset.offset=_("labelOffset");encode={enter:enter={opacity:zero$2,x:{signal:xSignal,offset:labelOffset},y:yEncode},update:update={opacity:one$2,text:{field:Label},x:enter.x,y:enter.y},exit:{opacity:zero$2}};addEncoders(encode,{align:_("labelAlign"),baseline:_("labelBaseline"),fill:_("labelColor"),fillOpacity:_("labelOpacity"),font:_("labelFont"),fontSize:_("labelFontSize"),fontStyle:_("labelFontStyle"),fontWeight:_("labelFontWeight"),limit:_("labelLimit")});labels=guideMark(TextMark,LegendLabelRole,GuideLabelStyle,Value,valueRef,encode,userEncode.labels);encode={enter:{noBound:{value:!height},width:zero$2,height:height?encoder(height):zero$2,opacity:zero$2},exit:{opacity:zero$2},update:update={opacity:one$2,row:{signal:null},column:{signal:null}}};if(_.isVertical(true)){nrows=`ceil(item.mark.items.length / ${ncols})`;update.row.signal=`${index}%${nrows}`;update.column.signal=`floor(${index} / ${nrows})`;sort={field:["row",index]}}else{update.row.signal=`floor(${index} / ${ncols})`;update.column.signal=`${index} % ${ncols}`;sort={field:index}}update.column.signal=`${columns}?${update.column.signal}:${index}`;dataRef={facet:{data:dataRef,name:"value",groupby:Index}};spec=guideGroup(ScopeRole$1,null,name,dataRef,interactive,extendEncode(encode,entries,Skip$1),[symbols,labels]);spec.sort=sort;return spec}function legendSymbolLayout(spec,config){const _=lookup$5(spec,config);return{align:_("gridAlign"),columns:_.entryColumns(),center:{row:true,column:false},padding:{row:_("rowPadding"),column:_("columnPadding")}}}const isL='item.orient === "left"',isR='item.orient === "right"',isLR=`(${isL} || ${isR})`,isVG=`datum.vgrad && ${isLR}`,baseline=anchorExpr('"top"','"bottom"','"middle"'),alignFlip=anchorExpr('"right"','"left"','"center"'),exprAlign=`datum.vgrad && ${isR} ? (${alignFlip}) : (${isLR} && !(datum.vgrad && ${isL})) ? "left" : ${alignExpr}`,exprAnchor=`item._anchor || (${isLR} ? "middle" : "start")`,exprAngle=`${isVG} ? (${isL} ? -90 : 90) : 0`,exprBaseline=`${isLR} ? (datum.vgrad ? (${isR} ? "bottom" : "top") : ${baseline}) : "top"`;function legendTitle(spec,config,userEncode,dataRef){var _=lookup$5(spec,config),encode;encode={enter:{opacity:zero$2},update:{opacity:one$2,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:zero$2}};addEncoders(encode,{orient:_("titleOrient"),_anchor:_("titleAnchor"),anchor:{signal:exprAnchor},angle:{signal:exprAngle},align:{signal:exprAlign},baseline:{signal:exprBaseline},text:spec.title,fill:_("titleColor"),fillOpacity:_("titleOpacity"),font:_("titleFont"),fontSize:_("titleFontSize"),fontStyle:_("titleFontStyle"),fontWeight:_("titleFontWeight"),limit:_("titleLimit")},{align:_("titleAlign"),baseline:_("titleBaseline")});return guideMark(TextMark,LegendTitleRole,GuideTitleStyle,null,dataRef,encode,userEncode)}function clip$3(clip,scope){var expr;if(isObject(clip)){if(clip.signal){expr=clip.signal}else if(clip.path){expr="pathShape("+param(clip.path)+")"}else if(clip.sphere){expr="geoShape("+param(clip.sphere)+', {type: "Sphere"})'}}return expr?scope.signalRef(expr):!!clip}function param(value){return isObject(value)&&value.signal?value.signal:$(value)}function getRole(spec){var role=spec.role||"";return!role.indexOf("axis")||!role.indexOf("legend")?role:spec.type===GroupMark?ScopeRole$1:role||MarkRole}function definition$1(spec){return{marktype:spec.type,name:spec.name||undefined,role:spec.role||getRole(spec),zindex:+spec.zindex||undefined}}function interactive(spec,scope){return spec&&spec.signal?scope.signalRef(spec.signal):spec===false?false:true}function parseTransform(spec,scope){var def=definition(spec.type);if(!def)error("Unrecognized transform type: "+$(spec.type));var t=entry(def.type.toLowerCase(),null,parseParameters$1(def,spec,scope));if(spec.signal)scope.addSignal(spec.signal,scope.proxy(t));t.metadata=def.metadata||{};return t}function parseParameters$1(def,spec,scope){var params={},pdef,i,n;for(i=0,n=def.params.length;i<n;++i){pdef=def.params[i];params[pdef.name]=parseParameter$2(pdef,spec,scope)}return params}function parseParameter$2(def,spec,scope){var type=def.type,value=spec[def.name];if(type==="index"){return parseIndexParameter(def,spec,scope)}else if(value===undefined){if(def.required){error("Missing required "+$(spec.type)+" parameter: "+$(def.name))}return}else if(type==="param"){return parseSubParameters(def,spec,scope)}else if(type==="projection"){return scope.projectionRef(spec[def.name])}return def.array&&!isSignal(value)?value.map(function(v){return parameterValue(def,v,scope)}):parameterValue(def,value,scope)}function parameterValue(def,value,scope){var type=def.type;if(isSignal(value)){return isExpr(type)?error("Expression references can not be signals."):isField(type)?scope.fieldRef(value):isCompare(type)?scope.compareRef(value):scope.signalRef(value.signal)}else{var expr=def.expr||isField(type);return expr&&outerExpr(value)?scope.exprRef(value.expr,value.as):expr&&outerField(value)?fieldRef(value.field,value.as):isExpr(type)?parseExpression$1(value,scope):isData(type)?ref(scope.getData(value).values):isField(type)?fieldRef(value):isCompare(type)?scope.compareRef(value):value}}function parseIndexParameter(def,spec,scope){if(!isString(spec.from)){error('Lookup "from" parameter must be a string literal.')}return scope.getData(spec.from).lookupRef(scope,spec.key)}function parseSubParameters(def,spec,scope){var value=spec[def.name];if(def.array){if(!isArray(value)){error("Expected an array of sub-parameters. Instead: "+$(value))}return value.map(function(v){return parseSubParameter(def,v,scope)})}else{return parseSubParameter(def,value,scope)}}function parseSubParameter(def,value,scope){var params,pdef,k,i,n;for(i=0,n=def.params.length;i<n;++i){pdef=def.params[i];for(k in pdef.key){if(pdef.key[k]!==value[k]){pdef=null;break}}if(pdef)break}if(!pdef)error("Unsupported parameter: "+$(value));params=extend(parseParameters$1(pdef,value,scope),pdef.key);return ref(scope.add(Params$2(params)))}function outerExpr(_){return _&&_.expr}function outerField(_){return _&&_.field}function isData(_){return _==="data"}function isExpr(_){return _==="expr"}function isField(_){return _==="field"}function isCompare(_){return _==="compare"}function parseData(from,group,scope){var facet,key,op,dataRef,parent;if(!from){dataRef=ref(scope.add(Collect$1(null,[{}])))}else if(facet=from.facet){if(!group)error("Only group marks can be faceted.");if(facet.field!=null){dataRef=parent=getDataRef(facet,scope)}else{if(!from.data){op=parseTransform(extend({type:"aggregate",groupby:array(facet.groupby)},facet.aggregate),scope);op.params.key=scope.keyRef(facet.groupby);op.params.pulse=getDataRef(facet,scope);dataRef=parent=ref(scope.add(op))}else{parent=ref(scope.getData(from.data).aggregate)}key=scope.keyRef(facet.groupby,true)}}if(!dataRef){dataRef=getDataRef(from,scope)}return{key:key,pulse:dataRef,parent:parent}}function getDataRef(from,scope){return from.$ref?from:from.data&&from.data.$ref?from.data:ref(scope.getData(from.data).output)}function DataScope(scope,input,output,values,aggr){this.scope=scope;this.input=input;this.output=output;this.values=values;this.aggregate=aggr;this.index={}}DataScope.fromEntries=function(scope,entries){var n=entries.length,i=1,input=entries[0],values=entries[n-1],output=entries[n-2],aggr=null;if(input&&input.type==="load"){input=entries[1]}scope.add(entries[0]);for(;i<n;++i){entries[i].params.pulse=ref(entries[i-1]);scope.add(entries[i]);if(entries[i].type==="aggregate")aggr=entries[i]}return new DataScope(scope,input,output,values,aggr)};var prototype$1k=DataScope.prototype;prototype$1k.countsRef=function(scope,field,sort){var ds=this,cache=ds.counts||(ds.counts={}),k=fieldKey(field),v,a,p;if(k!=null){scope=ds.scope;v=cache[k]}if(!v){p={groupby:scope.fieldRef(field,"key"),pulse:ref(ds.output)};if(sort&&sort.field)addSortField(scope,p,sort);a=scope.add(Aggregate$1(p));v=scope.add(Collect$1({pulse:ref(a)}));v={agg:a,ref:ref(v)};if(k!=null)cache[k]=v}else if(sort&&sort.field){addSortField(scope,v.agg.params,sort)}return v.ref};function fieldKey(field){return isString(field)?field:null}function addSortField(scope,p,sort){var as=aggrField(sort.op,sort.field),s;if(p.ops){for(var i=0,n=p.as.length;i<n;++i){if(p.as[i]===as)return}}else{p.ops=["count"];p.fields=[null];p.as=["count"]}if(sort.op){p.ops.push((s=sort.op.signal)?scope.signalRef(s):sort.op);p.fields.push(scope.fieldRef(sort.field));p.as.push(as)}}function cache(scope,ds,name,optype,field,counts,index){var cache=ds[name]||(ds[name]={}),sort=sortKey(counts),k=fieldKey(field),v,op;if(k!=null){scope=ds.scope;k=k+(sort?"|"+sort:"");v=cache[k]}if(!v){var params=counts?{field:keyFieldRef,pulse:ds.countsRef(scope,field,counts)}:{field:scope.fieldRef(field),pulse:ref(ds.output)};if(sort)params.sort=scope.sortRef(counts);op=scope.add(entry(optype,undefined,params));if(index)ds.index[field]=op;v=ref(op);if(k!=null)cache[k]=v}return v}prototype$1k.tuplesRef=function(){return ref(this.values)};prototype$1k.extentRef=function(scope,field){return cache(scope,this,"extent","extent",field,false)};prototype$1k.domainRef=function(scope,field){return cache(scope,this,"domain","values",field,false)};prototype$1k.valuesRef=function(scope,field,sort){return cache(scope,this,"vals","values",field,sort||true)};prototype$1k.lookupRef=function(scope,field){return cache(scope,this,"lookup","tupleindex",field,false)};prototype$1k.indataRef=function(scope,field){return cache(scope,this,"indata","tupleindex",field,true,true)};function parseFacet(spec,scope,group){var facet=spec.from.facet,name=facet.name,data=getDataRef(facet,scope),subscope,source,values,op;if(!facet.name){error("Facet must have a name: "+$(facet))}if(!facet.data){error("Facet must reference a data set: "+$(facet))}if(facet.field){op=scope.add(PreFacet$1({field:scope.fieldRef(facet.field),pulse:data}))}else if(facet.groupby){op=scope.add(Facet$1({key:scope.keyRef(facet.groupby),group:ref(scope.proxy(group.parent)),pulse:data}))}else{error("Facet must specify groupby or field: "+$(facet))}subscope=scope.fork();source=subscope.add(Collect$1());values=subscope.add(Sieve$1({pulse:ref(source)}));subscope.addData(name,new DataScope(subscope,source,source,values));subscope.addSignal("parent",null);op.params.subflow={$subflow:parseSpec(spec,subscope).toRuntime()}}function parseSubflow(spec,scope,input){var op=scope.add(PreFacet$1({pulse:input.pulse})),subscope=scope.fork();subscope.add(Sieve$1());subscope.addSignal("parent",null);op.params.subflow={$subflow:parseSpec(spec,subscope).toRuntime()}}function parseTrigger(spec,scope,name){var remove=spec.remove,insert=spec.insert,toggle=spec.toggle,modify=spec.modify,values=spec.values,op=scope.add(operator()),update,expr;update="if("+spec.trigger+',modify("'+name+'",'+[insert,remove,toggle,modify,values].map(function(_){return _==null?"null":_}).join(",")+"),0)";expr=parseExpression$1(update,scope);op.update=expr.$expr;op.params=expr.$params}function parseMark(spec,scope){var role=getRole(spec),group=spec.type===GroupMark,facet=spec.from&&spec.from.facet,layout=spec.layout||role===ScopeRole$1||role===FrameRole$1,nested=role===MarkRole||layout||facet,overlap=spec.overlap,ops,op,input,store,bound,render,sieve,name,joinRef,markRef,encodeRef,layoutRef,boundRef;input=parseData(spec.from,group,scope);op=scope.add(DataJoin$1({key:input.key||(spec.key?fieldRef(spec.key):undefined),pulse:input.pulse,clean:!group}));joinRef=ref(op);op=store=scope.add(Collect$1({pulse:joinRef}));op=scope.add(Mark$1({markdef:definition$1(spec),interactive:interactive(spec.interactive,scope),clip:clip$3(spec.clip,scope),context:{$context:true},groups:scope.lookup(),parent:scope.signals.parent?scope.signalRef("parent"):null,index:scope.markpath(),pulse:ref(op)}));markRef=ref(op);op=scope.add(Encode$1(encoders(spec.encode,spec.type,role,spec.style,scope,{pulse:markRef})));op.params.parent=scope.encode();if(spec.transform){spec.transform.forEach(function(_){var tx=parseTransform(_,scope);if(tx.metadata.generates||tx.metadata.changes){error("Mark transforms should not generate new data.")}tx.params.pulse=ref(op);scope.add(op=tx)})}if(spec.sort){op=scope.add(SortItems$1({sort:scope.compareRef(spec.sort,true),pulse:ref(op)}))}encodeRef=ref(op);if(facet||layout){layout=scope.add(ViewLayout$1({layout:scope.objectProperty(spec.layout),legends:scope.legends,mark:markRef,pulse:encodeRef}));layoutRef=ref(layout)}bound=scope.add(Bound$1({mark:markRef,pulse:layoutRef||encodeRef}));boundRef=ref(bound);if(group){if(nested){ops=scope.operators;ops.pop();if(layout)ops.pop()}scope.pushState(encodeRef,layoutRef||boundRef,joinRef);facet?parseFacet(spec,scope,input):nested?parseSubflow(spec,scope,input):parseSpec(spec,scope);scope.popState();if(nested){if(layout)ops.push(layout);ops.push(bound)}}if(overlap){boundRef=parseOverlap(overlap,boundRef,scope)}render=scope.add(Render$1({pulse:boundRef}));sieve=scope.add(Sieve$1({pulse:ref(render)},undefined,scope.parent()));if(spec.name!=null){name=spec.name;scope.addData(name,new DataScope(scope,store,render,sieve));if(spec.on)spec.on.forEach(function(on){if(on.insert||on.remove||on.toggle){error("Marks only support modify triggers.")}parseTrigger(on,scope,name)})}}function parseOverlap(overlap,source,scope){var method=overlap.method,bound=overlap.bound,sep=overlap.separation,tol;var params={separation:isSignal(sep)?scope.signalRef(sep.signal):sep,method:isSignal(method)?scope.signalRef(method.signal):method,pulse:source};if(overlap.order){params.sort=scope.compareRef({field:overlap.order})}if(bound){tol=bound.tolerance;params.boundTolerance=isSignal(tol)?scope.signalRef(tol.signal):+tol;params.boundScale=scope.scaleRef(bound.scale);params.boundOrient=bound.orient}return ref(scope.add(Overlap$1(params)))}function parseLegend(spec,scope){var config=scope.config.legend,encode=spec.encode||{},legendEncode=encode.legend||{},name=legendEncode.name||undefined,interactive=legendEncode.interactive,style=legendEncode.style,_=lookup$5(spec,config),entryEncode,entryLayout,params,children,type,datum,dataRef,entryRef,group;var scale=LegendScales.reduce(function(a,b){return a||spec[b]},0);if(!scale)error("Missing valid scale for legend.");type=legendType(spec,scope.scaleType(scale));datum={title:spec.title!=null,type:type,vgrad:type!=="symbol"&&_.isVertical()};dataRef=ref(scope.add(Collect$1(null,[datum])));legendEncode=extendEncode(buildLegendEncode(_,config),legendEncode,Skip$1);entryEncode={enter:{x:{value:0},y:{value:0}}};entryRef=ref(scope.add(LegendEntries$1(params={type:type,scale:scope.scaleRef(scale),count:scope.objectProperty(spec.tickCount),values:scope.objectProperty(spec.values),minstep:scope.property(spec.tickMinStep),formatType:scope.property(spec.formatType),formatSpecifier:scope.property(spec.format)})));if(type===Gradient$2){children=[legendGradient(spec,scale,config,encode.gradient),legendGradientLabels(spec,config,encode.labels,entryRef)];params.count=params.count||scope.signalRef(`max(2,2*floor((${deref(_.gradientLength())})/100))`)}else if(type===Discrete$1){children=[legendGradientDiscrete(spec,scale,config,encode.gradient,entryRef),legendGradientLabels(spec,config,encode.labels,entryRef)]}else{entryLayout=legendSymbolLayout(spec,config);children=[legendSymbolGroups(spec,config,encode,entryRef,deref(entryLayout.columns))];params.size=sizeExpression(spec,scope,children[0].marks)}children=[guideGroup(LegendEntryRole,null,null,dataRef,interactive,entryEncode,children,entryLayout)];if(datum.title){children.push(legendTitle(spec,config,encode.title,dataRef))}group=guideGroup(LegendRole$1,style,name,dataRef,interactive,legendEncode,children);if(spec.zindex)group.zindex=spec.zindex;return parseMark(group,scope)}function legendType(spec,scaleType){var type=spec.type||Symbols$2;if(!spec.type&&scaleCount(spec)===1&&(spec.fill||spec.stroke)){type=isContinuous(scaleType)?Gradient$2:isDiscretizing(scaleType)?Discrete$1:Symbols$2}return type!==Gradient$2?type:isDiscretizing(scaleType)?Discrete$1:Gradient$2}function scaleCount(spec){return LegendScales.reduce(function(count,type){return count+(spec[type]?1:0)},0)}function buildLegendEncode(_,config){var encode={enter:{},update:{}};addEncoders(encode,{orient:_("orient"),offset:_("offset"),padding:_("padding"),titlePadding:_("titlePadding"),cornerRadius:_("cornerRadius"),fill:_("fillColor"),stroke:_("strokeColor"),strokeWidth:config.strokeWidth,strokeDash:config.strokeDash});return encode}function sizeExpression(spec,scope,marks){var size=deref(getChannel("size",spec,marks)),strokeWidth=deref(getChannel("strokeWidth",spec,marks)),fontSize=deref(getFontSize(marks[1].encode,scope,GuideLabelStyle));return parseExpression$1(`max(ceil(sqrt(${size})+${strokeWidth}),${fontSize})`,scope)}function getChannel(name,spec,marks){return spec[name]?`scale("${spec[name]}",datum)`:getEncoding(name,marks[0].encode)}function getFontSize(encode,scope,style){return getEncoding("fontSize",encode)||getStyle("fontSize",scope,style)}const angleExpr=`item.orient==="${Left$1}"?-90:item.orient==="${Right$1}"?90:0`,baselineExpr$1=`item.orient==="${Bottom$1}"?"${Top$1}":"${Bottom$1}"`;function parseTitle(spec,scope){spec=isString(spec)?{text:spec}:spec;var config=scope.config.title,encode=extend({},spec.encode),dataRef,title;dataRef=ref(scope.add(Collect$1(null,[{}])));encode.name=spec.name;encode.interactive=spec.interactive;title=buildTitle(spec,config,encode,dataRef);if(spec.zindex)title.zindex=spec.zindex;return parseMark(title,scope)}function buildTitle(spec,config,userEncode,dataRef){var _=lookup$5(spec,config),zero={value:0},title=spec.text,encode;encode={enter:{opacity:zero},update:{opacity:{value:1}},exit:{opacity:zero}};addEncoders(encode,{text:title,orient:_("orient"),anchor:_("anchor"),align:{signal:alignExpr},angle:{signal:angleExpr},baseline:{signal:baselineExpr$1},dx:_("dx"),dy:_("dy"),fill:_("color"),font:_("font"),fontSize:_("fontSize"),fontStyle:_("fontStyle"),fontWeight:_("fontWeight"),frame:_("frame"),limit:_("limit"),offset:_("offset")||0},{align:_("align"),angle:_("angle"),baseline:_("baseline")});return guideMark(TextMark,TitleRole$1,spec.style||GroupTitleStyle,null,dataRef,encode,userEncode)}function parseData$1(data,scope){var transforms=[];if(data.transform){data.transform.forEach(function(tx){transforms.push(parseTransform(tx,scope))})}if(data.on){data.on.forEach(function(on){parseTrigger(on,scope,data.name)})}scope.addDataPipeline(data.name,analyze(data,scope,transforms))}function analyze(data,scope,ops){var output=[],source=null,modify=false,generate=false,upstream,i,n,t,m;if(data.values){if(hasSignal(data.values)||hasSignal(data.format)){output.push(load$1(scope,data));output.push(source=collect())}else{output.push(source=collect({$ingest:data.values,$format:data.format}))}}else if(data.url){if(hasSignal(data.url)||hasSignal(data.format)){output.push(load$1(scope,data));output.push(source=collect())}else{output.push(source=collect({$request:data.url,$format:data.format}))}}else if(data.source){source=upstream=array(data.source).map(function(d){return ref(scope.getData(d).output)});output.push(null)}for(i=0,n=ops.length;i<n;++i){t=ops[i];m=t.metadata;if(!source&&!m.source){output.push(source=collect())}output.push(t);if(m.generates)generate=true;if(m.modifies&&!generate)modify=true;if(m.source)source=t;else if(m.changes)source=null}if(upstream){n=upstream.length-1;output[0]=Relay$1({derive:modify,pulse:n?upstream:upstream[0]});if(modify||n){output.splice(1,0,collect())}}if(!source)output.push(collect());output.push(Sieve$1({}));return output}function collect(values){var s=Collect$1({},values);s.metadata={source:true};return s}function load$1(scope,data){return Load$1({url:data.url?scope.property(data.url):undefined,values:data.values?scope.property(data.values):undefined,format:scope.objectProperty(data.format)})}function axisConfig(spec,scope){var config=scope.config,orient=spec.orient,xy=orient===Top$1||orient===Bottom$1?config.axisX:config.axisY,or=config["axis"+orient[0].toUpperCase()+orient.slice(1)],band=scope.scaleType(spec.scale)==="band"&&config.axisBand;return xy||or||band?extend({},config.axis,xy,or,band):config.axis}function axisDomain(spec,config,userEncode,dataRef){var _=lookup$5(spec,config),orient=spec.orient,encode,enter,update,u,u2,v;encode={enter:enter={opacity:zero$2},update:update={opacity:one$2},exit:{opacity:zero$2}};addEncoders(encode,{stroke:_("domainColor"),strokeDash:_("domainDash"),strokeDashOffset:_("domainDashOffset"),strokeWidth:_("domainWidth"),strokeOpacity:_("domainOpacity")});if(orient===Top$1||orient===Bottom$1){u="x";v="y"}else{u="y";v="x"}u2=u+"2";enter[v]=zero$2;update[u]=enter[u]=position(spec,0);update[u2]=enter[u2]=position(spec,1);return guideMark(RuleMark,AxisDomainRole,null,null,dataRef,encode,userEncode)}function position(spec,pos){return{scale:spec.scale,range:pos}}function axisGrid(spec,config,userEncode,dataRef){var _=lookup$5(spec,config),orient=spec.orient,vscale=spec.gridScale,sign=orient===Left$1||orient===Top$1?1:-1,offset=offsetValue$1(spec.offset,sign),encode,enter,exit,update,tickPos,u,v,v2,s;encode={enter:enter={opacity:zero$2},update:update={opacity:one$2},exit:exit={opacity:zero$2}};addEncoders(encode,{stroke:_("gridColor"),strokeDash:_("gridDash"),strokeDashOffset:_("gridDashOffset"),strokeOpacity:_("gridOpacity"),strokeWidth:_("gridWidth")});tickPos={scale:spec.scale,field:Value,band:_("bandPosition"),round:_("tickRound"),extra:_("tickExtra"),offset:_("tickOffset")};if(orient===Top$1||orient===Bottom$1){u="x";v="y";s="height"}else{u="y";v="x";s="width"}v2=v+"2";update[u]=enter[u]=exit[u]=tickPos;if(vscale){update[v]=enter[v]={scale:vscale,range:0,mult:sign,offset:offset};update[v2]=enter[v2]={scale:vscale,range:1,mult:sign,offset:offset}}else{update[v]=enter[v]={value:0,offset:offset};update[v2]=enter[v2]={signal:s,mult:sign,offset:offset}}return guideMark(RuleMark,AxisGridRole,null,Value,dataRef,encode,userEncode)}function offsetValue$1(offset,sign){if(sign===1);else if(!isObject(offset)){offset=sign*(offset||0)}else{var entry=offset=extend({},offset);while(entry.mult!=null){if(!isObject(entry.mult)){entry.mult*=sign;return offset}else{entry=entry.mult=extend({},entry.mult)}}entry.mult=sign}return offset}function axisTicks(spec,config,userEncode,dataRef,size){var _=lookup$5(spec,config),orient=spec.orient,sign=orient===Left$1||orient===Top$1?-1:1,encode,enter,exit,update,tickSize,tickPos;encode={enter:enter={opacity:zero$2},update:update={opacity:one$2},exit:exit={opacity:zero$2}};addEncoders(encode,{stroke:_("tickColor"),strokeDash:_("tickDash"),strokeDashOffset:_("tickDashOffset"),strokeOpacity:_("tickOpacity"),strokeWidth:_("tickWidth")});tickSize=encoder(size);tickSize.mult=sign;tickPos={scale:spec.scale,field:Value,band:_("bandPosition"),round:_("tickRound"),extra:_("tickExtra"),offset:_("tickOffset")};if(orient===Top$1||orient===Bottom$1){update.y=enter.y=zero$2;update.y2=enter.y2=tickSize;update.x=enter.x=exit.x=tickPos}else{update.x=enter.x=zero$2;update.x2=enter.x2=tickSize;update.y=enter.y=exit.y=tickPos}return guideMark(RuleMark,AxisTickRole,null,Value,dataRef,encode,userEncode)}function flushExpr(scale,threshold,a,b,c){return{signal:'flush(range("'+scale+'"), '+'scale("'+scale+'", datum.value), '+threshold+","+a+","+b+","+c+")"}}function axisLabels(spec,config,userEncode,dataRef,size){var _=lookup$5(spec,config),orient=spec.orient,sign=orient===Left$1||orient===Top$1?-1:1,isXAxis=orient===Top$1||orient===Bottom$1,scale=spec.scale,flush=deref(_("labelFlush")),flushOffset=deref(_("labelFlushOffset")),flushOn=flush===0||!!flush,labelAlign=_("labelAlign"),labelBaseline=_("labelBaseline"),encode,enter,tickSize,tickPos,align,baseline,offset,bound,overlap,separation;tickSize=encoder(size);tickSize.mult=sign;tickSize.offset=encoder(_("labelPadding")||0);tickSize.offset.mult=sign;tickPos={scale:scale,field:Value,band:.5,offset:_("tickOffset")};if(isXAxis){align=labelAlign||(flushOn?flushExpr(scale,flush,'"left"','"right"','"center"'):"center");baseline=labelBaseline||(orient===Top$1?"bottom":"top");offset=!labelAlign}else{align=labelAlign||(orient===Right$1?"left":"right");baseline=labelBaseline||(flushOn?flushExpr(scale,flush,'"top"','"bottom"','"middle"'):"middle");offset=!labelBaseline}offset=offset&&flushOn&&flushOffset?flushExpr(scale,flush,"-"+flushOffset,flushOffset,0):null;encode={enter:enter={opacity:zero$2,x:isXAxis?tickPos:tickSize,y:isXAxis?tickSize:tickPos},update:{opacity:one$2,text:{field:Label},x:enter.x,y:enter.y},exit:{opacity:zero$2,x:enter.x,y:enter.y}};addEncoders(encode,{[isXAxis?"dx":"dy"]:offset,align:align,baseline:baseline,angle:_("labelAngle"),fill:_("labelColor"),fillOpacity:_("labelOpacity"),font:_("labelFont"),fontSize:_("labelFontSize"),fontWeight:_("labelFontWeight"),fontStyle:_("labelFontStyle"),limit:_("labelLimit")});bound=_("labelBound");overlap=_("labelOverlap");separation=_("labelSeparation");spec=guideMark(TextMark,AxisLabelRole,GuideLabelStyle,Value,dataRef,encode,userEncode);if(overlap||bound){spec.overlap={separation:separation,method:overlap,order:"datum.index",bound:bound?{scale:scale,orient:orient,tolerance:bound}:null}}return spec}function axisTitle(spec,config,userEncode,dataRef){var _=lookup$5(spec,config),orient=spec.orient,sign=orient===Left$1||orient===Top$1?-1:1,horizontal=orient===Top$1||orient===Bottom$1,encode,enter,update,titlePos;encode={enter:enter={opacity:zero$2,anchor:encoder(_("titleAnchor")),align:{signal:alignExpr}},update:update=extend({},enter,{opacity:one$2,text:encoder(spec.title)}),exit:{opacity:zero$2}};titlePos={signal:`lerp(range("${spec.scale}"), ${anchorExpr(0,1,.5)})`};if(horizontal){update.x=titlePos;enter.angle={value:0};enter.baseline={value:orient===Top$1?"bottom":"top"}}else{update.y=titlePos;enter.angle={value:sign*90};enter.baseline={value:"bottom"}}addEncoders(encode,{angle:_("titleAngle"),baseline:_("titleBaseline"),fill:_("titleColor"),fillOpacity:_("titleOpacity"),font:_("titleFont"),fontSize:_("titleFontSize"),fontStyle:_("titleFontStyle"),fontWeight:_("titleFontWeight"),limit:_("titleLimit")},{align:_("titleAlign")});!addEncode(encode,"x",_("titleX"),"update")&&!horizontal&&!has("x",userEncode)&&(encode.enter.auto={value:true});!addEncode(encode,"y",_("titleY"),"update")&&horizontal&&!has("y",userEncode)&&(encode.enter.auto={value:true});return guideMark(TextMark,AxisTitleRole,GuideTitleStyle,null,dataRef,encode,userEncode)}function parseAxis(spec,scope){var config=axisConfig(spec,scope),encode=spec.encode||{},axisEncode=encode.axis||{},name=axisEncode.name||undefined,interactive=axisEncode.interactive,style=axisEncode.style,_=lookup$5(spec,config),datum,dataRef,ticksRef,size,group,children;datum={orient:spec.orient,ticks:!!_("ticks"),labels:!!_("labels"),grid:!!_("grid"),domain:!!_("domain"),title:spec.title!=null};dataRef=ref(scope.add(Collect$1({},[datum])));axisEncode=extendEncode({update:{offset:encoder(_("offset")||0),position:encoder(value(spec.position,0)),titlePadding:encoder(_("titlePadding")),minExtent:encoder(_("minExtent")),maxExtent:encoder(_("maxExtent")),range:{signal:`abs(span(range("${spec.scale}")))`}}},encode.axis,Skip$1);ticksRef=ref(scope.add(AxisTicks$1({scale:scope.scaleRef(spec.scale),extra:scope.property(_("tickExtra")),count:scope.objectProperty(spec.tickCount),values:scope.objectProperty(spec.values),minstep:scope.property(spec.tickMinStep),formatType:scope.property(spec.formatType),formatSpecifier:scope.property(spec.format)})));children=[];if(datum.grid){children.push(axisGrid(spec,config,encode.grid,ticksRef))}if(datum.ticks){size=_("tickSize");children.push(axisTicks(spec,config,encode.ticks,ticksRef,size))}if(datum.labels){size=datum.ticks?size:0;children.push(axisLabels(spec,config,encode.labels,ticksRef,size))}if(datum.domain){children.push(axisDomain(spec,config,encode.domain,dataRef))}if(datum.title){children.push(axisTitle(spec,config,encode.title,dataRef))}group=guideGroup(AxisRole$1,style,name,dataRef,interactive,axisEncode,children);if(spec.zindex)group.zindex=spec.zindex;return parseMark(group,scope)}function parseSpec(spec,scope,preprocessed){var signals=array(spec.signals),scales=array(spec.scales);if(!preprocessed)signals.forEach(function(_){parseSignal(_,scope)});array(spec.projections).forEach(function(_){parseProjection(_,scope)});scales.forEach(function(_){initScale(_,scope)});array(spec.data).forEach(function(_){parseData$1(_,scope)});scales.forEach(function(_){parseScale(_,scope)});signals.forEach(function(_){parseSignalUpdates(_,scope)});array(spec.axes).forEach(function(_){parseAxis(_,scope)});array(spec.marks).forEach(function(_){parseMark(_,scope)});array(spec.legends).forEach(function(_){parseLegend(_,scope)});if(spec.title){parseTitle(spec.title,scope)}scope.parseLambdas();return scope}var defined=toSet(["width","height","padding","autosize"]);function parseView(spec,scope){var config=scope.config,op,input,encode,parent,root;scope.background=spec.background||config.background;scope.eventConfig=config.events;root=ref(scope.root=scope.add(operator()));scope.addSignal("width",spec.width||0);scope.addSignal("height",spec.height||0);scope.addSignal("padding",parsePadding(spec.padding,config));scope.addSignal("autosize",parseAutosize(spec.autosize,config));scope.legends=scope.objectProperty(config.legend&&config.legend.layout);array(spec.signals).forEach(function(_){if(!defined[_.name])parseSignal(_,scope)});input=scope.add(Collect$1());encode=extendEncode({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},spec.encode);encode=scope.add(Encode$1(encoders(encode,GroupMark,FrameRole$1,spec.style,scope,{pulse:ref(input)})));parent=scope.add(ViewLayout$1({layout:scope.objectProperty(spec.layout),legends:scope.legends,autosize:scope.signalRef("autosize"),mark:root,pulse:ref(encode)}));scope.operators.pop();scope.pushState(ref(encode),ref(parent),null);parseSpec(spec,scope,true);scope.operators.push(parent);op=scope.add(Bound$1({mark:root,pulse:ref(parent)}));op=scope.add(Render$1({pulse:ref(op)}));op=scope.add(Sieve$1({pulse:ref(op)}));scope.addData("root",new DataScope(scope,input,input,op));return scope}function Scope$1(config){this.config=config;this.bindings=[];this.field={};this.signals={};this.lambdas={};this.scales={};this.events={};this.data={};this.streams=[];this.updates=[];this.operators=[];this.background=null;this.eventConfig=null;this._id=0;this._subid=0;this._nextsub=[0];this._parent=[];this._encode=[];this._lookup=[];this._markpath=[]}function Subscope(scope){this.config=scope.config;this.legends=scope.legends;this.field=Object.create(scope.field);this.signals=Object.create(scope.signals);this.lambdas=Object.create(scope.lambdas);this.scales=Object.create(scope.scales);this.events=Object.create(scope.events);this.data=Object.create(scope.data);this.streams=[];this.updates=[];this.operators=[];this._id=0;this._subid=++scope._nextsub[0];this._nextsub=scope._nextsub;this._parent=scope._parent.slice();this._encode=scope._encode.slice();this._lookup=scope._lookup.slice();this._markpath=scope._markpath}var prototype$1l=Scope$1.prototype=Subscope.prototype;prototype$1l.fork=function(){return new Subscope(this)};prototype$1l.isSubscope=function(){return this._subid>0};prototype$1l.toRuntime=function(){this.finish();return{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}};prototype$1l.id=function(){return(this._subid?this._subid+":":0)+this._id++};prototype$1l.add=function(op){this.operators.push(op);op.id=this.id();if(op.refs){op.refs.forEach(function(ref){ref.$ref=op.id});op.refs=null}return op};prototype$1l.proxy=function(op){var vref=op instanceof Entry?ref(op):op;return this.add(Proxy$1({value:vref}))};prototype$1l.addStream=function(stream){this.streams.push(stream);stream.id=this.id();return stream};prototype$1l.addUpdate=function(update){this.updates.push(update);return update};prototype$1l.finish=function(){var name,ds;if(this.root)this.root.root=true;for(name in this.signals){this.signals[name].signal=name}for(name in this.scales){this.scales[name].scale=name}function annotate(op,name,type){var data,list;if(op){data=op.data||(op.data={});list=data[name]||(data[name]=[]);list.push(type)}}for(name in this.data){ds=this.data[name];annotate(ds.input,name,"input");annotate(ds.output,name,"output");annotate(ds.values,name,"values");for(var field in ds.index){annotate(ds.index[field],name,"index:"+field)}}return this};prototype$1l.pushState=function(encode,parent,lookup){this._encode.push(ref(this.add(Sieve$1({pulse:encode}))));this._parent.push(parent);this._lookup.push(lookup?ref(this.proxy(lookup)):null);this._markpath.push(-1)};prototype$1l.popState=function(){this._encode.pop();this._parent.pop();this._lookup.pop();this._markpath.pop()};prototype$1l.parent=function(){return peek(this._parent)};prototype$1l.encode=function(){return peek(this._encode)};prototype$1l.lookup=function(){return peek(this._lookup)};prototype$1l.markpath=function(){var p=this._markpath;return++p[p.length-1]};prototype$1l.fieldRef=function(field,name){if(isString(field))return fieldRef(field,name);if(!field.signal){error("Unsupported field reference: "+$(field))}var s=field.signal,f=this.field[s],params;if(!f){params={name:this.signalRef(s)};if(name)params.as=name;this.field[s]=f=ref(this.add(Field$1(params)))}return f};prototype$1l.compareRef=function(cmp,stable){function check(_){if(isSignal(_)){signal=true;return scope.signalRef(_.signal)}else{return _}}var scope=this,signal=false,fields=array(cmp.field).map(check),orders=array(cmp.order).map(check);if(stable){fields.push(tupleidRef)}return signal?ref(this.add(Compare$1({fields:fields,orders:orders}))):compareRef(fields,orders)};prototype$1l.keyRef=function(fields,flat){function check(_){if(isSignal(_)){signal=true;return ref(sig[_.signal])}else{return _}}var sig=this.signals,signal=false;fields=array(fields).map(check);return signal?ref(this.add(Key$1({fields:fields,flat:flat}))):keyRef(fields,flat)};prototype$1l.sortRef=function(sort){if(!sort)return sort;var a=[aggrField(sort.op,sort.field),tupleidRef],o=sort.order||Ascending;return o.signal?ref(this.add(Compare$1({fields:a,orders:[o=this.signalRef(o.signal),o]}))):compareRef(a,[o,o])};prototype$1l.event=function(source,type){var key=source+":"+type;if(!this.events[key]){var id=this.id();this.streams.push({id:id,source:source,type:type});this.events[key]=id}return this.events[key]};prototype$1l.addSignal=function(name,value){if(this.signals.hasOwnProperty(name)){error("Duplicate signal name: "+$(name))}var op=value instanceof Entry?value:this.add(operator(value));return this.signals[name]=op};prototype$1l.getSignal=function(name){if(!this.signals[name]){error("Unrecognized signal name: "+$(name))}return this.signals[name]};prototype$1l.signalRef=function(s){if(this.signals[s]){return ref(this.signals[s])}else if(!this.lambdas.hasOwnProperty(s)){this.lambdas[s]=this.add(operator(null))}return ref(this.lambdas[s])};prototype$1l.parseLambdas=function(){var code=Object.keys(this.lambdas);for(var i=0,n=code.length;i<n;++i){var s=code[i],e=parseExpression$1(s,this),op=this.lambdas[s];op.params=e.$params;op.update=e.$expr}};prototype$1l.property=function(spec){return spec&&spec.signal?this.signalRef(spec.signal):spec};prototype$1l.objectProperty=function(spec){return!spec||!isObject(spec)?spec:this.signalRef(spec.signal||propertyLambda(spec))};function propertyLambda(spec){return(isArray(spec)?arrayLambda:objectLambda)(spec)}function arrayLambda(array){var code="[",i=0,n=array.length,value;for(;i<n;++i){value=array[i];code+=(i>0?",":"")+(isObject(value)?value.signal||propertyLambda(value):$(value))}return code+"]"}function objectLambda(obj){var code="{",i=0,key,value;for(key in obj){value=obj[key];code+=(++i>1?",":"")+$(key)+":"+(isObject(value)?value.signal||propertyLambda(value):$(value))}return code+"}"}prototype$1l.exprRef=function(code,name){var params={expr:parseExpression$1(code,this)};if(name)params.expr.$name=name;return ref(this.add(Expression$1(params)))};prototype$1l.addBinding=function(name,bind){if(!this.bindings){error("Nested signals do not support binding: "+$(name))}this.bindings.push(extend({signal:name},bind))};prototype$1l.addScaleProj=function(name,transform){if(this.scales.hasOwnProperty(name)){error("Duplicate scale or projection name: "+$(name))}this.scales[name]=this.add(transform)};prototype$1l.addScale=function(name,params){this.addScaleProj(name,Scale$1(params))};prototype$1l.addProjection=function(name,params){this.addScaleProj(name,Projection$1(params))};prototype$1l.getScale=function(name){if(!this.scales[name]){error("Unrecognized scale name: "+$(name))}return this.scales[name]};prototype$1l.projectionRef=prototype$1l.scaleRef=function(name){return ref(this.getScale(name))};prototype$1l.projectionType=prototype$1l.scaleType=function(name){return this.getScale(name).params.type};prototype$1l.addData=function(name,dataScope){if(this.data.hasOwnProperty(name)){error("Duplicate data set name: "+$(name))}return this.data[name]=dataScope};prototype$1l.getData=function(name){if(!this.data[name]){error("Undefined data set name: "+$(name))}return this.data[name]};prototype$1l.addDataPipeline=function(name,entries){if(this.data.hasOwnProperty(name)){error("Duplicate data set name: "+$(name))}return this.addData(name,DataScope.fromEntries(this,entries))};function defaults(configs){return(configs||[]).reduce((out,config)=>{for(var key in config){var r=key==="legend"?{layout:1}:key==="style"?true:null;copy$3(out,key,config[key],r)}return out},defaults$1())}function copy$3(output,key,value,recurse){var k,o;if(isObject(value)&&!isArray(value)){o=isObject(output[key])?output[key]:output[key]={};for(k in value){if(recurse&&(recurse===true||recurse[k])){copy$3(o,k,value[k])}else{o[k]=value[k]}}}else{output[key]=value}}var defaultFont="sans-serif",defaultSymbolSize=30,defaultStrokeWidth=2,defaultColor="#4c78a8",black="#000",gray="#888",lightGray="#ddd";function defaults$1(){return{padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:defaultColor},area:{fill:defaultColor},image:null,line:{stroke:defaultColor,strokeWidth:defaultStrokeWidth},path:{stroke:defaultColor},rect:{fill:defaultColor},rule:{stroke:black},shape:{stroke:defaultColor},symbol:{fill:defaultColor,size:64},text:{fill:black,font:defaultFont,fontSize:11},style:{"guide-label":{fill:black,font:defaultFont,fontSize:10},"guide-title":{fill:black,font:defaultFont,fontSize:11,fontWeight:"bold"},"group-title":{fill:black,font:defaultFont,fontSize:13,fontWeight:"bold"},point:{size:defaultSymbolSize,strokeWidth:defaultStrokeWidth,shape:"circle"},circle:{size:defaultSymbolSize,strokeWidth:defaultStrokeWidth},square:{size:defaultSymbolSize,strokeWidth:defaultStrokeWidth,shape:"square"},cell:{fill:"transparent",stroke:lightGray}},title:{orient:"top",anchor:"middle",offset:4},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:true,domainWidth:1,domainColor:gray,grid:false,gridWidth:1,gridColor:lightGray,labels:true,labelAngle:0,labelLimit:180,labelPadding:2,ticks:true,tickColor:gray,tickOffset:0,tickRound:true,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-1},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:lightGray,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:true,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:gray,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function parse$5(spec,config){if(!isObject(spec))error("Input Vega specification must be an object.");return parseView(spec,new Scope$1(defaults([config,spec.config]))).toRuntime()}extend(transforms,tx,vtx,encode,geo,force,tree$1,voronoi$1,wordcloud,xf);exports.Bounds=Bounds;exports.CanvasHandler=CanvasHandler;exports.CanvasRenderer=CanvasRenderer;exports.Dataflow=Dataflow;exports.Debug=Debug;exports.Error=Error$1;exports.EventStream=EventStream;exports.Gradient=Gradient;exports.GroupItem=GroupItem;exports.Handler=Handler;exports.Info=Info;exports.Item=Item;exports.Marks=Marks;exports.MultiPulse=MultiPulse;exports.None=None;exports.Operator=Operator;exports.Parameters=Parameters;exports.Pulse=Pulse;exports.RenderType=RenderType;exports.Renderer=Renderer;exports.ResourceLoader=ResourceLoader;exports.SVGHandler=SVGHandler;exports.SVGRenderer=SVGRenderer;exports.SVGStringRenderer=SVGStringRenderer;exports.Scenegraph=Scenegraph;exports.Transform=Transform;exports.View=View;exports.Warn=Warn;exports.accessor=accessor;exports.accessorFields=accessorFields;exports.accessorName=accessorName;exports.array=array;exports.bin=bin;exports.bootstrapCI=bootstrapCI;exports.boundClip=boundClip;exports.boundContext=context;exports.boundItem=boundItem;exports.boundMark=boundMark;exports.boundStroke=boundStroke;exports.changeset=changeset;exports.clampRange=clampRange;exports.closeTag=closeTag;exports.compare=compare;exports.constant=constant;exports.debounce=debounce;exports.definition=definition;exports.domChild=domChild;exports.domClear=domClear;exports.domCreate=domCreate;exports.domFind=domFind;exports.error=error;exports.expressionFunction=expressionFunction;exports.extend=extend;exports.extent=extent;exports.extentIndex=extentIndex;exports.falsy=falsy;exports.fastmap=fastmap;exports.field=field;exports.flush=flush;exports.font=font;exports.fontFamily=fontFamily;exports.fontSize=fontSize;exports.format=format;exports.formatLocale=defaultLocale$1;exports.formats=formats;exports.id=id;exports.identity=identity;exports.inferType=inferType;exports.inferTypes=inferTypes;exports.ingest=ingest;exports.inherits=inherits;exports.inrange=inrange;exports.interpolate=interpolate$1;exports.interpolateColors=interpolateColors;exports.interpolateRange=interpolateRange;exports.intersect=intersect$1;exports.intersectBoxLine=intersectBoxLine;exports.intersectPath=intersectPath;exports.intersectPoint=intersectPoint;exports.intersectRule=intersectRule;exports.isArray=isArray;exports.isBoolean=isBoolean;exports.isDate=isDate;exports.isFunction=isFunction;exports.isNumber=isNumber;exports.isObject=isObject;exports.isRegExp=isRegExp;exports.isString=isString;exports.isTuple=isTuple;exports.key=key;exports.lerp=lerp;exports.loader=loader;exports.logger=logger;exports.merge=merge;exports.one=one;exports.openTag=openTag;exports.pad=pad;exports.panLinear=panLinear;exports.panLog=panLog;exports.panPow=panPow;exports.panSymlog=panSymlog;exports.parse=parse$5;exports.pathCurves=curves;exports.pathEqual=pathEqual;exports.pathParse=pathParse;exports.pathRectangle=vg_rect;exports.pathRender=pathRender;exports.pathSymbols=symbols;exports.pathTrail=vg_trail;exports.peek=peek;exports.point=point$4;exports.projection=projection$1;exports.quantizeInterpolator=quantizeInterpolator;exports.quarter=quarter;exports.quartiles=quartiles;exports.randomInteger=integer;exports.randomKDE=randomKDE;exports.randomLCG=lcg;exports.randomMixture=randomMixture;exports.randomNormal=randomNormal;exports.randomUniform=randomUniform;exports.read=read;exports.renderModule=renderModule;exports.repeat=repeat;exports.resetSVGClipId=resetSVGClipId;exports.responseType=responseType;exports.runtime=parse$4;exports.runtimeContext=context$2;exports.scale=scale$1;exports.sceneEqual=sceneEqual;exports.sceneFromJSON=sceneFromJSON;exports.scenePickVisit=pickVisit;exports.sceneToJSON=sceneToJSON;exports.sceneVisit=visit;exports.sceneZOrder=zorder;exports.scheme=scheme;exports.setRandom=setRandom;exports.span=span;exports.splitAccessPath=splitAccessPath;exports.stringValue=$;exports.textMetrics=textMetrics;exports.timeFormatLocale=defaultLocale;exports.timeInterval=timeInterval;exports.toBoolean=toBoolean;exports.toDate=toDate;exports.toNumber=toNumber;exports.toSet=toSet;exports.toString=toString;exports.transform=transform$1;exports.transforms=transforms;exports.truncate=truncate;exports.truthy=truthy;exports.tupleid=tupleid;exports.typeParsers=typeParsers;exports.utcquarter=utcquarter;exports.version=version;exports.visitArray=visitArray;exports.zero=zero;exports.zoomLinear=zoomLinear;exports.zoomLog=zoomLog;exports.zoomPow=zoomPow;exports.zoomSymlog=zoomSymlog;Object.defineProperty(exports,"__esModule",{value:true})});(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(require("vega"),require("vega-lite")):typeof define==="function"&&define.amd?define(["vega","vega-lite"],factory):(global=global||self,global.vegaEmbed=factory(global.vega,global.vl))})(this,function(vegaImport,vlImport){"use strict";var xhtml="http://www.w3.org/1999/xhtml";var namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(name){var prefix=name+="",i=prefix.indexOf(":");if(i>=0&&(prefix=name.slice(0,i))!=="xmlns")name=name.slice(i+1);return namespaces.hasOwnProperty(prefix)?{space:namespaces[prefix],local:name}:name}function creatorInherit(name){return function(){var document=this.ownerDocument,uri=this.namespaceURI;return uri===xhtml&&document.documentElement.namespaceURI===xhtml?document.createElement(name):document.createElementNS(uri,name)}}function creatorFixed(fullname){return function(){return this.ownerDocument.createElementNS(fullname.space,fullname.local)}}function creator(name){var fullname=namespace(name);return(fullname.local?creatorFixed:creatorInherit)(fullname)}function none(){}function selector(selector){return selector==null?none:function(){return this.querySelector(selector)}}function selection_select(select){if(typeof select!=="function")select=selector(select);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),node,subnode,i=0;i<n;++i){if((node=group[i])&&(subnode=select.call(node,node.__data__,i,group))){if("__data__"in node)subnode.__data__=node.__data__;subgroup[i]=subnode}}}return new Selection(subgroups,this._parents)}function empty(){return[]}function selectorAll(selector){return selector==null?empty:function(){return this.querySelectorAll(selector)}}function selection_selectAll(select){if(typeof select!=="function")select=selectorAll(select);for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j){for(var group=groups[j],n=group.length,node,i=0;i<n;++i){if(node=group[i]){subgroups.push(select.call(node,node.__data__,i,group));parents.push(node)}}}return new Selection(subgroups,parents)}function matcher(selector){return function(){return this.matches(selector)}}function selection_filter(match){if(typeof match!=="function")match=matcher(match);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=[],node,i=0;i<n;++i){if((node=group[i])&&match.call(node,node.__data__,i,group)){subgroup.push(node)}}}return new Selection(subgroups,this._parents)}function sparse(update){return new Array(update.length)}function selection_enter(){return new Selection(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(parent,datum){this.ownerDocument=parent.ownerDocument;this.namespaceURI=parent.namespaceURI;this._next=null;this._parent=parent;this.__data__=datum}EnterNode.prototype={constructor:EnterNode,appendChild:function(child){return this._parent.insertBefore(child,this._next)},insertBefore:function(child,next){return this._parent.insertBefore(child,next)},querySelector:function(selector){return this._parent.querySelector(selector)},querySelectorAll:function(selector){return this._parent.querySelectorAll(selector)}};function constant(x){return function(){return x}}var keyPrefix="$";function bindIndex(parent,group,enter,update,exit,data){var i=0,node,groupLength=group.length,dataLength=data.length;for(;i<dataLength;++i){if(node=group[i]){node.__data__=data[i];update[i]=node}else{enter[i]=new EnterNode(parent,data[i])}}for(;i<groupLength;++i){if(node=group[i]){exit[i]=node}}}function bindKey(parent,group,enter,update,exit,data,key){var i,node,nodeByKeyValue={},groupLength=group.length,dataLength=data.length,keyValues=new Array(groupLength),keyValue;for(i=0;i<groupLength;++i){if(node=group[i]){keyValues[i]=keyValue=keyPrefix+key.call(node,node.__data__,i,group);if(keyValue in nodeByKeyValue){exit[i]=node}else{nodeByKeyValue[keyValue]=node}}}for(i=0;i<dataLength;++i){keyValue=keyPrefix+key.call(parent,data[i],i,data);if(node=nodeByKeyValue[keyValue]){update[i]=node;node.__data__=data[i];nodeByKeyValue[keyValue]=null}else{enter[i]=new EnterNode(parent,data[i])}}for(i=0;i<groupLength;++i){if((node=group[i])&&nodeByKeyValue[keyValues[i]]===node){exit[i]=node}}}function selection_data(value,key){if(!value){data=new Array(this.size()),j=-1;this.each(function(d){data[++j]=d});return data}var bind=key?bindKey:bindIndex,parents=this._parents,groups=this._groups;if(typeof value!=="function")value=constant(value);for(var m=groups.length,update=new Array(m),enter=new Array(m),exit=new Array(m),j=0;j<m;++j){var parent=parents[j],group=groups[j],groupLength=group.length,data=value.call(parent,parent&&parent.__data__,j,parents),dataLength=data.length,enterGroup=enter[j]=new Array(dataLength),updateGroup=update[j]=new Array(dataLength),exitGroup=exit[j]=new Array(groupLength);bind(parent,group,enterGroup,updateGroup,exitGroup,data,key);for(var i0=0,i1=0,previous,next;i0<dataLength;++i0){if(previous=enterGroup[i0]){if(i0>=i1)i1=i0+1;while(!(next=updateGroup[i1])&&++i1<dataLength);previous._next=next||null}}}update=new Selection(update,parents);update._enter=enter;update._exit=exit;return update}function selection_exit(){return new Selection(this._exit||this._groups.map(sparse),this._parents)}function selection_join(onenter,onupdate,onexit){var enter=this.enter(),update=this,exit=this.exit();enter=typeof onenter==="function"?onenter(enter):enter.append(onenter+"");if(onupdate!=null)update=onupdate(update);if(onexit==null)exit.remove();else onexit(exit);return enter&&update?enter.merge(update).order():update}function selection_merge(selection){for(var groups0=this._groups,groups1=selection._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j){for(var group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),node,i=0;i<n;++i){if(node=group0[i]||group1[i]){merge[i]=node}}}for(;j<m0;++j){merges[j]=groups0[j]}return new Selection(merges,this._parents)}function selection_order(){for(var groups=this._groups,j=-1,m=groups.length;++j<m;){for(var group=groups[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&node.compareDocumentPosition(next)^4)next.parentNode.insertBefore(node,next);next=node}}}return this}function selection_sort(compare){if(!compare)compare=ascending;function compareNode(a,b){return a&&b?compare(a.__data__,b.__data__):!a-!b}for(var groups=this._groups,m=groups.length,sortgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,sortgroup=sortgroups[j]=new Array(n),node,i=0;i<n;++i){if(node=group[i]){sortgroup[i]=node}}sortgroup.sort(compareNode)}return new Selection(sortgroups,this._parents).order()}function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function selection_call(){var callback=arguments[0];arguments[0]=this;callback.apply(null,arguments);return this}function selection_nodes(){var nodes=new Array(this.size()),i=-1;this.each(function(){nodes[++i]=this});return nodes}function selection_node(){for(var groups=this._groups,j=0,m=groups.length;j<m;++j){for(var group=groups[j],i=0,n=group.length;i<n;++i){var node=group[i];if(node)return node}}return null}function selection_size(){var size=0;this.each(function(){++size});return size}function selection_empty(){return!this.node()}function selection_each(callback){for(var groups=this._groups,j=0,m=groups.length;j<m;++j){for(var group=groups[j],i=0,n=group.length,node;i<n;++i){if(node=group[i])callback.call(node,node.__data__,i,group)}}return this}function attrRemove(name){return function(){this.removeAttribute(name)}}function attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attrConstant(name,value){return function(){this.setAttribute(name,value)}}function attrConstantNS(fullname,value){return function(){this.setAttributeNS(fullname.space,fullname.local,value)}}function attrFunction(name,value){return function(){var v=value.apply(this,arguments);if(v==null)this.removeAttribute(name);else this.setAttribute(name,v)}}function attrFunctionNS(fullname,value){return function(){var v=value.apply(this,arguments);if(v==null)this.removeAttributeNS(fullname.space,fullname.local);else this.setAttributeNS(fullname.space,fullname.local,v)}}function selection_attr(name,value){var fullname=namespace(name);if(arguments.length<2){var node=this.node();return fullname.local?node.getAttributeNS(fullname.space,fullname.local):node.getAttribute(fullname)}return this.each((value==null?fullname.local?attrRemoveNS:attrRemove:typeof value==="function"?fullname.local?attrFunctionNS:attrFunction:fullname.local?attrConstantNS:attrConstant)(fullname,value))}function defaultView(node){return node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView}function styleRemove(name){return function(){this.style.removeProperty(name)}}function styleConstant(name,value,priority){return function(){this.style.setProperty(name,value,priority)}}function styleFunction(name,value,priority){return function(){var v=value.apply(this,arguments);if(v==null)this.style.removeProperty(name);else this.style.setProperty(name,v,priority)}}function selection_style(name,value,priority){return arguments.length>1?this.each((value==null?styleRemove:typeof value==="function"?styleFunction:styleConstant)(name,value,priority==null?"":priority)):styleValue(this.node(),name)}function styleValue(node,name){return node.style.getPropertyValue(name)||defaultView(node).getComputedStyle(node,null).getPropertyValue(name)}function propertyRemove(name){return function(){delete this[name]}}function propertyConstant(name,value){return function(){this[name]=value}}function propertyFunction(name,value){return function(){var v=value.apply(this,arguments);if(v==null)delete this[name];else this[name]=v}}function selection_property(name,value){return arguments.length>1?this.each((value==null?propertyRemove:typeof value==="function"?propertyFunction:propertyConstant)(name,value)):this.node()[name]}function classArray(string){return string.trim().split(/^|\s+/)}function classList(node){return node.classList||new ClassList(node)}function ClassList(node){this._node=node;this._names=classArray(node.getAttribute("class")||"")}ClassList.prototype={add:function(name){var i=this._names.indexOf(name);if(i<0){this._names.push(name);this._node.setAttribute("class",this._names.join(" "))}},remove:function(name){var i=this._names.indexOf(name);if(i>=0){this._names.splice(i,1);this._node.setAttribute("class",this._names.join(" "))}},contains:function(name){return this._names.indexOf(name)>=0}};function classedAdd(node,names){var list=classList(node),i=-1,n=names.length;while(++i<n)list.add(names[i])}function classedRemove(node,names){var list=classList(node),i=-1,n=names.length;while(++i<n)list.remove(names[i])}function classedTrue(names){return function(){classedAdd(this,names)}}function classedFalse(names){return function(){classedRemove(this,names)}}function classedFunction(names,value){return function(){(value.apply(this,arguments)?classedAdd:classedRemove)(this,names)}}function selection_classed(name,value){var names=classArray(name+"");if(arguments.length<2){var list=classList(this.node()),i=-1,n=names.length;while(++i<n)if(!list.contains(names[i]))return false;return true}return this.each((typeof value==="function"?classedFunction:value?classedTrue:classedFalse)(names,value))}function textRemove(){this.textContent=""}function textConstant(value){return function(){this.textContent=value}}function textFunction(value){return function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v}}function selection_text(value){return arguments.length?this.each(value==null?textRemove:(typeof value==="function"?textFunction:textConstant)(value)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(value){return function(){this.innerHTML=value}}function htmlFunction(value){return function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v}}function selection_html(value){return arguments.length?this.each(value==null?htmlRemove:(typeof value==="function"?htmlFunction:htmlConstant)(value)):this.node().innerHTML}function raise(){if(this.nextSibling)this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){if(this.previousSibling)this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(name){var create=typeof name==="function"?name:creator(name);return this.select(function(){return this.appendChild(create.apply(this,arguments))})}function constantNull(){return null}function selection_insert(name,before){var create=typeof name==="function"?name:creator(name),select=before==null?constantNull:typeof before==="function"?before:selector(before);return this.select(function(){return this.insertBefore(create.apply(this,arguments),select.apply(this,arguments)||null)})}function remove(){var parent=this.parentNode;if(parent)parent.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){return this.parentNode.insertBefore(this.cloneNode(false),this.nextSibling)}function selection_cloneDeep(){return this.parentNode.insertBefore(this.cloneNode(true),this.nextSibling)}function selection_clone(deep){return this.select(deep?selection_cloneDeep:selection_cloneShallow)}function selection_datum(value){return arguments.length?this.property("__data__",value):this.node().__data__}var filterEvents={};var event=null;if(typeof document!=="undefined"){var element=document.documentElement;if(!("onmouseenter"in element)){filterEvents={mouseenter:"mouseover",mouseleave:"mouseout"}}}function filterContextListener(listener,index,group){listener=contextListener(listener,index,group);return function(event){var related=event.relatedTarget;if(!related||related!==this&&!(related.compareDocumentPosition(this)&8)){listener.call(this,event)}}}function contextListener(listener,index,group){return function(event1){var event0=event;event=event1;try{listener.call(this,this.__data__,index,group)}finally{event=event0}}}function parseTypenames(typenames){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0)name=t.slice(i+1),t=t.slice(0,i);return{type:t,name:name}})}function onRemove(typename){return function(){var on=this.__on;if(!on)return;for(var j=0,i=-1,m=on.length,o;j<m;++j){if(o=on[j],(!typename.type||o.type===typename.type)&&o.name===typename.name){this.removeEventListener(o.type,o.listener,o.capture)}else{on[++i]=o}}if(++i)on.length=i;else delete this.__on}}function onAdd(typename,value,capture){var wrap=filterEvents.hasOwnProperty(typename.type)?filterContextListener:contextListener;return function(d,i,group){var on=this.__on,o,listener=wrap(value,i,group);if(on)for(var j=0,m=on.length;j<m;++j){if((o=on[j]).type===typename.type&&o.name===typename.name){this.removeEventListener(o.type,o.listener,o.capture);this.addEventListener(o.type,o.listener=listener,o.capture=capture);o.value=value;return}}this.addEventListener(typename.type,listener,capture);o={type:typename.type,name:typename.name,value:value,listener:listener,capture:capture};if(!on)this.__on=[o];else on.push(o)}}function selection_on(typename,value,capture){var typenames=parseTypenames(typename+""),i,n=typenames.length,t;if(arguments.length<2){var on=this.node().__on;if(on)for(var j=0,m=on.length,o;j<m;++j){for(i=0,o=on[j];i<n;++i){if((t=typenames[i]).type===o.type&&t.name===o.name){return o.value}}}return}on=value?onAdd:onRemove;if(capture==null)capture=false;for(i=0;i<n;++i)this.each(on(typenames[i],value,capture));return this}function dispatchEvent(node,type,params){var window=defaultView(node),event=window.CustomEvent;if(typeof event==="function"){event=new event(type,params)}else{event=window.document.createEvent("Event");if(params)event.initEvent(type,params.bubbles,params.cancelable),event.detail=params.detail;else event.initEvent(type,false,false)}node.dispatchEvent(event)}function dispatchConstant(type,params){return function(){return dispatchEvent(this,type,params)}}function dispatchFunction(type,params){return function(){return dispatchEvent(this,type,params.apply(this,arguments))}}function selection_dispatch(type,params){return this.each((typeof params==="function"?dispatchFunction:dispatchConstant)(type,params))}var root=[null];function Selection(groups,parents){this._groups=groups;this._parents=parents}function selection(){return new Selection([[document.documentElement]],root)}Selection.prototype=selection.prototype={constructor:Selection,select:selection_select,selectAll:selection_selectAll,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,join:selection_join,merge:selection_merge,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch};function select(selector){return typeof selector==="string"?new Selection([[document.querySelector(selector)]],[document.documentElement]):new Selection([[selector]],root)}var name="vega-embed";var version="4.0.0";var description="Publish Vega visualizations as embedded web components.";var keywords=["vega","data","visualization","component","embed"];var repository={type:"git",url:"http://github.com/vega/vega-embed.git"};var author={name:"UW Interactive Data Lab",url:"http://idl.cs.washington.edu"};var contributors=[{name:"Jeffrey Heer",url:"https://homes.cs.washington.edu/~jheer/"},{name:"Dominik Moritz",url:"https://www.domoritz.de"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Younghoon Kim"},{name:"Yuri Astrakhan"}];var license="BSD-3-Clause";var main="build/vega-embed.js";var module="build/src/embed.js";var unpkg="build/vega-embed.min.js";var jsdelivr="build/vega-embed.min.js";var types="build/src/embed.d.ts";var devDependencies={"@types/d3-selection":"^1.4.1","@types/jest":"^24.0.11","@types/json-stable-stringify":"^1.0.32","@types/semver":"^5.5.0","browser-sync":"^2.26.3",concurrently:"^4.1.0",jest:"^24.5.0","jest-canvas-mock":"^2.0.0-beta.1","node-sass":"^4.11.0",prettier:"^1.16.4",rollup:"^1.7.0","rollup-plugin-commonjs":"^9.2.1","rollup-plugin-json":"^4.0.0","rollup-plugin-node-resolve":"^4.0.1",terser:"^3.17.0","ts-jest":"^24.0.0",tslint:"^5.14.0","tslint-config-prettier":"^1.18.0",typescript:"^3.3.4000",vega:"^5.1.0","vega-lite":"^3.0.0"};var peerDependencies={vega:"*","vega-lite":"*"};var dependencies={"d3-selection":"^1.4.0","json-stringify-pretty-compact":"^2.0.0",semver:"^5.6.0","vega-schema-url-parser":"^1.1.0","vega-themes":"^2.3.0","vega-tooltip":"^0.17.0"};var scripts={prebuild:"npm run clean && ./build-style.sh && tsc && cp package.json build/",build:"rollup -c",quickbuild:"./build-style.sh && tsc && rollup -c",clean:"rm -rf build && rm -f src/style.ts && mkdir build",prettierbase:"prettier '{src,test}/**/*.ts' '*.scss' '*.html' '*.js'",format:"tslint -p . -e 'package.json' --fix && npm run prettierbase -- --write",lint:"tslint -p . -e 'package.json' && npm run prettierbase -- --list-different",postbuild:"terser build/vega-embed.js -cm > build/vega-embed.min.js",prepublishOnly:"npm run build",preversion:"npm run lint && npm run test",serve:"browser-sync start --directory -s -f build *.html",start:"npm run build && concurrently --kill-others -n Server,Typescript,Rollup 'npm run serve' 'tsc -w' 'rollup -c -w'",pretest:"./build-style.sh",test:"jest","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand"};var jest={testURL:"http://localhost/",setupFiles:["jest-canvas-mock"],transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["node_modules","<rootDir>/build","src"]};var pkg={name:name,version:version,description:description,keywords:keywords,repository:repository,author:author,contributors:contributors,license:license,main:main,module:module,unpkg:unpkg,jsdelivr:jsdelivr,types:types,devDependencies:devDependencies,peerDependencies:peerDependencies,dependencies:dependencies,scripts:scripts,jest:jest};function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}var stringOrChar=/("(?:[^\\"]|\\.)*")|[:,]/g;var jsonStringifyPrettyCompact=function stringify(passedObj,options){var indent,maxLength,replacer;options=options||{};indent=JSON.stringify([1],undefined,options.indent===undefined?2:options.indent).slice(2,-3);maxLength=indent===""?Infinity:options.maxLength===undefined?80:options.maxLength;replacer=options.replacer;return function _stringify(obj,currentIndent,reserved){var end,index,items,key,keyPart,keys,length,nextIndent,prettified,start,string,value;if(obj&&typeof obj.toJSON==="function"){obj=obj.toJSON()}string=JSON.stringify(obj,replacer);if(string===undefined){return string}length=maxLength-currentIndent.length-reserved;if(string.length<=length){prettified=string.replace(stringOrChar,function(match,stringLiteral){return stringLiteral||match+" "});if(prettified.length<=length){return prettified}}if(replacer!=null){obj=JSON.parse(string);replacer=undefined}if(typeof obj==="object"&&obj!==null){nextIndent=currentIndent+indent;items=[];index=0;if(Array.isArray(obj)){start="[";end="]";length=obj.length;for(;index<length;index++){items.push(_stringify(obj[index],nextIndent,index===length-1?0:1)||"null")}}else{start="{";end="}";keys=Object.keys(obj);length=keys.length;for(;index<length;index++){key=keys[index];keyPart=JSON.stringify(key)+": ";value=_stringify(obj[key],nextIndent,keyPart.length+(index===length-1?0:1));if(value!==undefined){items.push(keyPart+value)}}}if(items.length>0){return[start,indent+items.join(",\n"+nextIndent),end].join("\n"+currentIndent)}}return string}(passedObj,"",0)};function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var semver=createCommonjsModule(function(module,exports){exports=module.exports=SemVer;var debug;if(typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)){debug=function(){var args=Array.prototype.slice.call(arguments,0);args.unshift("SEMVER");console.log.apply(console,args)}}else{debug=function(){}}exports.SEMVER_SPEC_VERSION="2.0.0";var MAX_LENGTH=256;var MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;var MAX_SAFE_COMPONENT_LENGTH=16;var re=exports.re=[];var src=exports.src=[];var R=0;var NUMERICIDENTIFIER=R++;src[NUMERICIDENTIFIER]="0|[1-9]\\d*";var NUMERICIDENTIFIERLOOSE=R++;src[NUMERICIDENTIFIERLOOSE]="[0-9]+";var NONNUMERICIDENTIFIER=R++;src[NONNUMERICIDENTIFIER]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var MAINVERSION=R++;src[MAINVERSION]="("+src[NUMERICIDENTIFIER]+")\\."+"("+src[NUMERICIDENTIFIER]+")\\."+"("+src[NUMERICIDENTIFIER]+")";var MAINVERSIONLOOSE=R++;src[MAINVERSIONLOOSE]="("+src[NUMERICIDENTIFIERLOOSE]+")\\."+"("+src[NUMERICIDENTIFIERLOOSE]+")\\."+"("+src[NUMERICIDENTIFIERLOOSE]+")";var PRERELEASEIDENTIFIER=R++;src[PRERELEASEIDENTIFIER]="(?:"+src[NUMERICIDENTIFIER]+"|"+src[NONNUMERICIDENTIFIER]+")";var PRERELEASEIDENTIFIERLOOSE=R++;src[PRERELEASEIDENTIFIERLOOSE]="(?:"+src[NUMERICIDENTIFIERLOOSE]+"|"+src[NONNUMERICIDENTIFIER]+")";var PRERELEASE=R++;src[PRERELEASE]="(?:-("+src[PRERELEASEIDENTIFIER]+"(?:\\."+src[PRERELEASEIDENTIFIER]+")*))";var PRERELEASELOOSE=R++;src[PRERELEASELOOSE]="(?:-?("+src[PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+src[PRERELEASEIDENTIFIERLOOSE]+")*))";var BUILDIDENTIFIER=R++;src[BUILDIDENTIFIER]="[0-9A-Za-z-]+";var BUILD=R++;src[BUILD]="(?:\\+("+src[BUILDIDENTIFIER]+"(?:\\."+src[BUILDIDENTIFIER]+")*))";var FULL=R++;var FULLPLAIN="v?"+src[MAINVERSION]+src[PRERELEASE]+"?"+src[BUILD]+"?";src[FULL]="^"+FULLPLAIN+"$";var LOOSEPLAIN="[v=\\s]*"+src[MAINVERSIONLOOSE]+src[PRERELEASELOOSE]+"?"+src[BUILD]+"?";var LOOSE=R++;src[LOOSE]="^"+LOOSEPLAIN+"$";var GTLT=R++;src[GTLT]="((?:<|>)?=?)";var XRANGEIDENTIFIERLOOSE=R++;src[XRANGEIDENTIFIERLOOSE]=src[NUMERICIDENTIFIERLOOSE]+"|x|X|\\*";var XRANGEIDENTIFIER=R++;src[XRANGEIDENTIFIER]=src[NUMERICIDENTIFIER]+"|x|X|\\*";var XRANGEPLAIN=R++;src[XRANGEPLAIN]="[v=\\s]*("+src[XRANGEIDENTIFIER]+")"+"(?:\\.("+src[XRANGEIDENTIFIER]+")"+"(?:\\.("+src[XRANGEIDENTIFIER]+")"+"(?:"+src[PRERELEASE]+")?"+src[BUILD]+"?"+")?)?";var XRANGEPLAINLOOSE=R++;src[XRANGEPLAINLOOSE]="[v=\\s]*("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:\\.("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:\\.("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:"+src[PRERELEASELOOSE]+")?"+src[BUILD]+"?"+")?)?";var XRANGE=R++;src[XRANGE]="^"+src[GTLT]+"\\s*"+src[XRANGEPLAIN]+"$";var XRANGELOOSE=R++;src[XRANGELOOSE]="^"+src[GTLT]+"\\s*"+src[XRANGEPLAINLOOSE]+"$";var COERCE=R++;src[COERCE]="(?:^|[^\\d])"+"(\\d{1,"+MAX_SAFE_COMPONENT_LENGTH+"})"+"(?:\\.(\\d{1,"+MAX_SAFE_COMPONENT_LENGTH+"}))?"+"(?:\\.(\\d{1,"+MAX_SAFE_COMPONENT_LENGTH+"}))?"+"(?:$|[^\\d])";var LONETILDE=R++;src[LONETILDE]="(?:~>?)";var TILDETRIM=R++;src[TILDETRIM]="(\\s*)"+src[LONETILDE]+"\\s+";re[TILDETRIM]=new RegExp(src[TILDETRIM],"g");var tildeTrimReplace="$1~";var TILDE=R++;src[TILDE]="^"+src[LONETILDE]+src[XRANGEPLAIN]+"$";var TILDELOOSE=R++;src[TILDELOOSE]="^"+src[LONETILDE]+src[XRANGEPLAINLOOSE]+"$";var LONECARET=R++;src[LONECARET]="(?:\\^)";var CARETTRIM=R++;src[CARETTRIM]="(\\s*)"+src[LONECARET]+"\\s+";re[CARETTRIM]=new RegExp(src[CARETTRIM],"g");var caretTrimReplace="$1^";var CARET=R++;src[CARET]="^"+src[LONECARET]+src[XRANGEPLAIN]+"$";var CARETLOOSE=R++;src[CARETLOOSE]="^"+src[LONECARET]+src[XRANGEPLAINLOOSE]+"$";var COMPARATORLOOSE=R++;src[COMPARATORLOOSE]="^"+src[GTLT]+"\\s*("+LOOSEPLAIN+")$|^$";var COMPARATOR=R++;src[COMPARATOR]="^"+src[GTLT]+"\\s*("+FULLPLAIN+")$|^$";var COMPARATORTRIM=R++;src[COMPARATORTRIM]="(\\s*)"+src[GTLT]+"\\s*("+LOOSEPLAIN+"|"+src[XRANGEPLAIN]+")";re[COMPARATORTRIM]=new RegExp(src[COMPARATORTRIM],"g");var comparatorTrimReplace="$1$2$3";var HYPHENRANGE=R++;src[HYPHENRANGE]="^\\s*("+src[XRANGEPLAIN]+")"+"\\s+-\\s+"+"("+src[XRANGEPLAIN]+")"+"\\s*$";var HYPHENRANGELOOSE=R++;src[HYPHENRANGELOOSE]="^\\s*("+src[XRANGEPLAINLOOSE]+")"+"\\s+-\\s+"+"("+src[XRANGEPLAINLOOSE]+")"+"\\s*$";var STAR=R++;src[STAR]="(<|>)?=?\\s*\\*";for(var i=0;i<R;i++){debug(i,src[i]);if(!re[i]){re[i]=new RegExp(src[i])}}exports.parse=parse;function parse(version,options){if(!options||typeof options!=="object"){options={loose:!!options,includePrerelease:false}}if(version instanceof SemVer){return version}if(typeof version!=="string"){return null}if(version.length>MAX_LENGTH){return null}var r=options.loose?re[LOOSE]:re[FULL];if(!r.test(version)){return null}try{return new SemVer(version,options)}catch(er){return null}}exports.valid=valid;function valid(version,options){var v=parse(version,options);return v?v.version:null}exports.clean=clean;function clean(version,options){var s=parse(version.trim().replace(/^[=v]+/,""),options);return s?s.version:null}exports.SemVer=SemVer;function SemVer(version,options){if(!options||typeof options!=="object"){options={loose:!!options,includePrerelease:false}}if(version instanceof SemVer){if(version.loose===options.loose){return version}else{version=version.version}}else if(typeof version!=="string"){throw new TypeError("Invalid Version: "+version)}if(version.length>MAX_LENGTH){throw new TypeError("version is longer than "+MAX_LENGTH+" characters")}if(!(this instanceof SemVer)){return new SemVer(version,options)}debug("SemVer",version,options);this.options=options;this.loose=!!options.loose;var m=version.trim().match(options.loose?re[LOOSE]:re[FULL]);if(!m){throw new TypeError("Invalid Version: "+version)}this.raw=version;this.major=+m[1];this.minor=+m[2];this.patch=+m[3];if(this.major>MAX_SAFE_INTEGER||this.major<0){throw new TypeError("Invalid major version")}if(this.minor>MAX_SAFE_INTEGER||this.minor<0){throw new TypeError("Invalid minor version")}if(this.patch>MAX_SAFE_INTEGER||this.patch<0){throw new TypeError("Invalid patch version")}if(!m[4]){this.prerelease=[]}else{this.prerelease=m[4].split(".").map(function(id){if(/^[0-9]+$/.test(id)){var num=+id;if(num>=0&&num<MAX_SAFE_INTEGER){return num}}return id})}this.build=m[5]?m[5].split("."):[];this.format()}SemVer.prototype.format=function(){this.version=this.major+"."+this.minor+"."+this.patch;if(this.prerelease.length){this.version+="-"+this.prerelease.join(".")}return this.version};SemVer.prototype.toString=function(){return this.version};SemVer.prototype.compare=function(other){debug("SemVer.compare",this.version,this.options,other);if(!(other instanceof SemVer)){other=new SemVer(other,this.options)}return this.compareMain(other)||this.comparePre(other)};SemVer.prototype.compareMain=function(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options)}return compareIdentifiers(this.major,other.major)||compareIdentifiers(this.minor,other.minor)||compareIdentifiers(this.patch,other.patch)};SemVer.prototype.comparePre=function(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options)}if(this.prerelease.length&&!other.prerelease.length){return-1}else if(!this.prerelease.length&&other.prerelease.length){return 1}else if(!this.prerelease.length&&!other.prerelease.length){return 0}var i=0;do{var a=this.prerelease[i];var b=other.prerelease[i];debug("prerelease compare",i,a,b);if(a===undefined&&b===undefined){return 0}else if(b===undefined){return 1}else if(a===undefined){return-1}else if(a===b){continue}else{return compareIdentifiers(a,b)}}while(++i)};SemVer.prototype.inc=function(release,identifier){switch(release){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",identifier);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",identifier);break;case"prepatch":this.prerelease.length=0;this.inc("patch",identifier);this.inc("pre",identifier);break;case"prerelease":if(this.prerelease.length===0){this.inc("patch",identifier)}this.inc("pre",identifier);break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0){this.major++}this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0){this.minor++}this.patch=0;this.prerelease=[];break;case"patch":if(this.prerelease.length===0){this.patch++}this.prerelease=[];break;case"pre":if(this.prerelease.length===0){this.prerelease=[0]}else{var i=this.prerelease.length;while(--i>=0){if(typeof this.prerelease[i]==="number"){this.prerelease[i]++;i=-2}}if(i===-1){this.prerelease.push(0)}}if(identifier){if(this.prerelease[0]===identifier){if(isNaN(this.prerelease[1])){this.prerelease=[identifier,0]}}else{this.prerelease=[identifier,0]}}break;default:throw new Error("invalid increment argument: "+release)}this.format();this.raw=this.version;return this};exports.inc=inc;function inc(version,release,loose,identifier){if(typeof loose==="string"){identifier=loose;loose=undefined}try{return new SemVer(version,loose).inc(release,identifier).version}catch(er){return null}}exports.diff=diff;function diff(version1,version2){if(eq(version1,version2)){return null}else{var v1=parse(version1);var v2=parse(version2);var prefix="";if(v1.prerelease.length||v2.prerelease.length){prefix="pre";var defaultResult="prerelease"}for(var key in v1){if(key==="major"||key==="minor"||key==="patch"){if(v1[key]!==v2[key]){return prefix+key}}}return defaultResult}}exports.compareIdentifiers=compareIdentifiers;var numeric=/^[0-9]+$/;function compareIdentifiers(a,b){var anum=numeric.test(a);var bnum=numeric.test(b);if(anum&&bnum){a=+a;b=+b}return a===b?0:anum&&!bnum?-1:bnum&&!anum?1:a<b?-1:1}exports.rcompareIdentifiers=rcompareIdentifiers;function rcompareIdentifiers(a,b){return compareIdentifiers(b,a)}exports.major=major;function major(a,loose){return new SemVer(a,loose).major}exports.minor=minor;function minor(a,loose){return new SemVer(a,loose).minor}exports.patch=patch;function patch(a,loose){return new SemVer(a,loose).patch}exports.compare=compare;function compare(a,b,loose){return new SemVer(a,loose).compare(new SemVer(b,loose))}exports.compareLoose=compareLoose;function compareLoose(a,b){return compare(a,b,true)}exports.rcompare=rcompare;function rcompare(a,b,loose){return compare(b,a,loose)}exports.sort=sort;function sort(list,loose){return list.sort(function(a,b){return exports.compare(a,b,loose)})}exports.rsort=rsort;function rsort(list,loose){return list.sort(function(a,b){return exports.rcompare(a,b,loose)})}exports.gt=gt;function gt(a,b,loose){return compare(a,b,loose)>0}exports.lt=lt;function lt(a,b,loose){return compare(a,b,loose)<0}exports.eq=eq;function eq(a,b,loose){return compare(a,b,loose)===0}exports.neq=neq;function neq(a,b,loose){return compare(a,b,loose)!==0}exports.gte=gte;function gte(a,b,loose){return compare(a,b,loose)>=0}exports.lte=lte;function lte(a,b,loose){return compare(a,b,loose)<=0}exports.cmp=cmp;function cmp(a,op,b,loose){switch(op){case"===":if(typeof a==="object")a=a.version;if(typeof b==="object")b=b.version;return a===b;case"!==":if(typeof a==="object")a=a.version;if(typeof b==="object")b=b.version;return a!==b;case"":case"=":case"==":return eq(a,b,loose);case"!=":return neq(a,b,loose);case">":return gt(a,b,loose);case">=":return gte(a,b,loose);case"<":return lt(a,b,loose);case"<=":return lte(a,b,loose);default:throw new TypeError("Invalid operator: "+op)}}exports.Comparator=Comparator;function Comparator(comp,options){if(!options||typeof options!=="object"){options={loose:!!options,includePrerelease:false}}if(comp instanceof Comparator){if(comp.loose===!!options.loose){return comp}else{comp=comp.value}}if(!(this instanceof Comparator)){return new Comparator(comp,options)}debug("comparator",comp,options);this.options=options;this.loose=!!options.loose;this.parse(comp);if(this.semver===ANY){this.value=""}else{this.value=this.operator+this.semver.version}debug("comp",this)}var ANY={};Comparator.prototype.parse=function(comp){var r=this.options.loose?re[COMPARATORLOOSE]:re[COMPARATOR];var m=comp.match(r);if(!m){throw new TypeError("Invalid comparator: "+comp)}this.operator=m[1];if(this.operator==="="){this.operator=""}if(!m[2]){this.semver=ANY}else{this.semver=new SemVer(m[2],this.options.loose)}};Comparator.prototype.toString=function(){return this.value};Comparator.prototype.test=function(version){debug("Comparator.test",version,this.options.loose);if(this.semver===ANY){return true}if(typeof version==="string"){version=new SemVer(version,this.options)}return cmp(version,this.operator,this.semver,this.options)};Comparator.prototype.intersects=function(comp,options){if(!(comp instanceof Comparator)){throw new TypeError("a Comparator is required")}if(!options||typeof options!=="object"){options={loose:!!options,includePrerelease:false}}var rangeTmp;if(this.operator===""){rangeTmp=new Range(comp.value,options);return satisfies(this.value,rangeTmp,options)}else if(comp.operator===""){rangeTmp=new Range(this.value,options);return satisfies(comp.semver,rangeTmp,options)}var sameDirectionIncreasing=(this.operator===">="||this.operator===">")&&(comp.operator===">="||comp.operator===">");var sameDirectionDecreasing=(this.operator==="<="||this.operator==="<")&&(comp.operator==="<="||comp.operator==="<");var sameSemVer=this.semver.version===comp.semver.version;var differentDirectionsInclusive=(this.operator===">="||this.operator==="<=")&&(comp.operator===">="||comp.operator==="<=");var oppositeDirectionsLessThan=cmp(this.semver,"<",comp.semver,options)&&((this.operator===">="||this.operator===">")&&(comp.operator==="<="||comp.operator==="<"));var oppositeDirectionsGreaterThan=cmp(this.semver,">",comp.semver,options)&&((this.operator==="<="||this.operator==="<")&&(comp.operator===">="||comp.operator===">"));return sameDirectionIncreasing||sameDirectionDecreasing||sameSemVer&&differentDirectionsInclusive||oppositeDirectionsLessThan||oppositeDirectionsGreaterThan};exports.Range=Range;function Range(range,options){if(!options||typeof options!=="object"){options={loose:!!options,includePrerelease:false}}if(range instanceof Range){if(range.loose===!!options.loose&&range.includePrerelease===!!options.includePrerelease){return range}else{return new Range(range.raw,options)}}if(range instanceof Comparator){return new Range(range.value,options)}if(!(this instanceof Range)){return new Range(range,options)}this.options=options;this.loose=!!options.loose;this.includePrerelease=!!options.includePrerelease;this.raw=range;this.set=range.split(/\s*\|\|\s*/).map(function(range){return this.parseRange(range.trim())},this).filter(function(c){return c.length});if(!this.set.length){throw new TypeError("Invalid SemVer Range: "+range)}this.format()}Range.prototype.format=function(){this.range=this.set.map(function(comps){return comps.join(" ").trim()}).join("||").trim();return this.range};Range.prototype.toString=function(){return this.range};Range.prototype.parseRange=function(range){var loose=this.options.loose;range=range.trim();var hr=loose?re[HYPHENRANGELOOSE]:re[HYPHENRANGE];range=range.replace(hr,hyphenReplace);debug("hyphen replace",range);range=range.replace(re[COMPARATORTRIM],comparatorTrimReplace);debug("comparator trim",range,re[COMPARATORTRIM]);range=range.replace(re[TILDETRIM],tildeTrimReplace);range=range.replace(re[CARETTRIM],caretTrimReplace);range=range.split(/\s+/).join(" ");var compRe=loose?re[COMPARATORLOOSE]:re[COMPARATOR];var set=range.split(" ").map(function(comp){return parseComparator(comp,this.options)},this).join(" ").split(/\s+/);if(this.options.loose){set=set.filter(function(comp){return!!comp.match(compRe)})}set=set.map(function(comp){return new Comparator(comp,this.options)},this);return set};Range.prototype.intersects=function(range,options){if(!(range instanceof Range)){throw new TypeError("a Range is required")}return this.set.some(function(thisComparators){return isSatisfiable(thisComparators,options)&&range.set.some(function(rangeComparators){return isSatisfiable(rangeComparators,options)&&thisComparators.every(function(thisComparator){return rangeComparators.every(function(rangeComparator){return thisComparator.intersects(rangeComparator,options)})})})})};function isSatisfiable(comparators,options){var result=true;var remainingComparators=comparators.slice();var testComparator=remainingComparators.pop();while(result&&remainingComparators.length){result=remainingComparators.every(function(otherComparator){return testComparator.intersects(otherComparator,options)});testComparator=remainingComparators.pop()}return result}exports.toComparators=toComparators;function toComparators(range,options){return new Range(range,options).set.map(function(comp){return comp.map(function(c){return c.value}).join(" ").trim().split(" ")})}function parseComparator(comp,options){debug("comp",comp,options);comp=replaceCarets(comp,options);debug("caret",comp);comp=replaceTildes(comp,options);debug("tildes",comp);comp=replaceXRanges(comp,options);debug("xrange",comp);comp=replaceStars(comp,options);debug("stars",comp);return comp}function isX(id){return!id||id.toLowerCase()==="x"||id==="*"}function replaceTildes(comp,options){return comp.trim().split(/\s+/).map(function(comp){return replaceTilde(comp,options)}).join(" ")}function replaceTilde(comp,options){var r=options.loose?re[TILDELOOSE]:re[TILDE];return comp.replace(r,function(_,M,m,p,pr){debug("tilde",comp,_,M,m,p,pr);var ret;if(isX(M)){ret=""}else if(isX(m)){ret=">="+M+".0.0 <"+(+M+1)+".0.0"}else if(isX(p)){ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0"}else if(pr){debug("replaceTilde pr",pr);ret=">="+M+"."+m+"."+p+"-"+pr+" <"+M+"."+(+m+1)+".0"}else{ret=">="+M+"."+m+"."+p+" <"+M+"."+(+m+1)+".0"}debug("tilde return",ret);return ret})}function replaceCarets(comp,options){return comp.trim().split(/\s+/).map(function(comp){return replaceCaret(comp,options)}).join(" ")}function replaceCaret(comp,options){debug("caret",comp,options);var r=options.loose?re[CARETLOOSE]:re[CARET];return comp.replace(r,function(_,M,m,p,pr){debug("caret",comp,_,M,m,p,pr);var ret;if(isX(M)){ret=""}else if(isX(m)){ret=">="+M+".0.0 <"+(+M+1)+".0.0"}else if(isX(p)){if(M==="0"){ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0"}else{ret=">="+M+"."+m+".0 <"+(+M+1)+".0.0"}}else if(pr){debug("replaceCaret pr",pr);if(M==="0"){if(m==="0"){ret=">="+M+"."+m+"."+p+"-"+pr+" <"+M+"."+m+"."+(+p+1)}else{ret=">="+M+"."+m+"."+p+"-"+pr+" <"+M+"."+(+m+1)+".0"}}else{ret=">="+M+"."+m+"."+p+"-"+pr+" <"+(+M+1)+".0.0"}}else{debug("no pr");if(M==="0"){if(m==="0"){ret=">="+M+"."+m+"."+p+" <"+M+"."+m+"."+(+p+1)}else{ret=">="+M+"."+m+"."+p+" <"+M+"."+(+m+1)+".0"}}else{ret=">="+M+"."+m+"."+p+" <"+(+M+1)+".0.0"}}debug("caret return",ret);return ret})}function replaceXRanges(comp,options){debug("replaceXRanges",comp,options);return comp.split(/\s+/).map(function(comp){return replaceXRange(comp,options)}).join(" ")}function replaceXRange(comp,options){comp=comp.trim();var r=options.loose?re[XRANGELOOSE]:re[XRANGE];return comp.replace(r,function(ret,gtlt,M,m,p,pr){debug("xRange",comp,ret,gtlt,M,m,p,pr);var xM=isX(M);var xm=xM||isX(m);var xp=xm||isX(p);var anyX=xp;if(gtlt==="="&&anyX){gtlt=""}if(xM){if(gtlt===">"||gtlt==="<"){ret="<0.0.0"}else{ret="*"}}else if(gtlt&&anyX){if(xm){m=0}p=0;if(gtlt===">"){gtlt=">=";if(xm){M=+M+1;m=0;p=0}else{m=+m+1;p=0}}else if(gtlt==="<="){gtlt="<";if(xm){M=+M+1}else{m=+m+1}}ret=gtlt+M+"."+m+"."+p}else if(xm){ret=">="+M+".0.0 <"+(+M+1)+".0.0"}else if(xp){ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0"}debug("xRange return",ret);return ret})}function replaceStars(comp,options){debug("replaceStars",comp,options);return comp.trim().replace(re[STAR],"")}function hyphenReplace($0,from,fM,fm,fp,fpr,fb,to,tM,tm,tp,tpr,tb){if(isX(fM)){from=""}else if(isX(fm)){from=">="+fM+".0.0"}else if(isX(fp)){from=">="+fM+"."+fm+".0"}else{from=">="+from}if(isX(tM)){to=""}else if(isX(tm)){to="<"+(+tM+1)+".0.0"}else if(isX(tp)){to="<"+tM+"."+(+tm+1)+".0"}else if(tpr){to="<="+tM+"."+tm+"."+tp+"-"+tpr}else{to="<="+to}return(from+" "+to).trim()}Range.prototype.test=function(version){if(!version){return false}if(typeof version==="string"){version=new SemVer(version,this.options)}for(var i=0;i<this.set.length;i++){if(testSet(this.set[i],version,this.options)){return true}}return false};function testSet(set,version,options){for(var i=0;i<set.length;i++){if(!set[i].test(version)){return false}}if(version.prerelease.length&&!options.includePrerelease){for(i=0;i<set.length;i++){debug(set[i].semver);if(set[i].semver===ANY){continue}if(set[i].semver.prerelease.length>0){var allowed=set[i].semver;if(allowed.major===version.major&&allowed.minor===version.minor&&allowed.patch===version.patch){return true}}}return false}return true}exports.satisfies=satisfies;function satisfies(version,range,options){try{range=new Range(range,options)}catch(er){return false}return range.test(version)}exports.maxSatisfying=maxSatisfying;function maxSatisfying(versions,range,options){var max=null;var maxSV=null;try{var rangeObj=new Range(range,options)}catch(er){return null}versions.forEach(function(v){if(rangeObj.test(v)){if(!max||maxSV.compare(v)===-1){max=v;maxSV=new SemVer(max,options)}}});return max}exports.minSatisfying=minSatisfying;function minSatisfying(versions,range,options){var min=null;var minSV=null;try{var rangeObj=new Range(range,options)}catch(er){return null}versions.forEach(function(v){if(rangeObj.test(v)){if(!min||minSV.compare(v)===1){min=v;minSV=new SemVer(min,options)}}});return min}exports.minVersion=minVersion;function minVersion(range,loose){range=new Range(range,loose);var minver=new SemVer("0.0.0");if(range.test(minver)){return minver}minver=new SemVer("0.0.0-0");if(range.test(minver)){return minver}minver=null;for(var i=0;i<range.set.length;++i){var comparators=range.set[i];comparators.forEach(function(comparator){var compver=new SemVer(comparator.semver.version);switch(comparator.operator){case">":if(compver.prerelease.length===0){compver.patch++}else{compver.prerelease.push(0)}compver.raw=compver.format();case"":case">=":if(!minver||gt(minver,compver)){minver=compver}break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+comparator.operator)}})}if(minver&&range.test(minver)){return minver}return null}exports.validRange=validRange;function validRange(range,options){try{return new Range(range,options).range||"*"}catch(er){return null}}exports.ltr=ltr;function ltr(version,range,options){return outside(version,range,"<",options)}exports.gtr=gtr;function gtr(version,range,options){return outside(version,range,">",options)}exports.outside=outside;function outside(version,range,hilo,options){version=new SemVer(version,options);range=new Range(range,options);var gtfn,ltefn,ltfn,comp,ecomp;switch(hilo){case">":gtfn=gt;ltefn=lte;ltfn=lt;comp=">";ecomp=">=";break;case"<":gtfn=lt;ltefn=gte;ltfn=gt;comp="<";ecomp="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(satisfies(version,range,options)){return false}for(var i=0;i<range.set.length;++i){var comparators=range.set[i];var high=null;var low=null;comparators.forEach(function(comparator){if(comparator.semver===ANY){comparator=new Comparator(">=0.0.0")}high=high||comparator;low=low||comparator;if(gtfn(comparator.semver,high.semver,options)){high=comparator}else if(ltfn(comparator.semver,low.semver,options)){low=comparator}});if(high.operator===comp||high.operator===ecomp){return false}if((!low.operator||low.operator===comp)&&ltefn(version,low.semver)){return false}else if(low.operator===ecomp&&ltfn(version,low.semver)){return false}}return true}exports.prerelease=prerelease;function prerelease(version,options){var parsed=parse(version,options);return parsed&&parsed.prerelease.length?parsed.prerelease:null}exports.intersects=intersects;function intersects(r1,r2,options){r1=new Range(r1,options);r2=new Range(r2,options);return r1.intersects(r2)}exports.coerce=coerce;function coerce(version){if(version instanceof SemVer){return version}if(typeof version!=="string"){return null}var match=version.match(re[COERCE]);if(match==null){return null}return parse(match[1]+"."+(match[2]||"0")+"."+(match[3]||"0"))}});var semver_1=semver.SEMVER_SPEC_VERSION;var semver_2=semver.re;var semver_3=semver.src;var semver_4=semver.parse;var semver_5=semver.valid;var semver_6=semver.clean;var semver_7=semver.SemVer;var semver_8=semver.inc;var semver_9=semver.diff;var semver_10=semver.compareIdentifiers;var semver_11=semver.rcompareIdentifiers;var semver_12=semver.major;var semver_13=semver.minor;var semver_14=semver.patch;var semver_15=semver.compare;var semver_16=semver.compareLoose;var semver_17=semver.rcompare;var semver_18=semver.sort;var semver_19=semver.rsort;var semver_20=semver.gt;var semver_21=semver.lt;var semver_22=semver.eq;var semver_23=semver.neq;var semver_24=semver.gte;var semver_25=semver.lte;var semver_26=semver.cmp;var semver_27=semver.Comparator;var semver_28=semver.Range;var semver_29=semver.toComparators;var semver_30=semver.satisfies;var semver_31=semver.maxSatisfying;var semver_32=semver.minSatisfying;var semver_33=semver.minVersion;var semver_34=semver.validRange;var semver_35=semver.ltr;var semver_36=semver.gtr;var semver_37=semver.outside;var semver_38=semver.prerelease;var semver_39=semver.intersects;var semver_40=semver.coerce;var vegaSchemaUrlParser=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function default_1(url){var regex=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g;var _a=regex.exec(url).slice(1,3),library=_a[0],version=_a[1];return{library:library,version:version}}exports.default=default_1});var schemaParser=unwrapExports(vegaSchemaUrlParser);const markColor="#4572a7";const excelTheme={background:"#fff",arc:{fill:markColor},area:{fill:markColor},line:{stroke:markColor,strokeWidth:2},path:{stroke:markColor},rect:{fill:markColor},shape:{stroke:markColor},symbol:{fill:markColor,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:true,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:false,tickExtra:true},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}};const markColor$1="#000";const ggplot2Theme={group:{fill:"#e5e5e5"},arc:{fill:markColor$1},area:{fill:markColor$1},line:{stroke:markColor$1},path:{stroke:markColor$1},rect:{fill:markColor$1},shape:{stroke:markColor$1},symbol:{fill:markColor$1,size:40},axis:{domain:false,grid:true,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}};const markColor$2="#ab5787";const axisColor="#979797";const quartzTheme={background:"#f9f9f9",arc:{fill:markColor$2},area:{fill:markColor$2},line:{stroke:markColor$2},path:{stroke:markColor$2},rect:{fill:markColor$2},shape:{stroke:markColor$2},symbol:{fill:markColor$2,size:30},axis:{domainColor:axisColor,domainWidth:.5,gridWidth:.2,labelColor:axisColor,tickColor:axisColor,tickWidth:.2,titleColor:axisColor},axisBand:{grid:false},axisX:{grid:true,tickSize:10},axisY:{domain:false,grid:true,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}};const markColor$3="#3e5c69";const voxTheme={background:"#fff",arc:{fill:markColor$3},area:{fill:markColor$3},line:{stroke:markColor$3},path:{stroke:markColor$3},rect:{fill:markColor$3},shape:{stroke:markColor$3},symbol:{fill:markColor$3},axis:{domainWidth:.5,grid:true,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:false},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}};const lightColor="#fff";const medColor="#888";const darkTheme={background:"#333",title:{color:lightColor},style:{"guide-label":{fill:lightColor},"guide-title":{fill:lightColor}},axis:{domainColor:lightColor,gridColor:medColor,tickColor:lightColor}};const markColor$4="#30a2da";const axisColor$1="#cbcbcb";const guideLabelColor="#999";const backgroundColor="#f0f0f0";const blackTitle="#333";const fiveThirtyEightTheme={arc:{fill:markColor$4},area:{fill:markColor$4},axisBand:{grid:false},axisBottom:{domain:false,domainColor:blackTitle,domainWidth:3,grid:true,gridColor:axisColor$1,gridWidth:1,labelColor:guideLabelColor,labelFontSize:10,labelPadding:4,tickColor:axisColor$1,tickSize:10,titleFontSize:14,titlePadding:10},axisLeft:{domainColor:axisColor$1,domainWidth:1,grid:true,gridColor:axisColor$1,gridWidth:1,labelColor:guideLabelColor,labelFontSize:10,labelPadding:4,tickColor:axisColor$1,tickSize:10,ticks:true,titleFontSize:14,titlePadding:10},axisRight:{domainColor:blackTitle,domainWidth:1,grid:true,gridColor:axisColor$1,gridWidth:1,labelColor:guideLabelColor,labelFontSize:10,labelPadding:4,tickColor:axisColor$1,tickSize:10,ticks:true,titleFontSize:14,titlePadding:10},axisTop:{domain:false,domainColor:blackTitle,domainWidth:3,grid:true,gridColor:axisColor$1,gridWidth:1,labelColor:guideLabelColor,labelFontSize:10,labelPadding:4,tickColor:axisColor$1,tickSize:10,titleFontSize:14,titlePadding:10},background:backgroundColor,group:{fill:backgroundColor},legend:{labelColor:blackTitle,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:blackTitle,titleFontSize:14,titlePadding:10},line:{stroke:markColor$4,strokeWidth:2},path:{stroke:markColor$4,strokeWidth:.5},rect:{fill:markColor$4},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},symbol:{filled:true,shape:"circle"},shape:{stroke:markColor$4},style:{bar:{binSpacing:2,fill:markColor$4,stroke:null}},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}};const headlineFontSize=22;const headlineFontWeight="normal";const labelFont="Benton Gothic, sans";const labelFontSize=11.5;const labelFontWeight="normal";const markColor$5="#82c6df";const titleFont="Benton Gothic Bold, sans";const titleFontWeight="normal";const titleFontSize=13;const colorSchemes={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]};const latimesTheme={background:"#ffffff",title:{anchor:"start",font:titleFont,fontColor:"#000000",fontSize:headlineFontSize,fontWeight:headlineFontWeight},arc:{fill:markColor$5},area:{fill:markColor$5},line:{stroke:markColor$5,strokeWidth:2},path:{stroke:markColor$5},rect:{fill:markColor$5},shape:{stroke:markColor$5},symbol:{fill:markColor$5,size:30},axis:{labelFont:labelFont,labelFontSize:labelFontSize,labelFontWeight:labelFontWeight,titleFont:titleFont,titleFontSize:titleFontSize,titleFontWeight:titleFontWeight},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:labelFont,labelFontSize:labelFontSize,symbolType:"square",titleFont:titleFont,titleFontSize:titleFontSize,titleFontWeight:titleFontWeight},range:{category:colorSchemes["category-6"],diverging:colorSchemes["fireandice-6"],heatmap:colorSchemes["fire-7"],ordinal:colorSchemes["fire-7"],ramp:colorSchemes["fire-7"]}};var themes=Object.freeze({excel:excelTheme,ggplot2:ggplot2Theme,quartz:quartzTheme,vox:voxTheme,dark:darkTheme,fivethirtyeight:fiveThirtyEightTheme,latimes:latimesTheme});var defaultStyle=`#vg-tooltip-element {\n\tvisibility: hidden;\n\tpadding: 8px;\n\tposition: fixed;\n\tz-index: 1000;\n\tfont-family: sans-serif;\n\tfont-size: 11px;\n\tborder-radius: 3px;\n\tbox-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n\t/* The default theme is the light theme. */\n\tbackground-color: rgba(255, 255, 255, 0.95);\n\tborder: 1px solid #d9d9d9;\n\tcolor: black; }\n\t#vg-tooltip-element.visible {\n\t  visibility: visible; }\n\t#vg-tooltip-element h2 {\n\t  margin-top: 0;\n\t  margin-bottom: 10px;\n\t  font-size: 13px; }\n\t#vg-tooltip-element table {\n\t  border-spacing: 0; }\n\t  #vg-tooltip-element table tr {\n\t\tborder: none; }\n\t\t#vg-tooltip-element table tr td {\n\t\t  overflow: hidden;\n\t\t  text-overflow: ellipsis;\n\t\t  padding-top: 2px;\n\t\t  padding-bottom: 2px; }\n\t\t  #vg-tooltip-element table tr td.key {\n\t\t\tcolor: #808080;\n\t\t\tmax-width: 150px;\n\t\t\ttext-align: right;\n\t\t\tpadding-right: 4px; }\n\t\t  #vg-tooltip-element table tr td.value {\n\t\t\tdisplay: block;\n\t\t\tmax-width: 300px;\n\t\t\tmax-height: 7em;\n\t\t\ttext-align: left; }\n\t#vg-tooltip-element.dark-theme {\n\t  background-color: rgba(32, 32, 32, 0.9);\n\t  border: 1px solid #f5f5f5;\n\t  color: white; }\n\t  #vg-tooltip-element.dark-theme td.key {\n\t\tcolor: #bfbfbf; }\n  `;const EL_ID="vg-tooltip-element";const DEFAULT_OPTIONS={offsetX:10,offsetY:10,id:EL_ID,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:false,sanitize:escapeHTML,maxDepth:2};function escapeHTML(value){return String(value).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function createDefaultStyle(id){if(!/^[A-Za-z]+[-:.\w]*$/.test(id)){throw new Error("Invalid HTML ID")}return defaultStyle.toString().replace(EL_ID,id)}function accessor(fn,fields,name){fn.fields=fields||[];fn.fname=name;return fn}function error(message){throw Error(message)}function splitAccessPath(p){var path=[],q=null,b=0,n=p.length,s="",i,j,c;p=p+"";function push(){path.push(s+p.substring(i,j));s="";i=j+1}for(i=j=0;j<n;++j){c=p[j];if(c==="\\"){s+=p.substring(i,j);i=++j}else if(c===q){push();q=null;b=-1}else if(q){continue}else if(i===b&&c==='"'){i=j+1;q=c}else if(i===b&&c==="'"){i=j+1;q=c}else if(c==="."&&!b){if(j>i){push()}else{i=j+1}}else if(c==="["){if(j>i)push();b=i=j+1}else if(c==="]"){if(!b)error("Access path missing open bracket: "+p);if(b>0)push();b=0;i=j+1}}if(b)error("Access path missing closing bracket: "+p);if(q)error("Access path missing closing quote: "+p);if(j>i){j++;push()}return path}var isArray=Array.isArray;function isObject(_){return _===Object(_)}function isString(_){return typeof _==="string"}function $(x){return isArray(x)?"["+x.map($)+"]":isObject(x)||isString(x)?JSON.stringify(x).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):x}function field(field,name){var path=splitAccessPath(field),code="return _["+path.map($).join("][")+"];";return accessor(Function("_",code),[field=path.length===1?path[0]:field],name||field)}var empty$1=[];var id=field("id");var identity=accessor(function(_){return _},empty$1,"identity");var zero=accessor(function(){return 0},empty$1,"zero");var one=accessor(function(){return 1},empty$1,"one");var truthy=accessor(function(){return true},empty$1,"true");var falsy=accessor(function(){return false},empty$1,"false");var __rest=undefined&&undefined.__rest||function(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)if(e.indexOf(p[i])<0)t[p[i]]=s[p[i]];return t};function formatValue(value,valueToHtml,maxDepth){if(isArray(value)){return`[${value.map(v=>valueToHtml(isString(v)?v:stringify(v,maxDepth))).join(", ")}]`}if(isObject(value)){let content="";const _a=value,{title:title}=_a,rest=__rest(_a,["title"]);if(title){content+=`<h2>${valueToHtml(title)}</h2>`}const keys=Object.keys(rest);if(keys.length>0){content+="<table>";for(const key of keys){let val=rest[key];if(isObject(val)){val=stringify(val,maxDepth)}content+=`<tr><td class="key">${valueToHtml(key)}:</td><td class="value">${valueToHtml(val)}</td></tr>`}content+=`</table>`}return content||"{}"}return valueToHtml(value)}function replacer(maxDepth){const stack=[];return function(key,value){if(typeof value!=="object"||value===null){return value}const pos=stack.indexOf(this)+1;stack.length=pos;if(stack.length>maxDepth){return"[Object]"}if(stack.indexOf(value)>=0){return"[Circular]"}stack.push(value);return value}}function stringify(obj,maxDepth){return JSON.stringify(obj,replacer(maxDepth))}function calculatePosition(event,tooltipBox,offsetX,offsetY){let x=event.clientX+offsetX;if(x+tooltipBox.width>window.innerWidth){x=+event.clientX-offsetX-tooltipBox.width}let y=event.clientY+offsetY;if(y+tooltipBox.height>window.innerHeight){y=+event.clientY-offsetY-tooltipBox.height}return{x:x,y:y}}class Handler{constructor(options){this.options=Object.assign({},DEFAULT_OPTIONS,options);const elementId=this.options.id;this.call=this.tooltip_handler.bind(this);if(!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const style=document.createElement("style");style.setAttribute("id",this.options.styleId);style.innerHTML=createDefaultStyle(elementId);const head=document.head;if(head.childNodes.length>0){head.insertBefore(style,head.childNodes[0])}else{head.appendChild(style)}}this.el=document.getElementById(elementId);if(!this.el){this.el=document.createElement("div");this.el.setAttribute("id",elementId);this.el.classList.add("vg-tooltip");document.body.appendChild(this.el)}}tooltip_handler(handler,event,item,value){if(value==null||value===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=formatValue(value,this.options.sanitize,this.options.maxDepth);this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:x,y:y}=calculatePosition(event,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${y}px; left: ${x}px`)}}function post(window,url,data){const editor=window.open(url);const wait=1e4;const step=250;let count=~~(wait/step);function listen(evt){if(evt.source===editor){count=0;window.removeEventListener("message",listen,false)}}window.addEventListener("message",listen,false);function send(){if(count<=0){return}editor.postMessage(data,"*");setTimeout(send,step);count-=1}setTimeout(send,step)}var embedStyle=`.vega-embed {\n\tposition: relative;\n\tdisplay: inline-block;\n\tpadding-right: 38px; }\n\t.vega-embed details:not([open]) > :not(summary) {\n\t  display: none !important; }\n\t.vega-embed summary {\n\t  list-style: none;\n\t  display: flex;\n\t  position: absolute;\n\t  top: 0;\n\t  right: 0;\n\t  padding: 6px;\n\t  z-index: 1000;\n\t  background: white;\n\t  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n\t  color: #1b1e23;\n\t  border: 1px solid #aaa;\n\t  border-radius: 999px;\n\t  opacity: 0.2;\n\t  transition: opacity 0.4s ease-in;\n\t  outline: none;\n\t  cursor: pointer; }\n\t  .vega-embed summary::-webkit-details-marker {\n\t\tdisplay: none; }\n\t.vega-embed details[open] summary {\n\t  opacity: 0.7; }\n\t.vega-embed:hover summary,\n\t.vega-embed:focus summary {\n\t  opacity: 1 !important;\n\t  transition: opacity 0.2s ease; }\n\t.vega-embed .vega-actions {\n\t  position: absolute;\n\t  top: 35px;\n\t  right: -9px;\n\t  display: flex;\n\t  flex-direction: column;\n\t  padding-bottom: 8px;\n\t  padding-top: 8px;\n\t  border-radius: 4px;\n\t  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n\t  border: 1px solid #d9d9d9;\n\t  background: white;\n\t  animation-duration: 0.15s;\n\t  animation-name: scale-in;\n\t  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5); }\n\t  .vega-embed .vega-actions a {\n\t\tpadding: 8px 16px;\n\t\tfont-family: sans-serif;\n\t\tfont-size: 14px;\n\t\tfont-weight: 600;\n\t\twhite-space: nowrap;\n\t\tcolor: #434a56;\n\t\ttext-decoration: none; }\n\t\t.vega-embed .vega-actions a:hover {\n\t\t  background-color: #f7f7f9;\n\t\t  color: black; }\n\t  .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n\t\tcontent: "";\n\t\tdisplay: inline-block;\n\t\tposition: absolute; }\n\t  .vega-embed .vega-actions::before {\n\t\tleft: auto;\n\t\tright: 14px;\n\t\ttop: -16px;\n\t\tborder: 8px solid #0000;\n\t\tborder-bottom-color: #d9d9d9; }\n\t  .vega-embed .vega-actions::after {\n\t\tleft: auto;\n\t\tright: 15px;\n\t\ttop: -14px;\n\t\tborder: 7px solid #0000;\n\t\tborder-bottom-color: #fff; }\n  \n  .vega-embed-wrapper {\n\tmax-width: 100%;\n\toverflow: scroll;\n\tpadding-right: 14px; }\n  \n  @keyframes scale-in {\n\tfrom {\n\t  opacity: 0;\n\t  transform: scale(0.6); }\n\tto {\n\t  opacity: 1;\n\t  transform: scale(1); } }\n  `;function mergeDeep(dest,...src){for(const s of src){dest=deepMerge_(dest,s)}return dest}function deepMerge_(dest,src){if(typeof src!=="object"||src===null){return dest}for(const p in src){if(!src.hasOwnProperty(p)){continue}if(src[p]===undefined){continue}if(typeof src[p]!=="object"||vegaImport.isArray(src[p])||src[p]===null){dest[p]=src[p]}else if(typeof dest[p]!=="object"||dest[p]===null){dest[p]=mergeDeep(vegaImport.isArray(src[p].constructor)?[]:{},src[p])}else{mergeDeep(dest[p],src[p])}}return dest}if(!String.prototype.startsWith){String.prototype.startsWith=function(search,pos){return this.substr(!pos||pos<0?0:+pos,search.length)===search}}function isURL(s){return s.startsWith("http://")||s.startsWith("https://")||s.startsWith("//")}const vega=vegaImport;const vl=vlImport;const NAMES={vega:"Vega","vega-lite":"Vega-Lite"};const VERSION={vega:vega.version,"vega-lite":vl?vl.version:"not available"};const PREPROCESSOR={vega:(vgjson,_)=>vgjson,"vega-lite":(vljson,config)=>vl.compile(vljson,{config:config}).spec};const SVG_CIRCLES=`\n  <svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" width="14" height="14">\n\t<circle r="2" cy="8" cx="2"></circle>\n\t<circle r="2" cy="8" cx="8"></circle>\n\t<circle r="2" cy="8" cx="14"></circle>\n  </svg>`;const I18N={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"};function isTooltipHandler(h){return typeof h==="function"}function viewSource(source,sourceHeader,sourceFooter,mode){const header=`<html><head>${sourceHeader}</head><body><pre><code class="json">`;const footer=`</code></pre>${sourceFooter}</body></html>`;const win=window.open("");win.document.write(header+source+footer);win.document.title=`${NAMES[mode]} JSON Source`}function guessMode(spec,providedMode){if(spec.$schema){const parsed=schemaParser(spec.$schema);if(providedMode&&providedMode!==parsed.library){console.warn(`The given visualization spec is written in ${NAMES[parsed.library]}, but mode argument sets ${NAMES[providedMode]||providedMode}.`)}const mode=parsed.library;if(!semver_30(VERSION[mode],`^${parsed.version.slice(1)}`)){console.warn(`The input spec uses ${mode} ${parsed.version}, but the current version of ${NAMES[mode]} is ${VERSION[mode]}.`)}return mode}else{if("mark"in spec||"encoding"in spec||"layer"in spec||"hconcat"in spec||"vconcat"in spec||"facet"in spec||"repeat"in spec){return"vega-lite"}if("marks"in spec||"signals"in spec||"scales"in spec||"axes"in spec){return"vega"}}return providedMode||"vega"}function isLoader(o){return!!(o&&"load"in o)}function embed(el,spec,opt={}){return __awaiter(this,void 0,void 0,function*(){opt=opt||{};const patch=opt.patch||opt.onBeforeParse;const actions=opt.actions===true||opt.actions===false?opt.actions:mergeDeep({},{export:{svg:true,png:true},source:true,compiled:true,editor:true},opt.actions||{});const i18n=Object.assign({},I18N,opt.i18n);const loader=isLoader(opt.loader)?opt.loader:vega.loader(opt.loader);const renderer=opt.renderer||"canvas";const logLevel=opt.logLevel||vega.Warn;if(vega.isString(spec)){const data=yield loader.load(spec);return embed(el,JSON.parse(data),opt)}let config=opt.config||{};if(vega.isString(config)){const data=yield loader.load(config);return embed(el,spec,Object.assign({},opt,{config:JSON.parse(data)}))}if(opt.defaultStyle!==false){const ID="vega-embed-style";if(!document.getElementById(ID)){const style=document.createElement("style");style.id=ID;style.innerText=opt.defaultStyle===undefined||opt.defaultStyle===true?embedStyle.toString():opt.defaultStyle;document.head.appendChild(style)}}if(opt.theme){config=mergeDeep({},themes[opt.theme],config)}const mode=guessMode(spec,opt.mode);let vgSpec=PREPROCESSOR[mode](spec,config);if(mode==="vega-lite"){if(vgSpec.$schema){const parsed=schemaParser(vgSpec.$schema);if(!semver_30(VERSION.vega,`^${parsed.version.slice(1)}`)){console.warn(`The compiled spec uses Vega ${parsed.version}, but current version is ${VERSION.vega}.`)}}}const div=select(el).classed("vega-embed",true).html("");if(patch){if(patch instanceof Function){vgSpec=patch(vgSpec)}else if(vega.isString(patch)){const patchString=yield loader.load(patch);vgSpec=mergeDeep(vgSpec,JSON.parse(patchString))}else{vgSpec=mergeDeep(vgSpec,patch)}}const runtime=vega.parse(vgSpec,mode==="vega-lite"?{}:config);const view=new vega.View(runtime,{loader:loader,logLevel:logLevel,renderer:renderer});if(opt.tooltip!==false){let handler;if(isTooltipHandler(opt.tooltip)){handler=opt.tooltip}else{handler=new Handler(opt.tooltip===true?{}:opt.tooltip).call}view.tooltip(handler)}let hover=opt.hover;if(hover===undefined){hover=mode!=="vega-lite"}if(hover){const{hoverSet:hoverSet,updateSet:updateSet}=typeof hover==="boolean"?{}:hover;view.hover(hoverSet,updateSet)}if(opt){if(opt.width){view.width(opt.width)}if(opt.height){view.height(opt.height)}if(opt.padding){view.padding(opt.padding)}}yield view.initialize(el).runAsync();if(actions!==false){let wrapper=div;if(opt.defaultStyle!==false){const details=wrapper=div.append("details").attr("title",i18n.CLICK_TO_VIEW_ACTIONS);const summary=details.insert("summary");summary.html(SVG_CIRCLES);const dn=details.node();document.addEventListener("click",evt=>{if(!dn.contains(evt.target)){dn.removeAttribute("open")}})}const ctrl=wrapper.insert("div").attr("class","vega-actions");if(actions===true||actions.export!==false){for(const ext of["svg","png"]){if(actions===true||actions.export===true||actions.export[ext]){const i18nExportAction=i18n[`${ext.toUpperCase()}_ACTION`];ctrl.append("a").text(i18nExportAction).attr("href","#").attr("target","_blank").attr("download",`visualization.${ext}`).on("mousedown",function(){view.toImageURL(ext,opt.scaleFactor).then(url=>{this.href=url}).catch(error=>{throw error});event.preventDefault()})}}}if(actions===true||actions.source!==false){ctrl.append("a").text(i18n.SOURCE_ACTION).attr("href","#").on("mousedown",()=>{viewSource(jsonStringifyPrettyCompact(spec),opt.sourceHeader||"",opt.sourceFooter||"",mode);event.preventDefault()})}if(mode==="vega-lite"&&(actions===true||actions.compiled!==false)){ctrl.append("a").text(i18n.COMPILED_ACTION).attr("href","#").on("mousedown",()=>{viewSource(jsonStringifyPrettyCompact(vgSpec),opt.sourceHeader||"",opt.sourceFooter||"","vega");event.preventDefault()})}if(actions===true||actions.editor!==false){const editorUrl=opt.editorUrl||"https://vega.github.io/editor/";ctrl.append("a").text(i18n.EDITOR_ACTION).attr("href","#").on("mousedown",()=>{post(window,editorUrl,{config:config,mode:mode,renderer:renderer,spec:jsonStringifyPrettyCompact(spec)});event.preventDefault()})}}return{view:view,spec:spec,vgSpec:vgSpec}})}function container(spec,opt={}){return __awaiter(this,void 0,void 0,function*(){const wrapper=document.createElement("div");wrapper.classList.add("vega-embed-wrapper");const div=document.createElement("div");wrapper.appendChild(div);const actions=opt.actions===true||opt.actions===false?opt.actions:Object.assign({export:true,source:false,compiled:true,editor:true},opt.actions||{});const result=yield embed(div,spec,Object.assign({actions:actions},opt||{}));wrapper.value=result.view;return wrapper})}function isElement(obj){return obj instanceof selection||typeof HTMLElement==="object"?obj instanceof HTMLElement:obj&&typeof obj==="object"&&obj!==null&&obj.nodeType===1&&typeof obj.nodeName==="string"}const wrapper=(...args)=>{if(args.length>1&&(vegaImport.isString(args[0])&&!isURL(args[0])||isElement(args[0])||args.length===3)){return embed(args[0],args[1],args[2])}return container(args[0],args[1])};wrapper.vl=vl;wrapper.container=container;wrapper.embed=embed;wrapper.vega=vega;wrapper.default=embed;wrapper.version=pkg.version;return wrapper});